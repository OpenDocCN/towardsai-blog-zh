<html>
<head>
<title>Databricks Widgets in SQL Notebook</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">SQL记事本中的数据块小部件</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/databricks-widgets-in-sql-notebook-6c7cdbe47402?source=collection_archive---------2-----------------------#2022-05-11">https://pub.towardsai.net/databricks-widgets-in-sql-notebook-6c7cdbe47402?source=collection_archive---------2-----------------------#2022-05-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="9449" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用SQL代码对数据块中的笔记本和仪表板应用不同的参数</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/7cf4286d7a3112ed6369f820370cebe4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IKzKb1xEqQjLo8Se"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Igor Tudoran 在<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="d3b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Databricks小部件API使用户能够为笔记本和仪表板应用不同的参数。最好是使用不同的参数值重新运行相同的代码。在仪表板中使用时，它会为仪表板图表创建筛选器。</p><p id="a782" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Databricks支持小部件API的python和SQL代码。在本教程中，我们将讨论如何使用SQL创建小部件。我们将涵盖:</p><ul class=""><li id="e4ab" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">如何使用SQL创建不同类型的小部件？</li><li id="5350" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如何将widget值传递给笔记本和仪表盘？</li><li id="ca51" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如何配置widget设置？</li><li id="b5b4" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如何删除widgets？</li></ul><p id="dc8b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">本帖资源:</strong></p><ul class=""><li id="5bc4" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">YouTube上的视频教程<a class="ae ky" href="https://www.youtube.com/watch?v=YDXA8n0UENE&amp;list=PLVppujud2yJrb5CCEu0gqgI_W0YuCygIc&amp;index=1" rel="noopener ugc nofollow" target="_blank"/></li><li id="c122" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">带代码的数据块<a class="ae ky" href="https://mailchi.mp/456c6d0fa21e/5b452tfxg4" rel="noopener ugc nofollow" target="_blank">笔记本</a></li><li id="eb91" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">关于<a class="ae ky" href="https://www.youtube.com/playlist?list=PLVppujud2yJrb5CCEu0gqgI_W0YuCygIc" rel="noopener ugc nofollow" target="_blank">数据块的更多视频教程</a></li><li id="3a64" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">更多关于<a class="ae ky" href="https://medium.com/@AmyGrabNGoInfo/list/databricks-and-pyspark-7b59768e202d" rel="noopener">数据块的博客文章</a></li></ul><p id="a9db" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要了解python小部件，请参考我在Python笔记本上的教程<a class="ae ky" href="https://grabngoinfo.com/databricks-widgets-in-python-notebook/" rel="noopener ugc nofollow" target="_blank"> Databricks小部件。</a></p><p id="fa41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们开始吧！</p><h1 id="48b8" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">步骤0:数据块小部件类型</h1><p id="4aab" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">有四种类型的Databricks小部件:</p><ul class=""><li id="4622" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><code class="fe ng nh ni nj b">text</code>将文本作为输入。</li><li id="a6df" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe ng nh ni nj b">dropdown</code>创建一个带有值的下拉列表。</li><li id="dbde" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe ng nh ni nj b">combobox</code>是文本和下拉菜单的组合。用户可以从下拉列表中选择值，也可以输入自己的值。</li><li id="abb9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><code class="fe ng nh ni nj b">multiselect</code>创建一个值列表。用户可以从列表中选择一个或多个值。</li></ul><p id="a6cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要获得关于widgets的帮助信息，请使用<code class="fe ng nh ni nj b">dbutils.widgets.help()</code>。我们需要在单元格的开头添加<code class="fe ng nh ni nj b">%python</code>，因为笔记本的默认语言是SQL。输出中有可用于小部件的方法及其语法。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="4609" class="no mk it nj b gy np nq l nr ns">%python<br/># Get documentation about widgets<br/>dbutils.widgets.help()</span></pre><p id="4d63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="05f6" class="no mk it nj b gy np nq l nr ns">dbutils.widgets provides utilities for working with notebook widgets. You can create different types of widgets and get their bound value. For more info about a method, use dbutils.widgets.help("methodName").<br/>combobox(name: String, defaultValue: String, choices: Seq, label: String): void -&gt; Creates a combobox input widget with a given name, default value and choices<br/>dropdown(name: String, defaultValue: String, choices: Seq, label: String): void -&gt; Creates a dropdown input widget a with given name, default value and choices<br/>get(name: String): String -&gt; Retrieves current value of an input widget<br/>getArgument(name: String, optional: String): String -&gt; (DEPRECATED) Equivalent to get<br/>multiselect(name: String, defaultValue: String, choices: Seq, label: String): void -&gt; Creates a multiselect input widget with a given name, default value and choices<br/>remove(name: String): void -&gt; Removes an input widget from the notebook<br/>removeAll: void -&gt; Removes all widgets in the notebook<br/>text(name: String, defaultValue: String, label: String): void -&gt; Creates a text input widget with a given name and default value</span></pre><p id="f6ac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要获得关于特定小部件方法的帮助信息，请使用<code class="fe ng nh ni nj b">dbutils.widgets.help(methodName)</code>。例如，我可以使用<code class="fe ng nh ni nj b">dbutils.widgets.help('combobox')</code>来获取关于<code class="fe ng nh ni nj b">combobox</code>方法的信息。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="1348" class="no mk it nj b gy np nq l nr ns">%python<br/># Get help informatuon for one method<br/>dbutils.widgets.help('combobox')</span></pre><p id="8127" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="e689" class="no mk it nj b gy np nq l nr ns">/**<br/>* Creates a combobox input widget with a given name, default value and choices. Optionally, you<br/>* can provide a label for the combobox widget that will be rendered in place of the name. If a<br/>* widget with a given name already exists, its properties will be overwritten. The default<br/>* value does not have to be one choices.<br/>*<br/>* Example: dbutils.widgets.combobox("product", "Other", Seq("Camera", "GPS", "Smartphone"))<br/>*<br/>* @param name unique name identifying the widget<br/>* @param defaultValue value value which widget is populated by default<br/>* @param choices possible choices for the dropdown menu<br/>* @param label optional widget label<br/>*/<br/>combobox(name: java.lang.String, defaultValue: java.lang.String, choices: scala.collection.Seq, label: java.lang.String): void</span></pre><h1 id="4ff5" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">步骤1:读入数据集</h1><p id="c3c6" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在步骤1中，从安装的S3桶中读取关于加密货币价格的CSV数据集。该数据集是<a class="ae ky" href="https://www.kaggle.com/competitions/g-research-crypto-forecasting/data" rel="noopener ugc nofollow" target="_blank"> Kaggle G-Research加密预测数据集</a>的子集。要了解如何将AWS S3铲斗安装到数据块，请参考我之前的教程<a class="ae ky" href="https://medium.com/@AmyGrabNGoInfo/databricks-mount-to-aws-s3-and-import-data-4100621a63fd" rel="noopener">将数据块安装到AWS S3并导入数据</a>。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="bb23" class="no mk it nj b gy np nq l nr ns">-- mode "FAILFAST" will abort file parsing with a RuntimeException if any malformed lines are encountered<br/>CREATE OR REPLACE TEMPORARY VIEW crypto_100k_records<br/>USING CSV<br/>OPTIONS (path "/mnt/demo4tutorial/data/crypto_100k_records.csv", header "true", mode "FAILFAST");</span><span id="f6fa" class="no mk it nj b gy nt nq l nr ns">-- Take a look at the data<br/>SELECT * FROM crypto_100k_records</span></pre><p id="3aca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">看完数据后，我们会做一些数据处理。时间戳采用UNIX纪元格式，即自1970年1月1日协调世界时(UTC)以来的秒数。使用<code class="fe ng nh ni nj b">from_unixtime</code>，我们将其更改为日期时间格式。可视化中不使用的列将被删除。我们还为资产名称创建了一个新列。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="48f1" class="no mk it nj b gy np nq l nr ns">-- Data processing<br/>CREATE OR REPLACE TEMPORARY VIEW df AS<br/>SELECT <br/>  asset_id,<br/>  volume,<br/>  --Change epoch to datetime format<br/>  from_unixtime(timestamp) AS datetime, <br/>  -- Create asset name<br/>  CASE WHEN asset_id = 1 THEN 'Bitcoin' WHEN asset_id = 6 THEN 'Ethereum' ELSE 'Other' END AS asset_name<br/>FROM crypto_100k_records;</span><span id="5c19" class="no mk it nj b gy nt nq l nr ns">-- Take a look at the data<br/>SELECT * FROM df</span></pre><p id="be6d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/2e4932c8ff4012a283361d0a69ec7ceb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*clSDTKqokCC9YiW2.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Databricks SQL微件的数据集-来自GrabNGoInfo.com的图像</figcaption></figure><h1 id="0f5e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">步骤2:使用SQL创建Databricks小部件</h1><p id="4898" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在第2步中，我们使用SQL创建不同类型的Databricks小部件。</p><ul class=""><li id="6f06" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">下拉小部件用于<code class="fe ng nh ni nj b">Asset_Name</code>列。其名称为<code class="fe ng nh ni nj b">dropdown_filter</code>，默认值为<code class="fe ng nh ni nj b">Bitcoin</code>。下拉列表中有四个选项。<code class="fe ng nh ni nj b">Bitcoin</code>、<code class="fe ng nh ni nj b">Ethereum</code>、<code class="fe ng nh ni nj b">Other</code>和<code class="fe ng nh ni nj b">All</code>。<code class="fe ng nh ni nj b">All</code>表示选择所有资产名称。</li><li id="a8d9" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">multiselect小部件也基于<code class="fe ng nh ni nj b">Asset_Name</code>列。其名称为<code class="fe ng nh ni nj b">multiselect_filter</code>，默认值为<code class="fe ng nh ni nj b">Bitcoin</code>。三个选项<code class="fe ng nh ni nj b">Bitcoin</code>、<code class="fe ng nh ni nj b">Ethereum</code>和<code class="fe ng nh ni nj b">Other</code>是<code class="fe ng nh ni nj b">Asset_Name</code>列的三个唯一值。我们可以使用multiselect小部件选择多值。</li><li id="7c39" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">combobox小部件基于<code class="fe ng nh ni nj b">Asset_ID</code>列。其名称为<code class="fe ng nh ni nj b">combobox_filter</code>，默认值为<code class="fe ng nh ni nj b">0</code>。使用SELECT DISTINCT提取<code class="fe ng nh ni nj b">Asset_ID</code>列的唯一值。</li><li id="298c" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">文本小部件也基于<code class="fe ng nh ni nj b">Asset_ID</code>列。它的名称为<code class="fe ng nh ni nj b">text_filter</code>，默认值为<code class="fe ng nh ni nj b">0</code>。用户可以在框中输入资产ID。</li></ul><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="77d2" class="no mk it nj b gy np nq l nr ns">-- Create a dropdown widget<br/>CREATE WIDGET DROPDOWN dropdown_filter DEFAULT "Bitcoin"  CHOICES (VALUES 'Bitcoin', 'Ethereum', 'Other', 'All');</span><span id="3c9e" class="no mk it nj b gy nt nq l nr ns">-- Create a multiselect widget<br/>CREATE WIDGET MULTISELECT multiselect_filter DEFAULT "Bitcoin"  CHOICES (VALUES 'Bitcoin', 'Ethereum', 'Other');</span><span id="934e" class="no mk it nj b gy nt nq l nr ns">-- Create a combobox widget<br/>CREATE WIDGET COMBOBOX combobox_filter DEFAULT "0"  CHOICES SELECT DISTINCT asset_id FROM df;</span><span id="145b" class="no mk it nj b gy nt nq l nr ns">-- Create a text widget<br/>CREATE WIDGET TEXT text_filter DEFAULT "0";</span></pre><p id="cd35" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">运行代码后，小部件显示在笔记本的顶部。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/c8335eb00f9e94b1a15a953037319a3d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*T8p8MFGFhwGuB5V-.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Databricks SQL小部件—图片来自GrabNGoInfo.com</figcaption></figure><h1 id="94b5" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">步骤3:在SQL代码中传递小部件值</h1><p id="a698" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">创建小部件后，在步骤3中，我们将讨论如何使用SQL传递小部件值。可以通过将小部件名称传递给<code class="fe ng nh ni nj b">getArgument()</code>函数来检索小部件值。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="58b9" class="no mk it nj b gy np nq l nr ns">-- Pass widget value to SQL code<br/>SELECT * <br/>FROM df<br/>WHERE asset_id = getArgument('text_filter')</span></pre><p id="9add" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/1cd53918b8cc23b58e10aeeff9bcc9ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hNOpIm6GcHQdiJpb.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">数据块在SQL代码中传递小部件值—图片来自GrabNGoInfo.com</figcaption></figure><p id="ce49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当dropdown小部件将<code class="fe ng nh ni nj b">All</code>作为选项时，我们需要区别对待<code class="fe ng nh ni nj b">All</code>和其他选项，因为<code class="fe ng nh ni nj b">All</code>不是dataframe列中的值。一种方法是，如果dropdown widget值为<code class="fe ng nh ni nj b">All</code>，则使用<code class="fe ng nh ni nj b">CASE WHEN</code>条件来包含所有记录，否则按widget值进行过滤。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="53b3" class="no mk it nj b gy np nq l nr ns">-- Dropdown widget with All as one option<br/>SELECT <br/>  datetime,<br/>  volume<br/>FROM df<br/>WHERE CASE getArgument('dropdown_filter') WHEN 'Bitcoin' THEN asset_name = 'Bitcoin'<br/>                                          WHEN 'Ethereum' THEN asset_name = 'Ethereum'<br/>                                          WHEN 'Other' THEN asset_name = 'Other'    <br/>                                          ELSE asset_name IN (SELECT DISTINCT asset_name FROM df) END</span></pre><p id="5c33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">输出:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/350de4392033c913f4792792dab4aac3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Pbvh4fr6pO8NDjfe.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Databricks SQL小部件下拉列表，选项为“全部”——图片来自GrabNGoInfo.com</figcaption></figure><h1 id="827e" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">步骤4:使用小部件作为仪表板的过滤器</h1><p id="729f" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在第4步中，我们将讨论如何使用小部件作为Databricks dashboard的过滤器。</p><p id="9073" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">首先，让我们使用Databricks的内置工具创建一个图表。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="2bbb" class="no mk it nj b gy np nq l nr ns">-- Dropdown widget with All as one option<br/>SELECT <br/>  datetime,<br/>  volume<br/>FROM df<br/>WHERE CASE getArgument('dropdown_filter') WHEN 'Bitcoin' THEN asset_name = 'Bitcoin'<br/>                                          WHEN 'Ethereum' THEN asset_name = 'Ethereum'<br/>                                          WHEN 'Other' THEN asset_name = 'Other'    <br/>                                          ELSE asset_name IN (SELECT DISTINCT asset_name FROM df) END</span></pre><p id="860a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">点按条形图图标旁边的向下三角形，然后选择图表类型。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/6a5b951ad143a0f9fdc9f95a0d726519.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LX-uhjIn6vAFuO_G.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Databricks SQL Widgets仪表板—来自GrabNGoInfo.com的图片</figcaption></figure><p id="8701" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，点击<strong class="lb iu">绘图选项</strong>图标，检查图表设置是否正确，必要时进行更改。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/a44ffa09104750c41dc026a2c6dad0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WSPVoaw5j7m15InK.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Databricks SQL Widgets仪表板—来自GrabNGoInfo.com的图片</figcaption></figure><p id="e8d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要创建仪表板，单击单元格右上角的条形图图标，然后单击<strong class="lb iu">添加到新仪表板</strong>。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/cdcf4ecd162aafc648ab18c20980ddc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*wqbEpAPN74qN7agV.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Databricks SQL小部件创建新的仪表板—图片来自GrabNGoInfo.com</figcaption></figure><p id="2554" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将打开仪表板。我们可以看到仪表板顶部的过滤器。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/c9a8ed996a184980d8c63ce8e83919ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UHjE3F_0RPvmLXJW.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作为仪表板过滤器的数据块SQL部件—图片来自GrabNGoInfo.com</figcaption></figure><h1 id="29b1" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">步骤5:配置数据块部件</h1><p id="e386" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在第5步中，我们将通过单击笔记本右上角的齿轮图标来配置Databricks小部件。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/805d5d45d2c9760bdda3a0e9ca3ea66c.png" data-original-src="https://miro.medium.com/v2/resize:fit:920/format:webp/0*VYuYfcJKMKuv3qMa.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">数据块配置数据块部件—图片来自GrabNGoInfo.com</figcaption></figure><p id="8dd9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将弹出<strong class="lb iu">微件面板设置</strong>窗口。在<strong class="lb iu">微件更改</strong>下，有三个选项。</p><ul class=""><li id="d601" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><strong class="lb iu">运行访问的命令</strong>表示当小部件值改变时，仅重新运行直接检索改变的小部件的单元。这是默认设置，但它不适用于SQL单元格。</li><li id="6357" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">什么都不做</strong>表示笔记本不会根据新的小部件值重新运行。</li><li id="2f13" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><strong class="lb iu">运行笔记本</strong>表示重新运行整个笔记本。我建议选择这个选项，以防止遗漏代码中的一些重要步骤。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/081f33cc753a76dbf5f7e028dd3d4059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*iIG3ruV9sxoETqT6.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Databricks Widgets面板设置—图片来自GrabNGoInfo.com</figcaption></figure><p id="3177" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">默认情况下，widgets面板固定在笔记本的顶部，但是我们可以取消固定到顶部选项，使其显示在第一个单元格的上方。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/5e44c99ca9d30555b4fe0706762b3a9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3hhqfFTScGNIAI3t.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Databricks Pin部件—图片来自GrabNGoInfo.com</figcaption></figure><h1 id="0594" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">步骤6:将值传递给另一个笔记本中的小部件</h1><p id="8d3b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">有时，我们可能需要使用另一个笔记本中的特定参数来运行该笔记本。在这种情况下，我们可以使用<code class="fe ng nh ni nj b">%run</code>来运行笔记本，同时传递参数。下面的示例代码来自小部件的Databricks文档。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="f042" class="no mk it nj b gy np nq l nr ns">%python<br/># Pass parameters to widgets in another notebook<br/>%run /path/to/notebook $X="10" $Y="1"</span></pre><h1 id="49b7" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">步骤7:删除数据块部件</h1><p id="a4f0" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在第7步中，我们将讨论如何删除Databricks小部件。要删除一个小部件，请使用<code class="fe ng nh ni nj b">REMOVE WIDGET widget_name</code>。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="365e" class="no mk it nj b gy np nq l nr ns">-- Remove one widget<br/>REMOVE WIDGET text_filter</span></pre><p id="8c41" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要移除所有的小部件，我们需要使用python代码<code class="fe ng nh ni nj b">dbutils.widgets.removeAll()</code>。</p><pre class="kj kk kl km gt nk nj nl nm aw nn bi"><span id="a5f5" class="no mk it nj b gy np nq l nr ns">%python<br/># Remove all widgets<br/>dbutils.widgets.removeAll()</span></pre><h1 id="e2cd" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">摘要</h1><p id="315c" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">在本教程中，我们讨论了如何使用SQL创建小部件。你学到了:</p><ul class=""><li id="b01a" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">如何使用SQL创建不同类型的小部件？</li><li id="b973" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如何将widget值传递给笔记本和仪表盘？</li><li id="ebc8" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如何配置widget设置？</li><li id="8091" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">如何删除widgets？</li></ul><p id="3e4d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意，您不能使用小部件在笔记本中的不同语言之间传递参数，并在计划的作业中运行它。因此，当在SQL中创建小部件时，小部件的值需要由SQL检索。要了解如何运行数据块作业，请参考我的教程<a class="ae ky" href="https://grabngoinfo.com/databricks-multi-task-job-scheduling/" rel="noopener ugc nofollow" target="_blank">数据块多任务作业调度</a></p><h1 id="eba6" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">推荐教程</h1><ul class=""><li id="68e7" class="lv lw it lb b lc nb lf nc li ny lm nz lq oa lu ma mb mc md bi translated"><a class="ae ky" href="https://medium.com/grabngoinfo/grabngoinfo-machine-learning-tutorials-inventory-9b9d78ebdd67" rel="noopener"> GrabNGoInfo机器学习教程盘点</a></li><li id="7c1a" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://medium.com/p/one-class-svm-for-anomaly-detection-6c97fdd6d8af" rel="noopener">用于异常检测的单级SVM</a></li><li id="272b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://medium.com/p/3-ways-for-multiple-time-series-forecasting-using-prophet-in-python-7a0709a117f9" rel="noopener">使用Python中的Prophet进行多时间序列预测的3种方法</a></li><li id="5c92" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://medium.com/p/four-oversampling-and-under-sampling-methods-for-imbalanced-classification-using-python-7304aedf9037" rel="noopener">使用Python实现不平衡分类的四种过采样和欠采样方法</a></li><li id="9815" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://medium.com/p/multivariate-time-series-forecasting-with-seasonality-and-holiday-effect-using-prophet-in-python-d5d4150eeb57" rel="noopener">利用Python中的Prophet进行具有季节性和假日效应的多元时间序列预测</a></li><li id="9432" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://medium.com/p/how-to-detect-outliers-data-science-interview-questions-and-answers-1e400284f6b4" rel="noopener">如何检测离群值|数据科学面试问答</a></li><li id="b584" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://medium.com/p/time-series-anomaly-detection-using-prophet-in-python-877d2b7b14b4" rel="noopener">利用Python中的Prophet进行时间序列异常检测</a></li></ul><h1 id="0170" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">参考</h1><ul class=""><li id="768a" class="lv lw it lb b lc nb lf nc li ny lm nz lq oa lu ma mb mc md bi translated"><a class="ae ky" href="https://docs.databricks.com/notebooks/widgets.html#use-widgets-with-run" rel="noopener ugc nofollow" target="_blank"> Databricks widgets文档</a></li><li id="a383" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://docs.databricks.com/data/data-sources/read-csv.html#read-file-in-any-language" rel="noopener ugc nofollow" target="_blank">关于读取任何语言文件的数据块文档</a></li><li id="6384" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://www.kaggle.com/competitions/g-research-crypto-forecasting/data" rel="noopener ugc nofollow" target="_blank"> Kaggle G-Research加密预测数据</a></li></ul><div class="ob oc gp gr od oe"><a href="https://medium.com/@AmyGrabNGoInfo/membership" rel="noopener follow" target="_blank"><div class="of ab fo"><div class="og ab oh cl cj oi"><h2 class="bd iu gy z fp oj fr fs ok fu fw is bi translated">通过我的推荐链接加入媒体-艾米GrabNGoInfo</h2><div class="ol l"><h3 class="bd b gy z fp oj fr fs ok fu fw dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="om l"><p class="bd b dl z fp oj fr fs ok fu fw dk translated">medium.com</p></div></div><div class="on l"><div class="oo l op oq or on os ks oe"/></div></div></a></div></div></div>    
</body>
</html>