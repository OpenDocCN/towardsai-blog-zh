<html>
<head>
<title>Non-Linear Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">非线性模型</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/non-linear-models-53e6ea42e207?source=collection_archive---------1-----------------------#2022-08-01">https://pub.towardsai.net/non-linear-models-53e6ea42e207?source=collection_archive---------1-----------------------#2022-08-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1cac" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">当公式看起来不错，但不利于分析时</h2></div><p id="56e1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这不是我第一个关于非线性模型的博客。事实上，如果你仔细阅读我的博客列表，你会发现我申请了其中的几个。就我个人而言，我喜欢非线性模型，因为它们有生物学基础，如果你的数据与该基础无关，那么进一步发展就会变得相当困难。和往常一样，<a class="ae lb" href="https://towardsdatascience.com/in-modelling-the-first-steps-are-the-hardest-a4250b80a0f2" rel="noopener" target="_blank">第一步是最难的</a>，没有什么比非线性模型更适合这个前提了。</p><p id="f0be" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我不会深入谈论非线性模型，但我会向你们简要展示我与另一位研究人员交给我的数据集的斗争。这是营养商业数据，所以我不能分享数据本身，但你可以看到我做了什么。此外，给我的公式超出了我的理解范围，但是我要展示的是，如果一个看起来完美的公式与数据拟合得太完美，它可能很难使用。</p><p id="ec03" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们从加载库和数据开始。这是来自小猪的数据，是跨时间测量的。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="a67f" class="ll lm iq lh b gy ln lo l lp lq">rm(list = ls())<br/>library(readr)<br/>library(nlstools)<br/>library(nlme)<br/>library(ggplot2)<br/>library(nls2)</span><span id="9b6c" class="ll lm iq lh b gy lr lo l lp lq">## new file from Theo<br/>Oral_data_for_Marc &lt;- read_delim("Oral data for Marc.csv", <br/>                                 ";", escape_double = FALSE, trim_ws = TRUE)<br/>data&lt;-Oral_data_for_Marc<br/>rm(Oral_data_for_Marc)<br/>data&lt;-data[, 1:3]<br/>data&lt;-data[complete.cases(data),]<br/>head(data);str(data)<br/>as.numeric(gsub(",", ".", gsub("\\.", "", data$D9std)))<br/>data$D9std &lt;- gsub(",", "", data$D9std)<br/>data$D9std &lt;- as.numeric(data$D9std)                          <br/>data$D9std&lt;-data$D9std/1000000000<br/>data$Big&lt;-as.factor(data$Big)</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi ls"><img src="../Images/4b3479866db24ba01ea30c93f03bcf2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jqgJ0XGKCoNv5Wvt-k60NA.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">每只小猪(<strong class="bd me">大</strong>)、时间和结果的数据感兴趣。</figcaption></figure><p id="2151" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，数据从一开始就不容易处理，尤其是结果。它是作为一个字符加载的，但是我不能当场生成一个数字，迫使我先做一些转换。</p><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mf"><img src="../Images/9df7283f36e16bf5d71194fa69c6de76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HfPS9U_xfUGUCxRFXxTdCg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">转换数据。</figcaption></figure><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="23f3" class="ll lm iq lh b gy ln lo l lp lq">ggplot(data, <br/>       aes(x=time, <br/>           y=D9std, <br/>           group=Big, <br/>           col=Big))+<br/>  geom_point()+<br/>  geom_line()+<br/>  theme_bw()+<br/>  labs(x="Time", <br/>       y="Value", <br/>       col="Pig" )</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mg"><img src="../Images/950302aeca27db466e9ba86d8aba9c3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QWT8QuYIg12K5G6Bz417Dw.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">绘制数据。我有九只小猪，显示跨时间(秒)的数据。大多数遵循一个独特的模式，但不是全部，这将给我们的非线性模型带来一些麻烦。</figcaption></figure><p id="a4de" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">不仅路径会导致问题，而且开始，这就是为什么我从数据中删除了几秒钟。让我们看看数据会是什么样子。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="3dd3" class="ll lm iq lh b gy ln lo l lp lq">datasub&lt;-data[data$time&gt;=30,];head(datasub)<br/>colnames(datasub)[2]&lt;-"x" # time called x<br/>colnames(datasub)[3]&lt;-"y" # D9std called y<br/>datasub$Big&lt;-NULL # not informative vector<br/>datasub&lt;-as.data.frame(datasub)<br/>datasub$y &lt;- gsub(",", "", datasub$y)                          <br/>datasub$y&lt;-as.numeric(datasub$y)<br/>head(data)<br/>head(datasub);str(datasub)<br/>plot(datasub$x, datasub$y)</span></pre><div class="lc ld le lf gt ab cb"><figure class="mh lt mi mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><img src="../Images/905a77aa5e25edfa5656032b3fccced1.png" data-original-src="https://miro.medium.com/v2/resize:fit:958/format:webp/1*ucYXTYoU0rZcyYU60wltqQ.png"/></div></figure><figure class="mh lt mn mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><img src="../Images/dda266ff35063066a2e70f89721938a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*Gh6MSykX_X3Eu6dTqrnf7A.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk mo di mp mq translated">老实说，也好不到哪里去。</figcaption></figure></div><p id="afd9" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，是时候看看公式了。正如我所说的，这是交给我的，我不知道怎么会有人想出这么复杂的公式。它真的很大，包括几个隔间。下面你会看到连接公式的方法，以及我如何测试它以确保我在r中正确地翻译了它。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="d269" class="ll lm iq lh b gy ln lo l lp lq">formulaExp&lt;-as.formula(y~P*(I(1-(exp(-(Ks*x))))^B)*(Ka*((exp(-(Ke*x)))-(exp(-(Ka*x))))/(Ka-Ke)))</span><span id="4be4" class="ll lm iq lh b gy lr lo l lp lq">f1&lt;-function(x, P, Ks,B, Ka, Ke){<br/>  P*(I(1-(exp(-(Ks*x))))^B)*(Ka*((exp(-(Ke*x)))-(exp(-(Ka*x))))/(Ka-Ke))}</span><span id="b27f" class="ll lm iq lh b gy lr lo l lp lq">f1(20, P=2.48, Ks=0.014, B=1.52, Ka=0.00059, Ke=0.00690)</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/e58fb72def17f8061f0fee9fc39f5e87.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*IG9TWm29zgkpmH8bhRwxLg.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">给出了一个合适的值。</figcaption></figure><p id="fa52" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">非线性回归建模的最大障碍是找到精确的值。因为非线性模型不是封闭的，所以搜索是迭代的。获取峰值的一种方法是绘制数据并叠加曲线的几个层次。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="9d5a" class="ll lm iq lh b gy ln lo l lp lq">plot(datasub$x, datasub$y)<br/>curve(f1(x, P=2.48, Ks=0.014, B=1.52, Ka=0.00059, Ke=0.00690), add=T, col="red") <br/>curve(f1(x, P=3.5, Ks=0.014, B=1.52, Ka=0.00059, Ke=0.00690), add=T, col="green") <br/>curve(f1(x, P=3.5, Ks=0.010, B=1.52, Ka=0.00059, Ke=0.00690), add=T, col="yellow") <br/>curve(f1(x, P=3.5, Ks=0.010, B=1.52, Ka=0.00050, Ke=0.00590), add=T, col="blue") <br/>curve(f1(x, P=3.5, Ks=0.010, B=1.42, Ka=0.00059, Ke=0.00690), add=T, col="orange") <br/>curve(f1(x, P=3.0, Ks=0.010, B=1.62, Ka=0.00080, Ke=0.0090), add=T, col="purple")</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi ms"><img src="../Images/e1be6524bf98e727601bb6fab3c60c01.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hznhURC3omYVMWjuQJahuw.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">这实际上看起来非常非常好！曲线以辉煌的方式跟随数据。虽然这个公式很复杂，但它却能创造奇迹。</figcaption></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mt"><img src="../Images/468b84706621cae9419b0530333a896e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XPnJRtQ_nLok6-SE4sw_sQ.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">检查每个参数的系数是否接近数据中的平均值的简单方法。这个练习是一个额外的检查，但是考虑到上面拟合的曲线，已经没有必要了。</figcaption></figure><p id="a76b" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">在R中，有一个非常好的包叫做<a class="ae lb" href="https://cran.r-project.org/web/packages/nlstools/nlstools.pdf" rel="noopener ugc nofollow" target="_blank"> NLStools </a>，它将帮助你查看数据并提供函数来预览你认为合适的系数。就像我之前说的，这个过程非常困难，与简单的线性回归或混合建模不同，合适的起始值是找到解决方案的关键。如果有的话。</p><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mu"><img src="../Images/18f8a87c6b77e2e4ace3df96e66b0bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7O4qLHjAkwL88GOOMdKYow.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">提供了残差平方和，如果不进行比较，这并不意味着太多。然而，考虑到规模，它仍然比你想要的多。</figcaption></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mv"><img src="../Images/f32a69d0f7d434c6895a2e0e61c95d52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O5mHFTXh0bGoBGJexSE8bA.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">属于预览过程的图片。该模型看起来不错，但高残差平方和是肯定要解释的。</figcaption></figure><p id="710a" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">到目前为止，我已经为这个公式提供了一个或几个场景。如果你知道去哪里找，这很好，但你经常不知道，所以最好进行网格搜索。这简单地意味着，你创建一个组合矩阵，然后让模型筛选到那个矩阵。</p><p id="dfcf" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">下面是网格的命令及其外观。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="5e3e" class="ll lm iq lh b gy ln lo l lp lq">grid.theo&lt;-expand.grid(list(P=seq(2, 4, by=0.1), <br/>                            Ks=seq(0.010, 0.020, by=0.01), <br/>                            B=seq(1.4, 1.6, by=0.01), <br/>                            Ka=seq(0.005,0.007,by=0.01),<br/>                            Ke=seq(0.006,0.008, by=0.01))) <br/>grid.theo</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mw"><img src="../Images/fdcc12a7be296a335f7cb6cdc6ff5cc1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w5HDyTNm6RYSDl_PgWVdkw.png"/></div></div></figure><p id="63f1" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然后，是时候将模型输入网格了。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="87ec" class="ll lm iq lh b gy ln lo l lp lq">mod1 &lt;- nls2(formulaExp,<br/>             data=datasub,<br/>             start = grid.theo, <br/>             algorithm = "brute-force")<br/>plot(mod1)<br/>nls2(formulaExp, data=datasub, start = mod1)</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/b01f906b6cda3c0c0aeee1b9fa00e442.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*kX3cqycWkAl_y0EMwsF7cA.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">我得到了很多错误。</figcaption></figure><p id="b876" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">然而，该模型确实产生了。您可以看到所选模型的公式、系数和残差平方和。它看起来比我从上次预览中获得的值高了很多。</p><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi my"><img src="../Images/d42b66f91b04b8cf8c8ad2ccc46d112c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wcB1fvOcRby_0uIJvZRTbQ.png"/></div></div></figure><p id="0802" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">现在，通过将网格搜索直接连接到模型，还有其他使用网格搜索的方法。在这里，你看到我又开始了。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="8b26" class="ll lm iq lh b gy ln lo l lp lq">f1_nls_fit &lt;- nls.multstart::nls_multstart(y ~ f1(x, P, Ks,B, Ka, Ke),data = datasub,<br/>lower=c(P=2, Ks=0.01, B=1.4, Ka=0.005, Ke=0.006),<br/>upper=c(P=4, Ks=0.02, B=1.6, Ka=0.007, Ke=0.008),<br/>start_lower = c(P=2, Ks=0.01, B=1.4, Ka=0.005, Ke=0.006),<br/>start_upper = c(P=4, Ks=0.02, B=1.6, Ka=0.007, Ke=0.008),<br/>iter = 500,supp_errors = "Y")</span><span id="9b5f" class="ll lm iq lh b gy lr lo l lp lq">summary(f1_nls_fit)<br/>plot(f1_nls_fit)</span><span id="592b" class="ll lm iq lh b gy lr lo l lp lq">plot_nls &lt;- function(nls_object, data) {<br/>  predframe &lt;- tibble(x=seq(from=min(datasub$x), to=max(datasub$x), <br/>                               length.out = 1024)) %&gt;%<br/>    mutate(ypred = predict(nls_object, newdata = list(x=.$x)))<br/>  ggplot(data, aes(x=x, y=y)) +<br/>    geom_point(size=3, alpha=0.5) +<br/>    geom_line(data = predframe, <br/>              aes(x=x, y=ypred), <br/>              col="red", lty=2)+<br/>    theme_bw()}</span><span id="9ad0" class="ll lm iq lh b gy lr lo l lp lq">plot_nls(f1_nls_fit, datasub)</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mr"><img src="../Images/48c7e5378c459b7694ac5f980b673a5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:772/format:webp/1*-oHNojS1g7UoS-JHlYW4pQ.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">残差标准误差现在低得多，收敛容易获得，我们有体面的系数。但是后来，我开始看标准误差，我开始担心。</figcaption></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mz"><img src="../Images/cd26ca9938a7138afa4ece52f447b53f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pnk1bntEmvk3hCy6uv6CYA.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">这显然不是你想看到的。</figcaption></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi na"><img src="../Images/25fb2772f9dfca4bc94131dac52fd7ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_7olEi6GkJrq719PycoeCQ.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">这也好不到哪里去。</figcaption></figure><p id="2a4e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们再试一次，改变控制措施，从一个单一的列表开始系数。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="4ebc" class="ll lm iq lh b gy ln lo l lp lq">control1&lt;-nls.control(maxiter=100, tol=1e-10, minFactor=1/100000000, warnOnly=T)</span><span id="9a4f" class="ll lm iq lh b gy lr lo l lp lq">regr.nls&lt;-nls(formulaExp,start=list(P=2.48, Ks=0.014, B=1.52, Ka=0.00059, Ke=0.00690),control=control1, data=datasub, trace=T)</span><span id="7ba1" class="ll lm iq lh b gy lr lo l lp lq">summary(regr.nls)<br/>overview(regr.nls)<br/>plotfit(regr.nls, smooth=T)</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/7bf9518ddd25a8474f4216a6739896c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*ILrM1lbdyAD1Ddjob8JwfA.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">也好不到哪里去。事实上，这个概述揭示了手头的问题。标准误差如此之大，是因为模型中的参数几乎相同。它们完全相关，这使得它们是多余的，并且模型不稳定。这不是你想要的，看起来完美的非线性公式现在变成了一个问题。</figcaption></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mz"><img src="../Images/a818efa591d1f5251a052320a73adcb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bvfkwmXbMKLClvRBNBHjbw.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">即使平均值看起来很好。</figcaption></figure><p id="1eec" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们仔细看看残差。</p><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi nc"><img src="../Images/b2eb1fa8967d44e4ac5475cda18143f9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-pGXNFJK0w_Ejgj9mBCyCQ.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">不错，但也不是很好。即使它是好的，我也不会保留这个公式，因为系数之间的完美相关性(多重共线性)确实是你需要尝试和避免的！</figcaption></figure><p id="6e99" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">显示系数之间相互联系的一个更好的方法是绘制等高线。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="32f8" class="ll lm iq lh b gy ln lo l lp lq">regr.cont1&lt;-nlsContourRSS(regr.nls) <br/>plot(regr.cont1)<br/>regr.conf1&lt;-nlsConfRegions(regr.nls,exp=4, length=20) <br/>plot(regr.conf1, bound=T)<br/>regr.nls.pro&lt;-profile(regr.nls)<br/>plot(regr.nls.pro)</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/c3946974dd8a0a9658a25d4e66466b22.png" data-original-src="https://miro.medium.com/v2/resize:fit:694/format:webp/1*rvdUbgcY8JSvMmZm8PCSXA.png"/></div></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi ne"><img src="../Images/accb13cdf9893eb8b1dace604c57fec3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4PDLrwDc76u3m0-3W3WMHA.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">对一些人来说，就像所有有T2 P T3的东西一样，这甚至是不可能的。对于那些可能的，我真的不知道是怎么回事。它看起来不体面，摸起来不体面，操作起来也不体面。</figcaption></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/e1202fc410215cd5b2f6033703773f47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1294/format:webp/1*A89QkWZXtsW_QmIx5_V3QA.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">这些功能也不喜欢他们所看到的。</figcaption></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/4b71a7c17b3a0e6a02932a23147c1572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*0TMACZ1TAHAk-BDCLxLLNg.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">这没用。如果我想看一下数据，我需要做更多的工作。</figcaption></figure><p id="c9a2" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">也许，是时候看看非线性回归的混合建模方面了。我们有多只猪，所以这应该是可能的，你们中那些记得第一幅图的人也记得不是每只猪都有相同的曲线。</p><p id="f039" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">我将转向<strong class="kh ir"> nlme包，</strong>，我以前非常依赖它，并开始将数据分组到一个<strong class="kh ir"> nlme </strong>喜欢的数据集中。</p><div class="lc ld le lf gt ab cb"><figure class="mh lt nh mj mk ml mm paragraph-image"><img src="../Images/5b0b38ec6bd8b6075c2baaaa1537d991.png" data-original-src="https://miro.medium.com/v2/resize:fit:606/format:webp/1*Nh24kk07hVss-n1lywRzwg.png"/></figure><figure class="mh lt ni mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><img src="../Images/aed1ca7532ca88c8ce84c7ed792da97c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*HBlI5UtY5ZBiBL_SUFMT8Q.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk nj di nk mq translated">将表中的数据分组并绘制。当然，不是每头猪都有相同的曲线。这就是非线性模型的问题所在，因为它们在盒子里有特殊的自由度。我感觉他们的盒子比数据要求的要小得多。</figcaption></figure></div><p id="d9a8" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们去吧！</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="aca6" class="ll lm iq lh b gy ln lo l lp lq">f1_nlme_fit &lt;- nlme(D9std ~ f1(time, P, Ks, B, Ka, Ke),<br/>                    data = data_grouped, <br/>                    fixed = P + Ks + B + Ka + Ke ~ 1, <br/>                    random = P ~ 1, <br/>                    groups = ~ Big, <br/>                    start = c(P=2.48, Ks=0.014, B=1.52, Ka=0.00059,  <br/>                    Ke=0.00690),verbose = F)</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/058c1db267f9c8e21a4ce2f811e7d4e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1106/format:webp/1*eaXz5ZanYG_MzYfhJlkedA.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">不起作用。</figcaption></figure><p id="e361" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">这让我回到了前一段时间的原始概述，向我展示了严重的相关性。这是行不通的，公式太严格了！由于我不知道它是如何组成的，我决定去寻找一个完全不同的模型。一个以生物学解释为代价给我更多自由的世界。</p><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/e9301ad1b670ae094ff88bd0e8a123f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*mCtVNVInv0TYLv3Lv3ddNA.png"/></div></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/cb1c783c489db33a7eec1426dd8d53c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*pR2vPJmlOqWXLZGLaSVisA.png"/></div></figure><p id="9584" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">一般加性混合模型-使用时间作为样条曲线，但仍保留分组数据集。但是，如果不指定模型中指定的层次，什么都不会发生。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="2a29" class="ll lm iq lh b gy ln lo l lp lq">gamm_fit&lt;-mgcv::gamm(D9std~s(time), data=data_grouped)<br/>plot(gamm_fit$gam,pages=1)<br/>summary(gamm_fit$lme) <br/>summary(gamm_fit$gam) <br/>anova(gamm_fit$gam) <br/>par(mfrow = c(2, 2))<br/>mgcv::gam.check(gamm_fit$gam)</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi mz"><img src="../Images/0c16224f15d168ad5b2ab1586abd2920.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hsiST3xfH-_JwpHoUUM50A.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">均值曲线看起来不错，但置信带却很吓人。欢迎来到数据中有高方差和一些奇怪曲线的后果。</figcaption></figure><p id="df4f" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">以及<strong class="kh ir"> lme </strong>(混动车型)部分的<a class="ae lb" href="https://www.rdocumentation.org/packages/mgcv/versions/1.8-40/topics/gamm" rel="noopener ugc nofollow" target="_blank"> <strong class="kh ir"> gamm </strong> </a> <strong class="kh ir"> </strong>功能。</p><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi no"><img src="../Images/9b9e5c25ce8dcb94f90ab7ed6ba2529c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1356/format:webp/1*TMue2Uko-AdOHWqNLlYkaw.png"/></div></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi np"><img src="../Images/e905b1763da93f25829482110522fd33.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*DC2L4uOWtgnFQl24TnL9Vg.png"/></div></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi nq"><img src="../Images/8e9b6fe444c1a51b1679c5b7d06fcbf1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SclZHBwNxWYNIIsMgFMuNw.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">残差清楚地显示了模型是如何失去对数据的控制的。太多的差异，太多的传播没有多大用处。</figcaption></figure><p id="4e13" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们通过添加一个随机截距来合并模型中的层次结构。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="3eff" class="ll lm iq lh b gy ln lo l lp lq">gamm_fit2&lt;-mgcv::gamm(D9std~s(time),<br/>                      data=data_grouped,<br/>                      random=list(Big=~1))<br/>plot(gamm_fit2$gam,pages=1)<br/>big &lt;- data_grouped$Big<br/>rm(big)<br/>par(mfrow = c(2, 2))<br/>mgcv::gam.check(gamm_fit2$gam)</span></pre><div class="lc ld le lf gt ab cb"><figure class="mh lt nr mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><img src="../Images/4d2489f7b6d1292ffcf8925ab370ef95.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*-9Z7LIqUCc4Fg9c2u32W_g.png"/></div></figure><figure class="mh lt ns mj mk ml mm paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><img src="../Images/8e6bcafe723cf44269fbd2c029745387.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*p-0C2cD_qBzZe_yeYo0iqg.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk nt di nu mq translated">老实说，什么都没有改变。正如所料，差异并不是一开始就有的。</figcaption></figure></div><p id="8173" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">让我们添加一个随机的斜率。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="852a" class="ll lm iq lh b gy ln lo l lp lq">gamm_fit2.1&lt;-mgcv::gamm(D9std~s(time),<br/>                      data=data_grouped,<br/>                      random=list(Big=~time))<br/>anova(gamm_fit$lme, gamm_fit2$lme, gamm_fit2.1$lme)</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/bd7c7cb96eaa50d335a146a8fc88be77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*lo1TeIpeOfC9k1Jxdcc-Qg.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">现在，令人惊讶的是，随机斜率并没有好到哪里去。事实上，随机截距确实优于均值模型，但随机斜率则不然。因此，本着想要有一个<strong class="bd me">简约</strong>模型的想法，我们将选择AIC /似然比。</figcaption></figure><p id="75be" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后但同样重要的是，我想检查我做的模型是否有意义。过度拟合总是一个问题，由于我已经失去了非线性函数的生物学相关性，我想至少确保这个数据驱动的模型正在寻找正确的东西。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="2d83" class="ll lm iq lh b gy ln lo l lp lq">pred&lt;-fitted(gamm_fit2$lme);pred<br/>pred&lt;-fitted(gamm_fit2$gam);pred</span><span id="f5f3" class="ll lm iq lh b gy lr lo l lp lq">data_grouped$pred&lt;-pred<br/>ggplot(data_grouped, <br/>       aes(x=time))+<br/>  geom_point(aes(y=D9std))+<br/>  geom_point(aes(y=pred), col="red")+<br/>  geom_line(aes(y=pred), col="red", lty=2)+<br/>  theme_bw()+<br/>  facet_wrap(~Big)</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/8cc6bbe4031c1b3a65409ced003a701e.png" data-original-src="https://miro.medium.com/v2/resize:fit:582/format:webp/1*885wvHbNgmac1aWMNiOU_A.png"/></div></figure><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi nx"><img src="../Images/da1acdc4c8c9ca5aff4b5e470a460300.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yNpfApoS6Zg7qqKTOWZ58A.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">看起来是的！当然，每头猪的曲线都是不同的，在某种程度上，这些曲线确实遵循了数据。然而，对于这样的数据集，这样的方差，只有<strong class="bd me">时间</strong>是不行的。</figcaption></figure><p id="75dc" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">最后一次检查是为特定的猪创建完整的时间路径。</p><pre class="lc ld le lf gt lg lh li lj aw lk bi"><span id="9549" class="ll lm iq lh b gy ln lo l lp lq">df&lt;-data.frame(time = seq(0,5000, 1),Big  = "15")<br/>rand_big&lt;-ranef(gamm_fit2$lme, level=2)<br/>df$pred&lt;-rand_big$`(Intercept)`[2] + mgcv::predict.gam(gamm_fit2$gam,df)<br/>ggplot(df, <br/>       aes(x=time))+<br/>  geom_line(aes(y=pred), col="red", lty=2)+<br/>  geom_point(data=data_grouped[data_grouped$Big=="15", ], <br/>             aes(x=time, y=D9std), col="black")+<br/>    theme_bw()</span></pre><figure class="lc ld le lf gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi ny"><img src="../Images/02ef8609b26a30273582ce1db8d0970b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hwfmPOXyoQHRovYMAezaXw.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">看起来也不错。</figcaption></figure><p id="6c3e" class="pw-post-body-paragraph kf kg iq kh b ki kj jr kk kl km ju kn ko kp kq kr ks kt ku kv kw kx ky kz la ij bi translated">所以，我希望你喜欢这个小帖子。别忘了，做模特并不容易。这就是为什么它很有趣！</p></div></div>    
</body>
</html>