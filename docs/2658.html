<html>
<head>
<title>Installing Tensorflow on Mac M1 Pro &amp; M1 Max</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Mac M1专业版和M1 Max上安装Tensorflow</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/installing-tensorflow-on-mac-m1-pro-m1-max-2af765243eaa?source=collection_archive---------0-----------------------#2022-04-03">https://pub.towardsai.net/installing-tensorflow-on-mac-m1-pro-m1-max-2af765243eaa?source=collection_archive---------0-----------------------#2022-04-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><p id="600f" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">在普通的Mac M1上也能工作！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/042da65d677de531684b64b061c1ce0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*qbYX6vMhngopv34T"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@sapiton?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">米恰伊尔·萨皮顿</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="b21a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">苹果公司的M1芯片<strong class="js iu">的出现彻底改变了MacOS社区的深度学习领域。M1芯片包含一个内置的图形处理器，支持<strong class="js iu"> GPU加速</strong>。这反过来使得苹果电脑适合深度学习任务。</strong></p><p id="8a77" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">一年后，苹果发布了新的M1变种。这些被称为<strong class="js iu"> M1专业</strong>和<strong class="js iu"> M1最大</strong>。它们远远优于最初的M1版本，其中M1 Max是最好的:它有更多的CPU和GPU核心，因此比它的对手更快。</p><p id="0bd5" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">苹果的这一突破是至关重要的:它允许MacOS粉丝留在他们最喜欢的苹果生态系统中，同时专注于深度学习，而不必选择其他替代品——基于英特尔的芯片或Colab。</p><blockquote class="lf lg lh"><p id="b10b" class="jq jr li js b jt ju jv jw jx jy jz ka lj kc kd ke lk kg kh ki ll kk kl km kn im bi translated"><em class="it">你可以从</em> <a class="ae le" href="https://medium.com/@nikoskafritsas/list/setup-apple-m1-for-deep-learning-75e74b9f7cb4" rel="noopener"> <em class="it">这里</em> </a> <em class="it">访问“为深度学习设置苹果M-Silicom”系列的所有文章，包括如何在Mac M1上安装Pytorch的指南</em> <a class="ae le" href="https://betterprogramming.pub/how-to-install-pytorch-on-apple-m1-series-512b3ad9bc6" rel="noopener ugc nofollow" target="_blank"> <em class="it">。</em> </a></p></blockquote><p id="e200" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">当然，我们不能在谈论深度学习的采用时不提到目前最流行的深度学习框架之一:<strong class="js iu"> Tensorflow </strong>！本文提供了如何在M1专业版上安装Tensorflow的详细指南。<strong class="js iu">该指南也适用于M1的其他变体。</strong></p><h2 id="339f" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated"><strong class="ak">要求</strong></h2><ol class=""><li id="01ce" class="mf mg it js b jt mh jx mi kb mj kf mk kj ml kn mm mn mo mp bi translated"><strong class="js iu"> Tensorflow金属插件</strong>只适用于<strong class="js iu"> MacOS 12.0+ </strong> (Monterey)。一些用户可以通过使用以前的<code class="fe mq mr ms mt b">tensorflow-metal</code>版本(例如<code class="fe mq mr ms mt b">0.1.2</code>)在Big Sur上安装它。然而，你不会注意到在CPU上的传统训练有任何速度上的提高。</li><li id="fcb1" class="mf mg it js b jt mu jx mv kb mw kf mx kj my kn mm mn mo mp bi translated">你至少要使用<code class="fe mq mr ms mt b">Python 3.9.0</code>。</li></ol><h1 id="83a9" class="mz ln it bd lo na nb nc lr nd ne nf lu ng nh ni lx nj nk nl ma nm nn no md np bi translated">步骤1:安装Xcode</h1><p id="6e98" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb nq kd ke kf nr kh ki kj ns kl km kn im bi translated">现在大部分Macbooks都预装了<strong class="js iu"> Xcode </strong>。或者，你可以很容易地从应用商店下载它。之后，你还应该安装<em class="li"> Xcode命令行工具</em>。为此，请执行以下命令:</p><pre class="kp kq kr ks gt nt mt nu nv aw nw bi"><span id="4040" class="lm ln it mt b gy nx ny l nz oa">$ xcode-select --install</span></pre><h1 id="ca29" class="mz ln it bd lo na nb nc lr nd ne nf lu ng nh ni lx nj nk nl ma nm nn no md np bi translated">步骤2:安装MiniForge</h1><p id="5bd3" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb nq kd ke kf nr kh ki kj ns kl km kn im bi translated">对于不知道的人来说，<strong class="js iu"> MiniForge </strong>是一个conda安装程序，类似于MiniConda。此外，MiniForge是苹果友好的，这使它成为MacOS，包括M1设备的理想候选。</p><p id="be4b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要下载它，请进入此<a class="ae le" href="https://github.com/conda-forge/miniforge" rel="noopener ugc nofollow" target="_blank">页面</a>并选择苹果芯片的安装程序，如下图所示:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ob"><img src="../Images/053a1523023b71e0fa5f05540c1c4aed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*7U0VjBeQZoen8icOLZhChw.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图1:适用于苹果芯片的conda Miniforge封装(<a class="ae le" href="https://github.com/conda-forge/miniforge" rel="noopener ugc nofollow" target="_blank">来源</a>)</figcaption></figure><p id="0d5a" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要安装它，请执行:</p><pre class="kp kq kr ks gt nt mt nu nv aw nw bi"><span id="4c61" class="lm ln it mt b gy nx ny l nz oa">$ bash Miniforge3-MacOSX-arm64.sh</span></pre><p id="f4d2" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">注1: </strong>这是最简单的安装过程。你不必涉及自制软件或定制下载脚本(这些通常都有问题)。</p><p id="8a5d" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">注2: </strong>值得一提的是，在一个给定的时间内，只有一个conda发行版，例如Anaconda或MiniConda可以“运行”。如果你已经有一个预先存在的conda安装，没有必要卸载它来使用MiniForge。这篇<a class="ae le" href="https://betterprogramming.pub/switching-between-multiple-conda-distributions-on-macos-b78b6b21720" rel="noopener ugc nofollow" target="_blank">文章</a>描述了一个可以帮助你同时管理许多conda发行版的技巧！</p><h1 id="16f0" class="mz ln it bd lo na nb nc lr nd ne nf lu ng nh ni lx nj nk nl ma nm nn no md np bi translated">步骤3:设置conda环境并安装MiniForge</h1><p id="eb20" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb nq kd ke kf nr kh ki kj ns kl km kn im bi translated">现在，让我们在MiniForge中创建一个新的conda环境，比如说<em class="li"> tensorflow_silicon。</em>根据官方指南，我们至少应该使用<em class="li">python 3 . 9 . 0版本</em>。不要忘记激活它:</p><pre class="kp kq kr ks gt nt mt nu nv aw nw bi"><span id="8373" class="lm ln it mt b gy nx ny l nz oa">$ conda create --name <em class="li">tensorflow_silicon</em> python=3.9<br/>$ conda activate <em class="li">tensorflow_silicon</em></span></pre><p id="63fb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然后，安装<code class="fe mq mr ms mt b">tensorflow-macos</code>底座和<code class="fe mq mr ms mt b">tensorflow-metal</code> <em class="li"> </em>插件:</p><pre class="kp kq kr ks gt nt mt nu nv aw nw bi"><span id="3aa5" class="lm ln it mt b gy nx ny l nz oa">$ conda install -c apple tensorflow-deps<br/>$ pip install tensorflow-macos<br/>$ pip install tensorflow-metal</span></pre><p id="71ed" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">之后，安装Jupyter笔记本或Jupyter lab:</p><pre class="kp kq kr ks gt nt mt nu nv aw nw bi"><span id="5d3f" class="lm ln it mt b gy nx ny l nz oa">$ conda install -c conda-forge jupyter jupyterlab</span></pre><p id="e662" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">就是这样！</p><p id="d1eb" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">执行下面的代码片段，检查一切是否如预期进行。您可以使用命令行或Jupyter:</p><pre class="kp kq kr ks gt nt mt nu nv aw nw bi"><span id="fb14" class="lm ln it mt b gy nx ny l nz oa">import tensorflow as tf<br/>tf.__version__<br/>tf.config.list_physical_devices()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oc"><img src="../Images/9147eac4698aa498a1be46fa3970402e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cx6nZeoL_zpbQufyG90kkw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图2: Jupyter代码片段</figcaption></figure><p id="2b79" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果一切顺利，您应该在设备列表中看到GPU。换句话说，<strong class="js iu"> Tensorflow有权限访问GPU！</strong></p><p id="52b6" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">最后，运行一个使用MNIST数据集的简单示例来检查一切是否正常:</p><pre class="kp kq kr ks gt nt mt nu nv aw nw bi"><span id="5d79" class="lm ln it mt b gy nx ny l nz oa">import tensorflow as tf<br/>mnist = tf.keras.datasets.mnist</span><span id="c7c0" class="lm ln it mt b gy od ny l nz oa">(x_train, y_train), (x_test, y_test) = mnist.load_data()<br/>x_train, x_test = x_train / 255.0, x_test / 255.0</span><span id="ac58" class="lm ln it mt b gy od ny l nz oa">model = tf.keras.models.Sequential([<br/> tf.keras.layers.Flatten(input_shape=(28, 28)),<br/> tf.keras.layers.Dense(128, activation=’relu’),<br/> tf.keras.layers.Dropout(0.2),<br/> tf.keras.layers.Dense(10)<br/>])</span><span id="6db3" class="lm ln it mt b gy od ny l nz oa">loss_fn = tf.keras.losses.SparseCategoricalCrossentropy(from_logits=True)</span><span id="5185" class="lm ln it mt b gy od ny l nz oa">model.compile(optimizer=’adam’,<br/> loss=loss_fn,<br/> metrics=[‘accuracy’])</span><span id="eae0" class="lm ln it mt b gy od ny l nz oa">model.fit(x_train, y_train, epochs=10)</span></pre></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="cf07" class="mz ln it bd lo na ol nc lr nd om nf lu ng on ni lx nj oo nl ma nm op no md np bi translated">常见问题和解决方法</h1><h2 id="ce90" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">1.安装tensorflow-deps(例如grpcio包)时出现问题</h2><p id="86a1" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb nq kd ke kf nr kh ki kj ns kl km kn im bi translated">有些依赖项并不是真正必要的，因此您可以放心地忽略它们。因此，如果你遇到任何困难，安装<code class="fe mq mr ms mt b">tensorflow-deps</code>没有依赖:</p><pre class="kp kq kr ks gt nt mt nu nv aw nw bi"><span id="d545" class="lm ln it mt b gy nx ny l nz oa">$ <!-- -->pip install tensorflow-macos --no-dependencies</span></pre><h2 id="b51d" class="lm ln it bd lo lp lq dn lr ls lt dp lu kb lv lw lx kf ly lz ma kj mb mc md me bi translated">2.不正确的数字版本</h2><p id="6657" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb nq kd ke kf nr kh ki kj ns kl km kn im bi translated">在某些情况下，<code class="fe mq mr ms mt b">tensorflow-deps</code>的安装会获取不兼容的非conda-forge NumPy版本。当您尝试导入Numpy时会遇到此错误。您将看到类似这样的内容:</p><pre class="kp kq kr ks gt nt mt nu nv aw nw bi"><span id="8d82" class="lm ln it mt b gy nx ny l nz oa">IMPORTANT: PLEASE READ THIS FOR ADVICE ON HOW TO SOLVE THIS ISSUE!</span><span id="5402" class="lm ln it mt b gy od ny l nz oa">Importing the numpy C-extensions failed. This error can happen for</span><span id="c7ca" class="lm ln it mt b gy od ny l nz oa">many reasons</span></pre><p id="a31c" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">要解决这个问题，请安装<code class="fe mq mr ms mt b">openblas</code>包:</p><pre class="kp kq kr ks gt nt mt nu nv aw nw bi"><span id="e167" class="lm ln it mt b gy nx ny l nz oa">$ conda install -c conda-forge openblas</span></pre><h1 id="6abd" class="mz ln it bd lo na nb nc lr nd ne nf lu ng nh ni lx nj nk nl ma nm nn no md np bi translated">注意事项</h1><ul class=""><li id="495e" class="mf mg it js b jt mh jx mi kb mj kf mk kj ml kn oq mn mo mp bi translated">MiniForge是一个很好的conda环境，但是它并不与每个conda库兼容。不要担心，这只是很小的一部分，随着MiniForge社区的发展，这一比例很可能会降低。因此，为“棘手”的情况保留一个单独的Anaconda或Miniconda环境是个好主意。</li><li id="a7b0" class="mf mg it js b jt mu jx mv kb mw kf mx kj my kn oq mn mo mp bi translated">你应该使用<code class="fe mq mr ms mt b">conda-forge</code>通道安装每一个python库，即使你可以在官方的conda通道找到它们。这保证了MiniForge conda环境的一致性。</li></ul></div><div class="ab cl oe of hx og" role="separator"><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj ok"/><span class="oh bw bk oi oj"/></div><div class="im in io ip iq"><h1 id="af67" class="mz ln it bd lo na ol nc lr nd om nf lu ng on ni lx nj oo nl ma nm op no md np bi translated"><strong class="ak">结束语</strong></h1><p id="32fc" class="pw-post-body-paragraph jq jr it js b jt mh jv jw jx mi jz ka kb nq kd ke kf nr kh ki kj ns kl km kn im bi translated">毫无疑问，MacOS通过让Tensorflow有资格获得原生GPU加速，拥抱了深度学习。</p><p id="486b" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">然而，还有很长的路要走。例如，Python并不被广泛接受，尽管你可以在苹果芯片上运行Pytorch。</p><p id="8dd8" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated">如果你是MacOS的粉丝，请随意查看所有苹果芯片相关文章的列表:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><a href="https://medium.com/@nikoskafritsas/list/setup-apple-msilicon-for-deep-learning-75e74b9f7cb4"><div class="gh gi or"><img src="../Images/2d822c3a1bf7bd7433e5c1c3d3b09d94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1358/format:webp/1*4KDFfO6VLtPKx5UPcVyD8g.png"/></div></a></figure><p id="4362" class="pw-post-body-paragraph jq jr it js b jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn im bi translated"><strong class="js iu">感谢阅读！</strong></p></div></div>    
</body>
</html>