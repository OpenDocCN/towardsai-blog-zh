<html>
<head>
<title>Monitoring Machine Learning Models</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">监控机器学习模型</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/monitoring-machine-learning-models-43c44397256c?source=collection_archive---------1-----------------------#2021-06-12">https://pub.towardsai.net/monitoring-machine-learning-models-43c44397256c?source=collection_archive---------1-----------------------#2021-06-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="cc0a" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a></h2><div class=""/><div class=""><h2 id="65ba" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">学习理解机器学习模型在生产中性能下降的根本原因</h2></div><p id="0db3" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">你会学到的</p><ul class=""><li id="4e13" class="ln lo it kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated">为什么ML模型部署后会降级？</li><li id="fd8e" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">数据漂移和概念漂移的区别</li><li id="b70c" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">处理模型退化的不同技术</li></ul><p id="f2a5" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> <em class="mb">你用出色的性能指标训练了一个ML模型，然后将其部署到生产中。该模型在生产中运行了一段时间，但是您的用户最近观察到该模型不能预测可靠的结果。</em>T5】</strong></p><p id="345d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><em class="mb">这个模型一定是怎么回事？是模型有问题，还是生产中的数据是根本原因？</em></p><p id="6d43" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">我们在机器学习/深度学习模型的训练过程中提供数据和结果。ML模型在训练期间学习数据模式。学习的ML模型在部署到生产中之后，预测来自相同问题域的看不见的数据。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/8aa95906c9d0237216ba2fe65d0e7c12.png" data-original-src="https://miro.medium.com/v2/resize:fit:822/format:webp/1*TEVaDqJbL8Zar655Y--VlA.png"/></div></figure><p id="cf7a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> <em class="mb">什么会导致部署模型的性能下降？</em>T11】</strong></p><p id="cb3a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">数据是机器学习模型的氧气，由于业务的动态行为，数据会不断变化。由于输入数据的变化，部署的机器学习模型的性能可能会下降。</p><p id="9fb4" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">以下原因可能会导致数据发生变化</p><ul class=""><li id="175b" class="ln lo it kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><strong class="kt jd">为训练和推理收集数据的方式发生变化</strong>。收集数据的不同环境导致训练数据集不同于推断数据。这也被称为<strong class="kt jd">偏斜。</strong></li><li id="14f9" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt jd">季节性等因素导致的数据趋势变化，</strong>训练数据可能未能捕捉到数据中所有可能的季节性，或【COVID、气候变化等未知事件导致的数据趋势变化。市场趋势的变化，或新技术的变化，如新产品或应用程序的推出，客户消费模式的变化等。</li></ul><p id="74cf" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">因此，模型会因为两个原因而降级</p><ul class=""><li id="4489" class="ln lo it kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><strong class="kt jd">训练和发球之间的数据发生了变化，称为数据漂移</strong></li><li id="502e" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt jd">模型在训练过程中学习到的规则或数据模式可能已经更新，称为概念漂移</strong></li></ul><h2 id="2a55" class="mk ml it bd mm mn mo dn mp mq mr dp ms la mt mu mv le mw mx my li mz na nb iz bi translated">数据漂移:<strong class="ak">训练数据和发球</strong>之间的投入数据分布<strong class="ak">差异</strong></h2><ul class=""><li id="e379" class="ln lo it kt b ku nc kx nd la ne le nf li ng lm ls lt lu lv bi translated"><strong class="kt jd">自变量P(X)的分布发生变化时的数据漂移。</strong></li><li id="fdf9" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt jd">训练数据</strong>中不存在的因变量发生变化时的数据漂移。</li><li id="238b" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated">当模式在训练和服务之间改变时，会发生模式偏斜。一个字符串变量突然变成了int。</li></ul><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/7f32aa38a83c108caec17cb8cf8bcb29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*ET-lPW0aWLOpJZBPUAlOoA.png"/></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">数据漂移</figcaption></figure><p id="715d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">数据集偏移是指数据随着时间推移而发生偏移。这里，对于训练数据集和服务数据集，输入和输出要素的联合概率是不同的。</strong></p><p id="9d10" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">协变量偏移是指训练数据集和服务数据集之间的输入变量分布发生变化。</strong></p><p id="8ebc" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">例如，预测产品的库存可能会因COVID等意外事件而改变。这将导致模型性能下降，除非模型的训练数据得到更新。</p><h2 id="aba3" class="mk ml it bd mm mn mo dn mp mq mr dp ms la mt mu mv le mw mx my li mz na nb iz bi translated">概念漂移:学习到的规则或数据模式发生了变化，或者概念的含义随着时间的推移发生了变化</h2><ul class=""><li id="7f38" class="ln lo it kt b ku nc kx nd la ne le nf li ng lm ls lt lu lv bi translated"><strong class="kt jd">当输入数据和结果之间的关系在一段时间内发生变化时，就会出现概念漂移。</strong></li><li id="29f7" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt jd">模型在训练期间学习的数据模式P(Y|X)已经改变</strong></li><li id="a254" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt jd">由于观察到的、看不见的或不确定的数据变化，数据模式发生变化。</strong></li><li id="ceaa" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt jd">概念漂移是关于目标变量或地面真值标签的变化。</strong></li><li id="0004" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt jd">概念漂移是数据多样性的结果，这种多样性在用于训练模型的数据中没有被捕获</strong></li></ul><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/740e379eb3f82539d27f0663b2cbf3d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:462/format:webp/1*jONZZRUwbWT9O8c6JFszpQ.png"/></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">概念漂移</figcaption></figure><p id="0a81" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">比如你在猫和狗身上训练了ML模型，为了推理，你还在提供猫和狗的图像，但是模型在预测猫和狗的时候不一致。在分析您的错误结果后，您观察到ML模型仅在棕色狗和灰色猫上训练。你看不见的图像有黑色或白色的猫和狗；猫/狗图像的数据现在已经改变了特征。这就是<strong class="kt jd">概念漂移</strong></p><p id="17b9" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">数据的变化或数据模式的变化可能恰好是</strong></p><ul class=""><li id="cbfd" class="ln lo it kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><strong class="kt jd">突如其来的</strong>就像COVID改变了客户的消费数据模式，</li><li id="4b39" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt jd">缓慢</strong>喜欢采用新技术</li><li id="a7e4" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt jd">周期性变化</strong>如季节性</li></ul><h2 id="76c4" class="mk ml it bd mm mn mo dn mp mq mr dp ms la mt mu mv le mw mx my li mz na nb iz bi translated">处理模型退化的不同技术</h2><ul class=""><li id="b60e" class="ln lo it kt b ku nc kx nd la ne le nf li ng lm ls lt lu lv bi translated"><strong class="kt jd">经常训练模型</strong>:这种技术可以处理<strong class="kt jd">数据随时间的逐渐变化，也有助于数据的周期性变化</strong>。这是处理模型退化的最简单和最容易的方法。<strong class="kt jd">训练数据可以是旧训练数据和作为实时推理的一部分捕获的新数据</strong>的加权百分比，其中我们可以给予<strong class="kt jd">更多权重给最近的数据</strong>。</li><li id="e241" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt jd">在线学习</strong>:用于评估数据流的概念漂移，其中数据是动态生成的。在这种情况下，使用Kolmogorov-Smirnov测试检查传入的数据分布是否不同于先前的数据分布。Kolmogorov-Smirnov算法，这是一种为随时间逐渐变化的样本重新计算KS统计量的更快方法</li><li id="def6" class="ln lo it kt b ku lw kx lx la ly le lz li ma lm ls lt lu lv bi translated"><strong class="kt jd">监控生产中的车型表现</strong>:</li></ul><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi nn"><img src="../Images/927c24184404ab8d1db1060bb75509b2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n43xo5RxmQMX-tMi828SmQ.png"/></div></div></figure><p id="5506" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">监控生产中的模型性能，将实时模型性能与测试/验证数据集上的性能进行比较；如果性能差异大于阈值，则触发模型的重新训练。用于重新训练模型的数据应该包含旧的训练数据和实时推断数据。这种技术可以处理数据模式的任何突然变化、缓慢的数据变化以及任何周期性的数据变化。</p><ul class=""><li id="3f80" class="ln lo it kt b ku kv kx ky la lp le lq li lr lm ls lt lu lv bi translated"><strong class="kt jd">使用</strong>分布度量，如<strong class="kt jd"> KL-散度</strong>、<strong class="kt jd">推土机距离</strong>和<strong class="kt jd">海灵格距离，监控输入特征的漂移。</strong></li></ul><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="no np di nq bf nr"><div class="gh gi ns"><img src="../Images/178a95b5338d5557123ab3977ce68751.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q9kwrDsoBNUnR4fooLNvfg.png"/></div></div></figure><p id="76e2" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">使用KL-Divergence或运土机距离(EMD)或Hellinger距离连续监控训练数据集和实时推理数据集之间的输入特征变化。如果输入特征之间存在显著差异，则触发模型的重新训练。这种技术可以处理数据模式的任何突然变化、缓慢的数据变化以及任何周期性的数据变化。</p><h2 id="1fb7" class="mk ml it bd mm mn mo dn mp mq mr dp ms la mt mu mv le mw mx my li mz na nb iz bi translated">结论:</h2><p id="5a5c" class="pw-post-body-paragraph kr ks it kt b ku nc kd kw kx nd kg kz la nt lc ld le nu lg lh li nv lk ll lm im bi translated">业务中数据和数据模式的变化是唯一不变的事情。随着时间的推移，定型和服务之间的数据和数据模式变化会降低模型的性能，从而导致性能不稳定，降低模型的可靠性。持续监控实时模型在生产中的性能对于检测数据漂移和概念漂移至关重要，以确保模型在一段时间内处理不断变化的数据和数据模式的可靠性。</p><h2 id="d56c" class="mk ml it bd mm mn mo dn mp mq mr dp ms la mt mu mv le mw mx my li mz na nb iz bi translated">参考资料:</h2><p id="8b77" class="pw-post-body-paragraph kr ks it kt b ku nc kd kw kx nd kg kz la nt lc ld le nu lg lh li nv lk ll lm im bi translated"><a class="ae nw" href="https://www.kdd.org/kdd2016/papers/files/rpp0427-dos-reisA.pdf" rel="noopener ugc nofollow" target="_blank">使用增量Kolmogorov-Smirnov测试的快速无监督在线漂移检测——丹尼斯·多斯·雷斯、古斯塔沃·巴蒂斯塔、彼得·弗拉克、斯坦·马特温</a></p><p id="a8d7" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><a class="ae nw" href="https://neptune.ai/blog/concept-drift-best-practices" rel="noopener ugc nofollow" target="_blank">https://neptune.ai/blog/concept-drift-best-practices</a></p></div></div>    
</body>
</html>