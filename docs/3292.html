<html>
<head>
<title>Set Operations on Python DataFrames</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python数据帧上的集合操作</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/set-operations-on-python-dataframes-49116cfb283d?source=collection_archive---------3-----------------------#2022-11-08">https://pub.towardsai.net/set-operations-on-python-dataframes-49116cfb283d?source=collection_archive---------3-----------------------#2022-11-08</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="88d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们经常执行join、union、difference、intersection等。python数据帧之间的操作。在我的数据科学之旅中，理解集合论的概念帮助我高效地执行这些任务。在这篇文章中，我想用集合论来实现数据帧操作。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/6656108461d7674f47356dcaf4b96c25.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*7R-WgGD8V260ihPm"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">泰勒·拉斯托维奇在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><blockquote class="lc ld le"><p id="829c" class="jn jo lf jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated"><strong class="jp ir"> <em class="iq">讨论的话题！</em> </strong></p><p id="73de" class="jn jo lf jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated">1.“集合论”和“维恩图”的基础知识<br/> 2。在数据帧<br/> 3上设置操作。结论</p></blockquote><h2 id="376e" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">1.“集合论”和“维恩图”的基础知识</h2><p id="5edf" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">我们在数学和概率论中广泛使用集合和集合论。一个简单的定义是，<em class="lf">集合是元素的集合，其中元素的顺序无关紧要</em>。集合的概念也在python中使用，通常称为数据类型集合。</p><p id="5a8d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在python中，集合与列表非常相似，除了它们的元素是<em class="lf">不可变的</em>(这意味着一旦声明，就不能更改/改变集合的元素)。但是，您可以在集合中添加/移除元素。一个集合可以包含不同数据类型的元素。一套可以；</p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="764f" class="lj lk iq mi b gy mm mn l mo mp">mySet = set(("Theory", "Mathematics", 214, 3.14, (1,0,0,1)))</span></pre><p id="b6d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们用维恩图来形象化这些集合。在集合运算部分，我们将看到如何使用它们。</p><h2 id="124b" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">2.数据帧上的集合操作</h2><p id="d314" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">让我们考虑两个简单的数据框架来演示集合运算的逻辑</p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="af31" class="lj lk iq mi b gy mm mn l mo mp">df1 = pd.DataFrame({'price': [10,20,30,40,50,60],'quantity': [100,200,300,400,500,600], 'margin%': [1,2,3,4,5,6]})</span><span id="4c87" class="lj lk iq mi b gy mq mn l mo mp">df2 = pd.DataFrame({'price': [10,20,30,40,50,60],'quantity': [120,200,300,400,520,620], 'margin%': [7,2,3,6,11,12]})</span></pre><p id="cbd4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">打印df1和df2看起来像；</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mr"><img src="../Images/c4f3c3ed2e75409b57cff4fab29db7bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QwV2xilF46U6kcivx01WZw.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图1:打印(df1)和打印(df2)结果。截图(来源:作者)</figcaption></figure><p id="83b0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们有两个简单的数据框架，分别来自两个不同的卖家，其中有商品的价格、以该价格出售的商品数量以及利润率。</p><p id="db5c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">df1和df2的维恩图表示:</strong></p><ul class=""><li id="a3ae" class="ms mt iq jp b jq jr ju jv jy mu kc mv kg mw kk mx my mz na bi translated">橙色阴影:卖方1以不同于卖方2 <br/>的价格、数量和利润出售的商品。例如，卖方1以10，100美元的价格出售商品0，利润为1%,而卖方2以10，120美元的价格出售商品0，利润为7%。</li><li id="ac22" class="ms mt iq jp b jq nb ju nc jy nd kc ne kg nf kk mx my mz na bi translated">蓝色阴影:卖家2以不同于卖家1的价格、数量和利润出售的商品。</li><li id="93f4" class="ms mt iq jp b jq nb ju nc jy nd kc ne kg nf kk mx my mz na bi translated">灰色份额:由卖方2和卖方1以相同的价格、数量和利润销售的商品<br/>例如，商品3由卖方1和卖方2以相同的价格30，300美元的数量销售，利润为3%。</li></ul><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ng"><img src="../Images/3d8ed6ead768060cbddea7c5ea7975a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nqMxqwGlmEtvguGhUUApmA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图2:对dfs的维恩摘要。截图(来源:作者)</figcaption></figure><p id="8f41" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> a .工会</strong></p><p id="f6aa" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">两个集合的<strong class="jp ir">并</strong>是由集合A或b中的所有元素组成的新集合，例如，</p><p id="9b1d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">集合A = {1，2，3，4}和集合B = {3，4，5，6} <br/>集合A的并集B = {1，2，3，4，5，6}通常称为A∪B</p><p id="84b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的例子中，</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nh"><img src="../Images/89558443df75a64063fcd332ae6ce7a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6YESc6KfG38QO08hPLHuYA.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图三。两个dfs的并集(灰色区域)。截图(来源:作者)</figcaption></figure><p id="35bd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一个简单的联合方法是:</p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="7e94" class="lj lk iq mi b gy mm mn l mo mp"># Union : Concat or append <strong class="mi ir">with </strong>duplicates</span><span id="111a" class="lj lk iq mi b gy mq mn l mo mp">pd.concat([df1, df2]) #OR</span><span id="b656" class="lj lk iq mi b gy mq mn l mo mp">df1.append(df2)</span></pre><p id="beb9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ni"><img src="../Images/fbb5003a501140447a70f3e48a23a04c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZJJ0kDeQ2v0MGV8W8nj9Wg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图4。Union:用重复项连接或追加。截图(来源:作者)</figcaption></figure><p id="3764" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">更好的方法是:</p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="c902" class="lj lk iq mi b gy mm mn l mo mp"># Union : Concat or append or merge <strong class="mi ir">without </strong>duplicates</span><span id="2c36" class="lj lk iq mi b gy mq mn l mo mp">pd.concat([df1,df2]).drop_duplicates().reset_index(drop=True) #OR</span><span id="3813" class="lj lk iq mi b gy mq mn l mo mp">df1.append(df2).drop_duplicates().reset_index(drop=True) #OR</span><span id="ea5a" class="lj lk iq mi b gy mq mn l mo mp">df1.merge(df2, how='outer') #<!-- -->left.merge(right, on='key', how='outer')</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nj"><img src="../Images/ade9bf969d9524aa5608e038a4d895df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YrUmCdYD5SFlSxI73HUxPQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图五。Union: Concat或append或merge没有重复。这是df1联合df2的预期结果。(来源:作者)</figcaption></figure><p id="c965" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> b .交叉点</strong></p><p id="1e2e" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">两个集合的<strong class="jp ir">交集</strong>是由集合A和集合b中的所有元素组成的新集合，例如，</p><p id="ffd1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">集合A = {1，2，3，4}和集合B = {3，4，5，6} <br/>集合A的并集B = {3，4}通常称为A∩B</p><p id="75cb" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的例子中，</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/ee0aef25fcb2fb62b31602d040abfe10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YhIyWRiUO3JCDgBA6PNM8A.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图六。两个dfs的交集(灰色区域)。截图(来源:作者)</figcaption></figure><p id="7646" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">一种简单的交叉方法是:</p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="926d" class="lj lk iq mi b gy mm mn l mo mp">pd.merge(df1, df2, how='inner')  #OR<br/>df1.merge(df2) #left.merge(right, on='key')</span></pre><p id="7809" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nl"><img src="../Images/65d70c06233baaef06ba444c245120f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dRt0J0voR0e1nJA16rDaOQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图六。两个dfs的交集。截图(来源:作者)</figcaption></figure><blockquote class="lc ld le"><p id="bf69" class="jn jo lf jp b jq jr js jt ju jv jw jx lg jz ka kb lh kd ke kf li kh ki kj kk ij bi translated">交集是两个数据帧的内部连接操作，并集是两个数据帧的外部连接操作。其他连接操作包括:</p></blockquote><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="d418" class="lj lk iq mi b gy mm mn l mo mp">#Inner Join / Intersection<br/>left.merge(right, on='key')</span><span id="fab8" class="lj lk iq mi b gy mq mn l mo mp">#Outer Join / Union<br/>left.merge(right, on='key', how='outer')</span><span id="4cf3" class="lj lk iq mi b gy mq mn l mo mp">#Left outer join / Left join - <!-- -->keys from left are used<br/>left.merge(right, on='key', how='left')</span><span id="45d5" class="lj lk iq mi b gy mq mn l mo mp">#Right outer join / Right join - <!-- -->keys from <!-- -->right<!-- --> are used<br/>left.merge(right, on='key', how='right')</span><span id="98ef" class="lj lk iq mi b gy mq mn l mo mp">#In case of different key column names<br/>left2.merge(right2, left_on='keyLeft', right_on='keyRight', how='inner')</span><span id="77bc" class="lj lk iq mi b gy mq mn l mo mp">#To see all possible options ("left_only", "right_only" or "both")<br/>left.merge(right,  how='outer', suffixes=['', '_'], indicator=True)</span></pre><p id="b4be" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lb" href="https://stackoverflow.com/questions/53645882/pandas-merging-101" rel="noopener ugc nofollow" target="_blank"> <em class="lf">用于更高级的加入操作</em> </a></p><p id="a54c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> c .差异</strong></p><p id="bb7f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">集合A B由A中的元素组成，但不在B中。例如，</p><p id="3bb7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">集合A = {1，2，3，4}和集合B = {3，4，5，6} <br/>集合A差B = {1，2}通常称为A-B</p><p id="cc02" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在我们的例子中，</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nk"><img src="../Images/5ed5f29c2248a1a5e55670b2b00bb133.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pPiUz2MnVwEwkzxN30tfTQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图六。两个dfs的差异，即df1-df2(灰色区域)。截图(来源:作者)</figcaption></figure><p id="ae29" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">区别的一个简单方法是:</p><pre class="km kn ko kp gt mh mi mj mk aw ml bi"><span id="9635" class="lj lk iq mi b gy mm mn l mo mp"># Using <!-- -->isin<!-- --> with <!-- -->tuple<br/>df1[~df1.apply(tuple,1).isin(df2.apply(tuple,1)) #OR<br/>df1[~df1.astype(str).apply(tuple, 1).isin(df2.astype(str).apply(tuple, 1))] #If df contains, nan</span><span id="a645" class="lj lk iq mi b gy mq mn l mo mp"># <!-- -->merge<!-- --> with <!-- -->indicator<br/>df1.merge(df2,indicator = True, how='left').loc[lambda x : x['_merge']!='both']</span></pre><p id="edf4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">输出:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi nm"><img src="../Images/a497bf5185121bd39eafefd7d7b8f218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z84grKYIwXDubjI1eTvpwQ.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">图7。两个dfs的区别(df1-df2)。截图(来源:作者)</figcaption></figure><p id="f84b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><a class="ae lb" href="https://www.w3schools.com/python/python_ref_set.asp" rel="noopener ugc nofollow" target="_blank"> <em class="lf"> Python设置方法</em> </a></p><h2 id="b4cd" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">结论</h2><p id="8c56" class="pw-post-body-paragraph jn jo iq jp b jq mc js jt ju md jw jx jy me ka kb kc mf ke kf kg mg ki kj kk ij bi translated">在本文中，您熟悉了集合的概念及其通过维恩图的表示。我们还了解了并集、交集、连接和差集等基本运算，以及我们如何将这些逻辑和概念应用于python数据帧来解决我们的数据科学问题。</p><p id="1969" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢您的阅读！</p><h2 id="11b2" class="lj lk iq bd ll lm ln dn lo lp lq dp lr jy ls lt lu kc lv lw lx kg ly lz ma mb bi translated">参考</h2><ul class=""><li id="c75e" class="ms mt iq jp b jq mc ju md jy nn kc no kg np kk mx my mz na bi translated"><a class="ae lb" href="https://www.probabilitycourse.com/chapter1/1_2_2_set_operations.php" rel="noopener ugc nofollow" target="_blank">https://www . probabilitycourse . com/chapter 1/1 _ 2 _ 2 _ set _ operations . PHP</a></li><li id="7463" class="ms mt iq jp b jq nb ju nc jy nd kc ne kg nf kk mx my mz na bi translated"><a class="ae lb" href="https://realpython.com/python-sets/" rel="noopener ugc nofollow" target="_blank">https://realpython.com/python-sets/</a></li><li id="b0ea" class="ms mt iq jp b jq nb ju nc jy nd kc ne kg nf kk mx my mz na bi translated"><a class="ae lb" href="https://www.w3schools.com/python/python_ref_set.asp" rel="noopener ugc nofollow" target="_blank">https://www.w3schools.com/python/python_ref_set.asp</a></li><li id="429e" class="ms mt iq jp b jq nb ju nc jy nd kc ne kg nf kk mx my mz na bi translated"><a class="ae lb" href="https://stackoverflow.com/questions/53645882/pandas-merging-101" rel="noopener ugc nofollow" target="_blank">https://stack overflow . com/questions/53645882/pandas-merging-101</a></li></ul></div></div>    
</body>
</html>