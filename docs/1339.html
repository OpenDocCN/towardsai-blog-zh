<html>
<head>
<title>Example of Pairs Trading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">配对交易示例</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/example-of-pairs-trading-4f3c75142961?source=collection_archive---------5-----------------------#2021-01-03">https://pub.towardsai.net/example-of-pairs-trading-4f3c75142961?source=collection_archive---------5-----------------------#2021-01-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="5a06" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming/r" rel="noopener ugc nofollow" target="_blank"> R </a>，<a class="ae ep" href="https://towardsai.net/p/category/statistics" rel="noopener ugc nofollow" target="_blank">统计</a></h2><div class=""/><div class=""><h2 id="2d25" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用R的Pairs交易策略的演练示例</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/c51b9fe7909e969fec435e8103c4aacb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*l3Z14aHFqN6o9eJg.png"/></div></div></figure><h1 id="f959" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">介绍</h1><p id="fc96" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">统计套利交易是股票交易的一种定量和计算方法，被对冲基金广泛应用于产生市场中性回报。这种策略最简单也是最受欢迎的版本被称为<strong class="lx jd">配对交易</strong>，它包括识别被认为具有某种长期均衡关系的资产对。当价差已经充分偏离平衡值时，通过对这对组合采取适当的多空头寸，如果价差通过平仓收敛到平衡，就可以获利。类似的想法支配着考虑更大资产篮子的更复杂的策略。我们将专注于pairs交易策略，努力<br/>精确说明两只股票之间长期均衡关系的概念，然后我们尝试描述并应用一种计算方法来模拟错误定价动态。在开始分析之前，有必要澄清统计套利<br/>交易不是无风险的策略，因此跟踪它的投资者应该保持警惕。</p><h1 id="7706" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">获取股票价格</h1><p id="4b03" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">我们将在R中工作，我们将使用quantmod包获得股票价格。对于这个例子，我们将考虑纳斯达克30只任意股票的收盘价。注意30只股票产生435对。在现实世界中，我们经常使用数千只股票和数百万对股票。让我们来看看从2020年1月1日到2021年1月3日的30只股票的收盘价:</p><ul class=""><li id="7c91" class="mr ms it lx b ly mt mb mu me mv mi mw mm mx mq my mz na nb bi translated">“谷歌”</li><li id="4d44" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">《TSLA》</li><li id="279b" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">" FB "</li><li id="7b2d" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">“AMZN”</li><li id="518d" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">《AAPL》</li><li id="4f19" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">《MSFT》</li><li id="7097" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">"视频点播"</li><li id="15c8" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">《ADBE》</li><li id="e687" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">《NVDA》</li><li id="0c4c" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">"客户关系管理"</li><li id="a736" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">"易趣"</li><li id="4dfe" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">" YNDX "</li><li id="cee7" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">“旅行”</li><li id="be7d" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">《NFLX》</li><li id="ef3f" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">" DBX "</li><li id="c908" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">" ETSY "</li><li id="1870" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">《PYPL》</li><li id="420d" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">" EA "</li><li id="6318" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">“毕都”</li><li id="4010" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">" TMUS "</li><li id="abe6" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">" SPLK "</li><li id="a071" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">《CTXS》</li><li id="6ceb" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">“奥克塔”</li><li id="eb57" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">" MDB "</li><li id="8686" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">《ZM》</li><li id="73ed" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">《INTC》</li><li id="7698" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">" GT "</li><li id="7f1b" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">《SBUX》</li><li id="0c30" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">《WIX》</li><li id="39cf" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">“锌嘎”</li></ul><pre class="ks kt ku kv gt nh ni nj nk aw nl bi"><span id="8166" class="nm le it ni b gy nn no l np nq">library(tidyverse)<br/>library(tseries)<br/>library(quantmod)<br/><br/>mySymbols &lt;- c('GOOGL', 'TSLA', 'FB', 'AMZN', 'AAPL', 'MSFT', 'VOD',  'ADBE', 'NVDA', 'CRM',<br/>               'EBAY', 'YNDX', 'TRIP', 'NFLX', 'DBX', 'ETSY', 'PYPL','EA', 'BIDU', 'TMUS',<br/>               'SPLK', 'CTXS', 'OKTA', 'MDB', 'ZM', 'INTC', 'GT', 'SBUX', 'WIX', 'ZNGA')</span><span id="33a8" class="nm le it ni b gy nr no l np nq">myStocks &lt;-lapply(mySymbols, function(x) {getSymbols(x, <br/>                                                             from = "2020-01-01", <br/>                                                             to = "2021-01-03",<br/>                                                             periodicity = "daily",<br/>                                                             auto.assign=FALSE)} )</span><span id="a9f7" class="nm le it ni b gy nr no l np nq">names(myStocks)&lt;-mySymbols</span><span id="2da3" class="nm le it ni b gy nr no l np nq">closePrices &lt;- lapply(myStocks, Cl)<br/>closePrices &lt;- do.call(merge, closePrices)</span><span id="3135" class="nm le it ni b gy nr no l np nq">names(closePrices)&lt;-sub("\\.Close", "", names(closePrices))<br/>head(closePrices)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/92b40dcfd8c7edc70fcdb81446e9f52a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*lyg8u0hp-pq-Us6v.png"/></div></div></figure><h1 id="038e" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">构建对子</h1><p id="d8bd" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">这种策略的目的是构建一个由两只长期均衡的股票组成的投资组合。然后，当价差明显偏离平衡时，我们采取适当的头寸。通过在价差收敛时平仓，或相对错误定价的措施，可以获利。从上面的讨论中，很明显，我们正在寻找价格波动强烈相关的股票，以便有机会实施配对交易策略。定义潜在协整对的最简单方法是考虑大约<strong class="lx jd"> 220 </strong>日收盘价来计算股票价格的相关性。一种广泛使用的方法是“距离法”,即通过两个标准化价格序列之间的距离或平方差来衡量货币对的共同运动。最后，一个合理的方法是考虑股票价格的对数，然后计算它们的相关性。</p><p id="e7de" class="pw-post-body-paragraph lv lw it lx b ly mt kd ma mb mu kg md me ns mg mh mi nt mk ml mm nu mo mp mq im bi translated">我们的方法是:</p><ol class=""><li id="8f79" class="mr ms it lx b ly mt mb mu me mv mi mw mm mx mq nv mz na nb bi translated">将数据分为训练数据集和测试数据集。作为训练数据集，我们考虑第一个<strong class="lx jd"> 220个</strong>观察值，并将剩余的最后32个观察值作为测试数据集。</li><li id="9ce8" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq nv mz na nb bi translated">我们取收盘价的对数。</li><li id="0684" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq nv mz na nb bi translated">在训练数据集上，我们运行log(pAt)=β×log(pBt)+εt的线性回归，其中pAt和pBt分别是股票A和B的每日收盘价。系数β是协整系数，随机项εt是价差。<strong class="lx jd">注意，我们选择在没有截距系数的情况下运行回归</strong>。这是不必要的，因为两种方法都是正确的。</li><li id="ddfc" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq nv mz na nb bi translated">对于每一对，我们从<a class="ae nw" href="https://en.wikipedia.org/wiki/Augmented_Dickey%E2%80%93Fuller_test" rel="noopener ugc nofollow" target="_blank">增强的Dickey-Fuller检验(ADF) </a>中获得相关系数、β系数和p值。我们应用ADF测试来检测协整对。</li><li id="3e5a" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq nv mz na nb bi translated">合格的配对是相关系数大于95%且p值小于5%的配对</li></ol><p id="21b3" class="pw-post-body-paragraph lv lw it lx b ly mt kd ma mb mu kg md me ns mg mh mi nt mk ml mm nu mo mp mq im bi translated">让我们在R:</p><pre class="ks kt ku kv gt nh ni nj nk aw nl bi"><span id="9035" class="nm le it ni b gy nn no l np nq"># get the correlation of each pair</span><span id="66b0" class="nm le it ni b gy nr no l np nq">left_side&lt;-NULL<br/>right_side&lt;-NULL<br/>correlation&lt;-NULL<br/>beta&lt;-NULL<br/>pvalue&lt;-NULL</span><span id="d47f" class="nm le it ni b gy nr no l np nq">for (i in 1:length(mySymbols)) {<br/>  for (j in 1:length(mySymbols)) {<br/>    <br/>    if (i&gt;j) {<br/>      left_side&lt;-c(left_side, mySymbols[i])<br/>      right_side&lt;-c(right_side, mySymbols[j])<br/>      correlation&lt;-c(correlation, cor(train[,mySymbols[i]], train[,mySymbols[j]]))<br/>      <br/>      # linear regression withoout intercept<br/>      m&lt;-lm(train[,mySymbols[i]]~train[,mySymbols[j]]-1)<br/>      beta&lt;-c(beta, as.numeric(coef(m)[1]))<br/>      <br/>      # get the mispricings of the spread<br/>      sprd&lt;-residuals(m)<br/>      <br/>      # adf test<br/>      pvalue&lt;-c(pvalue, adf.test(sprd, alternative="stationary", k=0)$p.value)<br/>      <br/>    }<br/>  }<br/>  <br/>}</span><span id="152f" class="nm le it ni b gy nr no l np nq">df&lt;-data.frame(left_side, right_side, correlation, beta, pvalue)</span><span id="f97b" class="nm le it ni b gy nr no l np nq">mypairs&lt;-df%&gt;%filter(pvalue&lt;=0.05, correlation&gt;0.95)%&gt;%arrange(-correlation)<br/>mypairs</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/2e5bc3c0559724590065a8b7364c6576.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*K-XuXI61uqXox3DA.png"/></div></div></figure><p id="f94d" class="pw-post-body-paragraph lv lw it lx b ly mt kd ma mb mu kg md me ns mg mh mi nt mk ml mm nu mo mp mq im bi translated">从435对中，我们保留了上面的7对。</p><h1 id="57f2" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">关注一对</h1><p id="3495" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">让我们把重点放在NFLX和AMZN对上，它们分别由网飞和亚马逊股票组成。我们的策略是，当价差偏离0时，用价差开仓，希望它会再次收敛到均值0。让我们在训练数据集上绘制分布图:</p><p id="2a5c" class="pw-post-body-paragraph lv lw it lx b ly mt kd ma mb mu kg md me ns mg mh mi nt mk ml mm nu mo mp mq im bi translated"><strong class="lx jd">训练数据集</strong></p><pre class="ks kt ku kv gt nh ni nj nk aw nl bi"><span id="41e2" class="nm le it ni b gy nn no l np nq">myspread&lt;-train[,"NFLX"]-0.7739680*train[,"AMZN"]<br/>plot(myspread, main = "NFLX vs AMZN")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/097f87dd3359b0f9512d43776ecd71b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pd7xLB26Mph74YZ5.png"/></div></div></figure><p id="b308" class="pw-post-body-paragraph lv lw it lx b ly mt kd ma mb mu kg md me ns mg mh mi nt mk ml mm nu mo mp mq im bi translated">通过分析价差，我们可以确定何时开仓、何时平仓的交易信号。我们可以使用分位数或3个标准差。为简单起见，我们假设我们的交易信号分别是<strong class="lx jd"> 0.04 </strong>和<strong class="lx jd"> -0.04 </strong>。该战略如下:</p><ul class=""><li id="9175" class="mr ms it lx b ly mt mb mu me mv mi mw mm mx mq my mz na nb bi translated">当价差大于0.04时，我们卖出价差，这意味着我们卖出NFLX，买入AMZN</li><li id="df7e" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">当价差低于-0.04时，我们买入价差，这意味着我们买入NFLX，卖出AMZN</li><li id="70e6" class="mr ms it lx b ly nc mb nd me ne mi nf mm ng mq my mz na nb bi translated">每当价差再次收敛到0时，我们就平仓。</li></ul><p id="507e" class="pw-post-body-paragraph lv lw it lx b ly mt kd ma mb mu kg md me ns mg mh mi nt mk ml mm nu mo mp mq im bi translated"><strong class="lx jd">测试数据集</strong></p><p id="f107" class="pw-post-body-paragraph lv lw it lx b ly mt kd ma mb mu kg md me ns mg mh mi nt mk ml mm nu mo mp mq im bi translated">让我们来看看测试数据集的分布情况:</p><pre class="ks kt ku kv gt nh ni nj nk aw nl bi"><span id="f860" class="nm le it ni b gy nn no l np nq">myspread&lt;-test[,"NFLX"]-0.7739680*test[,"AMZN"] <br/>plot(myspread, main = "NFLX vs AMZN")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/255a0395692bdf022eb530b11bf9cfaa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UYWxLJkqei9PqRKk.png"/></div></div></figure><p id="af1f" class="pw-post-body-paragraph lv lw it lx b ly mt kd ma mb mu kg md me ns mg mh mi nt mk ml mm nu mo mp mq im bi translated">正如我们所看到的，11月13日的价差低于-004，正如预期的那样，它在12月7日收敛到均值。</p><h1 id="ecc1" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">结论</h1><p id="a90c" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">配对交易是一种在熊市和牛市都适用的策略。这不是一个无风险策略，因为有可能一对永远不会收敛到均值。此外，当我们回测配对交易策略时，我们需要假设允许卖空，并考虑交易成本和卖空费用。</p></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><p id="6271" class="pw-post-body-paragraph lv lw it lx b ly mt kd ma mb mu kg md me ns mg mh mi nt mk ml mm nu mo mp mq im bi translated"><em class="of">原载于</em><a class="ae nw" href="https://predictivehacks.com/example-of-pairs-trading/" rel="noopener ugc nofollow" target="_blank"><em class="of">https://predictivehacks.com</em></a><em class="of">。</em></p></div></div>    
</body>
</html>