<html>
<head>
<title>ETL with Python &amp; SAS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和SAS进行ETL</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/sas-python-interaction-6af10212a609?source=collection_archive---------3-----------------------#2021-04-15">https://pub.towardsai.net/sas-python-interaction-6af10212a609?source=collection_archive---------3-----------------------#2021-04-15</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="eb0e" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div class="gh gi jw"><img src="../Images/04f8127c38ca63cc0c95a59405bef545.png" data-original-src="https://miro.medium.com/v2/resize:fit:1338/format:webp/1*rsZCLUQFWdRMXYDqr-wXPg.png"/></div><figcaption class="kd ke gj gh gi kf kg bd b be z dk translated">SAS Py</figcaption></figure><p id="39c8" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">本文的目标是理解Python 3.x与SAS 9.4大学版的交互。使用python pandas库读取SAS数据集，操作数据集并将结果写回SAS。</p><p id="5665" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">SAS大学版是免费的SAS软件，可用于教学和学习统计和定量方法。然而，本文的范围仅限于使用SAS和Python的ETL操作。</p><blockquote class="lf lg lh"><p id="dd5d" class="kh ki li kj b kk kl km kn ko kp kq kr lj kt ku kv lk kx ky kz ll lb lc ld le ij bi translated">#注意:假设安装了SAS大学版。</p></blockquote><ol class=""><li id="6f5d" class="lm ln iq kj b kk kl ko kp ks lo kw lp la lq le lr ls lt lu bi translated"><strong class="kj ja"> SAS库和数据集</strong></li></ol><p id="701d" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">一个<strong class="kj ja"> SAS库</strong>是一个或多个SAS文件/数据集的集合，这些文件/数据集被SAS识别，并作为一个单元被引用和存储。每当创建新的会话时，SAS自动创建两个库<strong class="kj ja"> Work、</strong>临时库<strong class="kj ja">、</strong>和<strong class="kj ja"> SASUSER、</strong>永久库<strong class="kj ja">。</strong></p><p id="6e48" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">一个<strong class="kj ja"> SAS数据集</strong>是一个包含列和行的表格。在SAS中，表称为数据集，列称为变量，行称为观察值。在每次观察中，每个变量都有一个特定的值。</p><p id="e970" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">用简单的术语或DB术语来说，SAS库可以被解释为模式，而SAS数据集可以被理解为具有矩阵结构的DB表，该矩阵结构具有行和列。</p><p id="af89" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><strong class="kj ja"> 2。创建库和数据集</strong></p><p id="7670" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">创建库的SAS命令:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="e8f9" class="me mf iq ma b gy mg mh l mi mj">libname mylib ‘&lt;path&gt;’;</span></pre><p id="8f20" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">创建数据集的SAS命令:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="93b6" class="me mf iq ma b gy mg mh l mi mj">DATA mylib.emp;<br/> infile ‘&lt;path&gt;/emp.csv’<br/> dlm=’,’<br/> FIRSTOBS=2 DSD; <br/> input EMPNO ENAME $ SAL DEPTNO COMM;<br/>run;</span></pre><figure class="lv lw lx ly gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mk"><img src="../Images/361148638fc40fda20cec5fd11313030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zgU3es3fTiBpy4dWjaFCIw.png"/></div></div><figcaption class="kd ke gj gh gi kf kg bd b be z dk translated">Emp数据集</figcaption></figure><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="e2f1" class="me mf iq ma b gy mg mh l mi mj">DATA mylib.dept;<br/> infile ‘&lt;path&gt;/dept.csv’<br/> dlm=’,’<br/> FIRSTOBS=2 DSD;<br/> input DEPTNO DNAME $ LOC $;<br/>run;</span></pre><figure class="lv lw lx ly gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mp"><img src="../Images/115669dfa97eea58cab6383c018bb0b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9gcrn2Ige3Jt78rwUxxcSA.png"/></div></div><figcaption class="kd ke gj gh gi kf kg bd b be z dk translated">部门数据集</figcaption></figure><p id="302c" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">SAS中的数据集以SAS数据格式存储在磁盘上:<strong class="kj ja"> sas7bdat。</strong></p><p id="f1e0" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><strong class="kj ja"> 3。使用Python读取SAS数据集</strong></p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="e51f" class="me mf iq ma b gy mg mh l mi mj">import pandas as pd</span><span id="d2d1" class="me mf iq ma b gy mq mh l mi mj">emp_df= pd.read_sas(r’D:\VirtualMs\SAS University Edition\myfolders\emp.sas7bdat’,encoding=’utf-8')<br/>emp_df.head(10)</span></pre><figure class="lv lw lx ly gt ka gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/82f254bbfb270d9600734f02b84c9344.png" data-original-src="https://miro.medium.com/v2/resize:fit:666/format:webp/1*b8y8uvSB9E_qYNDuNEfwxQ.png"/></div><figcaption class="kd ke gj gh gi kf kg bd b be z dk translated">emp数据集</figcaption></figure><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="63aa" class="me mf iq ma b gy mg mh l mi mj">dept_df= pd.read_sas(r’D:\VirtualMs\SAS University Edition\myfolders\dept.sas7bdat’,encoding=’utf-8')<br/>dept_df.head(10)</span></pre><figure class="lv lw lx ly gt ka gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/a5eacba91de3bee989b87fd92f733a2f.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*x_a_fbNTtD7C9fWrX-tKNA.png"/></div><figcaption class="kd ke gj gh gi kf kg bd b be z dk translated">部门数据集</figcaption></figure><p id="9557" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">数据操作步骤，应用等值联接来合并员工和部门数据集。</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="9846" class="me mf iq ma b gy mg mh l mi mj">final_df=pd.merge(emp_df,dept_df[[‘DEPTNO’,’DNAME’,’LOC’]],on=’DEPTNO’,how=’inner’)<br/>final_df.head(10)</span></pre><figure class="lv lw lx ly gt ka gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/646a2b61b02b2a209d0265a37b016cf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:984/format:webp/1*efVIv1fAiPhzA5JcfXiWQg.png"/></div><figcaption class="kd ke gj gh gi kf kg bd b be z dk translated">合并数据</figcaption></figure><p id="72e5" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">将熊猫数据帧写入磁盘:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="5492" class="me mf iq ma b gy mg mh l mi mj">final_df.to_csv(‘D:\VirtualMs\SAS University Edition\myfolders\emppy.csv’,index=False)</span></pre><p id="045a" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><strong class="kj ja"> 4。从CSV文件</strong>创建一个SAS表</p><p id="985a" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">从CSV文件创建表格的SAS程序:</p><pre class="lv lw lx ly gt lz ma mb mc aw md bi"><span id="6c36" class="me mf iq ma b gy mg mh l mi mj">DATA mylib.emp_py;<br/> infile ‘/folders/myfolders/emppy.csv’<br/> dlm=’,’<br/> FIRSTOBS=2 DSD;<br/> input EMPNO ENAME $ SAL DEPTNO COMM DNAME $ LOC $;<br/>run;</span></pre><figure class="lv lw lx ly gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mu"><img src="../Images/e5c462a4bf54a731038d65578133e310.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AHOzeiHjT6VFsf7j_dXJKQ.png"/></div></div><figcaption class="kd ke gj gh gi kf kg bd b be z dk translated">SAS表数据</figcaption></figure><p id="97b5" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">上述程序的解释:</p><p id="af1d" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><strong class="kj ja">数据步骤:</strong>该步骤包括将所需的数据集加载到SAS存储器中，并识别数据集的变量(也称为列)。它还捕获记录，也称为观察。</p><p id="010e" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><strong class="kj ja"> Infile: </strong>指定输入文件的路径和名称，以及分隔符<strong class="kj ja"> dlm，在我们的例子中是</strong>，‘由于CSV文件。</p><p id="c240" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><strong class="kj ja"> FIRSTOBS: </strong>指定从哪一行开始读取，2表示跳过表头，从第一次观察开始读取，这是实际的表头。</p><p id="b362" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">总的来说，我们已经使用Python Pandas库成功地从SAS中读取了数据集，并将数据集写回磁盘，然后用相同的数据集创建了一个表。这个博客到此为止。</p><p id="dc93" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">感谢大家对内容的支持。</p></div></div>    
</body>
</html>