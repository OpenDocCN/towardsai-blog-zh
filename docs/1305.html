<html>
<head>
<title>A Beginner’s Guide To Twitter Premium Search API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Twitter高级搜索API初学者指南</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/a-beginners-guide-to-twitter-premium-search-api-5b58ad240289?source=collection_archive---------2-----------------------#2020-12-26">https://pub.towardsai.net/a-beginners-guide-to-twitter-premium-search-api-5b58ad240289?source=collection_archive---------2-----------------------#2020-12-26</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="041f" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="4d99" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何使用Python和Twitter API创建自己的Twitter数据集</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/8c84ad55c2254ef443c271090d204b31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KZEx6AraQO_l08-n.jpg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图1:<a class="ae le" href="https://pixabay.com/users/jillwellington-334088/" rel="noopener ugc nofollow" target="_blank">吉尔灵顿</a>在<a class="ae le" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank"> pixabay </a>上的照片</figcaption></figure><p id="7221" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如今，社交网络一直是我们生活的一部分。它们的受欢迎程度可以用可访问性和便利性来解释，这使得用户可以在内容有限或没有限制的情况下提供大量信息。这些平台提供了这种连续而丰富的数据，目的是研究对品牌、产品、事件、最新新闻、社会和政治问题的看法。</p><p id="8a96" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这个新冠肺炎时期，这些平台出现了戏剧性的增长。在推特上，越来越多的人利用该平台发布与疫情有关的错误信息。为此，我将收集过去七天中提到冠状病毒和意大利总理朱塞佩·孔戴的推文。我的目标是逐步解释如何使用Twitter API提取数据。</p><h1 id="717f" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">Twitter API</h1><p id="ce82" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">Twitter API提供了对各种不同资源的访问:tweets、用户、直接消息、列表、趋势、媒体、地点。在这种情况下，我们只关注推文。该API目前包含两个受支持的版本，1.1版和v2版，后者仍在开发中[1]。<strong class="lh ja">因此，我们将重点放在1.1版上。</strong>此外，1.1版提供了不同的层级:标准、高级和企业。标准版本是一个免费的解决方案，但是它是有限的。它只返回最近7天发布的推文，并且每个时间窗口有450个请求的速率限制。然后，我们对高级版本感兴趣，它提供了一个<strong class="lh ja">付费高级</strong>访问和<strong class="lh ja">免费沙盒</strong>访问，与高级访问相比，限制和功能更少。具体来说，有两种类型的沙箱:</p><ul class=""><li id="22f2" class="my mz iq lh b li lj ll lm lo na ls nb lw nc ma nd ne nf ng bi translated"><strong class="lh ja"> 30天</strong>提供前30天的推文。</li><li id="0255" class="my mz iq lh b li nh ll ni lo nj ls nk lw nl ma nd ne nf ng bi translated"><strong class="lh ja">全存档</strong>提供从2006年3月开始的全部推特信息。</li></ul><p id="8131" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下表总结了沙盒层和高级层之间的差异。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nm"><img src="../Images/21ef30be84f0aac7642acdc7adfa8a1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4OH0ROE2KEyG3PNOKVfjMQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图2:信用:<a class="ae le" href="https://developer.twitter.com/en/docs/twitter-api/premium/search-api/overview" rel="noopener ugc nofollow" target="_blank">https://developer . Twitter . com/en/docs/Twitter-API/premium/search-API/overview</a></figcaption></figure><p id="d2b0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在本文中，<strong class="lh ja">我将使用完整的存档沙箱</strong>，因为它是免费的，允许下载一个月以上的数据。</p><h1 id="8231" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">第一步:申请开发者账号</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nn"><img src="../Images/6c89908b8a0a63db366dd1a4fbd5756c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UsV-gLW-Yv9a3kmmloXuVA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图3:信用:<a class="ae le" href="https://developer.twitter.com/en/apply-for-access" rel="noopener ugc nofollow" target="_blank">https://developer.twitter.com/en/apply-for-access</a></figcaption></figure><p id="fabe" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在下载推文之前，你必须首先申请一个开发者账户，这个账户需要被批准。申请时，您需要以特定的形式提交关于您打算使用Twitter APIs的信息。在你完成表格的编辑后，你会收到Twitter团队发来的电子邮件，里面有额外的问题。我警告你，创建开发者账户需要时间，平均在1周到2周之间。</p><h1 id="0013" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">第二步:创建你的Twitter项目和应用</h1><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi no"><img src="../Images/20e1d0c1beffe798055a1b24ae801239.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8ic0-QhdBgoCDyxplbA0fA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图4:我的开发者门户</figcaption></figure><p id="6f8b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">请求被批准后，您可以创建一个<strong class="lh ja">项目</strong>并连接一个关联的开发人员<strong class="lh ja">应用</strong>，它将提供一组凭证，您将使用这些凭证来验证所有对API的请求。要开始使用您的API，您需要为端点设置开发环境。在本教程中，我选择完整归档</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi np"><img src="../Images/a49c0d410d79c6220d18d878c20ab72a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*p2sNfipCyneaugqN-jf8iw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图5:我的客户中可用的开发环境</figcaption></figure><p id="7019" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一旦你完成了环境的设置，你只需要保存你的应用程序的<strong class="lh ja">不记名令牌</strong>，它将在以后用于下载推文。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nq"><img src="../Images/c011a9e53f85e0de60448c9296c1f4ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ALbYo9IgSrF6LE0cWhRzPQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图6:我的帐户中可用的不记名令牌</figcaption></figure><h1 id="e597" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">步骤3:创建文件<strong class="ak"> twitter_keys.yaml </strong></h1><p id="8d61" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">编写和运行Python代码，我建议使用Google发布的工具<a class="ae le" href="https://colab.research.google.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="lh ja"> Google colab </strong> </a>。它提供了一个<strong class="lh ja">免费的</strong> Jupiter笔记本环境，预装了pandas、numpy、keras和hosts等完全在Google Cloud上的包。此外，它自动保存用户的谷歌驱动器上的笔记本，使与其他人分享文件成为可能，并提供免费的GPU！</p><p id="3e77" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在写Python代码之前，我们需要创建一个文件，名为<strong class="lh ja"> twitter_keys.yaml </strong>。将所有凭证保存在单独的文件中，而不是放在代码中，这很有用。粘贴并编辑以下行:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="99e5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">需要记住的事情很少:</p><ol class=""><li id="3fdd" class="my mz iq lh b li lj ll lm lo na ls nb lw nc ma nt ne nf ng bi translated">当你经过这几行时，检查第一行后是否有两个缩进，否则代码将无法工作！</li><li id="f9f3" class="my mz iq lh b li nh ll ni lo nj ls nk lw nl ma nt ne nf ng bi translated">帐户类型可以是高级或企业。<strong class="lh ja">在这种情况下，我主要关注高级设置</strong>。</li><li id="c2f0" class="my mz iq lh b li nh ll ni lo nj ls nk lw nl ma nt ne nf ng bi translated">在这个文件中，你只需要在链接<a class="ae le" href="https://api.twitter.com/1.1/tweets/search/fullarchive/env_name.json." rel="noopener ugc nofollow" target="_blank">https://api.twitter.com/1.1/tweets/search/fullarchive/<strong class="lh ja">环境名称</strong> .json. </a>中将你的<strong class="lh ja">开发环境名称</strong>替换为环境名称<strong class="lh ja"> </strong>就可以找到开发环境的名称，你必须重新查看你的开发设置。</li><li id="d78a" class="my mz iq lh b li nh ll ni lo nj ls nk lw nl ma nt ne nf ng bi translated">指定您的<strong class="lh ja">不记名令牌</strong>。</li></ol><p id="66af" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们不需要指定消费者密钥和消费者秘密，到目前为止插入的凭证足以下载tweets。</p><h1 id="ddf2" class="mb mc iq bd md me mf mg mh mi mj mk ml kf mm kg mn ki mo kj mp kl mq km mr ms bi translated">步骤4:编写Python代码</h1><p id="ae80" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">让我们安装我们将在本教程中使用的库。</p><p id="a312" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><a class="ae le" href="https://twitterdev.github.io/search-tweets-python/" rel="noopener ugc nofollow" target="_blank"><strong class="lh ja">search tweets</strong></a><strong class="lh ja"/>是一个Python库，用作Twitter premium和企业搜索API的包装器[2]。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="23da" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在我们可以导入库之后:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="8585" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一旦导入了库，我们就加载凭证文件:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nr ns l"/></div></figure><p id="8c0e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> gen_rule_payload </strong>是一个将搜索API规则格式化为有效json查询的函数。因此，它生成规则，将tweets与标签#covid19和#giuseppeconte匹配，并选择意大利语。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nr ns l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nu"><img src="../Images/892882b44caeca7c3a4a85c73219eb28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wFa5NB-Fl1QSmmAW8hssVw.png"/></div></div></figure><p id="4b32" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在我们创建<strong class="lh ja"> ResultStream </strong>对象，它将规则和其他配置参数作为输入，包括限制API调用使用的最大页面数量。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nr ns l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/10461a229d20a98f93012d98e93bd3b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F0HuibcrlL3u9TQipgFgtg.png"/></div></div></figure><p id="d015" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">函数<strong class="lh ja">流</strong>处理来自API的数据。要收集500条提到规则中指定的词的推文，我们可以这样做:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nr ns l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nw"><img src="../Images/e2ce4378ed192e87a5f2605fa67ddc9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g1OTNOJz1hXAz-EiCSS1MA.png"/></div></div></figure><p id="4175" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下面是可以通过Tweet Parser Tweet模块访问的字段。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nr ns l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nx"><img src="../Images/25288a2d49a2791b3214c6dbb769dab3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NhklFvZDLkvWbx7bd0N2QA.png"/></div></div></figure><p id="d9e2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最后，我们对数据进行预处理并创建数据帧。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nr ns l"/></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ny"><img src="../Images/5910bd49b9fd97adac644e3bd17b3218.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ivjnjgps3wDGpO7kD55NGQ.png"/></div></div></figure><p id="92a2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最后，DataFrame被转换成CSV文件。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nr ns l"/></div></figure></div><div class="ab cl nz oa hu ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="ij ik il im in"><p id="6cd9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">恭喜你！你从推特上摘抄了推文。开发者帐号的创建是比其他步骤花费更多时间的一步，但是在你完成之后，一切都变得困难起来。希望这篇教程对你有所帮助。代码在<a class="ae le" href="https://github.com/eugeniaring/twitterapi/blob/main/tweet_api.py" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上。我还建议你试试另一个沙盒，30天，如果你只需要下载上个月的推文。为此，您需要更改文件中的端点字段。在参考资料的第二个链接中，你可以找到关于python库搜索推文的所有信息。</p><p id="03ca" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">参考文献:</strong></p><p id="0d5d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">[1]<a class="ae le" href="https://developer.twitter.com/en/docs" rel="noopener ugc nofollow" target="_blank">https://developer.twitter.com/en/docs</a></p><p id="dd16" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><a class="ae le" href="https://github.com/twitterdev/search-tweets-python" rel="noopener ugc nofollow" target="_blank">https://github.com/twitterdev/search-tweets-python</a></p></div></div>    
</body>
</html>