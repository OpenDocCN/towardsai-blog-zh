<html>
<head>
<title>Genetic Algorithm for Trading Strategy Optimization in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中交易策略优化的遗传算法</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/genetic-algorithm-for-trading-strategy-optimization-in-python-614eb660990d?source=collection_archive---------0-----------------------#2021-01-17">https://pub.towardsai.net/genetic-algorithm-for-trading-strategy-optimization-in-python-614eb660990d?source=collection_archive---------0-----------------------#2021-01-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="c014" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-mining" rel="noopener ugc nofollow" target="_blank">数据科学</a>、<a class="ae ep" href="https://towardsai.net/p/category/optimization" rel="noopener ugc nofollow" target="_blank">优化</a>、<a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="f65c" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">遗传算法如何帮助缩小问题空间并收敛到更好的解决方案？</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/3806c33683335c84d8311fdbc4297aeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*rz5FvUZ6hwX5DYd-"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">双螺旋——照片由<a class="ae lh" href="https://unsplash.com/@kuzelevdaniil?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">丹尼尔·库切列夫</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="6332" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你听说过系统交易或算法交易，那么你一定知道策略的优化是决定策略是否盈亏平衡的最重要因素之一。最糟糕的是:优化的计算量非常大。想象一个简单的MACD交叉策略，至少有3个参数:快速、慢速和信号移动平均周期，每个参数有几百个可能的值，有一百万种可能的组合。</p><p id="7488" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">收入遗传算法(GA):一种概率性和启发式搜索算法，受达尔文的自然选择理论启发，即适者生存。在这篇博客中，我们将使用遗传算法作为优化算法来确定最佳的参数集。我们将用Nvidia上的一个简单的MACD交叉来说明这一点。<strong class="lk jd">请记住，这只是应用遗传算法优化交易策略的一个演示，不应复制或盲目跟随。</strong></p><blockquote class="me mf mg"><p id="5cd7" class="li lj mh lk b ll lm kd ln lo lp kg lq mi ls lt lu mj lw lx ly mk ma mb mc md im bi translated">注意:我们将一节一节地讨论代码。如果你觉得很难理解或者把它们粘在一起，不要担心，完整的脚本会在博客的末尾提供。</p></blockquote><p id="3a47" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你想了解更多关于如何避免过度适应遗传算法的知识，这里是这篇博客的续篇，重点介绍一些更健壮的遗传算法的技术:</p><div class="ml mm gp gr mn mo"><a href="https://medium.com/towards-artificial-intelligence/genetic-algorithm-stop-overfitting-trading-strategies-5df671d5cde1" rel="noopener follow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd jd gy z fp mt fr fs mu fu fw jc bi translated">遗传算法——停止过度适应交易策略</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">变异系数如何让遗传算法更稳健？</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">medium.com</p></div></div><div class="mx l"><div class="my l mz na nb mx nc lb mo"/></div></div></a></div></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><h2 id="ec7d" class="nk nl it bd nm nn no dn np nq nr dp ns lr nt nu nv lv nw nx ny lz nz oa ob iz bi translated">什么是遗传算法？</h2><p id="4423" class="pw-post-body-paragraph li lj it lk b ll oc kd ln lo od kg lq lr oe lt lu lv of lx ly lz og mb mc md im bi translated">受达尔文进化论的启发，遗传算法是一个迭代过程，用于搜索问题陈述的全局最优解，从获得最佳基因以在严酷的世界中生存，到确定最佳参数，再到本博客上下文中的交易策略。为了更好地理解遗传算法是如何工作的，这里有一个简短的关键概念速成班:</p><ul class=""><li id="c2a8" class="oh oi it lk b ll lm lo lp lr oj lv ok lz ol md om on oo op bi translated"><strong class="lk jd">基因:</strong>这是指溶液的一个参数/变量。一个基因通常用一个位(即0或1)来表示，但这可以根据潜在的问题陈述来改变。</li><li id="176f" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd">个体/染色体:</strong>代表一个解决方案的一串基因。</li><li id="84d2" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd">种群:</strong>一代个体。</li><li id="efd9" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd">适应度函数:</strong>计算个人成功程度(<strong class="lk jd">适应度得分</strong>)的函数。根据潜在的问题陈述，我们可以搜索具有最高或最低适应性分数的个体。拥抱适者生存的概念，适应度得分越好，个体能够生存繁衍形成下一代的几率就越高。</li><li id="becb" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd">选择策略:</strong>这定义了我们如何比较个体来为下一代选择种子。一些常见的例子有<a class="ae lh" href="https://en.wikipedia.org/wiki/Tournament_selection" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">锦标赛</strong> </a>(随机抽样的个体面对面1对1，获胜者赢得下一代中的一个名额)<a class="ae lh" href="https://en.wikipedia.org/wiki/Fitness_proportionate_selection" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">轮盘赌</strong> </a>(被选中的概率与适应度分数成正比)，或者<strong class="lk jd">双重锦标赛</strong>用于更复杂的场景</li><li id="4a9b" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd">交叉策略:</strong>这本质上就是繁殖时亲代基因传递给后代的方式。杂交被认为是模仿有性繁殖，繁殖需要双亲。父母的基因将会重组形成后代。虽然不同的策略取决于场景和数据类型，但最常见的两种是k点交叉和均匀交叉。在k点交叉中，k个<em class="mh">交叉点</em>将被随机选择，其中点右侧的基因被交换。统一交换相对来说更简单:每个基因都有相同的机会被交换，而不是交换部分基因。</li></ul><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ov"><img src="../Images/6163a620bb208055d9f78e10b74f8e29.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*GoaHNPbgzUUdTM_T.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">1分交叉——归功于<a class="ae lh" href="https://commons.wikimedia.org/wiki/File:OnePointCrossover.svg" rel="noopener ugc nofollow" target="_blank">罗兰和</a></figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ov"><img src="../Images/710ad7c52ee9ea8433a8353dfdd148eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IeAsGGkd1TZ9Y6jk.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">两点交叉——归功于<a class="ae lh" href="https://en.wikipedia.org/wiki/Crossover_(genetic_algorithm)#/media/File:TwoPointCrossover.svg" rel="noopener ugc nofollow" target="_blank">罗兰和</a></figcaption></figure><ul class=""><li id="d5fd" class="oh oi it lk b ll lm lo lp lr oj lv ok lz ol md om on oo op bi translated"><strong class="lk jd">变异策略:</strong>作为保持基因多样性和防止早熟收敛的一种方式，子代的基因会有随机变异的机会，意味着实际值会偏离父代的值。突变通常以<a class="ae lh" href="https://deap.readthedocs.io/en/master/api/tools.html#deap.tools.mutFlipBit" rel="noopener ugc nofollow" target="_blank">比特翻转</a>、<a class="ae lh" href="https://deap.readthedocs.io/en/master/api/tools.html#deap.tools.mutShuffleIndexes" rel="noopener ugc nofollow" target="_blank">索引重排</a>或<a class="ae lh" href="https://deap.readthedocs.io/en/master/api/tools.html#deap.tools.mutShuffleIndexes" rel="noopener ugc nofollow" target="_blank">有界</a>和<a class="ae lh" href="https://deap.readthedocs.io/en/master/api/tools.html#deap.tools.mutShuffleIndexes" rel="noopener ugc nofollow" target="_blank">无界</a>统计分布的形式出现。</li></ul><p id="b21a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后将这些关键概念结合起来形成一个迭代算法:</p><ol class=""><li id="1a87" class="oh oi it lk b ll lm lo lp lr oj lv ok lz ol md ow on oo op bi translated">将问题陈述参数化</li><li id="9a46" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md ow on oo op bi translated">定义适应度函数</li><li id="28cf" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md ow on oo op bi translated">定义交叉、变异和选择策略</li><li id="befa" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md ow on oo op bi translated">生成初始群体</li><li id="3412" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md ow on oo op bi translated">评估群体中个体的适合度</li><li id="6530" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md ow on oo op bi translated">选择个体，交叉和变异，形成下一代种群</li><li id="4df3" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md ow on oo op bi translated">重复步骤5和6，直到收敛或满足结束条件</li></ol><p id="d047" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在我们已经完成了速成课程，让我们看看如何将它应用于交易策略优化。</p></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><h2 id="26c3" class="nk nl it bd nm nn no dn np nq nr dp ns lr nt nu nv lv nw nx ny lz nz oa ob iz bi translated">准备</h2><p id="c069" class="pw-post-body-paragraph li lj it lk b ll oc kd ln lo od kg lq lr oe lt lu lv of lx ly lz og mb mc md im bi translated">在我们开始之前，让我们确保我们已经安装并准备好了所有的库。除了常用的熊猫、熊猫等，我们还会用到以下的:</p><ul class=""><li id="16ce" class="oh oi it lk b ll lm lo lp lr oj lv ok lz ol md om on oo op bi translated"><strong class="lk jd"> Alpha Vantage: </strong>一家免费的mium数据提供商。放心。一个免费的许可证就足够了。</li><li id="ffc2" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd"> Backtrader: </strong>一个很棒的开源python框架，让你可以专注于编写可重用的交易策略、指标和分析工具，而不必花时间构建基础设施。它还支持回溯测试，让你评估自己想出的策略！</li><li id="92c0" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd">DEAP:</strong>Python中的分布式进化算法，这是一种用于快速原型和思想测试的新型进化计算框架。</li></ul><p id="5bd9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">要安装它们，只需运行下面一行:</p><pre class="ks kt ku kv gt ox oy oz pa aw pb bi"><span id="b845" class="nk nl it oy b gy pc pd l pe pf">conda create -n myenv</span><span id="15bb" class="nk nl it oy b gy pg pd l pe pf">conda activate myenv &amp;&amp; conda install -y python=3.8.5</span><span id="6216" class="nk nl it oy b gy pg pd l pe pf">pip install alpha_vantage backtrader[plotting] deap</span></pre><blockquote class="me mf mg"><p id="7276" class="li lj mh lk b ll lm kd ln lo lp kg lq mi ls lt lu mj lw lx ly mk ma mb mc md im bi translated">注意:在一个隔离的环境中开始一个新项目总是一个好主意，无论是虚拟环境、conda环境还是docker容器。它有助于保持代码和环境的整洁、可复制性和可移植性。</p></blockquote></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><h2 id="687d" class="nk nl it bd nm nn no dn np nq nr dp ns lr nt nu nv lv nw nx ny lz nz oa ob iz bi translated">数据采集</h2><p id="2e12" class="pw-post-body-paragraph li lj it lk b ll oc kd ln lo od kg lq lr oe lt lu lv of lx ly lz og mb mc md im bi translated">有了Alpha Vantage的密钥，我们就可以使用下面的代码片段来获取Nvidia股票的历史价格，代码为“NVDA”。处理金融股票数据时要记住的一件事是价格调整。例如，特斯拉在8月31日经历了五对一的分拆。所以拆分前的一股应该是拆分后的五倍左右。这就是为什么我们需要根据拆分和分红事件来调整价格。</p><p id="1c2f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">幸运的是，Alpha Vantage的每日调整端点，我们将根据<a class="ae lh" href="http://www.crsp.org/products/documentation/crsp-calculations" rel="noopener ugc nofollow" target="_blank">证券价格研究中心的公式</a>调整收盘价格。然后，我们可以使用从未调整的开盘价到未调整的收盘价的百分比变化来估计调整后的开盘价、最高价和最低价:如果当天价格的百分比变化为+10%，那么无论调整与否，收盘价都应该是开盘价的110%。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="420f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦你运行完这个脚本，<code class="fe pj pk pl oy b">read_alpha_vantage</code>应该会返回一个数据框，它的前5行和后5行类似于下面的内容，这取决于你何时查询Alpha Vantage:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ph pi l"/></div></figure><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ph pi l"/></div></figure></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><h2 id="d159" class="nk nl it bd nm nn no dn np nq nr dp ns lr nt nu nv lv nw nx ny lz nz oa ob iz bi translated">反向交易框架</h2><p id="3e25" class="pw-post-body-paragraph li lj it lk b ll oc kd ln lo od kg lq lr oe lt lu lv of lx ly lz og mb mc md im bi translated">在Backtrader中，一个策略需要遵循<code class="fe pj pk pl oy b">backtrader.strategy</code>的接口。界面中最重要的组件是:</p><ul class=""><li id="e6bc" class="oh oi it lk b ll lm lo lp lr oj lv ok lz ol md om on oo op bi translated"><code class="fe pj pk pl oy b">params</code>:策略使用的参数</li><li id="ea41" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><code class="fe pj pk pl oy b">__init__</code>:我们准备数据并定义指标</li><li id="498d" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><code class="fe pj pk pl oy b">next()</code>:这决定了下一步该怎么做</li></ul><pre class="ks kt ku kv gt ox oy oz pa aw pb bi"><span id="88dc" class="nk nl it oy b gy pc pd l pe pf">import backtrader as bt</span><span id="4592" class="nk nl it oy b gy pg pd l pe pf">class CrossoverStrategy(bt.Strategy):<br/>    params = dict()<br/>    <br/>    def __init__(self):<br/>        # initialise strategy<br/>        # do data prep<br/>        # define indicators<br/>        pass</span><span id="5384" class="nk nl it oy b gy pg pd l pe pf">    def next(self):<br/>        # trading logic<br/>        pass</span></pre><p id="9376" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一个<a class="ae lh" href="https://altfins.com/knowledge-base/macd-line-and-macd-signal-line/" rel="noopener ugc nofollow" target="_blank">简单的MACD交叉策略</a>由四行组成:</p><ol class=""><li id="5bfe" class="oh oi it lk b ll lm lo lp lr oj lv ok lz ol md ow on oo op bi translated">收盘的快速(12天)指数移动平均线</li><li id="8ea6" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md ow on oo op bi translated">收盘的慢速(26天)指数移动平均线</li><li id="f20f" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md ow on oo op bi translated">MACD线，快速移动平均线和慢速移动平均线的区别</li><li id="3ed5" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md ow on oo op bi translated">信号线，MACD线的9天移动平均线</li></ol><p id="c724" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们还需要在<code class="fe pj pk pl oy b">next()</code>下输入交易逻辑。简单来说，这种策略将只做多:</p><ul class=""><li id="92cb" class="oh oi it lk b ll lm lo lp lr oj lv ok lz ol md om on oo op bi translated">多头入场:当MACD线在信号线上方交叉时</li><li id="e312" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated">多头出场:当MACD线穿过信号线下方时</li></ul><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="0939" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该策略现在需要与我们的数据、策略的追踪器(<code class="fe pj pk pl oy b">bt.observers</code>)和分析器(<code class="fe pj pk pl oy b">bt.analyzers</code>)以及佣金和账户余额等其他经纪级别设置一起，被馈送到Backtrader的主引擎— <code class="fe pj pk pl oy b">backtrader.cerebro</code>。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="dae6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">当你执行<code class="fe pj pk pl oy b">run_backtest(plot=True, **STRATEGY_PARAMS)</code>时，你应该得到这样的结果:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pm"><img src="../Images/6e0745dc41b7b81cc49d2c60cd455cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3YCGnBpa5C-Ub61rGfbCww.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">来自反向交易者的结果—图片由作者提供</figcaption></figure></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><h2 id="2649" class="nk nl it bd nm nn no dn np nq nr dp ns lr nt nu nv lv nw nx ny lz nz oa ob iz bi translated">遗传算法参数优化</h2><p id="81e7" class="pw-post-body-paragraph li lj it lk b ll oc kd ln lo od kg lq lr oe lt lu lv of lx ly lz og mb mc md im bi translated">使用默认参数，Nvidia的火箭仅制造73.16美元，这看起来一点也不乐观。让我们尝试优化参数，看看我们是否可以使它更可行。</p><p id="0f7f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">基于前面的速成课程，让我们将算法定义如下:</p><ul class=""><li id="1051" class="oh oi it lk b ll lm lo lp lr oj lv ok lz ol md om on oo op bi translated"><strong class="lk jd">基因:</strong>这应该是我们MACD战略的<code class="fe pj pk pl oy b">params</code>。不幸的是，DEAP不能很好地处理关键字参数，因为跨越需要索引切片。相反，我们将使用一个<code class="fe pj pk pl oy b">list</code>来存储参数。</li><li id="a7d3" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd">初始群体:</strong>我们的初始群体将有100个个体，每个个体的随机整数<code class="fe pj pk pl oy b">fast_period</code>在<code class="fe pj pk pl oy b">[1, 151)</code>范围内，<code class="fe pj pk pl oy b">slow_period</code>在<code class="fe pj pk pl oy b">[10, 251)</code>范围内，<code class="fe pj pk pl oy b">signal_period</code>在<code class="fe pj pk pl oy b">[1, 301)</code>范围内。这意味着总共有150 x 240 x 300 = 10.8万种可能的组合。</li><li id="13bd" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd">适应度函数:</strong>为了平衡回报和风险，我们将使用<code class="fe pj pk pl oy b">Total Profit / Maximum Draw Down</code>作为我们适应度函数的唯一目标。由于DEAP是一个通用框架，它支持多目标的适应度函数。因此，该函数需要返回一个健康分数列表。</li><li id="8bc5" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd">选择策略:</strong>我们将使用经典的<a class="ae lh" href="https://en.wikipedia.org/wiki/Selection_(genetic_algorithm)#Tournament_Selection" rel="noopener ugc nofollow" target="_blank">锦标赛</a>方法，每轮锦标赛的获胜者将被选为下一代的种子。</li><li id="ec8b" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd">交叉策略:</strong>我们将使用均匀交叉，每个基因有50%的机会交叉。</li><li id="ccae" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd">突变策略:</strong>我们将在<code class="fe pj pk pl oy b">[1, 101)</code>范围内使用整数的均匀分布，每个基因的突变概率为30%。</li><li id="5256" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><strong class="lk jd">结束条件:</strong>算法将在完成20次迭代后停止。</li></ul><p id="3800" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面的代码片段是我们的遗传算法在上述设置下的实现。我们还增加了一个名人堂，它将记录算法迭代过程中的最佳个体。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ph pi l"/></div></figure><p id="d3d3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">运行该代码片段后，我们得到了以下结果</p><pre class="ks kt ku kv gt ox oy oz pa aw pb bi"><span id="4ae8" class="nk nl it oy b gy pc pd l pe pf">HALL OF FAME:<br/>    0: [36, 84, 5], Fitness: 5.331913978803928<br/>    1: [36, 87, 5], Fitness: 5.329609884401389<br/>    2: [5, 143, 44], Fitness: 5.309777394151804</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pn"><img src="../Images/b44042f88e0224c0da90ed91c5836312.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mcyYRhja0hjOYkMKd8l2Gg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">适应性分数在20次迭代内收敛-图片由作者提供</figcaption></figure><p id="29bb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从上面的图表中，我们可以看到性能如何在大约10次迭代中非常快地收敛到解决方案。这意味着，该算法不是尝试1080万个组合的全部，而是仅通过一千次回测运行为我们产生了最佳解决方案的候选，这不到问题空间的0.1%。这已经是最坏的估计了，假设所有的个体在每一代人中都是不同的。</p><p id="6e4f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们将<code class="fe pj pk pl oy b">dict(fast_period=5, slow_period=82, signal_period=38)</code>的最优解插回到前面包含的回溯测试函数，我们可以看到利润现在是默认MACD交叉策略的7倍多一点:</p><pre class="ks kt ku kv gt ox oy oz pa aw pb bi"><span id="c02c" class="nk nl it oy b gy pc pd l pe pf">OPTIMISED_STRATEGY_PARAMS = {<br/>    k: v for k, v in zip(PARAM_NAMES, hall_of_fame[0])}<br/>run_backtest(**OPTIMISED_STRATEGY_PARAMS)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pm"><img src="../Images/424c2efb74a756afea0d4e12df1a0064.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*w6cxkq4eGi-NaILtupi-Mg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">遗传算法优化策略的性能—作者图片</figcaption></figure></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><h2 id="f6fd" class="nk nl it bd nm nn no dn np nq nr dp ns lr nt nu nv lv nw nx ny lz nz oa ob iz bi translated">结论</h2><p id="87b4" class="pw-post-body-paragraph li lj it lk b ll oc kd ln lo od kg lq lr oe lt lu lv of lx ly lz og mb mc md im bi translated">在这篇博客中，我们介绍了遗传算法的关键概念，并展示了我们如何用它们来优化交易策略。</p><p id="00ce" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">从历史上看，参数优化对计算能力的要求非常高。在我们的例子中，只有三个参数的简单MACD交叉策略已经产生了数百万种可能的组合。即使每个回溯测试可以在0.01秒内完成，那也已经是总共30小时的计算时间了。随着参数数量的增加，这只会呈指数增长。</p><p id="dcb0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">使用遗传算法，我们可以在大约10次迭代后收敛到全局最优的候选，这小于问题空间的0.1%。优化的MACD策略的表现也比默认参数好得多，利润是原来的7倍多。</p><p id="2bdf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">也就是说，请记住这篇博客仅仅是展示我们如何利用遗传算法作为优化工具，因此一直专注于底层概念和简单的代码结构(这里有<a class="ae lh" href="https://gist.github.com/wululoo/a93983cbe1be92d12d8cdc036e2f89ab" rel="noopener ugc nofollow" target="_blank"/>)供我们大家尝试。</p><p id="92ae" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你想了解如何避免过度适应遗传算法，这里是这篇博文的续篇，重点是我们如何利用随机子集选择和变异系数来训练一个更健壮的遗传算法。</p><div class="ml mm gp gr mn mo"><a href="https://medium.com/towards-artificial-intelligence/genetic-algorithm-stop-overfitting-trading-strategies-5df671d5cde1" rel="noopener follow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd jd gy z fp mt fr fs mu fu fw jc bi translated">遗传算法——停止过度适应交易策略</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">变异系数如何让遗传算法更稳健？</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">medium.com</p></div></div><div class="mx l"><div class="my l mz na nb mx nc lb mo"/></div></div></a></div></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><p id="c348" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这是这个博客的内容。希望你觉得博客或代码有用！如果我错过了什么，或者如果你有任何问题，请随时回复或pm。如果你对成为更好的Python程序员的技巧感兴趣，我为你整理了一份简短博客的列表:</p><ul class=""><li id="9c42" class="oh oi it lk b ll lm lo lp lr oj lv ok lz ol md om on oo op bi translated"><a class="ae lh" href="https://towardsdatascience.com/python-tricks-flattening-lists-75aeb1102337" rel="noopener" target="_blank"> Python技巧:拉平列表</a></li><li id="7460" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><a class="ae lh" href="https://towardsdatascience.com/python-tricks-how-to-check-table-merging-with-pandas-cae6b9b1d540" rel="noopener" target="_blank"> Python技巧:如何检查与熊猫的表格合并</a></li><li id="84b0" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><a class="ae lh" href="https://towardsdatascience.com/python-tricks-simplifying-if-statements-boolean-evaluation-4e10cc7c1e71" rel="noopener" target="_blank"> Python技巧:简化If语句&amp;布尔求值</a></li><li id="5387" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><a class="ae lh" href="https://towardsdatascience.com/python-tricks-check-multiple-variables-against-single-value-18a4d98d79f4" rel="noopener" target="_blank"> Python技巧:对照单个值检查多个变量</a></li></ul><p id="35a1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你想了解更多关于Python、数据科学或机器学习的知识，你可能想看看这些帖子:</p><ul class=""><li id="b678" class="oh oi it lk b ll lm lo lp lr oj lv ok lz ol md om on oo op bi translated"><a class="ae lh" href="https://towardsdatascience.com/7-easy-ways-for-improving-your-data-science-workflow-b2da81ea3b2" rel="noopener" target="_blank">改进数据科学工作流程的7种简单方法</a></li><li id="3bcd" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><a class="ae lh" href="https://towardsdatascience.com/efficient-implementation-of-conditional-logic-on-pandas-dataframes-4afa61eb7fce" rel="noopener" target="_blank">熊猫数据帧上的高效条件逻辑</a></li><li id="7179" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><a class="ae lh" href="https://towardsdatascience.com/memory-efficiency-of-common-python-data-structures-88f0f720421" rel="noopener" target="_blank">常见Python数据结构的内存效率</a></li><li id="4da3" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><a class="ae lh" href="https://towardsdatascience.com/parallelism-with-python-part-1-196f0458ca14" rel="noopener" target="_blank">与Python并行</a></li><li id="979b" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><a class="ae lh" href="https://towardsdatascience.com/cookiecutter-plugin-for-jupyter-easily-organise-your-data-science-environment-a56f83140f72" rel="noopener" target="_blank">数据科学的基本Jupyter扩展设置</a></li><li id="7dd8" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><a class="ae lh" href="https://towardsdatascience.com/mastering-root-searching-algorithms-in-python-7120c335a2a8" rel="noopener" target="_blank">Python中高效的根搜索算法</a></li></ul><p id="f75b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你想了解更多关于如何将机器学习应用于交易和投资的信息，这里有一些你可能感兴趣的帖子:</p><ul class=""><li id="9753" class="oh oi it lk b ll lm lo lp lr oj lv ok lz ol md om on oo op bi translated"><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/genetic-algorithm-for-trading-strategy-optimization-in-python-614eb660990d">Python中交易策略优化的遗传算法</a></li><li id="ef50" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><a class="ae lh" href="https://medium.com/towards-artificial-intelligence/genetic-algorithm-stop-overfitting-trading-strategies-5df671d5cde1" rel="noopener">遗传算法——停止过度拟合交易策略</a></li><li id="f205" class="oh oi it lk b ll oq lo or lr os lv ot lz ou md om on oo op bi translated"><a class="ae lh" rel="noopener ugc nofollow" target="_blank" href="/ann-recommendation-system-for-stock-selection-c9751a3a0520">人工神经网络选股推荐系统</a></li></ul></div><div class="ab cl nd ne hx nf" role="separator"><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni nj"/><span class="ng bw bk nh ni"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt mo"><a href="https://www.linkedin.com/in/louis-chan-b55b9287" rel="noopener  ugc nofollow" target="_blank"><div class="mp ab fo"><div class="mq ab mr cl cj ms"><h2 class="bd jd gy z fp mt fr fs mu fu fw jc bi translated">Louis Chan-FTI Consulting | LinkedIn数据科学总监</h2><div class="mv l"><h3 class="bd b gy z fp mt fr fs mu fu fw dk translated">雄心勃勃的，好奇的和有创造力的个人，对分支知识和知识之间的相互联系有强烈的信念</h3></div><div class="mw l"><p class="bd b dl z fp mt fr fs mu fu fw dk translated">www.linkedin.com</p></div></div><div class="mx l"><div class="po l mz na nb mx nc lb mo"/></div></div></a></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><a href="https://www.buymeacoffee.com/louischan"><div class="gh gi pp"><img src="../Images/d6d36bf89a39938b99e856bee116711f.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/0*6e0XNskWvXQhaNs4.png"/></div></a></figure></div></div>    
</body>
</html>