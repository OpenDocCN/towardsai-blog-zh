<html>
<head>
<title>Implementing GraphX/Graph-frames in Apache Spark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Apache Spark中实现GraphX/Graph-frames</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/relationship-analysis-inspark-using-graphx-57ffcce8773f?source=collection_archive---------0-----------------------#2020-07-19">https://pub.towardsai.net/relationship-analysis-inspark-using-graphx-57ffcce8773f?source=collection_archive---------0-----------------------#2020-07-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="a776" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="275c" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">使用类似LinkedIn的家庭成员和朋友关系进行分析</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/b35bd1453b118b4fabe99e93f7e47f13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v2Mw_62gGmp_DveYsfNJuQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">来源:Needpix.com<a class="ae le" href="https://www.google.com/url?sa=i&amp;url=https%3A%2F%2Fwww.needpix.com%2Fphoto%2F834120%2Fsocial-media-manager-monitors-online-organization-embassies-content-internet&amp;psig=AOvVaw1EiLOdAYnPfVgbDV_ohp_5&amp;ust=1595344810464000&amp;source=images&amp;cd=vfe&amp;ved=0CAMQjB1qFwoTCODb6d2Q3OoCFQAAAAAdAAAAABBU" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="2b6c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们正在使用GraphX探索家庭成员之间以及与朋友之间的关系。有六个家庭成员，有父亲、母亲、儿子、女儿和两个朋友。我们试图回答哪个家庭成员有最多的联系，哪个家庭成员有最少的联系。此外，我们可以看到数据集中记录之间的关系级别。GraphX解决了这些问题，并被脸书和LinkedIn等公司广泛使用。</p><h2 id="9289" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">GraphX简介</h2><p id="0aec" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">GraphX是Apache Spark用于图形和图形并行计算的API。GraphX在单个系统中统一了ETL(提取、转换和加载)过程、探索性分析和迭代图计算。在脸书的朋友，LinkedIn的连接，互联网路由器，天体物理学中星系和恒星之间的关系以及谷歌地图中可以看到图形的用法。<br/>在Spark中，你可以获得很多关于图形的细节，比如边的列表和数量、节点、每个节点的邻居、每个节点的入度和出度分数。PySpark中可以使用的基本图形函数如下:*顶点*边*度数*外度数*度数</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h1 id="29dd" class="nf mc iq bd md ng nh ni mg nj nk nl mj kf nm kg mm ki nn kj mp kl no km ms np bi translated">家庭成员关系分析</h1><p id="1383" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">这就是我们在PySpark中启动GraphX的方式</p><pre class="kp kq kr ks gt nq nr ns nt aw nu bi"><span id="eb8e" class="mb mc iq nr b gy nv nw l nx ny">pyspark --packages graphframes:graphframes:0.5.0-spark2.1-s_2.11</span></pre><p id="50da" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这是你启动GraphX后的样子</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/3dadafa4a4680af9d2cc56636e6e80c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*eWb4xr7nFhPN7apO.png"/></div></div></figure><p id="c38f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这就是导入graphframe的方法</p><pre class="kp kq kr ks gt nq nr ns nt aw nu bi"><span id="c12b" class="mb mc iq nr b gy nv nw l nx ny">from graphframes import *</span></pre></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h2 id="e443" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">数据集</h2><p id="5e36" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">我们有两个名为person和relationship的表。一个人有身份证、姓名和年龄。关系表包含源、目的地、关系。这里源和目的地是用户id，关系列显示它们之间的关系。</p><div class="kp kq kr ks gt ab cb"><figure class="oa kt ob oc od oe of paragraph-image"><img src="../Images/cac5b44d3022804f66da612372a34775.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*8D2YxuUSrIXv2EVFPPdNgw.png"/></figure><figure class="oa kt og oc od oe of paragraph-image"><img src="../Images/5601b466a58ac08fed57ecc9fac81154.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*Nvvh_eGqPcPhQ0XkWwoK_w.png"/></figure></div><p id="51dd" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们将探讨家庭成员和朋友之间的关系。我们也可以对人与人之间的关系进行分类。这有广泛的应用，如寻找人与人之间的联系，社会媒体分析等。</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><p id="c7a5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">示例代码</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="oh oi l"/></div></figure></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h2 id="b9a6" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">理解图中的度</h2><p id="7086" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated"><strong class="lh ja">度</strong></p><p id="04c1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">图形中每个顶点的度数作为具有两列的数据帧返回:</p><p id="158c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">-“id”:顶点的ID</p><p id="e3d9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">- 'degree '(整数)顶点的度数</p><p id="6110" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">注意:结果中不返回边数为0的顶点。</p><p id="d3d3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">度数</strong></p><p id="8560" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">图形中每个顶点的入度以具有两列的DataFame形式返回:</p><p id="29cf" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">-“id”:顶点的ID</p><p id="fbf4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">-“in degree”(int)存储顶点的入度</p><p id="8b43" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">注意:结果中不返回内边为0的顶点。返回带有新顶点列“inDegree”的数据帧</p><p id="01ac" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">向外倾斜</strong></p><p id="47ab" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">图形中每个顶点的出度作为具有两列的数据帧返回:</p><p id="c2a2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">-“id”:顶点的ID</p><p id="3fe7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">-“出度”(整数)存储顶点的出度</p><p id="b10d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">注意:结果中不返回具有0外边缘的顶点。返回带有新顶点列“outDegree”的数据帧</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h2 id="7044" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">例子</h2><p id="00a9" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">找出所有与安德鲁有关的边</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/aa2304e3caa0c08dd229a214bb640908.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*VpAyRWwIxYyESawg.png"/></div></div></figure><p id="820f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">找到所有和安德鲁的联系</p><p id="78ca" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">使用出站索引确定从Andrew发出的链路数量</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/d70277b4ad0de7d7ade957d5d514ea11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7kvviJFdBly5R278.png"/></div></div></figure><p id="a011" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">三角形计数问题</p><p id="747b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">此计数列标识顶点参与的三角形关系的数量。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/84f645c09247fea0acaf1dc80a9a9e3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*G3H3f4wxdAMSNIMw.png"/></div></div></figure><p id="9452" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">输出显示Andrew和Sierra具有最大的三角形计数，因为它们涉及应用PageRank算法的三种关系。它最初是由谷歌的创始人发起的，旨在识别互联网上最重要的页面。PageRank算法衡量图中每个顶点的重要性。假设一个场景，一个Twitter用户有10个重要的关注者，每个关注者又有多个关注者。也就是说，PageRank算法将每个重要的关注者视为Twitter用户的合法认可，从而给予用户更高的排名。</p><pre class="kp kq kr ks gt nq nr ns nt aw nu bi"><span id="b83d" class="mb mc iq nr b gy nv nw l nx ny">&gt;&gt;&gt; pageRank = graph.pageRank(resetProbability=0.20, maxIter=10)</span></pre><p id="8cea" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这里，我们使用PageRank方法调用pageRank算法。它需要两个属性</p><ol class=""><li id="39e1" class="oj ok iq lh b li lj ll lm lo ol ls om lw on ma oo op oq or bi translated">reset probability:这个值是一个随机值重置概率(alpha)。</li><li id="35a7" class="oj ok iq lh b li os ll ot lo ou ls ov lw ow ma oo op oq or bi translated">maxIter:这是你希望pageRank运行的次数。</li></ol><p id="2dc5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">您可以从原始person的模式中看到，已经添加了一个名为PageRank的新列，并且在原始关系模式中添加了新的列权重。这两栏都对PageRank分数有贡献</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/134b6e053b125b0c0ec98da2235b9b50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*2_lvJ8J6iR3bo1dw.png"/></div></div></figure><p id="cff2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">什么是PageRank评分？</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/4089f00b6688d84fe41e992636bcfa76.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Q9EM62Y8DiRMT2e1.png"/></div></div></figure><p id="519c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们来看权重:权重是计算页面排名的决定因素</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nz"><img src="../Images/55bedda1543aaf6817e7a3f423c29f0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*-q4rOzGV77LH1ops.png"/></div></div></figure><p id="6b77" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从表中可以看出，威廉和安德鲁的关系权重最大，因为它是独一无二的。除了安德鲁，没有人是威廉的朋友。通过应用广度优先算法，让我们找到连接到人们的最短路径。我们打算申请BFS。<br/>你可能经常会注意到LinkedIn会告诉你离任何新用户有多远。例如，您会注意到您想要连接的用户是第二个连接或第三个连接。这告诉你，你离你正在看的那个顶点有两个顶点。这是确定一个顶点到另一个顶点有多远的一种方法。</p><p id="ff5a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">另一个例子是寻找两个城市或两个机场之间的最短路径。广度优先搜索是最短路径查找算法之一，它帮助我们确定两个顶点之间的最短路径。</p><p id="ef0d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">找出Bob和William之间的联系，因为只有Andrew与William直接相关。为了让鲍勃能和威廉联系上。</p><h2 id="db18" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">最短的路径是什么？怎么找？</h2><p id="780c" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">GraphFrames提供了一个名为bfs(广度优先搜索)的API，它最少需要两个参数。这些是fromExpr:表达式，用来标识from顶点。toExpr:标识顶点的表达式。</p><pre class="kp kq kr ks gt nq nr ns nt aw nu bi"><span id="4d56" class="mb mc iq nr b gy nv nw l nx ny">graph.bfs(fromExpr=””Name=’Bob’””,toExpr=””Name=’William’””).show()</span></pre><p id="8308" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这显示了威廉和鲍勃之间的最短路径。如果我们试图找到真正的距离，它会更实际。可以用城市名代替人名，找最短路径。</p></div><div class="ab cl my mz hu na" role="separator"><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd ne"/><span class="nb bw bk nc nd"/></div><div class="ij ik il im in"><h2 id="c1d7" class="mb mc iq bd md me mf dn mg mh mi dp mj lo mk ml mm ls mn mo mp lw mq mr ms iw bi translated">下一个故事</h2><p id="3e0f" class="pw-post-body-paragraph lf lg iq lh b li mt ka lk ll mu kd ln lo mv lq lr ls mw lu lv lw mx ly lz ma ij bi translated">我准备公布机器学习算法在Spark中的实现，通过实现以下算法来预测明年的房价。请就此发表反馈。</p><pre class="kp kq kr ks gt nq nr ns nt aw nu bi"><span id="a45b" class="mb mc iq nr b gy nv nw l nx ny">1. Decision Tree Regression<br/>2. Random Forest Regression<br/>3. Gradient Boosted Tree Regression</span></pre></div></div>    
</body>
</html>