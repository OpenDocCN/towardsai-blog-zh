<html>
<head>
<title>AWS SageMaker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">AWS SageMaker</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/aws-sagemaker-32af6c18d7f0?source=collection_archive---------0-----------------------#2019-05-20">https://pub.towardsai.net/aws-sagemaker-32af6c18d7f0?source=collection_archive---------0-----------------------#2019-05-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="f231" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a></h2><div class=""/><div class=""><h2 id="bcb9" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">亚马逊网络服务介绍——SageMaker</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi kr"><img src="../Images/f01cac9f76f0e16cfa55c9d54ecaacb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/format:webp/1*YvUqkWfd4hN_7I44XfLUPg.png"/></div></figure><p id="8f6a" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SageMaker是AWS的核心人工智能产品之一，可以帮助我们度过机器学习生命周期的所有阶段。它为我们提供了一个简单的Jupyter Notebook UI，可以用来编写基本的Python代码。它可以通过转储到S3桶中的数据或像Kinesis shards这样的流数据源来建立模型。一旦模型被训练，SageMaker允许我们毫不费力地将它们部署到生产中。</p><p id="6643" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了一窥究竟，现在让我们尝试一个例子——它可以向我们展示SageMaker的真正力量。我们将致力于旧的<a class="ae lv" href="https://en.wikipedia.org/wiki/MNIST_database" rel="noopener ugc nofollow" target="_blank"> MNINST数据集</a>；经历SageMaker的所有开发阶段——从使用下载的数据训练模型开始——直到部署Lambda函数，该函数可以利用SageMaker开发的预测器端点。</p><h1 id="9db9" class="lw lx it bd ly lz ma mb mc md me mf mg ki mh kj mi kl mj km mk ko ml kp mm mn bi translated">S3水桶</h1><p id="ec40" class="pw-post-body-paragraph kz la it lb b lc mo kd le lf mp kg lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">SageMaker在工作时使用S3铲斗倾倒模型。在我们训练模型时，将数据转储到S3桶中也很方便。因此，第一步是选择一个S3桶，我们使用的目的。我有一个桶是献给SageMaker的。我称之为sagemaker-dumps。你可以选择一个适合你的目的的名字。</p><p id="e2c6" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个bucket不需要任何公共访问，因为我们在SageMaker内部处理它。生命周期规则可以将文件移动到IA或Glacier中—因为我们很少在模型最终确定后使用训练数据。</p><h1 id="6100" class="lw lx it bd ly lz ma mb mc md me mf mg ki mh kj mi kl mj km mk ko ml kp mm mn bi translated">笔记本实例</h1><p id="7986" class="pw-post-body-paragraph kz la it lb b lc mo kd le lf mp kg lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">在完成S3桶之后，让我们回到SageMaker。下一步是供应和创建一个笔记本实例。让我们从这一点开始。</p><p id="4d89" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从AWS控制台打开SageMaker服务，并导航到笔记本实例。点击“创建笔记本实例”按钮即可开始。它将提示笔记本实例设置。给它起一个好名字，选择ml.m2.instance，这是最低的，可以满足我们现在的目的。在处理“真实”模型时，我们可以选择更高的值。不要担心费用。AWS承诺我们按使用付费。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mt"><img src="../Images/50c7974da26a051160708602401553c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*UAl0Dr-NYoFX_LmJ.png"/></div></div></figure><p id="59d0" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">将其余部分保留为默认值，然后继续前进。</p><p id="5dd4" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们需要为笔记本创建一个IAM角色。请记住，我们的数据和模型需要放在我们刚刚创建的S3桶中。所以笔记本应该能接触到那个桶。我们不需要笔记本的任何其他特殊权限。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi my"><img src="../Images/df00a4cc0ba6eae4865ae92b05647dfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Ta_pGO8SjnwY1zqa.png"/></div></div></figure><p id="d8b0" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，我们可以开始“创建”了。AWS需要一些时间来准备笔记本。我们可以在控制台上看到笔记本实例处于“挂起”状态</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi mz"><img src="../Images/96f159960ad6cba22952e8f03012f859.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*KdHkzH9jCQLkd9EK.png"/></div></div></figure><p id="2ede" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让它按照自己的方式工作，因为AWS提供了底层实例，并为我们的目的做好了准备。准备就绪后，我们可以看到控制台显示笔记本实例“正在使用中”</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi na"><img src="../Images/711189f06ce6eafa80d649b71d00a1f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*p2mdZLmc-1QU76BR.png"/></div></div></figure><h1 id="4283" class="lw lx it bd ly lz ma mb mc md me mf mg ki mh kj mi kl mj km mk ko ml kp mm mn bi translated">JupyterLab</h1><p id="9cc8" class="pw-post-body-paragraph kz la it lb b lc mo kd le lf mp kg lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">一旦我们准备好了一个笔记本实例，我们就可以进一步创建一个JupyterLab。在笔记本实例控制台上，我们可以在Actions列中看到两个链接——Open Jupyter和Open JupyterLab。任何研究人工智能的人都知道什么是Jupyter笔记本。JupyterLab就是这样，带点AWS的味道在上面。那么，让我们点击JupyterLab。</p><p id="1c80" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将打开一个弹出窗口，如下所示:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nb"><img src="../Images/f160a5a838a07aba23dae55faa67a708.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EDrG-78nMMa1hRUa.png"/></div></div></figure><p id="640f" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它提供了几个现成的模板，也允许我们创建自己的模板。此时，我们想要构建自己的模板。因此，让我们沿着这条道路前进。点击文件-&gt;新建-&gt;笔记本</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nc"><img src="../Images/90f860d4b4b341693dc00054e33b09a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/0*f48h2pbvd9eesyWg.png"/></div></div></figure><p id="fd57" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">它会提示你为打开的Jupyter笔记本选择一个内核。我喜欢蟒蛇3。所以我选择那个。对于这个例子来说，这已经足够好了。好奇的人可以尝试使用其他内核。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/980f2ac01dc71c07c2381bddca81b06d.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/0*PlEIw6IJPuFDaXZe.png"/></div></figure><p id="c625" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这样，熟悉的Jupyter笔记本就出现了。我不喜欢“无标题”的笔记本。所以我把它改名为更有意义的名字。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ne"><img src="../Images/8d3d61f2ccece8b564e026741b557ecf.png" data-original-src="https://miro.medium.com/v2/resize:fit:638/format:webp/0*LT7gtT8WhF9lvFtR.png"/></div></figure><h1 id="f67d" class="lw lx it bd ly lz ma mb mc md me mf mg ki mh kj mi kl mj km mk ko ml kp mm mn bi translated">准备数据</h1><p id="bfc4" class="pw-post-body-paragraph kz la it lb b lc mo kd le lf mp kg lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">有了框架，我们现在可以继续构建模型了。当然，任何Python代码的第一步都是导入相关模块。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="3f0b" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，我们可以创建一些占位符变量，使我们的生活更简单。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="9ba3" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在基础工作已经准备好了，我们可以下载用于构建模型的数据了。我们从“deeplearning.net”上下载数据。一旦我们有了train文件，我们就提取数据并将其分成训练集、测试集和验证集。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="49f6" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在让我们看一看我们收集的数据。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="1080" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这给了我们一个输出</p><pre class="ks kt ku kv gt nh ni nj nk aw nl bi"><span id="df40" class="nm lx it ni b gy nn no l np nq">(50000, 784)<br/>(50000, )</span></pre><p id="0281" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们在训练集中有50，000条记录。这些都是28x28的图像。并且这些图像中的每一个都映射到一个值，该值是由该图像表示的数字。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="513f" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这显示了输出:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/8d9b237772e934d7ea5734a767c1e677.png" data-original-src="https://miro.medium.com/v2/resize:fit:296/format:webp/0*OGDk1hL3gWtIeA43.png"/></div></figure><p id="2dea" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">哇！我们有数据来训练模型。但是这个数据对我们的工作不利。我们需要对数据结构进行一些调整，以便为训练我们的模型做好准备。</p><p id="aab5" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">做完后，我们把它倒进我们的S3桶里。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h1 id="765d" class="lw lx it bd ly lz ma mb mc md me mf mg ki mh kj mi kl mj km mk ko ml kp mm mn bi translated">建立模型</h1><p id="d0c9" class="pw-post-body-paragraph kz la it lb b lc mo kd le lf mp kg lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">现在数据已经准备好了，让我们继续构建和部署可以用于我们工作的模型。</p><p id="373b" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在上面的代码中，我们将数据转储到S3桶中。我们可以使用对该数据的引用来输入我们的模式。因此，让我们从创建SageMaker将用于此目的的数据通道开始。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="8ac0" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">请注意,“data_channels”保存了我们训练模型所需的所有数据的引用。</p><p id="a82a" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">AWS为我们提供了一条连接SageMaker和S3的通道。这使得我们的工作非常简单。我们不必为此增加实例RAM的负担。</p><p id="fc92" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">SageMaker还帮助我们构建通用的训练算法。这些预先部署在ECS的码头集装箱上。SageMaker帮助我们直接链接到这些容器。我们所需要的就是一个API来为我们自己获取一个！</p><p id="3b43" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">所以，我们所做的就是:获取一个容器，实例化一个模型，然后训练它。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="719a" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最终的xgb_model.fit()在迭代构建模型时生成训练日志。最后，估算器已经准备好了。</p><h1 id="0dd6" class="lw lx it bd ly lz ma mb mc md me mf mg ki mh kj mi kl mj km mk ko ml kp mm mn bi translated">部署模型</h1><p id="3158" class="pw-post-body-paragraph kz la it lb b lc mo kd le lf mp kg lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">部署模型和流程的其余部分一样简单。我们所做的就是调用笔记本中的一个命令。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="05be" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这将部署模型并生成可以从我们的代码中调用的端点。</p><p id="4e2f" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以导航到sage maker-Models控制台。在那里，我们可以看到模型已经准备好了。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi ns"><img src="../Images/bebe2fe311e7c7858a7dda1f0c717b20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*MrERT0Lr2nvgn-fm.png"/></div></div></figure><p id="2c09" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以检查SageMaker —端点控制台。在这里，我们可以看到等待我们的终点。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="mu mv di mw bf mx"><div class="gh gi nt"><img src="../Images/c82983d4f22aec6464e550a370fc9366.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WDy_j3ON-0H6EOhD.png"/></div></div></figure><h1 id="5ee7" class="lw lx it bd ly lz ma mb mc md me mf mg ki mh kj mi kl mj km mk ko ml kp mm mn bi translated">λ函数</h1><p id="6897" class="pw-post-body-paragraph kz la it lb b lc mo kd le lf mp kg lh li mq lk ll lm mr lo lp lq ms ls lt lu im bi translated">剩下的都是小事。一旦我们部署了模型和端点，我们就可以创建一个Lambda函数，可以通过API网关调用它。Lambda函数可以像这样简单:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nf ng l"/></div></figure><p id="0648" class="pw-post-body-paragraph kz la it lb b lc ld kd le lf lg kg lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这在我们的例子中是可行的，因为我们使用的图像很小——784像素。将大量图像作为lambda函数的参数发送出去可能是不健康的。在这种情况下，我们可以创建一个迷你架构，将图像转储到一个S3桶中——这将触发Lambda函数对其进行解码，并通知进行调用的Amplify。</p></div></div>    
</body>
</html>