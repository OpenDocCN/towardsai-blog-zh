<html>
<head>
<title>Running SQL queries on Pandas</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Pandas上运行SQL查询</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/running-sql-queries-on-pandas-fc2985b95a4a?source=collection_archive---------2-----------------------#2021-08-09">https://pub.towardsai.net/running-sql-queries-on-pandas-fc2985b95a4a?source=collection_archive---------2-----------------------#2021-08-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7812" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="1bf2" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用SQL API与pandas DataFrame对象交互</h2></div><p id="4702" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在本文中，我将向您详细解释如何在您的编程环境中创建一个模拟的服务器和数据库，您可以在其中执行SQL查询。如果您赶时间，可以立即跳到文章末尾查看代码，如果您希望深入了解数据库是如何构造的，可以继续阅读。代码只需要几行，没什么太复杂的。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi ln"><img src="../Images/e3f904944d68530a80da6483d6abecc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aEaZ9ck4fbXdVUah"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">阿宝，功夫熊猫，2008</figcaption></figure><h2 id="daa1" class="md me it bd mf mg mh dn mi mj mk dp ml la mm mn mo le mp mq mr li ms mt mu iz bi translated">问题</h2><p id="8113" class="pw-post-body-paragraph kr ks it kt b ku mv kd kw kx mw kg kz la mx lc ld le my lg lh li mz lk ll lm im bi translated">不幸的是，没有太多的解决方案可以用来试验您的SQL数据库。您可以在线访问一些演示界面，我发现的一些允许您尝试SQL的解决方案是W3School或SQLite demo，使用起来很繁琐，尤其是如果您刚刚开始钻研数据库。</p><p id="0b1a" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">首先，在线关系数据库的最大问题是，有许多相似的可能性，不幸的是，它们彼此不兼容。这些是最常见的数据库管理系统(DBMS)类型:</p><ul class=""><li id="a71f" class="na nb it kt b ku kv kx ky la nc le nd li ne lm nf ng nh ni bi translated">Microsoft SQL，也称为MS SQL Server或简称SQL Server(只是为了让它更容易混淆)</li><li id="f60e" class="na nb it kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated">一种数据库系统</li><li id="d316" class="na nb it kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated">关系型数据库</li><li id="eaf8" class="na nb it kt b ku nj kx nk la nl le nm li nn lm nf ng nh ni bi translated">Oracle SQL</li></ul><p id="0379" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">DBMS充当数据库的中介，允许程序员发送查询来与数据交互。每个DBMS都为其自己的关系数据库工作，我们通常不能在PostgreSQL上使用MS SQL解决方案。</p><p id="8ec5" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">另一个大问题是定价:如果你想把你的实验提高到另一个水平，你显然需要一个在线数据库，至少可以做一些发送和接收数据的实验。用于构建连接到数据库的数据管道的大多数软件都是基于MS SQL的，不幸的是，我在网上没有找到任何免费的MS SQL空间。您可以找到MySQL和PostgreSQL的解决方案，例如，ElephantSQL，但无法连接到MS SQL专用工具，如Microsoft SQL Server Management Studio(SSMS)，这是一款用于探索MS SQL数据库的参考软件。</p><h2 id="5a86" class="md me it bd mf mg mh dn mi mj mk dp ml la mm mn mo le mp mq mr li ms mt mu iz bi translated">数据库如何工作</h2><p id="d92e" class="pw-post-body-paragraph kr ks it kt b ku mv kd kw kx mw kg kz la mx lc ld le my lg lh li mz lk ll lm im bi translated">数据库<strong class="kt jd">不是控制数据管理的最高抽象层次</strong>。相反，您首先需要创建一个能够控制多个数据库实例的活动服务器。每个数据库能够保存多个存储数据的表。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div role="button" tabindex="0" class="lt lu di lv bf lw"><div class="gh gi no"><img src="../Images/a0a4d27fecab298fc1bd1941ee8afc88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6Auq3W0bCk5_SIR6.jpg"/></div></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">师父，功夫熊猫，2008</figcaption></figure><p id="9550" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">因此，您不需要首先创建一个数据库，而是设置一个服务器。在本地环境中创建了服务器或服务器的模拟实例之后，最终可以创建一个包含一个或多个表的数据库。在向您展示python上的过程之前，让我们看一下数据库的架构。</p><h2 id="4d77" class="md me it bd mf mg mh dn mi mj mk dp ml la mm mn mo le mp mq mr li ms mt mu iz bi translated">将Pandas数据帧转换为SQL表</h2><p id="4cba" class="pw-post-body-paragraph kr ks it kt b ku mv kd kw kx mw kg kz la mx lc ld le my lg lh li mz lk ll lm im bi translated">在pandas上使用SQL相当简单，因为它只需要几行代码。然而，您需要理解为什么这些代码行能够工作，为什么您不能简单地使用SQL语言连接到pandas数据框架，但是您需要额外的工作来在您的本地编程环境中模拟数据集。</p><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi np"><img src="../Images/82799aa7b3bb75c38522bafdaf88473e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*CWjNQoNrTOCOqRDW5iULzg.png"/></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">关系数据库嵌套实例</figcaption></figure><p id="a0b7" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">关系数据库是以一种非常精确的方式组织的:有不同的结构层次用于掌握和管理存储数据的复杂性。首先，你需要一个服务器，这正是我们用python模拟的。</p><p id="3809" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">一台服务器可以托管一个或多个数据库。事实上，每当您决定购买一些SQL存储(可能的DBMS变体之一)时，您总是会被问到哪个服务器将托管您的数据库。每个应用程序或者如果足够大，应用程序的每个部分可以使用包含表的专用数据库。每个表格都相当于一个Excel电子表格，使它更容易理解。</p><p id="5d14" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">首先，我们需要创建一个可以存储在临时数据库中的DataFrame对象。这将允许您使用SQL API与数据进行交互，这是一个允许您(程序员)使用这种不同的计算机语言与数据(存储在python对象中)进行交互的接口。</p><pre class="lo lp lq lr gt nq nr ns nt aw nu bi"><span id="e8e2" class="md me it nr b gy nv nw l nx ny">import pandas as pd<br/>from sqlite3 import connect</span><span id="4bb8" class="md me it nr b gy nz nw l nx ny">df = pd.DataFrame([['a', 'b', 'c', 'd', 'e'], [100, 200, 300, 400, 500]]).T<br/>df</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/839d878b0fed3f41bb5e58432cb13690.png" data-original-src="https://miro.medium.com/v2/resize:fit:218/format:webp/1*B3eXntI_JCOUAVigU4u9Og.png"/></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">测向数据集</figcaption></figure><p id="fffb" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">虽然听起来可能很复杂，但是在编程环境中模拟本地服务器的操作可以通过一个名为sqlite3的库轻松完成。一旦你完成了这一步，你可以简单地将你的数据帧<strong class="kt jd"> df </strong>转移到<strong class="kt jd"> test_data </strong>表。</p><pre class="lo lp lq lr gt nq nr ns nt aw nu bi"><span id="b8d8" class="md me it nr b gy nv nw l nx ny">conn = connect(':memory:')<br/>df.to_sql('test_data', conn)</span></pre><p id="7963" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">现在，您可以使用<strong class="kt jd"> read_sql </strong>函数与该表进行交互并执行sql查询:</p><pre class="lo lp lq lr gt nq nr ns nt aw nu bi"><span id="cfc7" class="md me it nr b gy nv nw l nx ny">pd.read_sql('SELECT [0] FROM test_data WHERE [1]&gt;200', conn)</span></pre><figure class="lo lp lq lr gt ls gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/b1c539e78906d469abf598c6d43ce416.png" data-original-src="https://miro.medium.com/v2/resize:fit:130/format:webp/1*2S_R96rocf0KHaIQUbpDcA.png"/></div><figcaption class="lz ma gj gh gi mb mc bd b be z dk translated">应用于测向数据集的过滤方法</figcaption></figure></div></div>    
</body>
</html>