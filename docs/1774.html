<html>
<head>
<title>Code Migration: SAS to Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">代码迁移:SAS到Python</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/code-migration-sas-to-python-2d3a9e5baea8?source=collection_archive---------3-----------------------#2021-04-19">https://pub.towardsai.net/code-migration-sas-to-python-2d3a9e5baea8?source=collection_archive---------3-----------------------#2021-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="a3a1" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><p id="3266" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">本文的目标是建立对SAS编程的基本理解，并用Python编程语言重写该特性。作为演示的一部分，我必须用SAS构建一个小的ETL过程，并用Python重新设计。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ku"><img src="../Images/91c20adc9852fe532904dbc23aa656fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4VxsvQ41W424LKlyzqggPA.png"/></div></div></figure><ol class=""><li id="c5f1" class="lg lh iq jy b jz ka kd ke kh li kl lj kp lk kt ll lm ln lo bi translated"><strong class="jy ja">创建SAS库并导入数据集</strong></li></ol><pre class="kv kw kx ky gt lp lq lr ls aw lt bi"><span id="05a3" class="lu lv iq lq b gy lw lx l ly lz">--SAS library creation<br/>libname mylib '&lt;path&gt;';<br/></span><span id="dacd" class="lu lv iq lq b gy ma lx l ly lz">--import emp dataset<br/>DATA mylib.emp;  --&gt; <strong class="lq ja">Data step</strong><br/>	infile '/folders/myfolders/emp.csv'<br/>	dlm=','<br/>	FIRSTOBS=2 DSD;<br/>	input EMPNO ENAME $ SAL DEPTNO COMM;<br/>run;</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi mb"><img src="../Images/30d40337112d87fd97d29164e11ac1dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PvEqUaWF4EbEjhaM4CgUqw.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">emp数据集</figcaption></figure><pre class="kv kw kx ky gt lp lq lr ls aw lt bi"><span id="48fd" class="lu lv iq lq b gy lw lx l ly lz">DATA mylib.dept; --&gt; <strong class="lq ja">Data step</strong><br/>	infile '/folders/myfolders/dept.csv'<br/>	dlm=','<br/>	FIRSTOBS=2 DSD;<br/>	input DEPTNO DNAME $ LOC $;<br/>run;</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/0a940d1727775179b113f5ef8bda2b8d.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*Z_COCiDqyIvDvdFPo9RpiQ.png"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">部门数据集</figcaption></figure><p id="dc66" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja"> 2。SAS编程结构解释</strong></p><p id="4a1c" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">SAS编程包括三个基本步骤:-数据步骤、过程步骤和输出步骤。</p><p id="7f7e" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja">数据步骤</strong>包括将数据集加载到SAS存储器(RAM)中，变量识别(列在SAS中被称为变量)。简而言之，这一步是解析和数据加载的结合。在SAS中，数据或记录被称为观察值。</p><p id="5fc1" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja"> PROC步骤</strong>涉及数据分析部分，基本上是调用SAS内置程序来分析数据。</p><p id="d907" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja">输出步骤:</strong>打印或存储<strong class="jy ja">过程步骤的结果。</strong></p><p id="4be2" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja"> 3。SAS ETL </strong></p><p id="c032" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">下一步是对加载到SAS内存中的上述emp和dept数据集执行连接。但是SAS要求在加入之前对数据进行排序。</p><p id="941b" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">对EMP数据集进行排序，因为DEPT数据集已经按照连接键“DEPTNO”进行了排序</p><pre class="kv kw kx ky gt lp lq lr ls aw lt bi"><span id="e53b" class="lu lv iq lq b gy lw lx l ly lz">proc sort data=mylib.emp; --&gt; <strong class="lq ja">Proc step</strong><br/> by DEPTNO;</span></pre><p id="cda8" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">上面的步骤是proc步骤。</p><p id="1b92" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">接下来是对员工和部门数据集执行合并操作。</p><pre class="kv kw kx ky gt lp lq lr ls aw lt bi"><span id="abb2" class="lu lv iq lq b gy lw lx l ly lz">DATA mylib.emp_dept; --&gt; equi join<br/> merge mylib.dept(in=X) mylib.emp(in=Y);<br/> by DEPTNO;<br/> if X and Y;<br/>run;</span></pre><p id="fc77" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">SAS的默认连接策略是完全外部连接，不需要提及任何条件。在我们的例子中，连接是等价连接。</p><p id="7a55" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">让我们打破连接，试着理解什么是什么？</p><p id="787e" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja"> Merge: </strong>在SAS中，Merge是join操作的关键字。</p><p id="f73b" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja"> IN: in=val </strong>，代表只保留匹配值。</p><p id="79e2" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja">由:</strong>提及加入键。</p><p id="ef3b" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">当业务需要特定格式的输出时，对SAS变量(列)进行重新排序。</p><pre class="kv kw kx ky gt lp lq lr ls aw lt bi"><span id="2890" class="lu lv iq lq b gy lw lx l ly lz">#reorder SAS variables<br/>DATA mylib.emp_dept;<br/> retain EMPNO ENAME DEPTNO DNAME SAL COMM LOC;<br/> set mylib.emp_dept;<br/>run;</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi mh"><img src="../Images/35298c8a6993347447a876e8e2fc3c06.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*J2I10N23nrzIu8esiYBzsw.png"/></div></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">重新排序的输出如下</figcaption></figure><blockquote class="mi mj mk"><p id="85d2" class="jw jx ml jy b jz ka kb kc kd ke kf kg mm ki kj kk mn km kn ko mo kq kr ks kt ij bi translated"><strong class="jy ja">注:</strong>SAS中的空值用“.”表示</p></blockquote><p id="bab6" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">下一步是将表数据写入CSV文件。</p><pre class="kv kw kx ky gt lp lq lr ls aw lt bi"><span id="9573" class="lu lv iq lq b gy lw lx l ly lz">#write data to csv file<br/>proc export data=mylib.emp_dept<br/> outfile='/folders/myfolders/emp_dept.csv'<br/>    dbms= csv<br/>    replace; --&gt; to overwrite existing file, truncate load<br/>run;</span></pre><p id="6fd6" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">我们已经使用SAS编程成功地完成了ETL过程。下一步是使用Python编程复制或重新设计相同的代码。</p><p id="d984" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja"> 4。SAS程序的Python副本</strong></p><p id="9ef8" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">导入必备库和数据集。</p><pre class="kv kw kx ky gt lp lq lr ls aw lt bi"><span id="6127" class="lu lv iq lq b gy lw lx l ly lz">import pandas as pd<br/>emp_df= pd.read_csv(r’D:&lt;path&gt;\emp.csv’)<br/>emp_df.head(10)</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/c4b713b732a4eb02233c487327396b0b.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*8y-Lcv0K14fSF8LFsm4oSg.png"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">emp数据集</figcaption></figure><pre class="kv kw kx ky gt lp lq lr ls aw lt bi"><span id="3371" class="lu lv iq lq b gy lw lx l ly lz">dept_df= pd.read_csv('D:&lt;path&gt;\dept.csv’)<br/>dept_df.head(5)</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/02fa133a82f6ea44ed2ef343863f9890.png" data-original-src="https://miro.medium.com/v2/resize:fit:558/format:webp/1*rwzzkD1HTjLe0UH6pVGaeQ.png"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">部门数据集</figcaption></figure><pre class="kv kw kx ky gt lp lq lr ls aw lt bi"><span id="0d94" class="lu lv iq lq b gy lw lx l ly lz">#merge the dataset to perform inner join<br/>final_df=pd.merge(emp_df,dept_df[[‘DEPTNO’,’DNAME’,’LOC’]],on=’DEPTNO’,how=’inner’)<br/>final_df.head(10)</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/8474f462b06e64d64738f3009cc0a542.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*j-TYUolC7jBwfJPKXZLBqg.png"/></div><figcaption class="mc md gj gh gi me mf bd b be z dk translated">员工-部门合并数据</figcaption></figure><p id="b7b4" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">下一步是将合并的数据集写入CSV文件。</p><pre class="kv kw kx ky gt lp lq lr ls aw lt bi"><span id="e143" class="lu lv iq lq b gy lw lx l ly lz">#write pandas df to csv file<br/>final_df.to_csv(‘D:&lt;path&gt;\emp_dept.csv’,index=False)</span></pre><p id="fadb" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">我们已经成功地编写了CSV格式的输出，并且用python复制了SAS应用程序代码。</p><p id="d7eb" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">总而言之，首先，我们使用SAS编程设计了一个简单的ETL应用程序，然后使用Python编程重新设计了同一个应用程序。</p><p id="9243" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">感谢大家对内容的支持。</p></div></div>    
</body>
</html>