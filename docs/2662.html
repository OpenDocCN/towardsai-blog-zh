<html>
<head>
<title>Combinatorial PurgedKFold Cross-Validation for Deep Reinforcement Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用于深度强化学习的组合PurgedKFold交叉验证</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/combinatorial-purgedkfold-cross-validation-for-deep-reinforcement-learning-f8df689ca874?source=collection_archive---------0-----------------------#2022-04-05">https://pub.towardsai.net/combinatorial-purgedkfold-cross-validation-for-deep-reinforcement-learning-f8df689ca874?source=collection_archive---------0-----------------------#2022-04-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/1f402fc10f48e6e0e407babc3d15c018.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iwn3PGBxCeTMTXS3BX4Zng.jpeg"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图片作者。</figcaption></figure><div class=""/><p id="cb45" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">本文由开源项目AI4Finance的核心团队成员Berend Gort &amp; <a class="ae la" href="https://ai4finance.medium.com/" rel="noopener"> Bruce Yang </a>撰写。这个项目是一个<strong class="ke jg">开源</strong>社区，共享人工智能金融工具，也是纽约哥伦比亚大学的一部分。GitHub链接:</p><div class="ip iq gp gr ir lb"><a href="https://github.com/AI4Finance-Foundation" rel="noopener  ugc nofollow" target="_blank"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd jg gy z fp lg fr fs lh fu fw je bi translated">ai4金融基金会</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">一个共享金融AI工具的开源社区。FinRL:第一个用于财务强化的开源项目…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">github.com</p></div></div><div class="lk l"><div class="ll l lm ln lo lk lp ix lb"/></div></div></a></div><h1 id="fd04" class="lq lr jf bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">介绍</h1><p id="bff9" class="pw-post-body-paragraph kc kd jf ke b kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ms kx ky kz ij bi translated">我们的前一篇文章详细描述了具有常规预测的分类器(或回归器)的组合PurgedKFold交叉验证方法。这种策略允许多条回溯测试路径，而不是单一的历史路径。</p><p id="27ef" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">什么是有效的经验发现？在多次试验后，研究人员几乎总是会发现一种误导性的有利可图的技术，即假阳性。随机样本包括模式，在广阔的方法空间中进行系统的搜索，最终会发现一个从随机数据的机会配置中获益的方法。一个投资策略可能适合这样的运气。原因是一组参数被调整以最大化回测的性能。“回测过度拟合”是这种现象的术语。</p><p id="1e22" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">可以在多个回溯测试路径上执行统计上正确的改进分析，从而降低可忽略的错误发现的风险。我们之前的文章描述了传统的组合清除交叉验证可以为常规的机器学习回测做些什么。上一篇文章:</p><div class="ip iq gp gr ir lb"><a rel="noopener  ugc nofollow" target="_blank" href="/the-combinatorial-purged-cross-validation-method-363eb378a9c5"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd jg gy z fp lg fr fs lh fu fw je bi translated">组合清除交叉验证法</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">本文由开源项目AI4Finance的核心团队成员Berend Gort &amp; Bruce Yang撰写。这个…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">pub.towardsai.net</p></div></div><div class="lk l"><div class="mt l lm ln lo lk lp ix lb"/></div></div></a></div><p id="7f94" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这篇文章中，我们写的是一个想法，而不是它的执行。我们需要对构思过程的反馈，并展开讨论。</p><p id="843f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">新颖的想法</strong>是组合PurgedKFold交叉验证(CPCV)深度强化学习(DRL)；CPCV DRL 。对于这个想法的可行性有一些真正的担忧，解决方案可能会有问题。</p><p id="755e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在DRL领域应用这些想法是可取的，因为该方法在回测方面是样本有效的。具体来说，从~ 2018年开始，许多硬币只在密码领域上市。因此，用于训练和测试模型的数据有限。其余的基本原理在我们之前的文章中已经介绍过了。</p><h1 id="d97c" class="lq lr jf bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">简短介绍:交易的DRL</h1><p id="2055" class="pw-post-body-paragraph kc kd jf ke b kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ms kx ky kz ij bi translated">成功的交易者有自己的交易系统，能够根据基本面和技术面的分析做出合理的判断。然而，由于:密码市场的信息不对称，缺乏交易专业知识，以及人类的脆弱性，这些分析方法对于普通投资者来说很难付诸实践。强化学习代理可以学习到针对<strong class="ke jg">顺序</strong>选择问题的有效策略，并且已经在各种任务中超越人类，例如2019(！)Dota 2世界冠军。想象一下现在已经是2022年了。</p><p id="05e6" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">那么，一个RL代理可以训练，学习交易经验，并自动做出好的交易决策吗？如果有，这样的代理商交易业绩如何？</p><p id="7440" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">DRL需要一个完全代表实际交易所的加密交易空间环境。该环境用于训练/测试DRL代理。例如，在Atari gaming中，域的状态被定义为活动中最后X个连续的游戏屏幕，它是对环境的完整描绘。与上述确定性和无噪声的环境不同，加密价格是不稳定的，交易环境随时间变化。</p><p id="d285" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在加密交易中，状态向量可以是来自数据集的所有特征和关于交易账户的信息。例如:账户里有多少现金，<a class="ae la" href="https://medium.com/coinmonks/best-technical-indicators-for-bitcoin-fromta-lib-fa5518560e" rel="noopener">技术指标</a>，账户持有的可交易对的密码数量。图1显示了DRL如何在加密货币交易中盈利。有一个状态(交易者),可以对其执行操作(购买/出售/持有)。环境，在这种情况下，是贸易市场，奖励制度是利润。</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi mu"><img src="../Images/2343c6a8e5babb90dd9a0f61035622e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8TeRhsd5b_DuahlQ4xWQTA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图1:加密货币交易的DRL结构:交易者(代理人)，可以在CFD交易所(环境)购买、持有或出售(行为)，以获得利润(回报)。图片作者。</figcaption></figure><p id="784b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">好了，这就是快速总结。从这里，我们假设读者知道DRL(交易)算法，并想回测一个策略。在下一节中，我们将简要描述如何执行“单一”回溯测试。</p><h1 id="63a9" class="lq lr jf bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">传统DRL回溯测试</h1><p id="b85f" class="pw-post-body-paragraph kc kd jf ke b kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ms kx ky kz ij bi translated"><strong class="ke jg">基准</strong></p><p id="27d2" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">交易机器人的目标是最大化投资组合价值，同时对冲市场崩溃等风险。因此，需要对bot进行基准测试；与其他交易策略的有价值的比较。</p><p id="ed5a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">等权重(EQW)是一种比例测量技术，为投资组合、指数或指数基金中的每种加密货币分配相等的权重。简单来说:如果交易账户有100万美元，有4种感兴趣的加密货币，给每种货币分配25万，这称为EQW投资组合。</p><p id="84a3" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因此，当从整体上衡量集团的表现时，最小公司的加密钱包被赋予了与最大加密钱包相同的统计重要性或权重。初始投资组合价值的分配如下:</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/31a7c8f7f6ef6924e0492c1e40f21575.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*AuJBPW9LpEtnzN2IuFCMiw.png"/></div></figure><p id="13c8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">此后，投资组合的现值计算如下:</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div class="gh gi na"><img src="../Images/aa1214d879e653ac6789c8cfd3ca24c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:672/format:webp/1*aidba9xOSPpA8Cw7jBhMiA.png"/></div></figure><p id="d68b" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">这种策略的回报是最终投资组合价值除以初始投资组合价值。因此，等权投资策略相当于将现金平均分配给每个加密交易对，并留在那里。</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/435b905213e7ce2cde6bc98e9643d2b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:322/format:webp/1*foEuIb7tVjVrs7tXEn1vxQ.png"/></div></figure><p id="8d49" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">夏普比率</strong></p><p id="d6c7" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">夏普比率是一种金融统计数据，它将投资(如加密投资)的绩效与考虑风险后的无风险资产的绩效进行比较。它被定义为投资回报和无风险回报率之间的差异，除以其标准差(即其波动性)。它是投资者因风险增加而获得的增加的回报。夏普比率是计算风险调整回报率最广泛使用的方法之一。夏普比率的公式如下:</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/317d733180c373d7f35300eb369c8449.png" data-original-src="https://miro.medium.com/v2/resize:fit:898/format:webp/1*WSHbEF6epHy0nNY3x4ctdA.png"/></div></figure><p id="c04a" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">R(a)是资产收益，R(b)是无风险收益。e[R(a)-R(b)]是资产收益超过基准收益的预期值，σ(a)是资产超额收益的标准差。DRL代理的目标是最大化回报，同时最小化风险。因此，夏普比率将被用作超参数优化的目标。</p><p id="91d8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">型号选择</strong></p><p id="e89c" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">历史数据集存在于三个不同的时期:</p><ul class=""><li id="363d" class="nd ne jf ke b kf kg kj kk kn nf kr ng kv nh kz ni nj nk nl bi translated">训练数据(样本内，IS)</li><li id="d46a" class="nd ne jf ke b kf nm kj nn kn no kr np kv nq kz ni nj nk nl bi translated">验证数据(样本内，是)</li><li id="61b9" class="nd ne jf ke b kf nm kj nn kn no kr np kv nq kz ni nj nk nl bi translated">贸易数据(样本外，OOS)</li></ul><p id="3b53" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">图2是由训练和验证阶段的数据组成的周期。在超参数优化过程中，训练集和验证集用于获得训练有素的模型。<strong class="ke jg">在例如100次试验之后，选择具有最高夏普比率的模型。</strong>在图2中，黄色的“评估”检查点显示了对该选择流程的评估。</p><p id="407f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">如果在该特定优化期间，训练模型的夏普比率是迄今为止最高的，则该模型被保存用于下一阶段(模型模拟)。</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nr"><img src="../Images/0c5f719a14f1dcbfa05ac2c45d57ff45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Fc4Lw2e9rjFOblBuPVZNcA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图2:在<strong class="bd ls">模型选择阶段的数据分割、训练和验证。</strong>来自验证评估结果的最佳模型保存在磁盘上，用于实时部署。图片作者。</figcaption></figure><p id="e104" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">模型模拟示例</strong></p><p id="f295" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">之后，样本外交易数据用于回测“最佳”代理的实时交易表现(图3)。因此，DRL代理人没有经过OOS数据的训练或验证，无法产生假设为实时交易表现的结果。</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ns"><img src="../Images/ce8d9a1ea090a0717dd39aeaade34ad6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gdujOW5cDmmH0AjIpeLMMg.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图3: <strong class="bd ls">在模型选择阶段</strong>产生最佳模型后，剩余的样本外交易数据用于评估DRL代理的实时性能。图片作者。</figcaption></figure><p id="8491" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在这一阶段，计算代理的实际盈利能力。有五个主要指标来评估结果。</p><ul class=""><li id="5c5c" class="nd ne jf ke b kf kg kj kk kn nf kr ng kv nh kz ni nj nk nl bi translated">累积回报:从投资组合的起始值中减去最终值，然后除以初始值。</li><li id="1076" class="nd ne jf ke b kf nm kj nn kn no kr np kv nq kz ni nj nk nl bi translated">年化收益:它们是该策略年收益的几何平均值。</li><li id="48c5" class="nd ne jf ke b kf nm kj nn kn no kr np kv nq kz ni nj nk nl bi translated">年化波动率:投资组合回报的年化标准差。</li><li id="736e" class="nd ne jf ke b kf nm kj nn kn no kr np kv nq kz ni nj nk nl bi translated">夏普比率:用年化收益减去年化无风险利率，然后除以年化波动率。</li><li id="d9d0" class="nd ne jf ke b kf nm kj nn kn no kr np kv nq kz ni nj nk nl bi translated">最大下降:时间范围内的最低点减去最高点的值。</li></ul><p id="6f47" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">解释性分析及结果</strong></p><p id="803e" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">结果如图4所示。1m、5m、…、2h、4h是加密数据的烛光宽度。这些精确的结果是通过在每个时间段运行100次超参数调谐器，然后运行<strong class="ke jg">模型模拟</strong>过程获得的。</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nt"><img src="../Images/c0609362b7aecfdc4f2846721b30e164.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yMcWH5xIHaosL4DPBSO8pA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图4:表格显示了不同时间段的交易指标。图片作者。</figcaption></figure><p id="9263" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">图4展示了DRL代理在多个方面优于等权基准。从图4中可以看出，就夏普比率而言，每一家DRL代理都优于基准。等重策略的夏普比率为0.02，而2h和4h的夏普比率分别为0.47和0.55。代理的年化回报率也明显更高。等权重策略管理47.2%，在这个特定的时间框架内比其他策略差。因此，这些发现表明，拟议的DRL代理人可以有效地制定一个交易策略，跑赢了基线。</p><p id="3df7" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">根据图4，2h或4h时间框架似乎是最好的。2h时间框架的超额收益足够显著，可以忽略年度波动性的下降。因此，选择了2h模型，并将在OOS交易数据上部署<strong class="ke jg">。图5显示了所选的部署模型与基准的对比，直观地显示了它的不稳定性更小、消耗更少、风险更小、回报更高。</strong></p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nu"><img src="../Images/2d8ab7b0d8dde50398fa11ac50005c2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9ChZ3bROq3Mr8ZXVUQuinQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图5: <strong class="bd ls">所有2h时间段DRL代理(PPO)的样本外</strong>交易结果与等权策略的比较。图片由作者提供。</figcaption></figure><p id="9557" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><strong class="ke jg">回测侥幸</strong></p><ul class=""><li id="2b3f" class="nd ne jf ke b kf kg kj kk kn nf kr ng kv nh kz ni nj nk nl bi translated"><em class="nv">我们重复:</em></li></ul><p id="e342" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在多次试验后，研究人员几乎总是会发现一种误导性的有利可图的技术，即假阳性。随机样本包括模式，在广阔的方法空间中进行系统的搜索最终会发现一个从随机数据的机会配置中获益的方法。一个投资策略可能适合这样的运气。尤其是当调整一组参数以最大化回测性能时。“回测过度拟合”是这种现象的术语。</p><ul class=""><li id="b1a3" class="nd ne jf ke b kf kg kj kk kn nf kr ng kv nh kz ni nj nk nl bi translated"><em class="nv">关于上一节:</em></li></ul><p id="ced8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们怀疑提议的回溯测试策略中的<strong class="ke jg">模型选择</strong>部分存在问题。如上所述，我们已经对验证结果进行了100次超参数试验，并选择了在该时间段内提供最高夏普比率的模型。我们做的试验越多，我们在验证集上“走运”的可能性就越大。</p><p id="b7d3" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">让我们转到新的想法，它降低了超参数优化器找到“幸运”结果的风险。我们不想走运；我们希望被算计。</p><h1 id="0c3d" class="lq lr jf bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">新颖的想法:CPCV DRL</h1><p id="f158" class="pw-post-body-paragraph kc kd jf ke b kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ms kx ky kz ij bi translated">如果读者还没有读过我们之前的文章，我们建议你先读一下。在那篇文章中，我们描述了传统机器学习的组合PurgedKFold交叉验证方法。文章:</p><div class="ip iq gp gr ir lb"><a rel="noopener  ugc nofollow" target="_blank" href="/the-combinatorial-purged-cross-validation-method-363eb378a9c5"><div class="lc ab fo"><div class="ld ab le cl cj lf"><h2 class="bd jg gy z fp lg fr fs lh fu fw je bi translated">组合清除交叉验证法</h2><div class="li l"><h3 class="bd b gy z fp lg fr fs lh fu fw dk translated">本文由开源项目AI4Finance的核心团队成员Berend Gort &amp; Bruce Yang撰写。这个…</h3></div><div class="lj l"><p class="bd b dl z fp lg fr fs lh fu fw dk translated">pub.towardsai.net</p></div></div><div class="lk l"><div class="mt l lm ln lo lk lp ix lb"/></div></div></a></div><p id="86b4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">我们展示了CombPurgedKFoldCV方法的主要结果(图6)。</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nw"><img src="../Images/3ad7df7f693bc17bd304fe72bc29591b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-zIcqDu_jnPPkBAcEtQ4HA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图6:组合PurgedKFoldCV。数据可以以15种可能的方式(S1-S15)分割，N=6组，其中k=2个验证组。图片作者。</figcaption></figure><p id="8c82" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">对于每个数据分割，这与传统的交叉验证是一样的:我们对蓝色数据进行训练，对读取的数据进行测试。<strong class="ke jg">然而，在下一节中，我们将介绍如何将组合清除K-fold交叉验证应用于DRL。</strong></p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nx"><img src="../Images/a427dfec0e9290fb956a148d98246731.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZsZ8VT1KJAv4mDPWOUAAvQ.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图7:验证期间预测的单个分割和动作的例子。图片作者。</figcaption></figure><p id="7767" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">参见图7；我们在验证阶段保存所有操作，而不是只查看一次分割的夏普比率。因此，我们像往常一样训练和验证，除了我们看DRL代理的最佳预测行为，它代表了基本的交易策略。</p><p id="6726" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">请注意，我们现在已经突出显示了验证组(图2，图6)。</p><ul class=""><li id="8840" class="nd ne jf ke b kf kg kj kk kn nf kr ng kv nh kz ni nj nk nl bi translated">Split 1 || <strong class="ke jg"> train </strong> : (G3，S1)，(G4，S1)，(G5，S1)，(G6，S1) || <strong class="ke jg">验证</strong> : (G1，S1)，(G2，S1) || → <strong class="ke jg"> DRL代理1 </strong> →动作y(1，1)，y(1，2) on (G1，S1)，(G2，S1)</li><li id="5bdd" class="nd ne jf ke b kf nm kj nn kn no kr np kv nq kz ni nj nk nl bi translated">Split 2|| <strong class="ke jg"> train </strong> : (G2，S2)，(G4，S2)，(G5，S2)，(G6，S2) || <strong class="ke jg">验证</strong> : (G1，S2)，(G3，S1)| |→<strong class="ke jg">DRL agent 2</strong>→actions y(1，2)，y(3，2) on (G1，S2)，(G3，S2)</li><li id="d40d" class="nd ne jf ke b kf nm kj nn kn no kr np kv nq kz ni nj nk nl bi">…….</li><li id="512c" class="nd ne jf ke b kf nm kj nn kn no kr np kv nq kz ni nj nk nl bi translated">拆分15|| <strong class="ke jg">列车</strong> : (G1，S15)，(G2，S15)，(G3，S15)，(G4，S15) || <strong class="ke jg">验证</strong> : (G5，S15)，(G6，S15) || → <strong class="ke jg"> DRL代理15 </strong> →动作y(5，15)，y(6，15) on (G5，S15)，(G6，S15)</li></ul><p id="48b8" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">DRL本身就是一个向前行走的算法；这是一种顺序算法。因此，对于每一个分割，DRL代理将通过验证数据执行一个向前遍历的路径来获得动作。我们将这些动作保存在一个矩阵中，该矩阵对应于图6所示的组和分割。</p><p id="c0c1" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">新型号选择流程见图8。首先，我们选择哪个部分用于样本内部分(训练和验证数据)以及我们想要对哪个数据进行最终回测(交易数据)。之后，我们在每次分割的训练数据上训练DRL代理(图6 ),并在验证数据上以一种向前推进的方式评估每个代理，在每个数据点产生动作。</p><p id="8028" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">根据图6存储每个数据点的这些动作。因此，我们可以将DRL代理在验证阶段产生的动作视为“预测”(如前一篇文章)。这些“行动/预测”代表了该时间段的基本交易策略。最后，就像在上一篇文章中一样，我们可以形成5条独特的路径来对我们的策略进行回溯测试。</p><p id="b621" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">在我们的超参数优化器中，我们使用所有5条回溯测试路径的平均夏普比率作为优化循环的最终评估器。<strong class="ke jg">即使经过多次试验，我们也显著降低了单个验证路径过度拟合的风险！</strong></p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ny"><img src="../Images/86202e9bfc866a8bc0611e2d289c5de2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_pzsfYTTAzuxbGgqWZLuJA.png"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">图8:在DRL模型选择阶段组合采购折叠的新想法。图片作者。</figcaption></figure><p id="aa92" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">因为研究人员会选择估计夏普比率最高的回溯测试，即使夏普比率为零，WF的高方差也会导致错误的发现。这就是为什么在进行WF回测时，考虑试验的数量是至关重要的。</p><p id="479f" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">由于CPCV DRL，现在可以计算家族错误率(FWER)、错误发现率(FDR)或回测过度拟合概率(PBO)。相比之下，CPCV从大量路径(j = 1，…，𝜑.)中导出夏普比率的分布分布的平均夏普比率是平均值E[{y i，j } (j=1,…,𝜑 )] = 𝜇和方差𝜎 [{y i，j } (j=1,…,𝜑 )] = 𝜎 (i)。</p><p id="b035" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">另一方面，CPCV从大量路径计算夏普比率分布，j = 1，…，𝜑.平均值E[{y i，j} j=(1，…，𝜑)] =𝜇和方差𝜎 [{y i，j }(j=1，…，𝜑)] = 𝜎 (i)是分布的平均夏普比率。CPCV途径的样本均值方差为:</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nz"><img src="../Images/1a837a3872950fb0f92a108452cb4cfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C5yqOc5xzI_2RtSa_lirzQ.png"/></div></div></figure><p id="38c5" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">其中，𝜎 (i)是策略I的路径上的夏普比率的方差，α(i)是{y，I，j } (j=1,…,𝜑).)之间的平均非对角相关CPCV导致比CV和WF更少的错误，因为α(i) &lt; 1 implies that the variance of the sample means is lower than the variance of the sample. Imagine we have (almost) no correlation between the backtest paths to put matters into perspective. If no correlation is assumed, then α(i) ≪ 1. The Equation above will reduce to:</p><figure class="mv mw mx my gt is gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/08aee209caac97b43bbcb048e36ece91.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*p6_Bf8jjcrAFN6Gf8GNgWQ.png"/></div></figure><p id="9478" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">As a result, the lower the variance of CPCV, the<strong class="ke jg">统计上有效的夏普比率</strong>E【y(I)I】将被报告为在<em class="nv"> φ </em> →∞的极限内具有零方差(通向无穷大的路径的数量)。因为策略是从i = 1，…中选择的，我将拥有最高的统计有效夏普比率，所以不会有选择偏差。</p><p id="10ca" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">最后，路径越多，方差就越小，我们就越接近<strong class="ke jg">统计上有效的夏普比率</strong>。但是，路径的数量上限是可用数据的数量。尽管如此，对于足够多的𝜑路径，CPCV可以使回溯测试的方差小到可以忽略错误发现的概率。</p><h1 id="618e" class="lq lr jf bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">结论</h1><p id="0500" class="pw-post-body-paragraph kc kd jf ke b kf mo kh ki kj mp kl km kn mq kp kq kr mr kt ku kv ms kx ky kz ij bi translated">在前一篇文章中，探讨了组合清除交叉验证方法。然后，本文建议将这种方法推广到DRL域。总结了传统WF方法存在的问题。之后，介绍了DRL的交易。随后，概述了传统的DRL回测，这是一个完整的回测分析。最后，以可能可行的方式提出了用DRL进行组合净化交叉验证的新颖想法。该方法可以使模型选择过程更接近统计上有效的夏普比率。</p><p id="d9c4" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="nv">感谢您深入了解“深度强化学习的组合PurgedKFold交叉验证”！</em></p><p id="89d9" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated"><em class="nv"> ~贝伦德&amp;布鲁斯</em></p><h1 id="ce04" class="lq lr jf bd ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn bi translated">参考</h1><ol class=""><li id="f1f4" class="nd ne jf ke b kf mo kj mp kn ob kr oc kv od kz oe nj nk nl bi translated">贝利博士和洛佩兹·普拉多博士，2014年。缩小的夏普比率:校正选择偏差，回测过度拟合和非正态性。<em class="nv"> SSRN电子杂志</em>。</li></ol><p id="2884" class="pw-post-body-paragraph kc kd jf ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz ij bi translated">2.普拉多医学博士。(2018).<em class="nv">金融机器学习的进展</em>。</p></div></div>    
</body>
</html>