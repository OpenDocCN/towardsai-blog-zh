<html>
<head>
<title>AWS S3 Read Write Operations Using the Pandas API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pandas API的AWS S3读写操作</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/aws-s3-read-write-operations-using-the-pandas-api-ae624c4bd1a0?source=collection_archive---------1-----------------------#2021-01-25">https://pub.towardsai.net/aws-s3-read-write-operations-using-the-pandas-api-ae624c4bd1a0?source=collection_archive---------1-----------------------#2021-01-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="d4bd" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><p id="b7ae" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">这篇博客的目的是建立对亚马逊网络存储服务“S3”的基本读写操作的理解。更具体地说，使用Pandas读取CSV文件，并将数据帧写入AWS S3存储桶，反之亦然，使用Pandas API从S3存储桶读取相同的文件。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi ku"><img src="../Images/811e98b635ad6cd3f42d7be6ca067030.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*QeQHnw-mWG3McdfxNGfIcw.png"/></div></figure><h1 id="908e" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">1.必备库</h1><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="b799" class="mf ld iq mb b gy mg mh l mi mj">import boto3<br/>import pandas as pd<br/>import io</span></pre><h1 id="6908" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated"><strong class="ak"> 2。使用熊猫</strong>读取CSV文件</h1><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="1787" class="mf ld iq mb b gy mg mh l mi mj">emp_df=pd.read_csv(r’D:\python_coding\GitLearn\python_ETL\emp.dat’)<br/>emp_df.head(10)</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/5fe2cee9c0277541521459a7eb98dcc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:726/format:webp/1*1MXOMYyCRQB27phyJgV6ZQ.png"/></div></figure><h1 id="7e74" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">3.给S3自动气象站写熊猫数据帧</h1><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="e8a9" class="mf ld iq mb b gy mg mh l mi mj">from io import StringIO</span><span id="52f6" class="mf ld iq mb b gy ml mh l mi mj">REGION = ‘us-east-2’<br/>ACCESS_KEY_ID = xxxxxxxxxxxxx’<br/>SECRET_ACCESS_KEY = ‘xxxxxxxxxxxxxxxx’</span><span id="bba2" class="mf ld iq mb b gy ml mh l mi mj">BUCKET_NAME = ‘pysparkcsvs3’<br/>FileName=’pysparks3/emp.csv’</span><span id="5379" class="mf ld iq mb b gy ml mh l mi mj">csv_buffer=StringIO()<br/>emp_df.to_csv(csv_buffer, index=False)</span><span id="5c3a" class="mf ld iq mb b gy ml mh l mi mj">s3csv = boto3.client(‘s3’, <br/> region_name = REGION,<br/> aws_access_key_id = ACCESS_KEY_ID,<br/> aws_secret_access_key = SECRET_ACCESS_KEY<br/> )</span><span id="0874" class="mf ld iq mb b gy ml mh l mi mj">response=s3csv.put_object(Body=csv_buffer.getvalue(),<br/>                           Bucket=BUCKET_NAME,<br/>                           Key=FileName)</span></pre><p id="db2d" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">根据<strong class="jy ja"> Boto3 </strong>文档:“<em class="mm"> Boto是Python的亚马逊网络服务(AWS) SDK。它使Python开发人员能够创建、配置和管理AWS服务，如EC2和S3。</em>”</p><p id="1276" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja"> StringIO: </strong>是内存中类似文件的对象。<a class="ae mn" href="https://pymotw.com/2/StringIO/#module-StringIO" rel="noopener ugc nofollow" target="_blank"> StringIO </a>提供了一种使用文件API(读、写)在内存中处理文本的便捷方法。等等。).这个对象可以用作需要标准文件对象的函数的输入或输出。创建StringIO对象时，通过向构造函数传递一个字符串来初始化它。如果没有字符串被传递，StringIO将开始为空。</p><p id="ec44" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja"> getvalue() </strong>方法返回文件的全部内容。</p><p id="665c" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">让我们检查一下该文件在AWS S3 bucket "<strong class="jy ja">pysparkcsvs 3</strong>上是否可用</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mo"><img src="../Images/3e1eb799b97fc0f113faf220d418376a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UO9p8p7wDERz4olfBhycKQ.png"/></div></div></figure><p id="2a94" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">csv文件已成功上传到S3存储桶。</p><h1 id="0f40" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">4.阅读自动气象站S3文件到熊猫数据框</h1><pre class="kv kw kx ky gt ma mb mc md aw me bi"><span id="b1f3" class="mf ld iq mb b gy mg mh l mi mj">REGION = ‘us-east-2’<br/>ACCESS_KEY_ID = ‘xxxxxxxxx’<br/>SECRET_ACCESS_KEY = ‘xxxxxxxxx’</span><span id="cbbe" class="mf ld iq mb b gy ml mh l mi mj">BUCKET_NAME = ‘pysparkcsvs3’<br/>KEY = ‘pysparks3/emp.csv’ # file path in S3 </span><span id="9705" class="mf ld iq mb b gy ml mh l mi mj">s3c = boto3.client(‘s3’, <br/> region_name = REGION,<br/> aws_access_key_id = ACCESS_KEY_ID,<br/> aws_secret_access_key = SECRET_ACCESS_KEY)</span><span id="a1be" class="mf ld iq mb b gy ml mh l mi mj">obj = s3c.get_object(Bucket= BUCKET_NAME , Key = KEY)</span><span id="8c8e" class="mf ld iq mb b gy ml mh l mi mj">emp_df = pd.read_csv(io.BytesIO(obj[‘Body’].read()),            encoding='utf8')<br/>emp_df.head(5)</span></pre><p id="b5cc" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja"> obj </strong>是字典格式的HTTP响应，参考下文。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="mp mq di mr bf ms"><div class="gh gi mt"><img src="../Images/552ddd56b9db782319dedf303f6c8bef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5dDASFaygqaXx4m9G3qV9A.png"/></div></div></figure><p id="437f" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja"> get_object() r </strong>从亚马逊S3桶中获取对象。要获取对象，用户必须具有读取权限。</p><p id="d1d6" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">木卫一。Bytesio() 当我们使用IO模块的字节IO操作时，数据可以作为字节保存在内存缓冲区中。</p><p id="a172" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">验证从S3检索的数据。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/abe8845d39cb0b70e49772bd5b86d401.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*ZxD1Q4nTJYCCSw5NOmnqrQ.png"/></div></figure><p id="ba1c" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">从存在于AWS S3存储桶中的CSV文件中检索的数据看起来很好，并且字符串-字节转换成功完成。</p><h1 id="7836" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">总结:</h1><p id="a780" class="pw-post-body-paragraph jw jx iq jy b jz mv kb kc kd mw kf kg kh mx kj kk kl my kn ko kp mz kr ks kt ij bi translated">Pandas API与S3自动气象站的连接</p><p id="f215" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">向S3存储器读写熊猫数据帧</p><p id="0560" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">Boto3用于连接S3</p><p id="2b6c" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">感谢大家阅读我的博客。请分享您的观点或反馈。</p></div></div>    
</body>
</html>