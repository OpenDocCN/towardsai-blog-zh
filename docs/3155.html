<html>
<head>
<title>Super Flexible Matplotlib Structure for Subplots</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">超级灵活的Matplotlib子情节结构</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/super-flexible-matplotlib-structure-for-subplots-d26b005252f1?source=collection_archive---------1-----------------------#2022-09-26">https://pub.towardsai.net/super-flexible-matplotlib-structure-for-subplots-d26b005252f1?source=collection_archive---------1-----------------------#2022-09-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1b40" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">一图多轴</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/072b103502a82c77f9cdc0b0ca6c46ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bL2IYTOsqrUEuuZMQB5Zpw.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Brannon Naito 在<a class="ae ky" href="https://unsplash.com/s/photos/flexible?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="8772" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Matplotlib是我在数据科学之旅中了解的第一批库之一。令我惊讶的是，它允许在可视化界面上定制几乎所有的东西。</p><p id="6875" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种超级灵活的结构也可以通过支线剧情观察到。在这篇文章中，我们将学习用支线剧情创建人物的不同方法，以及正确使用支线剧情的一些技巧。</p><p id="3cc1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在继续之前，让我们定义两个基本的Matplotlib对象类型:<em class="lv">图</em>和<em class="lv">轴</em>。</p><p id="3244" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个图形可以被认为是最外层的容器，它把所有的东西放在一起。所有其他对象在该容器中保持活动状态。一个图形可以有一个或多个轴对象。事实上，我们需要轴来反对实际绘制东西。图形上的每个子情节实际上是一个轴对象。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a906" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">数据集</h1><p id="56ea" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">对于本文中的例子，我们将使用两个不同的数据集。第一个是熊猫数据框，有日期和随机数:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="c1c7" class="nf me it nb b gy ng nh l ni nj">import pandas as pd</span><span id="71aa" class="nf me it nb b gy nk nh l ni nj">df = pd.DataFrame({<br/>    "date": pd.date_range(start="2022-09-01", freq="D", periods=20),<br/>    "store1": np.random.randint(80, 100, size=20),<br/>    "store2": np.random.randint(50, 70, size=20)<br/>})</span><span id="c5d1" class="nf me it nb b gy nk nh l ni nj">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/240bebaec2290a4b8ccb773215269526.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nTCbeqszzLbM1f5OGU1qCA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</figcaption></figure><p id="ce62" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第二个是我用模拟数据创建的示例销售数据集。你可以从我的GitHub页面上的<a class="ae ky" href="https://github.com/SonerYldrm/datasets" rel="noopener ugc nofollow" target="_blank">数据集</a>库中下载。我们将在本文中使用的数据集称为商店销售数据。让我们通过读取这个数据集来创建一个熊猫数据帧。我们还将做一些过滤，以消除离群值。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="7549" class="nf me it nb b gy ng nh l ni nj">sales = pd.read_csv(<br/>   "sales_data_with_stores.csv",<br/>   usecols=["store","product_code","cost","price","last_week_sales"]<br/>)</span><span id="0c76" class="nf me it nb b gy nk nh l ni nj">sales = sales[<br/>   (sales["cost"]&gt;50) &amp; (sales["cost"]&lt;500)<br/>].reset_index(drop=True)</span><span id="cd0b" class="nf me it nb b gy nk nh l ni nj">sales.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nl"><img src="../Images/77a085e3fa8e7885f82988f5b632c6e2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bJOIv35p-AeURz2kWR1YXA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</figcaption></figure></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a8fc" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">重叠轴对象</h1><p id="1d08" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们可以将多个轴对象叠加到一个图形上，如下所示。它们的大小其实是一样的。出于演示的目的，我把它们画得不同。默认情况下，轴对象共享相同的x轴和y轴。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/9ee32c67be2a505bd6e903c3b35d4596.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oyhXfxNvbr94pQ9TwBAXzg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</figcaption></figure><p id="3ed2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种情况的一个例子是在同一个图形上创建两个线图。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="0c36" class="nf me it nb b gy ng nh l ni nj">import matplotlib.pyplot as plt</span><span id="611c" class="nf me it nb b gy nk nh l ni nj"># create a Figure object<br/>plt.figure(figsize=(14,5))</span><span id="3f1a" class="nf me it nb b gy nk nh l ni nj"># Figure title<br/>plt.title("September Sales", fontsize=15)</span><span id="1664" class="nf me it nb b gy nk nh l ni nj"># first Axes<br/>plt.plot(df["date"], df["store1"])</span><span id="9e9f" class="nf me it nb b gy nk nh l ni nj"># second Axes<br/>plt.plot(df["date"], df["store2"])</span><span id="d9d3" class="nf me it nb b gy nk nh l ni nj"># add legend<br/>plt.legend(["Store1", "Store2"])</span><span id="e687" class="nf me it nb b gy nk nh l ni nj">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/44607ba8047f2deff73e804b37addc67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3VRQYb-Cgc7l4-ze01HYlw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</figcaption></figure><p id="afa9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">两个商店的值都在50和100之间，因此它们可以共享同一个y轴。在y值差异巨大的情况下，我们应该考虑增加一个<a class="ae ky" href="https://towardsdatascience.com/3-tricks-to-prettify-matplotlib-plots-d0a73b861c09" rel="noopener" target="_blank">辅助y轴</a>。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="a6ef" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">将对象置于不同的位置</h1><p id="f2e7" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">我们还可以在图形的不同位置放置轴对象。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nm"><img src="../Images/fc51cc4b4708151c54ba2194321d62a2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C4SkygXQOdNAI8LFaQkyVQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</figcaption></figure><p id="14ff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个过程有两个步骤:</p><ul class=""><li id="d049" class="no np it lb b lc ld lf lg li nq lm nr lq ns lu nt nu nv nw bi translated">轴对象位置的排列</li><li id="cedf" class="no np it lb b lc nx lf ny li nz lm oa lq ob lu nt nu nv nw bi translated">在每个轴对象上创建图</li></ul><p id="bb4c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">可以使用add_subplot或subplot函数进行排列。subplot函数是add_subplot的包装器，是比较常用的一个。</p><p id="03fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们首先创建支线剧情的模式。nrows和ncols参数可用于此任务。例如，下面的代码行创建了一个有4个轴对象的图形。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="1553" class="nf me it nb b gy ng nh l ni nj">fig, axs = plt.subplots(nrows=2, ncols=2)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/a28f02604860e5ebd88558d76ee06d2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rbaNjFkBnU08WqE96CHjWQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</figcaption></figure><p id="3358" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以根据需要创建任意数量的轴对象。每个轴都可以通过其索引来访问。</p><p id="4106" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们创建一个有两个轴的图形，并在销售数据帧中绘制成本和价格列的直方图。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="929c" class="nf me it nb b gy ng nh l ni nj"># Figure with 2 Axes objects<br/>fig, axs = plt.subplots(<br/>    figsize=(10,5),<br/>    ncols=2,<br/>    sharey=True<br/>)</span><span id="fbe1" class="nf me it nb b gy nk nh l ni nj"># Figure title<br/>fig.suptitle("Histogram", fontsize=16)</span><span id="7508" class="nf me it nb b gy nk nh l ni nj"># First Axes<br/>axs[0].hist(sales["price"])<br/>axs[0].set_title("Price", fontsize=14)</span><span id="ad41" class="nf me it nb b gy nk nh l ni nj"># Second Axes<br/>axs[1].hist(sales["cost"], color="green")<br/>axs[1].set_title("Cost", fontsize=14)</span><span id="f330" class="nf me it nb b gy nk nh l ni nj">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi od"><img src="../Images/ff33c41b6095a70ccfbd0a19807442b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*WSr9mveiSOwUSXlOlIKQsg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</figcaption></figure><p id="346c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">sharex和sharey参数可用于消除多余的轴刻度。例如，在上图中，两个图可以有相同的y轴，所以我们可以从左边的图中去掉y轴。这可以通过将sharey参数的值设置为True来实现。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><h1 id="98f7" class="md me it bd mf mg mh mi mj mk ml mm mn jz mo ka mp kc mq kd mr kf ms kg mt mu bi translated">子图2网格</h1><p id="5a4b" class="pw-post-body-paragraph kz la it lb b lc mv ju le lf mw jx lh li mx lk ll lm my lo lp lq mz ls lt lu im bi translated">subplot函数将图形分成单元格，每个subplot占用一个单元格。subplot2grid函数为此增加了更多的灵活性。它让支线剧情占据多个单元格，所以我们可以创建如下所示的网格结构:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/93d11b5f26195dd60f4727c8f1dbf1a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*88HKSbuUCrDuWOMgGFHw3w.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</figcaption></figure><p id="2ebe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">subplot2grid函数要求您定义绘图的几何图形以及绘图在网格中的位置。上面的例子是一个2乘2的网格。顶部子情节的位置被定义为第一行和第一列。它横跨两列。底部的是第二行的图，每个占据一个单元格。</p><p id="f074" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以使用Matplotlib创建如下结构:</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="c0c0" class="nf me it nb b gy ng nh l ni nj"># Create Figure<br/>plt.figure(figsize=(8,4))</span><span id="840c" class="nf me it nb b gy nk nh l ni nj"># top<br/>ax1 = plt.subplot2grid((2, 2), (0, 0), colspan=2)</span><span id="98aa" class="nf me it nb b gy nk nh l ni nj"># bottom left<br/>ax2 = plt.subplot2grid((2, 2), (1, 0))</span><span id="0c8b" class="nf me it nb b gy nk nh l ni nj"># bottom right<br/>ax2 = plt.subplot2grid((2, 2), (1, 1))</span><span id="618b" class="nf me it nb b gy nk nh l ni nj">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/1255dbc5393a8f8a40c68e5eb14b73eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*v1qDt1foey_VkuDplTABTg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</figcaption></figure><p id="3e46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">colspan和rowspan参数用于创建占据多个单元格的子情节。</p><p id="b0d7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">下图是一个更复杂的网格，其中包含跨越列和行的支线剧情。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/7fe13cc072d6b044103bc7b845270acd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*rAQtMnnKAyj_qwIPiq5Dhg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</figcaption></figure><p id="1e43" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们用Matplotlib创建这个网格。这是一个3x 3的网格。</p><pre class="kj kk kl km gt na nb nc nd aw ne bi"><span id="886c" class="nf me it nb b gy ng nh l ni nj"># Create Figure<br/>plt.figure(figsize=(12,8))</span><span id="d7a9" class="nf me it nb b gy nk nh l ni nj"># Create subplots<br/>ax1 = plt.subplot2grid((3, 3), (0, 0), colspan=3)<br/>ax2 = plt.subplot2grid((3, 3), (1, 0), colspan=2)<br/>ax3 = plt.subplot2grid((3, 3), (1, 2), rowspan=2)<br/>ax4 = plt.subplot2grid((3, 3), (2, 0))<br/>ax5 = plt.subplot2grid((3, 3), (2, 1))</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/9666991e07664b9b95ee731546802a97.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-wZ7oOKR2ZHZIlJlRthT0A.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">(图片由作者提供)</figcaption></figure><p id="dec3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">一旦我们有了网格，我们就可以用不同的情节填充支线剧情。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="58c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Matplotlib是一个高度通用和灵活的工具，用于创建数据可视化。与其他流行的库相比，它可能需要编写更多的代码，但它带来的优势是可以更好地控制您所绘制的内容。</p></div><div class="ab cl lw lx hx ly" role="separator"><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb mc"/><span class="lz bw bk ma mb"/></div><div class="im in io ip iq"><p id="4acd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><em class="lv">你可以成为</em> <a class="ae ky" href="https://sonery.medium.com/membership" rel="noopener"> <em class="lv">媒介会员</em> </a> <em class="lv">解锁我的全部写作权限，外加其余媒介。如果你已经是了，别忘了订阅</em><a class="ae ky" href="https://sonery.medium.com/subscribe" rel="noopener"><em class="lv"/></a><em class="lv">如果你想在我发表新文章时收到电子邮件。</em></p><p id="2dd3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">感谢您的阅读。如果您有任何反馈，请告诉我。</p></div></div>    
</body>
</html>