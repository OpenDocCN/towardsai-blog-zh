<html>
<head>
<title>[DBT] Set Snowflake Query Tag for each DBT model [Tip-2]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">[DBT]为每个DBT模型设置雪花查询标签[提示-2]</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/dbt-set-snowflake-query-tag-for-each-dbt-model-tip-2-665a3e557d6e?source=collection_archive---------2-----------------------#2021-11-07">https://pub.towardsai.net/dbt-set-snowflake-query-tag-for-each-dbt-model-tip-2-665a3e557d6e?source=collection_archive---------2-----------------------#2021-11-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="f53d" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/software-engineering" rel="noopener ugc nofollow" target="_blank">软件工程</a></h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/c9d0ac44605f432c4fcd90eb4ff49e9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sgUOBBVBn-167_O1MN1Cmw.png"/></div></div></figure><p id="3cf2" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">DBT的查询标记特性是一种特定于数据库的配置。在本文中，让我们看看如何为雪花定制它。</p><p id="9275" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><a class="ae lf" href="https://docs.snowflake.com/en/sql-reference/parameters.html#query-tag" rel="noopener ugc nofollow" target="_blank">查询标签</a>是一个雪花参数，稍后在<a class="ae lf" href="https://docs.snowflake.com/en/sql-reference/account-usage/query_history.html" rel="noopener ugc nofollow" target="_blank"> QUERY_HISTORY视图</a>中搜索时会非常有用。</p><h2 id="5290" class="lg lh iq bd li lj lk dn ll lm ln dp lo ks lp lq lr kw ls lt lu la lv lw lx iw bi translated">默认查询标签可以在Profiles.yml中设置</h2><figure class="lz ma mb mc gt ka gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/98e537eb6753024221b9fabcd4a102db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*P2PhsCsvVyI4BrzQe5qaUg.png"/></div></figure><p id="2144" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">这将适用于从DBT到雪花触发的所有查询。</p><h2 id="24e1" class="lg lh iq bd li lj lk dn ll lm ln dp lo ks lp lq lr kw ls lt lu la lv lw lx iw bi translated">3种配置查询标签的方法</h2><ol class=""><li id="8f87" class="md me iq kj b kk mf ko mg ks mh kw mi la mj le mk ml mm mn bi translated">在<code class="fe mo mp mq mr b">dbt_project.yml</code>中配置，这种方法的<strong class="kj ja">缺点</strong>是<strong class="kj ja">只能添加字符串</strong>，<strong class="kj ja">不能用当前的dbt版本执行宏</strong>。目前，DBT只支持YAML项目文件中的几个上下文列表。</li></ol><figure class="lz ma mb mc gt ka gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/e101310ef0da455243737db46a1c7b39.png" data-original-src="https://miro.medium.com/v2/resize:fit:1360/format:webp/1*qH1wercxbf3u9BAtUc7c9A.png"/></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">来源:<a class="ae lf" href="https://docs.getdbt.com/reference/resource-configs/snowflake-configs" rel="noopener ugc nofollow" target="_blank">https://docs . get dbt . com/reference/resource-configs/snow flake-configs</a></figcaption></figure><p id="aec5" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">2.在每个型号配置下配置它，<strong class="kj ja">缺点</strong>是<strong class="kj ja">在所有型号</strong>中重复相同的配置，这不是一个好的做法。</p><figure class="lz ma mb mc gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi mx"><img src="../Images/6786c3e9b747b7480d8f14535e2f3906.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JZKQbsz5d3c-IXp4jSERJA.png"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">来源:<a class="ae lf" href="https://docs.getdbt.com/reference/resource-configs/snowflake-configs" rel="noopener ugc nofollow" target="_blank">https://docs . get dbt . com/reference/resource-configs/snow flake-configs</a></figcaption></figure><h2 id="33ed" class="lg lh iq bd li lj lk dn ll lm ln dp lo ks lp lq lr kw ls lt lu la lv lw lx iw bi translated">解决办法</h2><p id="88a3" class="pw-post-body-paragraph kh ki iq kj b kk mf km kn ko mg kq kr ks my ku kv kw mz ky kz la na lc ld le ij bi translated">3.覆盖默认的查询标记宏，并根据需求对其进行定制。</p><p id="5bb5" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">在每个模型之前，雪花会话级<code class="fe mo mp mq mr b">query tags</code>将被更新。一旦模型运行完成，它将自动复位到<code class="fe mo mp mq mr b">profiles.yml</code>中设置的<code class="fe mo mp mq mr b">default query tag</code></p><pre class="lz ma mb mc gt nb mr nc nd aw ne bi"><span id="2f38" class="lg lh iq mr b gy nf ng l nh ni">alter session set query_tag = ‘dbt_model_name’</span></pre><figure class="lz ma mb mc gt ka"><div class="bz fp l di"><div class="nj nk l"/></div></figure><p id="97ee" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">DBT日志输出当为演示启用了“登录到控制台”时，</p><figure class="lz ma mb mc gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nl"><img src="../Images/0914755defa97fa58b877ecf49395d48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TfR6gPab1gh10JEtYAAjeQ.png"/></div></div></figure><p id="6381" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">雪花历史查询如下，</p><figure class="lz ma mb mc gt ka gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/18c5c24623ecb2e76351cebb394af1a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1094/format:webp/1*ltufW8eSDBjAl2nqzKfEWw.png"/></div></figure><p id="cba0" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">上面相同的代码也维护在这个不断增长的git存储库中。</p><div class="nn no gp gr np nq"><a href="https://github.com/karthikeyan-sivabaskaran/dbt-tips-and-tricks-series" rel="noopener  ugc nofollow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd ja gy z fp nv fr fs nw fu fw iz bi translated">GitHub-karthikeyan-sivabaskaran/dbt-tips-and-tricks-series:这个回购将继续增长以演示…</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">此时您不能执行该操作。您已使用另一个标签页或窗口登录。您已在另一个选项卡中注销，或者…</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">github.com</p></div></div><div class="nz l"><div class="oa l ob oc od nz oe kf nq"/></div></div></a></div><blockquote class="of og oh"><p id="a5d2" class="kh ki oi kj b kk kl km kn ko kp kq kr oj kt ku kv ok kx ky kz ol lb lc ld le ij bi translated">我希望这篇文章能帮助您定制查询标签。如果你喜欢这个博客，请分享给你的队友，朋友，鼓掌👏在1到50英寸的范围内。<a class="ae lf" href="https://help.medium.com/hc/en-us/articles/115011350967-Claps" rel="noopener">每篇帖子最多可以鼓掌50次</a>。</p></blockquote><figure class="lz ma mb mc gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi om"><img src="../Images/5de80ab418cfcc5b5375883b1e7c4516.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*76jOYsPofZ6Fu7cR"/></div></div><figcaption class="mt mu gj gh gi mv mw bd b be z dk translated">在<a class="ae lf" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上<a class="ae lf" href="https://unsplash.com/@stillnes_in_motion?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">静止不动</a>拍摄</figcaption></figure><blockquote class="of og oh"><p id="5775" class="kh ki oi kj b kk kl km kn ko kp kq kr oj kt ku kv ok kx ky kz ol lb lc ld le ij bi translated"><strong class="kj ja">快乐压倒一切！</strong></p><p id="4ff3" class="kh ki oi kj b kk kl km kn ko kp kq kr oj kt ku kv ok kx ky kz ol lb lc ld le ij bi translated">这篇文章是DBT提示和技巧系列的一部分。以前的文章如下:</p></blockquote><div class="nn no gp gr np nq"><a href="https://medium.com/@kar9475/dbt-override-default-schema-with-custom-schema-name-tip-1-2e6ec59141b7" rel="noopener follow" target="_blank"><div class="nr ab fo"><div class="ns ab nt cl cj nu"><h2 class="bd ja gy z fp nv fr fs nw fu fw iz bi translated">[DBT]用自定义模式名覆盖默认模式[提示-1]</h2><div class="nx l"><h3 class="bd b gy z fp nv fr fs nw fu fw dk translated">本文是DBT提示和技巧系列的一部分</h3></div><div class="ny l"><p class="bd b dl z fp nv fr fs nw fu fw dk translated">medium.com</p></div></div><div class="nz l"><div class="on l ob oc od nz oe kf nq"/></div></div></a></div></div></div>    
</body>
</html>