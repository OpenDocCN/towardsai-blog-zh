<html>
<head>
<title>How To Do Fuzzy String Matching In Rasa</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何在Rasa中进行模糊字符串匹配</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-to-do-fuzzy-string-matching-in-rasa-a9b3a26e866?source=collection_archive---------1-----------------------#2021-05-27">https://pub.towardsai.net/how-to-do-fuzzy-string-matching-in-rasa-a9b3a26e866?source=collection_archive---------1-----------------------#2021-05-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7166" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="f7ff" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">关于如何将fuzzywuzzy库集成到Rasa的NLU管道中的教程</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/c448f26543862521679c917dd62ea09c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tFlFg6Jz0YK1SXW6Ola7zA.png"/></div></div></figure><h1 id="5fda" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">介绍</h1><p id="a4aa" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">在这篇文章中，我将分享如何在r <a class="ae mr" href="https://rasa.com/" rel="noopener ugc nofollow" target="_blank"> asa </a>中创建一个<a class="ae mr" href="https://rasa.com/docs/rasa/components#custom-components" rel="noopener ugc nofollow" target="_blank">定制组件</a>，以使实体提取对输入错误更加健壮。更具体地说，我们将使用<a class="ae mr" href="https://github.com/seatgeek/fuzzywuzzy" rel="noopener ugc nofollow" target="_blank"> fuzzywuzzy </a>库进行模糊字符串匹配，根据相似性得分自动更正一个实体。</p><p id="4a08" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">复制本文中描述的机器人的代码可以在<a class="ae mr" href="https://github.com/hsm207/rasa_fuzzy" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="2777" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">问题陈述</h1><p id="3cef" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">假设期望机器人从话语中提取代表一个国家的实体，并将其规范化为某种规范形式。这可以通过rasa的<a class="ae mr" href="https://rasa.com/docs/rasa/nlu-training-data/#synonyms" rel="noopener ugc nofollow" target="_blank">同义词</a>功能来实现:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/b3b063e8172ed328afa33ff4c045f6a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*KymtlBFN7Oigcc_G6164pQ.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图1:美国的一些同义词</figcaption></figure><p id="3c13" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">因此，类似“我来自美国”的话语将被NLU管道处理为:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/6e6a8659b68a11c66761e9e1948d4eb9.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*tPb_nSFhOxAGyn6kGXAmyQ.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图2:从“我来自美国”中提取国家实体</figcaption></figure><p id="a41e" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">然而，如果用户打错了，例如“我来自美利坚合众国”，结果是:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/688212b1710f6740a48539fb0a0ead3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:804/format:webp/1*NJk_AEvEHlsP4Vr7p91bhQ.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图3:提取一个输入错误的国家</figcaption></figure><p id="b9a9" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">我们看到，DIET分类器设法将<code class="fe ne nf ng nh b">united states of amercia</code>识别为一个国家实体，但是由于在所提供同义词列表中没有精确匹配，所以它没有映射到<code class="fe ne nf ng nh b">usa</code>,这与图2中的话语不同。这真的很烦人，因为这是一个<a class="ae mr" href="https://en.wikipedia.org/wiki/Wikipedia:Lists_of_common_misspellings/A" rel="noopener ugc nofollow" target="_blank">常见的错别字</a>，如果不能将其规范化为某种规范形式，将会干扰依赖于正确的国家实体被提取的下游任务。</p><p id="6189" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">一个潜在的解决方案是在同义词列表中包含所有可能的错别字(或者至少是常见的错别字)。这并不理想，因为不仅列表会不必要的长并且难以维护，而且我们还必须预见到用户可能会犯的错误！</p><p id="9a1e" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">一个更好的解决方案是构建一个定制组件，该组件检查提取的实体，并将它们与已知实体列表进行模糊匹配。如果提取的实体和列表中的元素之间的相似性超过了某个阈值，我们就断定提取的实体中可能有拼写错误，并将其自动更正到该元素。下一节将描述如何构建这个解决方案。</p><h1 id="d71e" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">解决方案:构建自定义组件</h1><h2 id="1b9c" class="ni le it bd lf nj nk dn lj nl nm dp ln me nn no lp mi np nq lr mm nr ns lt iz bi translated">步骤1:决定定制组件的全限定类名</h2><p id="376c" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">我们将在名为<code class="fe ne nf ng nh b">my_custom_components.py</code>的文件中的名为<code class="fe ne nf ng nh b">EntityTypoFixer</code>的类中实现我们的定制组件，该文件保存在相对于项目根目录名为<code class="fe ne nf ng nh b">addons</code>的文件夹中。</p><p id="e299" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">因此，如果在项目的根目录下启动python，组件的全限定类名就是<code class="fe ne nf ng nh b">addons.my_custom_components.EntityTypoFixer</code>。</p><h2 id="ab35" class="ni le it bd lf nj nk dn lj nl nm dp ln me nn no lp mi np nq lr mm nr ns lt iz bi translated">步骤2:实现定制组件的参数</h2><p id="b512" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">将阈值分数作为定制组件的参数会很方便，这样我们<a class="ae mr" href="https://rasa.com/docs/rasa/testing-your-assistant/#comparing-policy-configurations" rel="noopener ugc nofollow" target="_blank">可以比较不同阈值</a>和<code class="fe ne nf ng nh b">rasa test</code>的效果。我们将这个参数称为<code class="fe ne nf ng nh b">score_cutoff</code>，并给它一个默认值80。</p><p id="9680" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">我们需要做的第一件事是定义一个名为<code class="fe ne nf ng nh b">defaults</code>的类属性，它将存储默认参数值的字典:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/294eff9646f607462be6ccd73050bab8.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/format:webp/1*_-nB1dWRpd6GrCBJMbOx4g.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图4:<code class="fe ne nf ng nh b">EntityTypoFixer</code>的默认参数值字典</figcaption></figure><p id="d0f8" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">接下来，我们定义如何在<code class="fe ne nf ng nh b">EntityTypoFixer</code>的<code class="fe ne nf ng nh b">__init__</code>方法中使用默认的<code class="fe ne nf ng nh b">score_cutoff </code>参数:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/297316a4f1b45c96d28701173615d39e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/format:webp/1*NQKm2hhwCEmcv3DdSyfmpQ.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图5:使用score_cutoff的默认值，如果它没有在config.yml中定义</figcaption></figure><h2 id="7b24" class="ni le it bd lf nj nk dn lj nl nm dp ln me nn no lp mi np nq lr mm nr ns lt iz bi translated">步骤3:定义培训时发生的事情</h2><p id="5373" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">训练NLU管道时，我们希望将所有同义词中列出的所有实体收集到一个列表中，以便我们可以在推理时查找它们:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/dd51e4b8a6f1f692378ae0866dac37dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*qz2a2YB_UtCO-5Lvjsf71A.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图6:在训练期间获取同义词列表中的所有实体</figcaption></figure><h2 id="8351" class="ni le it bd lf nj nk dn lj nl nm dp ln me nn no lp mi np nq lr mm nr ns lt iz bi translated">步骤4:定义推理时发生的事情</h2><p id="6d51" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">在推理时给定一条消息，我们将把所有实体提取到一个列表中，并遍历每个元素，将它们与<code class="fe ne nf ng nh b">self.entities</code>中的实体进行模糊匹配:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/5950068d6d9db924ffbb76bfe5885a0a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1354/format:webp/1*qvYSA31lLmUsTkdtINSccQ.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图7:如何使用模糊匹配更新实体</figcaption></figure><p id="bd2d" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">实际的模糊匹配是在对<code class="fe ne nf ng nh b">self.fix_entity_typo</code>的调用中完成的，定义如下:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/be9f984545dbd48930fa71e8dda14adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mdyxICHVbvk67WVevMpcCw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图8:实现模糊匹配</figcaption></figure><p id="7777" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">图8显示，如果在<code class="fe ne nf ng nh b">self.entities</code>中针对一个提取的实体的最佳匹配的分数超过了<code class="fe ne nf ng nh b">score_cutoff</code>并且不是100，那么用最佳匹配的值更新该提取的实体的值，并且还将该组件添加到<code class="fe ne nf ng nh b">processors</code>的列表中，以便我们知道在处理一个话语时使用了该组件。</p><h2 id="c0d8" class="ni le it bd lf nj nk dn lj nl nm dp ln me nn no lp mi np nq lr mm nr ns lt iz bi translated">步骤5:定义如何保存和加载定制组件</h2><p id="aefe" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">因为该组件需要在训练期间提取的实体列表才能正常工作，所以让我们定义保存和加载该信息的函数:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ny"><img src="../Images/83d206264020aeefe3c8cd1c4eeaa77d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D_QG4ipKGzChLuDwhICiLQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图9:保存和加载定制组件</figcaption></figure><h2 id="6706" class="ni le it bd lf nj nk dn lj nl nm dp ln me nn no lp mi np nq lr mm nr ns lt iz bi translated">步骤6:将自定义组件添加到config.yml中</h2><p id="82d9" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">最后，我们将这个组件添加到<code class="fe ne nf ng nh b">config.yml</code>的<code class="fe ne nf ng nh b">pipeline </code>部分。因为我们希望这个组件在提取实体之后、映射到同义词之前运行，所以它应该放在<code class="fe ne nf ng nh b">DIETClassifier </code>和<code class="fe ne nf ng nh b">EntitySynonymMapper </code>组件之间:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/032be7bf98f5e8565ba4a6b6d4ef3f48.png" data-original-src="https://miro.medium.com/v2/resize:fit:942/format:webp/1*e28-KvQdwh3xYDZ4wcxtwg.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图10:在NLU管道中放置EntityTypoFixer的位置</figcaption></figure><p id="00bf" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">请注意，我们使用了组件的完全限定类名，这是我们在步骤1中弄清楚的。</p><h1 id="0aa7" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">结果</h1><p id="321e" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">在用新的<code class="fe ne nf ng nh b">config.yml</code>重新训练模型之后，话语“我来自美利坚合众国”的结果是:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/bafd2d7eeac37b564455ca0e61185f8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*MPE61FMT57VoOazGAqNvWA.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图11:使用EntityTypoFixer处理带有拼写错误的实体的结果</figcaption></figure><p id="3452" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">与图3相比，我们看到提取的实体的值现在是我们想要的<code class="fe ne nf ng nh b">usa</code>。我们还看到<code class="fe ne nf ng nh b">EntityTypoFixer</code>在<code class="fe ne nf ng nh b">processors</code>的列表中，表明它是作为提取过程的一部分被调用的。</p><p id="f61d" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">处理“我来自美国”的输出不变，因为在这个话语中没有打字错误:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/10c8a8f02a9e5270bd8c38c2f4c78983.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*KHw3k0I8JXi5go2C5Cd-8w.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图12:使用EntityTypoFixer提取没有拼写错误的国家实体</figcaption></figure><h1 id="5cb7" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">结论</h1><p id="458e" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">本文展示了如何使用fuzzywuzzy库对rasa中提取的实体进行模糊匹配。本文中描述的步骤可用于构建其他定制组件，这些组件执行任意的预处理或后处理任务。</p><p id="0163" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">我希望你已经发现这是有用的。</p></div></div>    
</body>
</html>