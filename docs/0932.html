<html>
<head>
<title>Stock Price Change Forecasting with Time Series: SARIMAX</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于时间序列的股票价格变化预测:SARIMAX</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/stock-price-change-forecasting-with-time-series-sarimax-4f5ca053d464?source=collection_archive---------2-----------------------#2020-09-16">https://pub.towardsai.net/stock-price-change-forecasting-with-time-series-sarimax-4f5ca053d464?source=collection_archive---------2-----------------------#2020-09-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7957" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a>，<a class="ae ep" href="https://towardsai.net/p/category/statistics" rel="noopener ugc nofollow" target="_blank">统计</a></h2><div class=""/><div class=""><h2 id="2be6" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">对时间序列、平稳性、季节性、预测和SARIMAX建模有较高的理解</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/c5bd250da75b7a20c4fe0065bfe23c28.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rOyHBmeI3jnYiPK1NUnqlQ.png"/></div></div></figure><p id="6611" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">时间序列建模是对依赖于时间的序列数据(可能是有限的或无限的)的统计研究。虽然我们说时间。但是，这里的时间可能是一个逻辑标识符。时间序列数据中可能没有任何物理时间信息。在本文中，我们将讨论如何用时间序列和一些高层次的概念来建模股票价格变化预测问题。</p><h2 id="16cb" class="lz ma it bd mb mc md dn me mf mg dp mh lm mi mj mk lq ml mm mn lu mo mp mq iz bi translated">问题陈述</h2><p id="5486" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">我们将从UCI机器学习库中获取<a class="ae mw" href="https://archive.ics.uci.edu/ml/datasets/Dow+Jones+Index" rel="noopener ugc nofollow" target="_blank">道琼斯指数数据集</a>。它包含两个季度的股票价格信息。让我们先来探索一下数据集:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mx"><img src="../Images/4798dd958aba8ff3c22fff26dfe4d703.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q0WQY76BNAxufGPfQziOBg.png"/></div></div></figure><p id="9b99" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们只能看到一些属性。但是也有其他的。其中一个是“<em class="my">percent _ change _ next _ weeks _ price</em>”。这是我们的目标。鉴于我们有当前周的数据，我们需要预测随后几周的数据。“日期”属性的值指示时序信息的存在。在进入解决方案之前，我们将在高层次上讨论一些时间序列的概念，以便我们理解。</p></div><div class="ab cl mz na hx nb" role="separator"><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne nf"/><span class="nc bw bk nd ne"/></div><div class="im in io ip iq"><h1 id="0d91" class="ng ma it bd mb nh ni nj me nk nl nm mh ki nn kj mk kl no km mn ko np kp mq nq bi translated">时间序列的定义</h1><p id="dd5f" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">时间序列建模有不同的技术。其中之一就是<em class="my">自回归过程(AR)。</em>在这里，时间序列问题可以表示为递归回归问题，其中因变量是目标变量本身在不同时刻的值<em class="my">。</em>假设Yt是我们的目标变量，在不同的时刻有一系列的值Y1，Y2，…那么，</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/4d6fa768fe3dfc7c8d5e592ab3717c16.png" data-original-src="https://miro.medium.com/v2/resize:fit:534/format:webp/1*T6UzG43zFBfLybVMhxIkAg.png"/></div></figure><p id="fd46" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">对于所有时间实例t. Parameter是过程的平均值。我们可以解释这个术语</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/3921fa96515ab1bcb5228fea41352e88.png" data-original-src="https://miro.medium.com/v2/resize:fit:234/format:webp/1*m1bq--mYVpuxUNAKAJMjng.png"/></div></figure><p id="58d2" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">将过去的“记忆”或“反馈”转化为过程的当前值。参数ф确定反馈量，ɛt是在时间t出现的信息，可以作为额外的信息添加。当然，这里的“过程”，我们指的是一个变量在不同时刻的值的无限或有限序列。如果我们扩展上述递归关系，那么我们得到:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/3d23061d78b5e37f58cd6e7aeebfe68d.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*5eZX8HqejP8m1Bam0MrePA.png"/></div></figure><p id="3147" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">它被称为AR(1)过程。<em class="my"> h </em>被称为<em class="my">滞后</em>。</p><blockquote class="nu nv nw"><p id="eba0" class="ld le my lf b lg lh kd li lj lk kg ll nx ln lo lp ny lr ls lt nz lv lw lx ly im bi translated"><em class="it">滞后</em>是一个逻辑/抽象时间单位。它可以是小时、天、周、年等等。它使定义更加通用。</p></blockquote><p id="2fc2" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">如果我们考虑p个先前值，而不是只有一个单一的先前值，那么它就变成AR(p)过程，同样可以表示为:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/3f074f0f2fd92ef8fda68c439762f5d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1256/format:webp/1*vjn1qU4GTANkP20VVPGj9Q.png"/></div></figure><p id="7a08" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">因此，有许多反馈因子，如ф1、ф2、..фp为AR(p)工艺。它是所有过去值的加权平均值。</p><p id="2752" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">还有另一种称为MA(q)过程或<em class="my">移动平均过程</em>的模型，它只考虑新的信息ɛ，可以类似地表示为加权平均:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/703a46e9f3107bd90b7dd9f58f8d4266.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*yFBJAIzQ8PdEwChDB_2OmA.png"/></div></figure><h2 id="09ca" class="lz ma it bd mb mc md dn me mf mg dp mh lm mi mj mk lq ml mm mn lu mo mp mq iz bi translated">平稳性和差分</h2><p id="f3d4" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">从上面所有的方程中，我们可以看到，如果ф或θ &lt; 1 then the value of Yt converges to µ i.e., a fixed value. It means that if we take the average Y value from any two-interval, then it will always be close to µ, i.e., closeness will be statistically significant. This type of series is known as <em class="my">时间序列平稳</em>。另一方面，ф &gt; 1给出了爆炸性的行为，并且该序列变得<em class="my">非平稳。</em></p><p id="d655" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">时间序列建模的基本假设在本质上是平稳的。这就是为什么我们必须通过<em class="my">差分</em>将非平稳序列降低到平稳状态。它被定义为:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/eac221f40c08b8207a14ca6821b49f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:332/format:webp/1*Thh9r9jA22NyGbv3ocEk8w.png"/></div></figure><p id="2971" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">然后，我们可以将Yt再次建模为时间序列。如上所述，它有助于消除爆炸性。这种差异可以做几次，因为不能保证只做一次就能使序列稳定。</p><h2 id="86cc" class="lz ma it bd mb mc md dn me mf mg dp mh lm mi mj mk lq ml mm mn lu mo mp mq iz bi translated">ARIMA过程</h2><p id="9167" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">ARIMA是用<em class="my"> AR(p) </em>、<em class="my">MA(q)</em>和<em class="my"> d </em>倍差的join过程建模。所以，这里Yt包含了AR(p)和MA(q)的所有项。它说，如果一个ARIMA(p，d，q)过程被微分d次，那么它就变得稳定。</p><h2 id="8eee" class="lz ma it bd mb mc md dn me mf mg dp mh lm mi mj mk lq ml mm mn lu mo mp mq iz bi translated">季节性和萨里玛</h2><p id="60e6" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">时间序列可能会受到季节性因素的影响，例如一周、几个月、一年中的几个季度或十年中的几年。在这些固定的时间跨度内，在目标变量中观察到不同于其他变量的不同行为。需要单独建模。事实上，季节性成分可以从原始序列中提取出来，并按照前面所说的不同方式建模。它被定义为:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi od"><img src="../Images/1b590ebca14b8088736fd79941ac6c84.png" data-original-src="https://miro.medium.com/v2/resize:fit:350/format:webp/1*QUcE2IzTiKKVAtO6Z2wVow.png"/></div></figure><p id="8984" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">其中m是季节的长度，即季节性的程度。</p><blockquote class="nu nv nw"><p id="9f46" class="ld le my lf b lg lh kd li lj lk kg ll nx ln lo lp ny lr ls lt nz lv lw lx ly im bi translated">萨里玛是季节性与ARIMA模型混合的过程建模。</p></blockquote><p id="21d5" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">SARIMA由(P，D，q)(P，D，Q)定义，其中P，D，Q是季节分量的顺序。</p><h2 id="e517" class="lz ma it bd mb mc md dn me mf mg dp mh lm mi mj mk lq ml mm mn lu mo mp mq iz bi translated">萨里马克斯和阿里马克斯</h2><p id="797b" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">到目前为止，我们已经讨论了只使用目标变量Y对序列进行建模。我们还没有考虑数据集中存在的其他属性。</p><blockquote class="nu nv nw"><p id="548b" class="ld le my lf b lg lh kd li lj lk kg ll nx ln lo lp ny lr ls lt nz lv lw lx ly im bi translated">ARIMAX还考虑在回归模型中添加其他特征变量。</p></blockquote><p id="5d74" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这里X代表<em class="my">外源。</em>它就像一个普通的回归模型，其中递归目标变量和其他特征都在那里。参考我们的问题陈述，我们可以设计一个ARIMAX模型，其目标变量<em class="my">percent _ change _ next _ weeks _ price</em>处于不同的滞后期，并具有其他特征，如<em class="my">成交量</em>、<em class="my">低点</em>、<em class="my">收盘、</em>等。但是，与目标变量不同的是，其他要素被认为是固定的，没有滞后相关值。ARIMAX的季节性版本被称为SARIMAX。</p><h1 id="5c7c" class="ng ma it bd mb nh oe nj me nk of nm mh ki og kj mk kl oh km mn ko oi kp mq nq bi translated">数据分析</h1><p id="6fd7" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">我们将从分析数据开始。我们还将学习其他一些时间序列的概念。</p><p id="3a01" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">让我们首先使用<em class="my"> statsmodel </em>库绘制自相关函数(ACF)和部分自相关函数(PACF ):</p><pre class="ks kt ku kv gt oj ok ol om aw on bi"><span id="56c0" class="lz ma it ok b gy oo op l oq or">import statsmodels.graphics.tsaplots as tsa_plots</span><span id="3bda" class="lz ma it ok b gy os op l oq or">tsa_plots.plot_pacf(df['percent_change_next_weeks_price'])</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/9ccba890f5350338345fb4bbc92b243a.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*9ERbTmPDsqTewy9461qyxA.png"/></div></figure><p id="1c6a" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">然后是ACF:</p><pre class="ks kt ku kv gt oj ok ol om aw on bi"><span id="812c" class="lz ma it ok b gy oo op l oq or">tsa_plots.plot_acf(df['percent_change_next_weeks_price'])</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/697469cc53ee91a400b9cb78ee0d93bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*GamJ91i2eK5qV_j7UVvlsQ.png"/></div></figure><p id="92a6" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">ACF给出了不同滞后的Y值之间的相关性。数学上，这种协方差可以定义为:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/2129d15640b397f270fae43e6ebfde2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:784/format:webp/1*Z727ImBIU1yeYTkg7sE9Ag.png"/></div></figure><p id="7b99" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">ACF图中的分界点表示y的滞后值之间没有足够的关系。它也是<em class="my"> MA(q) </em>过程的q阶指示器。从ACF图中，我们可以看到ACF仅在零处截止。所以，q应该为零。</p><p id="b660" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">PACF是Y值之间的偏相关，即以Yt+1为条件的Yt和Yt+k之间的相关，..，Yt+k-1。像ACF一样，PACF的截止表示<em class="my"> AR(p) </em>过程的顺序p。在我们的用例中，我们可以看到p是零。</p><h2 id="f68e" class="lz ma it bd mb mc md dn me mf mg dp mh lm mi mj mk lq ml mm mn lu mo mp mq iz bi translated">分解组件</h2><p id="aada" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">我们现在就来看看，时间序列中有多少成分。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ow ox l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oy"><img src="../Images/0725b183c6a9290a592063692115798b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EzUJBzzxsQ5gqLYHHF57IA.png"/></div></div></figure><p id="dcc2" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">第一张图显示了实际情况，第二张图显示了趋势。我们可以看到<em class="my">percentage _ change _ next _ weeks _ price</em>变量没有具体的趋势(上升/下降)。但是季节图揭示了季节成分的存在，因为它显示了起伏的波动。</p><h2 id="c1a8" class="lz ma it bd mb mc md dn me mf mg dp mh lm mi mj mk lq ml mm mn lu mo mp mq iz bi translated">平稳性检查— ADF测试</h2><p id="942d" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">AR(p)过程的特征方程由下式给出:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/903aed18586a12f9d1e4df1f58a042d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*qN-oHUY3z9MPJIeHWwky2A.png"/></div></figure><p id="65e7" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">从我们前面的讨论中，我们可以说AR(1)过程是平稳的，如果ф &lt; 1 and for AR(p), it should be ф1 + ф2+..+фp &lt;1. So the if the solution of the characteristic equation is of the form:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/496fb9148db629f47bb3037c0f2806fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:442/format:webp/1*K5e8MSHOKiQR-KKD1D7adA.png"/></div></figure><p id="f3e2" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">i.e, if it has unit-roots, then the time series is not stationary.</p><p id="0427" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">We can formally test this with Augmented Dicky-Fuller test like below:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ow ox l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/822046d009fc89dfe4abebbf10daecea.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*ZUwXljHQ5SoYYNWhESxE-w.png"/></div></figure><p id="0e46" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">As the p-value is less than 0.05, so the series is stationary.</p><h1 id="8093" class="ng ma it bd mb nh oe nj me nk of nm mh ki og kj mk kl oh km mn ko oi kp mq nq bi translated">Building the model</h1><p id="359e" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">We will start building the model.</p><h2 id="f671" class="lz ma it bd mb mc md dn me mf mg dp mh lm mi mj mk lq ml mm mn lu mo mp mq iz bi translated">Pre-processing</h2><p id="c616" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">We will do some pre-processing like converting categorical variable <em class="my">股票</em>为数值型，从价格属性中去掉前缀' $ '，并用零填充所有空值。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="750f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们还将分离出目标和特征变量。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="d06d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们将数据集分为训练和测试。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="cb3d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><em class="my"> TimeSeriesSplit </em>以交叉验证的方式递增拆分数据。我们必须使用最后的X_train，X_test集合。</p><h2 id="0d10" class="lz ma it bd mb mc md dn me mf mg dp mh lm mi mj mk lq ml mm mn lu mo mp mq iz bi translated">自动建模</h2><p id="03ef" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">我们将使用来自<em class="my"> pmdarima </em>库中的<em class="my"> auto_arima </em>。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="c8be" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">它使用不同的SARIMAX(p，D，q)(P，D，Q)模型进行试验，并选择最佳模型。我们使用X_train作为<em class="my">外生</em>变量，季节开始订单m作为2(即从m开始尝试不同的季节订单)。</p><p id="1494" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们得到的输出如下:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/6e2d29424dbaa8a7c1c00a7cb762fe02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1324/format:webp/1*JruMgTkSAZouzXPXCJmZvQ.png"/></div></figure><p id="f268" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">因此，我们在<em class="my">数据分析</em>部分分析的结果是正确的。</p><blockquote class="nu nv nw"><p id="5de3" class="ld le my lf b lg lh kd li lj lk kg ll nx ln lo lp ny lr ls lt nz lv lw lx ly im bi translated">auto_arima <em class="it">检查</em>平稳性、季节性、趋势<em class="it">一切</em>。</p></blockquote><p id="4d3f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">最佳模型具有p=0，q=0，并且由于模型是静止的，d=0。但是，正如我们看到的，它有一些季节性成分，它的顺序是(2，0，1)。</p><p id="20ee" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们将使用<em class="my"> statsmodels </em>和训练数据集构建模型</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ow ox l"/></div></figure><p id="d92e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">模型细节(剪辑):</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/873e6131266ce3e69ff63b67271e1ded.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*qg-8uFBawOrhuhrayCw2Ew.png"/></div></figure><p id="2bd4" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">它显示所有特征可变权重。</p><h2 id="5017" class="lz ma it bd mb mc md dn me mf mg dp mh lm mi mj mk lq ml mm mn lu mo mp mq iz bi translated">预测</h2><p id="b31f" class="pw-post-body-paragraph ld le it lf b lg mr kd li lj ms kg ll lm mt lo lp lq mu ls lt lu mv lw lx ly im bi translated">在测试模型之前，我们需要讨论预测和预报之间的区别。在正常的回归/分类问题中，我们经常使用术语<em class="my">预测</em>。但是，时间序列有点不同。<em class="my">预测</em>总是考虑滞后。这里，为了预测Yt的值，我们需要Yt-1的值。当然，Yt-1也是一个预测值。所以，这是一个顺序的&amp;递归过程而不是随机的。</p><p id="b595" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">数学上，对于AR(2)过程，</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pe"><img src="../Images/ba84ae6a55a2699b5f7d1ff68bd0633f.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/format:webp/1*y62gynyx122W5uyhXHrr1w.png"/></div></figure><p id="2738" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">^Yn和^Yn-1是之前的预测值。这样链条继续。在ARIMAX的情况下，特征值不依赖于时间，因此当我们进行预测时，我们将以前的Y值与相同的特征X值一起输入。</p><p id="c225" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">现在，是时候测试这个模型了:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ow ox l"/></div></figure><pre class="ks kt ku kv gt oj ok ol om aw on bi"><span id="f5b2" class="lz ma it ok b gy oo op l oq or">from sklearn.metrics import mean_squared_error</span><span id="f99b" class="lz ma it ok b gy os op l oq or">mean_squared_error(result, Y_test)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/a1e68834ddab13a92315d85870dbfe05.png" data-original-src="https://miro.medium.com/v2/resize:fit:332/format:webp/1*XGO5m9frYGtki5F3ykfLVw.png"/></div></figure><p id="f5c9" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们将绘制实际结果与预测结果的对比图。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="ow ox l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pf"><img src="../Images/060ecd4a6cbe0b48018ad29211e251bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ObK8lQCEaiE8JTM4SzRY7A.png"/></div></div></figure><p id="9b02" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们还可以看到误差分布。</p><pre class="ks kt ku kv gt oj ok ol om aw on bi"><span id="2397" class="lz ma it ok b gy oo op l oq or">model.plot_diagnostics()<br/>plt.tight_layout()<br/>plt.show()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/3be81c3d8e140ce09213e506ec4fc19d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*H4ZBVI7PHSmZQNg7t-8ESg.png"/></div></figure><p id="0f57" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">误差正态分布，均值为零，方差不变，这是一个好现象。</p><p id="48e1" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">Jupyter笔记本可以在这里找到:</p><div class="ph pi gp gr pj pk"><a href="https://github.com/avisheknag17/public_ml_models/blob/master/time_series_SARIMAX_stock_change_forecasting/time_series_SARIMAX.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="pl ab fo"><div class="pm ab pn cl cj po"><h2 class="bd jd gy z fp pp fr fs pq fu fw jc bi translated">avisheknag17/public_ml_models</h2><div class="pr l"><h3 class="bd b gy z fp pp fr fs pq fu fw dk translated">permalink dissolve GitHub是超过5000万开发人员的家园，他们一起工作来托管和审查代码，管理…</h3></div><div class="ps l"><p class="bd b dl z fp pp fr fs pq fu fw dk translated">github.com</p></div></div><div class="pt l"><div class="pu l pv pw px pt py lb pk"/></div></div></a></div><blockquote class="nu nv nw"><p id="f2ac" class="ld le my lf b lg lh kd li lj lk kg ll nx ln lo lp ny lr ls lt nz lv lw lx ly im bi translated">最近，我写了一本关于ML(<a class="ae mw" href="https://twitter.com/bpbonline/status/1256146448346988546" rel="noopener ugc nofollow" target="_blank">https://twitter.com/bpbonline/status/1256146448346988546</a>)的书</p></blockquote></div></div>    
</body>
</html>