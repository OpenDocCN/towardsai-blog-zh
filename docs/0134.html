<html>
<head>
<title>Extracting Data from PDF File Using Python and R</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python和R从PDF文件中提取数据</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/extracting-data-from-pdf-file-using-python-and-r-4ed8826bc5a1?source=collection_archive---------0-----------------------#2019-08-13">https://pub.towardsai.net/extracting-data-from-pdf-file-using-python-and-r-4ed8826bc5a1?source=collection_archive---------0-----------------------#2019-08-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="8343" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-mining" rel="noopener ugc nofollow" target="_blank">数据挖掘</a>，<a class="ae ep" href="https://towardsai.net/p/category/data-science" rel="noopener ugc nofollow" target="_blank">数据科学</a></h2><div class=""/><div class=""><h2 id="ea0f" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Python &amp; R API解析PDF文件的演示</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/6b37f2368e9c80beeb0f17c6049a4a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kV6wh0DRAK-b1huezNnoog.png"/></div></div></figure><p id="2d15" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">数据是数据科学中任何分析的关键，无论是推理分析、预测分析还是规定分析。模型的预测能力取决于构建模型时所用数据的质量。数据以不同的形式出现，如文本、表格、图像、声音或视频。最常见的情况是，用于分析的数据必须经过挖掘、处理和转换，才能呈现为适合进一步分析的形式。</p><p id="3da4" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">大多数分析中使用的最常见的数据集类型是存储在逗号分隔值(<strong class="lf jd"> csv </strong>)表中的干净数据。然而，因为可移植文档格式(<strong class="lf jd"> pdf) </strong>文件是最常用的文件格式之一，所以每个数据科学家都应该了解如何从<strong class="lf jd"> pdf </strong>文件中提取数据，并将数据转换成诸如"<strong class="lf jd"> csv" </strong>之类的格式，以便用于分析或建模。</p><p id="08bf" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">从一个<strong class="lf jd"> pdf </strong>文件中逐行复制数据太过繁琐，并且经常会由于过程中的人为错误而导致损坏。因此，了解如何以有效且无错误的方式从<strong class="lf jd"> pdf </strong>导入数据非常重要。</p><p id="aa41" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">在本文中，我们将着重于从一个<strong class="lf jd"> pdf </strong>文件中提取一个数据表。对于从<strong class="lf jd"> pdf </strong>文件中提取文本或图像等其他类型的数据，可以进行类似的分析。本文着重于从pdf文件中提取数字数据。为了从pdf文件中提取图像，python有一个名为<a class="ae lz" href="https://pypi.org/project/minecart/" rel="noopener ugc nofollow" target="_blank"> <strong class="lf jd"> minecart </strong> </a>的包，可以用来从pdf中提取图像、文本和形状。</p><p id="8299" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们展示了如何从一个<strong class="lf jd"> pdf </strong>文件中提取一个数据表，然后将其转换成适合进一步分析和建模的格式。我们将给出两个例子，一个使用Python，另一个使用r。</p><ol class=""><li id="f2a6" class="ma mb it lf b lg lh lj lk lm mc lq md lu me ly mf mg mh mi bi translated">从<strong class="lf jd"> pdf </strong>文件中提取数据表。</li><li id="0345" class="ma mb it lf b lg mj lj mk lm ml lq mm lu mn ly mf mg mh mi bi translated">使用数据辩论和字符串处理技术清理、转换和结构化数据。</li><li id="485f" class="ma mb it lf b lg mj lj mk lm ml lq mm lu mn ly mf mg mh mi bi translated">将整洁的数据表保存为<strong class="lf jd"> csv </strong>文件。</li><li id="48af" class="ma mb it lf b lg mj lj mk lm ml lq mm lu mn ly mf mg mh mi bi translated">介绍R中的数据角力和字符串处理包如<strong class="lf jd">【tidy verse】</strong><strong class="lf jd">【pdf tools】</strong><strong class="lf jd">【stringr】</strong>。</li></ol><h1 id="4d5c" class="mo mp it bd mq mr ms mt mu mv mw mx my ki mz kj na kl nb km nc ko nd kp ne nf bi translated">示例1:使用Python从PDF文件中提取表格</h1><p id="271f" class="pw-post-body-paragraph ld le it lf b lg ng kd li lj nh kg ll lm ni lo lp lq nj ls lt lu nk lw lx ly im bi translated">假设我们想从一个<strong class="lf jd"> pdf </strong>文件中提取下表。</p><p id="f344" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi">— — — — — — — — — — — — — — — — — — — — — — — — —</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/d1bda41c61c9b30b4220cf77dfdb27ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1278/format:webp/1*Rr9MZxcSXQCjcqb3le4qig.png"/></div></figure><p id="011c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi">— — — — — — — — — — — — — — — — — — — — — — — — —</p><p id="7b2b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd"> a)将表格复制粘贴到Excel中，并将文件保存为table_1_raw.csv </strong></p><p id="dc4e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">数据以一维格式存储，必须进行整形、清理和转换。</p><p id="5293" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd"> b)导入必要的库</strong></p><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="647c" class="nr mp it nn b gy ns nt l nu nv">import pandas as pd<br/>import numpy as np</span></pre><p id="17f8" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd"> c)导入原始数据并重塑数据</strong></p><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="b3ed" class="nr mp it nn b gy ns nt l nu nv">df=pd.read_csv("table_1_raw.csv", header=None)</span><span id="5acf" class="nr mp it nn b gy nw nt l nu nv">df.values.shape</span><span id="42e9" class="nr mp it nn b gy nw nt l nu nv">df2=pd.DataFrame(df.values.reshape(25,10))</span><span id="bc21" class="nr mp it nn b gy nw nt l nu nv">column_names=df2[0:1].values[0]</span><span id="5d04" class="nr mp it nn b gy nw nt l nu nv">df3=df2[1:]</span><span id="2eb3" class="nr mp it nn b gy nw nt l nu nv">df3.columns = df2[0:1].values[0]</span><span id="4738" class="nr mp it nn b gy nw nt l nu nv">df3.head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/f0dd8160ca02217e530aa85ffc8dcde3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*HsDr4KyLlExrMfpq9U4Xow.png"/></div></div></figure><p id="6033" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd"> d)使用字符串处理工具执行数据辩论</strong></p><p id="9144" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们从上表中注意到，列<strong class="lf jd"> x5 </strong>、<strong class="lf jd"> x6 </strong>和<strong class="lf jd"> x7 </strong>是用百分比表示的，因此我们需要去掉百分比(%)符号:</p><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="938f" class="nr mp it nn b gy ns nt l nu nv">df4['x5']=list(map(lambda x: x[:-1], df4['x5'].values))</span><span id="04ea" class="nr mp it nn b gy nw nt l nu nv">df4['x6']=list(map(lambda x: x[:-1], df4['x6'].values))</span><span id="2bcb" class="nr mp it nn b gy nw nt l nu nv">df4['x7']=list(map(lambda x: x[:-1], df4['x7'].values))</span></pre><p id="304a" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd"> e)将数据转换成数字形式</strong></p><p id="57b0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们注意到列<strong class="lf jd"> x5 </strong>、<strong class="lf jd"> x6 </strong>和<strong class="lf jd"> x7 </strong>的列值具有字符串数据类型，因此我们需要将它们转换为数字数据，如下所示:</p><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="226c" class="nr mp it nn b gy ns nt l nu nv">df4['x5']=[float(x) for x in df4['x5'].values]</span><span id="8295" class="nr mp it nn b gy nw nt l nu nv">df4['x6']=[float(x) for x in df4['x6'].values]</span><span id="a63d" class="nr mp it nn b gy nw nt l nu nv">df4['x7']=[float(x) for x in df4['x7'].values]</span></pre><p id="14e0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd"> f)查看转换数据的最终形式</strong></p><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="b94d" class="nr mp it nn b gy ns nt l nu nv">df4.head(n=5)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nx"><img src="../Images/2f81e95326460c2128fbf62a0e7aebb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*CdbYzd8MMd7oL8DXDXARAw.png"/></div></div></figure><p id="39f9" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd"> g)将最终数据导出至csv文件</strong></p><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="dc9b" class="nr mp it nn b gy ns nt l nu nv">df4.to_csv('table_1_final.csv',index=False)</span></pre><h1 id="8eb9" class="mo mp it bd mq mr ms mt mu mv mw mx my ki mz kj na kl nb km nc ko nd kp ne nf bi translated">示例2:使用R从PDF文件中提取表格</h1><p id="33bd" class="pw-post-body-paragraph ld le it lf b lg ng kd li lj nh kg ll lm ni lo lp lq nj ls lt lu nk lw lx ly im bi translated">这个例子说明了如何使用r中的数据角力技术从一个<strong class="lf jd"> pdf </strong>文件中提取一个表格。让我们假设我们从一个<strong class="lf jd"> pdf </strong>文件名<strong class="lf jd"> trade_report.pdf </strong>中得到下面的表格:</p><p id="1d95" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi">— — — — — — — — — — — — — — — — — — — — — — — — —</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ny"><img src="../Images/209bdd40eb2284298ded4f37118a3fba.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A27LOgVbnCCpKmB4P-plKA.png"/></div></div></figure><p id="8797" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi">— — — — — — — — — — — — — — — — — — — — — — — —</p><p id="3b3b" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我们希望提取该表，整理数据，并将其转换为数据框表，以备进一步分析。最终的数据表可以方便地导出并存储在“<strong class="lf jd">CSV”</strong>文件中。特别是，我们希望实现以下目标:</p><p id="4b3e" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">I)在列<strong class="lf jd">产品</strong>中，我们希望从产品ETC-USD中删除USD。</p><p id="e82d" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">ii)将<strong class="lf jd">日期</strong>列拆分成两个单独的列，即<strong class="lf jd">日期</strong>和<strong class="lf jd">时间</strong>。</p><p id="fabc" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">iii)从列<strong class="lf jd">费用</strong>和<strong class="lf jd">总计</strong>中删除美元。</p><p id="defe" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">这个例子的数据集和代码可以从这个库下载:<a class="ae lz" href="https://github.com/bot13956/extract_table_from_pdf_file_using_R" rel="noopener ugc nofollow" target="_blank">https://github . com/bot 13956/extract _ table _ from _ pdf _ file _ using _ R</a>。</p><p id="7fe0" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd"> a)导入必要的库</strong></p><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="084a" class="nr mp it nn b gy ns nt l nu nv">library("tidyverse")</span><span id="b78f" class="nr mp it nn b gy nw nt l nu nv">library("stringr")</span><span id="bfc3" class="nr mp it nn b gy nw nt l nu nv">library("pdftools")</span></pre><p id="2419" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">b)提取表格并转换成文本文件</p><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="e684" class="nr mp it nn b gy ns nt l nu nv"><strong class="nn jd"># define file path</strong></span><span id="a27f" class="nr mp it nn b gy nw nt l nu nv">pdf_file &lt;- file.path("C:\\Users\\btayo\\Desktop\\TRADE", "trade_report.pdf")</span><span id="0d8b" class="nr mp it nn b gy nw nt l nu nv"><strong class="nn jd"># convert pdf file to text (txt) file</strong></span><span id="5246" class="nr mp it nn b gy nw nt l nu nv">text &lt;- pdf_text(pdf_file)</span></pre><p id="480c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd"> c)利用字符串处理工具清理和组织数据</strong></p><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="e569" class="nr mp it nn b gy ns nt l nu nv">tab &lt;- str_split(text, "\n")[[1]][6:31]</span><span id="3e77" class="nr mp it nn b gy nw nt l nu nv">tab[1] &lt;- tab[1]%&gt;%str_replace("\\.","")<br/>                %&gt;%str_replace("\r","")</span><span id="56af" class="nr mp it nn b gy nw nt l nu nv">col_names &lt;- str_replace_all(tab[1],"\\s+"," ")<br/>             %&gt;%str_replace(" ", "")<br/>             %&gt;%str_split(" ")<br/>             %&gt;%unlist()</span><span id="10cb" class="nr mp it nn b gy nw nt l nu nv">col_names &lt;- col_names[-3]</span><span id="6eb2" class="nr mp it nn b gy nw nt l nu nv">col_names[2] &lt;- "Trade_id"</span><span id="a781" class="nr mp it nn b gy nw nt l nu nv">col_names &lt;- append(col_names, "Time", 5)</span><span id="d5c9" class="nr mp it nn b gy nw nt l nu nv">col_names &lt;- append(col_names,"sign",9)</span><span id="041b" class="nr mp it nn b gy nw nt l nu nv">length(col_names)==11</span><span id="a1a0" class="nr mp it nn b gy nw nt l nu nv">tab &lt;- tab[-1]</span><span id="e481" class="nr mp it nn b gy nw nt l nu nv">dat &lt;- data.frame(<br/>               x=tab%&gt;%str_replace_all("\\s+"," ")<br/>                    %&gt;%str_replace_all("\\s*USD","")<br/>                    %&gt;%str_replace(" ",""),stringsAsFactors = FALSE)</span><span id="ce6f" class="nr mp it nn b gy nw nt l nu nv">data &lt;- dat%&gt;%separate(x,col_names,sep=" ")</span><span id="779f" class="nr mp it nn b gy nw nt l nu nv">data&lt;-data%&gt;%mutate(total=paste(data$sign,data$Total,sep=""))<br/>          %&gt;%select(-c(sign,Total))</span><span id="7b8b" class="nr mp it nn b gy nw nt l nu nv">names(data)&lt;- names(data)%&gt;%tolower()</span><span id="bfeb" class="nr mp it nn b gy nw nt l nu nv">data$product &lt;- data$product%&gt;%str_replace("-$","")</span></pre><p id="d41c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated"><strong class="lf jd"> d)查看转换数据的最终形式</strong></p><pre class="ks kt ku kv gt nm nn no np aw nq bi"><span id="fceb" class="nr mp it nn b gy ns nt l nu nv">data%&gt;%head()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nz"><img src="../Images/3e7e8e2a4aef251b4fb7c49abab45167.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5XglQabnzXnHZfTKOAdDHQ.png"/></div></div></figure><p id="877c" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">数据集和代码，例如2可以从这个库下载:<a class="ae lz" href="https://github.com/bot13956/extract_table_from_pdf_file_using_R" rel="noopener ugc nofollow" target="_blank">https://github . com/bot 13956/extract _ table _ from _ pdf _ file _ using _ R</a>。</p><p id="210f" class="pw-post-body-paragraph ld le it lf b lg lh kd li lj lk kg ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">总之，我们已经展示了如何从<strong class="lf jd"> pdf </strong>文件中提取数据表。由于<strong class="lf jd"> pdf </strong>文件是一种非常常见的文件类型，每个数据科学家都应该熟悉提取和转换存储在<strong class="lf jd"> pdf </strong>文件中的数据的技术。</p></div></div>    
</body>
</html>