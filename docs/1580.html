<html>
<head>
<title>How To Build a Prometheus Exporter for DHT22/AM2302 Sensor</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建DHT22/AM2302传感器的Prometheus Exporter</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/monitor-home-temperature-and-humidity-with-a-raspberry-pi-and-prometheus-e863c62b6219?source=collection_archive---------2-----------------------#2021-02-25">https://pub.towardsai.net/monitor-home-temperature-and-humidity-with-a-raspberry-pi-and-prometheus-e863c62b6219?source=collection_archive---------2-----------------------#2021-02-25</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ad9e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">用树莓皮DIY你家的温度和湿度</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/0ca84720a73ed1e94be6d244c07781dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*srWeeamxMOudNTQH"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">照片由<a class="ae kv" href="https://unsplash.com/@praveentcom?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit" rel="noopener ugc nofollow" target="_blank">Praveen Thirumurugan</a>/<a class="ae kv" href="https://unsplash.com/?utm_source=ghost&amp;utm_medium=referral&amp;utm_campaign=api-credit" rel="noopener ugc nofollow" target="_blank">Unsplash</a>拍摄</figcaption></figure><p id="0816" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Prometheus是一个用于监控和警告指标的开源项目。它依赖于非常适合物联网用途的时序数据库。在本文中，我们将了解如何从树莓Pi中收集温度和湿度。这些指标是从DHT22/AM2302传感器收集的。我们将了解如何将传感器连接到卡上，并确认数据采集。</p><p id="b95a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下一步是在Golang实施一个Prometheus出口商。导出器通过格式良好的HTTP服务器公开指标。Prometheus服务器调用导出器来收集和存储指标。普罗米修斯本身是用Golang编写的，我们的出口商将使用相同的库。</p><p id="3bfa" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">一旦在普罗米修斯度量，我们配置一个美丽的Grafana仪表板。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="9ee6" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">传感器配置</h1><h2 id="70d6" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">介绍会；展示会</h2><p id="0ae7" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">AM2302是DHT22传感器的有线版本。<a class="ae kv" href="https://learn.adafruit.com/dht" rel="noopener ugc nofollow" target="_blank">数据表</a>呈现以下特征:</p><ul class=""><li id="0b02" class="ni nj iq ky b kz la lc ld lf nk lj nl ln nm lr nn no np nq bi translated">低成本</li><li id="377e" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">3v至5v电源和I/O</li><li id="6482" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">转换期间(请求数据时)最大电流为2.5 mA</li><li id="ffed" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">适用于0–100%湿度读数，精确度为2–5%</li><li id="4aea" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">适用于-40至80°C的温度读数，精度为0.5°C</li><li id="9e15" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">采样率不超过0.5 Hz(每2秒一次)</li><li id="50e3" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">机身尺寸15.1毫米x 25mm毫米x 7.7mm毫米</li><li id="63bb" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">4个间距为0.1英寸的引脚</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nw"><img src="../Images/3702690eeee000976c6baf859f9f1060.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xoFSFCNwqcFzKB29E1Jpdg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">AM2302/DHT22传感器</figcaption></figure><h2 id="f82c" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">关系</h2><p id="fd35" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">传感器是即插即用的，它连接到Raspberry Pi的方式如下:</p><ul class=""><li id="10f7" class="ni nj iq ky b kz la lc ld lf nk lj nl ln nm lr nn no np nq bi translated">GPIO引脚上的DAT(GPIO 3)</li><li id="42b4" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">3v和5v之间的营养引脚上的VCC(引脚1)</li><li id="4065" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated">GCC接地引脚(引脚6)</li></ul><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nx"><img src="../Images/af853edb0fe18179d07aa433aeddece8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3314R8V6HKbVsmF2ld5tRg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">来自https://www.raspberrypi.org/documentation/usage/gpio/<a class="ae kv" href="https://www.raspberrypi.org/documentation/usage/gpio/" rel="noopener ugc nofollow" target="_blank">的树莓pin模式</a></figcaption></figure><h2 id="5a81" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">数据采集</h2><p id="d8ec" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">更新可用软件包列表并安装<code class="fe ny nz oa ob b">python3</code>和<code class="fe ny nz oa ob b">pip</code>:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="4af7" class="mr ma iq ob b gy og oh l oi oj">$ sudo apt-get update<br/>$ sudo apt-get install python3 python3-pip<br/>$ python3 -m pip install --upgrade pip</span></pre><p id="e777" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">安装<code class="fe ny nz oa ob b">Adafruit-DHT</code> pip包:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="8878" class="mr ma iq ob b gy og oh l oi oj">$ python3 -m pip install Adafruit-DHT</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="dd3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使脚本可执行并启动它:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="139c" class="mr ma iq ob b gy og oh l oi oj">$ chmod +x am2302_tester.py<br/>$ python3 am2302_tester.py<br/>Temp=19.2*C  Humidity=55.0%</span></pre><p id="9204" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">传感器可以很好地收集湿度和温度指标。</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="9525" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">普罗米修斯出口商</h1><h2 id="ff09" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">配置</h2><p id="60bd" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">该配置是一个YAML文件，其位置与优先级不同:</p><ul class=""><li id="a6eb" class="ni nj iq ky b kz la lc ld lf nk lj nl ln nm lr nn no np nq bi translated"><code class="fe ny nz oa ob b">/etc/dht-prometheus-exporter.yml</code></li><li id="25b5" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><code class="fe ny nz oa ob b">$HOME/dht-prometheus-exporter.yml</code></li><li id="54ac" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><code class="fe ny nz oa ob b">$PWD/dht-prometheus-exporter.yml</code></li></ul><p id="5158" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">viper包管理配置文件并将值存储到一个结构中。项目的其他部分可以访问重复出现的信息。</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="7f25" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">记录</h2><p id="2049" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">logrus包管理日志记录并重用配置中定义的级别:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="edbb" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">传感器</h2><p id="fb58" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">go-dht包与传感器接口。它已经具有从gpio引脚读取数据的功能。结构包含收集的指标:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="8e89" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">普罗米修斯收集器</h2><p id="55e0" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">普罗米修斯包装提供了收集器。它列出了收集和公开它们的不同指标。湿度和温度指标在同一个收集器中。指标有标签来提供更多的上下文:</p><ul class=""><li id="1133" class="ni nj iq ky b kz la lc ld lf nk lj nl ln nm lr nn no np nq bi translated"><em class="om"> dht_name </em>:易于识别的传感器名称(多传感器时)</li><li id="3b23" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><em class="om">主机名</em></li><li id="fc98" class="ni nj iq ky b kz nr lc ns lf nt lj nu ln nv lr nn no np nq bi translated"><em class="om">单位</em>:温度单位为华氏度或摄氏度</li></ul><p id="6db8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ny nz oa ob b">Describe</code>和<code class="fe ny nz oa ob b">Collector</code>功能已经在Prometheus包中实现。我们需要重新定义它们，以便用我们的指标来重载这些功能:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><h2 id="9030" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">主要的</h2><p id="9b3a" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">主文件粘合了前一个文件的函数。它创建了负责从gpio引脚读取数据的客户端。然后，它用这个客户机实例化收集器并注册它。最后，它用日志配置promhttp服务器并启动它。这些指标可通过<code class="fe ny nz oa ob b">/metrics</code>路径获得:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="ok ol l"/></div></figure><p id="ee30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">启动后，二进制文件会根据请求显示收集的指标:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="7575" class="mr ma iq ob b gy og oh l oi oj">$ pi@raspberrypi:~/go/src/github.com/guivin/dht-prometheus-exporter $ ./dht-exporter<br/>time="2021-02-17T20:19:20Z" level=info msg="Initializing the DHT22/AM2302 sensor on the host"<br/>time="2021-02-17T20:19:20Z" level=info msg="Starting http server on TCP/8080 port"<br/>time="2021-02-17T20:19:36Z" level=info msg="Retrieved humidity=62.70%, temperature=68.90°F from the sensor"</span></pre><p id="285b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">该请求是在TCP/8080端口上完成的:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="0158" class="mr ma iq ob b gy og oh l oi oj"># HELP dht_humidity_percent Humidity percent measured by the sensor<br/># TYPE dht_humidity_percent counter<br/>dht_humidity_percent{dht_name="test",hostname="raspberrypi"} 62.8<br/># HELP dht_temperature_degree Temperature degree measured by the sensor<br/># TYPE dht_temperature_degree counter<br/>dht_temperature_degree{dht_name="test",hostname="raspberrypi",unit="fahrenheit"} 68.9<br/># HELP go_gc_duration_seconds A summary of the GC invocation durations.<br/># TYPE go_gc_duration_seconds summary<br/>go_gc_duration_seconds{quantile="0"} 0<br/>go_gc_duration_seconds{quantile="0.25"} 0<br/>go_gc_duration_seconds{quantile="0.5"} 0<br/>go_gc_duration_seconds{quantile="0.75"} 0<br/>go_gc_duration_seconds{quantile="1"} 0<br/>go_gc_duration_seconds_sum 0<br/>go_gc_duration_seconds_count 0<br/># HELP go_goroutines Number of goroutines that currently exist.<br/># TYPE go_goroutines gauge<br/>go_goroutines 12<br/># HELP go_info Information about the Go environment.<br/># TYPE go_info gauge<br/>go_info{version="go1.11.6"} 1<br/># HELP go_memstats_alloc_bytes Number of bytes allocated and still in use.<br/># TYPE go_memstats_alloc_bytes gauge<br/>go_memstats_alloc_bytes 1.798512e+06<br/># HELP go_memstats_alloc_bytes_total Total number of bytes allocated, even if freed.<br/># TYPE go_memstats_alloc_bytes_total counter<br/>go_memstats_alloc_bytes_total 1.798512e+06<br/># HELP go_memstats_buck_hash_sys_bytes Number of bytes used by the profiling bucket hash table.<br/># TYPE go_memstats_buck_hash_sys_bytes gauge<br/>go_memstats_buck_hash_sys_bytes 724468<br/># HELP go_memstats_frees_total Total number of frees.<br/># TYPE go_memstats_frees_total counter<br/>go_memstats_frees_total 1026<br/># HELP go_memstats_gc_cpu_fraction The fraction of this program's available CPU time used by the GC since the program started.<br/># TYPE go_memstats_gc_cpu_fraction gauge<br/>go_memstats_gc_cpu_fraction 0<br/># HELP go_memstats_gc_sys_bytes Number of bytes used for garbage collection system metadata.<br/># TYPE go_memstats_gc_sys_bytes gauge<br/>go_memstats_gc_sys_bytes 334848<br/># HELP go_memstats_heap_alloc_bytes Number of heap bytes allocated and still in use.<br/># TYPE go_memstats_heap_alloc_bytes gauge<br/>go_memstats_heap_alloc_bytes 1.798512e+06<br/># HELP go_memstats_heap_idle_bytes Number of heap bytes waiting to be used.<br/># TYPE go_memstats_heap_idle_bytes gauge<br/>go_memstats_heap_idle_bytes 589824<br/># HELP go_memstats_heap_inuse_bytes Number of heap bytes that are in use.<br/># TYPE go_memstats_heap_inuse_bytes gauge<br/>go_memstats_heap_inuse_bytes 3.11296e+06<br/># HELP go_memstats_heap_objects Number of allocated objects.<br/># TYPE go_memstats_heap_objects gauge<br/>go_memstats_heap_objects 6257<br/># HELP go_memstats_heap_released_bytes Number of heap bytes released to OS.<br/># TYPE go_memstats_heap_released_bytes gauge<br/>go_memstats_heap_released_bytes 0<br/># HELP go_memstats_heap_sys_bytes Number of heap bytes obtained from system.<br/># TYPE go_memstats_heap_sys_bytes gauge<br/>go_memstats_heap_sys_bytes 3.702784e+06<br/># HELP go_memstats_last_gc_time_seconds Number of seconds since 1970 of last garbage collection.<br/># TYPE go_memstats_last_gc_time_seconds gauge<br/>go_memstats_last_gc_time_seconds 0<br/># HELP go_memstats_lookups_total Total number of pointer lookups.<br/># TYPE go_memstats_lookups_total counter<br/>go_memstats_lookups_total 0<br/># HELP go_memstats_mallocs_total Total number of mallocs.<br/># TYPE go_memstats_mallocs_total counter<br/>go_memstats_mallocs_total 7283<br/># HELP go_memstats_mcache_inuse_bytes Number of bytes in use by mcache structures.<br/># TYPE go_memstats_mcache_inuse_bytes gauge<br/>go_memstats_mcache_inuse_bytes 3456<br/># HELP go_memstats_mcache_sys_bytes Number of bytes used for mcache structures obtained from system.<br/># TYPE go_memstats_mcache_sys_bytes gauge<br/>go_memstats_mcache_sys_bytes 16384<br/># HELP go_memstats_mspan_inuse_bytes Number of bytes in use by mspan structures.<br/># TYPE go_memstats_mspan_inuse_bytes gauge<br/>go_memstats_mspan_inuse_bytes 22080<br/># HELP go_memstats_mspan_sys_bytes Number of bytes used for mspan structures obtained from system.<br/># TYPE go_memstats_mspan_sys_bytes gauge<br/>go_memstats_mspan_sys_bytes 32768<br/># HELP go_memstats_next_gc_bytes Number of heap bytes when next garbage collection will take place.<br/># TYPE go_memstats_next_gc_bytes gauge<br/>go_memstats_next_gc_bytes 4.473924e+06<br/># HELP go_memstats_other_sys_bytes Number of bytes used for other system allocations.<br/># TYPE go_memstats_other_sys_bytes gauge<br/>go_memstats_other_sys_bytes 1.315464e+06<br/># HELP go_memstats_stack_inuse_bytes Number of bytes in use by the stack allocator.<br/># TYPE go_memstats_stack_inuse_bytes gauge<br/>go_memstats_stack_inuse_bytes 491520<br/># HELP go_memstats_stack_sys_bytes Number of bytes obtained from system for stack allocator.<br/># TYPE go_memstats_stack_sys_bytes gauge<br/>go_memstats_stack_sys_bytes 491520<br/># HELP go_memstats_sys_bytes Number of bytes obtained from system.<br/># TYPE go_memstats_sys_bytes gauge<br/>go_memstats_sys_bytes 6.618236e+06<br/># HELP go_threads Number of OS threads created.<br/># TYPE go_threads gauge<br/>go_threads 9<br/># HELP process_cpu_seconds_total Total user and system CPU time spent in seconds.<br/># TYPE process_cpu_seconds_total counter<br/>process_cpu_seconds_total 0.16<br/># HELP process_max_fds Maximum number of open file descriptors.<br/># TYPE process_max_fds gauge<br/>process_max_fds 1024<br/># HELP process_open_fds Number of open file descriptors.<br/># TYPE process_open_fds gauge<br/>process_open_fds 101<br/># HELP process_resident_memory_bytes Resident memory size in bytes.<br/># TYPE process_resident_memory_bytes gauge<br/>process_resident_memory_bytes 1.0858496e+07<br/># HELP process_start_time_seconds Start time of the process since unix epoch in seconds.<br/># TYPE process_start_time_seconds gauge<br/>process_start_time_seconds 1.61359321311e+09<br/># HELP process_virtual_memory_bytes Virtual memory size in bytes.<br/># TYPE process_virtual_memory_bytes gauge<br/>process_virtual_memory_bytes 8.93046784e+08<br/># HELP process_virtual_memory_max_bytes Maximum amount of virtual memory available in bytes.<br/># TYPE process_virtual_memory_max_bytes gauge<br/>process_virtual_memory_max_bytes 1.8446744073709552e+19</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="8d3b" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">普罗米修斯出口装置</h1><h2 id="0848" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">先决条件</h2><p id="c485" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">安装<code class="fe ny nz oa ob b">golang</code>和<code class="fe ny nz oa ob b">make</code>来构建源代码:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="3698" class="mr ma iq ob b gy og oh l oi oj">$ sudo apt install golang make</span></pre><p id="7d42" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为Golang定义环境变量:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="5da5" class="mr ma iq ob b gy og oh l oi oj">$ export GOPATH=$HOME/go<br/>$ export GOBIN=$GOPATH/bin<br/>$ export PATH=$PATH:$GOBIN</span></pre><p id="dbcb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下载<code class="fe ny nz oa ob b">dep</code>包:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="5c0a" class="mr ma iq ob b gy og oh l oi oj">go get -u github.com/golang/dep/cmd/dep</span></pre><h2 id="9f0e" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">建设</h2><p id="158e" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">克隆git存储库并构建源代码:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="80a6" class="mr ma iq ob b gy og oh l oi oj">$ go get -u <a class="ae kv" href="https://github.com/guivin/dht-prometheus-exporter.git" rel="noopener ugc nofollow" target="_blank">github.com/guivin/dht-prometheus-exporter.git</a><br/>$ cd $GOPATH/src/guivin/dht-prometheus-exporter<br/>$ git checkout tags/v0.1<br/>$ make all</span></pre><h2 id="1ac5" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">部署</h2><p id="86b9" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">安装<code class="fe ny nz oa ob b">systemd</code>维修单元:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="8a23" class="mr ma iq ob b gy og oh l oi oj">$ sudo cp dht-prometheus-exporter.service /etc/systemd/system</span></pre><p id="8c49" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">部署配置文件:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="da6f" class="mr ma iq ob b gy og oh l oi oj">$ sudo cp dht-prometheus-exporter.yml /etc<br/>$ sudo chown dht-prometheus-exporter:dht-prometheus-exporter /etc/dht-prometheus-exporter.yml<br/>$ sudo chmod 0640 /etc/dht-prometheus-exporter.yml</span></pre><p id="9323" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为导出者创建一个<code class="fe ny nz oa ob b">dht-prometheus-exporter</code>系统用户和组。该系统用户也属于<code class="fe ny nz oa ob b">gpio</code>作为读取gpio引脚的第二组:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="137c" class="mr ma iq ob b gy og oh l oi oj">$ sudo useradd --user-group --groups gpio --no-create-home --system --shell /usr/sbin/nologin dht-prometheus-exporter</span></pre><p id="4220" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">启动<code class="fe ny nz oa ob b">systemd</code>单元:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="bf15" class="mr ma iq ob b gy og oh l oi oj">$ sudo systemctl daemon-reload<br/>$ sudo systemctl start dht-prometheus-exporter</span></pre><p id="5c17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查<code class="fe ny nz oa ob b">systemd</code>单元的日志；</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="5c4f" class="mr ma iq ob b gy og oh l oi oj">$ sudo journalctl -u dht-prometheus-exporter -f<br/>Feb 18 07:14:25 raspberrypi dht-prometheus-exporter[4031]: time="2021-02-18T07:14:25Z" level=info msg="Initializing the DHT22/AM2302 sensor on the host"<br/>Feb 18 07:14:25 raspberrypi dht-prometheus-exporter[4031]: time="2021-02-18T07:14:25Z" level=info msg="Starting http server on TCP/8080 port"</span></pre></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="b883" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">普罗米修斯</h1><h2 id="a39b" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">安装和配置</h2><p id="242a" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">创建<code class="fe ny nz oa ob b">prometheus</code>系统用户和组:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="b520" class="mr ma iq ob b gy og oh l oi oj">$ useradd --home-dir /opt/prometheus --user-group --shell /usr/sbin/nologin --system prometheus</span></pre><p id="88f7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">下载<code class="fe ny nz oa ob b">prometheus</code>二进制文件并根据您的Raspberry Pi架构进行调整(这里我们使用<code class="fe ny nz oa ob b">armv7</code>):</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="a6cf" class="mr ma iq ob b gy og oh l oi oj">$ cd /tmp<br/>$ wget <a class="ae kv" href="https://github.com/prometheus/prometheus/releases/download/v2.25.0/prometheus-2.25.0.linux-armv7.tar.gz" rel="noopener ugc nofollow" target="_blank">https://github.com/prometheus/prometheus/releases/download/v2.25.0/prometheus-2.25.0.linux-armv7.tar.gz</a><br/>$ tar xzf <a class="ae kv" href="https://github.com/prometheus/prometheus/releases/download/v2.25.0/prometheus-2.25.0.linux-armv7.tar.gz" rel="noopener ugc nofollow" target="_blank">prometheus-2.25.0.linux-armv7.tar.gz</a></span></pre><p id="e8db" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe ny nz oa ob b">/opt/prometheus</code>中为<code class="fe ny nz oa ob b">prometheus</code>用户创建主目录:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="ef29" class="mr ma iq ob b gy og oh l oi oj">$ sudo cp -r <a class="ae kv" href="https://github.com/prometheus/prometheus/releases/download/v2.25.0/prometheus-2.25.0.linux-armv7.tar.gz" rel="noopener ugc nofollow" target="_blank">prometheus-2.25.0.linux-armv7</a> /opt/prometheus<br/>$ sudo chown prometheus:prometheus /opt/prometheus<br/>$ sudo chmod 0740 -R /opt/prometheus</span></pre><p id="dc30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为<code class="fe ny nz oa ob b">tsdb</code>(时序数据库)存储创建具有良好权限的<code class="fe ny nz oa ob b">/var/lib/prometheus</code>目录:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="b831" class="mr ma iq ob b gy og oh l oi oj">$ sudo mkdir /var/lib/prometheus<br/>$ sudo chown -R prometheus:prometheus /var/lib/prometheus<br/>$ sudo chmod -R 0740 /var/lib/prometheus</span></pre><p id="2816" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">从<code class="fe ny nz oa ob b">/opt/prometheus</code>到<code class="fe ny nz oa ob b">/etc</code>中的配置创建一个符号链接:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="3c41" class="mr ma iq ob b gy og oh l oi oj">sudo ln -s /opt/prometheus/prometheus.yml /etc/prometheus.yml</span></pre><p id="6af8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">更新<code class="fe ny nz oa ob b">/etc/prometheus.yml</code>并在<code class="fe ny nz oa ob b">scrape_configs</code>块中添加一个新任务:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="ab83" class="mr ma iq ob b gy og oh l oi oj">- job_name: 'dht-prometheus-exporter'<br/>  static_configs:<br/>    - targets: ['localhost:8080']</span></pre><p id="dd8b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<code class="fe ny nz oa ob b">/etc/systemd/system/prometheus.service</code>中为<code class="fe ny nz oa ob b">prometheus</code>创建一个<code class="fe ny nz oa ob b">systemd</code>单元，如下所示:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="b8ed" class="mr ma iq ob b gy og oh l oi oj">[Service]<br/>Type=simple <br/>User=prometheus<br/>Group=prometheus<br/>ExecReload=/bin/kill -HUP $MAINPID<br/>ExecStart=/opt/prometheus/prometheus \<br/>  --config.file=/etc/prometheus/prometheus.yml \<br/>  --storage.tsdb.path=/var/lib/prometheus \<br/>  --storage.tsdb.retention.time=30d \<br/>  --storage.tsdb.retention.size=0 \<br/>  --web.console.libraries=/opt/prometheus/console_libraries \<br/>  --web.console.templates=/opt/prometheus/consoles \<br/>  --web.listen-address=0.0.0.0:9090 \<br/>  --web.external-url=<br/>SyslogIdentifier=prometheus<br/>Restart=always</span><span id="ec1d" class="mr ma iq ob b gy on oh l oi oj">[Install]<br/>WantedBy=multi-user.target</span></pre><p id="6840" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">启动并启用<code class="fe ny nz oa ob b">prometheus</code>服务:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="3a56" class="mr ma iq ob b gy og oh l oi oj">$ sudo systemctl daemon-reload<br/>$ sudo systemctl start prometheus<br/>$ sudo systemctl enable prometheus</span></pre><p id="ef15" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">确保<code class="fe ny nz oa ob b">prometheus</code>正常:</p><pre class="kg kh ki kj gt oc ob od oe aw of bi"><span id="954e" class="mr ma iq ob b gy og oh l oi oj">sudo systemctl status prometheus --no-pager<br/>● prometheus.service<br/>   Loaded: loaded (/etc/systemd/system/prometheus.service; enabled; vendor preset: enabled)<br/>   Active: active (running) since Thu 2021-02-18 07:37:18 GMT; 16min ago<br/> Main PID: 4348 (prometheus)<br/>    Tasks: 9 (limit: 2062)<br/>   CGroup: /system.slice/prometheus.service<br/>           └─4348 /opt/prometheus/prometheus --config.file=/etc/prometheus/prometheus.yml --storage.tsdb.path=/var/lib/prometheus --storage.tsdb.retention.time=30d --storage.tsdb.retention.size=0 --web.console.libraries=/opt/prometheus/console_libraries --web.console.templates=/opt/prometheus/consoles --web.listen-address=0.0.0.0:9090 --web.external-url=</span><span id="251f" class="mr ma iq ob b gy on oh l oi oj">Feb 18 07:37:18 raspberrypi prometheus[4348]: level=info ts=2021-02-18T07:37:18.614Z caller=head.go:682 component=tsdb msg="On-disk memory mappable chunks replay completed" duration=21.667µs<br/>Feb 18 07:37:18 raspberrypi prometheus[4348]: level=info ts=2021-02-18T07:37:18.614Z caller=head.go:688 component=tsdb msg="Replaying WAL, this may take a while"<br/>Feb 18 07:37:18 raspberrypi prometheus[4348]: level=info ts=2021-02-18T07:37:18.630Z caller=head.go:740 component=tsdb msg="WAL segment loaded" segment=0 maxSegment=1<br/>Feb 18 07:37:18 raspberrypi prometheus[4348]: level=info ts=2021-02-18T07:37:18.632Z caller=head.go:740 component=tsdb msg="WAL segment loaded" segment=1 maxSegment=1<br/>Feb 18 07:37:18 raspberrypi prometheus[4348]: level=info ts=2021-02-18T07:37:18.632Z caller=head.go:745 component=tsdb msg="WAL replay completed" checkpoint_replay_duration=372.29µs wal_replay_duration=17.413166ms total_replay_duration=18.029362ms<br/>Feb 18 07:37:18 raspberrypi prometheus[4348]: level=info ts=2021-02-18T07:37:18.651Z caller=main.go:799 fs_type=EXT4_SUPER_MAGIC<br/>Feb 18 07:37:18 raspberrypi prometheus[4348]: level=info ts=2021-02-18T07:37:18.652Z caller=main.go:802 msg="TSDB started"<br/>Feb 18 07:37:18 raspberrypi prometheus[4348]: level=info ts=2021-02-18T07:37:18.652Z caller=main.go:928 msg="Loading configuration file" filename=/etc/prometheus/prometheus.yml<br/>Feb 18 07:37:18 raspberrypi prometheus[4348]: level=info ts=2021-02-18T07:37:18.680Z caller=main.go:959 msg="Completed loading of configuration file" filename=/etc/prometheus/prometheus.yml totalDuration=27.748754ms remote_storage=11.666µs web_handler=3.281µs query_engine=5.104µs scrape=1.784837ms scrape_sd=278.332µs notify=7.552µs notify_sd=26.25µs rules=23.37…<br/>Feb 18 07:37:18 raspberrypi prometheus[4348]: level=info ts=2021-02-18T07:37:18.682Z caller=main.go:751 msg="Server is ready to receive web requests."<br/>Hint: Some lines were ellipsized, use -l to show in full.</span></pre><h2 id="2d4e" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">网络界面</h2><p id="b96e" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">使用<code class="fe ny nz oa ob b">ip a</code>命令记录您的Raspberry Pi私有IP。打开浏览器，通过TCP/8080端口用HTTP模式连接到浏览器(例如<a class="ae kv" rel="noopener ugc nofollow" target="_blank" href="/&lt;RASPBERRY_IP&gt;:8080">HTTP://&lt;RASPBERRY _ IP&gt;:8080</a>)。出口商在“目标”菜单中注册良好:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oo"><img src="../Images/7a625bd0b14a447686b1739e9daed079.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d6ZK4WBUb5VupUGfgnnEBQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">出口商在普罗米修斯目标公司注册良好，健康状况良好</figcaption></figure><p id="23f1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在Prometheus UI的主页上，我们键入来自导出器的两个指标的名称。它们会出现并显示我们之前定义的标签:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/5bf0096914a9f04990aa21926b1f72c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pSKrCXUsfyHfhdTVeMrSHg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">带标签的dht_temperature_degree度量存在于Prometheus中</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oq"><img src="../Images/34b654ef55caa4390dd39613ecd20334.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IXZdUElpXaCzcm4DsNIViQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">带标签的dht _湿度_百分比指标存在于Prometheus中</figcaption></figure><p id="9053" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们还可以有一个出口商指标的图表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi or"><img src="../Images/84c50390f26bd9f480d311774cae43a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DsL39w7wnlJhVJV5OBtqYg.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">图表显示了普罗米修斯中dht湿度百分比指标的不同值</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="104f" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">格拉夫纳</h1><h2 id="dfb5" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">安装和配置</h2><p id="c583" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">对于Grafana，您可以遵循以下链接中的说明:</p><div class="os ot gp gr ou ov"><a href="https://grafana.com/tutorials/install-grafana-on-raspberry-pi/#3" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd ir gy z fp pa fr fs pb fu fw ip bi translated">在树莓墩上安装Grafana</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">Raspberry Pi是一款小巧、经济、功能强大的电脑，可以运行一系列不同的应用程序。甚至…</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">grafana.com</p></div></div><div class="pe l"><div class="pf l pg ph pi pe pj kp ov"/></div></div></a></div><h2 id="9187" class="mr ma iq bd mb ms mt dn mf mu mv dp mj lf mw mx ml lj my mz mn ln na nb mp nc bi translated">仪表板创建</h2><p id="7f14" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">我们连接到Grafana界面并创建一个新的仪表板。在这个控制面板中，我们为每个指标添加了一个图表:温度和湿度。对于这两者，我们使用avg_over_time函数，向量为1分钟。这是为了避免不连续的图表:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/c6792c9f413668d4709038c84764630d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*W92c7Zc4RiP8zEHADdY0nQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">格拉夫纳的湿度图</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/f274aaddfd550c67644ca294b26b0c46.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3gj0TK0TrC4qQIpTdplBvQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">格拉夫纳的温度图</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pl"><img src="../Images/604b905adcf819be8041610e7c3e450c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gv_epECpT1DBlhG_y5kc5A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">带有湿度和温度图表的仪表板</figcaption></figure></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="f88d" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">结论</h1><p id="add4" class="pw-post-body-paragraph kw kx iq ky b kz nd jr lb lc ne ju le lf nf lh li lj ng ll lm ln nh lp lq lr ij bi translated">通过这些不同的步骤，我们建立了一个带有传感器的监控系统。我们已经将传感器卡连接到Raspberry Pi并验证了数据采集。我们能够得到房间的温度和湿度。</p><p id="ce4a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了让普罗米修斯获得这些指标，我们编写了一个导出器代码。它根据请求通过HTTP服务器公开指标。我们还在指标中添加了一些标签。这在您想要跟踪许多传感器并识别它们的情况下非常有用。</p><p id="3cb6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">然后，我们在Raspberry Pi上安装并配置了Prometheus。它抓取导出器并存储指标。在Prometheus用户界面上，我们注意到我们可以查询和利用这些指标。</p><p id="7cb9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">使用Prometheus用户界面，我们能够根据指标创建图表。但是为了更进一步，我们安装了Grafana以提供更好的可视化体验。在Grafana中，我们创建了一个带有湿度和温度图表的仪表板。</p><p id="b987" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这个项目提供了一个端到端的视图，展示了树莓派和普罗米修斯的可能性。我希望它给了你家庭自动化项目的灵感。感谢您的阅读，并期待看到您未来的成就！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="ce92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">为了支持我的工作并鼓励我写出更好的文章，你可以通过我的推荐链接订阅媒体会员。此外，你将解锁大量的内容和更有见识！</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><h1 id="4d71" class="lz ma iq bd mb mc md me mf mg mh mi mj jw mk jx ml jz mm ka mn kc mo kd mp mq bi translated">资源</h1><div class="os ot gp gr ou ov"><a href="https://learn.adafruit.com/dht" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd ir gy z fp pa fr fs pb fu fw ip bi translated">DHT11、DHT22和AM2302传感器</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">本指南涵盖了低成本DHT温度和湿度传感器。这些传感器非常简单和缓慢，但非常棒…</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">learn.adafruit.com</p></div></div><div class="pe l"><div class="pm l pg ph pi pe pj kp ov"/></div></div></a></div><div class="os ot gp gr ou ov"><a href="https://prometheus.io/docs/instrumenting/writing_exporters/" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd ir gy z fp pa fr fs pb fu fw ip bi translated">写作出口商|普罗米修斯</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">如果您正在检测自己的代码，那么如何使用Prometheus客户端库检测代码的一般规则…</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">普罗米修斯</p></div></div><div class="pe l"><div class="pn l pg ph pi pe pj kp ov"/></div></div></a></div><div class="os ot gp gr ou ov"><a href="https://www.raspberrypi.org/documentation/usage/gpio/" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd ir gy z fp pa fr fs pb fu fw ip bi translated">GPIO</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">Raspberry Pi的一个强大功能是沿顶部边缘的一排GPIO(通用输入/输出)引脚…</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">www.raspberrypi.org</p></div></div><div class="pe l"><div class="po l pg ph pi pe pj kp ov"/></div></div></a></div><div class="os ot gp gr ou ov"><a href="https://pypi.org/project/adafruit-io/" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd ir gy z fp pa fr fs pb fu fw ip bi translated">阿达果木卫一</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">如果您已经安装了PIP(通常在基于Debian/Ubuntu的系统上使用apt-get安装python-pip ),那么运行:pip3…</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">pypi.org</p></div></div><div class="pe l"><div class="pp l pg ph pi pe pj kp ov"/></div></div></a></div><div class="os ot gp gr ou ov"><a href="https://github.com/prometheus/client_golang" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd ir gy z fp pa fr fs pb fu fw ip bi translated">普罗米修斯/客户_golang</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">这是普罗米修斯的Go客户端库。它有两个独立的部分，一部分用于检测应用程序代码，另一部分…</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">github.com</p></div></div><div class="pe l"><div class="pq l pg ph pi pe pj kp ov"/></div></div></a></div><div class="os ot gp gr ou ov"><a href="https://github.com/MichaelS11/go-dht" rel="noopener  ugc nofollow" target="_blank"><div class="ow ab fo"><div class="ox ab oy cl cj oz"><h2 class="bd ir gy z fp pa fr fs pb fu fw ip bi translated">迈克尔11/go-dht</h2><div class="pc l"><h3 class="bd b gy z fp pa fr fs pb fu fw dk translated">使用periph.io驱动程序的Golang DHT22 / AM2302 / DHT11接口请确保设置您的DHT22 / AM2302 / DHT11…</h3></div><div class="pd l"><p class="bd b dl z fp pa fr fs pb fu fw dk translated">github.com</p></div></div><div class="pe l"><div class="pr l pg ph pi pe pj kp ov"/></div></div></a></div></div></div>    
</body>
</html>