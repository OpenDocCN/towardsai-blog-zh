<html>
<head>
<title>Let’s Orchestrate With Airflow — Step-by-Step Airflow Implementations</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">让我们与气流协调—一步一步的气流实施</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/lets-orchestrate-with-airflow-step-by-step-airflow-implementations-8100d8fe58b0?source=collection_archive---------0-----------------------#2022-10-08">https://pub.towardsai.net/lets-orchestrate-with-airflow-step-by-step-airflow-implementations-8100d8fe58b0?source=collection_archive---------0-----------------------#2022-10-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/0f246f1911ae7558e2e1795a6b47de89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jeDIwzcNmx2Sv8ERT3g8vw.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Sachin C Nair的照片:<a class="ae kf" href="https://www.pexels.com/photo/waterfalls-during-sunset-954929/" rel="noopener ugc nofollow" target="_blank">https://www . pexels . com/photo/falls-during-sunset-954929/</a></figcaption></figure><p id="420f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您将在本地环境中用气流编排<strong class="ki iu"> <em class="le"> ETL工作流</em> </strong>，而无需下载<strong class="ki iu">任何东西</strong>。</p><p id="8638" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您将使用<strong class="ki iu"> <em class="le"> Bash运算符</em> </strong>，<strong class="ki iu"> <em class="le"> Python运算符</em> </strong>，<strong class="ki iu"> <em class="le">任务装饰器</em> </strong>，以及其他<strong class="ki iu"> <em class="le">气流</em> </strong>函数。</p><p id="7a9e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您将获得数据，将其加载到<strong class="ki iu"> <em class="le"> PostgreSQL </em> </strong>数据库，并在几分钟内通过<strong class="ki iu"> pgAdmin </strong>查看。</p><p id="31b6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你将使用<strong class="ki iu"> <em class="le"> Docker </em> </strong>容器做任何事情。</p><p id="b9b4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">简单易懂、循序渐进的解释。你会喜欢的。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="579d" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">内容</h1><p id="9dd9" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated"><a class="ae kf" href="#8029" rel="noopener ugc nofollow"> <strong class="ki iu">简介</strong> </a></p><p id="ea61" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#59c9" rel="noopener ugc nofollow"> <strong class="ki iu"> Airflow-Lite本地环境版本</strong> </a></p><p id="4195" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#531b" rel="noopener ugc nofollow"> <strong class="ki iu">有向无环图</strong> </a></p><p id="2495" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#4da4" rel="noopener ugc nofollow"> <strong class="ki iu">数据— TLC跳闸记录数据</strong> </a></p><p id="b215" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#1142" rel="noopener ugc nofollow"> <strong class="ki iu">获取数据</strong> </a></p><p id="84a8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#a118" rel="noopener ugc nofollow"> <strong class="ki iu">提取&amp;加载数据</strong> </a></p><p id="e4b2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#96a8" rel="noopener ugc nofollow">与<strong class="ki iu">同</strong>与</a></p><p id="dda7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#f697" rel="noopener ugc nofollow"> <strong class="ki iu">万一…？</strong> </a></p><p id="60f3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#05a6" rel="noopener ugc nofollow"> <strong class="ki iu"> DAG每月运行</strong> </a></p><p id="28ff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#84bd" rel="noopener ugc nofollow"> <strong class="ki iu">结论</strong> </a></p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mp"><img src="../Images/f875642335d35fe5ecd87fb39ea336da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iPF_70zBWvdhV_G5Ft41Wg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank">https://airflow.apache.org/</a></figcaption></figure></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="8029" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">介绍</h1><p id="3c7f" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">" Airflow是一个由社区创建的平台，用于以编程方式创作、调度和监控工作流."(<a class="ae kf" href="https://airflow.apache.org/" rel="noopener ugc nofollow" target="_blank">https://airflow.apache.org/</a>)</p><p id="4def" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">气流是最著名的工作编排工具之一。</p><p id="3396" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本教程中，我们将讨论本地环境中的气流实现。</p><p id="7d2d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用<a class="ae kf" href="https://medium.com/towards-artificial-intelligence/you-can-install-airflow-with-docker-in-minutes-66a3de44374f" rel="noopener"> <strong class="ki iu">气流Docker Lite安装</strong> </a>。</p><p id="a661" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将从源中获取数据，将其转换并加载到<strong class="ki iu"> <em class="le"> PostgreSQL </em> </strong>数据库中，并用<strong class="ki iu"> <em class="le"> pgAdmin </em> </strong>查看。</p><p id="41cd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们开始吧。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/377094ae0acd4795bd5c07db7a3d0c98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*14hxBjkHscDpcX6T.gif"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片来源:<a class="ae kf" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank">https://giphy.com/</a></figcaption></figure></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="59c9" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">本地环境中的气流精简版</h1><p id="a262" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated"><a class="ae kf" href="https://medium.com/towards-artificial-intelligence/you-can-install-airflow-with-docker-in-minutes-66a3de44374f" rel="noopener"> <strong class="ki iu">在上一篇文章</strong> </a>中，我们讨论了用Docker进行气流安装的两种不同的简易安装选项。</p><p id="9d13" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们看到我们用Docker在几分钟内安装了Airflow。</p><p id="e57e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于Airflow Lite安装，我们只安装了三个主要组件。</p><p id="01eb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">✅ <strong class="ki iu">气流调度器</strong>:调度器监控任务和Dag</p><p id="85aa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">✅ <strong class="ki iu">气流-网络服务器</strong>:网络服务器服务于本地主机:8080</p><p id="9b2a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">✅ <strong class="ki iu"> Postgres </strong>:数据库</p><p id="82de" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本教程中，我们将使用Airflow Lite安装。</p><p id="0b11" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于分步气流，建兴安装教程:<a class="ae kf" href="https://medium.com/towards-artificial-intelligence/you-can-install-airflow-with-docker-in-minutes-66a3de44374f" rel="noopener"> <strong class="ki iu">点击这里</strong> </a>。</p><p id="457a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们用Docker安装Airflow Lite版本。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/a00b160fca0770263506dcc0f870509d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jxvvHUS6-_MPX7YyIQOPgQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mw"><img src="../Images/c07bcb08851108dd193caa6fc6ba8d6a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PGoOsZ904gf8mJo4s4ksRg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="edba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们检查一下集装箱。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/b3c401131ccbdc8e63a7e4ea22e6824e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*vsO46IWj5p1_a74QJnZvhQ.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="94cc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，让我们看看web服务器。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi my"><img src="../Images/351de368a5729f22d9277e6443b58bf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0IKlCkEf6ap4GF1pZ5eKPw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="0134" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一切似乎都没问题。我们有样品。</p><p id="cd6a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们简单地提一下Dag，然后开始我们的工作流程。</p><h1 id="531b" class="lm ln it bd lo lp mz lr ls lt na lv lw lx nb lz ma mb nc md me mf nd mh mi mj bi translated">有向无环图</h1><p id="28ba" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">“在Airflow中，DAG——或有向非循环图——是您想要运行的所有任务的集合，以反映它们的关系和依赖性的方式组织。</p><p id="280a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">DAG是在Python脚本中定义的，它将DAG结构(任务及其依赖项)表示为代码。"(<a class="ae kf" href="https://airflow.apache.org/docs/apache-airflow/1.10.10/concepts.html#:~:text=In%20Airflow,%20a%20DAG%20%E2%80%93%20or,and%20their%20dependencies)%20as%20code." rel="noopener ugc nofollow" target="_blank">参考链接</a>)</p><p id="4d81" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">DAG是小任务的组合，用于执行更大的任务。</p><p id="e076" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">DAG是定义该DAG中的任务的脚本。</p><p id="1862" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">DAG包含气流的信息，以确定DAG结构的执行。</p><p id="c733" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">DAG的非循环部分是值得一提的重要一点。任务以有指导的方式一个接一个地进行。<br/>任务执行中没有循环(见下图)。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ne"><img src="../Images/2d21a743cff8cfc9e652608f9c3fbff0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2_cYKnvhT6W1goPtzet5vQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者代表作:)</figcaption></figure></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="4da4" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">数据— TLC行程记录数据</h1><p id="350d" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">在本教程中，我们将使用<strong class="ki iu"> <em class="le"> TLC记录黄色出租车的行程</em> </strong>。</p><p id="1f4a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">黄色和绿色出租车行程记录包括捕捉上下车日期/时间、上下车位置、行程距离、分项费用、费率类型、付款类型和驾驶员报告的乘客数量的字段(<a class="ae kf" href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page" rel="noopener ugc nofollow" target="_blank">参考链接</a>)</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/b8968c4f86b209257f236507d5b0ce62.png" data-original-src="https://miro.medium.com/v2/resize:fit:1178/format:webp/1*zSRcPiYCIUKVtt4yFoLXyQ.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">数据字典—黄色出租车出行记录—<a class="ae kf" href="https://www1.nyc.gov/assets/tlc/downloads/pdf/data_dictionary_trip_records_yellow.pdf" rel="noopener ugc nofollow" target="_blank">https://www1 . NYC . gov/assets/TLC/downloads/pdf/data _ Dictionary _ Trip _ Records _ Yellow . pdf</a></figcaption></figure><p id="2b42" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的数据将覆盖2022次黄色出租车出行记录(1-6月)。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/26efafd6ad698442790cca144c1cd418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Oj5he8ZdJkEafcUOjmK9nw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated"><a class="ae kf" href="https://www1.nyc.gov/site/tlc/about/tlc-trip-record-data.page" rel="noopener ugc nofollow" target="_blank">https://www1 . NYC . gov/site/TLC/about/TLC-trip-record-data . page</a></figcaption></figure><p id="ffe2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好的。我们了解我们的数据，并对Dag有一个基本的了解。</p><p id="f7fc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是时候用Dag构建我们的工作流了。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="1142" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">获取数据</h1><p id="2556" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">在我们的第一个DAG的帮助下，我们将获得2022年1月黄色出租车出行记录。</p><p id="8e7d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们来详细看看。</p><p id="cf93" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们称我们的工作流为'<strong class="ki iu"> <em class="le"> data_extract </em> </strong>'</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/e398d440a9802f957bb3cd96ee14bc60.png" data-original-src="https://miro.medium.com/v2/resize:fit:1120/format:webp/1*-3gUgVsgdkaKzvRTHdHWXA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者拍摄的图像。</figcaption></figure><p id="ab21" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它从DAG定义开始。</p><p id="a206" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在括号中，我们将dag标记为(“数据提取DAG”)</p><p id="aa8e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一次性的工作流程。</p><p id="4b11" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将从数据源下载一次数据。</p><p id="c08d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们不打算以后安排任何其他工作流程。</p><p id="b6d6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为此，我们将'<strong class="ki iu"> <em class="le"> None </em> </strong>'放入<strong class="ki iu"> <em class="le"> schedule </em> </strong>部分。</p><p id="17c6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们的工作流程开始时间是2022年1月1日。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ni"><img src="../Images/4320dcc0809c9158fd6bf2706958a2a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jDiQGVssJQ-aJzE2Gj_W3w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="108c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们定义了URL地址和输出文件的位置。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/d7b5a1efa580dac4a72d3394e390bdf7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*V8iHaS1JMMT58SGdE7ZPJg.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="4fed" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们把我们的<strong class="ki iu"> <em class="le">任务</em> </strong>放在data_extract DAG下。</p><p id="ffe7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">提取任务将从数据源下载数据，并将其放入定义的输出文件夹中。</p><p id="1ebc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用<strong class="ki iu"> <em class="le"> BashOperator </em> </strong>。</p><p id="b2ce" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">操作人员</strong>在气流中有一项工作要做。比如<strong class="ki iu"> <em class="le"> python操作符</em> </strong>运行python函数。</p><p id="0c67" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">DAG协调这些运算符。</p><p id="bfff" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这种情况下，带有curl命令的Bash操作符将下载该文件。</p><p id="9769" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们把它命名为'<strong class="ki iu"><em class="le">data _ extract _ Dag . py</em></strong>'并把它放在。/dags文件夹。</p><p id="c04c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每当我们将“data_extract_dag.py”文件放在dags文件夹下时，我们的“data _ extract”DAG就会自动出现在Airflow GUI上。</p><p id="fe55" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🛑如果它没有自动出现，没什么好担心的，给它几秒钟时间让它出现。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/bac73a96e1c7b0f260fe1389451cd9b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1276/format:webp/1*0JS_yE2sJrc4M4rCby44Cg.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="5eac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">dag的标签('<strong class="ki iu"><em class="le">data _ extract _ DAG</em></strong>')与气流示例DAG一起出现。</p><p id="92ef" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们点击'<strong class="ki iu"><em class="le">data _ extract _ Dag</em></strong>'看看里面有什么。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nl"><img src="../Images/91521d689a87b8a36618b436ad47f53d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jV0vcIl6XBV2Y98KyS8V-w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="c824" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">DAG只有一个任务，就是'<strong class="ki iu"> <em class="le">提取'</em>T3】</strong></p><p id="2f18" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le">痛击符</em> </strong>会处理它。</p><p id="e882" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们触发DAG并启动它。</p><p id="d68d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当DAG完成时，它将向我们报告状态(成功或失败)。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/c0c65c6cceddeae6f4f726af9eba9434.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*FEfG7ddJ1amJhKC29jMPug.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="0198" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们已经成功了。</p><p id="0aed" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看这条狗的日志。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nn"><img src="../Images/5fcc469ea88c635171cbeb4c0e1441d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rHDOx5VhcneZUTwykoNOWQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="a6f9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le"> Bash操作符</em> </strong>从URL中提取数据并保存到定义的输出文件夹中。</p><p id="e790" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">任务标记为'<strong class="ki iu"> <em class="le">成功</em> </strong>'</p><p id="e114" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们在容器的输出文件夹中查看下载的文件。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi no"><img src="../Images/33effdd3c4cb6162f8e20f8a268bbfe8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*McxDVhDQqJWyzn_Fd7Vn1w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="6db4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们进入了Airflow Docker容器，并列出其中的文件。</p><p id="b1c2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们看到了下载的'<strong class="ki iu"><em class="le">trips _ 2022–01 . parquet</em></strong>'文件。</p><p id="4083" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们从命令行检查这些信息的有效性。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi np"><img src="../Images/1e1b66533080c4eb8cf1c351eb3cf701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*r1GgyvdTIAc_mV53Z9-GEQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="d3c2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">信息匹配。我们已经成功完成了第一个工作流程。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="6a25" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">额外小费</h1><p id="fcb7" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">为了简单起见，我禁用了<strong class="ki iu"> <em class="le">气流预载示例</em> </strong>。</p><p id="064c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您想要禁用气流预载示例，请遵循下面的快照。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nq"><img src="../Images/5c226e6c0c50f91b643f82c23183f4bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N-XI_5n4_zdofn-zwe_81A.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="1d64" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在docker-compose YAML文件中，使load _ examples→'<strong class="ki iu"><em class="le">false</em></strong>'。</p><p id="5552" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用<strong class="ki iu"> docker-compose down </strong>命令停止集装箱。</p><p id="890f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并使用<strong class="ki iu"> docker-compose up </strong>命令用更新的YAML文件启动容器。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nr"><img src="../Images/fcb22f027fe7c27692d34a1a4ba7a7dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AbBuUrkhIXEev-XPMjMaBw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="d337" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Airflow GUI将在没有任何预加载示例的情况下启动。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/b77b92e3115c7eddedcb997fdebdde21.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*x-N4yXbLgEw6GzKG"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片来源:<a class="ae kf" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank">https://giphy.com/</a></figcaption></figure></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="a118" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">提取和加载数据</h1><p id="7d8d" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">我们已经从数据源中提取了数据，并将其保存到定义的输出文件夹中。</p><p id="cfd7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二个DAG会将数据加载到PostgreSQL数据库。</p><p id="ae8e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将把带有Postgres映像的新服务添加到Airflow Lite安装YAML文件中。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/4347fca8b71031644f1f5d0df0490748.png" data-original-src="https://miro.medium.com/v2/resize:fit:1134/format:webp/1*0IEY2j9wMpBh8kx5XIniRw.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="6c04" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们有一个名为'<strong class="ki iu"> <em class="le"> trip-db </em> </strong>的新服务</p><p id="8157" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二个DAG会将数据加载到<strong class="ki iu"> <em class="le"> trip-db </em> </strong>服务上的数据库。</p><p id="a5d1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们制作了几个环境变量，并把它们放入<strong class="ki iu"> <em class="le">。env </em>文件</strong>文件。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/7b0777a4a61a15a1316c7f58863df4ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*DeCD4vgv_1kW1_xfp-X-2A.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="d8fa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二个DAG将管理以下工作流:</p><ol class=""><li id="65b8" class="nv nw it ki b kj kk kn ko kr nx kv ny kz nz ld oa ob oc od bi translated">提取数据(使用第一个DAG完成)</li><li id="f9e1" class="nv nw it ki b kj oe kn of kr og kv oh kz oi ld oa ob oc od bi translated">给熊猫读拼花文件</li><li id="b8ab" class="nv nw it ki b kj oe kn of kr og kv oh kz oi ld oa ob oc od bi translated">将SQL Alchemy引擎连接到PostgreSQL数据库服务器</li><li id="783b" class="nv nw it ki b kj oe kn of kr og kv oh kz oi ld oa ob oc od bi translated">将旅行记录放入PostgreSQL数据库。</li></ol><p id="cee4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Python的帮助下，我们将这些句子放入一个Python函数中(<a class="ae kf" href="https://airflow.apache.org/docs/apache-airflow/stable/best-practices.html" rel="noopener ugc nofollow" target="_blank">引用链接</a>)。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oj"><img src="../Images/88fef8eb6734eea50e973cec96d7c556.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*MzKDpokDyUYNnMGmFOEv1w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="d359" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">按照Airflow官方文档的建议，我们将库放入到<strong class="ki iu"> <em class="le">修饰的Python函数中。</em> </strong> ( <a class="ae kf" href="https://airflow.apache.org/docs/apache-airflow/2.4.1/best-practices.html#top-level-python-code" rel="noopener ugc nofollow" target="_blank">参考链接</a>)。</p><p id="75bf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该函数将调用环境变量。</p><p id="2f72" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该函数将通过<strong class="ki iu"><em class="le">SQL Alchemy</em></strong><strong class="ki iu"><em class="le">create _ engine</em></strong>连接到<strong class="ki iu"> <em class="le"> PostgreSQL </em> </strong>数据库。</p><p id="f082" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们按照官网的PostgreSQL连接形式。(<a class="ae kf" href="https://www.postgresql.org/docs/current/libpq-connect.html#LIBPQ-CONNSTRING" rel="noopener ugc nofollow" target="_blank">参考链接</a>)</p><p id="8d03" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并读取输出文件，将其放入<strong class="ki iu"> <em class="le">熊猫</em> </strong>中。</p><p id="7f2e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，用<strong class="ki iu"> <em class="le"> pandas to_sql </em> </strong>函数，将行程记录加载到<strong class="ki iu"> <em class="le"> PostgreSQL </em> </strong>数据库中。</p><p id="6cd2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le"> pandas to_sql </em> </strong>函数将使用<strong class="ki iu"> <em class="le"> chunksize </em> </strong>参数，小块大小为<strong class="ki iu"> <em class="le"> 10.000 </em> </strong>。</p><p id="890c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🛑根据你的本地计算机能力，随意增加块的大小。</p><p id="5d17" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该功能的最后是一个控制打印功能。</p><p id="10e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于这个任务，我们将使用<strong class="ki iu"> <em class="le">任务装饰器</em> </strong>。</p><p id="e278" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le"> Python修饰的运算符</em> </strong>将执行<strong class="ki iu"> <em class="le"> load_data </em> </strong>函数。</p><p id="b77b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们之前提到过，一个操作员主要有一项工作。</p><p id="a047" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Python修饰的操作符将执行'<strong class="ki iu"><em class="le">load _ data</em></strong>' Python函数。</p><p id="772d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们把<strong class="ki iu"> <em class="le">提取_数据_任务</em> </strong>和<strong class="ki iu"> <em class="le">加载_数据_任务</em> </strong>都放在<strong class="ki iu"> <em class="le">数据_etl </em> </strong> DAG下。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/657b7e028552896cdc57ab9dcc6914b1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KEHNnoWvxsK2MhVyKmqCnA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="31ac" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将新的DAG命名为data_etl。 </p><p id="fd3f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le"> data_etl DAG </em> </strong>有两个任务。</p><p id="fe5e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le"> Bash操作符</em> </strong>将处理提取数据的任务。</p><p id="5f17" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le"> Python修饰的操作符</em> </strong>将处理加载数据任务。</p><p id="3550" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们有了任务的顺序。</p><p id="d3cf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le">提取_数据_任务&gt; &gt;加载_数据()</em> </strong></p><p id="d69b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，将完成extract_data_task，然后将执行load_data函数。</p><p id="0c95" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">姑且命名为'<strong class="ki iu"><em class="le">load _ data _ Dag . py</em></strong>'放在<strong class="ki iu"> <em class="le">下吧。/dags </em>文件夹。</strong></p><p id="838c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并使用更新版本的<strong class="ki iu"><em class="le">docker-compose YAML</em></strong>文件启动容器。</p><p id="bbef" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们转到气流图形用户界面，看看我们的第二个DAG的行动。</p><p id="8ce8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每当我们将新编写的DAG文件放在。/dags文件夹，Airflow DAGs会捕捉它(<strong class="ki iu"> <em class="le">取决于互联网连接，可能需要几秒钟</em> </strong>)。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ol"><img src="../Images/553f5c4f877feb6e684efda316882960.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZmedFg6xdT1WsbjYBKZe9w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="3758" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">“数据-ETL”Dag出现在Airflow GUI上。</p><p id="c7ca" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们点击它来查看它的任务。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi om"><img src="../Images/d34a8277dc125b43860893e3b6de8df6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6pR2CPpSRKjzLCLSnU58hA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="e00f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">“数据etl”有两个任务。e <strong class="ki iu">提取数据</strong>和l <strong class="ki iu">加载数据</strong>。</p><p id="7f11" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们激活DAG并启动工作流。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi on"><img src="../Images/0c5c5837d58b3d87cb7b26279d1b6724.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*j1h1IS1t28-Dr0U22rdQeg.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="b4aa" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">工作流成功完成。</p><p id="7d39" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看日志。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/b87d729124a9ee6743d265dadac2c839.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*E3yy_O2nIRJdqdEzq5sevQ.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="a905" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它打印出我们的控制打印功能</p><p id="12d3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">('<strong class="ki iu"> <em class="le">数据加载到PostgreSQL数据库… </em> </strong>')</p><p id="69d9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">此外，我们观察到加载任务被标记为<strong class="ki iu">成功</strong>。</p><p id="c092" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们去集装箱，看看那里的一切。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi op"><img src="../Images/b8e59d1c352f8a55c3a53272aec17b79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yPqB_ca6Za2lTM-QDjrQFQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="a6fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">统计2022年1月1日的出行记录。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/4783e08bbd5a691b892a1b894a8315c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Z0bnPMlcXwzB1yt-9rz0Gg.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="8b94" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">数据有2.463.931条记录。</p><p id="a935" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看表中的10条记录</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oq"><img src="../Images/c11f95a15e4fa7c874dfd0f96d872bc3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xOgQ_rUDY1uCJXa7fIXlYQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="fb69" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们已经成功地从源中提取了数据，并将其加载到PostgreSQL数据库中。</p><p id="4ea2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们在PostgreSQL数据库上进行SQL查询。</p><p id="4576" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很高兴在终端上看到查询，但我们可以做得更好。</p><p id="5657" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是时候使用PostgreSQL最著名的管理工具之一来查看旅行记录并进行SQL查询了。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="96a8" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">使用pgAdmin</h1><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi or"><img src="../Images/3cd8389ec04d957e258984a7ad804c7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/0*TQxewjFqH1KZaYSi"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片来源:<a class="ae kf" href="https://pgadmin.ilog.ch/" rel="noopener ugc nofollow" target="_blank">https://pgadmin.ilog.ch/</a></figcaption></figure><p id="9d0c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le"> pgAdmin </em> </strong>是一款针对Postgres的管理工具。</p><p id="3aab" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将使用<strong class="ki iu"><em class="le">pg admin Docker image</em></strong>在我们的浏览器上使用<strong class="ki iu"> <em class="le"> pgAdmin </em> </strong>。</p><p id="6979" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们不需要进行大量的安装过程。</p><p id="6604" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将只在docker-compose中添加几行pgAdmin Docker映像的定义。YAML档案。</p><p id="4ef6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后我们就可以在<strong class="ki iu"> <em class="le"> pg_admin </em> </strong>上看到我们的行程记录了。</p><p id="31f8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们开始吧。</p><p id="09a0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们需要创建两个环境变量。</p><p id="9ee6" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将把它们放入<strong class="ki iu"> <em class="le">。env </em> </strong>文件。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi os"><img src="../Images/93159b8212a7225469b824249bbee969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1046/format:webp/1*IDLlK8mfpDKxMrv7Cv7UjA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="4487" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将把它们与pgAdmin Docker图像(<a class="ae kf" href="https://www.pgadmin.org/docs/pgadmin4/latest/container_deployment.html" rel="noopener ugc nofollow" target="_blank">参考链接</a>)一起使用</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ot"><img src="../Images/b02b4dcf91b197187d9571ae03fe3440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gUFslOzQaYQesyaC1Ra7-w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="d27d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le"> docker-compose。YAML的</em> </strong>文件将得到<strong class="ki iu"><em class="le">pg admin</em></strong>docker图像。</p><p id="0558" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">它将使用电子邮件和密码通过定义的端口号连接到网络浏览器上的<strong class="ki iu"> <em class="le"> pgAdmin </em> </strong>服务器。</p><p id="85db" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将这些行放入docker-compose。YAML档案。</p><p id="35a2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">但是在运行YAML文件之前，我们需要停止正在运行的容器，并使用新添加的<strong class="ki iu"> <em class="le"> pgAdmin </em> </strong>映像再次启动它。</p><p id="0e9f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们停止容器，用更新的docker-compose运行它们。YAML档案。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ou"><img src="../Images/d624ff278400ddb95a4085b8a8ba82db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*07IAB516ur5W2ISm5lZosQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="f0cd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们使用YAML文件中定义的电子邮件和密码连接到pgAdmin。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ov"><img src="../Images/47d119e2db4bdf14218fb36859bbc389.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KphtpzMj8L9OWvhphrBLnA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="fe42" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并且我们需要<strong class="ki iu"> <em class="le">添加服务器</em> </strong>来连接Postgres数据库，该数据库运行在容器上。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/78fe6ecfbf22cb158b8fa4b87e13cf72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*JNZr4bPhp1AoGp25piDDcw.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="a8b7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在提供了所需的信息(如上所示)之后，我们成功地连接到了PostgreSQL数据库。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/b6ec33ec1641b9024ac3a2d4fbe52472.png" data-original-src="https://miro.medium.com/v2/resize:fit:576/format:webp/1*6iVHtZ8cpAVzvd08yCy5Cw.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="62cc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们进行一个基本的SQL查询来查看旅行记录的前100行。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oy"><img src="../Images/07f923ec1ec18a17fa1aee985b7d2795.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QC3hXqm61E2ks-5AEOHv3Q.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="c389" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们看看这张表上的旅行记录数量。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/ea12ef3f444092f6143f8156933cb579.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*kaECrOUVtOuMX4a555ZQmA.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="6183" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">表中有2.463.931条记录。我们得到同样的结果。</p><p id="b5e2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一切都很顺利。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="f697" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">如果……会怎样？</h1><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/acd180d32226fc3185ab018ebbc26eb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*vU1m1BcRiknSsind"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片来源:<a class="ae kf" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank">https://giphy.com/</a></figcaption></figure><p id="ab04" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是啊。分析型人的经典问题。</p><p id="bba7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们想下载2022个月的所有数据呢？</p><p id="e0a7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们能安排一下吗？</p><p id="8c8b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们是否可以将2022年的每个月的旅行记录提取并加载到PostgreSQL数据库中，并使用pgAdmin查看它们？</p><p id="ba9e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu"> <em class="le">有何不可？</em> </strong></p><p id="843a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们试一试。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="05a6" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">DAG每月运行一次</h1><p id="e723" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">我们将从数据源中提取2022年黄色出租车出行数据，并将其加载到Postgres数据库中。</p><p id="d6fd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">2022年的数据涵盖了1月至6月之间的月份。</p><p id="b1e9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，放下桌子。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/891b4bad1e41abfbb0ccfd8708ba3c17.png" data-original-src="https://miro.medium.com/v2/resize:fit:962/format:webp/1*xw3ZfspEZpceycc5-lATig.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="426c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了简单起见，我们将获得<strong class="ki iu"> <em class="le">一月、二月和三月</em> </strong>的旅行数据。</p><p id="2042" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将安排工作流，并在规定的时间触发它。</p><p id="ad30" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们修改我们的最后一个DAG。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/0630ada706a47e752f2937afdb876886.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*b2jQbDKm9Wr8p_UGflC6ow.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="d371" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另外，修改我们之前使用的load_data函数。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pc"><img src="../Images/ab2286faedfd783d47e11e10b35d2005.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CIkuWMwQ4aG3sMpV2K3bEQ.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="7810" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，修改输出文件和表名</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pd"><img src="../Images/a49710f25224cf3939ad98d22fc368ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9IEq7eLrn-4tCXrcyVQYSw.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="535e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">“气流利用了<strong class="ki iu"> <em class="le"> Jinja模板、</em> </strong>的力量，这可以成为与宏结合使用的强大工具”(<a class="ae kf" href="https://airflow.apache.org/docs/apache-airflow/2.0.0/concepts.html#jinja-templating" rel="noopener ugc nofollow" target="_blank">参考链接</a>)。</p><p id="09cc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">{ { DAG _ run . logical _ date } }</strong>:DAG运行的逻辑日期</p><p id="a17a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">{ { ds } }</strong>:DAG运行的逻辑日期为YYYY-MM-DD</p><p id="b474" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对于每次执行，DAG将更新输出文件名和表名。</p><p id="2c27" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们激活DAG并查看它。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi pe"><img src="../Images/903f102c8827adc8f3a2c8648b14ba4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8a7pYH4wwTTZTjnSDqxQww.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="a0f4" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">DAG成功完成了3项工作。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/eb7a7a8fa15f529f486d77c43c48724c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*crFLT6Pns7N2uEMXOS6f0Q.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="d214" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们看到了我们的打印输出(“数据加载到trips_2022_03表”)</p><p id="00cb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">是时候看看pgAdmin了。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/df5be261ef397e5753727cb8fc8b0cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:446/format:webp/1*vdOJwsBx-5NNPv5YFWltQQ.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="2fbf" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">那里有三张桌子。</p><p id="ac98" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，我们来查一下2022年3月的表。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mv"><img src="../Images/42a0294bdd1fe5f70857f77cf8c2960d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mBMITgPwnzD_8SCo1yog4w.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者捕获的图像</figcaption></figure><p id="9f75" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">干得好。</p><figure class="mq mr ms mt gt ju gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/fbda420b86585de4e481cbb8180a4883.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*BigIZZFL-eAozgQd"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片来源:<a class="ae kf" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank">https://giphy.com/</a></figcaption></figure></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="17de" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🛑在使用每月计划DAG运行DAG期间，您可能会在DAG日志中看到以下错误消息。</p><pre class="mq mr ms mt gt ph pi pj pk aw pl bi"><span id="5ee9" class="pm ln it pi b gy pn po l pp pq">Task exited with return code Negsignal.SIGKILL</span></pre><p id="8834" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着操作系统终止了该进程。</p><p id="e59b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对此有几种解决方案。</p><p id="3a6d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我将提到一个气流解决方案-Docker。<br/> <br/>对于内存密集型的工作，我们需要增加Docker桌面的内存。</p><p id="8ade" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🛑气流主要用于编排，而不是加载大量数据。在下面的文章中，我们将讨论如何使用云服务找到解决方案。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><h1 id="84bd" class="lm ln it bd lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj bi translated">结论</h1><p id="f67b" class="pw-post-body-paragraph kg kh it ki b kj mk kl km kn ml kp kq kr mm kt ku kv mn kx ky kz mo lb lc ld im bi translated">气流是最著名的工作编排工具之一。</p><p id="c40c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本教程中，我们看到了<strong class="ki iu"> <em class="le"> Airflow </em> </strong>在本地环境中的实现以及<strong class="ki iu"><em class="le">air flow Docker</em></strong>Lite安装。</p><p id="3f41" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们从数据源中提取数据并将数据加载到<strong class="ki iu"> <em class="le"> PostgreSQL </em> </strong>数据库中。</p><p id="961c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，用<strong class="ki iu"> <em class="le"> pgAdmin </em> </strong>管理<strong class="ki iu"> <em class="le"> PostgreSQL </em> </strong>数据库，做了一个基本的SQL查询。</p><p id="ff7e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/airflow-is-on-the-cloud-elt-pipeline-orchestration-with-airflow-aws-4d4268e5321a"> <strong class="ki iu">在下面的文章</strong> </a>中，我们将用<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/airflow-is-on-the-cloud-elt-pipeline-orchestration-with-airflow-aws-4d4268e5321a"> <strong class="ki iu"> <em class="le">气流</em></strong>&amp;<strong class="ki iu"><em class="le">AWS</em></strong></a>来讨论ELT管道编排。</p><p id="3904" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文是<a class="ae kf" href="https://medium.com/@kaanboke/list/workflow-tools-e3da3a530ea5" rel="noopener"> <strong class="ki iu">工作流工具列表</strong> </a>的一部分。你可以在 这里找到<a class="ae kf" href="https://medium.com/@kaanboke/list/workflow-tools-e3da3a530ea5" rel="noopener"> <strong class="ki iu">系列的其他文章。</strong></a></p><p id="62dd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望它有所帮助。</p><p id="5274" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对了，喜欢题目的时候，<strong class="ki iu">可以通过支持</strong> <strong class="ki iu">来表现👏</strong></p><p id="06cc" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">欢迎发表评论。感谢您抽出时间。</p><h1 id="0853" class="lm ln it bd lo lp mz lr ls lt na lv lw lx nb lz ma mb nc md me mf nd mh mi mj bi translated">万事如意🤘</h1></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="d1c7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">代码</strong>可以从<a class="ae kf" href="https://github.com/kb1907/airflow-local" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">这里</strong> </a>下载。</p></div><div class="ab cl lf lg hx lh" role="separator"><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk ll"/><span class="li bw bk lj lk"/></div><div class="im in io ip iq"><p id="9005" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你喜欢看我的内容，<a class="ae kf" href="https://medium.com/@kaanboke/membership" rel="noopener"> <em class="le">请考虑关注我</em> </a>。还有，你可以通过<a class="ae kf" href="https://medium.com/@kaanboke/membership" rel="noopener"> <strong class="ki iu">订阅Medium </strong> </a>来支持其他作家和我。使用我的推荐链接不会额外花费你。</p></div></div>    
</body>
</html>