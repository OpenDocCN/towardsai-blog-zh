<html>
<head>
<title>Market Basket Analysis for Retail Growth</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">零售增长的市场篮子分析</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/market-basket-analysis-key-to-retail-growth-engine-490362d1de94?source=collection_archive---------1-----------------------#2021-01-09">https://pub.towardsai.net/market-basket-analysis-key-to-retail-growth-engine-490362d1de94?source=collection_archive---------1-----------------------#2021-01-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="5357" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-analytics" rel="noopener ugc nofollow" target="_blank">数据分析</a></h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/8c833086c0f7d115d76b28264d711c89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PvG1X01VeN4q1P_kcem2xQ.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">来源:图片由<a class="ae kl" href="https://www.bigcommerce.com/blog/ecommerce-trends/" rel="noopener ugc nofollow" target="_blank"> bigcommerce </a>上的<a class="ae kl" href="https://www.bigcommerce.com/blog/author/susan-meyer/" rel="noopener ugc nofollow" target="_blank">苏珊</a>提供</figcaption></figure><p id="f2aa" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这些统计数据显示，到2023年，电子商务销售额将达到6.5万亿美元。不仅是电子商务，我们还看到销售终端零售交易的增长。鉴于这一市场规模，利用零售交易数据在新领域进行创新至关重要。基于零售趋势，我们期待不同的创新，如改善客户体验的个性化。现场个性化是全球大多数零售商的目标之一。</p><p id="a36b" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">本文将讨论大型零售商使用的“市场购物篮分析”，以了解商品之间的关联。</p><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/0c79d2ec6d15a1168953f367208694c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*ZiNN_6forT8gJ6LxE2gyKw.jpeg"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">来源:图片由<a class="ae kl" href="https://www.freepik.com/free-vector/realistic-supermarket-trolley-full-items_9463007.htm#page=1&amp;query=shopping%20basket&amp;position=16" rel="noopener ugc nofollow" target="_blank"> freepik </a>上的<a class="ae kl" href="https://www.freepik.com/macrovector" rel="noopener ugc nofollow" target="_blank">宏向量</a>提供</figcaption></figure><p id="041a" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">你可能在不同的电商网站看到过“<em class="lp">买了</em>这件<em class="lp">商品的顾客也买了</em>”这种方法量化了项目之间的互补和补充关系。</p><blockquote class="lq"><p id="b00d" class="lr ls iq bd lt lu lv lw lx ly lz lj dk translated"><strong class="ak">如果{面包、饼干}那么{牛奶} </strong></p></blockquote><p id="6fe3" class="pw-post-body-paragraph km kn iq ko b kp ma kr ks kt mb kv kw kx mc kz la lb md ld le lf me lh li lj ij bi translated">零售交易数据是在销售点终端生成的丰富信息源。如果明智地使用这些信息，可以帮助公司通过交叉促销和定价增加收入。不仅是这一点，零售商还可以使用不同的促销策略来改善顾客体验，以说服他们的顾客在他们的商店花更多的时间。现在的问题是，我们如何利用购物篮分析来增加在商店逗留的时间。我们可以使用这种优化技术来最大化顾客的步行距离。这种策略可以让顾客继续一起购买产品。通常，在商店中，产品是根据功能摆放的，但如果我们根据历史交易智能地利用数据，我们就可以以增加客户整体距离的方式来布置产品。这一举措将带来更好的客户体验和购物行为。</p><p id="c4ab" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">本文将关注购物篮分析，我们将在其中创建产品之间的关联规则。例如，使用历史数据，我们可以确定牛奶和面包是一起购买的。而是店家到底应该用牛奶来促销面包还是用面包来促销牛奶。</p><h2 id="4e53" class="mf mg iq bd mh mi mj dn mk ml mm dp mn kx mo mp mq lb mr ms mt lf mu mv mw iw bi translated">概观</h2><p id="c766" class="pw-post-body-paragraph km kn iq ko b kp mx kr ks kt my kv kw kx mz kz la lb na ld le lf nb lh li lj ij bi translated">在我们实现概念之前，了解它们是至关重要的。当然，零售商需要知道我们有足够的规则证据。</p><p id="955a" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">支持:</strong>是一个物品的受欢迎程度。例如，在500条交易记录中，牛奶出现了200次。那么牛奶的受欢迎程度将被计算为200/500=0.4。简单来说就是含奶交易占总交易数的比例。我们可以类似地计算多个产品的支持度。</p><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nc"><img src="../Images/8538fc1a9cc8153abe9823734faac6b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7_EXfkIefVTa3nbTSp0Hng.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">牛奶的普及(图片由作者提供)</figcaption></figure><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nd"><img src="../Images/a11d32aea3dc1d8fe83f89a1f32ac55b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aEDUuKM8ulfATipRiYtDCA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">牛奶和咖啡的流行(图片由作者提供)</figcaption></figure><p id="1469" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">使用支持度，我们可以构建频繁项集，即频繁出现在一起的项集，但它不能告诉我们关联规则(如果Y，则Z)</p><p id="e5a0" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja"> 2。置信度:</strong>该度量用于找出项目集之间的关系，并指示关系的置信度。比如从支撑上我们知道牛奶和咖啡经常一起购买，但是店家到底应该用牛奶促销咖啡还是咖啡促销牛奶。这就是信心的来源。</p><p id="f09a" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">用数学术语来说:</p><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ne"><img src="../Images/3d31174f2b8aded4d838ec81060f132b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hI6DpJ_m78fLvhsFoEJyfg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">范围:[0，1](图片由作者提供)</figcaption></figure><p id="631d" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这里我们在计算如果A那么c的置信度。</p><p id="feab" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们将左边(A)的项称为<strong class="ko ja"> <em class="lp">先行项</em> </strong>，右边(C)的项称为<strong class="ko ja"> <em class="lp">后行项</em> </strong>。</p><p id="f181" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这个简单的公式表明在一个交易中看到一个结果的概率，假设它也包含一个前提。</p><p id="af98" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja"> Lift: </strong>它衡量A和C一起出现的频率比我们随机预期的多多少。因此，提升值检查这种关系是否优于随机关系。</p><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nf"><img src="../Images/94acc2f44946772767d6da2d78c54a02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IKUaY4zQdUJdPsyzYOaQ2Q.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">范围:[0，∞](图片由作者提供)</figcaption></figure><p id="ae28" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">解释</p><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ng"><img src="../Images/9edc04a1b40d501b5173fe5625a4e33b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*36fUISXGk64zu9ODze25Dg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">他们之间没有这种关联。(图片由作者提供)</figcaption></figure><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nh"><img src="../Images/e99231b7b436a903729b712fae6a5036.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NfPj1t8-oOoe3-XM15kmHA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">它们之间存在正相关关系。(图片由作者提供)</figcaption></figure><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ni"><img src="../Images/6b49a817ba62f64edf853abd0add8833.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kb4DOw8nelar9Xgoe0Q2Ew.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">两者呈负相关。产品A和C不太可能一起购买。(图片由作者提供)</figcaption></figure><p id="2874" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">杠杆:</strong>这个指标类似于提升，但更容易解释。确定好规则的阈值是0。如果你检查这里的公式，我们可以看到这个公式把A和C同时出现的概率和A和C是独立的概率之间的差异。</p><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nj"><img src="../Images/1596b880a179773b7dd0735f608fe204.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*usWAxH4FeaaXsNpLWVce9g.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">杠杆的数学公式<strong class="bd mh"> ( </strong>图片由作者提供)</figcaption></figure><p id="02f7" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这些概念对执行市场篮子分析很重要，但还有更多像信念和张度量这样的概念。张是一个重要的度量，它告诉我们关于项目的分离和关联。它介于-1(完全分离)和1(完全结合)之间。我们不会详细讨论所有这些。</p><h2 id="4be8" class="mf mg iq bd mh mi mj dn mk ml mm dp mn kx mo mp mq lb mr ms mt lf mu mv mw iw bi translated"><strong class="ak">Apriori算法概述</strong></h2><p id="b32e" class="pw-post-body-paragraph km kn iq ko b kp mx kr ks kt my kv kw kx mz kz la lb na ld le lf nb lh li lj ij bi translated">现在我们知道了所有的概念，你可能会想我们如何计算成千上万个项目的关联规则。例如，如果你有10000个物品，所有可能的组合是2 ⁰⁰⁰⁰ &gt; 10⁸(宇宙中的原子数量)。鉴于机器的生产能力，这是不可能计算的。这就是Apriori算法的用武之地。</p><p id="4b1c" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">Apriori算法通过检查最小支持度来减少规则的数量。例如，如果项目A不常见(使用最小支持阈值)，则忽略所有项目A组合。因此，这种算法将节省时间和精力。</p><h2 id="270c" class="mf mg iq bd mh mi mj dn mk ml mm dp mn kx mo mp mq lb mr ms mt lf mu mv mw iw bi translated">实施:</h2><p id="bf88" class="pw-post-body-paragraph km kn iq ko b kp mx kr ks kt my kv kw kx mz kz la lb na ld le lf nb lh li lj ij bi translated">零售数据集:<a class="ae kl" href="https://www.kaggle.com/heeraldedhia/groceries-dataset" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/heeraldedhia/groceries-dataset</a></p><p id="5e92" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们将使用mlxtend库来实现购物篮分析。</p><p id="ea06" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">导入数据</strong></p><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="84d0" class="mf mg iq nl b gy np nq l nr ns">import pandas as pd<br/>df = pd.read_csv("Groceries_dataset.csv",error_bad_lines=False)<br/>df.head()</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nt"><img src="../Images/401fc61363e55cf35bc7373bfbf873d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*O97NoCN9sIOortocqM2zSA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">零售交易(图片由作者提供)</figcaption></figure><p id="d61a" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们可以在这里看到，数据包含零售交易。</p><p id="6767" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">探索性数据分析</strong></p><ul class=""><li id="6e2d" class="nu nv iq ko b kp kq kt ku kx nw lb nx lf ny lj nz oa ob oc bi translated"><strong class="ko ja">绘制绝对频率</strong></li></ul><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="7b44" class="mf mg iq nl b gy np nq l nr ns">import matplotlib.pyplot as plt<br/>%matplotlib inline</span><span id="ab2b" class="mf mg iq nl b gy od nq l nr ns">plt.figure(figsize=(25,10))<br/>grouped = df[['itemDescription']].groupby('itemDescription').size()<br/>grouped.sort_values(ascending=False).plot(kind='bar')</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi oe"><img src="../Images/105015ee10132c566de51163d2e6f479.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4GD-aLozl_Cij5XuMSHZHg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">绝对频率(图片作者提供)</figcaption></figure><p id="a7d2" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">正如我们在这里看到的，全脂牛奶是商店里最受欢迎的商品，而加工产品是最不受欢迎的商品。同样，我们可以使用简单的EDA找出最喜欢和最不喜欢的。</p><ul class=""><li id="3dc5" class="nu nv iq ko b kp kq kt ku kx nw lb nx lf ny lj nz oa ob oc bi translated"><strong class="ko ja">绘图相对频率</strong></li></ul><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="1737" class="mf mg iq nl b gy np nq l nr ns">rel_freq=df['itemDescription'].value_counts() / len(df)<br/>rel_freq.sort_values(ascending=False).plot(kind='bar',color='red')</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi of"><img src="../Images/9612c4216a00e9764c00e1280c706b5b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*miXxpTmsAaREdyC7rKKeQw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">相对频率(图片由作者提供)</figcaption></figure><ul class=""><li id="b5db" class="nu nv iq ko b kp kq kt ku kx nw lb nx lf ny lj nz oa ob oc bi translated"><strong class="ko ja">树形图和词云</strong></li></ul><p id="320a" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">Treemap在分层结构图中可视化大量数据，其中矩形的大小从最大到最小组织。</p><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="8448" class="mf mg iq nl b gy np nq l nr ns">import squarify<br/>plt.figure(figsize = (100, 70))<br/>squarify.plot(sizes = df.itemDescription.value_counts().values, alpha = 0.7,<br/>              label = df.itemDescription.unique(), text_kwargs={'fontsize':50})<br/>plt.title('Item Description', fontsize = 20)<br/>plt.axis('off')<br/>plt.show()</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi og"><img src="../Images/e0d8a0e158d2c010fc6e3b705ce5a1a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aht3leVvwrOF9ZWdIZZzaQ.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">树形图(图片由作者提供)</figcaption></figure><p id="0790" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这看起来真的很有趣，我们可以看到像全脂牛奶，水果，其他蔬菜，面包卷/小圆面包比其他产品更重要。</p><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="c891" class="mf mg iq nl b gy np nq l nr ns">from wordcloud import WordCloud<br/>plt.subplots(figsize=(100,70))<br/>wordcloud = WordCloud(background_color = 'white',<br/>                     width=500,<br/>                     height=300).generate(','.join(df['itemDescription']))</span><span id="9d37" class="mf mg iq nl b gy od nq l nr ns">plt.imshow(wordcloud)<br/>plt.axis('off')</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi oh"><img src="../Images/c5273617cae3821c1435c912563635b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wBh23ixsExqCyVLgu5kmQg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">词云(图片由作者提供)</figcaption></figure><ul class=""><li id="e966" class="nu nv iq ko b kp kq kt ku kx nw lb nx lf ny lj nz oa ob oc bi translated"><strong class="ko ja">每月交易量</strong></li></ul><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="85c3" class="mf mg iq nl b gy np nq l nr ns">df['Date']=df['Date'].astype('datetime64[ns]')</span><span id="6597" class="mf mg iq nl b gy od nq l nr ns">df["Year_Months"]=pd.to_datetime(df['Date'].dt.year.astype('str')+"-"+df['Date'].dt.month.astype('str')).dt.to_period('M')</span><span id="d972" class="mf mg iq nl b gy od nq l nr ns">df[["Year_Months"]].groupby("Year_Months").size().plot(kind='bar',color='green')</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi oi"><img src="../Images/3065439a0452969ac2b24f4a20eac123.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sRJKyjk62xVpYHMW7Q1g4g.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">每月交易量(图片由作者提供)</figcaption></figure><p id="99bf" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">最高的交易数量发生在2015年1月和8月。我们也可以进一步探索。</p><p id="51a5" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">您还可以对该数据集进行不同的分析，包括畅销商品、每个会员的商品数量分布，从而得出一个概念。我会把这个留给你。</p><p id="b801" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">购物篮分析的数据准备</strong></p><ul class=""><li id="de54" class="nu nv iq ko b kp kq kt ku kx nw lb nx lf ny lj nz oa ob oc bi translated"><strong class="ko ja">同一顾客在同一天一起购买的商品分组</strong></li></ul><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="4464" class="mf mg iq nl b gy np nq l nr ns">df_dataprep_st1=df.groupby(['Member_number','Date'])['itemDescription'].apply(','.join).reset_index()</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi oj"><img src="../Images/59c1b4e94cf13ac21b5e861ac54984a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WivitryszZOTRCbe8YoegA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">组<strong class="bd mh"> </strong>(图片由作者提供)</figcaption></figure><p id="acb7" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在我们可以看到，在同一天，我们有一个相同客户的商品列表。</p><ul class=""><li id="d337" class="nu nv iq ko b kp kq kt ku kx nw lb nx lf ny lj nz oa ob oc bi translated"><strong class="ko ja">将项目集转换为2D数组(需要作为预处理算法的输入)</strong></li></ul><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="332f" class="mf mg iq nl b gy np nq l nr ns">itemsets=df_dataprep_st1[['itemDescription']].values<br/>itemsets=[(''.join(i).split(",")) for i in itemsets]</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ok"><img src="../Images/be94822a08c2ffaaa27848ad6fb741ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQYlUOKnCgqIuMUrzy1y9Q.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">(图片由作者提供)</figcaption></figure><p id="2ca6" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja"> 3。使用Mlxtend事务编码器</strong>转换为单热码</p><p id="12ad" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">Mlxtend期望将单热数据作为输入，因此我们需要将数据转换为单热数据格式。</p><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="1eaa" class="mf mg iq nl b gy np nq l nr ns">from mlxtend.preprocessing import TransactionEncoder</span><span id="b87c" class="mf mg iq nl b gy od nq l nr ns">te = TransactionEncoder()<br/>te_ary = te.fit(itemsets).transform(itemsets)<br/>df_onehot = pd.DataFrame(te_ary, columns=te.columns_)</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ol"><img src="../Images/0ebd19e3aad5d5e9e9c594a42ca0a676.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cabbeF5-iUzsm85WW0hIVQ.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">一热数据(图片由作者提供)</figcaption></figure><p id="f51c" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">挖掘频繁项集和关联规则</strong></p><p id="c8ac" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">让我们首先分析不同的支持度和信任度。</p><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="c980" class="mf mg iq nl b gy np nq l nr ns">supportLevels =[0.01,0.009,0.007,0.005,0.003,0.001]<br/>confidenceLevels=[1,0.9,0.8,0.7,0.6,0.5, 0.4, 0.3, 0.2, 0.1,0.05,0.03,0.01,0.001]</span><span id="7853" class="mf mg iq nl b gy od nq l nr ns">dict_lengths={}<br/>for min_support in supportLevels:<br/>    frequent_itemsets = apriori(df_onehot, min_support=min_support, use_colnames=True)<br/>    #length_frequent_itemsets.append(len(frequent_itemsets))<br/>    #print(min_support)<br/>    conf_len_rules=[]<br/>    for min_confidence in confidenceLevels:<br/>        rules = association_rules(frequent_itemsets, metric = "confidence",min_threshold = min_confidence)<br/>        print(min_confidence,len(rules))<br/>        conf_len_rules.append( (min_confidence, len(rules)) )<br/>    #print(conf_len_rules)<br/>    plt.plot([i[0] for i in conf_len_rules],[i[1] for i in conf_len_rules],label="Support"+str(min_support))<br/>    plt.legend(loc="upper right")</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div class="gh gi om"><img src="../Images/9ae3aa4572b4dee5cd20ec2ca7c5271d.png" data-original-src="https://miro.medium.com/v2/resize:fit:762/format:webp/1*LAlYaQbpNz7UfGja-v3d-A.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">(图片由作者提供)</figcaption></figure><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div class="gh gi on"><img src="../Images/b11df6ac23e77b805d99669e93c4fa5e.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*pkBUdwoLEyhbkyEp39UJyQ.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">1%的支持率(图片由作者提供)</figcaption></figure><p id="ab19" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">1%的支持度:我们只能找到少数几个可信度低的规则。我们不能真正选择这个支持值。</p><p id="67f7" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">同样，对于你在图上看到的较低的支撑，我们有许多规则要分析。</p><p id="8de8" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">频繁项目集</strong></p><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="79d7" class="mf mg iq nl b gy np nq l nr ns">frequent_itemsets = apriori(df_onehot, min_support=0.001, use_colnames=True)<br/>frequent_itemsets['length'] = frequent_itemsets['itemsets'].apply(lambda x: len(x))</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi oo"><img src="../Images/75bd950138039a8cd386c491e2708748.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l64S-yuhuFhA-MrijBu1dA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">频繁项目集(作者图片)</figcaption></figure><p id="421b" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们现在有750个使用最小支持度0.001的频繁项集。这样，我们使用mlxtend库来应用Apriori算法。</p><p id="1426" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">关联规则</strong></p><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="d449" class="mf mg iq nl b gy np nq l nr ns">rules = association_rules(frequent_itemsets, metric="confidence", min_threshold=0.02)</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi op"><img src="../Images/9f39d8011835dce0a5aa2baaf2124b10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*f3S-T9Rf4mh8jT--qgtSew.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">关联规则(图片由作者提供)</figcaption></figure><p id="9127" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们应用0.02的置信度阈值从我们的频繁集得到999条规则。现在，您可以看到我们讨论过的所有指标和规则。</p><p id="b603" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">进一步过滤</strong></p><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="f16e" class="mf mg iq nl b gy np nq l nr ns">rules=rules[rules['lift']&gt;1].reset_index(drop=True)</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi oq"><img src="../Images/9da945add12143c7411d634835a25ada.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-siisKxg8iijmNqIyLZvrw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">进一步过滤(图片由作者提供)</figcaption></figure><p id="179a" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在我们只剩下189条规则供进一步分析。</p><p id="73c1" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们还可以找出最相关的规则，即如果{香肠}那么{全脂牛奶，酸奶}。让我们使用热图可视化来检查并验证我们的结果。</p><p id="c356" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">岗位分析</strong></p><ul class=""><li id="f943" class="nu nv iq ko b kp kq kt ku kx nw lb nx lf ny lj nz oa ob oc bi translated"><strong class="ko ja">热图</strong></li></ul><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi or"><img src="../Images/917e9f3aae9b79ea3b7dbf5122d9246a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*iHXsSMEn2Bk-wKRMyTgx9A.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">分析后热图(图片由作者提供)</figcaption></figure><p id="1742" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">正如你在这里看到的，不同规则的相互关系。从这个探索性的分析中，我们很容易发现，如果{香肠}那么{全脂牛奶，酸奶}是一个很好的开始规则。也请找到其他这样的规则作为练习。</p><ul class=""><li id="1ee7" class="nu nv iq ko b kp kq kt ku kx nw lb nx lf ny lj nz oa ob oc bi translated"><strong class="ko ja">信心/支持散点图</strong></li></ul><pre class="ll lm ln lo gt nk nl nm nn aw no bi"><span id="a6f6" class="mf mg iq nl b gy np nq l nr ns">rules = association_rules(frequent_itemsets, metric = "confidence",min_threshold = 0.0)<br/>sns.set(rc={'figure.figsize':(10,10)})<br/>sns.scatterplot(x = "support", y = "confidence", <br/>                size = "lift", data = rules)<br/>plt.show()</span></pre><figure class="ll lm ln lo gt ka gh gi paragraph-image"><div class="gh gi os"><img src="../Images/c50ad794a80327f6d02476b23646cbd4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*7lO79OVSBE5Id2UYSrCILg.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">信心/支持散点图(图片由作者提供)</figcaption></figure><p id="9544" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">研究表明，最优规则位于支持度/置信度边界上。如果你看这个图，你会注意到升力在支持/信心边界总是很高。</p><h2 id="e51d" class="mf mg iq bd mh mi mj dn mk ml mm dp mn kx mo mp mq lb mr ms mt lf mu mv mw iw bi translated">结论</h2><p id="5f03" class="pw-post-body-paragraph km kn iq ko b kp mx kr ks kt my kv kw kx mz kz la lb na ld le lf nb lh li lj ij bi translated">在本文中，我们讨论了市场篮子分析的重要性，因为市场规模巨大。我们讨论了用于识别项目集之间关系的重要度量，如支持度、置信度、提升度和杠杆。然后我们继续到实现部分，看看实现这一切有多容易。</p><h2 id="a6a9" class="mf mg iq bd mh mi mj dn mk ml mm dp mn kx mo mp mq lb mr ms mt lf mu mv mw iw bi translated">参考</h2><p id="79a1" class="pw-post-body-paragraph km kn iq ko b kp mx kr ks kt my kv kw kx mz kz la lb na ld le lf nb lh li lj ij bi translated">[1]<a class="ae kl" href="http://www.laccei.org/LACCEI2016-SanJose/RefereedPapers/RP307.pdf" rel="noopener ugc nofollow" target="_blank">http://www . laccei . org/laccei 2016-San Jose/referendedpapers/RP 307 . pdf</a></p><p id="39ce" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">[2]<a class="ae kl" href="http://rasbt.github.io/mlxtend/user_guide/frequent_patterns/association_rules/" rel="noopener ugc nofollow" target="_blank">http://rasbt . github . io/mlx tend/user _ guide/frequency _ patterns/association _ rules/</a></p><p id="5d44" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">[3]<a class="ae kl" href="https://github.com/datacamp/Market-Basket-Analysis-in-python-live-training" rel="noopener ugc nofollow" target="_blank">https://github . com/data camp/Market-Basket-Analysis-in-python-live-training</a></p><p id="2035" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">[4]<a class="ae kl" href="http://rasbt.github.io/mlxtend/user_guide/frequent_patterns/apriori/" rel="noopener ugc nofollow" target="_blank">http://rasbt . github . io/mlx tend/user _ guide/frequency _ patterns/apriori/</a></p><p id="6961" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">[5]<a class="ae kl" href="https://www.kaggle.com/cemhansenol98/python-apriori-rare-visualization" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/hero zerp/viz-rule-mining-for-杂货-数据集</a></p><p id="9af2" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">[6]<a class="ae kl" href="https://select-statistics.co.uk/blog/market-basket-analysis-understanding-customer-behaviour/" rel="noopener ugc nofollow" target="_blank">https://select-statistics . co . uk/blog/market-basket-analysis-understanding-customer-behavior/</a></p></div></div>    
</body>
</html>