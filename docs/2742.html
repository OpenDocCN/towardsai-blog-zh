<html>
<head>
<title>Build Your First Recommendation Engine</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">建立你的第一个推荐引擎</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/build-your-first-recommendation-engine-55a207a30380?source=collection_archive---------1-----------------------#2022-05-07">https://pub.towardsai.net/build-your-first-recommendation-engine-55a207a30380?source=collection_archive---------1-----------------------#2022-05-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="13a4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">有哪些不同类型的推荐算法？</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e0d859275f485dd34acc04c5728571a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*t2c1vGmmVOhr7BC3JfV6VQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">卡米洛·希门尼斯在<a class="ae ky" href="https://unsplash.com/s/photos/social-media?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><blockquote class="kz la lb"><p id="2b96" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">你有没有想过为什么社交媒体总是给你提供你想看的东西？</p><p id="cd68" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">你是否总是沉迷于社交媒体中的下一个视频/提要，并最终浏览数小时？</p></blockquote><p id="95ca" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">推荐引擎背后的逻辑肯定非常复杂。本文将向您介绍推荐引擎背后的逻辑要点。我们还将利用新加坡二手车市场数据，共同打造我们的第一个推荐引擎。</p><h1 id="e582" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">不同类型的推荐算法:</h1><ol class=""><li id="c2c0" class="mu mv it lf b lg mw lj mx lz my ma mz mb na ly nb nc nd ne bi translated"><strong class="lf iu">关联推荐:</strong>就像超市如何优化商品的位置。如果顾客购买牛奶，他/她将更有可能购买谷类食品，因此他们会将它们放在一起以促进两种商品的销售。如果我们能在数据的基础上找出关联，我们就能在高度关联的基础上提出建议。</li><li id="86ee" class="mu mv it lf b lg nf lj ng lz nh ma ni mb nj ly nb nc nd ne bi translated"><strong class="lf iu">按聚类组推荐:</strong>我们可以使用聚类技术对所有项目进行分组，并推荐同一聚类中的项目。</li><li id="0b3e" class="mu mv it lf b lg nf lj ng lz nh ma ni mb nj ly nb nc nd ne bi translated"><strong class="lf iu">基于分类模型的推荐:</strong>根据我们拥有的用户活动或可用数据，我们可以预测用户是否会喜欢/购买该商品。它需要我们有关于用户活动和他们购买什么项目的历史事实数据。</li></ol><blockquote class="kz la lb"><p id="63a7" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">下面的两个推荐算法将基于相似度。</p></blockquote><p id="9d88" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">4.<strong class="lf iu">基于内容的过滤:</strong>用户A喜欢过项目1，系统会向用户A推荐与项目1相似的项目，这里的重点是我们如何基于有限的数据定义相似度。我们用来计算相似性的特征应该是什么？</p><p id="bbf2" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">5.<strong class="lf iu">协同过滤:</strong>向用户推荐在人口统计学、品味或需求方面相似的项目。如果用户A是35岁左右的金融专业人士，则该引擎可以向用户A推荐其他35岁左右的金融专业人士喜欢什么。它不需要特定于项目的特征，但需要具有人口统计信息。</p><blockquote class="kz la lb"><p id="f774" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">请注意，推荐算法的选择没有对错之分，更多的<strong class="lf iu">取决于可用数据的类型</strong>。</p></blockquote><h1 id="0af4" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">sgCarMart案例研究</h1><p id="6a48" class="pw-post-body-paragraph lc ld it lf b lg mw ju li lj mx jx ll lz nk lo lp ma nl ls lt mb nm lw lx ly im bi translated">让我们基于基于内容的过滤，更具体地说，基于成对的项目相似性，一起构建推荐引擎。作为新加坡最大的网上二手车平台，sgCarMart data将会是我们案例中的例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nn"><img src="../Images/e6d6cc2300f7e2eacb773611d23ebed2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TrgKX0lF0SLQ0KQ2RQRsSw.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">Samuele Errico Piccarini 在<a class="ae ky" href="https://unsplash.com/s/photos/car?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="f0b6" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu">数据源:</strong>数据源可以是从sgcarmart.com刮来的web。你可以参考我之前的一篇关于如何使用Scrapy从sgCarMart中抓取数据的文章</p><div class="no np gp gr nq nr"><a rel="noopener  ugc nofollow" target="_blank" href="/web-scraping-in-scrapy-c2d87796f677"><div class="ns ab fo"><div class="nt ab nu cl cj nv"><h2 class="bd iu gy z fp nw fr fs nx fu fw is bi translated">Python中使用Scrapy的Web抓取分步指南</h2><div class="ny l"><h3 class="bd b gy z fp nw fr fs nx fu fw dk translated">如何检索新加坡的二手车信息</h3></div><div class="nz l"><p class="bd b dl z fp nw fr fs nx fu fw dk translated">pub.towardsai.net</p></div></div><div class="oa l"><div class="ob l oc od oe oa of ks nr"/></div></div></a></div><p id="b5cb" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu">目标:</strong>作为汽车平台，如果我们有用户入围的汽车名单，平台应该如何向用户推荐汽车。</p><p id="9fa4" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu">方法:</strong>我们将找到与用户入围的汽车相似的汽车，并根据相似性得分对它们进行排序。这里的相似度将基于不同汽车特征之间的<strong class="lf iu">余弦距离来计算。最终的输出是通过相似度的排名来推荐汽车的名单。</strong></p><p id="6231" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在这里，我们已经对数据集进行了一些数据清理，您可以看到下面的功能列表。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/8769c4b959b70d1376380d36823b9119.png" data-original-src="https://miro.medium.com/v2/resize:fit:956/format:webp/1*66NRB-z-GOX7vl6gNH61Bg.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片|推荐汽车功能列表</figcaption></figure><h2 id="7e20" class="oh md it bd me oi oj dn mi ok ol dp mm lz om on mo ma oo op mq mb oq or ms os bi translated">履行</h2><p id="3350" class="pw-post-body-paragraph lc ld it lf b lg mw ju li lj mx jx ll lz nk lo lp ma nl ls lt mb nm lw lx ly im bi translated"><strong class="lf iu">步骤1: </strong>将整个数据集分为数值和类别，并相应地填充缺失数据。在这种情况下，我将通过列的中值来填充缺失的数值数据，而通过‘NA’来填充分类数据。这里可能有其他可用的方法，如<strong class="lf iu">模式或简单地删除丢失的行</strong>。</p><pre class="kj kk kl km gt ot ou ov ow aw ox bi"><span id="94d1" class="oh md it ou b gy oy oz l pa pb">#fill categorical na value with string 'NA'<br/>df_cat= df.select_dtypes(include='object')<br/>df_cat=df_cat.fillna('NA')</span><span id="97c9" class="oh md it ou b gy pc oz l pa pb">#fill numerical missing value with median value<br/>numerics = ['int64', 'float64']<br/>df_num = df.select_dtypes(include=numerics)<br/>for num_var in df_num.columns:<br/>    df_num[num_var].fillna(df_num[num_var].median(),inplace=True)</span><span id="e315" class="oh md it ou b gy pc oz l pa pb">#combine sub-dataframes with each dtypes<br/>df_replace=pd.concat([df_cat,df_num],axis=1)</span></pre><p id="3d15" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu">第二步:</strong>我们将标准化数字特征。这是因为如果我们不这样做，<strong class="lf iu">那些具有较大数值的特征将支配最终结果</strong>，因为它们往往具有较大的变化。这里我简单地使用最大最小标准化。</p><pre class="kj kk kl km gt ot ou ov ow aw ox bi"><span id="6ce2" class="oh md it ou b gy oy oz l pa pb">scaler = MinMaxScaler()<br/>scaler.fit(df_num)<br/>converted_numerics=scaler.transform(df_num)</span></pre><p id="11a1" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">对于分类列，我们不能直接计算它们的余弦距离。我们有几个选择。我们可以对列进行编码，将它们转换成数字特征，或者进行一些自然语言处理，以获得一些特征。</p><p id="a7be" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在这种情况下，我将使用选项1，但是由于许多列都有自由文本，所以我们不能使用一次性编码。这里我们将使用BERT模型将文本特征转换成数字嵌入。BERT(来自变压器的双向编码器表示)模型是一种在大文本数据(如维基百科)上预训练的深度学习模型，嵌入结果可以更精确地表示文本信息。</p><blockquote class="kz la lb"><p id="7fff" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">关于bert模型在Python中的实现，可以参考<a class="ae ky" href="https://www.analyticsvidhya.com/blog/2019/09/demystifying-bert-groundbreaking-nlp-framework/" rel="noopener ugc nofollow" target="_blank">https://www . analyticsvidhya . com/blog/2019/09/demystifying-BERT-grounding-NLP-framework/</a>。</p></blockquote><pre class="kj kk kl km gt ot ou ov ow aw ox bi"><span id="3820" class="oh md it ou b gy oy oz l pa pb">#Select categorical features for recommendation<br/>df_bert=df_replace[['fuel_type','vehicle_type','transmission','features','accessories','description','title']]</span><span id="35f2" class="oh md it ou b gy pc oz l pa pb">#Calculate embedding file for the whole categorical features<br/>bc = BertClient()<br/>embeddings=[]<br/>for i in range(len(df_bert)):<br/>    embeddings.append(bc.encode(list(df_bert.iloc[i])))</span></pre><p id="eabc" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu">第4步:</strong>计算数字特征的余弦距离&amp;分类嵌入，并将它们聚集在一起</p><p id="f42a" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">接下来，我们将计算入围汽车与市场上所有其他汽车之间的余弦距离，分别用于数值和分类特征。之后，我们可以将两个分数加在一起。在我的例子中，我使用50%-50%的数字和分类特征输出，您可以根据场景确定权重，甚至使用动态权重。</p><pre class="kj kk kl km gt ot ou ov ow aw ox bi"><span id="65cb" class="oh md it ou b gy oy oz l pa pb">for i in range(len(source)):<br/>  similarity[i]=0<br/>  for car_index in short_listed:<br/>    if car_index==i:<br/>      pass<br/>    else:</span><span id="f94f" class="oh md it ou b gy pc oz l pa pb">      #compute cosine distance for numerical features      <br/>      num_dist=1-spatial.distance.cosine(converted_numerics.iloc[row_id], converted_numerics.iloc[i])<br/>      <br/>      # Calculate cosine distance for text features<br/>      embedding1 = embedding[car_index]<br/>      embedding2 = embedding[i]<br/>      num=len(embedding1)<br/>      total=0<br/>      for j in range(num):<br/>        dist = 1-spatial.distance.cosine(embedding1[j], embedding2[j])<br/>        total=total+dist<br/>        cat_dist=total/num</span><span id="9684" class="oh md it ou b gy pc oz l pa pb">        #Aggregate numerical and text feature by 50-50<br/>        final_dist=(num_dist+cat_dist)/2<br/>        similarity[i]=similarity[i]+final_dist</span></pre><p id="52df" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">从上面的代码中，我们可以根据不同的汽车特性，获得入围名单中的汽车列表与所有其他汽车之间的相似性得分。完事了吗？不，我们还需要扭转一下局面。</p><p id="823f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated"><strong class="lf iu">第五步:</strong>在最终排名分数中加入随机元素</p><p id="f962" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我们不希望每次用户登录平台时看到相同的汽车列表，因为大多数汽车功能都是相当稳定的。因此，我们可以在最终排名得分中输入一定比例的随机元素。</p><pre class="kj kk kl km gt ot ou ov ow aw ox bi"><span id="dfde" class="oh md it ou b gy oy oz l pa pb">#calculate ranking score based on 95% similarity and 5% random number<br/>        similarity[i]=similarity[i]/id_count*0.95+np.random.rand()*0.05</span></pre><p id="4624" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">在这里，我使用了95%的基于相似性的排名和5%的纯粹随机生成。可能需要一些尝试和错误来找到最佳的权重，并且它可能因不同的用户而异。例如，具有冒险性格的用户需要有更高权重的随机元素，因为他们更喜欢在每次登录时看到新车。</p><h2 id="8525" class="oh md it bd me oi oj dn mi ok ol dp mm lz om on mo ma oo op mq mb oq or ms os bi translated">决赛成绩</h2><p id="5840" class="pw-post-body-paragraph lc ld it lf b lg mw ju li lj mx jx ll lz nk lo lp ma nl ls lt mb nm lw lx ly im bi translated">现在我们已经完成了计算。让我们看看我们的推荐算法将如何执行。</p><p id="03dd" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">假设我们有一个富有的客户，他只入围了3辆劳斯莱斯汽车。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pd"><img src="../Images/948e901ee224b9b818c38f81bc547e42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tgffO2PaB7d5QgnWE9E7yQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片|用户入围车单</figcaption></figure><p id="d9eb" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">让我们看看推荐输出是什么</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi pe"><img src="../Images/73a1dafc2f9b4550ccf53c4e1c45a459.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*b6SMCe3txw7toL8b1YwNRg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者照片|推荐结果</figcaption></figure><p id="94de" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">我们可以看到，推荐结果只包含高端汽车，但并不局限于“劳斯莱斯”，而是在汽车品牌方面有很大的变化。</p><h1 id="045a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">结论和建议</h1><p id="a35f" class="pw-post-body-paragraph lc ld it lf b lg mw ju li lj mx jx ll lz nk lo lp ma nl ls lt mb nm lw lx ly im bi translated">这只是基于内容的过滤推荐的一个简单说明。像脸书或Tiktok这样的大平台会有一个更复杂的推荐引擎，有更多的数据点可用。例如，网站可以跟踪用户活动，并喜欢那些用户停留时间较长的项目。</p><p id="bac3" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">也可以有一个混合模型来组合基于内容的过滤和协作过滤。这意味着它不仅基于项目的相似性推荐项目，还基于相似的用户配置文件推荐项目。然而，它要求平台具有关于项目和用户的大型数据集。它可能不适用于小规模或新平台。</p><p id="909b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">最后，感谢我的朋友<a class="pf pg ep" href="https://medium.com/u/b9b791def441?source=post_page-----55a207a30380--------------------------------" rel="noopener" target="_blank"> Timothy Ye </a>对编码的帮助！</p><p id="3ae9" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll lz ln lo lp ma lr ls lt mb lv lw lx ly im bi translated">感谢阅读伙计们，并希望你有一个美好的一天！</p></div></div>    
</body>
</html>