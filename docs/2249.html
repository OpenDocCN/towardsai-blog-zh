<html>
<head>
<title>Portfolio Optimization in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的投资组合优化</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/portfolio-optimization-in-python-83fa20b02241?source=collection_archive---------0-----------------------#2021-10-14">https://pub.towardsai.net/portfolio-optimization-in-python-83fa20b02241?source=collection_archive---------0-----------------------#2021-10-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="8040" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/optimization" rel="noopener ugc nofollow" target="_blank">优化</a></h2><div class=""/><div class=""><h2 id="00f5" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">Python中投资组合优化的三种方法</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/1bc135bf0504cb1862153853abfdc612.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m3frCwv7_ML1yOy5Bh3XpA.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://www.pexels.com/@karolina-grabowska" rel="noopener ugc nofollow" target="_blank">卡罗琳娜·格拉博斯卡</a>在<a class="ae lh" href="https://www.pexels.com/photo/heap-of-different-nominal-per-dollars-4386442/" rel="noopener ugc nofollow" target="_blank">像素</a>上拍摄的照片</figcaption></figure><p id="0435" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在投资中，投资组合优化的任务是选择资产，使投资回报最大化，同时风险最小化。例如，投资者可能对从20只股票中选择5只股票感兴趣，以确保它们尽可能赚钱。应用于私募股权的投资组合优化方法也有助于管理和分散对私人公司的投资。最近，随着加密货币的兴起，投资组合优化技术已被应用于比特币和以太坊等投资。</p><p id="15d7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在每一种情况下，优化资产的任务都涉及到平衡风险和回报之间的权衡，其中股票的回报是一段时间后实现的利润，风险是资产价值的标准差。许多可用的投资组合优化方法本质上是投资中资产多样化方法的延伸。这里的想法是，拥有不同类型资产的投资组合比拥有相似资产的投资组合风险更低。</p><p id="5058" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">找到投资组合优化的正确方法是投资银行和资产管理公司工作的重要组成部分。早期的方法之一叫做均值-方差优化，是由Harry Markowitz开发的，因此也被称为Markowitz方法或HM方法。这种方法的原理是假设投资者厌恶风险。具体来说，它选择一组相关性最小(即彼此不同)且产生最高回报的资产。这种方法意味着，给定一组具有相同回报的投资组合，你将选择彼此之间具有最小统计关系的资产的投资组合。虽然这是现代投资组合理论中的一个基本方法，但它有许多局限性，如假设历史回报完全反映未来回报。</p><p id="7fdf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，你不应该选择科技公司股票的投资组合，而应该选择不同行业股票的投资组合。在实践中，均值-方差优化算法可能会选择包含技术、零售、医疗保健和房地产资产的投资组合，而不是像技术这样的单一行业。</p><p id="548a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">其他方法如分级风险平价(HRP)和平均条件风险值(mCVAR)解决了均值-方差优化方法的一些局限性。具体来说，HRP不需要对协方差矩阵求逆。协方差矩阵是股票收益如何同向移动的一种度量。均值-方差优化方法需要找到协方差矩阵的逆矩阵，这在计算上并不总是可行的。此外，mCVAR方法不做均值-方差优化所做的假设，这种假设在收益率呈正态分布时发生。由于mCVAR不假设正态分布的回报，它对均值-方差优化等极值不敏感。这意味着，如果一只股票的价格出现异常上涨，mCVAR将比均值-方差优化更稳健，更适合资产配置。相反，均值-方差优化可能会天真地建议我们不成比例地将大部分资源投资于价格异常上涨的资产。</p><p id="944d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Python包<a class="ae lh" href="https://pypi.org/project/pyportfolioopt/#an-overview-of-classical-portfolio-optimization-methods" rel="noopener ugc nofollow" target="_blank"> PyPortfolioOpt </a>提供了各种各样的特性，使得实现所有这些方法变得简单明了。</p><p id="2ed8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这里，我们将看看如何应用这些方法来构建跨行业的股票投资组合。</p><p id="f7b0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">访问股票价格数据</strong></p><p id="4897" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将使用Pandas-Datareader库提取股票价格数据。您可以在终端命令行中使用pip轻松安装该库:</p><p id="eb6c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">pip安装熊猫-datareader</p><p id="6875" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，让我们在新的Python脚本中导入数据读数:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="b42f" class="mj mk it mf b gy ml mm l mn mo">import pandas_datareader.data as web</span><span id="12a1" class="mj mk it mf b gy mp mm l mn mo">import datetime</span></pre><p id="3cc5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们应该从几个不同的行业中挑选股票，因此我们将收集医疗保健、科技、零售和金融方面的价格数据。我们将为每个行业挑选三只股票。</p><p id="07b5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们从医疗保健行业的几只股票开始。我们将调出Moderna、辉瑞和强生公司两年的股价数据。</p><p id="4c0d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，让我们导入熊猫并放宽行和列的显示限制:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="6c02" class="mj mk it mf b gy ml mm l mn mo">import pandas as pd</span><span id="4eb6" class="mj mk it mf b gy mp mm l mn mo">pd.set_option("display.max_columns", None)</span><span id="6dee" class="mj mk it mf b gy mp mm l mn mo">pd.set_option("display.max_rows", None)</span></pre><p id="a061" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，让我们导入datetime模块并定义开始和结束日期:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="3fb9" class="mj mk it mf b gy ml mm l mn mo">start = datetime.datetime(2019,9,15)</span><span id="f678" class="mj mk it mf b gy mp mm l mn mo">end = datetime.datetime(2021,9,15)</span></pre><p id="d095" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在我们有了拉低股价所需的一切。让我们得到现代基因(MRNA)的数据:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="c3fa" class="mj mk it mf b gy ml mm l mn mo">moderna = web.DataReader("MRNA","yahoo",start,end)</span><span id="35b1" class="mj mk it mf b gy mp mm l mn mo">print(moderna.head())</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mq"><img src="../Images/09cd80e1a2098baeec526dfac8d5f724.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-nJ7Ku0m46-XJwvk"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="fad2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们将这个逻辑封装在一个函数中，我们可以很容易地重用它，因为我们将提取几只股票:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="3134" class="mj mk it mf b gy ml mm l mn mo">def get_stock(ticker):</span><span id="c49c" class="mj mk it mf b gy mp mm l mn mo">    data = web.DataReader(f"{ticker}","yahoo",start,end)</span><span id="cf50" class="mj mk it mf b gy mp mm l mn mo">    data[f"{ticker}"] = data["Close"]</span><span id="d956" class="mj mk it mf b gy mp mm l mn mo">    data = data[[f"{ticker}"]]</span><span id="88dc" class="mj mk it mf b gy mp mm l mn mo">    print(data.head())</span><span id="f28c" class="mj mk it mf b gy mp mm l mn mo">    return data</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/ba58e953f2a6a3f40e0433eeeeea802b.png" data-original-src="https://miro.medium.com/v2/resize:fit:594/0*VD75RpvAxjmyMD6W"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="b743" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们支持辉瑞(PFE)和强生(JNJ):</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="982c" class="mj mk it mf b gy ml mm l mn mo">pfizer = get_stock("PFE")</span><span id="d837" class="mj mk it mf b gy mp mm l mn mo">jnj = get_stock("JNJ")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/90e902e30f45fd99b28ea4b6a0b1fe38.png" data-original-src="https://miro.medium.com/v2/resize:fit:618/0*jaQaJo8kxUCgGTYL"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="a666" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们定义另一个函数，它获取一个股票列表，并为每只股票生成一个股价数据框架:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="e98f" class="mj mk it mf b gy ml mm l mn mo">from functools import reduce</span><span id="4cb0" class="mj mk it mf b gy mp mm l mn mo">def combine_stocks(tickers):</span><span id="6e50" class="mj mk it mf b gy mp mm l mn mo">    data_frames = []</span><span id="3e9a" class="mj mk it mf b gy mp mm l mn mo">    for i in tickers:</span><span id="0eed" class="mj mk it mf b gy mp mm l mn mo">        data_frames.append(get_stock(i))</span><span id="1976" class="mj mk it mf b gy mp mm l mn mo">    df_merged = reduce(lambda left,right: pd.merge(left,right,on=["Date"], how="outer"), data_frames)</span><span id="978f" class="mj mk it mf b gy mp mm l mn mo">    print(df_merged.head())</span><span id="62be" class="mj mk it mf b gy mp mm l mn mo">    return df_merged</span><span id="5bf4" class="mj mk it mf b gy mp mm l mn mo">stocks = ["MRNA", "PFE", "JNJ"]</span><span id="770e" class="mj mk it mf b gy mp mm l mn mo">combine_returns(stocks)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mt"><img src="../Images/a34f087d24a9ebb64df203b1cee5d8df.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/0*YWJ7uJEyCqzPExc-"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="50a6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们来看看其余行业的股票:</p><ol class=""><li id="a278" class="mu mv it lk b ll lm lo lp lr mw lv mx lz my md mz na nb nc bi translated">医疗保健:现代制药(MRNA)，辉瑞制药(PFE)，强生公司(JNJ)</li><li id="9a73" class="mu mv it lk b ll nd lo ne lr nf lv ng lz nh md mz na nb nc bi translated">科技:谷歌(Google)，脸书(FB)，苹果(AAPL)</li><li id="c9ce" class="mu mv it lk b ll nd lo ne lr nf lv ng lz nh md mz na nb nc bi translated">零售:好市多(COST)，沃尔玛(WMT)，克罗格公司(KR)</li><li id="2f38" class="mu mv it lk b ll nd lo ne lr nf lv ng lz nh md mz na nb nc bi translated">金融:摩根大通(JPM)、美国银行(BAC)、汇丰控股(汇丰)</li></ol><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="b460" class="mj mk it mf b gy ml mm l mn mo">stocks = ["MRNA", "PFE", "JNJ", "GOOGL","FB", "AAPL", "COST", "WMT", "KR", "JPM","BAC", "HSBC"]</span><span id="ebca" class="mj mk it mf b gy mp mm l mn mo">portfolio = combine_stocks(stocks)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ni"><img src="../Images/f7ddb88e63b10f9c73c26457797c0187.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*HaxcROwhYgWnQIhK"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="d5fd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们现在有一个单一的股票回报数据框架。让我们将这个数据帧写入一个CSV文件，这样我们就可以轻松地读入数据，而不必重复地使用Pandas-DataReader来读取数据。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="ebc1" class="mj mk it mf b gy ml mm l mn mo">portfolio.to_csv("portfolio.csv", index=False)</span></pre><p id="5b82" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们阅读我们的csv:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="b760" class="mj mk it mf b gy ml mm l mn mo">portfolio = pd.read_csv("portfolio.csv")</span></pre><p id="ecc6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">均值-方差优化</strong></p><p id="39e1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在我们准备实施均值-方差优化方法来构建我们的投资组合。让我们从安装<a class="ae lh" href="https://pypi.org/project/pyportfolioopt/#an-overview-of-classical-portfolio-optimization-methods" rel="noopener ugc nofollow" target="_blank"> PyPortfolioOpt </a>库开始:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="5729" class="mj mk it mf b gy ml mm l mn mo">pip install PyPortfolioOpt</span></pre><p id="b8c0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们计算协方差矩阵，并将计算的回报分别存储在变量<em class="nj"> S </em>和<em class="nj"> mu </em>中:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="4ba1" class="mj mk it mf b gy ml mm l mn mo">from pypfopt.expected_returns import mean_historical_return</span><span id="24d7" class="mj mk it mf b gy mp mm l mn mo">from pypfopt.risk_models import CovarianceShrinkage</span><span id="92a7" class="mj mk it mf b gy mp mm l mn mo">mu = mean_historical_return(portfolio)</span><span id="2efc" class="mj mk it mf b gy mp mm l mn mo">S = CovarianceShrinkage(portfolio).ledoit_wolf()</span></pre><p id="3385" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，让我们导入EfficientFrontier模块并计算权重。这里，我们将使用最大夏普统计。夏普比率是收益和风险之间的比率。风险越低，回报越高，夏普比率就越高。该算法寻找最大夏普比率，该比率转化为具有最高回报和最低风险的投资组合。夏普比率越高，投资组合的表现越好。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="a71b" class="mj mk it mf b gy ml mm l mn mo">from pypfopt.efficient_frontier import EfficientFrontier</span><span id="ac45" class="mj mk it mf b gy mp mm l mn mo">ef = EfficientFrontier(mu, S)</span><span id="374c" class="mj mk it mf b gy mp mm l mn mo">weights = ef.max_sharpe()</span><span id="eb68" class="mj mk it mf b gy mp mm l mn mo">cleaned_weights = ef.clean_weights()</span><span id="8814" class="mj mk it mf b gy mp mm l mn mo">print(dict(cleaned_weights))</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nk"><img src="../Images/28534173b3574bb1a5ca78de787360fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Ei7aohGnauzJPYtY"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="473e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们还可以展示投资组合的表现:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="ba85" class="mj mk it mf b gy ml mm l mn mo">ef.portfolio_performance(verbose=True)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/e36b70008110e6d3f457aef5591e8b34.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/0*tcUN4_SeLVcEE3mK"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="3292" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，让我们将权重转换为实际分配值(即，每只股票的购买数量)。对于我们的分配，让我们考虑100，000美元的投资金额:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="2b29" class="mj mk it mf b gy ml mm l mn mo">from pypfopt.discrete_allocation import DiscreteAllocation, get_latest_prices</span><span id="e865" class="mj mk it mf b gy mp mm l mn mo">latest_prices = get_latest_prices(portfolio)</span><span id="2aac" class="mj mk it mf b gy mp mm l mn mo">da = DiscreteAllocation(weights, latest_prices, total_portfolio_value=100000)</span><span id="8248" class="mj mk it mf b gy mp mm l mn mo">allocation, leftover = da.greedy_portfolio()</span><span id="cc91" class="mj mk it mf b gy mp mm l mn mo">print("Discrete allocation:", allocation)</span><span id="c168" class="mj mk it mf b gy mp mm l mn mo">print("Funds remaining: ${:.2f}".format(leftover))</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nm"><img src="../Images/cb0fa11f77124aa31713e11e9470ca95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mbems2TyqycXQjTc"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="a0d0" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们的算法说我们应该投资112股MRNA，10股GOOGL，113股AAPL，114股KR。</p><p id="7973" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们看到我们的投资组合表现出225%的预期年回报率。这一业绩得益于疫情期间Moderna的快速增长。此外，夏普比率值5.02表明投资组合优化算法在我们的当前数据下表现良好。当然，这种回报被夸大了，而且在未来不太可能持续。</p><p id="a285" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">均值-方差优化的表现不是很好，因为它做出了许多简化的假设，例如收益是正态分布的，以及需要一个可逆的协方差矩阵。幸运的是，像HRP和mCVAR这样的方法解决了这些限制。</p><p id="825e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">分级风险平价(HRP) </strong></p><p id="04ca" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">HRP方法的工作原理是根据收益找到相似资产的子群，并从这些子群中构建一个层次结构，以生成每项资产的权重。</p><p id="a98e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们从从Pypfopt导入HRPOpt方法开始:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="e145" class="mj mk it mf b gy ml mm l mn mo">from pypfopt import HRPOpt</span></pre><p id="7162" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后我们需要计算回报:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="9caa" class="mj mk it mf b gy ml mm l mn mo">returns = portfolio.pct_change().dropna()</span></pre><p id="637b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">然后运行优化算法获得权重:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="b86a" class="mj mk it mf b gy ml mm l mn mo">hrp = HRPOpt(returns)</span><span id="e3a2" class="mj mk it mf b gy mp mm l mn mo">hrp_weights = hrp.optimize()</span></pre><p id="8003" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们现在可以打印投资组合的表现和权重:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="b6f4" class="mj mk it mf b gy ml mm l mn mo">hrp.portfolio_performance(verbose=True)</span><span id="4ddc" class="mj mk it mf b gy mp mm l mn mo">print(dict(hrp_weights))</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nn"><img src="../Images/7bfe4e4751bf01223f5b82ae5f95c198.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4k_7jfyPSAjq-4gG"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi no"><img src="../Images/4a0c9085b15e9f0cd13d703537b21094.png" data-original-src="https://miro.medium.com/v2/resize:fit:816/0*ZCxvByHIfUjRGsCM"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="78cf" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们看到，我们的预期年回报率为24.5%，远远低于我们通过均值-方差优化实现的225%的虚高回报率。我们还看到夏普比率降低到1.12。这更加合理，并且在未来更有可能成立，因为HRP对异常值不像均值-方差优化那样敏感。</p><p id="26d5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，让我们使用我们的权重来计算离散分配:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="c437" class="mj mk it mf b gy ml mm l mn mo">da_hrp = DiscreteAllocation(hrp_weights, latest_prices, total_portfolio_value=100000)</span><span id="8fb8" class="mj mk it mf b gy mp mm l mn mo">allocation, leftover = da_hrp.greedy_portfolio()</span><span id="f739" class="mj mk it mf b gy mp mm l mn mo">print("Discrete allocation (HRP):", allocation)</span><span id="f6bf" class="mj mk it mf b gy mp mm l mn mo">print("Funds remaining (HRP): ${:.2f}".format(leftover))</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi np"><img src="../Images/e5bbb7e60ad30bdb90c29c38c1b2cb04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*h6qeB5vOUW8gtGJX"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="93a8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们看到，我们的算法表明，我们大量投资克罗格(Kroger)、汇丰(HSBC)、强生(Johnson &amp; Johnson)和辉瑞(Pfizer)(PFE)，而不是像之前的模型那样，大量投资Moderna。此外，虽然性能有所下降，但我们可以更有信心地认为，当我们刷新数据时，该模型的性能会一样好。这是因为HRP对现代股票价格的异常上涨更为稳健。</p><p id="da6e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">平均条件风险值(mCVAR) </strong></p><p id="52ad" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">mCVAR是均值-方差优化的另一种流行替代方法。它通过衡量投资组合中每种资产的最坏情况来工作，在这里用损失最多的钱来表示。然后，每项资产的最坏情况损失用于计算每项资产分配的权重。</p><p id="5bb8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们导入EEfficicientCVAR方法:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="0b04" class="mj mk it mf b gy ml mm l mn mo">from pypfopt.efficient_frontier import EfficientCVaR</span></pre><p id="38cd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">计算重量并获得性能:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="be5f" class="mj mk it mf b gy ml mm l mn mo">S = portfolio.cov()</span><span id="d5fe" class="mj mk it mf b gy mp mm l mn mo">ef_cvar = EfficientCVaR(mu, S)</span><span id="49cf" class="mj mk it mf b gy mp mm l mn mo">cvar_weights = ef_cvar.min_cvar()</span><span id="53ac" class="mj mk it mf b gy mp mm l mn mo">cleaned_weights = ef_cvar.clean_weights()</span><span id="52bf" class="mj mk it mf b gy mp mm l mn mo">print(dict(cleaned_weights))</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nq"><img src="../Images/a3b262a23e5d12f290f0ee2fee6ce968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*aso1q2Jt12CYOwGY"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/f45f145b12f89d414ec7fc0b4c86a1d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1108/0*RClf9s2OC2Kojbyq"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="a961" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，获取离散分配:</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="497a" class="mj mk it mf b gy ml mm l mn mo">da_cvar = DiscreteAllocation(cvar_weights, latest_prices, total_portfolio_value=100000)</span><span id="5e2d" class="mj mk it mf b gy mp mm l mn mo">allocation, leftover = da_cvar.greedy_portfolio()</span><span id="4acb" class="mj mk it mf b gy mp mm l mn mo">print("Discrete allocation (CVAR):", allocation)</span><span id="b021" class="mj mk it mf b gy mp mm l mn mo">print("Funds remaining (CVAR): ${:.2f}".format(leftover))</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ns"><img src="../Images/3c505b7a47e76c23e34cb5ecbadd866a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*C6rds_6nJJPu5DfZ"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="5f01" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们看到，这种算法建议我们大举投资摩根大通(JP Morgan Chase，JPM ),同时买入Moderna和强生(Johnson &amp; Johnson，JNJ)的股票。此外，我们看到预期回报率为15.5%。这比均值-方差优化给出的夸大的225%回报率要合理得多，因为它对现代股票价格的异常行为不那么敏感。</p><p id="d936" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这篇文章的代码可以在<a class="ae lh" href="https://github.com/spierre91/builtiin/blob/main/portfolio_opt.py" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><p id="173c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">结论</strong></p><p id="1a15" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">虽然我们只考虑了医疗保健、技术、零售和金融，但我们讨论的方法可以很容易地修改，以考虑其他行业。例如，也许你对构建能源、房地产和材料行业的公司投资组合更感兴趣。这种投资组合的一个例子就是埃克森美孚(ExxonMobil)、杜邦(DuPont)和美国铁塔(American Tower)等股票。我鼓励你在构建投资组合时尝试不同的行业。</p><p id="3801" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们讨论的内容为那些对Python中的投资组合优化方法感兴趣的人提供了坚实的基础。了解投资组合优化的方法和工具可以让定量分析师和数据科学家更快地进行优化投资组合的实验。</p><p id="ea91" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果你有兴趣学习python编程的基础知识，使用Pandas进行数据操作，以及python中的机器学习，请查看<a class="ae lh" href="https://www.amazon.com/dp/B08N38XW2Q/ref=sr_1_1?dchild=1&amp;keywords=sadrach+python&amp;qid=1604966500&amp;s=books&amp;sr=1-1" rel="noopener ugc nofollow" target="_blank"><em class="nj">Python for Data Science and Machine Learning:Python编程，Pandas and Scikit-初学者学习教程</em> </a> <em class="nj">。我希望你觉得这篇文章有用/有趣。</em></p><p id="bcb8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> <em class="nj">本帖原载于</em> </strong> <a class="ae lh" href="https://builtin.com/data-science" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> <em class="nj">内置博客</em> </strong> </a> <strong class="lk jd"> <em class="nj">。原片可以在这里找到</em></strong><a class="ae lh" href="https://builtin.com/data-science/portfolio-optimization-python" rel="noopener ugc nofollow" target="_blank"><strong class="lk jd"><em class="nj"/></strong></a><strong class="lk jd"><em class="nj">。</em>T29】</strong></p></div></div>    
</body>
</html>