<html>
<head>
<title>Explore and Validate Datasets with TensorFlow Extended</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TensorFlow Extended探索和验证数据集</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/explore-and-validate-datasets-with-tensorflow-extended-fc52cc5e582?source=collection_archive---------1-----------------------#2022-06-11">https://pub.towardsai.net/explore-and-validate-datasets-with-tensorflow-extended-fc52cc5e582?source=collection_archive---------1-----------------------#2022-06-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="c8a7" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">通过实例介绍TensorFlow数据验证</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/cb936a05d5500560d96ad68f4b7475c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*puGfyNLfUY9C_2tvcn2SlA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。</figcaption></figure><h1 id="9ea7" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">目录</h1><ol class=""><li id="9515" class="lq lr it ls b lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated"><a class="ae mi" href="#a270" rel="noopener ugc nofollow">简介</a></li><li id="9b8f" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md me mf mg mh bi translated"><a class="ae mi" href="#81e3" rel="noopener ugc nofollow">观察描述性统计</a></li><li id="5fc8" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md me mf mg mh bi translated"><a class="ae mi" href="#552c" rel="noopener ugc nofollow">比较不同组的数据</a></li><li id="029b" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md me mf mg mh bi translated"><a class="ae mi" href="#b391" rel="noopener ugc nofollow">数据验证</a> <br/> 4.1 <a class="ae mi" href="#baed" rel="noopener ugc nofollow">推断并保存模式</a> <br/> 4.2 <a class="ae mi" href="#675d" rel="noopener ugc nofollow">使用模式进行数据验证</a></li><li id="637a" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md me mf mg mh bi translated"><a class="ae mi" href="#c161" rel="noopener ugc nofollow">监控偏斜和漂移</a> <br/> 5.1 <a class="ae mi" href="#bff5" rel="noopener ugc nofollow">连续变量</a> <br/> 5.2 <a class="ae mi" href="#a05b" rel="noopener ugc nofollow">分类变量</a></li><li id="b9b2" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md me mf mg mh bi translated"><a class="ae mi" href="#ec5f" rel="noopener ugc nofollow">结论</a></li><li id="e3fd" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md me mf mg mh bi translated"><a class="ae mi" href="#aa9d" rel="noopener ugc nofollow">参考文献</a></li></ol><h1 id="cffe" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">1.介绍</h1><p id="0419" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">数据质量是任何分析工作流程无可争议的基石。</p><p id="aa40" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">一旦投入生产，机器学习(ML)管道就需要自动分析、验证和跟踪数据变化的机制。</p><p id="3144" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><strong class="ls iu">TensorFlow Extended(TFX)</strong>是Google实现的基于tensor flow的ML平台。它提供了一系列组件来创建和维护完整的ML管道。每个组件也可以单独使用。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/57ba6e1fd04645fc97b6105c8b314b2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UcHCbfpttQBVAn1epYY4vg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">ML平台的高级组件。来自[1]。</figcaption></figure><p id="677c" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">在本文中，我们将使用<strong class="ls iu"> TensorFlow数据验证(TFDV) </strong>库。它是TFX的一部分，通过以下方式支持ML工程师:</p><ul class=""><li id="5371" class="lq lr it ls b lt nb lv nc lx nh lz ni mb nj md nk mf mg mh bi translated"><strong class="ls iu">实验过程中的数据探索</strong>和描述性统计。</li><li id="19f6" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nk mf mg mh bi translated"><strong class="ls iu">从给定数据集自动推断<strong class="ls iu">模式</strong>的</strong>。</li><li id="c4b3" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nk mf mg mh bi translated"><strong class="ls iu">针对生产模式的新数据的数据验证</strong>。</li><li id="c64c" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nk mf mg mh bi translated"><strong class="ls iu">监控</strong>新数据中的<strong class="ls iu">异常值和偏斜</strong>。</li></ul><p id="1201" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">我们将使用<em class="nl">加州房价</em>数据集，可以在Kaggle上免费获得(CCO⁴).它包含了从1990年人口普查中得出的加州各区房价中值。对于这个例子，我们将提供代码片段，这些代码片段可以很容易地在<strong class="ls iu">谷歌实验室</strong> ⁵.上复制和执行</p><p id="ab15" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">有可能在<code class="fe nm nn no np b">pip install tfx</code>前安装TFX。关于依赖性和兼容性的更多信息可以在官方的<em class="nl">⁶.用户指南</em>中找到</p><h1 id="81e3" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">2.观察描述性统计</h1><p id="c841" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">TFDV允许一个简单的，可视化的数据探索，可以支持早期的实验。</p><p id="de9f" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">我们可以通过调用<code class="fe nm nn no np b">generate_statistics_from_csv</code> ⁷.从CSV文件中生成描述性统计数据该方法返回一个<code class="fe nm nn no np b">DatasetFeatureStatisticsList</code>协议缓冲区，可以用<code class="fe nm nn no np b">visualize_statistics</code> ⁸:直观地浏览</p><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="4ca7" class="nu kz it np b gy nv nw l nx ny">import tensorflow_data_validation as tfdv</span><span id="01ac" class="nu kz it np b gy nz nw l nx ny">df_stats = tfdv.generate_statistics_from_csv('/content/housing.csv')<br/>tfdv.visualize_statistics(df_stats)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/8ed1ef21a1b811889bfee455738ff3f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aVkZp4VkpKSvs7qoW_aopw.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated"><code class="fe nm nn no np b">visualize_statistics. Image by author.</code>的输出</figcaption></figure><p id="e9c1" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">TFDV可以从不同的输入源生成统计数据:</p><ul class=""><li id="e0a0" class="lq lr it ls b lt nb lv nc lx nh lz ni mb nj md nk mf mg mh bi translated">CSV文件:<code class="fe nm nn no np b">generate_statistics_from_csv</code> ⁷.</li><li id="3fa7" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nk mf mg mh bi translated">熊猫数据帧:<code class="fe nm nn no np b">generate_statistics_from_dataframe</code> ⁹.</li><li id="6ac9" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nk mf mg mh bi translated">TFRecord文件:<code class="fe nm nn no np b">generate_statistics_from_tfrecord</code> ⁰.</li></ul><p id="9491" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><code class="fe nm nn no np b">visualize_statistics</code>函数利用<em class="nl">面</em>生成变量的动态可视化，包括以下信息:</p><ul class=""><li id="ab5f" class="lq lr it ls b lt nb lv nc lx nh lz ni mb nj md nk mf mg mh bi translated">连续特征:计数、缺失、平均值、标准差、零、最小值、中值、最大值。</li><li id="55f3" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nk mf mg mh bi translated">分类特征:计数、缺失、唯一值、上限值、上限值频率、平均字符串长度。</li></ul><p id="3c11" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">也可以过滤特定变量并展开它们的图表:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/189fb3124a5dfa4a013eb0961d95c6ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B9jWQNhK1Wx1gMldn-AkYA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">对具体特征的探索。图片由作者提供。</figcaption></figure><h1 id="552c" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">3.比较不同的数据集</h1><p id="1538" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">我们可以一次检查两个数据集的描述性信息，并一起可视化地研究它们。该过程需要生成两个数据集的统计数据，然后将它们传递给<code class="fe nm nn no np b">visualize_statistics</code>:</p><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="10b3" class="nu kz it np b gy nv nw l nx ny">import pandas as pd<br/>import numpy as np<br/>from tensorflow_data_validation.statistics import stats_options as options</span><span id="f3ff" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># load the data</strong><br/>housing = pd.read_csv('/content/housing.csv')</span><span id="a08f" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># for reproducibility</strong><br/>np.random.seed(42)</span><span id="7917" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># split randomly in train (50%) and test (50%) batches<br/></strong>test_indices = np.random.rand(len(housing)) &lt; 0.5<br/>train_batch = housing[~test_indices]<br/>test_batch = housing[test_indices]</span><span id="6527" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># generate train batch statistics<br/></strong>train_stats = tfdv.generate_statistics_from_dataframe(<br/>  train_batch,<br/>  stats_options = options.StatsOptions()<br/>  )</span><span id="9737" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># generate test batch statistics<br/></strong>test_stats = tfdv.generate_statistics_from_dataframe(<br/>  test_batch,<br/>  stats_options = options.StatsOptions()<br/>  )</span><span id="1f05" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># compare statistics<br/></strong>tfdv.visualize_statistics(<br/>  lhs_statistics = train_stats,<br/>  rhs_statistics = test_stats,<br/>  lhs_name = 'Train Batch',<br/>  rhs_name = 'Test Batch')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/d0bfc32d7b552c1642ac25c77d984821.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uRtC31keujCUsJ4cR9ziBQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">在同一个动态图表上训练和测试批次。图片作者。</figcaption></figure><p id="1d5d" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">我们可以进一步研究特定变量，并快速发现两组变量的差异:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/a0778bbf8f41db7e450260f78bfa8dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CzjonU9-F3x-7X7sUQ9KZA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。</figcaption></figure><p id="b8da" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">这一组能力使TFDV成为早期探索性分析的有用工具。</p><h1 id="b391" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">4.数据有效性</h1><p id="385b" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">TFDV可以从输入数据集中推断出模式。一旦模式被接受，我们就可以保存它以备将来在生产管道中使用。特别是，我们可以验证新数据并检查是否违反了模式约束。这有利于确保数据质量:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/8ef87fb7092b4ae4a0006aba0e7cd723.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wM_Iw6CTcdvrrPj3Yby6RQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">如何使用推断的模式来验证新到达的数据。图片来自<strong class="bd la"> TensorFlow博客</strong>。</figcaption></figure><h2 id="baed" class="nu kz it bd la oe of dn le og oh dp li lx oi oj lk lz ok ol lm mb om on lo oo bi translated">4.1推断并保存模式</h2><ul class=""><li id="9d01" class="lq lr it ls b lt lu lv lw lx ly lz ma mb mc md nk mf mg mh bi translated">使用<code class="fe nm nn no np b">infer_schema</code>推断并检查<strong class="ls iu">训练批次</strong>上的模式:</li></ul><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="80a8" class="nu kz it np b gy nv nw l nx ny">train_schema = tfdv.infer_schema(statistics = train_stats)<br/>tfdv.display_schema(schema = train_schema)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/f36c1115f2a3bfd2ccfd8b5eb9f18e7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1130/format:webp/1*rG3fUn7zw4os0cn1fmeM4g.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片作者。</figcaption></figure><ul class=""><li id="adda" class="lq lr it ls b lt nb lv nc lx nh lz ni mb nj md nk mf mg mh bi translated">将模式保存在本地以备将来使用:</li></ul><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="f8d2" class="nu kz it np b gy nv nw l nx ny">tfdv.write_schema_text(train_schema, 'schema.pbtxt')</span></pre><h2 id="675d" class="nu kz it bd la oe of dn le og oh dp li lx oi oj lk lz ok ol lm mb om on lo oo bi translated">4.2使用模式进行数据验证</h2><ul class=""><li id="9f2d" class="lq lr it ls b lt lu lv lw lx ly lz ma mb mc md nk mf mg mh bi translated">读取先前生成的模式:</li></ul><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="9951" class="nu kz it np b gy nv nw l nx ny">uploaded_schema = tfdv.load_schema_text('schema.pbtxt')</span></pre><ul class=""><li id="8639" class="lq lr it ls b lt nb lv nc lx nh lz ni mb nj md nk mf mg mh bi translated">用<code class="fe nm nn no np b">validate_statistics</code> ⁴:根据模式验证<strong class="ls iu">测试批次</strong></li></ul><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="452a" class="nu kz it np b gy nv nw l nx ny">eval_anomalies = tfdv.validate_statistics(<br/>  statistics = test_stats,<br/>  schema = uploaded_schema<br/>  )</span><span id="7bd2" class="nu kz it np b gy nz nw l nx ny">tfdv.display_anomalies(eval_anomalies)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/27635db12a8141bc30e24b8144bea2b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:524/format:webp/1*E-5krluyAJBOgOlVY4QQcw.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。</figcaption></figure><p id="89a2" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">验证会突出异常，例如分类特征中出现意外值。</p><p id="c9d6" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">我们也可以在验证期间放松模式约束。例如，对于给定的变量，通过强加一部分必须在模式约束下的观察值:</p><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="93ce" class="nu kz it np b gy nv nw l nx ny">ocean = tfdv.get_feature(<!-- -->uploaded_schema<!-- -->, '<!-- -->ocean_proximity<!-- -->')<br/>ocean.distribution_constraints.min_domain_mass = 0.9</span></pre><h1 id="c161" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">5.偏斜和漂移监控器</h1><p id="0635" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">TFDV支持识别数据中的<strong class="ls iu">偏斜</strong>和<strong class="ls iu">漂移</strong>。可以在模式中定义漂移或偏斜比较器，并在生产管道中使用它们进行验证。</p><h2 id="bff5" class="nu kz it bd la oe of dn le og oh dp li lx oi oj lk lz ok ol lm mb om on lo oo bi translated">5.1连续变量</h2><p id="e2fe" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">让我们考虑一个数字特征，比如<code class="fe nm nn no np b">population</code>，让我们为这个变量创建一个具有不同分布的新批次:</p><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="4bdd" class="nu kz it np b gy nv nw l nx ny">from matplotlib import pyplot as plt<br/>plt.style.use('ggplot')</span><span id="7cb3" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># create new batch and cause a drift in the population variable<br/></strong>new_batch = housing[test_indices].copy()<br/><strong class="np iu"># r(i) = r(i) + mean(ṟ) + noise<br/></strong>new_batch['population'] = \<br/>  new_batch['population'] + \<br/>  new_batch['population'].mean(axis=0) + \<br/>  np.random.normal(0, 100)</span><span id="b3b7" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># plot the population of training vs. new batch<br/></strong>bins = np.linspace(0, 15000, 1000)<br/>plt.figure(figsize = (12, 7))<br/>plt.hist(<br/>  train_batch['population'], <br/>  bins, <br/>  alpha = 0.5, <br/>  label = 'Train Batch Population'<br/>  )<br/>plt.hist(<br/>  new_batch['population'], <br/>  bins, <br/>  alpha = 0.5, <br/>  label = 'New Batch Population'<br/>  )<br/>plt.legend(loc = 'upper right')<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/1492b7621fb36fa60fbcbebdc1758be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HoLWSmXTipNKeQ_tfKqjTA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">列车批次和新到达数据中总体变量的分布。图片作者。</figcaption></figure><p id="54ab" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">为了监控新到达数据中的这种异常，我们必须:</p><ul class=""><li id="d6e0" class="lq lr it ls b lt nb lv nc lx nh lz ni mb nj md nk mf mg mh bi translated">用<code class="fe nm nn no np b">generate_statistics_from_&lt;...&gt;</code>生成新批次的统计数据。</li><li id="9851" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nk mf mg mh bi translated">创建一个<strong class="ls iu">比较器</strong>。当我们寻找特征分布的变化时，我们定义了一个<code class="fe nm nn no np b">drift_comparator</code>。</li><li id="a725" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nk mf mg mh bi translated">在<strong class="ls iu">数字</strong>特征的情况下，我们指定一个<code class="fe nm nn no np b">jensen_shannon_divergence</code> ⁵阈值。</li><li id="3502" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nk mf mg mh bi translated">使用<code class="fe nm nn no np b">validate_statistics</code>将统计数据与模式进行比较。</li></ul><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="25ed" class="nu kz it np b gy nv nw l nx ny"><strong class="np iu"># generate new batch statistics</strong><br/>new_stats = tfdv.generate_statistics_from_dataframe(<br/>  new_batch,<br/>  stats_options = options.StatsOptions()<br/>  )</span><span id="03c5" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># Set a threshold for monitoring anomalies in 'population'<br/></strong>pop = tfdv.get_feature(uploaded_schema, 'population')<br/>pop.drift_comparator.jensen_shannon_divergence.threshold = 0.01</span><span id="0ba3" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># check for anomalies in the new batch</strong><br/>new_anomalies = tfdv.validate_statistics(<br/>  statistics = new_stats,<br/>  schema = uploaded_schema,<br/>  previous_statistics = train_stats<br/>  )</span><span id="07dc" class="nu kz it np b gy nz nw l nx ny">tfdv.display_anomalies(new_anomalies)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi os"><img src="../Images/242198b099591a7d90d69f8e7ee8e0a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UHDeVZX4pDeG-Kah1ycDIg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。</figcaption></figure><p id="7166" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">我们获得了详细的描述，可以很容易地支持异常的清晰识别。</p><h2 id="a05b" class="nu kz it bd la oe of dn le og oh dp li lx oi oj lk lz ok ol lm mb om on lo oo bi translated">5.2分类变量</h2><p id="2167" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">让我们考虑一个分类变量<code class="fe nm nn no np b">ocean_proximity</code>，表示房子离海洋有多远。让我们添加一个新值<code class="fe nm nn no np b">&gt;1 DAY</code>，并为其分配30%的观察值:</p><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="8560" class="nu kz it np b gy nv nw l nx ny"><strong class="np iu"># create new value '&gt;1 DAY' for 'ocean_proximity</strong><br/>idx = np.random.rand(len(new_batch)) &lt; 0.3<br/>new_batch.loc[idx, "ocean_proximity"] = '&gt;1 DAY'</span><span id="4bf1" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># plot the differences<br/></strong>fig, ax = plt.subplots(1, 2)<br/>train_batch['ocean_proximity'] \<br/>  .value_counts(normalize = True) \<br/>  .plot(kind = 'bar', ax = ax[0], color = 'salmon') \<br/>  .set_title('Train Batch')<br/>new_batch['ocean_proximity'] \<br/>  .value_counts(normalize = True) \<br/>  .plot(kind = 'bar', ax = ax[1], color = 'c') \<br/>  .set_title('New Batch')<br/>fig.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/edff951cb3ec491c94ecf45bc2435836.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*ZX9H78iy_k0_mNCDMXuNZA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。</figcaption></figure><p id="b37b" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">我们可以像监视数值变量一样监视这些变化，但是使用不同的阈值类型:</p><ul class=""><li id="3fa2" class="lq lr it ls b lt nb lv nc lx nh lz ni mb nj md nk mf mg mh bi translated">用<code class="fe nm nn no np b">generate_statistics_from_&lt;...&gt;</code>生成新批次的统计数据。</li><li id="109b" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nk mf mg mh bi translated">创建一个<strong class="ls iu">比较器</strong>:在<strong class="ls iu">分类</strong>特征的情况下，我们指定一个<code class="fe nm nn no np b">infinity_norm</code>(l-无穷范数⁵)阈值。</li><li id="6e18" class="lq lr it ls b lt mj lv mk lx ml lz mm mb mn md nk mf mg mh bi translated">用<code class="fe nm nn no np b">validate_statistics</code>将统计数据与模式进行比较。</li></ul><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="92a0" class="nu kz it np b gy nv nw l nx ny"><strong class="np iu"># generate new batch statistics<br/></strong>new_stats = tfdv.generate_statistics_from_dataframe(<br/>  new_batch,<br/>  stats_options = options.StatsOptions()<br/>  )</span><span id="dcd5" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># set a threshold for monitoring anomalies in 'ocean proximity'<br/></strong>prox = tfdv.get_feature(uploaded_schema, 'ocean_proximity')<br/>prox.drift_comparator.infinity_norm.threshold = 0.01</span><span id="3f4a" class="nu kz it np b gy nz nw l nx ny"><strong class="np iu"># Check for anomalies in the new batch<br/></strong>new_anomalies = tfdv.validate_statistics(<br/>  statistics = new_stats,<br/>  schema = uploaded_schema,<br/>  previous_statistics = train_stats<br/>  )</span><span id="12eb" class="nu kz it np b gy nz nw l nx ny">tfdv.display_anomalies(new_anomalies)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ou"><img src="../Images/348a3cf0ed7fc91dfc0c2125c5bff12f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tUtNghUVq_tA1NyIAW7NVg.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片由作者提供。</figcaption></figure><p id="8963" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">我们被告知对<code class="fe nm nn no np b">ocean_proximity</code>功能检测到多个错误。首先，模式中缺少一个新值(<code class="fe nm nn no np b">&gt;1 DAY</code>)。然后，变量分布发生了变化。</p><p id="912c" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">模式不一定是固定的实体。它可以随着时间的推移进行调整，例如，通过添加新值:</p><pre class="kj kk kl km gt nq np nr ns aw nt bi"><span id="f03d" class="nu kz it np b gy nv nw l nx ny">tfdv.get_domain(uploaded_schema, 'ocean_proximity').value.append(<br/>  '&gt;1 DAY')</span></pre><h1 id="ec5f" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">6.结论</h1><p id="c5b8" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">生产中的机器学习管道需要验证新到达的数据，并确保数据质量和持续监控。</p><p id="628c" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">在这篇文章中，我们探讨了<strong class="ls iu"> TensorFlow数据验证(TFDV) </strong>作为一种有效而简单的数据探索、验证和监控工具。</p><p id="e548" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">⁷官方文件提供了进一步的信息和样本笔记本。</p><h1 id="aa9d" class="ky kz it bd la lb lc ld le lf lg lh li jz lj ka lk kc ll kd lm kf ln kg lo lp bi translated">7.参考</h1><p id="5f28" class="pw-post-body-paragraph mo mp it ls b lt lu ju mq lv lw jx mr lx ms mt mu lz mv mw mx mb my mz na md im bi translated">[1]贝勒、布雷克、程、菲德尔、福、哈克、海卡尔、伊斯皮尔、贾恩、科科、辜、卢、梅瓦尔德、莫迪、波利佐蒂斯、拉梅什、罗伊、黄、维克、威尔凯维奇、张、津克维奇、(<a class="ae mi" href="http://doi.acm.org/10.1145/3097983.3098021" rel="noopener ugc nofollow" target="_blank">链接</a> <a class="ae mi" href="http://doi.acm.org/10.1145/3097983.3098021)" rel="noopener ugc nofollow" target="_blank"> ) </a></p><p id="bda7" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">[2] E. Breck，N. Polyzotis，S. Roy，S. E. Whang，M. Zinkevich，<em class="nl">机器学习的数据验证</em>，第二届SysML会议论文集，美国加州帕洛阿尔托，2019 ( <a class="ae mi" href="https://mlsys.org/Conferences/2019/doc/2019/167.pdf" rel="noopener ugc nofollow" target="_blank">链接</a>)。</p><p id="ebdf" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">[3]<a class="ae mi" href="https://www.kaggle.com/datasets/camnugent/california-housing-prices" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/datasets/camnugent/California-housing-prices</a></p><p id="bd56" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><a class="ae mi" href="https://creativecommons.org/publicdomain/zero/1.0/" rel="noopener ugc nofollow" target="_blank">https://creativecommons.org/publicdomain/zero/1.0/</a></p><p id="8e2f" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><a class="ae mi" href="https://research.google.com/colaboratory/" rel="noopener ugc nofollow" target="_blank">https://research.google.com/colaboratory/</a></p><p id="8091" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><a class="ae mi" href="https://www.tensorflow.org/tfx/guide" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/tfx/guide</a></p><p id="84ae" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">[7]<a class="ae mi" href="https://www.tensorflow.org/tfx/data_validation/api_docs/python/tfdv/generate_statistics_from_csv" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/tfx/data _ validation/API _ docs/python/tfdv/generate _ statistics _ from _ CSV</a></p><p id="15f4" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">[8]<a class="ae mi" href="https://www.tensorflow.org/tfx/data_validation/api_docs/python/tfdv/visualize_statistics" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/tfx/data _ validation/API _ docs/python/tfdv/visualize _ statistics</a></p><p id="3df6" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">[9]<a class="ae mi" href="https://www.tensorflow.org/tfx/data_validation/api_docs/python/tfdv/generate_statistics_from_dataframe" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/tfx/data _ validation/API _ docs/python/tfdv/generate _ statistics _ from _ data frame</a></p><p id="afe3" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">[10]<a class="ae mi" href="https://www.tensorflow.org/tfx/data_validation/api_docs/python/tfdv/generate_statistics_from_tfrecord" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/tfx/data _ validation/API _ docs/python/tfdv/generate _ statistics _ from _ TF record</a></p><p id="9cdd" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><a class="ae mi" href="https://pair-code.github.io/facets/" rel="noopener ugc nofollow" target="_blank">https://pair-code.github.io/facets/</a></p><p id="de7c" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">[12]<a class="ae mi" href="https://blog.tensorflow.org/2018/09/introducing-tensorflow-data-validation.html" rel="noopener ugc nofollow" target="_blank">https://blog . tensor flow . org/2018/09/introducing-tensor flow-data-validation . html</a></p><p id="a07c" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">[13]<a class="ae mi" href="https://www.tensorflow.org/tfx/data_validation/api_docs/python/tfdv/infer_schema" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/tfx/data _ validation/API _ docs/python/tfdv/infer _ schema</a></p><p id="912b" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">[14]<a class="ae mi" href="https://www.tensorflow.org/tfx/data_validation/api_docs/python/tfdv/validate_statistics" rel="noopener ugc nofollow" target="_blank">https://www . tensor flow . org/tfx/data _ validation/API _ docs/python/tfdv/validate _ statistics</a></p><p id="8741" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated">[15]<a class="ae mi" href="https://en.wikipedia.org/wiki/Jensen%E2%80%93Shannon_divergence" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Jensen-Shannon_divergence</a></p><p id="5429" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><a class="ae mi" href="https://en.wikipedia.org/wiki/Chebyshev_distance" rel="noopener ugc nofollow" target="_blank">https://en.wikipedia.org/wiki/Chebyshev_distance</a></p><p id="af08" class="pw-post-body-paragraph mo mp it ls b lt nb ju mq lv nc jx mr lx nd mt mu lz ne mw mx mb nf mz na md im bi translated"><a class="ae mi" href="https://www.tensorflow.org/tfx/data_validation/get_started" rel="noopener ugc nofollow" target="_blank">https://www.tensorflow.org/tfx/data_validation/get_started</a></p></div></div>    
</body>
</html>