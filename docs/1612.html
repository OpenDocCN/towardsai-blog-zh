<html>
<head>
<title>Practical Guide: Build and Deploy a Machine Learning Web App</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">实践指南:构建和部署机器学习Web应用程序</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/practical-guide-build-and-deploy-a-machine-learning-web-app-c6760f877fb?source=collection_archive---------3-----------------------#2021-03-04">https://pub.towardsai.net/practical-guide-build-and-deploy-a-machine-learning-web-app-c6760f877fb?source=collection_archive---------3-----------------------#2021-03-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="2ebc" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a>，<a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><figure class="gl gn ka kb kc kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi jz"><img src="../Images/4146d6f7e29eaa57121377f9da43e4e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EfDOwclFNu6IY-KgyvKuKQ.jpeg"/></div></div></figure><p id="ce44" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">这是一个机器学习项目的简单管道的指南。在本课程中，我们的目标是创建一个web应用程序，该应用程序将花的属性(萼片长度/宽度和花瓣长度/宽度)的CSV文件作为输入，并返回一个带有预测值(Setosa Versicolour Virginica)的CSV文件。你可能已经知道，我们将使用传说中的虹膜数据集</p><h1 id="8193" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">1.创建新环境并安装依赖项</h1><p id="f426" class="pw-post-body-paragraph kk kl it km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh im bi translated">我知道你想跳过这一步，但是不要。这将组织你的包，你将确切地知道你需要哪些包来运行你的代码，以防我们想和其他人分享它。相信我，这很重要。你不希望你的客户告诉你“这不是运行”。同样，在一个环境中拥有我们的项目将会帮助我们很容易地创建我们以后需要的需求文件。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="6de9" class="mu lj it mq b gy mv mw l mx my">conda create -n iris_project<br/><br/>#activate your project<br/>conda activate  iris_project</span></pre><h1 id="27c8" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">安装依赖项</h1><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="fabd" class="mu lj it mq b gy mv mw l mx my">pip install pandas<br/>pip install -U scikit-learn<br/>pip install Flask<br/>pip install gunicorn</span></pre><blockquote class="mz na nb"><p id="98ca" class="kk kl nc km b kn ko kp kq kr ks kt ku nd kw kx ky ne la lb lc nf le lf lg lh im bi translated"><em class="it"> Hack:如果你正在使用Jupyter，你可以通过添加</em> <strong class="km jd"> <em class="it">'！'来直接安装库</em> </strong> <em class="it">在Jupyter单元格内的每个命令之前。</em></p></blockquote><h1 id="045c" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">2.训练并保存您的ML模型</h1><p id="54e3" class="pw-post-body-paragraph kk kl it km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh im bi translated">现在有趣的事情。使用pickle创建您的模型并将其保存在一个文件中。在这篇文章中，我们将使用Iris数据集创建一个逻辑回归模型。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="2dfd" class="mu lj it mq b gy mv mw l mx my">from sklearn import datasets<br/>from sklearn.linear_model import LogisticRegression<br/>import pandas as pd<br/>iris = datasets.load_iris()<br/><br/>features=pd.DataFrame(iris['data'])<br/><br/>target=iris['target']<br/><br/>model=LogisticRegression(max_iter=1000)<br/><br/>model.fit(features,target)</span></pre><h2 id="08fa" class="mu lj it bd lk ng nh dn lo ni nj dp ls kv nk nl lw kz nm nn ma ld no np me iz bi translated">使用Pickle保存模型</h2><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="c874" class="mu lj it mq b gy mv mw l mx my">import pickle<br/><br/>pickle.dump(model, open('model_iris', 'wb'))</span></pre><h1 id="b687" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">3.使用Flask创建web应用程序</h1><p id="8635" class="pw-post-body-paragraph kk kl it km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh im bi translated">作为一名数据科学家，烧瓶是最有用的技能之一。然而，你不需要知道关于它的一切。只需使用代码块作为项目的模型。</p><p id="754a" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">让我们做一些准备。在您的项目目录下创建一个名为<strong class="km jd"> templates </strong>的文件夹和一个名为<strong class="km jd"> static </strong>的文件夹。在<strong class="km jd">静态</strong>文件夹中创建一个名为<strong class="km jd"> files </strong>的文件夹。接下来，创建两个<strong class="km jd">。py </strong>文件、<strong class="km jd"> main.py、</strong>和<strong class="km jd"> iris_model.py </strong>。在<strong class="km jd"> main.py </strong>中将是我们的flask代码，在<strong class="km jd"> iris_model.py </strong>中将是我们的模型。</p><p id="6b14" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">你可以以此为模板，根据自己的需要稍加修改。这是我个人的工作方式。</p><h1 id="d96c" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">main.py</h1><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="874e" class="mu lj it mq b gy mv mw l mx my">from flask import Flask, render_template, request, redirect, url_for, send_file<br/>import os<br/><br/>#we are importing the function that makes predictions.<br/>from iris_model import predict_iris<br/><br/>import pandas as pd<br/><br/>app = Flask(__name__)<br/>app.config["DEBUG"] = True<br/><br/><br/>#we are setting the name of our html file that we added in the templates folder<br/>@app.route('/')<br/>def index():<br/>    return render_template('index.html')<br/><br/>#this is how we are getting the file that the user uploads. <br/>#then we are setting the path that we want to save it so we can use it later for predictions<br/>@app.route("/", methods=['POST'])<br/>def uploadFiles():<br/>    uploaded_file = request.files['file']<br/>    <br/>    if uploaded_file.filename != '':<br/>        file_path = ( "static/files/file.csv")<br/>        uploaded_file.save(file_path)<br/>    return redirect(url_for('downloadFile'))<br/><br/>#now we are reading the file, make predictions with our model and save the predictions.<br/>#then we are sending the CSV with the predictions to the user as attachement <br/>@app.route('/download')<br/>def downloadFile ():<br/>    path = "static/files/file.csv"<br/>    predictions=predict_iris(pd.read_csv(path))<br/>    predictions.to_csv('static/files/predictions.csv',index=False)<br/>    return send_file("static/files/predictions.csv", as_attachment=True)<br/><br/>#here we are setting the port. <br/>if (__name__ == "__main__"):<br/>     app.run(debug=True,host='0.0.0.0', port=9010)</span></pre><p id="fdd0" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在这个文件中，我们有一个函数，它将带有特征的数据帧作为输入，并输出预测。</p><h1 id="ff14" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">iris _模型. py</h1><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="ebf4" class="mu lj it mq b gy mv mw l mx my">from sklearn.linear_model import LogisticRegression<br/>import pandas as pd<br/>import pickle<br/><br/>#we are loading the model using pickle<br/>model = pickle.load(open('model_iris', 'rb'))<br/><br/>def predict_iris(df):<br/>    predictions=model.predict(df)<br/>    df['predictions']=predictions<br/>    return(df)</span></pre><p id="d55e" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在模板中，文件夹创建了一个index.html文件，其中包含以下代码。同样，不需要理解HTML中的所有内容，你可以改变标题，或者如果你熟悉HTML，你可以做更多的实验。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="2e08" class="mu lj it mq b gy mv mw l mx my">&lt;!doctype html&gt;<br/>&lt;html&gt;<br/>  &lt;head&gt;<br/>    &lt;title&gt;Iris Prediction&lt;/title&gt;<br/>  &lt;/head&gt;<br/>  &lt;body&gt;<br/>    &lt;h1&gt;Upload your CSV file&lt;/h1&gt;<br/>    &lt;form method="POST" action="" enctype="multipart/form-data"&gt;<br/>      &lt;p&gt;&lt;input type="file" name="file"&gt;&lt;/p&gt;<br/>      &lt;p&gt;&lt;input type="submit" value="Submit"&gt;&lt;/p&gt;<br/>    &lt;/form&gt;<br/>  &lt;/body&gt;<br/>&lt;/html&gt;</span></pre><h1 id="4a09" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">在本地运行Web应用程序</h1><p id="4d5f" class="pw-post-body-paragraph kk kl it km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh im bi translated">现在，如果你在你的终端上运行<strong class="km jd"> main.py </strong>，这个应用程序应该会启动。在您的浏览器中点击<a class="ae nq" href="http://0.0.0.0:9010/" rel="noopener ugc nofollow" target="_blank"> http://0.0.0.0:9010/ </a>，您将可以访问我们的应用程序。</p><p id="a4c6" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">这是一个非常简单的用户界面，但我们不需要任何花哨的东西。如果你上传一个具有iris特征的样本文件，你将得到预测。</p><figure class="ml mm mn mo gt kd gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/9cc076b93371841fb62104d7efae16de.png" data-original-src="https://miro.medium.com/v2/resize:fit:1042/0*KEL7J---Mt2MEr6k.gif"/></div></figure><figure class="ml mm mn mo gt kd gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/3556e54a06dd71c959ecf0842dd230d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/0*qkwg9os8RCK1wCbB.png"/></div></figure><p id="e503" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们的web应用程序已经准备好了！现在我们需要以某种方式部署它，这样我们就可以与世界分享它。我们将向你展示如何使用<a class="ae nq" href="https://dashboard.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>免费完成。</p><h1 id="f505" class="li lj it bd lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf bi translated">最后一步:部署Web应用程序</h1><p id="1be2" class="pw-post-body-paragraph kk kl it km b kn mg kp kq kr mh kt ku kv mi kx ky kz mj lb lc ld mk lf lg lh im bi translated">我们大多数人不知道如何从本地转移到现场，部署这个词可能会让我们害怕。这复杂吗？这个贵吗？嗯，不是也不是。我们将免费向你展示如何非常容易地做到这一点！有一个叫Heroku的网站为你提供5个免费的web应用部署。如果你想要一个更简单的付费解决方案，你可以使用数字海洋遵循<a class="ae nq" href="https://predictivehacks.com/how-to-deploy-a-flask-api-the-easiest-fastest-and-cheapest-way/" rel="noopener ugc nofollow" target="_blank">这个指南。</a></p><p id="260e" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在我们继续之前，您需要在<a class="ae nq" href="https://dashboard.heroku.com/" rel="noopener ugc nofollow" target="_blank"> Heroku </a>创建一个帐户，并按照他们的说明将<a class="ae nq" href="https://devcenter.heroku.com/articles/getting-started-with-python#set-up" rel="noopener ugc nofollow" target="_blank"> Heroku CLI </a>安装到您的机器上。另外，确保您已经安装了<a class="ae nq" href="https://git-scm.com/book/en/v2/Getting-Started-Installing-Git" rel="noopener ugc nofollow" target="_blank"> Git </a>。</p><p id="9c43" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在部署我们的应用程序之前，一个关键的步骤是创建包含我们的应用程序的依赖关系的<strong class="km jd"> requirements.txt </strong>文件。幸运的是，使用Conda环境，这很容易做到。只需运行以下命令:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="9b00" class="mu lj it mq b gy mv mw l mx my">pip freeze &gt; requirements.txt</span></pre><p id="2482" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">此外，我们需要创建一个名为<strong class="km jd"> Procfile </strong>的新文件，其中包含启动应用程序的命令。在我们的例子中，我们将使用gunicorn，因此在文件中添加以下内容</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="62b8" class="mu lj it mq b gy mv mw l mx my">web: gunicorn main:app</span></pre><p id="cca7" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">接下来，转到Heroku中的仪表板，创建一个新的应用程序。下面的屏幕将出现，你必须把应用程序的名称和地区。</p><figure class="ml mm mn mo gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nt"><img src="../Images/e8e68aae6a3da798852d0cf165f33c78.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*7Ov5W55ocf7IxbUn.png"/></div></div></figure><p id="1035" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">创建应用程序后，在您的终端上运行以下命令来登录Heroku。</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="e6a0" class="mu lj it mq b gy mv mw l mx my">heroku login</span></pre><p id="1e68" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">然后，转到您的项目目录并运行:</p><pre class="ml mm mn mo gt mp mq mr ms aw mt bi"><span id="5d5a" class="mu lj it mq b gy mv mw l mx my">git init<br/><br/>#here you need to put the name of your app in heroku<br/>heroku git:remote -a iris-project-predictive-hacks <br/><br/>git add .<br/>git commit -m first_commit<br/>git push heroku master</span></pre><p id="d284" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">就是这样！你的应用程序已准备好。它会给你一个这样的网址<a class="ae nq" href="https://iris-project-predictive-hacks.herokuapp.com/." rel="noopener ugc nofollow" target="_blank">https://iris-project-predictive-hacks.herokuapp.com/.</a>还不错吧？</p><p id="c066" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">这是一个非常简单的方法。然而，你甚至可以将这个应用程序交付给客户，因为它非常实用，你不需要比这更复杂的东西。下一步是使用e better服务器来扩展我们的应用程序，或者/甚至使用<a class="ae nq" href="https://predictivehacks.com/how-to-use-docker-for-flask-api/" rel="noopener ugc nofollow" target="_blank"> Docker </a>。</p></div><div class="ab cl nu nv hx nw" role="separator"><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz oa"/><span class="nx bw bk ny nz"/></div><div class="im in io ip iq"><p id="c690" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">【https://predictivehacks.com】最初发表于<a class="ae nq" href="https://predictivehacks.com/practical-guide-build-and-deploy-a-machine-learning-web-app/" rel="noopener ugc nofollow" target="_blank"><em class="nc"/></a><em class="nc">。</em></p></div></div>    
</body>
</html>