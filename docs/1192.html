<html>
<head>
<title>Finding Common Ground: US Presidents State Analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">寻找共同点:美国总统的国家分析</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/finding-common-ground-us-presidents-state-analysis-cdd20cc22086?source=collection_archive---------5-----------------------#2020-11-28">https://pub.towardsai.net/finding-common-ground-us-presidents-state-analysis-cdd20cc22086?source=collection_archive---------5-----------------------#2020-11-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="832a" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-science" rel="noopener ugc nofollow" target="_blank">数据科学</a>，<a class="ae ep" href="https://towardsai.net/p/category/data-visualization" rel="noopener ugc nofollow" target="_blank">数据可视化</a></h2><div class=""/><div class=""><h2 id="1489" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">寻找共同点:美国总统的国家分析</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/341f5d4d146576df782ee7e8b89e3d04.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*JHqY149F8Io85nbH"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">【https://unsplash.com/photos/zfKlCKK-Ql0 T4】</figcaption></figure><h1 id="185b" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">介绍</h1><p id="2d42" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi mt translated">我们的目标是找出一位美国总统和他所在州与其他总统之间的任何关联。我们使用来自不同来源的数据来形成一个数据集，该数据集包括不同的美国总统及其所在的州，以及关于该州的其他事实。我们从多个来源提取数据，并将其组合成一个全面的数据集。我们还会找到最常见的州，并最终将结果绘制在实时交互式地图上。</p><h1 id="68e5" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">要求</h1><ul class=""><li id="5213" class="nc nd iq lz b ma mb md me mg ne mk nf mo ng ms nh ni nj nk bi translated">Python 3.8</li><li id="e04b" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">熊猫</li><li id="1d78" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">NumPy</li><li id="0f70" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">薄层</li><li id="1d64" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">海生的</li></ul><h1 id="a372" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">数据准备和预处理</h1><p id="fc8f" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">我们首先准备数据，梳理来自不同来源的数据集，并对其执行一些基本的预处理。</p><ul class=""><li id="3470" class="nc nd iq lz b ma nq md nr mg ns mk nt mo nu ms nh ni nj nk bi translated">我们改变类型</li><li id="85e9" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">删除了引号和空格</li><li id="1829" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">更改了列并合并了两个CSV文件</li></ul><pre class="kp kq kr ks gt nv nw nx ny aw nz bi"><span id="5f38" class="oa lg iq nw b gy ob oc l od oe"><strong class="nw ja">def</strong> load_data(path:str<strong class="nw ja">=</strong>"/"):<br/>    """<br/>        Loads the specified data using the path<br/><br/>        Args<br/>        -------<br/>        path: str (where president_timelines.csv and president_states.csv reside)<br/><br/>        Returns<br/>        --------<br/>        The combined dataframe<br/>    """<br/>    df_time <strong class="nw ja">=</strong> pd<strong class="nw ja">.</strong>read_csv("president_timelines.csv")<br/>    df_states <strong class="nw ja">=</strong> pd<strong class="nw ja">.</strong>read_csv("president_states.csv")<br/>    <em class="of"># Setting columns as specified by the dataframe</em><br/>    df_time<strong class="nw ja">.</strong>columns <strong class="nw ja">=</strong> ["Index", "Name", "Birth", "Death", "TermBegin", "TermEnd"]<br/>    df_states<strong class="nw ja">.</strong>columns <strong class="nw ja">=</strong> ["Name", "Birth State"]<br/>    president_names <strong class="nw ja">=</strong> df_time<strong class="nw ja">.</strong>Name<br/>    print(f"Total number of presidents: {len(president_names)}")<br/>    president_states <strong class="nw ja">=</strong> df_states["Birth State"]<br/>    print(f"Total states: {len(president_states)}")<br/>    df <strong class="nw ja">=</strong> pd<strong class="nw ja">.</strong>DataFrame({"name":president_names, "states":president_states})<br/>    <em class="of"># changing type</em><br/>    df<strong class="nw ja">.</strong>name <strong class="nw ja">=</strong> df<strong class="nw ja">.</strong>name<strong class="nw ja">.</strong>astype(str)<br/>    df<strong class="nw ja">.</strong>states <strong class="nw ja">=</strong> df<strong class="nw ja">.</strong>states<strong class="nw ja">.</strong>astype(str)<br/>    <em class="of"># removing whitespaces</em><br/>    df['states'] <strong class="nw ja">=</strong> df['states']<strong class="nw ja">.</strong>apply(<strong class="nw ja">lambda</strong> x: x<strong class="nw ja">.</strong>strip())<br/>    <em class="of"># removing quotes</em><br/>    df<strong class="nw ja">.</strong>states <strong class="nw ja">=</strong> df<strong class="nw ja">.</strong>states<strong class="nw ja">.</strong>apply(<strong class="nw ja">lambda</strong> x: x<strong class="nw ja">.</strong>replace('"',""))<br/>    df<strong class="nw ja">.</strong>name <strong class="nw ja">=</strong> df<strong class="nw ja">.</strong>name<strong class="nw ja">.</strong>apply(<strong class="nw ja">lambda</strong> x: x<strong class="nw ja">.</strong>replace('"',""))<br/><br/>    <strong class="nw ja">return</strong> df</span></pre><blockquote class="og"><p id="aeaf" class="oh oi iq bd oj ok ol om on oo op ms dk translated">我们还更改了列的类型，以便以后能够使用它。</p></blockquote><figure class="or os ot ou ov kt gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/705bf5110e9b2c0e5975b4473005e82c.png" data-original-src="https://miro.medium.com/v2/resize:fit:536/format:webp/1*3GXq7PXZHKGf6emQURO_Ig.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">试映</figcaption></figure><h1 id="1e40" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">寻找共同点</h1><p id="3d12" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">现在，我们开始写一个函数，它可以找到所有的公共状态。</p><ul class=""><li id="87fe" class="nc nd iq lz b ma nq md nr mg ns mk nt mo nu ms nh ni nj nk bi translated">我们首先创建一个州名图</li><li id="47e1" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">我们还创建了一个反向索引</li><li id="6cba" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">我们使用集合。计数器类获取最常见的计数，并使用反向查找索引查找状态</li><li id="cd35" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">我们找到前5个州并打印出来</li></ul><pre class="kp kq kr ks gt nv nw nx ny aw nz bi"><span id="e374" class="oa lg iq nw b gy ob oc l od oe"><strong class="nw ja">def</strong> common(show_counter<strong class="nw ja">=False</strong>, show_prez<strong class="nw ja">=False</strong>):<br/>    """<br/>    Find the common data points in the dataset<br/>    """<br/>    <strong class="nw ja">from</strong> collections <strong class="nw ja">import</strong> Counter<br/>    mapping_state_name <strong class="nw ja">=</strong> {state:name <strong class="nw ja">for</strong> state,name <strong class="nw ja">in</strong> zip(df['states']<strong class="nw ja">.</strong>unique(), df['name']<strong class="nw ja">.</strong>unique())}<br/>    df['states'] <strong class="nw ja">=</strong> df['states']<br/>    counter <strong class="nw ja">=</strong> Counter(df['states']<strong class="nw ja">.</strong>values)<br/>    counter_vice_versa <strong class="nw ja">=</strong> {counter[key]: key <strong class="nw ja">for</strong> key <strong class="nw ja">in</strong> counter<strong class="nw ja">.</strong>keys()}<br/>    max_counter <strong class="nw ja">=</strong> max(counter)<br/>    count <strong class="nw ja">=</strong> sorted(counter<strong class="nw ja">.</strong>values())<br/>    second_largest_count <strong class="nw ja">=</strong> count[<strong class="nw ja">-</strong>2]<br/>    print(f"Maximum occured state: {max_counter}.")<br/>    print(f"Second largest state: {counter_vice_versa[second_largest_count]}")<br/>    print(f"Third largest state: {counter_vice_versa[count[<strong class="nw ja">-</strong>3]]}")<br/>    print(f"Fourth largest state: {counter_vice_versa[count[<strong class="nw ja">-</strong>4]]}")<br/>    print(f"Fifth largest state: {counter_vice_versa[count[<strong class="nw ja">-</strong>5]]}")<br/>    <em class="of"># presidents with the max_counter</em><br/>    <strong class="nw ja">if</strong> show_prez:<br/>        <strong class="nw ja">for</strong> name, state <strong class="nw ja">in</strong> zip(df['name'], df['states']):<br/>            <strong class="nw ja">if</strong> state <strong class="nw ja">==</strong> max_counter:<br/>                print(f"President with {max_counter} was {name}.")<br/>    <strong class="nw ja">if</strong> show_counter:<br/>        print(counter<strong class="nw ja">.</strong>keys())<br/>common(<strong class="nw ja">False</strong>, <strong class="nw ja">True</strong>)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/a4966487ec833b75afcae9394ae9d136.png" data-original-src="https://miro.medium.com/v2/resize:fit:838/format:webp/1*aqZAC3c_wmE5DF0L9KER0Q.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">输出预览</figcaption></figure><h1 id="13ca" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">使用基于矩阵的方法找到共同点的另一种方法</h1><p id="c836" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">我们还使用不同的技术来获得公共状态。我们绘制了一个热图，以视觉上吸引人的方式获得结果。</p><pre class="kp kq kr ks gt nv nw nx ny aw nz bi"><span id="d253" class="oa lg iq nw b gy ob oc l od oe">matrix_based <strong class="nw ja">=</strong> df<strong class="nw ja">.</strong>groupby("name")['states']<strong class="nw ja">.</strong>value_counts()<strong class="nw ja">.</strong>unstack()<strong class="nw ja">.</strong>fillna(0)<br/>sns<strong class="nw ja">.</strong>heatmap(matrix_based, vmax<strong class="nw ja">=</strong>1, vmin<strong class="nw ja">=</strong>0, cmap<strong class="nw ja">=</strong>"gray")<br/>plt<strong class="nw ja">.</strong>title("Finding common ground")</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ox"><img src="../Images/d60c56de76bef8a79abd7846bba20c10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ee1e8yZREOtfsmzHk4CR9A.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">试映</figcaption></figure><ul class=""><li id="bd5d" class="nc nd iq lz b ma nq md nr mg ns mk nt mo nu ms nh ni nj nk bi translated">这里你可以看到，在一个特定的州，每一位总统，我们有1.0，如果一位总统被重复，那么我们在一列中有2或1</li><li id="98bf" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">这很好地展示了总统在全州的分布情况</li><li id="cc85" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">该热图显示，<strong class="lz ja"> 0的值为黑色</strong>，白色表示1.0 </li></ul><h1 id="0fda" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">使用其他来源的数据进行进一步分析</h1><p id="33b5" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">我们将利用每个州的疾病预防控制中心的数据来发现一些有趣的见解。</p><pre class="kp kq kr ks gt nv nw nx ny aw nz bi"><span id="1137" class="oa lg iq nw b gy ob oc l od oe"><strong class="nw ja">def</strong> load_data_from_cdc(save<strong class="nw ja">=False</strong>):<br/>    """<br/>    Load data from CDC<br/>    """<br/>    <em class="of"># reading the html table at index 0</em><br/>    df_states_fact <strong class="nw ja">=</strong> pd<strong class="nw ja">.</strong>read_html("https://www.cdc.gov/nchs/fastats/state-and-territorial-data.htm")[0]<br/>    <em class="of"># changing column (for join)</em><br/>    df_states_fact['states'] <strong class="nw ja">=</strong> df_states_fact['State/Territory']<br/>    <em class="of"># removing old column</em><br/>    df_states_fact<strong class="nw ja">.</strong>drop(columns<strong class="nw ja">=</strong>['State/Territory'], inplace<strong class="nw ja">=True</strong>)<br/>    merged <strong class="nw ja">=</strong> pd<strong class="nw ja">.</strong>merge(df, df_states_fact)<br/>    <em class="of"># Save the csv</em><br/>    <strong class="nw ja">if</strong> save:<br/>        merged<strong class="nw ja">.</strong>to_csv(index<strong class="nw ja">=False</strong>)<br/>    merged<strong class="nw ja">.</strong>Births <strong class="nw ja">=</strong> merged<strong class="nw ja">.</strong>Births<strong class="nw ja">.</strong>astype(float)<br/>    merged['Fertility Rate'] <strong class="nw ja">=</strong> merged['Fertility Rate']<strong class="nw ja">.</strong>astype(float)<br/>    merged['Death Rate'] <strong class="nw ja">=</strong> merged['Death Rate']<strong class="nw ja">.</strong>astype(float)<br/>    <strong class="nw ja">return</strong> merged<br/><br/>df_merged <strong class="nw ja">=</strong> load_data_from_cdc()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/d30f7e06f5f2d80392eb40ad83df9759.png" data-original-src="https://miro.medium.com/v2/resize:fit:778/format:webp/1*WbiX2QjNKiutii0EUwrvEQ.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">相关矩阵</figcaption></figure><ul class=""><li id="9bd3" class="nc nd iq lz b ma nq md nr mg ns mk nt mo nu ms nh ni nj nk bi translated">相关矩阵没有显示数据点之间的关系。</li><li id="a291" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">让我们尝试将名称和状态转换成数值，然后尝试执行关联</li></ul><pre class="kp kq kr ks gt nv nw nx ny aw nz bi"><span id="c834" class="oa lg iq nw b gy ob oc l od oe"><strong class="nw ja">def</strong> apply_transformations(df: pd<strong class="nw ja">.</strong>DataFrame):<br/>    """<br/>    Apply transformation on states and name<br/>    """<br/>    <em class="of"># mapping of states and names</em><br/>    mapping_states <strong class="nw ja">=</strong> {state: index <strong class="nw ja">for</strong> index, state <strong class="nw ja">in</strong> enumerate(df['states'])}<br/>    mapping_name <strong class="nw ja">=</strong> {name: index <strong class="nw ja">for</strong> index, name <strong class="nw ja">in</strong> enumerate(df['name'])}<br/><br/>    df<strong class="nw ja">.</strong>states <strong class="nw ja">=</strong> df<strong class="nw ja">.</strong>states<strong class="nw ja">.</strong>apply(<strong class="nw ja">lambda</strong> x: mapping_states[x])<br/>    df<strong class="nw ja">.</strong>name <strong class="nw ja">=</strong> df<strong class="nw ja">.</strong>name<strong class="nw ja">.</strong>apply(<strong class="nw ja">lambda</strong> x: mapping_name[x])<br/>    <strong class="nw ja">return</strong> df<br/><br/><br/>df_transformed <strong class="nw ja">=</strong> apply_transformations(df_merged)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/8ab1041cb40c03d9cf5de029b1a57166.png" data-original-src="https://miro.medium.com/v2/resize:fit:890/format:webp/1*OOSYa6BKwejt1pnf2yxVNA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">转换数据集</figcaption></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/fa8af1005240d238fec3ae84a580aff4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1022/format:webp/1*3NdmeLxOXucvtBmY_BNloA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">新结果</figcaption></figure><h1 id="91a0" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">一些有趣的情节</h1><p id="d04f" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">让我们绘制一些有趣的数据点</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/3c5189cdd07847cdd0ccad4266cd082c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1166/format:webp/1*uD1P2FiV317P7mbKAz1k8A.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">死亡率和出生率</figcaption></figure><h1 id="1e6f" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">绘制地图</h1><p id="4ad9" class="pw-post-body-paragraph lx ly iq lz b ma mb ka mc md me kd mf mg mh mi mj mk ml mm mn mo mp mq mr ms ij bi translated">为了更好地理解这些数据，让我们用所有被标记的总统来绘制一张地图。为了解决这个问题，我们将纬度和经度数据集与美国总统数据集相结合。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pc"><img src="../Images/9984c2cdfe534bba3a61e5c5a2c337f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wM0uDKg11x5fopzPApcc2w.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">组合数据集</figcaption></figure><pre class="kp kq kr ks gt nv nw nx ny aw nz bi"><span id="435b" class="oa lg iq nw b gy ob oc l od oe">map_osm <strong class="nw ja">=</strong> folium<strong class="nw ja">.</strong>Map(width<strong class="nw ja">=</strong>500,height<strong class="nw ja">=</strong>500,location<strong class="nw ja">=</strong>[37.0902, <strong class="nw ja">-</strong>95.7129], zoom_start<strong class="nw ja">=</strong>3)<br/>df_final<strong class="nw ja">.</strong>apply(<strong class="nw ja">lambda</strong> row:folium<strong class="nw ja">.</strong>CircleMarker(location<strong class="nw ja">=</strong>[row["Latitude"], <br/>                                                  row["Longitude"]])<strong class="nw ja">.</strong>add_to(map_osm),<br/>         axis<strong class="nw ja">=</strong>1)</span></pre><blockquote class="og"><p id="5872" class="oh oi iq bd oj ok ol om on oo op ms dk translated">然后我们用叶子绘制地图</p></blockquote><figure class="or os ot ou ov kt gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/27b2c2afb435301bb90d25e0386e3a9f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1062/format:webp/1*enBGJq5NwIL-cUaqeoLAmA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">我们的地图</figcaption></figure><h1 id="beea" class="lf lg iq bd lh li lj lk ll lm ln lo lp kf lq kg lr ki ls kj lt kl lu km lv lw bi translated">结论</h1><ul class=""><li id="ea19" class="nc nd iq lz b ma mb md me mg ne mk nf mo ng ms nh ni nj nk bi translated">在分析数据时，我们发现了一些非常有趣的见解</li><li id="e44a" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">我们试图把不同来源的数据结合起来以得到我们的答案</li><li id="b8fa" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">我们用不同的方法来可视化我们的数据</li><li id="d02c" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">我们找到了最常见的状态</li><li id="556d" class="nc nd iq lz b ma nl md nm mg nn mk no mo np ms nh ni nj nk bi translated">如果我们能够获得各种各样的国家数据，如教育、收入等，我们本可以做得更好</li></ul><p id="204e" class="pw-post-body-paragraph lx ly iq lz b ma nq ka mc md nr kd mf mg pe mi mj mk pf mm mn mo pg mq mr ms ij bi translated">在这里访问笔记本:<a class="ae le" href="https://aaditkapoor.github.io/president_analysis.html" rel="noopener ugc nofollow" target="_blank">https://aaditkapoor.github.io/president_analysis.html</a></p></div></div>    
</body>
</html>