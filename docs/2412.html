<html>
<head>
<title>Stock Market Predictions using Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用深度学习的股市预测</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/stock-market-predictions-using-deep-learning-9e471d9cbdb?source=collection_archive---------1-----------------------#2021-12-10">https://pub.towardsai.net/stock-market-predictions-using-deep-learning-9e471d9cbdb?source=collection_archive---------1-----------------------#2021-12-10</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="efd1" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning/deep-learning" rel="noopener ugc nofollow" target="_blank">深度学习</a></h2><div class=""/><p id="1cf9" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">“有了对历史的良好视角，我们可以更好地了解过去和现在，从而对未来有一个清晰的愿景。”</p><p id="3074" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">—卡洛斯·斯利姆·埃卢</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi kx"><img src="../Images/5a683b44a3306c3e846ffd1cdeecf527.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*akEEHFCMbFEu-lI3"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated"><a class="ae ln" href="https://unsplash.com/@nick604?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">尼克·钟</a>在<a class="ae ln" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="b60d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">简介</strong></p><p id="bf61" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">股市分析和预测是很难完成的任务。有许多变量会影响股票价格的价值，包括但不限于媒体出版物、内部购买、股息、季度财务报告和管理层的财务预测。这些变量使得任何股市专业人士都极难准确预测股价的涨跌。</p><p id="deca" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">随着机器学习及其许多高级算法的引入，最近的市场研究和股票市场预测进步已经开始将机器学习方法包括在分析股票市场数据和预测未来股票价格中。</p><p id="9775" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">路线图</strong></p><p id="fe5c" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">本文的其余部分将介绍一个程序，该程序将尝试使用机器学习根据以前的收盘价来预测未来的股票价格。我们将使用长短期记忆(LSTM)模型。将使用Python执行以下步骤。</p><p id="c238" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">1.导入所需的软件库。</p><p id="dd7c" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">2.访问和存储数据。</p><p id="5d57" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">3.数据分析和探索。</p><p id="6c2e" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">4.数据准备。</p><p id="0116" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">5.建立LSTM模型。</p><p id="53f8" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">6.编译和训练LSTM模型。</p><p id="5cff" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">7.创建测试数据。</p><p id="79ed" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">8.根据测试数据进行预测。</p><p id="182d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">9.评估模型的性能。</p><p id="1f24" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">10.可视化股票价格预测。</p><p id="0048" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">程序</strong></p><p id="770d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">这个程序的目标是预测未来的股票价格的基础上，以前的收盘价为一家公司的股票。</p><p id="5d91" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">安装yfinance和cartopy包。</strong></p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="0961" class="lt lu it lp b gy lv lw l lx ly">!pip install yfinance<br/>!pip install cartopy</span></pre><p id="2ae7" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">导入所需的软件库</strong></p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="a748" class="lt lu it lp b gy lv lw l lx ly"><strong class="lp jd">import</strong> numpy <strong class="lp jd">as</strong> np<br/><strong class="lp jd">import</strong> pandas <strong class="lp jd">as</strong> pd<br/><strong class="lp jd">import</strong> matplotlib.pyplot <strong class="lp jd">as</strong> plt<br/><strong class="lp jd">from</strong> matplotlib.pyplot <strong class="lp jd">import</strong> figure <br/><strong class="lp jd">import</strong> matplotlib.dates <strong class="lp jd">as</strong> mdates<br/><strong class="lp jd">from</strong> keras.models <strong class="lp jd">import</strong> Sequential<br/><strong class="lp jd">from</strong> keras.layers <strong class="lp jd">import</strong> Dense, LSTM<br/><strong class="lp jd">import</strong> math<br/><strong class="lp jd">from</strong> sklearn.preprocessing <strong class="lp jd">import</strong> MinMaxScaler</span></pre><p id="0a25" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">访问和存储数据</strong></p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="155b" class="lt lu it lp b gy lv lw l lx ly"># We will use the Yahoo! Finance Market Downloader to get the data for Nvidia stock.<br/><strong class="lp jd">import</strong> yfinance <strong class="lp jd">as</strong> yf<br/>company <strong class="lp jd">=</strong> yf<strong class="lp jd">.</strong>download('NVDA',start<strong class="lp jd">=</strong>'2017-01-01',  end<strong class="lp jd">=</strong>'2021-12-07',progress<strong class="lp jd">=False</strong>)[['Open', 'High', 'Low', 'Close', 'Volume']]</span><span id="b175" class="lt lu it lp b gy lz lw l lx ly"># Print the first 5 rows.<br/>company<strong class="lp jd">.</strong>head()</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ma"><img src="../Images/61fad778d8be162c7146c5521b43a8ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h0cN1-nq5losgNtLJbokQg.png"/></div></div></figure><p id="6ee7" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">这个数据集是从雅虎财经获得的，包括Nvidia公司5年的股票数据。Nvidia为游戏和专业市场设计图形处理单元，并为移动计算和汽车市场设计片上系统单元。</p><p id="a849" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">下面描述了这些列和定义。</p><ol class=""><li id="98a0" class="mb mc it kb b kc kd kg kh kk md ko me ks mf kw mg mh mi mj bi translated">日期—格式为:年-月-日。</li><li id="386d" class="mb mc it kb b kc mk kg ml kk mm ko mn ks mo kw mg mh mi mj bi translated">开盘——股票在市场开盘时的价格(以美元计)。</li><li id="2e60" class="mb mc it kb b kc mk kg ml kk mm ko mn ks mo kw mg mh mi mj bi translated">高-当天达到的最高价格。</li><li id="cdb1" class="mb mc it kb b kc mk kg ml kk mm ko mn ks mo kw mg mh mi mj bi translated">低-当天达到的最低价格。</li><li id="0380" class="mb mc it kb b kc mk kg ml kk mm ko mn ks mo kw mg mh mi mj bi translated">当天的收盘价格。</li><li id="6880" class="mb mc it kb b kc mk kg ml kk mm ko mn ks mo kw mg mh mi mj bi translated">成交量——当天交易的股票数量。</li></ol><p id="827d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">数据分析和探索</strong></p><p id="e045" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">显示有关数据列的信息。</p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="39c1" class="lt lu it lp b gy lv lw l lx ly">company<strong class="lp jd">.</strong>info()</span><span id="aab4" class="lt lu it lp b gy lz lw l lx ly">&lt;class 'pandas.core.frame.DataFrame'&gt;<br/>DatetimeIndex: 990 entries, 2018-01-02 to 2021-12-06<br/>Data columns (total 5 columns):<br/> #   Column  Non-Null Count  Dtype  <br/>---  ------  --------------  -----  <br/> 0   Open    990 non-null    float64<br/> 1   High    990 non-null    float64<br/> 2   Low     990 non-null    float64<br/> 3   Close   990 non-null    float64<br/> 4   Volume  990 non-null    int64  <br/>dtypes: float64(4), int64(1)<br/>memory usage: 46.4 KB</span></pre><p id="bc25" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">有990个股票记录和5列。所有要素都具有数字数据类型。数据集中没有空值或缺失值。</p><p id="06c7" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">可视化前60天的收盘价。</p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="5a5c" class="lt lu it lp b gy lv lw l lx ly"># Extract only the top 60 rows.<em class="mp"> </em><br/>company_60 <strong class="lp jd">=</strong> company<strong class="lp jd">.</strong>head(60)<br/>company_60<strong class="lp jd">.</strong>reset_index(inplace<strong class="lp jd">=True</strong>)<br/> <br/>#  Plot closing stock price by date.<br/>plt<strong class="lp jd">.</strong>rcParams['figure.figsize'] <strong class="lp jd">=</strong> [9, 6]<br/>company_60<strong class="lp jd">.</strong>plot('Date','Close', color<strong class="lp jd">=</strong>"darkblue")<br/>plt<strong class="lp jd">.</strong>xlabel('Date', fontsize<strong class="lp jd">=</strong>12)<br/>plt<strong class="lp jd">.</strong>ylabel('Close Price', fontsize<strong class="lp jd">=</strong>12)<br/>plt<strong class="lp jd">.</strong>title('Closing Stock Price by Date', fontsize<strong class="lp jd">=</strong>14)<br/>plt<strong class="lp jd">.</strong>grid()<br/>plt<strong class="lp jd">.</strong>show()</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi mq"><img src="../Images/7a63f2d88d35704562b8d9cb26b851b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4HvV-K2S5R_Sblz8iqEnZg.png"/></div></div></figure><p id="02d5" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">数据准备</strong></p><p id="1b25" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">我们将创建一个只包含收盘价的数据集，并将数据转换成一个数组。</p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="6d57" class="lt lu it lp b gy lv lw l lx ly">close_data <strong class="lp jd">=</strong> company['Close']<br/>close_array <strong class="lp jd">=</strong> close_data<strong class="lp jd">.</strong>values<strong class="lp jd">.</strong>reshape(<strong class="lp jd">-</strong>1, 1)</span></pre><p id="f7c7" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">归一化要素数据集。我们将使用MinMax Scaler来转换数据，使其分布的平均值为0，标准差为1。</p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="6e7b" class="lt lu it lp b gy lv lw l lx ly">scaler <strong class="lp jd">=</strong> MinMaxScaler(feature_range<strong class="lp jd">=</strong>(0, 1))<br/>scaled_data <strong class="lp jd">=</strong> scaler<strong class="lp jd">.</strong>fit_transform(close_array</span></pre><p id="e184" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">创建一个包含70%数据的训练数据集。</p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="a444" class="lt lu it lp b gy lv lw l lx ly">training_data_len <strong class="lp jd">=</strong> math<strong class="lp jd">.</strong>ceil(len(close_array) <strong class="lp jd">*</strong>.70)<br/>train_data <strong class="lp jd">=</strong> scaled_data[0:training_data_len  , : ]</span></pre><p id="ae09" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">我们需要转换数据，以便将它们输入到机器学习模型中。我们将重新构建数据，对包含60天收盘价的数据进行训练，并对第61天的收盘价进行预测。</p><p id="7b04" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">x train数据集将包含60个值，第一列将包含第0行到第59行的收盘价，第二列将包含第1行到第60行的收盘价，其余数据将重复这一模式。</p><p id="058d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">y训练数据集将在第一列中包含第61个值，在第二列中包含第62个值，并且该模式将对其余数据重复。</p><p id="c66d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">我们将把x和y训练数据转换成NumPy数组，以便它们可以用于训练LSTM模型。</p><p id="600e" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">LSTM模型需要三维数据集中的数据。我们将使用shape()函数将数据整形为三维形式。</p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="dcf2" class="lt lu it lp b gy lv lw l lx ly"># Separate the data into x and y data sets.<br/>x_train_data<strong class="lp jd">=</strong>[]<br/>y_train_data <strong class="lp jd">=</strong>[]<br/><strong class="lp jd">for</strong> i <strong class="lp jd">in</strong> range(60,len(train_data)):<br/>    x_train_data<strong class="lp jd">=</strong>list(x_train_data)<br/>    y_train_data<strong class="lp jd">=</strong>list(y_train_data)<br/>    x_train_data<strong class="lp jd">.</strong>append(train_data[i<strong class="lp jd">-</strong>60:i,0])<br/>    y_train_data<strong class="lp jd">.</strong>append(train_data[i,0])<br/><br/>    # Convert the x and y training values into numpy arrays. <br/>    x_train_data1, y_train_data1 <strong class="lp jd">=</strong> np<strong class="lp jd">.</strong>array(x_train_data), np<strong class="lp jd">.</strong>array(y_train_data) <br/><br/>    # Reshaping training data for calculations.<em class="mp"> </em><br/>    x_train_data2 <strong class="lp jd">=</strong> np<strong class="lp jd">.</strong>reshape(x_train_data1, (x_train_data1<strong class="lp jd">.</strong>shape[0],x_train_data1<strong class="lp jd">.</strong>shape[1],1))</span></pre><p id="2259" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">我们将使用长短期记忆(LSTM)模型对数据进行训练。LSTM是一种特殊的递归神经网络(RNN ),能够学习数据的长期相关性。LSTM有一种叫做“门”的内部机制，可以控制信息的流动。这些门可以了解序列中哪些数据是重要的，应该保留或丢弃。通过这样做，它可以将相关信息传递到长长的序列链中进行预测。如果你想了解更多关于LSTM的信息，点击此链接<a class="ae ln" href="https://www.youtube.com/watch?v=LfnrRPFhkuY" rel="noopener ugc nofollow" target="_blank"> LSTM </a></p><p id="b4be" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">建造LSTM模型</strong></p><p id="c196" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">LSTM模型将具有两个具有50个神经元的LSTM层和两个密集层，一个具有25个神经元，另一个具有一个神经元。</p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="73ce" class="lt lu it lp b gy lv lw l lx ly">model <strong class="lp jd">=</strong> Sequential()<br/>model<strong class="lp jd">.</strong>add(LSTM(units<strong class="lp jd">=</strong>50, return_sequences<strong class="lp jd">=True</strong>,input_shape<strong class="lp jd">=</strong>(x_train_data2<strong class="lp jd">.</strong>shape[1],1)))<br/>model<strong class="lp jd">.</strong>add(LSTM(units<strong class="lp jd">=</strong>50, return_sequences<strong class="lp jd">=False</strong>))<br/>model<strong class="lp jd">.</strong>add(Dense(units<strong class="lp jd">=</strong>25))<br/>model<strong class="lp jd">.</strong>add(Dense(units<strong class="lp jd">=</strong>1))</span></pre><p id="d005" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">编译和训练LSTM模型</strong></p><p id="c406" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">使用adam优化器和均方误差(MSE)损失函数来编译LSTM模型。我们将使用fit()函数对数据集进行训练。这些参数包括:</p><ul class=""><li id="5ff1" class="mb mc it kb b kc kd kg kh kk md ko me ks mf kw mr mh mi mj bi translated">批次大小是单个批次中训练样本的总数。</li><li id="1674" class="mb mc it kb b kc mk kg ml kk mm ko mn ks mo kw mr mh mi mj bi translated">时期是整个数据集通过神经网络向前和向后传递时的迭代次数。</li></ul><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="6180" class="lt lu it lp b gy lv lw l lx ly"># Compile the LSTM model.<br/>model<strong class="lp jd">.</strong>compile(optimizer<strong class="lp jd">=</strong>'adam', loss<strong class="lp jd">=</strong>'mean_squared_error')<br/># Train the model on the training data.<br/>model<strong class="lp jd">.</strong>fit(x_train_data2, y_train_data1, batch_size<strong class="lp jd">=</strong>1, epochs<strong class="lp jd">=</strong>1)</span></pre><p id="257b" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">创建测试数据</strong></p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="dce5" class="lt lu it lp b gy lv lw l lx ly">test_data <strong class="lp jd">=</strong> scaled_data[training_data_len <strong class="lp jd">-</strong> 60: , : ]<br/>x_test <strong class="lp jd">=</strong> []<br/>y_test <strong class="lp jd">=</strong> close_array[training_data_len : , : ]<br/><strong class="lp jd">for</strong> i <strong class="lp jd">in</strong> range(60,len(test_data)):<br/>    x_test<strong class="lp jd">.</strong>append(test_data[i<strong class="lp jd">-</strong>60:i,0])</span><span id="86e2" class="lt lu it lp b gy lz lw l lx ly"># Convert the testing data into arrays for easier computation.<br/>x_test <strong class="lp jd">=</strong> np<strong class="lp jd">.</strong>array(x_test)<br/>x_test <strong class="lp jd">=</strong> np<strong class="lp jd">.</strong>reshape(x_test, (x_test<strong class="lp jd">.</strong>shape[0],x_test<strong class="lp jd">.</strong>shape[1],1))</span></pre><p id="8712" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">对测试数据进行预测</strong></p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="8bf4" class="lt lu it lp b gy lv lw l lx ly">predictions <strong class="lp jd">=</strong> model<strong class="lp jd">.</strong>predict(x_test)<br/>predictions <strong class="lp jd">=</strong> scaler<strong class="lp jd">.</strong>inverse_transform(predictions)</span></pre><p id="322c" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">评估模型的性能</strong></p><p id="3f35" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">我们将使用均方根误差(RMSE)来衡量模型的性能。“根”表示平方误差是一种度量标准，它显示了模型的预测值与数据集中的实际值之间的平均距离。通过计算每个数据点的残差(预测值和真实值之间的差值)，计算每个数据点的残差的范数，计算残差的平均值，然后求该平均值的平方根，可以得到RMSE。该值越低，模型的性能越好。</p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="e4de" class="lt lu it lp b gy lv lw l lx ly"># Show the root mean squared error (RMSE) for the LSTM model.<em class="mp">  </em><br/>rmse<strong class="lp jd">=</strong>np<strong class="lp jd">.</strong>sqrt(np<strong class="lp jd">.</strong>mean(((predictions <strong class="lp jd">-</strong> y_test)<strong class="lp jd">**</strong>2)))<br/>print(rmse)</span></pre><p id="40c7" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi">10.65793956845391</p><p id="8a14" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">RMSE显示，LSTM模型的典型预测误差为10.65，相当不错。</p><p id="2268" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">我们现在将计算该模型的95%置信区间，这将显示误差可以波动多少。95%置信区间是您可以95%确定包含总体真实均值的值范围。</p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="9780" class="lt lu it lp b gy lv lw l lx ly"><strong class="lp jd">from</strong> scipy <strong class="lp jd">import</strong> stats<br/>confidence <strong class="lp jd">=</strong> 0.95<br/>squared_errors <strong class="lp jd">=</strong> (predictions <strong class="lp jd">-</strong> y_test) <strong class="lp jd">**</strong> 2<br/>np<strong class="lp jd">.</strong>sqrt(stats<strong class="lp jd">.</strong>t<strong class="lp jd">.</strong>interval(confidence, len(squared_errors) <strong class="lp jd">-</strong> 1,<br/>                         loc <strong class="lp jd">=</strong> squared_errors<strong class="lp jd">.</strong>mean(),<br/>                         scale <strong class="lp jd">=</strong> stats<strong class="lp jd">.</strong>sem(squared_errors)))</span></pre><p id="db4d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">数组([[ 9.3788687 ]，<br/>，[11.79915987]])</p><p id="6e92" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">这表明预测误差可以在9.37到11.79之间的任何地方波动。置信区间缺口在2.42美元左右。</p><p id="9460" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">可视化实际收盘价和预测收盘价。</strong></p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="941f" class="lt lu it lp b gy lv lw l lx ly">train <strong class="lp jd">=</strong> company[:training_data_len]<br/>valid <strong class="lp jd">=</strong> company[training_data_len:]<br/> <br/>valid['Predictions'] <strong class="lp jd">=</strong> predictions<br/>plt<strong class="lp jd">.</strong>figure(figsize<strong class="lp jd">=</strong>(10,6)) <br/>plt<strong class="lp jd">.</strong>title('Model')<br/>plt<strong class="lp jd">.</strong>xlabel('Date')<br/>plt<strong class="lp jd">.</strong>ylabel('Close')<br/> <br/>plt<strong class="lp jd">.</strong>plot(train['Close'])<br/>plt<strong class="lp jd">.</strong>plot(valid[['Close', 'Predictions']])<br/><em class="mp"># ax.set_xticklabels(ax.get_xticklabels(),rotation = 90, size = 10)</em><br/> <br/>plt<strong class="lp jd">.</strong>legend(['Train', 'Actual', 'Predictions'], loc<strong class="lp jd">=</strong>'lower right')<br/>plt<strong class="lp jd">.</strong>grid() <br/>plt<strong class="lp jd">.</strong>show()</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi ms"><img src="../Images/ab174f313a35c217daefdd117e5b01bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DYq_IRBHrxo1VJpNpVz11w.png"/></div></div></figure><p id="2c1e" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">股票的预测收盘价和实际收盘价相当接近。</p><p id="1602" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">按日期显示股票的实际收盘价和预测收盘价。</p><pre class="ky kz la lb gt lo lp lq lr aw ls bi"><span id="3a2e" class="lt lu it lp b gy lv lw l lx ly">valid[['Close', 'Predictions']]</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi mt"><img src="../Images/a634a9fe38de15f7d51a1d8ed1ebf85e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8js3nxm5n4H4lpN39R2K5A.png"/></div></div></figure><p id="d07b" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">结论:长短期记忆(LSTM)模型的平均预测误差为10.65，非常好。这意味着模型预测的收盘价和实际收盘价之间的平均美元金额差异为10.65美元。股票的预测收盘价与实际收盘价非常接近，显示出高度的准确性。这个模型可以用来预测在纽约证券交易所或纳斯达克上市的其他公司的股票价格。可以通过调整模型的一些参数来提高模型的精度。</p><p id="3d4d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">非常感谢你阅读我的文章！如果您有任何意见或反馈，请在下面添加。</p><p id="79cc" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">如果你喜欢阅读这样的故事，并想支持我成为一名作家，可以考虑报名成为一名媒体成员。会员资格让你可以无限制地接触媒体上的故事。你可以通过这个链接注册<a class="ae ln" href="https://medium.com/@dniggl/membership" rel="noopener">https://medium.com/@dniggl/membership</a></p></div></div>    
</body>
</html>