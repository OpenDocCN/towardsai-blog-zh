<html>
<head>
<title>Why you should use WebSocket to retrieve live crypto data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为什么应该使用WebSocket来检索实时加密数据</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/why-you-should-use-websocket-to-retrieve-live-crypto-data-27d3b29f210c?source=collection_archive---------0-----------------------#2021-11-09">https://pub.towardsai.net/why-you-should-use-websocket-to-retrieve-live-crypto-data-27d3b29f210c?source=collection_archive---------0-----------------------#2021-11-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="c14f" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/web-scraping" rel="noopener ugc nofollow" target="_blank">网页抓取</a></h2><div class=""/><p id="9987" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja">获取千变万化数据的救命妙招！</strong></p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ku"><img src="../Images/a3ea62796678fa5f4abf9cadc5d45ebb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ATK-AQ6S7ImVxHgw5iF_kQ.jpeg"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">由<a class="ae lk" href="https://unsplash.com/@freegraphictoday?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">绝对视觉</a>在<a class="ae lk" href="https://unsplash.com/s/photos/ideas?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="ffbf" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">自动化从网站检索数据过程的最好方法之一是构建一个网络爬虫来处理这项工作。您可以创建一个网络爬虫，用各种方法抓取数据。例如，如果您希望每隔几个小时或每周从网站检索一次数据，您可以编写一个程序来自动发送HTTP请求或打开浏览器来这样做，因为这样做的频率较低。但是，如果您想在几秒钟内抓取数据，最好还是通过web套接字连接。</p><p id="76ee" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">在讨论web scraper编码的实际部分之前，让我们简单地讨论一下它是什么，以及通常什么时候你会使用它。</p><p id="97f7" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">让我把它放在现实生活中…</p><p id="5858" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">一天，你告诉你的朋友，你将打电话给她讨论一个你不理解的概念。所以，当你打电话给你的朋友(握手)时，你的朋友会检查谁在打电话，然后决定是否接听电话(验证)。在您的朋友完成验证并接听您的电话后，他将向您解释这个概念，并为您的来电查询(来自服务器的数据流)保持线路畅通。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ll"><img src="../Images/6b0512e9a2078497187ebe5195192828.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x0iKPsmChbt_cycvQpve9w.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">解释web套接字过程的流程图</figcaption></figure><p id="ca76" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">通常，您应该考虑使用web套接字来检索加密货币、实时股票价格、实时博彩、实时消息传递、交易平台等数据。</p><p id="fa4d" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">了解这些概念后，让我们描绘一个真实的场景，并从那里开始工作。例如，如果你想建立一个实时交易机器人来交易加密货币，并且你已经有了一套规则来击败市场。</p><blockquote class="lm"><p id="fa66" class="ln lo iq bd lp lq lr ls lt lu lv kt dk translated">下一步是什么？</p></blockquote><p id="5d96" class="pw-post-body-paragraph jw jx iq jy b jz lw kb kc kd lx kf kg kh ly kj kk kl lz kn ko kp ma kr ks kt ij bi translated">你需要有一个网站，你可以检索实时数据。您遇到了一些API，但是担心这些API会失败，最终可能导致损失金钱。因此，你决定找一个提供实时加密价格的网站。让我们挑选<a class="ae lk" href="https://www.cryptocompare.com/" rel="noopener ugc nofollow" target="_blank"> <strong class="jy ja"> Cryptocompare </strong> </a>(全球加密货币市场数据提供商)来举例说明。</p><h1 id="5b33" class="mb mc iq bd md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my bi translated"><strong class="ak">探索</strong></h1><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi mz"><img src="../Images/3ddbf8fac86007f0424358b86964f85d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g6Wv7TSx-SZ291nZeYP6SA.png"/></div></div></figure><p id="ab5b" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">当您使用chrome导航到该网站时，右键单击并单击inspect，然后单击WS选项卡。现在，您应该可以看到与上面的截图类似的视图。您会注意到这个web套接字的请求url是WSS://streamer . crypto compare . com/v2？格式=流。</p><p id="cea6" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">接下来，让我们导航到message选项卡，获取需要发送到服务器的消息，以便完成验证。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi na"><img src="../Images/de61381c0956b23ad96bb6e6eb1a18aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u3EEv0gujYgg8h6jNcgaWg.png"/></div></div></figure><p id="e9ec" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">现在，你会看到有两种类型的箭头-</p><ol class=""><li id="426e" class="nb nc iq jy b jz ka kd ke kh nd kl ne kp nf kt ng nh ni nj bi translated">绿色箭头后面的消息表示您的浏览器正在向服务器发送的传出消息。</li><li id="394c" class="nb nc iq jy b jz nk kd nl kh nm kl nn kp no kt ng nh ni nj bi translated">红色箭头后面的消息是您的浏览器从服务器接收的传入数据。</li></ol><p id="0d10" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">到目前为止，您只需要通过右键单击邮件并选择“复制邮件”来复制绿色箭头的邮件。在编码部分，您将需要这5个绿色箭头消息。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="a60c" class="mb mc iq bd md me nw mg mh mi nx mk ml mm ny mo mp mq nz ms mt mu oa mw mx my bi translated"><strong class="ak">编码</strong></h1><figure class="kv kw kx ky gt kz"><div class="bz fp l di"><div class="ob oc l"/></div></figure><p id="5745" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">我附上了一个代码片段供您尝试。您需要注意的是将WebSocket密钥(<em class="od">“Sec-web socket-Key”</em>)更改为您可以从浏览器的“Headers”选项卡下获得的密钥。下面的例子:</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi oe"><img src="../Images/e3d580d1c86ee1fcb81b75faa2bffd3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ujcWrkNEprFt7S9-QFJsrA.png"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">寻找你的“<em class="of">Sec-web socket-Key”</em></figcaption></figure><p id="fea6" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">下面总结了上面代码片段的作用:</p><ol class=""><li id="c000" class="nb nc iq jy b jz ka kd ke kh nd kl ne kp nf kt ng nh ni nj bi translated">使用请求url创建连接</li></ol><p id="aed2" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">2.向服务器发送5条外发消息</p><p id="3dd6" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">3.坐下来，放松地等待收到的信息，通常是在几秒钟内。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="e0a5" class="mb mc iq bd md me nw mg mh mi nx mk ml mm ny mo mp mq nz ms mt mu oa mw mx my bi translated">结果</h1><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi og"><img src="../Images/37b641ceff47f1d499e70e5cbdba091b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vSo5pkW49w502SJraEPe9g.png"/></div></div></figure><p id="368a" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">将代码片段保存到python文件并运行它。您应该会看到类似的输出。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="3357" class="mb mc iq bd md me nw mg mh mi nx mk ml mm ny mo mp mq nz ms mt mu oa mw mx my bi translated">你可能面临的问题</h1><p id="0800" class="pw-post-body-paragraph jw jx iq jy b jz oh kb kc kd oi kf kg kh oj kj kk kl ok kn ko kp ol kr ks kt ij bi translated">这里有一些你可能会面临的问题，以及你如何解决它。</p><ol class=""><li id="ce01" class="nb nc iq jy b jz ka kd ke kh nd kl ne kp nf kt ng nh ni nj bi translated">错误消息:连接已经关闭</li></ol><p id="d923" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">如果你看到这个消息，通常意味着服务器正试图阻止你连接，解决这个问题的最快方法是改变你的代理或VPN。</p><p id="2dcd" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">2.HTTP状态代码:401(未授权)</p><p id="6fa7" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">401响应意味着服务器不接受您的连接请求。如果服务器工作正常，那么您的连接请求有问题。简而言之，通常这意味着您使用了错误的凭证。要解决这个问题，请检查请求头并相应地修改它们。</p><p id="6302" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">3.HTTP状态代码:403(禁止)</p><p id="57ea" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">类似于401，但在这种情况下，重新认证不会有任何影响。这可能意味着原始的应用程序逻辑发生了变化，例如握手过程发生了变化。因此，为了确保它平稳运行，请检查您的请求头和需要发送到服务器的消息。</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="1aac" class="mb mc iq bd md me nw mg mh mi nx mk ml mm ny mo mp mq nz ms mt mu oa mw mx my bi translated">最终想法</h1><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi om"><img src="../Images/6c45a095f119a1b5802927b57bfe4fc0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2WWWjYLaU18pUatsF4xd7A.jpeg"/></div></div><figcaption class="lg lh gj gh gi li lj bd b be z dk translated">照片由<a class="ae lk" href="https://unsplash.com/@matthewhenry?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">马太·亨利</a>在<a class="ae lk" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="8530" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">写这篇文章是因为以前的旧代码片段不起作用了。因此，我综合了读者提出的所有错误和问题，并做出了相应的回答。</p><p id="6138" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">如果你发现这个代码在将来不能工作，请在下面自由评论，我会相应地回答他们。</p><p id="c83d" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">谢谢你一直读到最后。下期帖子再见！</p></div><div class="ab cl np nq hu nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="ij ik il im in"><h1 id="8156" class="mb mc iq bd md me nw mg mh mi nx mk ml mm ny mo mp mq nz ms mt mu oa mw mx my bi translated">关于作者</h1><div class="on oo gp gr op oq"><a href="https://medium.com/@lowweihong" rel="noopener follow" target="_blank"><div class="or ab fo"><div class="os ab ot cl cj ou"><h2 class="bd ja gy z fp ov fr fs ow fu fw iz bi translated">●伟鸿-中等</h2><div class="ox l"><h3 class="bd b gy z fp ov fr fs ow fu fw dk translated">利用数据做出明智的决定与2019年8月相比，Airbnb的总收入增长了21%……</h3></div><div class="oy l"><p class="bd b dl z fp ov fr fs ow fu fw dk translated">medium.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe le oq"/></div></div></a></div><p id="1f7a" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><a class="ae lk" href="https://www.linkedin.com/in/lowweihong/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> Low魏宏</a>是Shopee的数据科学家。他的经验更多地涉及抓取网站，创建数据管道，以及实现机器学习模型来解决业务问题。</p><p id="d8d6" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">他提供爬行服务，可以为你提供你需要的准确和干净的数据。你可以访问<a class="ae lk" href="https://www.thedataknight.com/" rel="noopener ugc nofollow" target="_blank">这个网站</a>查看他的作品集，也可以联系他获取<strong class="jy ja">的抓取服务</strong>。</p><p id="d858" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">你可以在<a class="ae lk" href="https://www.linkedin.com/in/lowweihong/?source=post_page---------------------------" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>和<a class="ae lk" href="https://medium.com/@lowweihong?source=post_page---------------------------" rel="noopener"> Medium </a>上和他联系。</p></div></div>    
</body>
</html>