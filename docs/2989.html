<html>
<head>
<title>Introduction to GroupBy Methods</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">GroupBy方法简介</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/useful-groupby-methods-in-python-a3eeba7f3548?source=collection_archive---------3-----------------------#2022-07-26">https://pub.towardsai.net/useful-groupby-methods-in-python-a3eeba7f3548?source=collection_archive---------3-----------------------#2022-07-26</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5bb5" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用熊猫执行分组操作</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4e03c9dea09637eb8a17b0712b318250.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YaXehvT5mmCsXNcAP90Y6g.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">马库斯·斯皮斯克在<a class="ae ky" href="https://www.pexels.com/photo/one-black-chess-piece-separated-from-red-pawn-chess-pieces-1679618/" rel="noopener ugc nofollow" target="_blank">的照片</a></figcaption></figure><p id="30d3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在数据分析中，group by操作根据单个列或多个列中的值将数据行分成不同的组。这是生成聚合统计信息最常用的操作。组内统计很重要，因为它可以洞察不同组之间的差异。例如，假设我们有一家电话公司的客户保持数据。我们可以使用group by运算来比较数据中女性和男性的总数。我们甚至可以做更复杂的操作，比如计算有光纤服务的男性和被搅动(取消他们的服务)的男性的百分比。这些类型的类别和组级别的见解可以推动跨行业数据科学团队的决策。</p><p id="2d13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最常见的数据分析任务之一是生成类别级别的聚合统计数据。这包括类别级的计算，比如求和、均值、中值，甚至是使用lambda表达式的自定义静态函数。在本文中，我们的目标是讨论使用Pandas库的一些数据分析任务。具体来说，我们将使用Pandas groupBy方法来执行各种数据分析任务。在执行数据任务时，资源需求可能会因所执行的任务而有很大差异。</p><p id="21af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">为了确保最佳性能，我今天的工作将使用<a class="ae ky" href="https://saturncloud.io/?utm_source=Sadrach+Medium&amp;utm_medium=Intro+to+Groupby+Methods&amp;utm_campaign=Intro+to+Groupby+Methods" rel="noopener ugc nofollow" target="_blank">土星云</a>。在那里，我可以管理资源需求，并在可再生的开发环境中工作，这大大加快了像这样的数据分析任务。这里我们将讨论如何在Saturn云上创建一个python服务器，并在<a class="ae ky" href="https://www.kaggle.com/datasets/blastchar/telco-customer-churn" rel="noopener ugc nofollow" target="_blank">电信客户流失数据集</a>上执行分组操作。我们将了解生成汇总统计数据的操作，如总和、计数、平均值、中值、最大值和最小值。我们将通过例子演示如何使用这些内置的Pandas函数对单列和多列分组执行分组操作。<a class="ae ky" href="https://www.kaggle.com/datasets/blastchar/telco-customer-churn" rel="noopener ugc nofollow" target="_blank">电信客户流失数据集</a>在<a class="ae ky" href="https://www.apache.org/licenses/LICENSE-2.0" rel="noopener ugc nofollow" target="_blank">Apache 2.0 Li许可</a>下公开可用，并可免费使用、修改和共享。</p><p id="0773" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">设置环境</strong></p><p id="0c01" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们从创建一个新的python服务器开始:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/5fb2e6c09b052a0c32348269b5f8ddfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yUnrZ7og6DJ-miVq"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</figcaption></figure><p id="8d55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们把它命名为groupby_test。您还会看到一个选择CPU或GPU的选项。选择CPU，滚动到底部并单击创建:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/c039100624e20465f6277b860a1bfe96.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*IgCCzzV1dPfAo3_r"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</figcaption></figure><p id="461b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击create，您应该会看到Jupyter服务器的详细信息。单击“启动”启动服务器:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/87e26827c603b619f82ac64a06b20eb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*fmy42RPTPRVumkdF"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</figcaption></figure><p id="626d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">您应该看到以下内容:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/bb595dad12fe2ff67f60b33f3937fe44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I7euXv_ASX7IcBUU"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</figcaption></figure><p id="05df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">服务器启动后，您可以单击Jupyter Lab选项卡:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/d2faf6737f2227669118afb6b41446ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*B0OmMVJb9b51bRuj"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</figcaption></figure><p id="bfe4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从这里，启动土星Python3笔记本:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/c55179106dab426de0a3b711a51c07f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*J9f__46RT_J50GsB"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</figcaption></figure><p id="71a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">你应该看看Jupyter实验室的笔记本环境。接下来，单击“文件”选项卡，将笔记本保存为“groupby_tutorial”:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/cd26b0908e507a39053b63e4d2059cf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*zuHNG-2MUGn77Qf-"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</figcaption></figure><p id="1b9f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Jupiter实验室环境允许用户轻松地拖放文件。从<a class="ae ky" href="https://www.kaggle.com/datasets/blastchar/telco-customer-churn" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>下载telco_churn.csv文件后，将文件拖放到左侧:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lw"><img src="../Images/080ccb8402bf1fa406b4f94581d35106.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*5SzIuTcjl2NLvnFx"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</figcaption></figure><p id="76e3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们现在可以开始查看我们的数据了。让我们导入pandas库并将数据读入pandas数据框架:</p><p id="3111" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">进口熊猫作为pd</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="41a5" class="mc md it ly b gy me mf l mg mh">df = pd.read_csv("telco_churn.csv")</span></pre><p id="4dac" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">让我们显示前五行数据:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="b1f6" class="mc md it ly b gy me mf l mg mh">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/d5d2028083676c1f30ab47d478d91e36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Yz2Ab5TAeVPK12jq"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="6e06" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">单柱组采用内置熊猫方式</strong></p><p id="d672" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到数据包含客户信息，如任期，互联网服务的类型，总费用，每月费用，性别，以及客户是否搅拌。groupBy方法的一个简单应用是计算数据集中的男女人数。为此，我们将使用pandas value_counts方法:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="1252" class="mc md it ly b gy me mf l mg mh">df['gender'].value_counts()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mi"><img src="../Images/84d8fb9d6ebe73e3c0af9e12f7001098.png" data-original-src="https://miro.medium.com/v2/resize:fit:686/0*vNFckHS7jQZrOjy0"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="b878" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">现在，如果我们想要查看更复杂的分组，例如分析女性和男性的平均月费用，我们可以使用pandas groupBy方法:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="4047" class="mc md it ly b gy me mf l mg mh">df['MonthlyCharges'] = df['MonthlyCharges'].astype(float)</span><span id="c723" class="mc md it ly b gy mj mf l mg mh">df.groupby('gender')['MonthlyCharges'].mean()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mk"><img src="../Images/76d246932c8543e6632c2b7ac99fdf55.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/0*NF4qq_gNCZrJVQTk"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="fdf5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到女性平均每月支付65.2美元，男性支付64.3美元。</p><p id="67f1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用类似的方法也可以很容易地计算出其他统计数据。例如，女性和男性的月平均费用为:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="913b" class="mc md it ly b gy me mf l mg mh">df.groupby('gender')['MonthlyCharges'].median()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ml"><img src="../Images/9d880da35d0c3a2d4b16ac9ec59913fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:954/0*uK8Ac45PQLtTMaDv"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="2c5d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">同样，最低要求:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="9c14" class="mc md it ly b gy me mf l mg mh">df.groupby('gender')['MonthlyCharges'].min()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mm"><img src="../Images/ceb82d060f5319a6dc1deaeda1ecd21c.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/0*NSxmSomHJV01aNOL"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="0c29" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">最大值:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="3f97" class="mc md it ly b gy me mf l mg mh">df.groupby('gender')['MonthlyCharges'].max()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mn"><img src="../Images/35a24560fabecb5f3fc1326bc08d2d22.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/0*UnZDWrZMPlTWg_ED"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="74aa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们也可以对其他类别这样做。例如，我们可以看看老年公民和非老年公民的总数。值“0”对应于非老年人，“1”对应老年人:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="f2e0" class="mc md it ly b gy me mf l mg mh">df['SeniorCitizen'].value_counts()</span></pre><p id="2a27" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以看看老年人和非老年人的平均月费:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="7715" class="mc md it ly b gy me mf l mg mh">df['MonthlyCharges'] = df['MonthlyCharges'].astype(float)</span><span id="a373" class="mc md it ly b gy mj mf l mg mh">df.groupby('SeniorCitizen')['MonthlyCharges'].mean()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/2c67e0abbc8762fb73e62daed7631efb.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/0*ZWDs3VQr9LkDjTcy"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="1d91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到，老年人平均每月支付79美元，而非老年人平均每月支付61美元。</p><p id="2ab6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">使用内置熊猫方法进行多列分组</strong></p><p id="6416" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以看看流失的男女人数:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="d766" class="mc md it ly b gy me mf l mg mh">df.groupby(['Churn', 'gender'])['Churn'].count()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/966157b447f69806b635eee066f0faff.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/0*E_q_khmcnenWIxWA"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="5322" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到2549名女性没有搅动，而939名女性搅动了。此外，2625名男性没有搅动，而930名男性搅动。</p><p id="d7cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这种类型的信息可以帮助决策者根据消费者人口统计制定广告和促销计划。例如，如果一家公司知道某个特定群体最有可能取消他们的服务，他们就可以制定战略促销计划，通过交易来锁定这个群体，以防止这些客户流失。</p><p id="f8ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以看看老年人流失的数量:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="29dd" class="mc md it ly b gy me mf l mg mh">df.groupby(['Churn', 'SeniorCitizen'])['Churn'].count()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/34e706261d97751ed9e758dbdac0960f.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/0*LSbYKcqhLC_afMG9"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="8cf0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">除了老年公民身份和流失率，我们还可以按性别分组:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="483a" class="mc md it ly b gy me mf l mg mh">df.groupby(['Churn', 'SeniorCitizen', 'gender'])['Churn'].count()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/fe53b9058e2878d9fd7fedb588caed3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1030/0*-835VthjMauKrwI8"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="a15e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个groupBy的输出非常有洞察力，因为我们看到了客户流失是如何在老年人地位和性别之间分解的。我们看到，总的来说，非老年公民比老年公民流动得更频繁。</p><p id="c27e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">使用聚合方法分组:</strong></p><p id="ce13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通过使用groupBy和lambda表达式应用方法，数据科学家可以在任何组级别对数据执行复杂的操作。例如，我们可能想计算女性和男性每月费用总和的百分比。首先让我们计算费用的总和:</p><p id="43de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi">​​</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="10c9" class="mc md it ly b gy me mf l mg mh">sum_total = sum(df['tenure'] * df['MonthlyCharges'])</span></pre><p id="e9e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来，让我们按性别分组，并将lambda表达式传递给apply方法。lambda表达式将使用列“任期”和“每月费用”来计算男性和女性总费用的百分比:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="8646" class="mc md it ly b gy me mf l mg mh">df.groupby(['gender']).apply(lambda df,col1,col2: sum(df[col1] * df[col2])/ sum_total, 'tenure', 'MonthlyCharges')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/ea521859a528d6cfa62fabfbeea871f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/0*Svw_L_2UuQVZUshi"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="53dc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到，来自女性的月费用占总费用的49.5%，50.4%来自男性顾客。我们还可以根据老年公民身份和互联网服务类型进一步细分:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="cad2" class="mc md it ly b gy me mf l mg mh">sum_total = sum(df['tenure'] * df['MonthlyCharges'])</span><span id="b914" class="mc md it ly b gy mj mf l mg mh">df.groupby(['gender', 'SeniorCitizen', 'InternetService']).apply(lambda df,col1,col2: sum(df[col1] * df[col2])/ sum_total, 'tenure', 'MonthlyCharges')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/579c4148d79092eea2a5326e1afee5e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1258/0*acAtL2vUw2Flvso2"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="6943" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">从这些结果中我们看到，每月总费用的45%来自拥有光纤的非老年男女用户。这是一个有用的见解，因为它表明几乎一半的收入来自使用光纤的非老年人。公司可以利用这些信息有策略地锁定这些客户群体，以增加收入。</p><p id="88f6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们可以对客户流失做类似的事情。让我们来看看按性别划分的流失率:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="84a3" class="mc md it ly b gy me mf l mg mh">churn_total = df['Churn'].value_counts()</span><span id="f5e8" class="mc md it ly b gy mj mf l mg mh">df.groupby(['gender']).apply(lambda df,col1 : df[col1].value_counts()/churn_total, 'Churn’)</span></pre><p id="44ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以按性别来看流失率:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="8ed4" class="mc md it ly b gy me mf l mg mh">churn_total = df['Churn'].value_counts()</span><span id="3acf" class="mc md it ly b gy mj mf l mg mh">df.groupby(['gender']).apply(lambda df,col1 : df[col1].value_counts()/churn_total, 'Churn')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/d4ceed6f3863ad07f5c108a005c6f358.png" data-original-src="https://miro.medium.com/v2/resize:fit:836/0*-afAo8kaAD6xKrif"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="b387" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们看到女性占所有搅拌者的50.2%，而男性占49.8%。</p><p id="7281" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们还可以根据互联网服务类型、性别和老年公民身份来查看流失率:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="7f2e" class="mc md it ly b gy me mf l mg mh">df.groupby(['gender', 'SeniorCitizen', 'InternetService']).apply(lambda df,col1 : df[col1].value_counts()/churn_total, 'Churn')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi mv"><img src="../Images/4e8fee383abf893d455e3e3e53e4e9c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jYuTf0HdjK8ab55-"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="a5ee" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这里我们看到使用光纤的女性占所有搅拌器的24.8%，而使用光纤的男性占所有搅拌器的23.5%。</p><p id="2435" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">土星云中的资源食谱</strong></p><p id="503b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">通常，我们希望能够存储关于所使用的资源及其配置细节的信息。Saturn cloud使用户能够保存资源配方，以便资源配置是可复制的。要下载与我们一直在使用的笔记本对应的资源配置文件，我们首先导航到资源页面并向下滚动到我们的groupby_test Jupyter服务器:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/3a68cd5fbd35ae173b38a19e231776b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nrPYIDydqTHKz97G"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</figcaption></figure><p id="aa7b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">然后，我们单击“管理”选项卡:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/31a9048628248b49a870f2da6b0ba62e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*648zyXVngLjCqvCD"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</figcaption></figure><p id="6db3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们点击下载食谱。然后，我们应该会收到一个名为groupby_tesst-Jupyter-recipe的文件:</p><pre class="kj kk kl km gt lx ly lz ma aw mb bi"><span id="d3d9" class="mc md it ly b gy me mf l mg mh">{</span><span id="be18" class="mc md it ly b gy mj mf l mg mh">"name": "groupby_test",</span><span id="abac" class="mc md it ly b gy mj mf l mg mh">"image_uri": "public.ecr.aws/saturncloud/saturn:2022.04.01",</span><span id="5533" class="mc md it ly b gy mj mf l mg mh">"description": "",</span><span id="7bfc" class="mc md it ly b gy mj mf l mg mh">"environment_variables": {},</span><span id="a24f" class="mc md it ly b gy mj mf l mg mh">"working_directory": "/home/jovyan/workspace",</span><span id="f511" class="mc md it ly b gy mj mf l mg mh">"start_script": "",</span><span id="dc32" class="mc md it ly b gy mj mf l mg mh">"git_repositories": [],</span><span id="0961" class="mc md it ly b gy mj mf l mg mh">"secrets": [],</span><span id="7d92" class="mc md it ly b gy mj mf l mg mh">"jupyter_server": {</span><span id="491d" class="mc md it ly b gy mj mf l mg mh">"instance_type": "2xlarge",</span><span id="695e" class="mc md it ly b gy mj mf l mg mh">"disk_space": "10Gi",</span><span id="c74f" class="mc md it ly b gy mj mf l mg mh">"auto_shutoff": "1 hour",</span><span id="2ece" class="mc md it ly b gy mj mf l mg mh">"start_ssh": false,</span><span id="0050" class="mc md it ly b gy mj mf l mg mh">"use_spot_instance": false</span><span id="ce11" class="mc md it ly b gy mj mf l mg mh">},</span><span id="c8e7" class="mc md it ly b gy mj mf l mg mh">"owner": "spierre91",</span><span id="d7b4" class="mc md it ly b gy mj mf l mg mh">"visibility": "owner",</span><span id="d27d" class="mc md it ly b gy mj mf l mg mh">"schema_version": "2022.05.01"</span><span id="b7f8" class="mc md it ly b gy mj mf l mg mh">}</span></pre><p id="9494" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">要使用我们的配方配置文件重现环境，请导航回参考资料并创建一个新的服务器:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/e86325f1da378f71c9ca8238143fff51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kFNsNPjdnMWZvURJ"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者截图</figcaption></figure><p id="8229" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">单击recipe并上传JSON配置文件。从那里，您可以使用我们一直在使用的相同配置来命名和创建您的服务器。如果您想要再现使用大量内存的资源密集型脚本的输出，这是一个特别有用的特性。通过能够共享资源配方，数据科学团队可以防止在使用Saturn云平台时由于资源不足而导致的再现性问题。</p><p id="95c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这篇文章中使用的代码可以在<a class="ae ky" href="https://github.com/spierre91/saturn_cloud_notebooks/blob/main/groupby_tutorial.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。</p><p id="3147" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">结论</strong></p><p id="72ab" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">使用Pandas的GroupBy操作使数据科学家和分析师能够计算类别级别的统计数据。使用Pandas groupBy方法生成类别级别、单列和聚合统计信息，可以提供对数据和数据中的组的有用见解。此外，多列分类聚合统计允许对组差异进行更复杂的洞察。Lambda表达式允许您执行更复杂的组级计算。拥有一种可靠的方法来生成和分析这些统计数据，对于任何数据科学团队来说都是一种无价的技能。</p><p id="9a69" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在这里，你可以随意查看土星云<a class="ae ky" href="https://saturncloud.io/?utm_source=Sadrach+Medium&amp;utm_medium=Intro+to+Groupby+Methods&amp;utm_campaign=Intro+to+Groupby+Methods" rel="noopener ugc nofollow" target="_blank">。您可以跨编程语言、ide和硬件灵活地使用Jupyter Lab笔记本和PyCharm connections或RStudio，使用您熟悉的工具和环境。Saturn Cloud还使用户能够为他们的数据任务选择合适的硬件，如CPU和GPU。此外，Saturn Cloud recipes功能允许数据科学家、机器学习工程师和数据分析师轻松共享任何数据任务的资源配置细节。</a></p></div></div>    
</body>
</html>