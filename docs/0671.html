<html>
<head>
<title>Handle Missing Data in Pyspark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">处理Pyspark中缺失的数据</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/handle-missing-data-in-pyspark-3b5693fb04a4?source=collection_archive---------0-----------------------#2020-07-12">https://pub.towardsai.net/handle-missing-data-in-pyspark-3b5693fb04a4?source=collection_archive---------0-----------------------#2020-07-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="3e7b" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a>，<a class="ae ep" href="https://towardsai.net/p/category/programming/python" rel="noopener ugc nofollow" target="_blank"> Python </a></h2><div class=""/><p id="13b2" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">本文的目标是理解处理数据集中缺失值或空值的各种方法。空值意味着未知或缺失或不相关的值，但对于机器学习或数据科学方面，有效地处理空值变得至关重要，原因是ML工程师不能缺少数据集。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi ku"><img src="../Images/f0b4d79432a7dc056e2f92cec16b880f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1198/format:webp/1*96h3mExAr35J8qnHD0zWww.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">无效的</figcaption></figure><p id="d8f5" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">让我们看看处理Spark数据帧中缺失数据或空值的各种方法。</p><h2 id="99b1" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> Pyspark连接和应用创建</strong></h2><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="2ac0" class="lg lh iq lz b gy md me l mf mg">import pyspark<br/>from pyspark.sql import SparkSession<br/>spark= SparkSession.builder.appName(‘NULL_Handling’).getOrCreate()<br/>print(‘NULL_Handling’)</span></pre><h2 id="c860" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> 2。导入数据集</strong></h2><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="22b5" class="lg lh iq lz b gy md me l mf mg">null_df=spark.read.csv(r’D:\python_coding\pyspark_tutorial\Nulls.csv’,header=True,inferSchema=True)<br/>null_df.show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mh"><img src="../Images/433aa633a76ee118b79b35212f070e5c.png" data-original-src="https://miro.medium.com/v2/resize:fit:440/format:webp/1*q1chwJzuos8TL7UuQIFt6g.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">资料组</figcaption></figure><h2 id="cc41" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> 3。删除空值</strong></h2><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="1ac5" class="lg lh iq lz b gy md me l mf mg">#na func to drop rows with null values<br/>#rows having atleast a null value is dropped</span><span id="1a97" class="lg lh iq lz b gy mi me l mf mg">null_df.na.drop().show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="mk ml di mm bf mn"><div class="gh gi mj"><img src="../Images/3eb264629311f8dc46996e37bc57bd98.png" data-original-src="https://miro.medium.com/v2/resize:fit:442/format:webp/1*BqBDuhLSqUfJQ72uaF1ZWQ.png"/></div></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">删除空值</figcaption></figure><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="ab7f" class="lg lh iq lz b gy md me l mf mg">#rows having nulls greater than 2 are dropped</span><span id="c319" class="lg lh iq lz b gy mi me l mf mg">null_df.na.drop(thresh=2).show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mo"><img src="../Images/1c157263aa5ac9264d9bb44efce5bc99.png" data-original-src="https://miro.medium.com/v2/resize:fit:454/format:webp/1*K6qc6SZpcs2gl5Sftw-Etw.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">删除空值</figcaption></figure><h2 id="79a8" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> 4。</strong> <strong class="ak">使用“如何”参数删除空值</strong></h2><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="0a8b" class="lg lh iq lz b gy md me l mf mg">#drop rows having nulls using how parameter<br/>#records having atleast a null wull be dropped</span><span id="cd19" class="lg lh iq lz b gy mi me l mf mg">null_df.na.drop(how=’any’).show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mp"><img src="../Images/01bbb9556a94a71bf5d9fdcd0f7ba643.png" data-original-src="https://miro.medium.com/v2/resize:fit:380/format:webp/1*kg6pk31VnKK8wF9M-3iBZQ.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">任何的</figcaption></figure><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="60d6" class="lg lh iq lz b gy md me l mf mg">#record having all nulls will be dropped</span><span id="195e" class="lg lh iq lz b gy mi me l mf mg">null_df.na.drop(how=’all’).show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/a12fd9ce556ceb8fe60a492b5e4f2b2b.png" data-original-src="https://miro.medium.com/v2/resize:fit:410/format:webp/1*tqyoguxdCUrm0f26yYD62w.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">全部</figcaption></figure><h2 id="bef9" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> 5。删除列的空值基础</strong></h2><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="9dd5" class="lg lh iq lz b gy md me l mf mg">#dropping null values on basis of a column<br/>null_df.na.drop(subset=[‘Sales’]).show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/e46ce4eaa0bbdb3de56c5f41d66b1b4c.png" data-original-src="https://miro.medium.com/v2/resize:fit:344/format:webp/1*PI9vRuBcy8jMhaROgxYBpg.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">子集</figcaption></figure><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="16ff" class="lg lh iq lz b gy md me l mf mg">#records having both Name and Sales as Nulls are dropped</span><span id="87e5" class="lg lh iq lz b gy mi me l mf mg">null_df.na.drop(how=’all’,subset=[‘Name’,’Sales’]).show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/878b44f9642cff68282529c40cda5064.png" data-original-src="https://miro.medium.com/v2/resize:fit:352/format:webp/1*Dlk8f8e5ZKTaYB3TD87RvQ.png"/></div></figure><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="ffa3" class="lg lh iq lz b gy md me l mf mg">#records having both Name and Sales as Nulls are dropped</span><span id="5fad" class="lg lh iq lz b gy mi me l mf mg">null_df.na.drop(how=’any’,subset=[‘Name’,’Sales’]).show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/818bd58dd138d473f69abca1b0280990.png" data-original-src="https://miro.medium.com/v2/resize:fit:344/format:webp/1*sPAIaXFn6P74u7xAD5yNBA.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">任何子集</figcaption></figure><h2 id="e644" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> 6。填充空值</strong></h2><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="0493" class="lg lh iq lz b gy md me l mf mg">#filling null values into dataset<br/>#spark automatically detects if a column is string or numeric<br/>null_df.na.fill(‘NA’).show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/8ad9690ca5e1b36283d337245c09a557.png" data-original-src="https://miro.medium.com/v2/resize:fit:386/format:webp/1*YsNYZJUeaFFFme5LI0yuYQ.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">填充NA</figcaption></figure><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="7029" class="lg lh iq lz b gy md me l mf mg">#fill integer value column<br/>null_df.na.fill(0).show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/245f335776ab1e61c03d5141ee4c74c5.png" data-original-src="https://miro.medium.com/v2/resize:fit:394/format:webp/1*30BDh-geavbIE_5O2pXDZw.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">填充0</figcaption></figure><h2 id="250f" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> 7。根据列</strong>填充空值</h2><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="8dd4" class="lg lh iq lz b gy md me l mf mg">#filling on basis of column name</span><span id="a4d9" class="lg lh iq lz b gy mi me l mf mg">null_df.na.fill(‘Name Missing’,subset=[‘Name’]).show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/ce12e7b9581bb58eefc2bb2007b373fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:444/format:webp/1*PeMeHKqSk9p0EdhIGc5dvA.png"/></div><figcaption class="lc ld gj gh gi le lf bd b be z dk translated">姓名缺失</figcaption></figure><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="f6ea" class="lg lh iq lz b gy md me l mf mg">#filling multiple column values basis of datatypes</span><span id="179d" class="lg lh iq lz b gy mi me l mf mg">null_df.na.fill({‘Name’: ‘Missing Name’, ‘Sales’: 0}).show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/ec4841f6ed424a4e182aeae5946c6fc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:464/format:webp/1*amLMYMKS_fJdgID3m20tJQ.png"/></div></figure><h2 id="b25b" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated">8。用另一个列值填充空列</h2><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="f5a4" class="lg lh iq lz b gy md me l mf mg">#fill null values in Name column with Id value</span><span id="ae4d" class="lg lh iq lz b gy mi me l mf mg">from pyspark.sql.functions import when</span><span id="6ebc" class="lg lh iq lz b gy mi me l mf mg">name_fill_df=null_df.select('ID','Name',<br/>                            when( null_df.Name.isNull(), null_df.Id).otherwise(null_df.Name).alias('Name_Filled'),'Sales')</span><span id="9bcb" class="lg lh iq lz b gy mi me l mf mg">name_fill_df.show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mq"><img src="../Images/2fc1045534f1efdee7673ea4ec4497d1.png" data-original-src="https://miro.medium.com/v2/resize:fit:410/format:webp/1*odQWt7hk31WfuzlLhzsWaQ.png"/></div></figure><h2 id="f89a" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated">9。用平均值填充空值</h2><pre class="kv kw kx ky gt ly lz ma mb aw mc bi"><span id="2d8e" class="lg lh iq lz b gy md me l mf mg">#filling numeric column values with the mean or average value of that particular column</span><span id="12ef" class="lg lh iq lz b gy mi me l mf mg">from pyspark.sql.functions import mean<br/>mean_val=null_df.select(mean(null_df.Sales)).collect()</span><span id="1627" class="lg lh iq lz b gy mi me l mf mg">print(type(mean_val)) #mean_val is a list row object</span><span id="e4f7" class="lg lh iq lz b gy mi me l mf mg">print('mean value of Sales', mean_val[0][0])<br/>mean_sales=mean_val[0][0]</span><span id="fe69" class="lg lh iq lz b gy mi me l mf mg">#now using men_sales value to fill the nulls in sales column<br/>null_df.na.fill(mean_sales,subset=['Sales']).show()</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/445c7ce90b2d5e82a3aa6771dc4d7553.png" data-original-src="https://miro.medium.com/v2/resize:fit:652/format:webp/1*IRqLRzLQ1IE4X7_szyjaPw.png"/></div></figure><h1 id="9727" class="my lh iq bd li mz na nb ll nc nd ne lo nf ng nh lr ni nj nk lu nl nm nn lx no bi translated">总结:</h1><p id="6208" class="pw-post-body-paragraph jw jx iq jy b jz np kb kc kd nq kf kg kh nr kj kk kl ns kn ko kp nt kr ks kt ij bi translated">删除空值</p><p id="ec67" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">使用参数How删除空值</p><p id="8d91" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">用参数子集删除空值</p><p id="77cf" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">填充空值</p><p id="de8b" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">用另一列值或平均值填充空列</p><p id="d9d6" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">万岁，这里我们已经讨论了几种处理Spark数据框中的空值的方法。</p></div></div>    
</body>
</html>