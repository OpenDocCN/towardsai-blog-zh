<html>
<head>
<title>Deploy a Python Machine Learning Model on your iPhone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在你的iPhone上部署一个Python机器学习模型</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/deploy-a-python-machine-learning-model-on-your-iphone-d006b1e04bc4?source=collection_archive---------1-----------------------#2021-02-11">https://pub.towardsai.net/deploy-a-python-machine-learning-model-on-your-iphone-d006b1e04bc4?source=collection_archive---------1-----------------------#2021-02-11</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="46ae" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a>、<a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="6c24" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">简约指南</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/3acec034f6903dc901eb1973be873be2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*He_DVTn2N7_-p2ZPVmpNwA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/s/photos/machine-learning-iphone?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae le" href="https://unsplash.com/@altumcode?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> AltumCode </a>拍摄的照片</figcaption></figure><p id="3c52" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">本文描述了从训练python机器学习模型到可以在iPhone上部署的概念验证iOS应用程序的最短路径。我们的目标是提供基本的搭建，同时为适合特定用例的进一步定制留出空间。本着简单的精神，我们将忽略一些任务，比如模型验证和构建一个完美的用户界面(UI)。本教程结束时，您将拥有一个在iOS上运行的经过训练的模型，您可以将其作为原型展示并加载到您的设备上。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="fe8b" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lo mr ms mt ls mu mv mw lw mx my mz iw bi translated"><strong class="ak">第一步。设置您的环境</strong></h2><p id="2ff3" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">首先，让我们创建一个名为<code class="fe nf ng nh ni b">.core_ml_demo</code>的python虚拟环境，然后安装必要的库，即<code class="fe nf ng nh ni b">pandas</code> <code class="fe nf ng nh ni b">scikit-learn </code>和<code class="fe nf ng nh ni b">coremltools</code>。从您的终端运行:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">创建python虚拟环境</figcaption></figure><p id="5a90" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">接下来我们将安装<strong class="lh ja"> Xcode </strong>。Xcode是苹果产品的开发工具包。注意Xcode相当大(&gt; 10 Gb)。我建议你喝杯咖啡或者通宵运行你的安装程序。- <em class="nl">注意，本指南在macOS Catalina 10.15.5上使用Xcode版本12.3 (12C33)。</em></p><div class="nm nn gp gr no np"><a href="https://apps.apple.com/us/app/xcode/id497799835?mt=12" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ja gy z fp nu fr fs nv fu fw iz bi translated">Xcode</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">Xcode包括开发人员为Mac、iPhone、iPad、Apple TV和Apple创建优秀应用程序所需的一切</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">apps . apple . com训练模型</p></div></div><div class="ny l"><div class="nz l oa ob oc ny od ky np"/></div></div></a></div></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="1ee0" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lo mr ms mt ls mu mv mw lw mx my mz iw bi translated"><strong class="ak">第二步。训练一个模型</strong></h2><p id="52b3" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">我们将使用scikit-learn的波士顿房价<a class="ae le" href="https://scikit-learn.org/stable/modules/generated/sklearn.datasets.load_boston.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lh ja">玩具数据集</strong> </a> <strong class="lh ja"> </strong>来训练一个线性回归模型，以根据房产和社会经济属性来预测房价。因为我们的目标是简单，我们将特征空间限制为3个预测值，并使用房价作为我们的目标变量。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">为概念验证训练一个基本的python模型</figcaption></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="f7d4" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lo mr ms mt ls mu mv mw lw mx my mz iw bi translated"><strong class="ak">第三步。将模型转换为核心ML </strong></h2><p id="8674" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">苹果提供了两种为iOS开发模型的途径。第一个是<a class="ae le" href="https://developer.apple.com/documentation/createml" rel="noopener ugc nofollow" target="_blank"> Create ML </a>，允许人们完全在苹果生态系统内生产模型。第二个是<a class="ae le" href="https://coremltools.readme.io/" rel="noopener ugc nofollow" target="_blank"> Core ML </a>，允许用户将第三方的模型转换成Core ML格式，集成到苹果平台上。由于我们对在iOS上运行python训练的模型感兴趣，我们将使用后者。</p><p id="ddd7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在导入Xcode之前，我们将使用python的<code class="fe nf ng nh ni b">coremltools</code>包将我们的sklearn模型转换为核心ML格式(<code class="fe nf ng nh ni b">.mlmodel</code>)。<code class="fe nf ng nh ni b">coremltools </code>允许用户向模型对象分配元数据，如作者信息、模型特征和结果描述。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">将训练好的python模型保存到。coreml格式</figcaption></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="1aef" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lo mr ms mt ls mu mv mw lw mx my mz iw bi translated"><strong class="ak">第四步。开始一个新的Xcode项目</strong></h2><p id="f88e" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">这就是python的全部内容。从此，我们可以只用Xcode和Swift完成一个原型app。这可以通过下面的设置来完成。</p><ul class=""><li id="9bc5" class="oe of iq lh b li lj ll lm lo og ls oh lw oi ma oj ok ol om bi translated">打开Xcode并创建一个新的Xcode项目</li><li id="fc88" class="oe of iq lh b li on ll oo lo op ls oq lw or ma oj ok ol om bi translated">选择“iOS”作为多平台类型</li><li id="5c3c" class="oe of iq lh b li on ll oo lo op ls oq lw or ma oj ok ol om bi translated">选择“App”作为应用程序类型</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi os"><img src="../Images/d117d745235f6ca0c3bddecd9cd49100.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R8NKTxvgvgeoB6Udl8ntdA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">为iOS创建新的Xcode项目</figcaption></figure><ul class=""><li id="39ac" class="oe of iq lh b li lj ll lm lo og ls oh lw oi ma oj ok ol om bi translated">接下来，命名您的项目并选择“SwiftUI”界面。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ot"><img src="../Images/e55c3f0e3e89e52a508043a62bb2360a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P-Arib4hFQlZpeNfckjtWQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">命名您的Xcode项目</figcaption></figure><ul class=""><li id="4815" class="oe of iq lh b li lj ll lm lo og ls oh lw oi ma oj ok ol om bi translated">现在只需将<code class="fe nf ng nh ni b">.mlmodel</code>文件(保存在上面的步骤3中)拖放到Xcode目录中。Xcode会自动为您的模型生成一个Swift类，如下图编辑器所示。如果您检查您的模型类，您会注意到它包含了我们在使用<code class="fe nf ng nh ni b">coremltools</code>保存python模型时输入的细节，比如特征和目标字段描述。这对于模型管理来说很方便。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ou"><img src="../Images/e0ff22a402ae43701ca1a46ca9e506c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3TZ7YlQbneqH_vr209hMWQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">正在导入您的。coreml文件到您的Xcode项目中</figcaption></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="1fc2" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lo mr ms mt ls mu mv mw lw mx my mz iw bi translated"><strong class="ak">第五步。构建模型用户界面</strong></h2><p id="1c8f" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">接下来，我们将通过修改Xcode项目中的<code class="fe nf ng nh ni b">ContentView.swift</code>文件来构建一个基本的UI。下面的Swift代码设置了一个UI，允许用户调整房屋属性，然后预测房价。这里我们可以回顾几个要素。</p><p id="5669" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><code class="fe nf ng nh ni b">NavigationView</code>包含了我们的基本UI。它包括:</p><ul class=""><li id="8a72" class="oe of iq lh b li lj ll lm lo og ls oh lw oi ma oj ok ol om bi translated"><code class="fe nf ng nh ni b"><a class="ae le" href="https://developer.apple.com/documentation/swiftui/stepper" rel="noopener ugc nofollow" target="_blank">Stepper</a></code>结构(<em class="nl">第19–30行</em>)，用于我们的三个特性中的每一个，使用户能够修改特性值。步进器基本上是修改我们房子属性变量的<code class="fe nf ng nh ni b"><a class="ae le" href="https://developer.apple.com/documentation/swiftui/state" rel="noopener ugc nofollow" target="_blank">@State</a></code>(第6–8行)的小部件。</li><li id="c228" class="oe of iq lh b li on ll oo lo op ls oq lw or ma oj ok ol om bi translated">导航栏上的<code class="fe nf ng nh ni b"><a class="ae le" href="https://www.simpleswiftguide.com/how-to-add-button-to-navigation-bar-in-swiftui/" rel="noopener ugc nofollow" target="_blank">Button</a></code>(<em class="nl">第31–40行</em>)从<code class="fe nf ng nh ni b">predictPrice</code>功能(<em class="nl">第46行</em>)中调用我们的模型。这就在屏幕上产生了一条<code class="fe nf ng nh ni b"><a class="ae le" href="https://www.hackingwithswift.com/quick-start/swiftui/how-to-show-an-alert" rel="noopener ugc nofollow" target="_blank">Alert</a></code>消息，显示预测价格。</li></ul><p id="2c70" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在<code class="fe nf ng nh ni b">NavigationView</code>之外，我们有自己的<code class="fe nf ng nh ni b">predictPrice</code>函数(<em class="nl">第46–62行</em>)。<code class="fe nf ng nh ni b">predictPrice</code>函数实例化我们的Swift核心ML模型类，并根据存储在我们的特征状态中的值生成预测。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nj nk l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">如上修改ContentView.swift</figcaption></figure><p id="3346" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">最后是有趣的部分。我们可以在Xcode中构建并运行我们的应用程序的<a class="ae le" href="https://developer.apple.com/documentation/xcode/running_your_app_in_the_simulator_or_on_a_device" rel="noopener ugc nofollow" target="_blank"> <strong class="lh ja">模拟</strong> </a>来查看我们的模型的运行情况。在下面的例子中，我用iPhone 12创建了一个模拟。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ov"><img src="../Images/45cc4cdffc1e784ac7bf99e4f1f5a97f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*gHl_seOHITgT4hv2vdV5fg.gif"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">模拟您的模型在iOS上运行</figcaption></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="d0a4" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lo mr ms mt ls mu mv mw lw mx my mz iw bi translated"><strong class="ak">结论</strong></h2><p id="565e" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">就是这样！我们最初的原型已经完成。还有很多工作要做，例如模型验证，测试以确认导入iOS后的预期性能，以及更时尚/更友好的用户界面。尽管如此，我希望这能为您的移动机器学习部署工作提供有用的参考。</p><p id="c936" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">新的和改进的工具继续使移动追求更广泛地为数据科学社区所接受，并且在移动空间中有许多创造性的机会等待被要求。由于移动技术本质上是多媒体，它提供了丰富的数据类型(例如音频、视频、移动和位置)以及独特的使用点应用程序，以扩展个人的数据科学工具包。</p><p id="ae76" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一如既往，我欢迎任何反馈或建议。</p><p id="56d6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">感谢阅读！</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="d893" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lo mr ms mt ls mu mv mw lw mx my mz iw bi translated">资源</h2><p id="234f" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">CoreML </p><div class="nm nn gp gr no np"><a href="https://developer.apple.com/machine-learning/models/" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ja gy z fp nu fr fs nv fu fw iz bi translated">模型——机器学习——苹果开发者</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">使用来自为Core ML设计的研究社区的机器学习模型，将智能构建到您的应用中。</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">developer.apple.com</p></div></div><div class="ny l"><div class="ow l oa ob oc ny od ky np"/></div></div></a></div><div class="nm nn gp gr no np"><a href="https://coremltools.readme.io/docs/introductory-quickstart" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ja gy z fp nu fr fs nv fu fw iz bi translated">快速入门示例</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">核心ML工具可以将来自其他框架的训练模型转换成核心ML模型的内存表示。…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">coremltools.readme.io</p></div></div><div class="ny l"><div class="ox l oa ob oc ny od ky np"/></div></div></a></div><p id="aebd" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><em class="nl"> iOS部署</em></p><div class="nm nn gp gr no np"><a href="https://developer.apple.com/documentation/xcode/distributing_your_app_to_registered_devices" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ja gy z fp nu fr fs nv fu fw iz bi translated">Apple开发者文档</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">在设备上部署您的应用</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">developer.apple.com</p></div></div></div></a></div><p id="a6f6" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><em class="nl"> SwiftUI </em></p><div class="nm nn gp gr no np"><a href="https://www.hackingwithswift.com/quick-start/swiftui" rel="noopener  ugc nofollow" target="_blank"><div class="nq ab fo"><div class="nr ab ns cl cj nt"><h2 class="bd ja gy z fp nu fr fs nv fu fw iz bi translated">SwiftUI示例</h2><div class="nw l"><h3 class="bd b gy z fp nu fr fs nv fu fw dk translated">SwiftUI by Example是世界上最大的SwiftUI示例、技巧和技术的集合，有400多页…</h3></div><div class="nx l"><p class="bd b dl z fp nu fr fs nv fu fw dk translated">www.hackingwithswift.co</p></div></div><div class="ny l"><div class="oy l oa ob oc ny od ky np"/></div></div></a></div></div></div>    
</body>
</html>