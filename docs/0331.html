<html>
<head>
<title>How to Get Profits in Grape Farming Using YoloV3</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何利用YoloV3在葡萄种植中获利</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-to-get-profits-in-grape-farming-using-yolov3-70d366387e60?source=collection_archive---------3-----------------------#2020-02-24">https://pub.towardsai.net/how-to-get-profits-in-grape-farming-using-yolov3-70d366387e60?source=collection_archive---------3-----------------------#2020-02-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="ae64" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">使用Monk，低代码深度学习工具和计算机视觉的统一包装器，使计算机视觉变得简单。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi kf"><img src="../Images/51b45e402917a1af3e151e91addc1bdd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/1*ks9kWMp58wQ3Z5oqKREA6Q.gif"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">葡萄检测</figcaption></figure></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><h1 id="d39f" class="ky kz iq bd la lb lc ld le lf lg lh li jw lj jx lk jz ll ka lm kc ln kd lo lp bi translated">YoloV3训练秘密</h1><p id="c402" class="pw-post-body-paragraph lq lr iq ls b lt lu jr lv lw lx ju ly lz ma mb mc md me mf mg mh mi mj mk ml ij bi translated">好了，你已经决定了作物(自定义对象，在我们的例子中是葡萄)，现在你需要使用YoloV3来培养(训练)它。这是一个简单的“即时赚钱”任务，就像运行一些类似其他流行的python机器学习库的<code class="fe mm mn mo mp b">fit()</code>和<code class="fe mm mn mo mp b">eval()</code>方法的变体(例如<em class="mq"> Scikit Learn </em>、<em class="mq"> Keras </em>)。</p><p id="b94b" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">我们先看一下大图，然后放大每一步。让我们后退一步，看看一个典型的ML过程可能是什么样子。事情是这样的</p><ol class=""><li id="ef41" class="mw mx iq ls b lt mr lw ms lz my md mz mh na ml nb nc nd ne bi translated">加载和预处理数据</li><li id="7309" class="mw mx iq ls b lt nf lw ng lz nh md ni mh nj ml nb nc nd ne bi translated">定义模型，优化器</li><li id="e2f9" class="mw mx iq ls b lt nf lw ng lz nh md ni mh nj ml nb nc nd ne bi translated">训练模型</li><li id="51c9" class="mw mx iq ls b lt nf lw ng lz nh md ni mh nj ml nb nc nd ne bi translated">推断模型</li></ol><h1 id="9126" class="ky kz iq bd la lb nk ld le lf nl lh li jw nm jx lk jz nn ka lm kc no kd lo lp bi translated">1.加载和预处理数据</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi np"><img src="../Images/03a7bb8c3d6a27850cbbbe7030925772.png" data-original-src="https://miro.medium.com/v2/resize:fit:864/format:webp/1*jkQJHQuQ7u6R-kOfDmY-aQ.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">参考:<a class="ae nq" href="https://www.google.com/search?q=watering+grape+plants&amp;rlz=1C1GCEA_enIN887IN887&amp;source=lnms&amp;tbm=isch&amp;sa=X&amp;ved=2ahUKEwj72uKFwOnnAhUWyzgGHcj6DdkQ_AUoAnoECBEQBA&amp;biw=1366&amp;bih=608#imgrc=49fUBCE6gtyVNM" rel="noopener ugc nofollow" target="_blank">谷歌图片</a></figcaption></figure><p id="0c46" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">这里我们使用的是<a class="ae nq" href="https://github.com/thsant/wgisd" rel="noopener ugc nofollow" target="_blank"> Grapes </a>数据集。</p><pre class="kg kh ki kj gt nr mp ns nt aw nu bi"><span id="f72d" class="nv kz iq mp b gy nw nx l ny nz">!git clone <a class="ae nq" href="https://github.com/thsant/wgisd" rel="noopener ugc nofollow" target="_blank">https://github.com/thsant/wgisd</a><br/>!mkdir wgisd/data/labels<br/>!mkdir wgisd/data/images</span><span id="3084" class="nv kz iq mp b gy oa nx l ny nz">f = open("wgisd/data/classes.txt", 'w')<br/>f.write("Grapes<strong class="mp ir">\n</strong>")<br/>f.close()</span></pre><p id="e648" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated"><strong class="ls ir">所需的YOLO格式</strong></p><pre class="kg kh ki kj gt nr mp ns nt aw nu bi"><span id="19a7" class="nv kz iq mp b gy nw nx l ny nz">wgisd/data (root)       <br/>|       <br/>|-------------images (img_dir)       <br/>|              |       <br/>|              |------------------img1.jpg       <br/>|              |------------------img2.jpg       <br/>|              |------------------.........(and so on)       <br/>|       <br/>|-----------labels (label_dir)       <br/>|              |       <br/>|              |------------------img1.txt       <br/>|              |------------------img2.txt       <br/>|              |------------------.........(and so on)       |       |------------classes.txt</span></pre><p id="9b6f" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated"><strong class="ls ir">类文件</strong></p><p id="e481" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">每个新行中的类列表。该顺序对应于注释文件中的id。</p><p id="803a" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">例如。</p><p id="a31e" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">类别1(—————→将为0)</p><p id="a114" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">类别2(—————→将为1)</p><p id="21ab" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">第三类(— — — — — →将是第二类)</p><p id="74bd" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">第四类(— — — — →将是第三类)</p><p id="a27e" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated"><strong class="ls ir">注释文件格式</strong></p><ul class=""><li id="b000" class="mw mx iq ls b lt mr lw ms lz my md mz mh na ml ob nc nd ne bi translated">所有的坐标都应该归一化。</li><li id="7717" class="mw mx iq ls b lt nf lw ng lz nh md ni mh nj ml ob nc nd ne bi translated">x坐标除以图像的宽度，Y坐标除以图像的高度。</li></ul><p id="6d8f" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">《出埃及记》(图像中检测到的对象的每个边界框一行)</p><p id="b6cd" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">CLASS _ ID-BOX _ X _ CENTER-BOX _ Y _ CENTER WIDTH-BOX _ WIDTH-BOX _ HEIGHT</p><p id="d30c" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">class_id- x1 -y1- w1- h1</p><p id="65bf" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">class_id -x2- y2- w2- h2…..(以此类推)</p><p id="a316" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated"><strong class="ls ir">加载数据集</strong></p><pre class="kg kh ki kj gt nr mp ns nt aw nu bi"><span id="bab0" class="nv kz iq mp b gy nw nx l ny nz">gtf = Detector()<br/>gtf.set_train_dataset(img_dir, label_dir, class_list_file, batch_size=2)<br/>gtf.set_val_dataset(img_dir, label_dir)</span></pre><h1 id="5a9e" class="ky kz iq bd la lb nk ld le lf nl lh li jw nm jx lk jz nn ka lm kc no kd lo lp bi translated">2.定义模型，优化器</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oc"><img src="../Images/5a11b3e5bf8ef2bf6fda99af72b5e168.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kvt52koHp_qXw3Xyj0i_3w.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">参考:<a class="ae nq" href="https://learn.winecoolerdirect.com/life-cycle-of-a-wine-grape/" rel="noopener ugc nofollow" target="_blank">谷歌图片</a></figcaption></figure><p id="c0b1" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">很好，现在您已经准备好开始定义您的模型了。你可以从下面选择一个。</p><ul class=""><li id="3077" class="mw mx iq ls b lt mr lw ms lz my md mz mh na ml ob nc nd ne bi translated">"约洛夫3 "</li><li id="5a02" class="mw mx iq ls b lt nf lw ng lz nh md ni mh nj ml ob nc nd ne bi translated">“约洛夫3s”</li><li id="0c05" class="mw mx iq ls b lt nf lw ng lz nh md ni mh nj ml ob nc nd ne bi translated">" yolov3-spp "</li><li id="4208" class="mw mx iq ls b lt nf lw ng lz nh md ni mh nj ml ob nc nd ne bi translated">" yolov3-spp3 "</li><li id="9a07" class="mw mx iq ls b lt nf lw ng lz nh md ni mh nj ml ob nc nd ne bi translated">" yolov3-tiny "</li><li id="4019" class="mw mx iq ls b lt nf lw ng lz nh md ni mh nj ml ob nc nd ne bi translated">" yo lov 3-spp-矩阵"</li><li id="5c29" class="mw mx iq ls b lt nf lw ng lz nh md ni mh nj ml ob nc nd ne bi translated">" csresnext50-panet-spp "</li></ul><p id="17e4" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">但是现在，我们只选择“yolov3”</p><pre class="kg kh ki kj gt nr mp ns nt aw nu bi"><span id="5ab7" class="nv kz iq mp b gy nw nx l ny nz">gtf.set_model(model_name="yolov3")</span></pre><p id="c0f2" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">接下来，定义优化器。您可以从以下选项中选择一个</p><ul class=""><li id="929c" class="mw mx iq ls b lt mr lw ms lz my md mz mh na ml ob nc nd ne bi translated">"新加坡元"</li><li id="1bbc" class="mw mx iq ls b lt nf lw ng lz nh md ni mh nj ml ob nc nd ne bi translated">“亚当”</li></ul><p id="8dc1" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">每个优化器都有不同的参数，但是大多数至少需要一个学习率，称为<code class="fe mm mn mo mp b">lr</code></p><p id="3888" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">这里我们将选择“sgd”，经过几次实验我们发现lr =0.00579作为良好的起点。</p><pre class="kg kh ki kj gt nr mp ns nt aw nu bi"><span id="37bf" class="nv kz iq mp b gy nw nx l ny nz">gtf.set_hyperparams(optimizer="sgd", lr=0.00579, multi_scale=<strong class="mp ir">True</strong>, evolve=<strong class="mp ir">True</strong>, num_generations=10)</span></pre><h1 id="b403" class="ky kz iq bd la lb nk ld le lf nl lh li jw nm jx lk jz nn ka lm kc no kd lo lp bi translated">3.训练模型</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/597fed96944a3f7ff0230780316cbdf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/format:webp/1*R8Z10clSg25bALjsWXG1fg.png"/></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">参考:<a class="ae nq" href="https://www.goodfruit.com/key-to-watering-concord-grapes/" rel="noopener ugc nofollow" target="_blank"> Goodfriut </a></figcaption></figure><p id="0956" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">好了，现在你开始真正的耕作了。训练步骤类似于<em class="mq"> sklearn </em>或者<em class="mq"> keras。</em></p><pre class="kg kh ki kj gt nr mp ns nt aw nu bi"><span id="2eb8" class="nv kz iq mp b gy nw nx l ny nz">gtf.Train(num_epochs=10)</span></pre><h1 id="7bfa" class="ky kz iq bd la lb nk ld le lf nl lh li jw nm jx lk jz nn ka lm kc no kd lo lp bi translated">4.推断模型</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oi"><img src="../Images/57df9786828c2f1211341b508ecd8f88.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yVFdrz4KX9-cwktWOgIDoA.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">参考:<a class="ae nq" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank">https://pixabay.com/</a></figcaption></figure><p id="fb95" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">训练完模型后，最后一步是预测。</p><pre class="kg kh ki kj gt nr mp ns nt aw nu bi"><span id="be97" class="nv kz iq mp b gy nw nx l ny nz">gtf = Infer()<br/>gtf.Model(model_name, class_list, weights, use_gpu=<strong class="mp ir">True</strong>, input_size=416)<br/>gtf.Predict(img_path, conf_thres=0.2, iou_thres=0.5)</span></pre><p id="4a27" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">一些形象的推论，你可以看到:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oj"><img src="../Images/50e25fdac7b2c068bb17fe0d7ca55048.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*21SMSPK_p6nNiNNGhul43w.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">推论1</figcaption></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="od oe di of bf og"><div class="gh gi oj"><img src="../Images/8c8b0901547af4f8b4d32ab89e991af1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JfC5awE0y94Z7CFBAOkAzQ.png"/></div></div><figcaption class="kn ko gj gh gi kp kq bd b be z dk translated">推论2</figcaption></figure></div><div class="ab cl kr ks hu kt" role="separator"><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw kx"/><span class="ku bw bk kv kw"/></div><div class="ij ik il im in"><p id="7728" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">这篇文章的灵感来自于</p><div class="ok ol gp gr om on"><a href="https://towardsdatascience.com/how-to-cook-neural-nets-with-pytorch-7954c1e62e16" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">如何用PyTorch烹饪神经网络</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">使用PyTorch训练神经网络的方法</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">towardsdatascience.com</p></div></div><div class="ow l"><div class="ox l oy oz pa ow pb kl on"/></div></div></a></div><p id="048b" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">你可以在<a class="ae nq" href="https://github.com/Tessellate-Imaging/Monk_Object_Detection/blob/master/application_model_zoo/Example%20-%20Wine%20Grape%20Instance%20Detection%20Dataset.ipynb" rel="noopener ugc nofollow" target="_blank"> Github </a>中找到完整的jupyter笔记本。</p><p id="7066" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">如有疑问，可联系<a class="ae nq" href="https://www.linkedin.com/in/abhishek-kumar-annamraju/" rel="noopener ugc nofollow" target="_blank"> Abhishek </a>和<a class="ae nq" href="https://www.linkedin.com/in/akashdeepsingh01/" rel="noopener ugc nofollow" target="_blank"> Akash </a>。请随意联系他们。</p><p id="9ea7" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">我对计算机视觉和深度学习充满热情。我是<a class="ae nq" href="https://github.com/Tessellate-Imaging/Monk_Object_Detection" rel="noopener ugc nofollow" target="_blank"> Monk </a>库的开源贡献者。</p><p id="ab26" class="pw-post-body-paragraph lq lr iq ls b lt mr jr lv lw ms ju ly lz mt mb mc md mu mf mg mh mv mj mk ml ij bi translated">你也可以在以下网址看到我的其他作品:</p><div class="ok ol gp gr om on"><a href="https://medium.com/@akulahemanth" rel="noopener follow" target="_blank"><div class="oo ab fo"><div class="op ab oq cl cj or"><h2 class="bd ir gy z fp os fr fs ot fu fw ip bi translated">阿库拉·赫曼思·库马尔培养基</h2><div class="ou l"><h3 class="bd b gy z fp os fr fs ot fu fw dk translated">阅读阿库拉·赫曼思·库马尔在媒介上的作品。计算机视觉爱好者。每天，阿库拉·赫曼思·库马尔和…</h3></div><div class="ov l"><p class="bd b dl z fp os fr fs ot fu fw dk translated">medium.com</p></div></div><div class="ow l"><div class="pc l oy oz pa ow pb kl on"/></div></div></a></div></div></div>    
</body>
</html>