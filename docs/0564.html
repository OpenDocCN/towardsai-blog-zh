<html>
<head>
<title>6 Minutes Mantra To Create Resources On Google Cloud</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在谷歌云上创建资源的6分钟咒语</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/6-minutes-mantra-to-create-computing-resources-on-google-cloud-4d3b9dcfdb9f?source=collection_archive---------2-----------------------#2020-06-07">https://pub.towardsai.net/6-minutes-mantra-to-create-computing-resources-on-google-cloud-4d3b9dcfdb9f?source=collection_archive---------2-----------------------#2020-06-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="b103" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">云计算</h2><div class=""/><div class=""><h2 id="52c5" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">如何在几个步骤内使用Google部署管理器创建计算资源</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/23d72c8381487eaecf1fa7852196b1e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a8-Fh9nvS_NtpbKnexFmMA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">使用Canva制作</figcaption></figure><p id="cd46" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我有一个擅长机器学习的朋友，像那个世界的天才。他已经完成了许多项目，但在试图将他的应用程序投入生产时遇到了挑战。因此，他决定创建自己的基础设施，将所有数据库和网络连接到一台虚拟机上。但是由于缺乏范围，再次面临问题。所以，我们一起坐在上面，想出了一个主意，就是有一个模板，只需点击一下，就可以做他想做的一切。类似地，在一个真实的场景中，开发人员通常会提供一个模板和他们的需求，以构建一个他们希望他的应用程序能够工作的代理。然后，基础设施工程师设计并构建服务器和网络。</p><p id="dd34" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">按照传统的方式，他们创建资源并向开发者致谢，这是一个手动的过程。更简单的是，还有一种称为<strong class="lg ja">基础设施即代码(IaC)</strong>的东西，它只是意味着编写代码或脚本来自动化开发所需的环境，即通过使用源代码来供应和管理it基础设施的方法，IaC帮助您以可重复、一致的方式自动化<em class="ma">基础设施</em>部署流程，这有许多好处。</p><p id="8248" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">在本文中，我将展示如何使用<strong class="lg ja">谷歌部署管理器</strong>创建谷歌计算引擎(谷歌云平台上的虚拟机——IaaS ),这是一种自动化创建和管理谷歌云资源的基础设施部署服务。我们开始吧！！</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="2d31" class="mi mj iq bd mk ml mm dn mn mo mp dp mq ln mr ms mt lr mu mv mw lv mx my mz iw bi translated">初始设置</h2><p id="da14" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">为了使用谷歌云服务，我们需要创建一个谷歌云账户。你可以访问https://cloud.google.com/注册一个新账户。如果您已经有了一个，那么赶快登录，让我们开始吧。</p><blockquote class="ng nh ni"><p id="4600" class="le lf ma lg b lh li ka lj lk ll kd lm nj lo lp lq nk ls lt lu nl lw lx ly lz ij bi translated">谷歌为新客户提供300美元积分，以便免费开始使用谷歌云平台。如果你没有使用免费层，谷歌为你创建的每一个资源收费。</p></blockquote><p id="09df" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">登录并访问谷歌云控制台</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nm"><img src="../Images/acaeaa39b6e0f3c86237ebfc86b7cf6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ElAgoieKJg4LbI_tkTr9XQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">谷歌云控制台(作者图片)</figcaption></figure><p id="073f" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">上面的图像显示了我的控制台，现在为了管理我们的资源，我们需要创建一个项目，为此单击屏幕左上角的<strong class="lg ja">选择一个项目</strong>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nn"><img src="../Images/cb6f408c1e26ef65a9e330e76f656485.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qAPt-8-umC2gpDhOwlemyw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">选择项目(作者照片)</figcaption></figure><p id="92e4" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果您已经创建了一个项目，请选择它。要创建新项目，点击屏幕右上角的<strong class="lg ja">新项目</strong>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi no"><img src="../Images/ac45d9e84d1ecc81c8360abfdc3ed99e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1348/format:webp/1*hoY1hzJW-VMSWu0VV-JH8Q.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">创建新项目(作者拍摄的照片)</figcaption></figure><p id="fc8b" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">给你的项目取一个好听的名字。组织的名称是可选的(如果您正在与一个组织合作，您可以选择它)I .现在我们已经创建了一个项目，请选择它。从现在开始，您创建的资源将只与此项目有关。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="dc85" class="mi mj iq bd mk ml mm dn mn mo mp dp mq ln mr ms mt lr mu mv mw lv mx my mz iw bi translated">启用API</h2><ul class=""><li id="6a53" class="np nq iq lg b lh na lk nb ln nr lr ns lv nt lz nu nv nw nx bi translated">在GCP控制台中，在<strong class="lg ja">导航菜单</strong>(汉堡图标)上，点击<strong class="lg ja">API&amp;服务</strong>。</li></ul><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/fd22b05f17ead19b35326e01e43b8f3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1174/format:webp/1*hHTS4dM4gmirrN2C9fTixA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">导航菜单(作者图片)</figcaption></figure><ul class=""><li id="b77c" class="np nq iq lg b lh li lk ll ln nz lr oa lv ob lz nu nv nw nx bi translated">选择仪表板并点击顶部的<strong class="lg ja">启用API和服务</strong>。按名称搜索API<strong class="lg ja">Cloud Deployment Manager v2 API</strong>，并为您的当前项目启用它。创建项目后，启用该项目的<a class="ae nf" href="https://support.google.com/googleapi/answer/6158867?hl=en" rel="noopener ugc nofollow" target="_blank"> <strong class="lg ja">计费账户</strong> </a>。</li></ul></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h2 id="729e" class="mi mj iq bd mk ml mm dn mn mo mp dp mq ln mr ms mt lr mu mv mw lv mx my mz iw bi translated">创建部署管理器部署</h2><ul class=""><li id="f325" class="np nq iq lg b lh na lk nb ln nr lr ns lv nt lz nu nv nw nx bi translated">在GCP控制台的右上角工具栏上，点击打开云壳按钮，然后点击<strong class="lg ja">继续</strong>。现在云壳将会打开。我们也可以根据自己的方便选择在新窗口中打开它。下面的命令将设置项目和区域(作为环境变量)。</li></ul><pre class="kp kq kr ks gt oc od oe of aw og bi"><span id="cc60" class="mi mj iq od b gy oh oi l oj ok">gcloud config set project "Your Project ID"<br/>export MY_ZONE=us-central1-a</span></pre><ul class=""><li id="a1cf" class="np nq iq lg b lh li lk ll ln nz lr oa lv ob lz nu nv nw nx bi translated">复制下面的部署管理器模板文件，这将在GCP上创建一个计算引擎(虚拟机)并运行Nginx light服务器。不要弄乱文件中的空格。部署管理器使用YAML模板语言，该语言依赖缩进行作为其语法的一部分。</li></ul><pre class="kp kq kr ks gt oc od oe of aw og bi"><span id="7130" class="mi mj iq od b gy oh oi l oj ok">sudo vim mydeployment.yaml</span></pre><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="ol om l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">部署管理器模板</figcaption></figure><p id="2879" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">您可以对此文件进行任何修改。在这里，我只创建了一个“compute.v1.instance”类型的计算资源“VM-created-by-deployment-manager”。在同一个文件中，我们还可以提供多个资源。</p><ul class=""><li id="9e82" class="np nq iq lg b lh li lk ll ln nz lr oa lv ob lz nu nv nw nx bi translated">使用下面的命令将您的Google Cloud Platform项目ID插入到文件中，代替字符串PROJECT_ID。</li></ul><pre class="kp kq kr ks gt oc od oe of aw og bi"><span id="322a" class="mi mj iq od b gy oh oi l oj ok">sed -i -e ‘s/PROJECT_ID/’$DEVSHELL_PROJECT_ID/ mydeployment.yaml</span></pre><ul class=""><li id="527d" class="np nq iq lg b lh li lk ll ln nz lr oa lv ob lz nu nv nw nx bi translated">使用下面的命令将分配给您的Google Cloud Platform区域插入到文件中，代替字符串区域。</li></ul><pre class="kp kq kr ks gt oc od oe of aw og bi"><span id="f4be" class="mi mj iq od b gy oh oi l oj ok">sed -i -e ‘s/ZONE/’$MY_ZONE/ mydeploy.yaml</span></pre><ul class=""><li id="66d3" class="np nq iq lg b lh li lk ll ln nz lr oa lv ob lz nu nv nw nx bi translated">您可以使用以下命令预览配置。</li></ul><pre class="kp kq kr ks gt oc od oe of aw og bi"><span id="5f86" class="mi mj iq od b gy oh oi l oj ok">gcloud deployment-manager deployments create <!-- -->example-depl-config mydeployment.yaml<!-- --> --preview</span></pre><ul class=""><li id="dce2" class="np nq iq lg b lh li lk ll ln nz lr oa lv ob lz nu nv nw nx bi translated">使用下面的命令从模板构建部署。</li></ul><pre class="kp kq kr ks gt oc od oe of aw og bi"><span id="8c88" class="mi mj iq od b gy oh oi l oj ok">gcloud deployment-manager deployments create example-depl-config mydeployment.yaml</span></pre><ul class=""><li id="1a4d" class="np nq iq lg b lh li lk ll ln nz lr oa lv ob lz nu nv nw nx bi translated">要更新模板，请对文件进行更改，并使用下面的命令进行更新。</li></ul><pre class="kp kq kr ks gt oc od oe of aw og bi"><span id="d5c9" class="mi mj iq od b gy oh oi l oj ok">gcloud deployment-manager deployments update example-depl --config mydeployment.yaml</span></pre><p id="2710" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">仅此而已！您的虚拟机已经准备就绪，现在导航到计算引擎，您将注意到一个以给定名称和配置运行的虚拟机。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi on"><img src="../Images/67626fb40057585ae07330967e5a008c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1122/format:webp/1*NB6XHRiCdRhBJmQgguWl1w.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">虚拟机详细信息(作者提供照片)</figcaption></figure><p id="32a4" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">您可以查看下面的启动脚本(这将在创建VM时首次运行)。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/b862f944fa8483244ce60c7b716ba9d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*AYPixsAGV0_iNSSCSSuDNw.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">启动脚本(作者提供照片)</figcaption></figure><p id="ed73" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">使用SSH连接到虚拟机(单击远程访问下的SSH)。您可以通过资源下的<code class="fe op oq or od b">sourceImage </code>属性找到您给出的VM的详细信息。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi os"><img src="../Images/f32c20982f1a15ecad03c49f0d631433.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*6VsCRe6-Bgu0Z5tn7_qzbA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">虚拟机详细信息(作者提供照片)</figcaption></figure><p id="5537" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">最后，我使用部署管理器提供了一个Google计算引擎。IaC <em class="ma">最小化风险</em>和<em class="ma">增加速度</em>。有很多IaC工具像Terraform，Azure的ARM templates，JuJu，vagger等。只需几个简单的步骤就可以配置实例。</p><h2 id="79eb" class="mi mj iq bd mk ml mm dn mn mo mp dp mq ln mr ms mt lr mu mv mw lv mx my mz iw bi translated">对于机器学习应用</h2><p id="1f32" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">要部署运行机器学习模型的flask服务器，创建一个GitHub存储库和主工作目录，如下所示。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ot"><img src="../Images/064cec2214255269b4228232686f06cc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hozQa3o_ShN7XfPW3orHaw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">ML应用程序的GitHub项目目录(作者提供图片)</figcaption></figure><p id="7440" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，使用以下内容更新上面提供的模板YAML文件中元数据下的值属性(第10行):</p><pre class="kp kq kr ks gt oc od oe of aw og bi"><span id="e12b" class="mi mj iq od b gy oh oi l oj ok">value: "apt-get update; sudo apt install git; git clone &lt;url_for_GitHub_repo&gt;; pip install requirements.txt; python app.py"</span></pre><blockquote class="ng nh ni"><p id="ac8a" class="le lf ma lg b lh li ka lj lk ll kd lm nj lo lp lq nk ls lt lu nl lw lx ly lz ij bi translated">注意:如果您希望不同版本的python或任何其他先前版本运行您的应用程序，只需用您的脚本更改<strong class="lg ja"> <em class="iq"> value </em> </strong>属性。</p></blockquote><p id="b27c" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">要访问VM上运行的flask，您需要创建一个防火墙规则，并向该标记添加所需的端口。转到<strong class="lg ja"> VPC网络</strong>部分下的防火墙选项卡。创建防火墙规则或使用所需端口更新现有的默认允许http规则。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/deed3ef8aee87645961dd3e7deb48f3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1100/format:webp/1*XujGXaF7iPS7Lab04RY5ig.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">VPC网(作者供图)</figcaption></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/02366114cc99c32c73914f9fca7db997.png" data-original-src="https://miro.medium.com/v2/resize:fit:654/format:webp/1*p1WSSU0Pi21YqxLSo7rVGQ.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">防火墙规则详细信息(作者提供的照片)</figcaption></figure><p id="fdad" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">现在，您可以使用URL格式<code class="fe op oq or od b"><a class="ae nf" href="http://IP_ADDRESS:PORT" rel="noopener ugc nofollow" target="_blank">http://IP_ADDRESS:PORT</a></code>与任何人共享您的应用程序</p><blockquote class="ng nh ni"><p id="6ea8" class="le lf ma lg b lh li ka lj lk ll kd lm nj lo lp lq nk ls lt lu nl lw lx ly lz ij bi translated">一次编写，随时运行！</p></blockquote><h2 id="a5c7" class="mi mj iq bd mk ml mm dn mn mo mp dp mq ln mr ms mt lr mu mv mw lv mx my mz iw bi translated">结论</h2><p id="cbf5" class="pw-post-body-paragraph le lf iq lg b lh na ka lj lk nb kd lm ln nc lp lq lr nd lt lu lv ne lx ly lz ij bi translated">Google Cloud Deployment Manager允许我们定义一个包含所有资源的模板，使用YAML以声明格式运行我们的应用程序。它还支持Python模板。在本文中，我演示了使用部署管理器创建计算引擎的详细步骤。通过使用IaC，可以为实例提供所需的配置。现在，我的朋友，也就是我们在开始时谈到的那位，他的问题已经解决了，并且可以很容易地将他的应用程序投入生产。</p><blockquote class="ng nh ni"><p id="ce86" class="le lf ma lg b lh li ka lj lk ll kd lm nj lo lp lq nk ls lt lu nl lw lx ly lz ij bi translated">编码快乐！！</p></blockquote><p id="a48e" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">如果你发现有改进的地方，请随时提出修改建议。我会很快赶上你的。在那之前，呆在家里，注意安全！<br/>如果您想联系，<strong class="lg ja">在</strong><a class="ae nf" href="https://www.linkedin.com/in/ritheesh-baradwaj-yellenki-8a6988173/" rel="noopener ugc nofollow" target="_blank"><strong class="lg ja">LinkedIn</strong></a><strong class="lg ja">上联系我。</strong></p></div></div>    
</body>
</html>