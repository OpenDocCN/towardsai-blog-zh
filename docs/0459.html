<html>
<head>
<title>Random Error Quantification in Machine Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习中的随机误差量化</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/random-error-quantification-in-machine-learning-846f6e78e519?source=collection_archive---------2-----------------------#2020-05-04">https://pub.towardsai.net/random-error-quantification-in-machine-learning-846f6e78e519?source=collection_archive---------2-----------------------#2020-05-04</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3297" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">每个机器学习算法都有一个固有的随机误差，必须对其进行评估和量化</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/77ba0debd3bbf2de5286830b62ba2701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*-R4VlYwkyaEk3OzvOf24UQ.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">Benjamin O. Tayo的图片</figcaption></figure><h1 id="b9bb" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">一.导言</h1><p id="89fb" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">每个机器学习模型都有固有的随机误差。此错误源于数据集被划分为训练集和测试集的随机性。使用sklearn，特征矩阵(X)和目标变量(y)可以划分如下:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="36dc" class="mn kv it mj b gy mo mp l mq mr">from sklearn.model_selection import train_test_split</span><span id="f61b" class="mn kv it mj b gy ms mp l mq mr">X_train, X_test, y_train, y_test = train_test_split( X, y, <br/>                                      test_size=0.3, random_state=i)</span></pre><p id="cbb9" class="pw-post-body-paragraph lm ln it lo b lp mt ju lr ls mu jx lu lv mv lx ly lz mw mb mc md mx mf mg mh im bi translated">注意，通过改变<strong class="lo iu"> random_state </strong>参数(将I设置为不同的整数值)，我们可以随机选择不同的训练和测试集。这种随机过程将在模型的准确性中引入随机波动。在本文中，我们将展示如何评估和量化机器学习模型中的随机误差。</p><h1 id="ac42" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">二。数据集和模型选择</h1><p id="3ce4" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们将使用游轮数据集<a class="ae my" href="https://github.com/bot13956/ML_Model_for_Predicting_Ships_Crew_Size" rel="noopener ugc nofollow" target="_blank"><strong class="lo iu">cruise _ ship _ info . CSV</strong></a><strong class="lo iu">来说明我们的随机误差量化的例子。</strong>在之前的文章中(<a class="ae my" href="https://medium.com/towards-artificial-intelligence/feature-selection-and-dimensionality-reduction-using-covariance-matrix-plot-b4c7498abd07" rel="noopener"> <strong class="lo iu">使用协方差矩阵图</strong> </a>进行特征选择和维数缩减)，显示了在数据集中的6个预测特征[' <strong class="lo iu">年龄</strong>'、<strong class="lo iu">吨位</strong>'、<strong class="lo iu">乘客</strong>'、<strong class="lo iu">长度</strong>'、<strong class="lo iu">客舱</strong>、'<strong class="lo iu">乘客密度</strong> ]中，如果我们假设重要特征具有 那么目标变量“<strong class="lo iu">乘员</strong>”与4个预测变量:“<strong class="lo iu">吨位</strong>”、“<strong class="lo iu">乘客</strong>”、“<strong class="lo iu">长度</strong>、“<strong class="lo iu">车厢</strong>”强相关。 因此，我们能够将特征空间的维数从6降低到4。</p><p id="aa39" class="pw-post-body-paragraph lm ln it lo b lp mt ju lr ls mu jx lu lv mv lx ly lz mw mb mc md mx mf mg mh im bi translated">现在，假设我们想要建立一个线性回归模型来预测船员变量。我们的模型可以用以下形式表示:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/7428196a9a01e2a17abaaa6a5061769a.png" data-original-src="https://miro.medium.com/v2/resize:fit:696/format:webp/0*Tw3cgo8NMn2Ouc7w.png"/></div></figure><p id="cac9" class="pw-post-body-paragraph lm ln it lo b lp mt ju lr ls mu jx lu lv mv lx ly lz mw mb mc md mx mf mg mh im bi translated">为了评估我们的模型，我们将使用R2评分标准。在本文中，我们将表明，由于机器学习模型固有的随机性质，R2分数是一个随机变量。然后，我们将计算R2评分的平均值和95%的置信区间，并显示不同随机状态参数下R2评分的变化。</p><h1 id="2afe" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">三。随机误差评估和量化</h1><p id="206c" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们将通过改变用于将数据集划分为训练集和测试集的随机状态参数，以及k-fold交叉验证来评估随机误差。这个过程的伪代码如下所示:</p><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="de34" class="mn kv it mj b gy mo mp l mq mr">n = number of random states to use</span><span id="9157" class="mn kv it mj b gy ms mp l mq mr">for i in range (n):</span><span id="e083" class="mn kv it mj b gy ms mp l mq mr">    X_train, X_test, y_train, y_test = train_test_split( X, y, <br/>                                      test_size=0.3, random_state=i)</span><span id="27d2" class="mn kv it mj b gy ms mp l mq mr">    perform k-fold cross validation on X_train</span><span id="1f72" class="mn kv it mj b gy ms mp l mq mr">    train_score(i) = average of R2 score over the k-folds</span><span id="da77" class="mn kv it mj b gy ms mp l mq mr">R2 mean value = average of train_score over n random states</span><span id="65cd" class="mn kv it mj b gy ms mp l mq mr">R2 standard deviation = std of train_score over n random states</span></pre><p id="350a" class="pw-post-body-paragraph lm ln it lo b lp mt ju lr ls mu jx lu lv mv lx ly lz mw mb mc md mx mf mg mh im bi translated">现在让我们将伪代码转换成python代码。</p><h2 id="cde9" class="mn kv it bd kw na nb dn la nc nd dp le lv ne nf lg lz ng nh li md ni nj lk nk bi translated">III A .导入必要的库</h2><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="1a85" class="mn kv it mj b gy mo mp l mq mr">import numpy as np</span><span id="7931" class="mn kv it mj b gy ms mp l mq mr">import pandas as pd</span><span id="5270" class="mn kv it mj b gy ms mp l mq mr">import matplotlib.pyplot as plt</span><span id="2371" class="mn kv it mj b gy ms mp l mq mr">from sklearn.metrics import r2_score</span><span id="05ea" class="mn kv it mj b gy ms mp l mq mr">from sklearn.model_selection import cross_val_score</span><span id="226a" class="mn kv it mj b gy ms mp l mq mr">from sklearn.model_selection import train_test_split</span><span id="2796" class="mn kv it mj b gy ms mp l mq mr">from sklearn.preprocessing import StandardScaler</span><span id="b2f3" class="mn kv it mj b gy ms mp l mq mr">from sklearn.decomposition import PCA</span><span id="efdf" class="mn kv it mj b gy ms mp l mq mr">from sklearn.linear_model import LinearRegression</span><span id="8cc9" class="mn kv it mj b gy ms mp l mq mr">from sklearn.pipeline import Pipeline</span><span id="8aee" class="mn kv it mj b gy ms mp l mq mr">pipe_lr = Pipeline([('scl', StandardScaler()),('pca', <br/>                  PCA(n_components=4)),('slr', LinearRegression())])</span></pre><h2 id="51f7" class="mn kv it bd kw na nb dn la nc nd dp le lv ne nf lg lz ng nh li md ni nj lk nk bi translated">读取数据集并选择预测值和目标变量</h2><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="3e7e" class="mn kv it mj b gy mo mp l mq mr">df=pd.read_csv("cruise_ship_info.csv")</span><span id="7028" class="mn kv it mj b gy ms mp l mq mr">cols_selected = ['Tonnage', 'passengers', 'length', 'cabins','crew']</span><span id="bd78" class="mn kv it mj b gy ms mp l mq mr">X = df[cols_selected].iloc[:,0:4].values   <br/>  <br/>y = df[cols_selected]['crew'] <br/> <br/>sc_y = StandardScaler()</span><span id="a99d" class="mn kv it mj b gy ms mp l mq mr">train_score = []</span><span id="a2f3" class="mn kv it mj b gy ms mp l mq mr">test_score =  []</span></pre><h2 id="171f" class="mn kv it bd kw na nb dn la nc nd dp le lv ne nf lg lz ng nh li md ni nj lk nk bi translated">模型建立、评估和随机误差量化</h2><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="9539" class="mn kv it mj b gy mo mp l mq mr">n = 15</span><span id="7ef4" class="mn kv it mj b gy ms mp l mq mr">for i in range(n):</span><span id="0565" class="mn kv it mj b gy ms mp l mq mr">    X_train, X_test, y_train, y_test = train_test_split( X, y, <br/>                                      test_size=0.3, random_state=i)</span><span id="3ca2" class="mn kv it mj b gy ms mp l mq mr">    y_train_std = sc_y.fit_transform(y_train[:,   <br/>                                           np.newaxis]).flatten()</span><span id="2ea6" class="mn kv it mj b gy ms mp l mq mr">    train_score = np.append(train_score, <br/>                            np.mean(cross_val_score(pipe_lr, <br/>                            X_train, y_train_std, <br/>                            scoring ='r2' , cv = 10)))</span><span id="41c4" class="mn kv it mj b gy ms mp l mq mr">train_mean = np.mean(train_score)</span><span id="489e" class="mn kv it mj b gy ms mp l mq mr">train_std = np.std(train_score)</span><span id="6d83" class="mn kv it mj b gy ms mp l mq mr">print('R2 train: %.3f +/- %.3f' % (train_mean,train_std))</span></pre><p id="875a" class="pw-post-body-paragraph lm ln it lo b lp mt ju lr ls mu jx lu lv mv lx ly lz mw mb mc md mx mf mg mh im bi translated">此代码的输出结果是:R2火车:0.914 +/- 0.013。这表明该模型获得的总R2分数是一个随机变量，其平均值为0.914，标准偏差为0.013。</p><h2 id="6d1f" class="mn kv it bd kw na nb dn la nc nd dp le lv ne nf lg lz ng nh li md ni nj lk nk bi translated">III D .不同随机状态下平均交叉验证R2评分变化的可视化</h2><pre class="kj kk kl km gt mi mj mk ml aw mm bi"><span id="a6bb" class="mn kv it mj b gy mo mp l mq mr">plt.figure(figsize=(11,7))</span><span id="c8d7" class="mn kv it mj b gy ms mp l mq mr">plt.plot(range(n),train_score,color='blue', linestyle='dashed', <br/>         marker='o',markerfacecolor='red', markersize=10)</span><span id="c4f9" class="mn kv it mj b gy ms mp l mq mr">plt.fill_between(range(n),<br/>                 train_score + 2*train_std,<br/>                 train_score - 2*train_std,<br/>                 alpha=0.15, color='green')</span><span id="1c16" class="mn kv it mj b gy ms mp l mq mr">plt.grid()</span><span id="8d8f" class="mn kv it mj b gy ms mp l mq mr">plt.ylim(0.8,1)</span><span id="a8f4" class="mn kv it mj b gy ms mp l mq mr">plt.title('Mean cross-validation R2 score vs. random state parameter', size = 14)</span><span id="ddb1" class="mn kv it mj b gy ms mp l mq mr">plt.xlabel('Random state parameter', size = 14)</span><span id="1d25" class="mn kv it mj b gy ms mp l mq mr">plt.ylabel('Mean cross-validation R2 score', size = 14)</span><span id="da90" class="mn kv it mj b gy ms mp l mq mr">plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/77ba0debd3bbf2de5286830b62ba2701.png" data-original-src="https://miro.medium.com/v2/resize:fit:1370/format:webp/1*-R4VlYwkyaEk3OzvOf24UQ.png"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">不同随机状态的平均交叉验证R2分数。浅蓝色区域代表平均交叉验证R2评分的95%置信区间。</figcaption></figure><p id="c62c" class="pw-post-body-paragraph lm ln it lo b lp mt ju lr ls mu jx lu lv mv lx ly lz mw mb mc md mx mf mg mh im bi translated">该图显示了作为随机状态参数的函数绘制的平均交叉验证R2评分。我们看到R2分数是一个随机变量。浅绿色阴影区域显示了计算的R2分数的95%置信区间。因此，即使总的R2分值是:0.914 +/- 0.013，我们看到R2分值对于不同的随机状态参数是不同的。</p><h1 id="9b96" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">四。总结和结论</h1><p id="e145" class="pw-post-body-paragraph lm ln it lo b lp lq ju lr ls lt jx lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我们在本文中已经表明，R2分数是一个随机变量。为了评估和量化与R2评分计算相关的随机误差，我们对数据集的不同随机分区进行了k重交叉验证，分为训练集和测试集。对于给定的模型，我们发现R2分数是一个随机变量，平均值为0.914，标准偏差为0.013。重要的是，在评估机器学习模型的预测能力时，交叉验证是针对数据集到训练集和测试集的不同随机分区实现的。这将确保用于模型评估的指标报告值的可靠性。</p><p id="db19" class="pw-post-body-paragraph lm ln it lo b lp mt ju lr ls mu jx lu lv mv lx ly lz mw mb mc md mx mf mg mh im bi translated">本文的数据集和Jupyter笔记本可以从这个Github资源库下载:<a class="ae my" href="https://github.com/bot13956/Random_error_quantification_in_ML" rel="noopener ugc nofollow" target="_blank"><strong class="lo iu">https://Github . com/bot 13956/Random _ error _ quantization _ in _ ML</strong></a><strong class="lo iu">。</strong></p><h1 id="7869" class="ku kv it bd kw kx ky kz la lb lc ld le jz lf ka lg kc lh kd li kf lj kg lk ll bi translated">参考</h1><ol class=""><li id="b90f" class="nl nm it lo b lp lq ls lt lv nn lz no md np mh nq nr ns nt bi translated"><a class="ae my" href="https://medium.com/towards-artificial-intelligence/feature-selection-and-dimensionality-reduction-using-covariance-matrix-plot-b4c7498abd07" rel="noopener">使用协方差矩阵图进行特征选择和降维</a>。</li><li id="4f96" class="nl nm it lo b lp nu ls nv lv nw lz nx md ny mh nq nr ns nt bi translated">拉什卡、塞巴斯蒂安和瓦希德·米尔贾利利<strong class="lo iu">。</strong> <em class="nz"> Python机器学习，第二版</em>。Packt出版公司，2017年。</li><li id="9123" class="nl nm it lo b lp nu ls nv lv nw lz nx md ny mh nq nr ns nt bi translated">Benjamin O. Tayo，<em class="nz">预测船只船员规模的机器学习模型</em>，<a class="ae my" href="https://github.com/bot13956/ML_Model_for_Predicting_Ships_Crew_Size" rel="noopener ugc nofollow" target="_blank">https://github . com/bot 13956/ML _ Model _ for _ Predicting _ Ships _ Crew _ Size</a>。</li></ol></div><div class="ab cl oa ob hx oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="im in io ip iq"><p id="0123" class="pw-post-body-paragraph lm ln it lo b lp mt ju lr ls mu jx lu lv mv lx ly lz mw mb mc md mx mf mg mh im bi translated">由<a class="ae my" href="https://towardsai.net/" rel="noopener ugc nofollow" target="_blank">向艾</a>发布</p></div></div>    
</body>
</html>