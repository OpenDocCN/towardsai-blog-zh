<html>
<head>
<title>Markov Algorithm For Time Series</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列的马尔可夫算法</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/markov-algorithm-for-time-series-2563cad7d54c?source=collection_archive---------1-----------------------#2022-12-29">https://pub.towardsai.net/markov-algorithm-for-time-series-2563cad7d54c?source=collection_archive---------1-----------------------#2022-12-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/9bdbb899fde013f4b199d658011c10f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z7SiAWf-qyjwt96jlQvPPQ.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">马尔可夫建模</figcaption></figure><div class=""/><div class=""><h2 id="02ef" class="pw-subtitle-paragraph kf jh ji bd b kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw dk translated">目录</h2></div><p id="35f5" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">I .下载数据集</p><p id="4608" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">二。算法—从时间序列数据到离散马尔可夫建模</p><p id="665a" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">三。可视化误差指标</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h2 id="a71d" class="ma mb ji bd mc md me dn mf mg mh dp mi lg mj mk ml lk mm mn mo lo mp mq mr ms bi translated">I .下载数据集</h2><p id="e76e" class="pw-post-body-paragraph kx ky ji kz b la mt kj lc ld mu km lf lg mv li lj lk mw lm ln lo mx lq lr ls im bi translated">我去了这里→<a class="ae my" href="https://data.world/classyprince/arxivcombineddata" rel="noopener ugc nofollow" target="_blank">https://data.world/classyprince/arxivcombineddata</a></p><p id="fc0a" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">下载了数据。该数据显示了arXiv每月的提交量和下载量。</p><p id="f1bc" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在这个任务中，我将预测每月的提交。</p></div><div class="ab cl lt lu hx lv" role="separator"><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly lz"/><span class="lw bw bk lx ly"/></div><div class="im in io ip iq"><h2 id="b120" class="ma mb ji bd mc md me dn mf mg mh dp mi lg mj mk ml lk mm mn mo lo mp mq mr ms bi translated">二。算法——从时间序列数据到离散马尔可夫模型</h2><p id="7c13" class="pw-post-body-paragraph kx ky ji kz b la mt kj lc ld mu km lf lg mv li lj lk mw lm ln lo mx lq lr ls im bi translated">为了将未离散化为某个有限数字(基本上未标准化可能是正确的说法)的数据转换为可用于状态转换建模的离散化数据集，我需要一个映射函数。</p><p id="d8bc" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这里我将使用百分位数函数。Excel有百分位函数。</p><p id="3fb1" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我要做的是创建一个滚动的8天窗口，以获取8天窗口内当前值的百分比。</p><p id="80fe" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在这种情况下，我使用的是excel。Excel有百分位函数。从第9行开始，我可以输入以下公式:</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="8a6f" class="ni mb ji ne b be nj nk l nl nm">=PERCENTRANK($C2:$C9,C9)</span></pre><p id="70b8" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这个函数将给出最后8行的百分比。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/01444ac46311efee20bb0220bb5e96d0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1234/format:webp/1*G55GndPndApEBwWXfRdEEw.png"/></div></figure><p id="e9c8" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在本例中，我们看到746个提交位于8行的第57个百分点。我可以一直拖动这个公式，它将创建一个滚动窗口百分位，用于所有向前的数字。</p><p id="975c" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在是时候<strong class="kz jj">创建一个训练数据集了。为此，我只取了前100行。</strong></p><p id="2df1" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在我有了这个，然后我将百分位数列表提取到另一个表中的另一列。</p><p id="fb7f" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我称之为“从”栏。然后，我将第2行的所有内容粘贴到相邻的列中，并将其命名为“to”列。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div class="gh gi no"><img src="../Images/803d9562a551c51f0ae3bd6dc2baaf26.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*-wB8zFKRgTypeBDbMUDwgQ.png"/></div></figure><p id="0f70" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我现在有两列。第二列是第一列的下一个值。</p><p id="946f" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在我可以建立一个状态转换表。</p><p id="2495" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">首先，我可以获取上面的两个列表(to和from)，然后将这些列表复制到两个不同的列中(在本例中是j和k)。接下来，我删除了两列中的重复项。<strong class="kz jj">现在每一对“从”到“到”都是独一无二的。下面是这个样子的快照。我会在这张图之后解释列1、列2和列3。图中重要的一点是注意到这些对是唯一的，从而显示了到和从的唯一状态转换。</strong></p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div class="gh gi np"><img src="../Images/3e0278edebb545f174bcac6ad9f31881.png" data-original-src="https://miro.medium.com/v2/resize:fit:1302/format:webp/1*zvYFwpBjqlvdVQK6PvVZ5w.png"/></div></figure><p id="5ade" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">如果我们想形象化这一点，我们可以像这样建立一个状态转换图(数字没有显示)。每个箭头都指向一个目标状态，数字将被添加以表示移动到该目标状态的概率。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/9bdbb899fde013f4b199d658011c10f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*z7SiAWf-qyjwt96jlQvPPQ.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">马尔可夫建模</figcaption></figure><p id="214c" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在，在第1列中，我统计了这些对在训练集中的出现次数。</p><p id="1c1f" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">excel中的公式大概是这样的(D列是from列(非唯一)，E列是to列(非唯一))。</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="f48b" class="ni mb ji ne b be nj nk l nl nm">=COUNTIFS($D$3:$D$102,J3,$E$3:$E$102,K3)</span></pre><p id="881e" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">请注意，countifs使用了两个标准，from和to列必须匹配才能算作一条记录。</p><blockquote class="nq nr ns"><p id="8a35" class="kx ky nt kz b la lb kj lc ld le km lf nu lh li lj nv ll lm ln nw lp lq lr ls im bi translated">每个递增计数意味着<strong class="kz jj">在训练数据集中有一个发生转变的记录。</strong></p></blockquote><p id="703f" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在，我想知道从那个状态转移的概率，这意味着<strong class="kz jj">当时间序列的状态在我们的映射表中处于给定的百分位数时，概率上会发生什么。</strong></p><p id="5f10" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">为了做到这一点，我不得不写出下面的公式，并把它拖下来。</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="25ae" class="ni mb ji ne b be nj nk l nl nm">=L3/SUMIF($J$3:$J$48,J3,$L$3:$L$48)</span></pre><p id="3e62" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这个公式基本上是说:</p><blockquote class="nq nr ns"><p id="61ad" class="kx ky nt kz b la lb kj lc ld le km lf nu lh li lj nv ll lm ln nw lp lq lr ls im bi translated">把我上面计算的计数作为分子，现在用它除以<strong class="kz jj">起始状态(from状态)相同的计数之和。</strong></p></blockquote><p id="81c4" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">为了说明这一点，让我们看看“来自”州的第29个百分位数。第29百分位有四个“到”状态:43、86、57和100。</p><p id="2a87" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">29至43有3项记录，29至86有1项记录，29至57有1项记录，最后29至100有4项记录。3/9是33%。<strong class="kz jj">因此，在训练数据集中，从29%到43%的转变发生了33%的时间。</strong></p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/88c625414d5196a7a6c395f96eefe91b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*jjS1mzBlXnXT2l43UQi4OA.png"/></div></figure><p id="0194" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在我有了一个状态转换表，我需要找到一些方法将它编程到我们的数据中来进行预测。</p><p id="b179" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">为了做到这一点，我将制作一个额外的专栏。上表中的第3列是加1的累积概率列。</p><blockquote class="nq nr ns"><p id="c941" class="kx ky nt kz b la lb kj lc ld le km lf nu lh li lj nv ll lm ln nw lp lq lr ls im bi translated"><strong class="kz jj">增加各状态概率的原因是，我可以在我们的公式中创建概率桶，我们将在后面看到。</strong></p></blockquote><figure class="mz na nb nc gt iv gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/511331f8fe75406fc7136feb6f53bdb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:868/format:webp/1*DdwBKzVolg2N2zOXmKiTFg.png"/></div></figure><p id="7046" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在，让我们用一个数据透视表把它变成一个from-to矩阵。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nz"><img src="../Images/cc67b355b1b499777df43924ede91514.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fz-XzHejFITpSWDGuZmncg.png"/></div></div></figure><p id="8455" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">请注意，此表中的概率是累积的。</p><p id="b551" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在，我将前往我们的<strong class="kz jj">训练数据集，编写我们的算法进行预测。</strong></p><p id="96d0" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">首先，我将输出一个随机数来模拟概率事件。</p><p id="6712" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">excel中的以下函数将输出一个介于0和1之间的连续数值。这反过来意味着，如果随机模拟进行了很多次，任何给定值和小于该值的数字都将以等于给定值%的概率出现。例如，如果输出的数字是. 20，这表示有20%的时间，则该数字将小于或等于. 20。</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="fbca" class="ni mb ji ne b be nj nk l nl nm">=rand()</span></pre><p id="aa0d" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在，为了让算法做出我们的预测:</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="ed41" class="ni mb ji ne b be nj nk l nl nm">=MIN(FILTER(FILTER(Sheet1!$Q$4:$X$11,Sheet1!$P$4:$P$11=arxiv_combined_submissions_and_!G109),FILTER(Sheet1!$Q$4:$X$11,Sheet1!$P$4:$P$11=arxiv_combined_submissions_and_!G109)&gt;=H109))</span></pre><p id="57b7" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">让我从内向外分解一下。</p><p id="8d6c" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">首先，我们将此视为最深层的过滤器:</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="0464" class="ni mb ji ne b be nj nk l nl nm">FILTER(Sheet1!$Q$4:$X$11,Sheet1!$P$4:$P$11=arxiv_combined_submissions_and_!G109)&gt;=H109)</span></pre><p id="0ba6" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这里是Sheet1！$Q$4:$X$11表示下图中矩形内的值，这些值来自我们之前制作的矩阵。这是我们在这部分代码中过滤以获得输出的数据范围。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oa"><img src="../Images/bf85990f9a6e64a995bff8dfd6a8bf94.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*v_yCz0AyVfa-9UqjMsxHjg.png"/></div></div></figure><p id="0569" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">filter参数的下一部分是Sheet1！$ P $ 4:$ P $ 11 = arxiv _ combined _ submissions _ and _！G109)&gt;=H109)</p><p id="4df7" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这是我们筛选矩阵中数据的标准。</p><p id="7089" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这里，第一页！$P$4:$P$11是我们的pivot的行标签。<strong class="kz jj">行标签是我们的状态转换的“from”状态。</strong></p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ob"><img src="../Images/7f35f190f2554f36c99ecbbab0178de2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Lb6XMMmjJy9HAarLnolQtw.png"/></div></div></figure><p id="e765" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">接下来，标准要求这些行标签必须等于数据的G109。</p><p id="4d98" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">Sheet1！$ P $ 4:$ P $ 11 = arxiv _ combined _ submissions _ and _！G109)</p><p id="8d29" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在前面的讨论中，我们输入了一个公式来获得滚动的8天百分比。这是我们的G柱。<strong class="kz jj">概括一下，这个过滤函数到目前为止是说，在我们的数据中，有一个百分点，在数据透视表的“from”或行中查找该百分点，然后过滤掉整行。这是这个意思:</strong></p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="0450" class="ni mb ji ne b be nj nk l nl nm">FILTER(Sheet1!$Q$4:$X$11,Sheet1!$P$4:$P$11=arxiv_combined_submissions_and_!G109)</span></pre><p id="b59d" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">过滤器的这一部分将给出图中所示的行</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oc"><img src="../Images/afc64058436e7ae6cc3e6dc474ff74bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WaykVFiGvjK9jdANJXSxfQ.png"/></div></div></figure><p id="fff5" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">然而，我们现在必须限制数组中大于我们输出的随机数的部分。这个随机数在H列，所以我加了这个部分:</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="ec4b" class="ni mb ji ne b be nj nk l nl nm">&gt;=H109</span></pre><p id="4d02" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这将给我数组中大于rand()函数在该行中输出的部分。</p><p id="e5cf" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在，让我们继续离开我们的算法。</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="5b87" class="ni mb ji ne b be nj nk l nl nm">FILTER(FILTER(Sheet1!$Q$4:$X$11,Sheet1!$P$4:$P$11=arxiv_combined_submissions_and_!G109),FILTER(Sheet1!$Q$4:$X$11,Sheet1!$P$4:$P$11=arxiv_combined_submissions_and_!G109)&gt;=H109))</span></pre><p id="a12d" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这是外部过滤器，它包裹了我们刚刚通过的过滤器。但是，这个外部过滤器在内部使用了两个过滤条件。</p><p id="05de" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在我进行分解之前，让我回顾一下excel中filter函数的参数。filter函数将第一个参数作为要筛选的数据，第二个参数是筛选数据的条件。</p><p id="4b0e" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在算法的这一部分，我们看到外部过滤器有这两个参数，但每个参数都是一个过滤器。第二个过滤器是conditions，它是我们刚才提到的过滤器，用于过滤大于rand()的值。但是，对于这个外部过滤器，我们也需要数据。</p><p id="6904" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">外部过滤器(第一个内部过滤器)的数据只有这一行:</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="6147" class="ni mb ji ne b be nj nk l nl nm">FILTER(Sheet1!$Q$4:$X$11,Sheet1!$P$4:$P$11=arxiv_combined_submissions_and_!G109)</span></pre><p id="53aa" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我们基本上是说，使用外部过滤器，使用第二个过滤器过滤该行上的所有值，这将值限制为仅大于输出的随机数。</p><p id="491e" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在，我们将把它放入一个min函数中，以给出比随机数输出更大的最小可能值:</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="76e8" class="ni mb ji ne b be nj nk l nl nm">=MIN(FILTER(FILTER(Sheet1!$Q$4:$X$11,Sheet1!$P$4:$P$11=arxiv_combined_submissions_and_!G109),FILTER(Sheet1!$Q$4:$X$11,Sheet1!$P$4:$P$11=arxiv_combined_submissions_and_!G109)&gt;=H109))</span></pre><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi od"><img src="../Images/c7c02917cb47b23803f99d1969f80756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_mao5rZuYMCOyNvPR-b1zA.png"/></div></div></figure><blockquote class="nq nr ns"><p id="96c5" class="kx ky nt kz b la lb kj lc ld le km lf nu lh li lj nv ll lm ln nw lp lq lr ls im bi translated">假设要过滤的行位于第43个百分点。现在想象随机数输出是0.75。如果随机数输出是. 75，则大于该随机数输出的最小数是. 833333。</p></blockquote><p id="d34e" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated"><strong class="kz jj">这整个练习就好比说，当从状态43%转换时，我们输出的随机数落在大于上一个桶的边缘的范围内，并且落在小于下一个桶的边界的桶内。让我们从另一个角度来看43%。</strong></p><p id="c98f" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">43%在“到”状态中有7种不同的可能性，它可以转换到“到”状态。57%的“到”状态有大约17%的机会，86%的“到”状态有大约17%的机会，71%的“到”状态有25%的机会，下一个100%的“到”状态有17%的机会。在分布中，这意味着从数轴上的0开始，如果一个随机数在0到0.17之间，它有17%的机会，我们可以将它分配到第一个“到”状态57%，从0.17到大约34% (.33333)，我们还有17%，我们可以使用累积概率将它分配到下一个阶段86%，以此类推。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/a315cce4bfb43c25e67267063b0745e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*01C4pf9s_GKdlaAhwGMlVA.png"/></div></figure><p id="05a9" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated"><strong class="kz jj">因此，通过反向映射(查找)随机数落入的累积概率桶的“上边界”来确定“到”状态。</strong></p><p id="f3bf" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在，让我们做这个反向映射。在我们训练数据的下一列中，我们将把给出最小较高值的上一个公式的解包装到下面的筛选器中，以给出“to”状态:</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="b543" class="ni mb ji ne b be nj nk l nl nm">=FILTER(Sheet1!$Q$3:$X$3,FILTER(Sheet1!$Q$4:$X$11,Sheet1!$P$4:$P$11=arxiv_combined_submissions_and_!G109)=arxiv_combined_submissions_and_!J109)</span></pre><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oe"><img src="../Images/19553029e1a44f99033d37be33d1bec9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GZ1uyBmqODrDxoFLBNwk1w.png"/></div></div></figure><p id="1a9f" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">Q3到X3范围是我们要筛选的数据，它是第一个参数，第二个参数是另一个筛选Q4到X11的过滤器(它是矩阵内的概率数据，当它等于我们编写的上一个算法的解时，它是这样的:</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="4d43" class="ni mb ji ne b be nj nk l nl nm">=MIN(FILTER(FILTER(Sheet1!$Q$4:$X$11,Sheet1!$P$4:$P$11=arxiv_combined_submissions_and_!G109),FILTER(Sheet1!$Q$4:$X$11,Sheet1!$P$4:$P$11=arxiv_combined_submissions_and_!G109)&gt;=H109))</span></pre><p id="7ce5" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">这意味着我们正在映射桶的上边界，在该边界内随机数下降到“to”状态，这在我们的数据透视表的列中。例如，数字. 83333(43%行中的第二个数字)映射到“到”状态中的14%,依此类推。</p><p id="1558" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">现在我们有了“到”的百分位数，我们可以反向映射这个百分位数。</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="09e1" class="ni mb ji ne b be nj nk l nl nm">=PERCENTILE(C102:C109,K109)</span></pre><p id="e9d8" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">请记住，百分位数是滚动的8天，所以当我们从百分位数返回数字时，我们必须从滚动的8天窗口获得数字。</p><p id="1556" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在所示的百分比公式中，K109是我们获得的“至”州百分比，然后我们从之前的8天窗口中获得对应于“至”州百分比的数字。</p><p id="4470" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">我们可以把这个公式拖下来得到数值。这是实际值与预测值的对比图:</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi of"><img src="../Images/d3661495fefd239d2ff590a9a9322ea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1jE54LcEghsYEu832JTf2A.png"/></div></div></figure><h2 id="ac10" class="ma mb ji bd mc md me dn mf mg mh dp mi lg mj mk ml lk mm mn mo lo mp mq mr ms bi translated">三。可视化误差指标</h2><p id="9af1" class="pw-post-body-paragraph kx ky ji kz b la mt kj lc ld mu km lf lg mv li lj lk mw lm ln lo mx lq lr ls im bi translated">MAPE可通过以下公式计算:</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div class="gh gi og"><img src="../Images/ccb6ecf5342330d8cc0fb32d5434bbe3.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*pvQx7vcz0fKWAVLc7iOllQ.png"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated"><a class="ae my" href="https://en.wikipedia.org/wiki/Mean_absolute_percentage_error" rel="noopener ugc nofollow" target="_blank">https://en . Wikipedia . org/wiki/Mean _ absolute _ percentage _ error</a></figcaption></figure><p id="b629" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">为此，我们可以计算每一行上的绝对误差。</p><pre class="mz na nb nc gt nd ne nf bn ng nh bi"><span id="fb13" class="ni mb ji ne b be nj nk l nl nm">=ABS(L109-C110)/C110</span></pre><p id="58f6" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">平均这些绝对误差，我们得到大约6%到7%的MAPE。</p><p id="4964" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">然而，让我们想象一下这些错误是如何看起来更详细的视图。</p><p id="c21b" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">在我们预测的测试中，有74次出现在0到4%的绝对误差范围内，34次在4到8%的范围内，38次在8到12%的范围内，其余的误差值逐渐减小。</p><figure class="mz na nb nc gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oh"><img src="../Images/886f05b128bc184bebe022c1f79be75e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-WIFiDwYylJ-i2ABlpipJA.png"/></div></div></figure><p id="476d" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">参考资料:</p><p id="a9a9" class="pw-post-body-paragraph kx ky ji kz b la lb kj lc ld le km lf lg lh li lj lk ll lm ln lo lp lq lr ls im bi translated">【https://data.world/classyprince/arxivcombineddata T4】1—T5</p></div></div>    
</body>
</html>