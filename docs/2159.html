<html>
<head>
<title>How To Use Transformers To Automatically Generate Stories In Rasa</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用变形金刚在Rasa中自动生成故事</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-to-use-transformers-to-automatically-generate-stories-in-rasa-8feaffa8bd27?source=collection_archive---------1-----------------------#2021-09-07">https://pub.towardsai.net/how-to-use-transformers-to-automatically-generate-stories-in-rasa-8feaffa8bd27?source=collection_archive---------1-----------------------#2021-09-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="f11d" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/artificial-intelligence" rel="noopener ugc nofollow" target="_blank">人工智能</a></h2><div class=""/><figure class="gl gn ka kb kc kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi jz"><img src="../Images/c3fb65a8c8d22c205f9b96262805cfe9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gnjg7fjqAE9JdxnXdylJUQ.png"/></div></div></figure><h1 id="d34f" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">介绍</h1><p id="1653" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">在这篇文章中，我将分享一个使用<a class="ae mg" href="https://rasa.com/" rel="noopener ugc nofollow" target="_blank"> Rasa </a>自动生成训练和测试<a class="ae mg" href="https://rasa.com/docs/rasa/stories/" rel="noopener ugc nofollow" target="_blank">故事</a>的想法。</p><p id="1771" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">本文中重现结果的代码是<a class="ae mg" href="https://github.com/hsm207/rasa_nlg" rel="noopener ugc nofollow" target="_blank">这里是</a>。</p><h1 id="785c" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">问题陈述</h1><p id="b1ec" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">假设你是一名数据科学家，正在为<a class="ae mg" href="https://info.rasa.com/rasa-bot-starter-packs#financial-services" rel="noopener ugc nofollow" target="_blank">金融服务用例</a>构建一个机器人。您已经决定要实现的第一个特性是资金转账任务。</p><p id="f9ee" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">需要回答的问题是:</p><ol class=""><li id="2925" class="mm mn it lk b ll mh lp mi lt mo lx mp mb mq mf mr ms mt mu bi translated">客户可以通过哪些方式要求进行资金转账？</li><li id="629b" class="mm mn it lk b ll mv lp mw lt mx lx my mb mz mf mr ms mt mu bi translated">机器人应该如何响应客户的消息？</li><li id="acde" class="mm mn it lk b ll mv lp mw lt mx lx my mb mz mf mr ms mt mu bi translated">需要支持哪些对话流？</li></ol><p id="e6d9" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">找出上述问题的答案通常是<a class="ae mg" href="https://rasa.com/blog/recipes-for-building-conversational-ai-teams/" rel="noopener ugc nofollow" target="_blank">对话设计者/文案撰写者</a>的任务。如果你刚开始构建一个机器人，你的团队不太可能有这样的资源，那么你能做什么呢？</p><p id="f4b6" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">一种常见的方法是咨询项目的涉众，询问他们希望看到部署什么。问题是，他们的想象力有可能会天马行空，而你最终构建的功能和对话流很难在实践中使用。例如，他们可能坚持机器人必须识别以文字书写的转账金额，例如“我想转账两千五百美元”。</p><p id="34f7" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">因此，数据驱动的方法比向利益相关者询问他们的愿望清单更好。</p><h1 id="2b2d" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">解决办法</h1><h2 id="72f4" class="na kl it bd km nb nc dn kq nd ne dp ku lt nf ng ky lx nh ni lc mb nj nk lg iz bi translated">概观</h2><p id="a2f3" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">如果您可以访问真实的对话，例如来自客户服务中心的电话记录，那么您可以构建一个语言模型，该模型将输出模拟真实客户代理如何响应客户的任何查询的响应。然后，您可以扮演客户的角色，并与该语言模型进行对话，以在各种场景下自动生成对话。</p><p id="b307" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">这应该足以引导你的机器人。</p><h2 id="b6ee" class="na kl it bd km nb nc dn kq nd ne dp ku lt nf ng ky lx nh ni lc mb nj nk lg iz bi translated">履行</h2><p id="ea5b" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">为了在Rasa中做到这一点，我们可以实现一个定制的<a class="ae mg" href="https://rasa.com/docs/rasa/nlg" rel="noopener ugc nofollow" target="_blank"> NLG服务器</a>。该服务器将托管一个语言模型，该模型将根据用户的输入和对话中的优先顺序生成响应。</p><p id="a6cd" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">让我们使用<a class="ae mg" href="https://fastapi.tiangolo.com/" rel="noopener ugc nofollow" target="_blank"> FastAPI </a>库来实现定制的NLG服务器。</p><p id="bb45" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">根据Rasa的NLG服务器文档，对NLG服务器的请求主体可以建模如下:</p><figure class="nm nn no np gt kd gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/8db9092aa86905796d34511b0015018c.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*JCle8owQV3nYZmzL-SQfww.png"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">图1:对NLG服务器的请求体</figcaption></figure><p id="8538" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">NLG服务器的回应是:</p><figure class="nm nn no np gt kd gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/e334f66249a776b80d517d8faf7053c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1102/format:webp/1*Lk67Jb5RfegYP65B3EdicA.png"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">图2:模拟来自NLG服务器的响应</figcaption></figure><p id="7b35" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">出于本文的目的，我们将使用transformers库的<a class="ae mg" href="https://huggingface.co/transformers/main_classes/pipelines.html#transformers.ConversationalPipeline" rel="noopener ugc nofollow" target="_blank">管道特性</a>来生成响应。我们将使用的型号是来自脸书的<a class="ae mg" href="https://huggingface.co/facebook/blenderbot-3B" rel="noopener ugc nofollow" target="_blank"> blenderbot-3B </a>型号。</p><p id="63ef" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">管道是这样定义的:</p><figure class="nm nn no np gt kd gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/50f762894b3eb5fea1caaf654ba9ae87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1264/format:webp/1*3EnPwbV_WByyuyzpCCb5DA.png"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">图3:定义与模型交互的管道</figcaption></figure><p id="fd19" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">生成响应需要创建一个<a class="ae mg" href="https://huggingface.co/transformers/main_classes/pipelines.html#transformers.Conversation" rel="noopener ugc nofollow" target="_blank">对话</a>对象。这个对象需要用户的输入、用户过去的输入和机器人过去的响应。该信息可以从Rasa的<a class="ae mg" href="https://rasa.com/docs/action-server/sdk-tracker" rel="noopener ugc nofollow" target="_blank">跟踪器</a>对象中提取:</p><figure class="nm nn no np gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nw"><img src="../Images/0f678999ef8e347c7524c3226f893926.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1pYHol4TajegUSr-p9JaPA.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">图4:构建对话对象</figcaption></figure><p id="7746" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">最后，我们需要定义一个将返回响应的端点。让我们将这个端点命名为<code class="fe nx ny nz oa b">nlg</code>:</p><figure class="nm nn no np gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ob"><img src="../Images/35a7d88e6e311b32e5efa871fed3eebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1192/format:webp/1*m5XC3J4y01dwQEre4LJBGg.png"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">图5:创建一个POST端点来生成bot的响应</figcaption></figure><h2 id="55b6" class="na kl it bd km nb nc dn kq nd ne dp ku lt nf ng ky lx nh ni lc mb nj nk lg iz bi translated">对话示例</h2><p id="3206" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">现在我们已经准备好和机器人对话了。</p><p id="b958" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">让我们假设一位客户想给John转账，看看对话会如何进行:</p><figure class="nm nn no np gt kd gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/3772a4f0386dd13337ceae1cee1b8acb.png" data-original-src="https://miro.medium.com/v2/resize:fit:788/format:webp/1*2eKkclSl9EsBGh2KFkvikA.png"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">图6:连接到NLG服务器时与机器人交互</figcaption></figure><p id="1e14" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">我们可以用不同的提示开始对话，以构建不同的对话流:</p><figure class="nm nn no np gt kd gh gi paragraph-image"><div class="gh gi od"><img src="../Images/81fc5ff26b1972f0966901b8ccf0be34.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*hqzyIXIBwQRKNXmw22VkiA.png"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">图8:为相同的用例创建不同的对话流</figcaption></figure><p id="37d2" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">使用<a class="ae mg" href="https://rasa.com/docs/rasa-x/user-guide/fix-problems#adding-stories" rel="noopener ugc nofollow" target="_blank"> rasa X </a>很容易将这些对话转换成Rasa期望的培训或测试故事格式。</p><h1 id="ea99" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">后续步骤</h1><h2 id="f2df" class="na kl it bd km nb nc dn kq nd ne dp ku lt nf ng ky lx nh ni lc mb nj nk lg iz bi translated">针对特定领域的对话进行微调</h2><p id="e333" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">图7和图8中的机器人响应听起来很像人类，也很友好，但考虑到手头的任务，例如客户想要转账，这似乎不太合适。例如，在图7的对话中，机器人应该已经询问了客户想要转移多少钱。</p><p id="a09d" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">考虑到用于训练和微调模型的数据集，这并不奇怪(参见<a class="ae mg" href="https://arxiv.org/pdf/2004.13637.pdf" rel="noopener ugc nofollow" target="_blank"> Blenderbot论文</a>的第6节)。</p><p id="1a3e" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">在更多特定领域的对话中微调模型可能有助于机器人提出正确的问题。</p><h2 id="eef7" class="na kl it bd km nb nc dn kq nd ne dp ku lt nf ng ky lx nh ni lc mb nj nk lg iz bi translated">自动生成用户消息</h2><p id="bcee" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">目前的方法需要人类与机器人对话来建立对话。是什么阻止我们用另一个机器人代替人类？</p><h1 id="3d2a" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">结论</h1><p id="608a" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">本文分享了自动生成训练和测试故事来训练和评估rasa机器人的想法。</p><p id="d890" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">请在评论中告诉我你的想法。</p></div></div>    
</body>
</html>