<html>
<head>
<title>FastAPI — The Spiffy Way Beyond Flask!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">FastAPI——超越Flask的精彩方式！</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/fastapi-the-spiffy-way-beyond-flask-b00f4f883e1d?source=collection_archive---------0-----------------------#2020-10-12">https://pub.towardsai.net/fastapi-the-spiffy-way-beyond-flask-b00f4f883e1d?source=collection_archive---------0-----------------------#2020-10-12</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="9960" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="209e" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated"><em class="ko">一个优雅而高效的框架，可在几分钟内公开生产就绪的低延迟API。</em></h2></div><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi kp"><img src="../Images/1d9f63a1d0109ab759d37530a55a8b18.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*du7p50wS_fIsaC_lR18qsg.png"/></div></div></figure><p id="02b6" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">近来，数据科学和机器学习应用呈指数级增长。随着这些数据驱动应用程序的出现，python成为大多数开发人员的首选。在过去的几年里，python已经跃居ML语言的第一名，这主要是因为打包模型并将其作为服务公开的便利性。</p><p id="c229" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">模型准备和训练是机器学习生命周期中的许多步骤之一。除了一个活动的ML应用程序之外，还有多个东西在幕后同时工作。在高层次上，它包括数据清理和准备、选择和微调算法、模型训练、通过公开一个端点(称为<strong class="ld ja"> <em class="lx">、【API】</em></strong><em class="lx">)以端点的形式交付模型预测。</em></p><h2 id="1f62" class="ly lz iq bd ma mb mc dn md me mf dp mg lk mh mi mj lo mk ml mm ls mn mo mp iw bi translated">什么是API？</h2><p id="4cde" class="pw-post-body-paragraph lb lc iq ld b le mq ka lg lh mr kd lj lk ms lm ln lo mt lq lr ls mu lu lv lw ij bi translated">一个<strong class="ld ja">应用编程接口</strong> ( <strong class="ld ja"> API </strong>)是一个计算接口，它定义了多个软件中介之间的交互。它定义了可以进行的调用或请求的种类、如何进行、应该使用的数据格式以及要遵循的约定。</p><blockquote class="mv mw mx"><p id="3732" class="lb lc lx ld b le lf ka lg lh li kd lj my ll lm ln mz lp lq lr na lt lu lv lw ij bi translated"><em class="iq">将FastAPI视为数据科学应用的包装器，以RESTFUL微服务的形式公开其功能。</em></p></blockquote><p id="b8f1" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">自从企业数据科学出现以来，Flask已经成为数据科学家快速公开用于交付应用程序的HTTP端点的标准。它相当轻量级、成熟、文档完善，并且已经存在了足够长的时间，已经在组织中扎根。</p><p id="98cf" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">为了生产一个机器学习模型，标准的方法是将它包装在一个REST API中，并将其部署为一个微服务。Flask目前是编写这些API的事实上的选择，原因有两个:</p><ul class=""><li id="06a9" class="nb nc iq ld b le lf lh li lk nd lo ne ls nf lw ng nh ni nj bi translated">烧瓶是最小的。因为推理API在历史上倾向于简单的<code class="fe nk nl nm nn b">predict()</code>方法，由更固执己见的框架(如Django)引入的复杂性被认为是不必要的。</li><li id="c527" class="nb nc iq ld b le no lh np lk nq lo nr ls ns lw ng nh ni nj bi translated">Flask是用Python写的，Python已经成为机器学习的标准语言。所有主流框架都有Python绑定，几乎所有数据科学家/ML工程师都熟悉它。</li></ul><h2 id="53d5" class="ly lz iq bd ma mb mc dn md me mf dp mg lk mh mi mj lo mk ml mm ls mn mo mp iw bi translated">什么是FastAPI？</h2><p id="c776" class="pw-post-body-paragraph lb lc iq ld b le mq ka lg lh mr kd lj lk ms lm ln lo mt lq lr ls mu lu lv lw ij bi translated">FastAPI是一个现代、快速(高性能)的web框架，用于基于标准Python类型提示用Python 3.6+构建API。<a class="ae nt" href="https://github.com/tiangolo/fastapi" rel="noopener ugc nofollow" target="_blank"> <em class="lx"> FastAPI </em> </a> <em class="lx">是构建在</em><a class="ae nt" href="https://www.starlette.io/" rel="noopener ugc nofollow" target="_blank"><em class="lx">Starlette</em></a><em class="lx">、</em><a class="ae nt" href="https://pydantic-docs.helpmanual.io/" rel="noopener ugc nofollow" target="_blank"><em class="lx">Pydantic</em></a><em class="lx">、以及</em><a class="ae nt" href="https://www.uvicorn.org/" rel="noopener ugc nofollow" target="_blank"><em class="lx">uvicon</em></a><em class="lx">之上的Python API微框架。</em></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi nu"><img src="../Images/cb8aa0fc1d0a281773ff820e4474c234.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vHuTD-DOgJYZKyo2A294pw.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">FastAPI构建在Pydantic和Starlette之上</figcaption></figure><p id="10c4" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">对于开发人员来说，所有的web框架都需要在功能性和灵活性之间取得平衡。Flask的级别很低，足以提供很大的自由度，但是还有很多事情留给开发人员去做。FastAPI就像Flask，但是它设法达到了更健康的平衡。</p><h2 id="a77c" class="ly lz iq bd ma mb mc dn md me mf dp mg lk mh mi mj lo mk ml mm ls mn mo mp iw bi translated">为什么选择FastAPI？</h2><ul class=""><li id="28b4" class="nb nc iq ld b le mq lh mr lk nz lo oa ls ob lw ng nh ni nj bi translated"><strong class="ld ja">原生异步支持:</strong>与Node.js或Go中的框架相比，Python WSGI web框架的最大缺点之一是无法异步处理请求。自从引入ASGI以来，这不再是一个问题，FastAPI正在充分利用这一点。您所要做的只是用关键字<code class="fe nk nl nm nn b">async</code>声明端点，就像这样:</li></ul><pre class="kq kr ks kt gt oc nn od oe aw of bi"><span id="2faf" class="ly lz iq nn b gy og oh l oi oj">@app.post("/")<br/><strong class="nn ja">async</strong> def endpoint():   <br/># ...    <br/># call async functions here with `await`    <br/># ...    <br/>return {"msg": "FastAPI is awesome!"}</span></pre><ul class=""><li id="8f54" class="nb nc iq ld b le lf lh li lk nd lo ne ls nf lw ng nh ni nj bi translated">自动化交互API文档: FastAPI以API文档的形式提供了一个自动化交互接口。它有一个简单而优雅的界面，可以动态创建API文档。FastAPI基于<a class="ae nt" href="https://github.com/OAI/OpenAPI-Specification" rel="noopener ugc nofollow" target="_blank"> OpenAPI </a>和<a class="ae nt" href="http://json-schema.org/" rel="noopener ugc nofollow" target="_blank"> JSON模式</a>的开放标准。因此，只要您使用适当的Pydantic数据类型，它可以自动为web API构建一个SwaggerUI，而无需任何额外的编码。SwaggerUI本质上是交互式的，允许我们直接从浏览器测试API。自动化文档受到APISpec的启发。</li></ul><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ok"><img src="../Images/c063ce8725d7211c930977e4894eb501.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xGpKkkLdVPLOUG6wySV_DA.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">FastAPI应用程序的Swagger UI</figcaption></figure><ul class=""><li id="e087" class="nb nc iq ld b le lf lh li lk nd lo ne ls nf lw ng nh ni nj bi translated"><strong class="ld ja">快速创建REST API端点:</strong> Flask用户必须安装Flask-rest plus包来为他们的数据科学应用程序创建REST端点。FastAPI支持GET、PUT、POST、DELETE、OPTIONS、HEAD、PATCH和TRACE Rest操作，无需任何额外的包。所有路线及其操作都是在文档中自动生成的。</li><li id="e5fc" class="nb nc iq ld b le no lh np lk nq lo nr ls ns lw ng nh ni nj bi translated">依赖注入: FastAPI提供了一个内置的注入系统来处理端点上的依赖。它为实现<a class="ae nt" href="https://fastapi.tiangolo.com/tutorial/security/first-steps/" rel="noopener ugc nofollow" target="_blank">用户认证</a>提供了一种有效的方法。</li><li id="ed27" class="nb nc iq ld b le no lh np lk nq lo nr ls ns lw ng nh ni nj bi translated"><strong class="ld ja">轻松的数据库集成:</strong>就数据库集成而言，FastAPI是同类产品中最简单的web框架。它不会限制您围绕自己选择的几个数据库来构建应用程序。相反，它支持你能想到的所有数据库，并能顺利地将它们集成到你的应用程序中。</li><li id="429b" class="nb nc iq ld b le no lh np lk nq lo nr ls ns lw ng nh ni nj bi translated"><strong class="ld ja">最先进的性能:</strong> FastAPI真的很快！它不仅编码速度快，而且处理请求的速度也非常快！在由<a class="ae nt" href="https://www.techempower.com/benchmarks/#section=test&amp;runid=7464e520-0dc2-473d-bd34-dbdfd7e85911&amp;hw=cl&amp;test=composite&amp;l=zijzen-7&amp;a=2" rel="noopener ugc nofollow" target="_blank"> TechEmpower基准测试工具</a>对多个API框架的性能进行基准测试的调查中，FastAPI的表现远远超过flask。</li></ul><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ol"><img src="../Images/ff5ac57c24761263ea95f5d8e22f9b95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2yLr0U0TnOlTGzgTWU9yUw.png"/></div></div></figure><h2 id="611a" class="ly lz iq bd ma mb mc dn md me mf dp mg lk mh mi mj lo mk ml mm ls mn mo mp iw bi translated">FastAPI的实际应用:</h2><p id="4379" class="pw-post-body-paragraph lb lc iq ld b le mq ka lg lh mr kd lj lk ms lm ln lo mt lq lr ls mu lu lv lw ij bi translated">FastAPI建立在<strong class="ld ja"><em class="lx">【nanos gigantum humeris insidentes】</em></strong>的理念之上，也就是说，如果我站在巨人的肩膀上看得更远。FastAPI站在两大巨头的肩膀上:</p><ul class=""><li id="dc4f" class="nb nc iq ld b le lf lh li lk nd lo ne ls nf lw ng nh ni nj bi translated"><a class="ae nt" href="https://www.starlette.io/" rel="noopener ugc nofollow" target="_blank"><em class="lx">Starlette</em></a><em class="lx">为web部件。</em></li><li id="400c" class="nb nc iq ld b le no lh np lk nq lo nr ls ns lw ng nh ni nj bi translated"><a class="ae nt" href="https://pydantic-docs.helpmanual.io/" rel="noopener ugc nofollow" target="_blank"><em class="lx"/></a><em class="lx">为数据部分。</em></li></ul><p id="16cb" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja">安装</strong></p><p id="6be0" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">FastAPI在PyPI上以易于安装的python包的形式提供。FastAPI最好的一点是它的Flask式简单语法，这使得以前使用过Flask的人很容易适应。</p><pre class="kq kr ks kt gt oc nn od oe aw of bi"><span id="9396" class="ly lz iq nn b gy og oh l oi oj">$ pip install fastapi</span></pre><p id="d2bd" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">由于FastAPI本质上是异步的，它还需要ASGI服务器来公开生产端点，如<a class="ae nt" href="http://www.uvicorn.org/" rel="noopener ugc nofollow" target="_blank">uvicon</a>或<a class="ae nt" href="https://gitlab.com/pgjones/hypercorn" rel="noopener ugc nofollow" target="_blank"> Hypercorn </a>。</p><pre class="kq kr ks kt gt oc nn od oe aw of bi"><span id="dcf8" class="ly lz iq nn b gy og oh l oi oj">$ pip install uvicorn<br/>$ pip install hypercorn</span></pre><p id="0153" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja">带插图的示例</strong></p><p id="784b" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">从FastAPI开始非常简单，您只需要在您的项目中有一个<strong class="ld ja"> <em class="lx"> main.py </em> </strong>文件，您可以在其中使用类似于flask的装饰器轻松定义不同的API端点。</p><pre class="kq kr ks kt gt oc nn od oe aw of bi"><span id="9e2a" class="ly lz iq nn b gy og oh l oi oj"># Import Dependencies<br/>from typing import Optional  <br/>from fastapi import FastAPI  </span><span id="45f8" class="ly lz iq nn b gy om oh l oi oj"># Initialize the app with FastAPI object<br/>app = FastAPI()   </span><span id="63bc" class="ly lz iq nn b gy om oh l oi oj"># First Endpoint<br/>@app.get("/") <br/>def read_root():     <br/>  return {"Hello": "World"}</span><span id="852c" class="ly lz iq nn b gy om oh l oi oj"># Second Endpoint <br/>@app.get("/items/{item_id}") <br/>def read_item(item_id: int, q: Optional[str] = None):     <br/>  return {"item_id": item_id, "q": q}</span></pre><p id="8d71" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">到目前为止，它与你用flask所做的非常相似，你可能想知道我是否必须做同样的事情，把我的代码从Flask转移到FastAPI有什么意义。为了证明你的努力，FastAPI附带了这个惊人的动态交互式API文档生成器。它为你提供了一个更干净、更简单、更优雅的用户界面，你可以从网上用零行HTML代码来测试你的API。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ok"><img src="../Images/8d3527108a1d4a2ed8747e9f507e08f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gR9ZTxxwfqvO0Tx2Qz1ykw.png"/></div></div><figcaption class="nv nw gj gh gi nx ny bd b be z dk translated">即时生成的自动化交互式文档…</figcaption></figure><p id="921d" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">现在我们将看到PUT方法的运行，以及FastAPI如何在其核心使用Pydantic来声明使用标准python类型的函数体。</p><pre class="kq kr ks kt gt oc nn od oe aw of bi"><span id="db97" class="ly lz iq nn b gy og oh l oi oj"># Importing Dependencies <br/>from typing import Optional  <br/>from fastapi import FastAPI <br/>from pydantic import BaseModel</span><span id="b8f3" class="ly lz iq nn b gy om oh l oi oj"># Initialize the app with FastAPI object<br/>app = FastAPI()   </span><span id="7d3f" class="ly lz iq nn b gy om oh l oi oj"># Defining a custom object using Pydantic<br/>class Item(BaseModel):<br/>   str price: float     <br/>   is_offer: Optional[bool] = None   </span><span id="e7fe" class="ly lz iq nn b gy om oh l oi oj"># Endpoint-1 <br/>@app.get("/") <br/>def read_root():     <br/>   return {"Hello": "World"}</span><span id="8307" class="ly lz iq nn b gy om oh l oi oj"># Endpoint-2<br/>@app.get("/items/{item_id}") <br/>def read_item(item_id: int, q: Optional[str] = None): <br/>   return {"item_id": item_id, "q": q}   </span><span id="6dd5" class="ly lz iq nn b gy om oh l oi oj"># Endpoint-3<br/>@app.put("/items/{item_id}") <br/>def update_item(item_id: int, item: Item):     <br/>   return {"item_name": item.name, "item_id": item_id}</span></pre><p id="fd58" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">运行上述代码将导致触发事件，这些事件将根据更新的端点自动创建API doc。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ok"><img src="../Images/c33021ca4a87be73dfb4b5ffa6621199.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XORyc_kUKyY8abIvO4z4OQ.png"/></div></div></figure><p id="1f66" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">通过点击<strong class="ld ja"> <em class="lx">【试用】，</em> </strong>，它会提供一个文本框让你直接从web界面输入<em class="lx"> item_id </em>并与API交互。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ok"><img src="../Images/c64433dd3a30645611b4aa57b2e81611.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GqeLtddnn7HG8Vjub-C-Cw.png"/></div></div></figure><p id="2ccc" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">现在点击<strong class="ld ja"> <em class="lx">“执行”</em> </strong>按钮，用户界面将自动与您的API通信，发送参数，获取结果并在屏幕上显示出来</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="kv kw di kx bf ky"><div class="gh gi ok"><img src="../Images/2cd8c6ed63f2f851762e827e048d0461.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*loWyMDjD5BGdsUurymQNCQ.png"/></div></div></figure><h2 id="b474" class="ly lz iq bd ma mb mc dn md me mf dp mg lk mh mi mj lo mk ml mm ls mn mo mp iw bi translated">摘要</h2><p id="1e35" class="pw-post-body-paragraph lb lc iq ld b le mq ka lg lh mr kd lj lk ms lm ln lo mt lq lr ls mu lu lv lw ij bi translated">FastAPI于2018年首次亮相，与flask相比，它是一个相对较新的框架，但仍然成为构建高性能数据科学应用程序的事实上的选择。它遵循了flask的极简方法，但在此基础上增加了创新功能，使其使用起来非常高效和直观。</p></div><div class="ab cl on oo hu op" role="separator"><span class="oq bw bk or os ot"/><span class="oq bw bk or os ot"/><span class="oq bw bk or os"/></div><div class="ij ik il im in"><p id="eca8" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">如果你想了解更多，或者想让我写更多关于这个主题的东西，请随时联系…</p><p id="cdb1" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">我的社交链接:<a class="ae nt" href="https://www.linkedin.com/in/shubhamsaboo/" rel="noopener ugc nofollow" target="_blank">LinkedIn</a>|<a class="ae nt" href="https://twitter.com/Saboo_Shubham_" rel="noopener ugc nofollow" target="_blank">Twitter</a>|<a class="ae nt" href="https://github.com/Shubhamsaboo" rel="noopener ugc nofollow" target="_blank">Github</a></p><p id="3e00" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><em class="lx">如果你喜欢这篇文章或觉得它有帮助，请花一分钟按一下拍手按钮，它会增加文章对其他媒体用户的可见性。</em></p></div></div>    
</body>
</html>