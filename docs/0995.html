<html>
<head>
<title>How I Use VS Code To Develop And Debug Custom Actions In Rasa</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">我如何使用VS代码在Rasa中开发和调试定制动作</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-i-use-vs-code-to-develop-and-debug-custom-actions-in-rasa-c94b117865c4?source=collection_archive---------1-----------------------#2020-10-02">https://pub.towardsai.net/how-i-use-vs-code-to-develop-and-debug-custom-actions-in-rasa-c94b117865c4?source=collection_archive---------1-----------------------#2020-10-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="1343" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a>，<a class="ae ep" href="https://towardsai.net/p/category/software-engineering" rel="noopener ugc nofollow" target="_blank">软件工程</a></h2><div class=""/><figure class="gl gn ka kb kc kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi jz"><img src="../Images/4c1a4e2a9b610ceab82156b91c86d26a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZU4kHFVUIc5voPwYv5oRYA.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">来源:<a class="ae ko" href="https://bit.ly/3ihHJKz" rel="noopener ugc nofollow" target="_blank">https://bit.ly/3ihHJKz</a></figcaption></figure><h1 id="9f69" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated"><strong class="ak">简介</strong></h1><p id="bd3c" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">在这篇文章中，我分享了我如何使用VS代码在Rasa中迭代开发<a class="ae ko" href="https://rasa.com/docs/rasa/custom-actions" rel="noopener ugc nofollow" target="_blank">自定义动作</a>。</p><p id="16b2" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">重现本文所述结果的代码可以在<a class="ae ko" href="https://github.com/hsm207/vscode_rasa_custom_action_dev" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><p id="a8cb" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">我假设读者熟悉<a class="ae ko" href="https://rasa.com/" rel="noopener ugc nofollow" target="_blank"> Rasa </a>和<a class="ae ko" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS代码</a>。</p><h1 id="12b9" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">动机</h1><p id="39a4" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">想象一下，你在一家披萨店工作，任务是构建一个聊天机器人来订购披萨。</p><p id="7ad8" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">您已经很好地完成了意图和实体识别部分，现在是时候进入支付处理了。这包括根据对话期间收集的时间段计算总账单金额，并与支付提供商联系以管理支付流程。这是一个复杂的步骤，最好通过自定义操作来实现。</p><p id="5555" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">你如何着手开发这样一个定制动作？</p><p id="aee5" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">我更喜欢的工作流程是在REPL的帮助下迭代开发定制动作，以获得即时反馈，并理解聊天机器人在动作被调用时的状态。我不想重复修改自定义动作，重启动作服务器，然后与机器人对话以验证其正确性。</p><p id="ed71" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">据我所知，没有资源描述这样的工作流程。我读过或看过的所有教程都显示了要实现一个自定义动作要写“什么”,而不是“如何”去做。这就像是假设开发人员第一次就能把事情做好…所以我认为分享一个“如何”实现定制动作的方法是个好主意。</p><h1 id="9e71" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">先决条件</h1><p id="1b6d" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">为了不被问题领域的细节分散注意力，我们将使用<code class="fe mq mr ms mt b">rasa init</code>的输出作为开发定制动作的起点。</p><p id="4e59" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">这个模板带有一个名为<code class="fe mq mr ms mt b">action_hello_world </code>的自定义动作，在<code class="fe mq mr ms mt b">actions.py</code>文件中定义，其目的是发出“Hello World”。</p><h1 id="fd80" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">方法学</h1><h2 id="d510" class="mu kq it bd kr mv mw dn kv mx my dp kz ly mz na ld mc nb nc lh mg nd ne ll iz bi translated">概观</h2><p id="0877" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">这些是我们需要遵循的步骤:</p><ul class=""><li id="3528" class="nf ng it lp b lq ml lu mm ly nh mc ni mg nj mk nk nl nm nn bi translated">步骤1:准备自定义操作的框架</li><li id="1dd1" class="nf ng it lp b lq no lu np ly nq mc nr mg ns mk nk nl nm nn bi translated">步骤2:确保可以从对话中调用该操作</li><li id="8a8b" class="nf ng it lp b lq no lu np ly nq mc nr mg ns mk nk nl nm nn bi translated">步骤3:定义一个脚本来启动动作服务器</li><li id="34d6" class="nf ng it lp b lq no lu np ly nq mc nr mg ns mk nk nl nm nn bi translated">步骤4:创建启动动作服务器的配置</li><li id="85cf" class="nf ng it lp b lq no lu np ly nq mc nr mg ns mk nk nl nm nn bi translated">步骤5:在自定义操作代码中插入断点</li><li id="d451" class="nf ng it lp b lq no lu np ly nq mc nr mg ns mk nk nl nm nn bi translated">步骤6:在调试模式下启动动作服务器</li><li id="1577" class="nf ng it lp b lq no lu np ly nq mc nr mg ns mk nk nl nm nn bi translated">第七步:与机器人交谈</li><li id="0032" class="nf ng it lp b lq no lu np ly nq mc nr mg ns mk nk nl nm nn bi translated">第八步:触发动作</li></ul><h2 id="0b7c" class="mu kq it bd kr mv mw dn kv mx my dp kz ly mz na ld mc nb nc lh mg nd ne ll iz bi translated">步骤1:准备自定义操作的框架</h2><p id="123f" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">这是我们运行<code class="fe mq mr ms mt b">rasa init</code>后<code class="fe mq mr ms mt b">actions.py</code>的样子:</p><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/249f6175b0d5bc6320d60ea15a8123cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1378/format:webp/1*l-wNyP1vnYgCJzhT8AD9xQ.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图1:构建定制动作的模板</figcaption></figure><p id="15d7" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">它定义了一个名为<code class="fe mq mr ms mt b">action_hello_world</code>的定制动作，只输出文本“Hello World！”给用户。</p><p id="ba85" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">让我们假设我们想要扩展这个动作来做一些更复杂的事情。我们需要做的第一件事是取消代码的注释。</p><h2 id="d24c" class="mu kq it bd kr mv mw dn kv mx my dp kz ly mz na ld mc nb nc lh mg nd ne ll iz bi translated">步骤2:确保可以从对话中调用该操作</h2><p id="0cb5" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">这需要进行一些配置。简而言之，它们是:</p><ul class=""><li id="ea74" class="nf ng it lp b lq ml lu mm ly nh mc ni mg nj mk nk nl nm nn bi translated">在<code class="fe mq mr ms mt b">endpoints.yml</code>中定义一个<code class="fe mq mr ms mt b">action_endpoint</code>:</li></ul><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/4a19a201a8308408658c01c315c9d4dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1112/format:webp/1*VaDNFipYxK4FFxYEqu5oKg.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图2:如何定义一个动作端点</figcaption></figure><ul class=""><li id="04d3" class="nf ng it lp b lq ml lu mm ly nh mc ni mg nj mk nk nl nm nn bi translated">定义<code class="fe mq mr ms mt b">domain.yml</code>中的动作:</li></ul><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/5e2f7ccbd383e2f8895e303cd5ec90c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:588/format:webp/1*SmMmlnsE6Qdae2lAlv4UiA.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图3:如何在domain.yml中定义定制动作</figcaption></figure><ul class=""><li id="39d3" class="nf ng it lp b lq ml lu mm ly nh mc ni mg nj mk nk nl nm nn bi translated">定义将触发自定义操作的对话。你需要已经为此指定了一些意图和故事。例如:</li></ul><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/d4c7dfa0b1b6b5e653ded453e81715d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1074/format:webp/1*6dUuonO68CHE0MewHbZ0OA.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图4:nlu . yml中触发定制动作的一些示例意图</figcaption></figure><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/aef43c57235afd2dba650264ec74dfe0.png" data-original-src="https://miro.medium.com/v2/resize:fit:990/format:webp/1*MfGObygXCKSXdd3khNqnmA.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图5:触发定制动作的示例故事</figcaption></figure><p id="a33c" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">图4和图5显示，如果用户说“运行定制动作”，那么名为<code class="fe mq mr ms mt b">action_hello_world</code>的定制动作将被调用。请务必更新<code class="fe mq mr ms mt b">domain.yml</code>以包含<code class="fe mq mr ms mt b">trigger_custom_action</code>意图。</p><p id="7c67" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">要验证您的设置是否正确，请在终端中执行<code class="fe mq mr ms mt b">rasa run actions</code>。您将看到一条消息，说明<code class="fe mq mr ms mt b">action_hello_world</code>已注册:</p><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi oc"><img src="../Images/19e573e8fe87a8f35422691fd55be9b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NFrxQgAIHDloXffyI166Og.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图6:当一切设置正确时调用动作服务器的输出</figcaption></figure><h2 id="6ac6" class="mu kq it bd kr mv mw dn kv mx my dp kz ly mz na ld mc nb nc lh mg nd ne ll iz bi translated">步骤3:定义一个脚本来启动动作服务器</h2><p id="a24b" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">让我们创建一个名为<code class="fe mq mr ms mt b">launch_action_server.py</code>的简单python脚本，它将启动动作服务器:</p><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div class="gh gi od"><img src="../Images/b1b72f399db39d31edf5f4c8b7ecfc83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1090/format:webp/1*tNL2P-Houw4O5dE1nBo0JA.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图7:启动动作服务器的简单python脚本</figcaption></figure><h2 id="a2f7" class="mu kq it bd kr mv mw dn kv mx my dp kz ly mz na ld mc nb nc lh mg nd ne ll iz bi translated">步骤4:创建启动动作服务器的配置</h2><p id="fb1a" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">在<code class="fe mq mr ms mt b">.vscode</code>文件夹中，创建一个名为<code class="fe mq mr ms mt b">launch.json</code>的文件，内容如下:</p><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi oe"><img src="../Images/21b2c31dae82179d5655907158e4780a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zg2Pa6Tx-ypUoAmN2c7dIQ.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图8:启动动作服务器的配置</figcaption></figure><h2 id="e9f6" class="mu kq it bd kr mv mw dn kv mx my dp kz ly mz na ld mc nb nc lh mg nd ne ll iz bi translated">步骤5:在自定义操作代码中插入断点</h2><p id="de2b" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">让我们在自定义操作的<code class="fe mq mr ms mt b">run()</code>方法中插入一个断点:</p><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div class="gh gi of"><img src="../Images/c82c2843cf6bb5dab99a010ef50c8335.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*o4GhmoyXlHt3ZNd7ysXIJw.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图9:自定义操作的run()方法中的断点(第25行)</figcaption></figure><h2 id="d832" class="mu kq it bd kr mv mw dn kv mx my dp kz ly mz na ld mc nb nc lh mg nd ne ll iz bi translated">步骤6:在调试模式下启动动作服务器</h2><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi og"><img src="../Images/acf83f71f81df4a942e3592477b5d31f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U5W0TmcuqA4ww-v2Z1qkfw.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图10:如何在调试模式下启动动作服务器</figcaption></figure><h2 id="4721" class="mu kq it bd kr mv mw dn kv mx my dp kz ly mz na ld mc nb nc lh mg nd ne ll iz bi translated">第七步:与机器人交谈</h2><p id="ea2f" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">打开一个综合终端，执行<code class="fe mq mr ms mt b">RASA_SHELL_STREAM_READING_TIMEOUT_IN_SECONDS=3600 rasa shell</code>:</p><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi oh"><img src="../Images/40f6a6739c566b4080e397be30084f89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gUC37RTt8Xa6CjgSSicaQQ.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图11:如何与机器人对话</figcaption></figure><h2 id="019f" class="mu kq it bd kr mv mw dn kv mx my dp kz ly mz na ld mc nb nc lh mg nd ne ll iz bi translated">第八步:触发动作</h2><p id="17ee" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">如步骤2所述，在本例中，我们只需说“运行自定义操作”就可以触发自定义操作:</p><h1 id="d83c" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结果</h1><p id="ff75" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">步骤8的结果是在您在步骤5中指定的断点处暂停代码执行:</p><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi oi"><img src="../Images/a34fbc02dcfc69b1546c922021e55f4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Duc0h2bcptLrYlX9K3TG7w.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图11:执行步骤8的结果</figcaption></figure><p id="44d0" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">这给了你什么？</p><ol class=""><li id="7191" class="nf ng it lp b lq ml lu mm ly nh mc ni mg nj mk oj nl nm nn bi translated">通过查看“变量和调用堆栈”窗格，您可以了解代码运行的环境</li><li id="eda7" class="nf ng it lp b lq no lu np ly nq mc nr mg ns mk oj nl nm nn bi translated">通过将变量/表达式包含在监视窗格中，您可以看到它们是如何随着自定义操作的每一行的执行而演变的</li><li id="2c4f" class="nf ng it lp b lq no lu np ly nq mc nr mg ns mk oj nl nm nn bi translated">您可以在调试控制台中执行任意python代码，这对于检查/修改当前状态和试验代码片段来说非常方便，以确保在给定传递给自定义操作的<code class="fe mq mr ms mt b">run()</code>方法的输入的情况下，代码片段按照您的意图运行。</li></ol><h1 id="1393" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结论</h1><p id="0e0e" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">本文描述了一种在Rasa中交互式开发定制动作的方法，即在定制动作中间暂停代码执行，并使用REPL迭代构建定制动作。</p><p id="f983" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">我希望你已经发现这是有用的。</p><h1 id="6e3e" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">更新日期:2020年10月21日</h1><p id="185d" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我找到了跳过第三步的方法。</p><p id="644f" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">您需要做的就是创建一个任务，以python模块的形式启动操作服务器。</p><p id="a6e2" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">这仅涉及将步骤4更新为:</p><figure class="nu nv nw nx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ok"><img src="../Images/1cc6a7119d906bbb1b4a9d2fed3543ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m1Tf8GTPunvcgMBcTnrscg.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图12:启动动作服务器的新配置</figcaption></figure><p id="d233" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">其余步骤保持不变。</p></div></div>    
</body>
</html>