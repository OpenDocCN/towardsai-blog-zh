<html>
<head>
<title>Technical analysis with python: quickstart guide for pandas_ta</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">python技术分析:熊猫快速入门指南_ta</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/technical-analysis-with-python-quickstart-guide-for-pandas-ta-fe4b152e95a2?source=collection_archive---------1-----------------------#2021-11-08">https://pub.towardsai.net/technical-analysis-with-python-quickstart-guide-for-pandas-ta-fe4b152e95a2?source=collection_archive---------1-----------------------#2021-11-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="0a89" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-analysis" rel="noopener ugc nofollow" target="_blank">数据分析</a></h2><div class=""/><div class=""><h2 id="8749" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">用熊猫_ta做技术分析。完整的代码<a class="ae kr" href="https://github.com/arditoibryan/Projects/blob/master/20211106_pandas_ta/pandas_ta.ipynb" rel="noopener ugc nofollow" target="_blank">可在我的回购</a>。</h2></div><p id="238a" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">互联网上最简单、最强大的技术库之一叫做pandas_ta。这个python库为您提供了一个简化的API，允许您从时间序列中提取技术分析指标。</p><p id="d9d3" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">虽然您可能会将这些函数应用于股票价格，但您可以将任何时间序列与股票价格配对，例如情绪甚至经济指标。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/3a2cb5157d9b04dce9254647fcf4d627.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ow_jzMo8wd4ep1Q4.jpg"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">TradersDNA发布的照片</figcaption></figure><h2 id="6b88" class="me mf it bd mg mh mi dn mj mk ml dp mm lb mn mo mp lf mq mr ms lj mt mu mv iz bi translated">为什么要用熊猫_ta？</h2><p id="5ee0" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">与竞争对手的库相比，pandas_ta:</p><ul class=""><li id="5d17" class="nb nc it ku b kv kw ky kz lb nd lf ne lj nf ln ng nh ni nj bi translated">更易于使用</li></ul><p id="0718" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">有几种方法可以从股票价格中提取技术分析指标，其中一种方法是自己编码。如果你只需要使用像移动平均线这样的简单指标，这种方法不会给你带来太多的麻烦，但是当你可能需要使用更复杂的数学模型时，你可能想要使用预制的库:这就是API的用途，它们提供了一个简化的高级接口，调节了低级代码的复杂性。</p><ul class=""><li id="1de5" class="nb nc it ku b kv kw ky kz lb nd lf ne lj nf ln ng nh ni nj bi translated">易于安装</li><li id="c2c5" class="nb nc it ku b kv nk ky nl lb nm lf nn lj no ln ng nh ni nj bi translated">使用熊猫数据框架</li></ul><p id="43c2" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">当存储股票信息时，我能想到的第一个方法是使用熊猫数据框架。这种方法在python用户中非常普遍，pandas_ta将使事情变得更容易。因为pandas库仅限于Python，所以还有其他存储多维数据(如股票价格)的常见方法，例如使用JSON文件。</p><ul class=""><li id="da55" class="nb nc it ku b kv kw ky kz lb nd lf ne lj nf ln ng nh ni nj bi translated">在编码人员中很常见</li></ul><p id="48f8" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">当一个开发人员社区使用一个产品或库时，社区建议的持续反馈和改进会使产品变得更强大。它也帮助初学者寻找像这样的快速入门指南。当没有人决定撰写或发布关于一个库的代码时，从例子中学习如何使用它是不可能的，除非库指令是透明的，而这通常不是这样。</p><ul class=""><li id="88c3" class="nb nc it ku b kv kw ky kz lb nd lf ne lj nf ln ng nh ni nj bi translated">仍在开发中</li></ul><p id="4368" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">pandas_ta的另一个优势是它的开发者和它的社区仍然在更新软件和进行升级，使这个库日益强大。</p><h2 id="4dce" class="me mf it bd mg mh mi dn mj mk ml dp mm lb mn mo mp lf mq mr ms lj mt mu mv iz bi translated">安装熊猫_ta</h2><p id="1d44" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">与安装起来有些困难的许多其他库相比，这个库既容易安装，又可以作为最流行的python电子表格管理系统pandas的扩展。</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="fffa" class="me mf it nq b gy nu nv l nw nx">pip install pandas_ta</span></pre><h2 id="6291" class="me mf it bd mg mh mi dn mj mk ml dp mm lb mn mo mp lf mq mr ms lj mt mu mv iz bi translated">下载股票价格</h2><p id="e575" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">用技术分析库做实验的美妙之处，首先是不断地在新股票上做实验。下载股票价格总是具有挑战性，因为对它们有巨大的需求。因此，没有供应商会免费或不经注册就给你股票价格。个人建议alpha vantage ( <a class="ae kr" rel="noopener ugc nofollow" target="_blank" href="/stock-downloader-api-a9e95c913363">文章带说明此处</a>，API免费使用)。</p><p id="58f2" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">然而，如果你的目标不是直接在市场上实验，而是对你的算法进行回溯测试，你可以使用一个程序性股票生成器(我把它开源，并在本文中描述了<a class="ae kr" rel="noopener ugc nofollow" target="_blank" href="/random-stock-generator-monte-carlo-simulations-in-finance-b9951a174271">)，或者更好的是一个OCHL股票生成器(</a><a class="ae kr" rel="noopener ugc nofollow" target="_blank" href="/procedural-ochl-stock-generator-54ce041931be">链接此处</a>)。</p><p id="632b" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">请注意，pandas_ta要求数据以特定的格式组织:</p><ul class=""><li id="78fa" class="nb nc it ku b kv kw ky kz lb nd lf ne lj nf ln ng nh ni nj bi translated">日期必须采用pandas.datetime格式</li><li id="1ec4" class="nb nc it ku b kv nk ky nl lb nm lf nn lj no ln ng nh ni nj bi translated">这些列必须采用OCHL格式</li></ul><p id="b9a8" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">OCHL指的是金融中存储价格的一些常用指标:开盘、收盘、盘高和盘低。不同的技术分析指标可能只需要这些列中的一列或多列，所以拥有全部四列将允许我们模拟库中大多数可用的指标。</p><h1 id="8068" class="ny mf it bd mg nz oa ob mj oc od oe mm ki of kj mp kl og km ms ko oh kp mv oi bi translated">运行算法</h1><h2 id="89f5" class="me mf it bd mg mh mi dn mj mk ml dp mm lb mn mo mp lf mq mr ms lj mt mu mv iz bi translated">生成程序库存</h2><p id="93a8" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">在我们的例子中，我已经在一个笔记本中准备了一组函数，它们将生成一个用于实验目的的过程化OCHL库存。</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="ec62" class="me mf it nq b gy nu nv l nw nx">df_OCHL = simulate_OCHL_stock(simulate_stock(1000, 0, 0.01, 0, 365), graph_timeseries=True, graph_OCHL=True)</span></pre><p id="4f4f" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">正如我们所看到的，每当我运行该算法，一个新的时间序列就会产生4个维度，每个维度代表股票的一个OCHL数据。默认情况下，该股票只工作365天(毕竟是为了测试)。让我们看看生成的数据。</p><p id="4718" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">通过使用嵌入的布尔参数<strong class="ku jd"> graph_timeseries </strong>和<strong class="ku jd"> graph_OCHL </strong>，我们可以很容易地将数据图形化。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi oj"><img src="../Images/66d459f30327316b6648ebeaa77a3bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*atIcYf2kapRis4vQJgbU0A.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">收盘股票价格生成数据</figcaption></figure><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi ok"><img src="../Images/7282d5324f35b93d6ef8f060807bff48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SWZRPj74LQOHh60_0iQC7g.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">OCHL生成的数据</figcaption></figure><p id="0394" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">如果我们看一下数据帧，这就是生成的数据的样子。注意，这种格式正是pandas_ta所要求的数据模式。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/a17ae6722f94e123ab313ee1b1737d42.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*5b5MUc1CrP0Ovz5Rr4HAuw.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">有开盘、收盘、高、低柱的股票</figcaption></figure><h2 id="80d8" class="me mf it bd mg mh mi dn mj mk ml dp mm lb mn mo mp lf mq mr ms lj mt mu mv iz bi translated">创建备份</h2><p id="77fa" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">如果你不熟悉熊猫是如何工作的，我们不能简单地将一个数据帧分配给第二个变量来复制它。我们需要使用复制功能来克隆原始数据帧。</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="e010" class="me mf it nq b gy nu nv l nw nx">df_backup = df_OCHL.copy()</span></pre><p id="5bd0" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">我制作数据副本的原因是，pandas_ta将直接编辑我们正在应用技术分析策略的数据集。它不像常规函数那样工作，在常规函数中，我们可以输入数据帧并接收副本作为输出。</p><p id="b68d" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">如果我们对过程模式的外观感到满意，我们可能不希望每次运行算法时都创建一个全新的股票价格。这样，我们就可以安全地开始试验备份副本了。</p><h2 id="01a0" class="me mf it bd mg mh mi dn mj mk ml dp mm lb mn mo mp lf mq mr ms lj mt mu mv iz bi translated">应用熊猫_ta策略:SMA</h2><p id="7e5f" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">最流行的技术分析策略叫做简单移动平均线。该技术包括创建两条不同长度的均线，并用交叉点作为买卖信号。</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="1504" class="me mf it nq b gy nu nv l nw nx">#import backup<br/>df = df_backup.copy()</span><span id="24fc" class="me mf it nq b gy om nv l nw nx">MyStrategy = ta.Strategy(<br/>    name="DCSMA10",<br/>    ta=[<br/>        {"kind": "ohlc4"},<br/>        {"kind": "sma", "length": 10},<br/>        {"kind": "sma", "length": 20},<br/>    ]<br/>)</span><span id="b646" class="me mf it nq b gy om nv l nw nx"># (2) Run the Strategy<br/>df.ta.strategy(MyStrategy)<br/>df = df.drop(['low', 'high', 'open'], axis=1)<br/>graph_stock(df)</span></pre><p id="107a" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">应用该策略后，我们可以看到新列是如何添加到原始数据集中的。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi on"><img src="../Images/1ae9b5b4921425961bbbf8cd28cf1a49.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l2a3AgpQ_0dafuLP7pv4fQ.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">两个不同长度的简单移动平均线</figcaption></figure><h2 id="e1ad" class="me mf it bd mg mh mi dn mj mk ml dp mm lb mn mo mp lf mq mr ms lj mt mu mv iz bi translated">布林线</h2><p id="601e" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">当然，我们也可以采用更复杂的技术，如布林线:这种策略包括当价格低于较低波段时买入股票，当价格高于较高波段时卖出股票。</p><p id="8ccd" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">假设是当趋势的导数(即瞬时变化率)已经达到根据我们的参数的最大容差，并且是股票反转其趋势的适当时间。</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="3980" class="me mf it nq b gy nu nv l nw nx">#import backup<br/>df = df_backup.copy()</span><span id="6143" class="me mf it nq b gy om nv l nw nx">MyStrategy = ta.Strategy(<br/>    name="strategy_3",<br/>    ta=[{<br/>        "close": 'close', <br/>        "kind": "bbands", <br/>        "length": 15,<br/>        "std": 2<br/>    }]<br/>)</span><span id="7c6d" class="me mf it nq b gy om nv l nw nx"># (2) Run the Strategy<br/>df.ta.strategy(MyStrategy)<br/>df = df.drop(['low', 'high', 'open'], axis=1)<br/>graph_stock(df)</span></pre><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi oo"><img src="../Images/a68f7d57dd3f4c136e081fed762214fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FCG5t2DqJQgVzgYIOl45vg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">标准偏差为2的布林线</figcaption></figure><h1 id="05c5" class="ny mf it bd mg nz oa ob mj oc od oe mm ki of kj mp kl og km ms ko oh kp mv oi bi translated">结论</h1><p id="c698" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">熊猫_ta，尤其是设置后，非常简单和直观的使用，并有80多个可用的指标，你可以简单地调用字符串。</p></div></div>    
</body>
</html>