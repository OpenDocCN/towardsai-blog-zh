<html>
<head>
<title>Electricity Production Forecasting Using Arima Model in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中Arima模型的发电量预测</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/electricity-production-forecasting-using-arima-model-in-python-d3bf38dc3517?source=collection_archive---------1-----------------------#2021-02-18">https://pub.towardsai.net/electricity-production-forecasting-using-arima-model-in-python-d3bf38dc3517?source=collection_archive---------1-----------------------#2021-02-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="05fb" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-visualization" rel="noopener ugc nofollow" target="_blank">数据可视化</a></h2><div class=""/><div class=""><h2 id="efac" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">使用Python逐步实现ARIMA模型的指南。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/422f2b986997b778295a163eacc4a8fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*VagjGZhpCyoxzPf3"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">马太·亨利摄(<a class="ae le" href="https://unsplash.com/photos/yETqkLnhsUI" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="30ea" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">ARIMA是“自回归综合移动平均”的缩写，用于时间序列数据，它提供了对过去值的洞察，如滞后和预测误差，可用于预测未来值。</p><p id="5b02" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">要了解更多关于ARIMA模型，请查看下面的文章:</p><div class="mb mc gp gr md me"><a href="https://jayashree8.medium.com/a-brief-introduction-to-arima-models-for-time-series-forecasting-3328ae5067bf" rel="noopener follow" target="_blank"><div class="mf ab fo"><div class="mg ab mh cl cj mi"><h2 class="bd ja gy z fp mj fr fs mk fu fw iz bi translated">时间序列预测的ARIMA模型简介</h2><div class="ml l"><h3 class="bd b gy z fp mj fr fs mk fu fw dk translated">这篇文章谈论ARIMA模型及其背后的概念。</h3></div><div class="mm l"><p class="bd b dl z fp mj fr fs mk fu fw dk translated">jayashree8.medium.com</p></div></div><div class="mn l"><div class="mo l mp mq mr mn ms ky me"/></div></div></a></div><h1 id="4354" class="mt mu iq bd mv mw mx my mz na nb nc nd kf ne kg nf ki ng kj nh kl ni km nj nk bi translated">如何实施ARIMA模型来帮助预测？</h1><p id="7cdf" class="pw-post-body-paragraph lf lg iq lh b li nl ka lk ll nm kd ln lo nn lq lr ls no lu lv lw np ly lz ma ij bi translated">涉及的步骤如下:</p><ol class=""><li id="4dd9" class="nq nr iq lh b li lj ll lm lo ns ls nt lw nu ma nv nw nx ny bi translated">通过绘图或可视化来分析时间序列数据。</li><li id="7061" class="nq nr iq lh b li nz ll oa lo ob ls oc lw od ma nv nw nx ny bi translated">以平稳形式转换时间序列数据。</li><li id="5693" class="nq nr iq lh b li nz ll oa lo ob ls oc lw od ma nv nw nx ny bi translated">绘制ACF和PACF图。</li><li id="c9b3" class="nq nr iq lh b li nz ll oa lo ob ls oc lw od ma nv nw nx ny bi translated">构建ARIMA模型。</li><li id="4e8e" class="nq nr iq lh b li nz ll oa lo ob ls oc lw od ma nv nw nx ny bi translated">使用创建的模型进行预测。</li></ol><h1 id="5e9e" class="mt mu iq bd mv mw mx my mz na nb nc nd kf ne kg nf ki ng kj nh kl ni km nj nk bi translated">使用Python实现</h1><p id="1a3f" class="pw-post-body-paragraph lf lg iq lh b li nl ka lk ll nm kd ln lo nn lq lr ls no lu lv lw np ly lz ma ij bi translated"><strong class="lh ja"> →进口包装</strong></p><p id="031e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">像NumPy和pandas这样用于处理数据的基本包都是导入的。为了可视化，使用matplotlib。为了实现ARIMA模型，引入了statsmodel。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="ba74" class="oj mu iq of b gy ok ol l om on"><strong class="of ja">&gt;&gt;&gt; import</strong> numpy <strong class="of ja">as</strong> np<br/><strong class="of ja">&gt;&gt;&gt; import</strong> pandas <strong class="of ja">as</strong> pd<br/><strong class="of ja">&gt;&gt;&gt; import</strong> statsmodels.api <strong class="of ja">as</strong> sm<br/><strong class="of ja">&gt;&gt;&gt; import</strong> matplotlib.pyplot <strong class="of ja">as</strong> plt<br/><strong class="of ja">&gt;&gt;&gt; %</strong>matplotlib inline</span></pre><p id="6b58" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> →分析数据</strong></p><p id="01b0" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">所使用的数据是电力生产的季节性数据。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="8826" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; df <strong class="of ja">=</strong> pd.read_csv('Electric_Production.csv')<br/>&gt;&gt;&gt; df.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/c823b9102d147c91dab34460a3b0dec8.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/1*yXxymdfDC4-NL3AUSdEETw.png"/></div></figure><p id="56ff" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了便于使用，更改了列名。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="91ea" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; df.columns <strong class="of ja">=</strong> ['Date','Production']<br/>&gt;&gt;&gt; df.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi op"><img src="../Images/aba917773ca05a3d794eaff0b9005c96.png" data-original-src="https://miro.medium.com/v2/resize:fit:398/format:webp/1*GAF7hJW9ubpJWMERN-3CGw.png"/></div></figure><p id="130c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，为了处理时间序列数据，“日期”列被转换为日期时间索引。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="961e" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; df['Date'] <strong class="of ja">=</strong> pd.to_datetime(df['Date'])<br/>&gt;&gt;&gt; df.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/425a31be166ee3e3ba276289a88bf60d.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*16IJqeEPaShAF8yYw3RMEA.png"/></div></figure><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="2fe2" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; df.set_index('Date',inplace<strong class="of ja">=True</strong>)<br/>&gt;&gt;&gt; df.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi op"><img src="../Images/9b749c0cd2b68cf65b7a65cecfb22359.png" data-original-src="https://miro.medium.com/v2/resize:fit:398/format:webp/1*MID9vMPNqBARdMyWGft_0w.png"/></div></figure><p id="b0db" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> →数据可视化</strong></p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="88ae" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; df.plot()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi or"><img src="../Images/a099ee03656c10aec73f01c57eb0af3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*t-_Q4YpI1nifcy8faA5Vog.png"/></div></figure><p id="2b50" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从图中可以看出，这是季节性数据，因为它有一定的季节性和上升趋势。</p><p id="7129" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在比较12个月的简单移动平均线和序列来确定趋势。标准偏差也绘制出来，看看是否有任何变化或没有。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="723d" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; df['Production'].rolling(12).mean().plot(label<strong class="of ja">=</strong>'12 SMA',figsize<strong class="of ja">=</strong>(16,8))<br/>&gt;&gt;&gt; df['Production'].rolling(12).std().plot(label<strong class="of ja">=</strong>'12 STD')<br/>&gt;&gt;&gt; df['Production'].plot()<br/>&gt;&gt;&gt; plt.legend()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi os"><img src="../Images/7de32a76c6046d8b744f06716355b20c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C0aRzcYrg_YlKg2I2D_ZtQ.png"/></div></div></figure><p id="1f0b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从上面的图可以看出，标准偏差变化不大，所以没有太大的差异。</p><p id="0dc1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> →将时间序列数据分解为其趋势、季节性和剩余成分。</strong></p><p id="284f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">statsmodels用于分解。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="a589" class="oj mu iq of b gy ok ol l om on"><strong class="of ja">&gt;&gt;&gt; from</strong> statsmodels.tsa.seasonal <strong class="of ja">import</strong> seasonal_decompose</span><span id="2eb9" class="oj mu iq of b gy ot ol l om on">&gt;&gt;&gt; decomp <strong class="of ja">=</strong> seasonal_decompose(df['Production'])<br/>&gt;&gt;&gt; fig <strong class="of ja">=</strong> decomp.plot()<br/>&gt;&gt;&gt; fig.set_size_inches(14,7)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ou"><img src="../Images/32c61fd707f7181ed0bea875e99dea4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xg3ASesY0S83PJQ0taCntw.png"/></div></div></figure><p id="ffe3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">趋势误差、季节性误差和残差可以在这里单独看到。</p><p id="4236" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> →将数据转换为静态形式</strong></p><p id="5ebc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">首先使用Dickey-Fuller测试对数据进行测试，以检查数据是否处于稳定形式，然后改变其形式。</p><p id="bf94" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Dickey-Fuller的零假设是存在单位根，并且它是非平稳时间序列。另一个假设是没有单位根，数列是平稳的。</p><p id="d00b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们将借助参数“p”进行测试。如果p很小(p&lt;=0.05)，我们拒绝零假设，否则不拒绝零假设。</p><p id="e16c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从statsmodels包中，导入了增强的dickey-fuller测试函数。它返回一个由以下值组成的元组:adf、pvalue、usedlag、nobs、critical values、icbest和resstore。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="8d42" class="oj mu iq of b gy ok ol l om on"><strong class="of ja">&gt;&gt;&gt; from</strong> statsmodels.tsa.stattools <strong class="of ja">import</strong> adfuller</span></pre><p id="3fd2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然后在数据集的生产列上调用该函数。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="767f" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; fuller_test <strong class="of ja">=</strong> adfuller(df['Production'])<br/>&gt;&gt;&gt; fuller_test</span><span id="c0ec" class="oj mu iq of b gy ot ol l om on">(-2.256990350047239,<br/> 0.18621469116586975,<br/> 15,<br/> 381,<br/> {'1%': -3.4476305904172904,<br/>  '5%': -2.869155980820355,<br/>  '10%': -2.570827146203181},<br/> 1840.8474501627156)</span></pre><p id="3579" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在p值被打印出来，使用p值可以确定数据是否是稳定的。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="a9bc" class="oj mu iq of b gy ok ol l om on"><strong class="of ja">&gt;&gt;&gt; def</strong> test_p_value(data):<br/>        fuller_test <strong class="of ja">=</strong> adfuller(data)<br/>        print('P-value: ',fuller_test[1])<br/>        <strong class="of ja">if</strong> fuller_test[1] <strong class="of ja">&lt;=</strong> 0.05:<br/>            print('Reject null hypothesis, data is stationary')<br/>        <strong class="of ja">else</strong>:<br/>            print('Do not reject null hypothesis, data is not stationary')</span><span id="b920" class="oj mu iq of b gy ot ol l om on">&gt;&gt;&gt; test_p_value(df['Production'])</span><span id="e07f" class="oj mu iq of b gy ot ol l om on">P-value:  0.18621469116586975<br/>Do not reject null hypothesis, data is not stationary</span></pre><p id="dbcc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">由于数据不是静态的，所以要进行差分。区别在于时间序列从一个时期到下一个时期的变化。计算第一差值、第二差值和季节差值，并检查每个差值的p值。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="df2b" class="oj mu iq of b gy ok ol l om on">df['First_diff'] <strong class="of ja">=</strong> df['Production'] <strong class="of ja">-</strong> df['Production'].shift(1)<br/>df['First_diff'].plot()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi or"><img src="../Images/f3c96d736a4265b324431da492f9e0fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*_3xtTxCVVLD0SHfbMnQaDg.png"/></div></figure><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="1ebb" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; test_p_value(df['First_diff'].dropna())</span><span id="d306" class="oj mu iq of b gy ot ol l om on">P-value:  4.0777865655398996e-10<br/>Reject null hypothesis, data is stationary</span></pre><p id="5f51" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在第一个差异中，我们得到了稳态形式的数据。如果需要第二个差异，那么将会完成以下操作。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="b60e" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; df['Second_diff'] <strong class="of ja">=</strong> df['First_diff'] <strong class="of ja">-</strong> df['First_diff'].shift(1)<br/>&gt;&gt;&gt; df['Second_diff'].plot()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/261b4fb829323ce78a7c731ee8f94891.png" data-original-src="https://miro.medium.com/v2/resize:fit:924/format:webp/1*XyIDGoicUtdeijgX-hXOrA.png"/></div></figure><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="75b1" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; test_p_value(df['Second_diff'].dropna())</span><span id="f6f0" class="oj mu iq of b gy ot ol l om on">P-value:  4.1836937480000375e-17<br/>Reject null hypothesis, data is stationary</span></pre><p id="2800" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">季节差异也可以采取如下方式。这种转变将会持续整整12个赛季。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="f213" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; df['Seasonal_diff'] <strong class="of ja">=</strong> df['Production'] <strong class="of ja">-</strong> df['Production'].shift(12)<br/>&gt;&gt;&gt; df['Seasonal_diff'].plot()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/2efe0e46918361ec7f02bd484e83ae31.png" data-original-src="https://miro.medium.com/v2/resize:fit:934/format:webp/1*VcUcamOmda8UkUibVXL2OQ.png"/></div></figure><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="541b" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; test_p_value(df['Seasonal_diff'].dropna())</span><span id="b771" class="oj mu iq of b gy ot ol l om on">P-value:  8.812644938089026e-07<br/>Reject null hypothesis, data is stationary</span></pre><p id="79a2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> →绘制ACF和PACF图</strong></p><p id="3d5e" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从statsmodels包中导入ACF和PACF绘图函数。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="acc2" class="oj mu iq of b gy ok ol l om on"><strong class="of ja">&gt;&gt;&gt; from</strong> statsmodels.graphics.tsaplots <strong class="of ja">import</strong> plot_acf, plot_pacf</span><span id="b84c" class="oj mu iq of b gy ot ol l om on">&gt;&gt;&gt; first_diff <strong class="of ja">=</strong> plot_acf(df['First_diff'].dropna())</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/f6cf5b2a02982569f04eed9b85905f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:948/format:webp/1*7u7I0ue7nyBLq5cdc58u7w.png"/></div></figure><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="e434" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; sec_diff <strong class="of ja">=</strong> plot_pacf(df['Second_diff'].dropna())</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi or"><img src="../Images/981e6d31222161e2a175d8091a517054.png" data-original-src="https://miro.medium.com/v2/resize:fit:940/format:webp/1*Ljs8HtqF0KPP6wUq_xf-Qg.png"/></div></figure><p id="1583" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在将绘制最终的ACF和PACF图，这些图将被进一步使用。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="cbdf" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; p1 <strong class="of ja">=</strong> plot_acf(df['Seasonal_diff'].dropna())<br/>&gt;&gt;&gt; p2 <strong class="of ja">=</strong> plot_pacf(df['Seasonal_diff'].dropna())</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oy"><img src="../Images/2f3cf398687d431e2823ca4ca7ef1f63.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*L6mg_p8YhoHa6DGcI_KMdg.png"/></div></figure><p id="3972" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> →构建ARIMA模型</strong></p><p id="59ee" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">对于非季节性数据，可以从statsmodels模块导入ARIMA模型。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="10a7" class="oj mu iq of b gy ok ol l om on"><strong class="of ja">&gt;&gt;&gt; from</strong> statsmodels.tsa.arima_model <strong class="of ja">import</strong> ARIMA</span></pre><p id="d4c4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">对于季节性数据，可以从statsmodels模块导入季节性ARIMA模型。这里使用的数据是季节性数据，因此引入了季节性ARIMA模型。传递的参数是生产列、订单和季节性订单。</p><p id="8fd8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">order:AR参数、差异和MA参数的数量的模型的(p，d，q)阶。</p><p id="c0b2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">季节性顺序:AR参数、差异、MA参数和周期的模型季节性组件的(P，D，Q，s)顺序。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="eb95" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; model <strong class="of ja">=</strong> sm.tsa.statespace.SARIMAX(df['Production'],order<strong class="of ja">=</strong>(0,1,0),seasonal_order<strong class="of ja">=</strong>(1,1,1,12))</span></pre><p id="970f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一旦创建了模型，接下来要做的就是拟合模型。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="8b04" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; results <strong class="of ja">=</strong> model.fit()<br/>&gt;&gt;&gt; results.summary()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/44c71f329e0a605eadb8940fb1e7b598.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*U6F6q1DGqnFINsXTk-0Dsw.png"/></div></figure><p id="9ed7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">要了解残差值或误差，可以对结果调用“resid”方法。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="585d" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; results.resid</span><span id="46c1" class="oj mu iq of b gy ot ol l om on">Date<br/>1985-01-01    72.505200<br/>1985-02-01    -1.833200<br/>1985-03-01    -8.221800<br/>1985-04-01    -4.978800<br/>1985-05-01    -2.156300<br/>                ...    <br/>2017-09-01     0.529985<br/>2017-10-01     4.057874<br/>2017-11-01     0.690663<br/>2017-12-01     2.477697<br/>2018-01-01     6.953533<br/>Length: 397, dtype: float64</span></pre><p id="bf79" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">可以创建剩余点的绘图。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="1a29" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; results.resid.plot()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/a8bb2f38cbcbbbfb96b808dfd6f7fc39.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*pyc9O6OvfFO1vsDvQWJEHA.png"/></div></figure><p id="d49d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过绘制KDE可以看出误差的分布。从下图可以看出，误差分布在0附近，这很好。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="fb5a" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; results.resid.plot(kind<strong class="of ja">=</strong>'kde')</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pb"><img src="../Images/becbccd5a4141a715decc10fb3b0dc6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*GOZKKh83GH1i4bLPNyfwxw.png"/></div></figure><p id="66c3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> →预测或预报</strong></p><p id="813b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过预测这些值，可以确定模型的性能。首先，我们可以看看它如何预测现在的数据，然后再预测未来的数据。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="3be7" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; df['prediction'] <strong class="of ja">=</strong> results.predict()<br/>&gt;&gt;&gt; df[['Production','prediction']].plot(figsize<strong class="of ja">=</strong>(12,8))</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pc"><img src="../Images/5b412f90378a195de3b45bc18b2e0d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dMoCgVlwWczV-GseONIwhA.png"/></div></div></figure><p id="7086" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从上图可以看出，该模型在预测当前数据方面做得很好。现在，为了预测未来，我们可以向数据集中添加更多具有空值的月份，并对其进行预测。这可以通过熊猫来实现。获取最后一个索引，即最后一个日期，并向其添加一个月偏移量，从1开始一直到24。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="ead5" class="oj mu iq of b gy ok ol l om on"><strong class="of ja">&gt;&gt;&gt; from</strong> pandas.tseries.offsets <strong class="of ja">import</strong> DateOffset<br/>&gt;&gt;&gt; extra_dates <strong class="of ja">=</strong> [df.index[<strong class="of ja">-</strong>1] <strong class="of ja">+</strong> DateOffset(months<strong class="of ja">=</strong>m) <strong class="of ja">for</strong> m <strong class="of ja">in</strong> range (1,24)]</span><span id="a92d" class="oj mu iq of b gy ot ol l om on">&gt;&gt;&gt; extra_dates<br/>[Timestamp('2018-02-01 00:00:00'),<br/> Timestamp('2018-03-01 00:00:00'),<br/> Timestamp('2018-04-01 00:00:00'),<br/> Timestamp('2018-05-01 00:00:00'),<br/> Timestamp('2018-06-01 00:00:00'),<br/> Timestamp('2018-07-01 00:00:00'),<br/> Timestamp('2018-08-01 00:00:00'),<br/> Timestamp('2018-09-01 00:00:00'),<br/> Timestamp('2018-10-01 00:00:00'),<br/> Timestamp('2018-11-01 00:00:00'),<br/> Timestamp('2018-12-01 00:00:00'),<br/> Timestamp('2019-01-01 00:00:00'),<br/> Timestamp('2019-02-01 00:00:00'),<br/> Timestamp('2019-03-01 00:00:00'),<br/> Timestamp('2019-04-01 00:00:00'),<br/> Timestamp('2019-05-01 00:00:00'),<br/> Timestamp('2019-06-01 00:00:00'),<br/> Timestamp('2019-07-01 00:00:00'),<br/> Timestamp('2019-08-01 00:00:00'),<br/> Timestamp('2019-09-01 00:00:00'),<br/> Timestamp('2019-10-01 00:00:00'),<br/> Timestamp('2019-11-01 00:00:00'),<br/> Timestamp('2019-12-01 00:00:00')]</span></pre><p id="fe2d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在创建另一个数据帧，将这些额外的未来日期值作为索引，其余的列值为null。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="28ed" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; forecast_df <strong class="of ja">=</strong> pd.DataFrame(index<strong class="of ja">=</strong>extra_dates,columns<strong class="of ja">=</strong>df.columns)<br/>&gt;&gt;&gt; forecast_df.head()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi pd"><img src="../Images/3485bff78eb26cdbb0bcdc8a4c1538fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1144/format:webp/1*PjODngwjek1Y3dcHM18s6A.png"/></div></figure><p id="5ead" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，原始数据帧和预测数据帧被连接成一个用于预测的数据帧。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="efd0" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; final_df <strong class="of ja">=</strong> pd.concat([df,forecast_df])</span></pre><p id="6e33" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，我们可以通过在调用“预测”函数时提及开始和结束参数来预测结束数据点的值。</p><pre class="kp kq kr ks gt oe of og oh aw oi bi"><span id="1822" class="oj mu iq of b gy ok ol l om on">&gt;&gt;&gt; final_df['prediction'] <strong class="of ja">=</strong> results.predict(start<strong class="of ja">=</strong>396, end<strong class="of ja">=</strong>430)<br/>&gt;&gt;&gt; final_df[['Production','prediction']].plot(figsize<strong class="of ja">=</strong>(12,8))</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pe"><img src="../Images/1d4fa7a3d38ef80c4ea3e8df00433fb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*allbxNQj6rTyp1akTTP_Fw.png"/></div></div></figure><p id="9644" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">对于未来值，可以清楚地看到预测线。</p><h1 id="fec2" class="mt mu iq bd mv mw mx my mz na nb nc nd kf ne kg nf ki ng kj nh kl ni km nj nk bi translated">结论</h1><p id="1bca" class="pw-post-body-paragraph lf lg iq lh b li nl ka lk ll nm kd ln lo nn lq lr ls no lu lv lw np ly lz ma ij bi translated">ARIMA模型被成功地用于预测发电量的未来值，这是一个具有非平稳行为的季节性数据集。使用适当的步骤，将数据转换为平稳形式，并建立预测模型。</p></div><div class="ab cl pf pg hu ph" role="separator"><span class="pi bw bk pj pk pl"/><span class="pi bw bk pj pk pl"/><span class="pi bw bk pj pk"/></div><div class="ij ik il im in"><blockquote class="pm"><p id="fa48" class="pn po iq bd pp pq pr ps pt pu pv ma dk translated">此处参考笔记本和数据集<a class="ae le" href="https://github.com/jayashree8/Finance_Trading_In_Python/tree/main/ARIMA" rel="noopener ugc nofollow" target="_blank">。</a></p></blockquote><blockquote class="pw px py"><p id="6220" class="lf lg pz lh b li qa ka lk ll qb kd ln qc qd lq lr qe qf lu lv qg qh ly lz ma ij bi translated">联系我:<a class="ae le" href="https://www.linkedin.com/in/jayashree-domala8/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a></p><p id="486c" class="lf lg pz lh b li lj ka lk ll lm kd ln qc lp lq lr qe lt lu lv qg lx ly lz ma ij bi translated">看看我的其他作品:<a class="ae le" href="https://github.com/jayashree8" rel="noopener ugc nofollow" target="_blank"> GitHub </a></p></blockquote></div></div>    
</body>
</html>