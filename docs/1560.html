<html>
<head>
<title>Shapash: Making ML Models Understandable by Everyone</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Shapash:让每个人都能理解ML模型</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/shapash-making-ml-models-understandable-by-everyone-8f96ad469eb3?source=collection_archive---------0-----------------------#2021-02-21">https://pub.towardsai.net/shapash-making-ml-models-understandable-by-everyone-8f96ad469eb3?source=collection_archive---------0-----------------------#2021-02-21</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="6832" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a></h2><div class=""/><div class=""><h2 id="c203" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">在本文中，我们将介绍<a class="ae ko" href="https://github.com/MAIF/shapash" rel="noopener ugc nofollow" target="_blank"> Shapash </a>，这是一个开源的python库，可以帮助数据科学家使他们的机器学习模型更加透明，更容易被所有人理解！</h2></div><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi kp"><img src="../Images/f1a04fdd422cbac73c454f39316e4eb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/1*oaJTad5H3PZk5oUNrcoXag.gif"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><a class="ae ko" href="https://shapash-demo.ossbymaif.fr/" rel="noopener ugc nofollow" target="_blank"> Shapash网络应用演示</a></figcaption></figure><p id="629c" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><a class="ae ko" href="https://github.com/MAIF/shapash" rel="noopener ugc nofollow" target="_blank"><strong class="ld ja">Shapash</strong></a>by<a class="ae ko" href="https://www.maif.fr/" rel="noopener ugc nofollow" target="_blank"><strong class="ld ja">MAIF</strong></a>是一个Python工具包，方便数据科学家理解机器学习模型。这使得与非数据专家共享和讨论模型可解释性变得更加容易:业务分析师、经理、最终用户…</p><p id="0c51" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">具体来说，Shapash提供了易于阅读的可视化和一个<a class="ae ko" href="https://shapash-demo.ossbymaif.fr/" rel="noopener ugc nofollow" target="_blank">网络应用</a>。Shapash以适当的措辞显示结果(预处理反向/后处理)。Shapash <strong class="ld ja"> </strong>在操作环境中很有用，因为它使数据科学家能够从探索到生产使用可解释性:您可以在生产中轻松部署本地可解释性，以通过本地可解释性的总结来完成您的每个预测/建议。</p><p id="64a3" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">在本帖中，我们将介绍<a class="ae ko" href="https://github.com/MAIF/shapash" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ja"> Shapash </strong> </a>的主要特点以及它是如何操作的。我们将通过一个具体的用例来说明这个库的实现。</p><h1 id="cb00" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated"><strong class="ak">语境要素:</strong></h1><p id="ea15" class="pw-post-body-paragraph lb lc iq ld b le mp ka lg lh mq kd lj lk mr lm ln lo ms lq lr ls mt lu lv lw ij bi translated">模型的可解释性和可解释性是热门话题。有许多关于它的文章、出版物和开源贡献。所有这些贡献都没有涉及同样的问题和挑战。</p><p id="f4e2" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">大多数数据科学家出于多种原因使用这些技术:为了更好地理解他们的模型，检查它们是否一致和公正，以及为了调试。</p><p id="d91a" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">然而，还有更多:</p><blockquote class="mu mv mw"><p id="b938" class="lb lc mx ld b le lf ka lg lh li kd lj my ll lm ln mz lp lq lr na lt lu lv lw ij bi translated">出于教学目的，可理解性很重要。可理解的机器学习模型可以与非数据专家的人进行辩论:商业分析师、最终用户…</p></blockquote><p id="8daf" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">具体来说，在我们的数据科学项目中，有两个非专业人员参与的步骤:</p><ul class=""><li id="0cc1" class="nb nc iq ld b le lf lh li lk nd lo ne ls nf lw ng nh ni nj bi translated"><strong class="ld ja"> <em class="mx">探索性步骤&amp;模型拟合:</em> </strong></li></ul><p id="10f5" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">在这一步，数据科学家和业务分析师讨论风险所在，并定义他们将集成到项目中的基本数据。这需要很好地理解我们正在建模的问题的主题和主要驱动因素。</p><p id="74e0" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">为了做到这一点，数据科学家研究全局可解释性、特征重要性以及模型的主要特征所扮演的角色。他们还可以局部观察一些个体，尤其是离群值。在这个阶段，Web应用程序很有意思，因为他们需要查看可视化和图形。与业务分析师讨论这些结果对于挑战方法和验证模型是很有趣的。</p><ul class=""><li id="1130" class="nb nc iq ld b le lf lh li lk nd lo ne ls nf lw ng nh ni nj bi translated"><strong class="ld ja"> <em class="mx">在生产环境中部署模型</em> </strong></li></ul><p id="5f25" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">就是这样！该模型经过验证、部署，并为最终用户提供预测。局部可解释性可以给他们带来很多价值，只要有一种方法可以给他们提供一个好的、有用的和可理解的摘要。这对他们很有价值，原因有二:</p><ul class=""><li id="26ac" class="nb nc iq ld b le lf lh li lk nd lo ne ls nf lw ng nh ni nj bi translated">透明带来信任:如果他理解模型，他会信任模型。</li><li id="629e" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">人类保持控制:没有模型是100%可靠的。当他们能够理解算法的输出时，如果用户认为他们依赖于不正确的数据，他们可以推翻算法的建议。</li></ul><p id="159b" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><a class="ae ko" href="https://github.com/MAIF/shapash" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ja"> Shapash </strong> </a>已经被开发出来帮助数据科学家满足这些需求。</p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="gh gi np"><img src="../Images/e62f634a663352914a37d89272aa9ff7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1044/format:webp/1*4rjD3q7UJprqwA9CJ6PyOA.png"/></div></figure><h1 id="0ba0" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">Shapash的主要特点:</h1><ul class=""><li id="b9d8" class="nb nc iq ld b le mp lh mq lk nq lo nr ls ns lw ng nh ni nj bi translated">易于阅读的可视化，为每个人。</li><li id="57f3" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">一个web应用程序:为了理解一个模型是如何工作的，你必须查看多个图表、特征重要性以及一个特征对一个模型的整体贡献。网络应用程序是一个有用的工具。</li><li id="09f6" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">用适当的措辞显示结果的几种方法(预处理、逆处理、后处理)。您可以轻松地添加数据字典、<em class="mx">类别编码器</em>对象或sk learn<em class="mx">column transformer</em>以获得更明确的输出。</li><li id="58eb" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">轻松保存<em class="mx"> Pickle </em>文件并将结果导出到表格中的功能。</li><li id="fd56" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">可解释性概要:概要是可配置的，以适应您的需要，并关注对局部可解释性重要的内容。</li><li id="059c" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">能够在生产环境中轻松部署，并通过每个运营应用(批处理或API)的本地可解释性摘要完成每个预测/建议</li><li id="2fe3" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">Shapash 开放了多种处理方式:它可以用来轻松地获得结果或改进措辞。显示结果只需要很少的参数。但是你清理和记录数据集的工作越多，最终用户得到的结果就越清晰。</li></ul><p id="46d4" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><a class="ae ko" href="https://github.com/MAIF/shapash" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ja"> Shapash </strong> </a>适用于回归、二元分类或多类问题。<br/>兼容多种型号:<em class="mx"> Catboost </em>，<em class="mx"> Xgboost </em>，<em class="mx"> LightGBM </em>，<em class="mx"> Sklearn Ensemble </em>，<em class="mx">线性型号</em>，<em class="mx"> SVM </em>。</p><p id="16fd" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja"> Shapash </strong>基于使用<a class="ae ko" href="https://github.com/slundberg/shap" rel="noopener ugc nofollow" target="_blank"><strong class="ld ja">Shap</strong></a>(Shapley值)<a class="ae ko" href="https://github.com/marcotcr/lime" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ja"> Lime </strong> </a>计算的本地贡献，或允许计算可累加本地贡献的任何技术。</p><h1 id="818d" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">装置</h1><p id="1880" class="pw-post-body-paragraph lb lc iq ld b le mp ka lg lh mq kd lj lk mr lm ln lo ms lq lr ls mt lu lv lw ij bi translated">您可以通过pip安装该软件包:</p><p id="943b" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><code class="fe nt nu nv nw b">$pip install shapash</code></p><h1 id="b8b7" class="lx ly iq bd lz ma mb mc md me mf mg mh kf mi kg mj ki mk kj ml kl mm km mn mo bi translated">沙帕什演示</h1><p id="49e2" class="pw-post-body-paragraph lb lc iq ld b le mp ka lg lh mq kd lj lk mr lm ln lo ms lq lr ls mt lu lv lw ij bi translated">让我们在一个具体的数据集上使用<strong class="ld ja"> </strong> Shapash。在本文的剩余部分，我们将向您展示<a class="ae ko" href="https://github.com/MAIF/shapash" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ja"> Shapash </strong> </a>如何探索模型。</p><p id="f9db" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">我们将使用来自<a class="ae ko" href="https://www.kaggle.com/c/house-prices-advanced-regression-techniques" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>的著名“房价”数据集来拟合回归变量…并预测房价！让我们从加载数据集开始:</p><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="ecf2" class="ob ly iq nw b gy oc od l oe of">import pandas as pd<br/>from shapash.data.data_loader import data_loading<br/>house_df, house_dict = data_loading('house_prices')<br/>y_df=house_df['SalePrice'].to_frame()<br/>X_df=house_df[house_df.columns.difference(['SalePrice'])]</span><span id="e20e" class="ob ly iq nw b gy og od l oe of">house_df.head(3)</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div class="ab gu cl oh"><img src="../Images/fab26f69e072bc45649264c8ffe09293.png" data-original-src="https://miro.medium.com/v2/format:webp/1*XbL4MPkUPL4Rx9bPOEeQKA.png"/></div></figure><p id="ce13" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">对分类特征进行编码:</p><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="7957" class="ob ly iq nw b gy oc od l oe of">from category_encoders import OrdinalEncoder<br/><br/>categorical_features = [col for col in X_df.columns if X_df[col].dtype == 'object']<br/>encoder = OrdinalEncoder(cols=categorical_features).fit(X_df)<br/>X_df=encoder.transform(X_df)</span></pre><p id="cdd8" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">训练、测试分割和模型拟合。</p><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="ec1f" class="ob ly iq nw b gy oc od l oe of">from sklearn.model_selection import train_test_split<br/>from sklearn.ensemble import RandomForestRegressor<br/><br/>Xtrain, Xtest, ytrain, ytest = train_test_split(X_df, y_df, train_size=0.75)<br/>reg = RandomForestRegressor(n_estimators=200, min_samples_leaf=2).fit(Xtrain,ytrain)</span></pre><p id="fbd6" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja">和预测测试数据……</strong></p><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="719f" class="ob ly iq nw b gy oc od l oe of">y_pred = pd.DataFrame(reg.predict(Xtest), columns=['pred'], index=Xtest.index)</span></pre><p id="a928" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja">让我们发现并使用Shapash SmartExplainer。</strong></p><p id="bcc6" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><em class="mx">第一步—导入</em></p><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="0b22" class="ob ly iq nw b gy oc od l oe of">from shapash.explainer.smart_explainer import SmartExplainer</span></pre><p id="b6c5" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><em class="mx">步骤2 —初始化SmartExplainer对象</em></p><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="e10a" class="ob ly iq nw b gy oc od l oe of">xpl = SmartExplainer(features_dict=house_dict) # Optional parameter </span></pre><ul class=""><li id="912b" class="nb nc iq ld b le lf lh li lk nd lo ne ls nf lw ng nh ni nj bi translated">features_dict: dict指定x pd.DataFrame的每个列名的含义。</li></ul><p id="91a6" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><em class="mx">步骤3 —编译</em></p><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="e48f" class="ob ly iq nw b gy oc od l oe of">xpl.compile(<br/>    x=Xtest,<br/>    model=regressor,<br/>    preprocessing=encoder,# Optional: use inverse_transform method<br/>    y_pred=y_pred # Optional<br/>)</span></pre><p id="3443" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">编译方法允许使用另一个可选参数:<em class="mx">后置处理。</em>它提供了应用新函数来指定更好的措辞的可能性(正则表达式、映射字典等)。</p><p id="509f" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">现在，我们可以显示结果并了解回归模型是如何工作的！</p><p id="8414" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><em class="mx">步骤4 —启动网络应用</em></p><p id="3278" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><code class="fe nt nu nv nw b">app = xpl.run_app()</code></p><p id="4a07" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">web应用程序链接出现在Jupyter输出中(点击查看演示<a class="ae ko" href="https://shapash-demo.ossbymaif.fr/" rel="noopener ugc nofollow" target="_blank">)。</a></p><p id="7685" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja">这个Web App有四个部分:</strong></p><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="oj ok di ol bf om"><div class="gh gi oi"><img src="../Images/8b33431415ed595a81de05593f651848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JSQmzdlzjom6X_iRkNnp5g.png"/></div></div></figure><p id="f48b" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">每一个都有助于轻松探索模型。</p><p id="495a" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja"> <em class="mx">特性重要性</em> : </strong>您可以点击每个特性来更新下面的贡献图。</p><p id="6bd3" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja"> <em class="mx">贡献图</em> : </strong>一个特征如何影响预测？显示特征的每个局部贡献的小提琴图或散点图。</p><p id="3749" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja"> <em class="mx">局部剧情:</em> </strong></p><ul class=""><li id="a2d5" class="nb nc iq ld b le lf lh li lk nd lo ne ls nf lw ng nh ni nj bi translated">局部解释:哪些特征对预测值的贡献最大。</li><li id="2c46" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">您可以使用几个按钮/滑块/列表来配置这个局部可解释性的概要。我们将在下面用<em class="mx">过滤器</em>方法描述不同的参数，您可以用这些参数进行汇总。</li><li id="19ca" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">这个web应用程序是一个有用的工具，可以与业务分析师讨论总结可解释性以满足运营需求的最佳方式。</li></ul><p id="80ac" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja"> <em class="mx">选择表:</em> </strong>允许Web App用户选择:</p><ul class=""><li id="7d8e" class="nb nc iq ld b le lf lh li lk nd lo ne ls nf lw ng nh ni nj bi translated">一个子集，将探索的重点放在这个子集上</li><li id="8e46" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">单行显示相关的本地解释</li></ul><p id="4128" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">如何使用数据表选择子集？在表的顶部，在要用于筛选的列名称的正下方，指定:</p><ul class=""><li id="8c72" class="nb nc iq ld b le lf lh li lk nd lo ne ls nf lw ng nh ni nj bi translated"><em class="mx">=值，&gt;值，&lt;值</em></li><li id="30ab" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated"><em class="mx">如果您想选择包含特定单词的每一行，只需键入不带“=”的单词</em></li></ul><p id="5f3e" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">这个web应用程序有几个可用选项(右上角按钮)。最重要的一个大概就是样本的大小(默认:1000)。为了避免延迟，web应用程序依赖一个样本来显示结果。使用此选项修改样本大小。</p><p id="56f9" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">要关闭应用程序:</p><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="2c8d" class="ob ly iq nw b gy oc od l oe of">app.kill()</span></pre><p id="ef03" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><em class="mx">第五步—地块</em></p><p id="456d" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">所有的情节都可以在jupyter笔记本上找到，下面的段落描述了每个情节的要点。</p><p id="d1ad" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja">特征重要性</strong></p><p id="ffd4" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">该参数允许比较子集的特征重要性。检测子集中的特定行为非常有用。</p><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="966c" class="ob ly iq nw b gy oc od l oe of">subset = [ 168, 54, 995, 799, 310, 322, 1374,<br/>          1106, 232, 645, 1170, 1229, 703, 66,  <br/>          886, 160, 191, 1183, 1037, 991, 482,  <br/>          725, 410, 59, 28, 719, 337, 36 ]</span><span id="5df9" class="ob ly iq nw b gy og od l oe of">xpl.plot.features_importance(selection=subset)</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="oj ok di ol bf om"><div class="gh gi on"><img src="../Images/f27b3c909ccff3837bc0edf1de48dcf2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DBVm8lGPnj8hs6FRIeu6vQ.png"/></div></div></figure><p id="cf8c" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja"> <em class="mx">贡献情节</em> </strong></p><p id="fb42" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">贡献图用于回答以下问题:</p><p id="b17f" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">某个特性如何影响我的预测？它有积极的贡献吗？该功能的贡献越来越大吗？逐渐减少？有没有什么门槛效应？对于一个分类变量，每个模态如何贡献？…该图完善了特征对于模型的可解释性和整体可理解性的重要性，从而更好地理解特征对模型的影响。</p><p id="ba4c" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">这张图上有几个参数。请注意，显示的图会根据您对分类变量还是连续变量感兴趣(小提琴或散点图)以及您处理的用例类型(回归、分类)进行调整</p><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="57cf" class="ob ly iq nw b gy oc od l oe of">xpl.plot.contribution_plot("OverallQual")</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="oj ok di ol bf om"><div class="gh gi on"><img src="../Images/e2afda8ac46a29ceae4fa80d84850a48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*elwHcvKkztSVVm3khLOKDg.png"/></div></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="oj ok di ol bf om"><div class="gh gi on"><img src="../Images/4abcbf88de9145ea93690db80a2959dd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zA5vqTsbgwkRZ4LG6Q8fRw.png"/></div></div></figure><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="oj ok di ol bf om"><div class="gh gi oo"><img src="../Images/6c5bbaa2ada2dd31ef34e781300afca5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n4cCMy0OAsFfiWl-f35WBg.png"/></div></div></figure><p id="88d8" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">应用于连续特征的贡献图。</p><p id="a8bc" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">分类案例:Titanic分类器—应用于分类特征的贡献图。</p><p id="3a54" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja">局部情节</strong></p><p id="6c8b" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">您可以使用局部图来获得模型的局部可解释性。</p><p id="5160" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">filter()和local_plot()方法允许您测试并选择最佳方式来总结模型拾取的信号。你可以在探索阶段使用它。然后，您可以将该摘要部署到生产环境中，让最终用户在几秒钟内了解对每个建议最有影响的标准是什么。</p><p id="c687" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">我们将发表第二篇文章来解释如何在生产中部署本地可解释性。</p><p id="85c1" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja">结合过滤和局部_绘图方法</strong></p><p id="ce09" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">使用filter方法指定如何总结局部可解释性。您有四个参数来配置您的摘要:</p><ul class=""><li id="d45f" class="nb nc iq ld b le lf lh li lk nd lo ne ls nf lw ng nh ni nj bi translated">max_contrib:要显示的最大标准数</li><li id="d242" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">阈值:显示标准所需的贡献的最小值(绝对值)</li><li id="a9c4" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">正面:仅显示正面贡献？消极？(默认无)</li><li id="b28e" class="nb nc iq ld b le nk lh nl lk nm lo nn ls no lw ng nh ni nj bi translated">features_to_hide:不想显示的功能列表</li></ul><p id="8b78" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">定义这些参数后，我们可以用local_plot()方法显示结果，或者用to_pandas()导出结果。</p><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="8d90" class="ob ly iq nw b gy oc od l oe of">xpl.filter(max_contrib=8,threshold=100)<br/>xpl.plot.local_plot(index=<!-- -->560<!-- -->)</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="oj ok di ol bf om"><div class="gh gi on"><img src="../Images/ee84b7e4abe8f82b9b28bb74d45191c0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Cy_nLo4XeVJtHviV5wuxZg.png"/></div></div></figure><h2 id="9d4d" class="ob ly iq bd lz op oq dn md or os dp mh lk ot ou mj lo ov ow ml ls ox oy mn iw bi translated"><code class="fe nt nu nv nw b">Export to pandas DataFrame:</code></h2><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="aef0" class="ob ly iq nw b gy oc od l oe of">xpl.filter(max_contrib=3,threshold=1000)<br/>summary_df = xpl.to_pandas()<br/>summary_df.head()</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="oj ok di ol bf om"><div class="gh gi oz"><img src="../Images/4b24d26b2d5ba4c8dfbf076ecacc634a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*68OibxE1EbdWvzTXBN5umQ.png"/></div></div></figure><p id="f978" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated"><strong class="ld ja">比较剧情</strong></p><p id="1389" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">使用compare_plot()方法，SmartExplainer对象可以理解为什么两个或多个个体没有相同的预测值。最具决定性的标准出现在图的顶部。</p><pre class="kq kr ks kt gt nx nw ny nz aw oa bi"><span id="e4b6" class="ob ly iq nw b gy oc od l oe of">xpl.plot.compare_plot(row_num=[0, 1, 2, 3, 4], max_features=8)</span></pre><figure class="kq kr ks kt gt ku gh gi paragraph-image"><div role="button" tabindex="0" class="oj ok di ol bf om"><div class="gh gi on"><img src="../Images/e244277395ce0d1e5eb04fd4ee2bbdd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pX-isybSbJTxU3VYBFIWWQ.png"/></div></div></figure><p id="aa87" class="pw-post-body-paragraph lb lc iq ld b le lf ka lg lh li kd lj lk ll lm ln lo lp lq lr ls lt lu lv lw ij bi translated">我们希望<a class="ae ko" href="https://github.com/MAIF/shapash" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ja"> Shapash </strong> </a>将有助于建立对AI的信任。提前感谢所有给我们反馈的人，idea… <a class="ae ko" href="https://github.com/MAIF/shapash" rel="noopener ugc nofollow" target="_blank"> <strong class="ld ja"> Shapash </strong> </a>是开源的！请随意评论这篇文章或直接在<a class="ae ko" href="https://github.com/MAIF/shapash/discussions" rel="noopener ugc nofollow" target="_blank"> GitHub讨论</a>上发表意见。</p></div></div>    
</body>
</html>