<html>
<head>
<title>Rule-Based Matching for NLP using spaCy</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于空间的自然语言处理规则匹配</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/rule-based-matching-for-nlp-using-spacy-491f148fd4fb?source=collection_archive---------5-----------------------#2021-03-12">https://pub.towardsai.net/rule-based-matching-for-nlp-using-spacy-491f148fd4fb?source=collection_archive---------5-----------------------#2021-03-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="ebba" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/nlp" rel="noopener ugc nofollow" target="_blank">自然语言处理</a></h2><div class=""/><figure class="gl gn ka kb kc kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi jz"><img src="../Images/137e0420326b957d773b6c465f9fc044.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4DmDZUXgYLpmnpB4.jpg"/></div></div></figure><p id="db68" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">如果你是一个NLP爱好者，你肯定知道<a class="ae li" href="https://spacy.io/" rel="noopener ugc nofollow" target="_blank">空间</a>图书馆。这是一个强大的库，主要以word2vec函数而闻名。今天，我们将使用spacy的函数匹配器展示spaCy在基于规则的匹配中的不同用法。</p><p id="55f5" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">你可能会问，为什么不用正则表达式呢？<br/>答案是<strong class="km jd">令牌属性</strong>。</p><p id="88c7" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated"><strong class="km jd">商店:名词vs商店:动词</strong> <br/> <strong class="km jd">匹配词条如begin with begined</strong></p><p id="284c" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">仅通过这两个例子，我们就可以理解Matcher相对于RegEx的强大之处。然而，我们将向您展示如何使用它们来创建“下一级”模式。</p><p id="a9ab" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">在这个项目中，我们将使用<a class="ae li" href="https://www.gutenberg.org/files/11/11-0.txt" rel="noopener ugc nofollow" target="_blank">爱丽丝梦游仙境</a>这本书。</p><p id="9eea" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">首先确保你已经安装了<strong class="km jd"> spaCy </strong>库，下载了<strong class="km jd"> en_core_web_sm </strong>如下。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="618b" class="ls lt it lo b gy lu lv l lw lx">pip install -U spacy</span><span id="0b59" class="ls lt it lo b gy ly lv l lw lx">python -m spacy download en_core_web_sm</span></pre><p id="0a1b" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">让我们从读取数据和导入库开始。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="9a6e" class="ls lt it lo b gy lu lv l lw lx">#reading the data<br/>data = open('11-0.txt').read()<br/><br/>#if you get an error try the following<br/>#data = open('11-0.txt',encoding = 'cp850').read()<br/><br/>import spacy<br/><br/># Import the Matcher<br/>from spacy.matcher import Matcher<br/><br/>nlp = spacy.load("en_core_web_sm")<br/>doc = nlp(data)</span></pre><p id="1e39" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">我们可以使用的可用属性如下</p><figure class="lj lk ll lm gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi lz"><img src="../Images/43e8a4c0efa500a63c4e0b822271f396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C7FxEUcSrGBlrmoGzUxBXA.jpeg"/></div></div></figure><h1 id="469e" class="ma lt it bd mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw bi translated">例子</h1><p id="f7ee" class="pw-post-body-paragraph kk kl it km b kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld nb lf lg lh im bi translated">假设我们想要查找以单词<strong class="km jd"> Alice </strong>开头，后跟动词<strong class="km jd">的短语。</strong></p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="b37e" class="ls lt it lo b gy lu lv l lw lx">#initialize matcher<br/>matcher = Matcher(nlp.vocab)<br/><br/># Create a pattern matching two tokens: "Alice" and a Verb<br/>#TEXT is for the exact match and VERB for a verb<br/>pattern = [{"TEXT": "Alice"}, {"POS": "VERB"}]<br/><br/><br/># Add the pattern to the matcher<br/><br/>#the first variable is a unique id for the pattern (alice).<br/>#The second is an optional callback and the third one is our pattern.<br/>matcher.add("alice", None, pattern)<br/><br/># Use the matcher on the doc<br/>matches = matcher(doc)<br/>print("Matches:", [doc[start:end].text for match_id, start, end in matches])</span><span id="a7a7" class="ls lt it lo b gy ly lv l lw lx">Matches: ['Alice think', 'Alice started', 'Alice began', 'Alice opened', 'Alice ventured', 'Alice felt', 'Alice took', 'Alice thought', 'Alice went', 'Alice went', 'Alice thought', 'Alice kept', 'Alice thought', 'Alice called', 'Alice replied', 'Alice began', 'Alice guessed', 'Alice said', 'Alice went', 'Alice knew', 'Alice heard', 'Alice thought', 'Alice heard', 'Alice noticed', 'Alice dodged', 'Alice looked', 'Alice looked', 'Alice replied', 'Alice replied', 'Alice felt', 'Alice turned', 'Alice thought', 'Alice replied', 'Alice folded', 'Alice said', 'Alice waited', 'Alice remained', 'Alice crouched', 'Alice noticed', 'Alice laughed', 'Alice went', 'Alice thought', 'Alice said', 'Alice said', 'Alice glanced', 'Alice caught', 'Alice looked', 'Alice added', 'Alice felt', 'Alice remarked', 'Alice waited', 'Alice coming', 'Alice looked', 'Alice said', 'Alice thought', 'Alice considered', 'Alice replied', 'Alice felt', 'Alice replied', 'Alice sighed', 'Alice asked', 'Alice ventured', 'Alice tried', 'Alice replied', 'Alice said', 'Alice said', 'Alice thought', 'Alice looked', 'Alice recognised', 'Alice joined', 'Alice gave', 'Alice thought', 'Alice found', 'Alice began', 'Alice waited', 'Alice put', 'Alice began', 'Alice thought', 'Alice appeared', 'Alice ventured', 'Alice whispered', 'Alice thought', 'Alice remarked', 'Alice said', 'Alice said', 'Alice looked', 'Alice heard', 'Alice thought', 'Alice asked', 'Alice ventured', 'Alice went', 'Alice began', 'Alice replied', 'Alice looked', 'Alice asked', 'Alice began', 'Alice said', 'Alice said', 'Alice panted', 'Alice whispered', 'Alice began', 'Alice felt', 'Alice guessed', 'Alice watched', 'Alice looked', 'Alice got']</span></pre><p id="703b" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">找出后跟名词的形容词。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="382c" class="ls lt it lo b gy lu lv l lw lx">matcher = Matcher(nlp.vocab)<br/><br/>pattern = [{"POS": "ADJ"}, {"POS": "NOUN"}]<br/><br/>matcher.add("id1", None, pattern)<br/>matches = matcher(doc)<br/><br/># We will show you the first 20 matches<br/>print("Matches:", set([doc[start:end].text for match_id, start, end in matches][:20]))</span><span id="1fd6" class="ls lt it lo b gy ly lv l lw lx">Matches: {'grand words', 'hot day', 'legged table', 'dry leaves', 'great delight', 'low hall', 'own mind', 'many miles', 'little girl', 'good opportunity', 'right word', 'long passage', 'other parts', 'low curtain', 'large rabbit', 'pink eyes', 'several things', 'golden key', 'little door'}</span></pre><p id="725e" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">Match <strong class="km jd">以</strong>作为引理开始，后跟一个<strong class="km jd"> adposition </strong></p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="56da" class="ls lt it lo b gy lu lv l lw lx">matcher = Matcher(nlp.vocab)<br/>pattern = [{"LEMMA": "begin"},{"POS": "ADP"}]<br/>matcher.add("id1", None, pattern)<br/>matches = matcher(doc)<br/>print("Matches:", set([doc[start:end].text for match_id, start, end in matches]))</span><span id="ca25" class="ls lt it lo b gy ly lv l lw lx">Matches: {'began by', 'begin at', 'begins with', 'beginning with', 'beginning to', 'begin with', 'began in'}</span></pre></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="d098" class="ma lt it bd mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms nn mu mv mw bi translated">量词</h1><p id="3241" class="pw-post-body-paragraph kk kl it km b kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld nb lf lg lh im bi translated">我们可以像正则表达式一样使用量词。</p><figure class="lj lk ll lm gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi no"><img src="../Images/ffd1434d153e637363bc4001044d4e6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QVzELPWpmnxN_OX-v6FH8g.jpeg"/></div></div></figure><p id="4bdd" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">例如，匹配后跟零个或多个标点符号的精确单词Alice:</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="e6fb" class="ls lt it lo b gy lu lv l lw lx">matcher = Matcher(nlp.vocab)<br/>pattern = [{"TEXT": "Alice"}, {"IS_PUNCT": True,"OP":"*"}]<br/>matcher.add("id1", None, pattern)<br/>matches = matcher(doc)<br/>print("Matches:", set([doc[start:end].text for match_id, start, end in matches]))</span><span id="de97" class="ls lt it lo b gy ly lv l lw lx">Matches: {'Alice', 'Alice,', 'Alice:', 'Alice (', 'Alice!', 'Alice;', 'Alice,)', 'Alice, (', 'Alice.'}</span></pre></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="0bd6" class="ma lt it bd mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms nn mu mv mw bi translated">正则表达式的使用</h1><p id="42e3" class="pw-post-body-paragraph kk kl it km b kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld nb lf lg lh im bi translated">我们可以通过使用正则表达式来创建更复杂的模式。这开启了基于规则的匹配的新水平。</p><p id="9409" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">示例:匹配所有以“a”开头的单词，后跟以“V”开头的词类(动词等)</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="65bb" class="ls lt it lo b gy lu lv l lw lx">matcher = Matcher(nlp.vocab)<br/>pattern = [{"TEXT": {"REGEX": "^a"}},{"POS": {"REGEX": "^V"}}]<br/>matcher.add("country", None, pattern)<br/>matches = matcher(doc)</span><span id="aa48" class="ls lt it lo b gy ly lv l lw lx">print("Matches:", set([doc[start:end].text for match_id, start, end in matches][:20]))<br/></span><span id="b0af" class="ls lt it lo b gy ly lv l lw lx">Matches: {'and make', 'are located', 'away went', 'and found', 'about stopping', 'and finding', 'and burning', 'and cried', 'and went', 'all round', 'all seemed', 'and round', 'and noticed', 'and saying', 'all made', 'all think', 'and looked', 'all locked', 'and wander'}</span></pre></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><h1 id="6307" class="ma lt it bd mb mc nj me mf mg nk mi mj mk nl mm mn mo nm mq mr ms nn mu mv mw bi translated">添加和删除模式</h1><p id="1524" class="pw-post-body-paragraph kk kl it km b kn mx kp kq kr my kt ku kv mz kx ky kz na lb lc ld nb lf lg lh im bi translated">在运行匹配器之前，可以添加更多的模式。您只需要为每个模式使用唯一的id。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="f673" class="ls lt it lo b gy lu lv l lw lx">matcher = Matcher(nlp.vocab)<br/><br/>pattern = [{"TEXT": "Alice"}, {"IS_PUNCT": True,"OP":"*"}]<br/>matcher.add("id1", None, pattern)<br/><br/>pattern = [{"POS": "ADJ"},{"LOWER":"rabbit"}]<br/>matcher.add("id2", None, pattern)<br/><br/>matches = matcher(doc)<br/>print("Matches:", set([doc[start:end].text for match_id, start, end in matches]))</span><span id="b8e4" class="ls lt it lo b gy ly lv l lw lx">Matches: {'Alice', 'Alice,', 'Alice:', 'Alice (', 'Alice;', 'Alice!', 'Alice,)', 'Alice, (', 'large rabbit', 'Alice.'}</span></pre><p id="516c" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">要移除它，使用<strong class="km jd">移除</strong>功能，就像<strong class="km jd">添加</strong>一样。</p><pre class="lj lk ll lm gt ln lo lp lq aw lr bi"><span id="bd45" class="ls lt it lo b gy lu lv l lw lx">matcher.remove('id1')</span><span id="dfe6" class="ls lt it lo b gy ly lv l lw lx">matches = matcher(doc)<br/>print("Matches:", set([doc[start:end].text for match_id, start, end in matches]))</span><span id="52b3" class="ls lt it lo b gy ly lv l lw lx">Matches: {'large rabbit'}</span></pre><p id="d3c0" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated">你可以在spaCy的文档中了解更多信息，也可以在基于规则的匹配器浏览器中进行实验。</p></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="f506" class="pw-post-body-paragraph kk kl it km b kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh im bi translated"><em class="np">原载于</em><a class="ae li" href="http://predictivehacks.com/rule-based-matching-for-nlp-using-spacy/" rel="noopener ugc nofollow" target="_blank"><em class="np">https://predictivehacks.com</em></a><em class="np">。</em></p></div></div>    
</body>
</html>