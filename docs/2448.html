<html>
<head>
<title>How To Build One Chatbot To Handle Multiple Languages</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何构建一个聊天机器人来处理多种语言</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-to-build-one-chatbot-to-handle-multiple-languages-b0accd6401e2?source=collection_archive---------0-----------------------#2021-12-30">https://pub.towardsai.net/how-to-build-one-chatbot-to-handle-multiple-languages-b0accd6401e2?source=collection_archive---------0-----------------------#2021-12-30</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="c909" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/nlp" rel="noopener ugc nofollow" target="_blank">自然语言处理</a></h2><div class=""/><div class=""><h2 id="1b20" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">跨语言语料库预处理语言模型的实际应用</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/aba843064555ddf013b59384b6f7ddf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NkiB13U5hLZCnw-xGhN7zQ.png"/></div></div></figure><h1 id="e070" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated"><strong class="ak">简介</strong></h1><p id="b994" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">在这篇文章中，我将分享一个想法，如何建立一个聊天机器人，可以理解多种语言，而不必为每种语言部署一个机器人。换句话说，我们将学习如何构建一个健壮的NLU和对话管理模型来处理任意数量的语言。</p><p id="1f05" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">我们将使用<a class="ae mw" href="https://rasa.com/" rel="noopener ugc nofollow" target="_blank"> rasa </a>来演示本文中讨论的想法，但实际上，这些想法可以应用于任何聊天机器人框架(允许定制)。</p><p id="a613" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">重现本文中描述的结果的代码可以在<a class="ae mw" href="https://github.com/hsm207/moodbot_multilingual" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="6ccc" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">问题陈述</h1><p id="07bb" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">假设你是一家欧洲银行的聊天机器人开发者。该银行已经开发了一个客户服务聊天机器人，在减少其国内市场德国的人工代理人的负担方面做得非常好。受此鼓舞，管理层已经计划将bot的使用扩展到该地区的其他市场。他们想从法国开始。</p><p id="7272" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">法国机器人在功能上与德国机器人相同，只是语言不同。</p><p id="f41d" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">你将如何建造法国机器人？</p><p id="0495" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">一种常见的方法是克隆德国机器人，将其响应翻译成法语，并在德语发音的法语等价物上训练它。这是可行的，但是现在你必须维护两个机器人。</p><p id="ed51" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">现在想象一下，如果管理层希望将bot扩展到欧盟(EU)的所有市场。你可能最终不得不支持24个机器人，每个机器人对应欧盟的一种官方语言。</p><p id="d1be" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">让我们看看是否有一种方法可以让一个机器人理解所有的语言。</p><h1 id="1568" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">这个想法</h1><p id="bf4a" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">XLM-E [1]是在多语言语料库上训练的语言模型的一个例子。根据[1]，这些类型的模型可以:</p><blockquote class="mx my mz"><p id="bf5b" class="lv lw na lx b ly mr kd ma mb ms kg md nb mt mg mh nc mu mk ml nd mv mo mp mq im bi translated">……在零投跨语言迁移上表现出色(Devlin et al .，2019；Conneau等人，2020)，即在将模型直接应用于其他目标语言的同时，用英语训练数据进行微调</p></blockquote><p id="79ad" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">这意味着，如果德国机器人基于在多语言语料库上预先训练的语言模型，我们可以在没有任何额外训练的情况下向它传递法语话语，“它就会工作”。</p><p id="4710" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">下一节将描述如何使用rasa应用这一思想。</p><h1 id="3bd6" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">实施</h1><h2 id="1a66" class="ne le it bd lf nf ng dn lj nh ni dp ln me nj nk lp mi nl nm lr mm nn no lt iz bi translated">概观</h2><p id="d063" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">让我们构建一个多语言版本的rasa默认机器人<a class="ae mw" href="https://github.com/RasaHQ/rasa/tree/main/examples/moodbot/data" rel="noopener ugc nofollow" target="_blank"> moodbot </a>，它支持以下语言:</p><ul class=""><li id="5c47" class="np nq it lx b ly mr mb ms me nr mi ns mm nt mq nu nv nw nx bi translated">英语</li><li id="0e1c" class="np nq it lx b ly ny mb nz me oa mi ob mm oc mq nu nv nw nx bi translated">德国人</li><li id="9b75" class="np nq it lx b ly ny mb nz me oa mi ob mm oc mq nu nv nw nx bi translated">马来西亚语</li></ul><p id="22c3" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">用户可以在对话过程中随时切换上述语言。</p><p id="8024" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">这是我们需要考虑的3个关键因素:</p><ol class=""><li id="1600" class="np nq it lx b ly mr mb ms me nr mi ns mm nt mq od nv nw nx bi translated">训练模型</li><li id="9630" class="np nq it lx b ly ny mb nz me oa mi ob mm oc mq od nv nw nx bi translated">检测输入语言</li><li id="5e48" class="np nq it lx b ly ny mb nz me oa mi ob mm oc mq od nv nw nx bi translated">切换响应语言</li></ol><h2 id="719f" class="ne le it bd lf nf ng dn lj nh ni dp ln me nj nk lp mi nl nm lr mm nn no lt iz bi translated">训练模型</h2><p id="8c85" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">我们将采用<a class="ae mw" href="https://huggingface.co/bert-base-multilingual-cased" rel="noopener ugc nofollow" target="_blank"> BERT多语言基础模型</a>，在moodbot的英语数据集上对其进行微调，并将其托管在某个服务器上进行推理。</p><p id="faa2" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">接下来，我们构建一个名为multilingualbertinntentclassifier的<a class="ae mw" href="https://rasa.com/docs/rasa/2.x/components" rel="noopener ugc nofollow" target="_blank">定制组件</a>，它将调用托管模型进行意图分类。因为预测是由外部服务完成的，所以我们只需要实现定制组件的<code class="fe oe of og oh b">process</code>方法:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oi"><img src="../Images/af0029521e844cbe3faae80246090d7d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IvxGYdy41e0AVUVuG-QO0A.png"/></div></div><figcaption class="oj ok gj gh gi ol om bd b be z dk translated">图1:multilingualbertientclassifier如何进行意图分类</figcaption></figure><h2 id="c4cc" class="ne le it bd lf nf ng dn lj nh ni dp ln me nj nk lp mi nl nm lr mm nn no lt iz bi translated">检测输入语言</h2><p id="bee2" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">在<a class="ae mw" href="https://textblob.readthedocs.io/en/dev/" rel="noopener ugc nofollow" target="_blank"> TextBlob </a>库的帮助下，使用<a class="ae mw" href="https://rasa.com/docs/rasa/2.x/custom-actions" rel="noopener ugc nofollow" target="_blank">自定义动作</a>可以检测用户说的是哪种语言:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi on"><img src="../Images/0184e225f6fcab7f8847be58f3b4a493.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8vUS1lFN1YjVCJX9iyUNhA.png"/></div></div><figcaption class="oj ok gj gh gi ol om bd b be z dk translated">图2:检测用户语言的自定义动作</figcaption></figure><p id="c64a" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">注意，我们使用了两个槽，<code class="fe oe of og oh b">langcode</code>和<code class="fe oe of og oh b">langname</code>来分别跟踪检测到的语言代码(例如en)和名称(例如English)。</p><p id="989f" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">我们需要在每次用户说话时运行这个检查，因为我们希望支持用户在对话中多次切换语言的情况。因此，我们需要在每个<code class="fe oe of og oh b">intent</code>步骤之后更新机器人的故事来运行这个动作。例如，这个故事:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/8edfa6118060031f98eed51e3e17d88d.png" data-original-src="https://miro.medium.com/v2/resize:fit:928/format:webp/1*vAMkVJRtyz8bhgZ2ggt2zg.png"/></div><figcaption class="oj ok gj gh gi ol om bd b be z dk translated">图moodbot的默认故事之一</figcaption></figure><p id="d437" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">现在会是这个样子:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi op"><img src="../Images/5274ed75d306d5ef88129c3cf7723d1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*UwilmVmhnB2rlyOxl2Ijiw.png"/></div><figcaption class="oj ok gj gh gi ol om bd b be z dk translated">图4:更新图3中的故事以支持多语言切换</figcaption></figure><h2 id="618b" class="ne le it bd lf nf ng dn lj nh ni dp ln me nj nk lp mi nl nm lr mm nn no lt iz bi translated">切换响应语言</h2><p id="2907" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">我们可以使用rasa的<a class="ae mw" href="https://rasa.com/docs/rasa/2.x/responses#conditional-response-variations" rel="noopener ugc nofollow" target="_blank">条件反应变异</a> (CVR)功能，让机器人以用户输入的语言做出反应。</p><p id="33e3" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">下面是使用CVR的<code class="fe oe of og oh b">utter_greet</code>的响应:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oq"><img src="../Images/4504721e341569eca0045a929c273cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FY0RCfkFFNQqVyU-fNutRA.png"/></div></div><figcaption class="oj ok gj gh gi ol om bd b be z dk translated">图5:使用CVR支持多语言响应</figcaption></figure><p id="209d" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">请注意，选择哪个版本的<code class="fe oe of og oh b">utter_greet</code>响应将取决于由<code class="fe oe of og oh b">action_detect_language</code>自定义动作设置的<code class="fe oe of og oh b">langcode</code>槽。如果用户说的语言不是这三种受支持的语言之一，那么机器人将通知用户它不会说这种语言(第29行)。</p><h1 id="1d63" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">演示</h1><p id="80ac" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">这里有一个演示来展示所有东西是如何组合在一起的:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi or"><img src="../Images/9ea430e7f5b9bccdeb71c9c35626eb6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/1*2X5GmWPqwcVoQoZI5HV4Dg.gif"/></div></figure><h1 id="a80a" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">进一步的工作</h1><h2 id="ab3a" class="ne le it bd lf nf ng dn lj nh ni dp ln me nj nk lp mi nl nm lr mm nn no lt iz bi translated">提高模型准确性</h2><p id="9cfc" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">回想一下，该模型在零镜头设置中对非英语话语的意图进行了分类，即仅在moodbot的英语数据集上进行了微调。</p><p id="3007" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">在实践中，您可能有特定领域的语料库，例如您的目标语言的通话记录，因此应该进一步预训练或微调该数据集上的模型，以提高其准确性。</p><p id="8202" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">然而，一旦我们建立了一个英语机器人，我们就不需要收集额外的特定领域训练示例的想法真的很有吸引力，因此有兴趣了解这一研究领域最新发展的读者可以在<a class="ae mw" href="https://sites.research.google/xtreme" rel="noopener ugc nofollow" target="_blank"> XTREME基准</a>上跟踪进展。</p><h2 id="a3af" class="ne le it bd lf nf ng dn lj nh ni dp ln me nj nk lp mi nl nm lr mm nn no lt iz bi translated">执行实体识别</h2><p id="d078" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">Moodbot是一个如此简单的机器人，它不需要实体识别就能工作。对于大多数现实世界的机器人来说就不一样了，例如，用于预订航班的机器人需要提取旅程的开始和结束位置作为实体。</p><p id="d2d2" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">这篇文章中描述的思想也能应用于实体识别吗？</p><p id="2a9c" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">是的，有兴趣了解如何将多语言预训练语言模型转换为多语言实体提取器的读者可以参考[2]，其中作者描述了他们为斯拉夫语言构建实体提取器的方法。</p><h1 id="ec02" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">结论</h1><p id="6051" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">本文展示了如何使用多语言模型来构建一个可以理解多种语言的聊天机器人，以避免管理多个本质上相同的机器人的开销。</p><p id="a740" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">我希望你已经发现这是有用的。</p><h1 id="cd86" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">参考</h1><p id="2ccb" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">[1] <a class="ae mw" href="https://arxiv.org/abs/2106.16138" rel="noopener ugc nofollow" target="_blank"> XLM-E:通过ELECTRA进行跨语言语言模型预训练</a>。迟等。艾尔。2021.</p><p id="93ea" class="pw-post-body-paragraph lv lw it lx b ly mr kd ma mb ms kg md me mt mg mh mi mu mk ml mm mv mo mp mq im bi translated">[2] <a class="ae mw" href="https://aclanthology.org/W19-3712/" rel="noopener ugc nofollow" target="_blank">为特定语言命名实体识别调整多语言转换器</a>。阿尔希波夫等人。艾尔。2019.</p></div></div>    
</body>
</html>