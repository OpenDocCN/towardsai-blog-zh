<html>
<head>
<title>Stable Diffusion Based Image Compression</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">基于稳定扩散的图像压缩</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/stable-diffusion-based-image-compresssion-6f1f0a399202?source=collection_archive---------0-----------------------#2022-09-20">https://pub.towardsai.net/stable-diffusion-based-image-compresssion-6f1f0a399202?source=collection_archive---------0-----------------------#2022-09-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="d75b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">稳定的扩散是非常强大的有损图像压缩编解码器。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/d7941033a58535f7258951b3a872e2e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RxuQz8chZmHk8n2fwpgDsg.png"/></div></div></figure><h1 id="57ae" class="kr ks iq bd kt ku kv kw kx ky kz la lb jw lc jx ld jz le ka lf kc lg kd lh li bi translated">介绍</h1><p id="7704" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">稳定的扩散目前正在激励开源机器学习社区，也让世界各地的艺术家感到不安。我很好奇，除了让专业艺术家和设计师思考他们的工作保障之外，这种有影响力的技术发布还能用于什么。</p><p id="8a2c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在试验这个模型时，我发现它是一个非常强大的有损图像压缩编解码器。在描述我的方法和分享一些代码之前，这里有一些在高压缩因子下与JPG和WebP进行比较的结果，所有结果都是512x512像素的分辨率:</p><div class="kg kh ki kj gt ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/929fc2d19075eb181db366d2ab5c32b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*EFHagloF-WMtQ4r7_0I5nA.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/56e33612c5fd7f26ad0ef7ec58317a40.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*W7vgT4P0GJklEzfWKW3vpQ.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/e21e9c32e5e1a808f7eb77eba8d3b110.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*nR5mSQwlLM-VuhThPfTJBg.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk mu di mv mw translated">三藩市，从左到右:JPG (6.16kB)，WebP (6.80kB)，稳定扩散:(4.96kB)</figcaption></figure></div><div class="ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/a80c72e2dce6606fae69a9ae99fbb998.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*CyzmcWbX_giqKESkm3nQyA.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/fcab7f75a4ee2ea712c3a5be41335bed.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*m_7kzDcLBeljS9ysONfZ-A.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/682f95e79cb65d71af35a7991faa4d7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*9lHRjTC_23yic5EZIktnmQ.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk mu di mv mw translated">糖果店，从左到右:JPG (5.68kB)、WebP (5.71kB)、稳定扩散(4.98kB)</figcaption></figure></div><div class="ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/99c3063a702cd9c58b70e10ef1524fb3.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*QjdkbcVbPeHoC376LTubsA.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/6e8078b101e5709bc8310b6a8ff490ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*7C1lSAV5xFsDJi4ON-wp7Q.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/a21c7c6afc384c62ef981cce60564a49.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*9R6YTKPd7jRjGpCbDq9O3w.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk mu di mv mw translated">安娜，从左到右:JPG (5.66kB)，WebP (6.74kB)，稳定扩散(4.97kB)</figcaption></figure></div><p id="4521" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">这些例子表明，与JPG和WebP相比，使用稳定扩散压缩这些图像可以在更小的文件大小下产生更好的图像质量。这种质量带来了一些必须考虑的重要警告，我将在评估部分解释，但乍一看，这是一个非常有前途的积极有损图像压缩选项。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="172f" class="kr ks iq bd kt ku ne kw kx ky nf la lb jw ng jx ld jz nh ka lf kc ni kd lh li bi translated">稳定扩散的潜在空间</h1><p id="7e6d" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">稳定扩散串联使用三个经过训练的人工神经网络:</p><ul class=""><li id="6bfb" class="nj nk iq ll b lm mf lp mg ls nl lw nm ma nn me no np nq nr bi translated">一个<a class="ae ns" href="https://en.wikipedia.org/wiki/Variational_autoencoder" rel="noopener ugc nofollow" target="_blank">变型自动编码器</a></li><li id="2498" class="nj nk iq ll b lm nt lp nu ls nv lw nw ma nx me no np nq nr bi translated">一个<a class="ae ns" href="https://en.wikipedia.org/wiki/U-Net" rel="noopener ugc nofollow" target="_blank"> U网</a></li><li id="265d" class="nj nk iq ll b lm nt lp nu ls nv lw nw ma nx me no np nq nr bi translated">文本编码器</li></ul><p id="9226" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><strong class="ll ir">变分自动编码器(VAE) </strong>将图像从图像空间编码和解码成某种潜在的空间表示。潜在空间表示是任何源图像(512 x 512，3×8或4×8位)的较低分辨率(64×64)、较高精度(4×32位)的表示。</p><p id="fc93" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">VAE如何将图像编码到这个潜在空间中，它在训练过程中自己学习，因此随着模型被进一步训练，模型的不同版本的潜在空间表示可能看起来不同，但是稳定扩散v1.4的表示看起来像这样(当被重新映射和解释为4通道彩色图像时):</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/dd91317a4e28eda4ba48303bc3bb0486.png" data-original-src="https://miro.medium.com/v2/resize:fit:128/format:webp/1*xtkGQTdH7d9o82P3qtiikQ.png"/></div></figure><p id="81b4" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">当重新缩放并将潜影解释为颜色值(使用alpha通道)时，图像的主要特征仍然可见，但是VAE也将较高分辨率的特征编码到这些像素值中。</p><p id="def4" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">VAE的一次编码/解码往返如下所示:</p><div class="kg kh ki kj gt ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/1bd62bf9a3ff6f666be8bdb8899d3870.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*lgpFMN47-sjLkqvlJfWRBA.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><img src="../Images/dd91317a4e28eda4ba48303bc3bb0486.png" data-original-src="https://miro.medium.com/v2/resize:fit:128/format:webp/1*xtkGQTdH7d9o82P3qtiikQ.png"/></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/69b091ebdc8af7f9dc9f24732911246e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*1ZEpJWzgLTUSTd0yV1TPBg.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk mu di mv mw translated">VAE往返，从左到右:512x512@24bpp地面真实，64x64@128bpp潜在空间表示，512x512@24bpp解码图像</figcaption></figure></div><p id="a49d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">注意，这个往返不是无损的。例如，在解码后，安娜在她头环上的名字稍微不太可读。1.4稳定扩散模型的VAE通常不太擅长表示小文本(以及人脸，我希望1.5版本的训练模型会有所改善)。</p><p id="0a26" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">稳定扩散的主要算法是根据简短的文本描述生成新图像，该算法对图像的潜在空间表示进行操作。它从潜在空间表示中的随机噪声开始，然后通过使用经过训练的<strong class="ll ir"> U-Net </strong>对这个潜在空间图像进行迭代去噪，简单来说，它输出它认为它在噪声中“看到”的预测，类似于我们有时在看云时看到的形状和面孔。当使用稳定扩散来生成图像时，该迭代去噪步骤由第三ML模型(文本编码器)指导，该第三ML模型向U-Net提供关于它应该试图在噪声中看到什么的信息。对于这里介绍的实验图像编解码器，不需要文本编码器。下面分享的Google Colab代码仍然利用了它，但只是创建了一个空字符串的一次性编码，用于告诉U-Net在图像重建期间进行无指导去噪。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="be23" class="kr ks iq bd kt ku ne kw kx ky nf la lb jw ng jx ld jz nh ka lf kc ni kd lh li bi translated">压缩法</h1><p id="ff6c" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">为了使用稳定扩散作为图像压缩编解码器，我研究了如何有效地压缩VAE生成的潜在表示。在我的实验中，对潜伏时间进行下采样或对潜伏时间应用现有的有损图像压缩方法被证明会大大降低重建图像的质量。然而，我发现VAE解码似乎对潜在的<a class="ae ns" href="https://en.wikipedia.org/wiki/Color_quantization" rel="noopener ugc nofollow" target="_blank">量化</a>非常鲁棒。</p><p id="3a3f" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">通过缩放、箝位并随后重新映射将潜伏从浮点量化为8位无符号整数仅导致非常小的可见重构误差:</p><div class="kg kh ki kj gt ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/69b091ebdc8af7f9dc9f24732911246e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*1ZEpJWzgLTUSTd0yV1TPBg.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/1bd62bf9a3ff6f666be8bdb8899d3870.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*lgpFMN47-sjLkqvlJfWRBA.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/44681bf7d7d5719546f8e10a4ed60a99.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*R5B3dQfQVkGTA5a3KRul_Q.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk mu di mv mw translated">左:从32位浮点潜伏解码—中:地面真实—右:从8位整数潜伏解码</figcaption></figure></div><p id="a991" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">为了量化VAE产生的延迟，我首先用1 / 0.18215对它们进行缩放，这个数字你可能已经在稳定扩散源代码中见过了。似乎用这个数除latents可以很好地将它们映射到[-1，1]范围，尽管仍然会发生一些箝位。</p><p id="f24d" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">通过将潜在位量化为8位，图像表示的数据大小现在是64*64*4*8位= 16 kB(低于未压缩基本事实的512*512*3*8位= 768 kB)</p><p id="f051" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在我的实验中，将延迟量化到8位以下并没有产生好的结果，但令人惊讶的是，通过对它们进行<a class="ae ns" href="https://en.wikipedia.org/wiki/Palette_(computing)" rel="noopener ugc nofollow" target="_blank">调色板化</a>和<a class="ae ns" href="https://en.wikipedia.org/wiki/Dither" rel="noopener ugc nofollow" target="_blank">抖动</a>来进一步量化。我用256个4*8位向量的潜在调色板和<a class="ae ns" href="https://en.wikipedia.org/wiki/Floyd%E2%80%93Steinberg_dithering" rel="noopener ugc nofollow" target="_blank">弗洛伊德-斯坦伯格抖动</a>创建了一个调色板式的表示。使用具有256个条目的调色板允许使用单个8位索引来表示每个潜在向量，使数据大小达到64*64*8+256*4*8位= 5 kB</p><p id="3d8b" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">然而，当直接用VAE解码时，palettized表示现在确实导致一些可见的伪像:</p><div class="kg kh ki kj gt ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/69b091ebdc8af7f9dc9f24732911246e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*1ZEpJWzgLTUSTd0yV1TPBg.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/44681bf7d7d5719546f8e10a4ed60a99.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*R5B3dQfQVkGTA5a3KRul_Q.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/631ceac07ac83b33450af473db836668.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*J1d40xgpRGqqjoWBOwodkg.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk mu di mv mw translated">从左开始解码:32位潜在位—中间:8位量化潜在位—右:带Floyd-Steinberg抖动的调色板式8位潜在位(注意可见失真)</figcaption></figure></div><p id="b1a2" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">调色板式潜伏时间的抖动引入了噪声，使解码结果失真。但是由于稳定扩散是基于潜在噪声的消除，我们可以使用U-Net来消除抖动引入的噪声。仅仅4次迭代之后，重建结果在视觉上非常接近未量化的版本:</p><div class="kg kh ki kj gt ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/631ceac07ac83b33450af473db836668.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*J1d40xgpRGqqjoWBOwodkg.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/3a35ab631d60543a29a031a2d3a65c59.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Pu3CP8NwoxZiyAEQV4hluw.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/1bd62bf9a3ff6f666be8bdb8899d3870.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*lgpFMN47-sjLkqvlJfWRBA.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk mu di mv mw translated">左图:调色板化和抖动延迟后——中图:4个去噪步骤后——右图:地面真实情况</figcaption></figure></div><p id="ee73" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">虽然考虑到数据大小的极大减少(相对于未压缩的基本事实，压缩因子为155倍)，结果非常好，但也可以看到引入了伪像，例如压缩前不存在的心形符号上的光泽阴影。然而，有趣的是，这种压缩方案引入的伪像对图像内容的影响比对图像质量的影响更大，记住以这种方式压缩的图像可能包含这些类型的压缩伪像是很重要的。</p><p id="20b1" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">最后，我使用zlib无损压缩调色板和索引，对于我测试的大多数样本来说，结果略低于5kB。我研究了游程编码，但是抖动对于大多数图像只留下非常短的相同索引游程(即使对于那些在图像空间中压缩时对于游程编码非常有用的图像，例如没有很多渐变的图形)。我很确定，尽管在未来仍然有更多的优化潜力有待探索。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="d72b" class="kr ks iq bd kt ku ne kw kx ky nf la lb jw ng jx ld jz nh ka lf kc ni kd lh li bi translated">估价</h1><p id="1fe4" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">为了评估这个实验性的压缩编解码器，我没有使用任何标准的测试图像或在线找到的图像，以确保我没有对可能在稳定扩散模型的训练集中使用的任何数据进行测试(因为这样的图像可能会获得不公平的压缩优势，因为它们的部分数据可能已经在训练模型中进行了编码)。此外，为了尽可能公平地进行比较，我对Python图像库的JPG和WebP压缩器使用了最高的编码器质量设置，并且我还使用<a class="ae ns" href="https://github.com/wanadev/mozjpeg-lossless-optimization" rel="noopener ugc nofollow" target="_blank"> mozjpeg </a>库对压缩后的JPG数据进行了无损压缩。然后，我使用的压缩强度1小于会导致数据大小小于稳定扩散结果的压缩强度，或者最大强度(即使在最大有损JPG或WebP压缩下，许多图像也不会小于SD结果)。</p><p id="e8f1" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">值得注意的是，虽然稳定扩散结果在主观上看起来比JPG和WebP压缩图像好得多，但就PSNR或SSIM等标准测量指标而言，它们并没有明显更好(但也没有更差)。只是引入的伪像种类不太明显，因为它们对图像内容的影响比对图像质量的影响更大，然而这也是这种方法的一点危险:人们不能被重建特征的质量所欺骗，内容可能会受到压缩伪像的影响，即使它看起来非常清晰。例如，查看旧金山测试图像中的一个细节:</p><div class="kg kh ki kj gt ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/2e737a753acfe4d9053eced41e8991df.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*IAOGQl43sJs2auzRddzfBQ.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/b93b8c98ccc8acf4454083768838dfc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*uJSRnRw3JM5hEfd8JtkgCw.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/c31f22c2b363345c82768e8439ad964e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*FbjiQe2-z0wf6h2Mi-VuUA.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk mu di mv mw translated">左:JPG压缩—中:地面实况—右:稳定扩散压缩</figcaption></figure></div><p id="7029" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">正如您所看到的，虽然作为编解码器的稳定扩散在保留图像的定性方面更好(这是大多数传统压缩算法难以解决的问题)，但内容仍会受到压缩伪像的影响，并且建筑物形状等细微特征可能会发生变化。虽然在JPG压缩图像中肯定不可能比在稳定扩散压缩图像中识别出更多的基本事实，但是SD结果的高视觉质量可能具有欺骗性，因为JPG和WebP中的压缩伪像更容易被识别。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="b7e4" class="kr ks iq bd kt ku ne kw kx ky nf la lb jw ng jx ld jz nh ka lf kc ni kd lh li bi translated">限制</h1><p id="d726" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">稳定扩散VAE目前没有很好地保留一些特征，特别是小文本和人脸似乎是有问题的(这与在其模型卡上列出<a class="ae ns" href="https://huggingface.co/CompVis/stable-diffusion-v1-4" rel="noopener ugc nofollow" target="_blank">的V1.4 SD模型的限制和偏见一致)。这里有三个例子可以说明这一点:</a></p><div class="kg kh ki kj gt ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/dae5b64a7032bcf70a113bbcafd666dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*IJHS4QqG477A6DV9XijurA.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/273883534c4803c49d0da7e4805fad91.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*u63pX4yjbT3fwRjXfcNFQg.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/56c30640c5c7e1bfab9e7e2c3d617f93.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Qztxm_sjop1YRODaJm2WtQ.png"/></div></figure></div><div class="ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/243e087afbdd8cc9526d2ce8214974ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*CkCqldUf3e1enuGUhHpPOQ.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/a1eee576b280b075b27ecfbb496fd98e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*oogJseFoUZkZifh6LLFwdQ.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/fdbb69e7fec9912157c43640aa813687.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*RCG7lcPNGAUnpkeSsYGGbg.png"/></div></figure></div><div class="ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/757cf6c0ca2e127962bc2414ef69abd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*g_0DY2B-TzCEpleqxnxdCw.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/34d8921b7dd2809c74cbeee5f519cf6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*YDA_04MRjcxXfzFIen2kPA.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/5b8aace246229f138e4b0cbdc969b73e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*MOiIOEKNYyXv-ir4gt_RBw.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk mu di mv mw translated">左:地面实况—中:直接VAE往返(32位延迟)—右:从调色板化和去噪声的8位延迟中解码</figcaption></figure></div><p id="e066" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">正如您在中间一栏中看到的，当前的稳定扩散1.4 VAE模型不保留小文本，并且在其潜在空间中表现非常好，因此这种压缩方案继承了这些限制。但由于1.5版本的稳定扩散(目前仅在stability.ai的Dreamstudio中可用)似乎在人脸方面做得更好，我期待着在1.5模型公开发布后更新这篇文章。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="62de" class="kr ks iq bd kt ku ne kw kx ky nf la lb jw ng jx ld jz nh ka lf kc ni kd lh li bi translated">这种方法与基于ML的图像恢复有何不同？</h1><p id="d81e" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">深度学习非常成功地用于恢复降级的图像和视频，或者将其放大到更高的分辨率。这种方法与恢复因图像压缩而降级的图像有何不同？</p><p id="832b" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">重要的是要理解，这里不使用稳定扩散来恢复图像空间中因压缩而降级的图像，而是将有损压缩应用于稳定扩散对该图像的内部理解，然后尝试“修复”有损压缩对内部表示造成的损坏(这与修复降级的图像不同)。</p><p id="d001" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">例如，这保留了相机颗粒(定性地)以及任何其他定性的退化，而高度压缩的jpg的AI恢复将不能恢复该相机颗粒，因为关于它的任何信息已经从数据中丢失。</p><p id="1efd" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">为了给这种差异打个比方:假设我们有一个拥有摄影记忆的高技能艺术家。我们给他们看一个图像，然后让他们重新创建它，他们可以根据自己的记忆创建一个几乎完美的副本。这位艺术家的过目不忘是稳定扩散的VAE。</p><p id="7cfa" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">在修复的情况下，我们会给这位艺术家看一张由于图像压缩而严重退化的图像，然后让他们根据记忆重建这张图像，但在某种程度上，他们认为这张图像应该是退化前的样子。</p><p id="f4f7" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">然而，在这里实现的例子中，我们向他们展示原始的、未压缩的图像，并要求他们尽可能好地记住它。然后，我们对他们进行脑部手术，通过有损压缩来缩小他们记忆中的数据，这种压缩去除了看起来不重要的细微差别，并用相同的变化替换了记忆图像中非常相似的概念和方面的变化。</p><p id="4f13" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">手术后，我们要求他们根据记忆创建一个完美的图像重建。他们仍然会记得图像的所有重要方面，例如从内容到相机颗粒的定性属性，以及他们看到的每个建筑物的位置和总体外观，尽管相机颗粒的每个点的确切位置不再相同，并且他们现在会记得一些建筑物有奇怪的缺陷，这些缺陷实际上没有意义。</p><p id="bda3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">最后，我们要求他们再次绘制图像，但这一次，如果他们以一种非常奇怪的方式记住了一些对他们来说没有多大意义的方面，他们应该利用他们的经验以一种有意义的方式绘制这些东西(注意，“没有意义”并不等同于“不好”——模糊或有划痕的照片是不好的，但这种缺陷非常有意义)。</p><p id="8e0e" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">因此，在这两种情况下，艺术家被要求根据他们的经验画出他们认为应该看起来的东西，但是由于这里的压缩已经应用于他们对图像的记忆表示，其存储的概念多于像素，因此只有概念的信息内容被减少，而在恢复由图像压缩降级的图像的情况下，图像的视觉质量和概念内容都被降低，并且必须由艺术家发明。</p><p id="6a7c" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">这个类比也清楚地表明，这种压缩方案受到艺术家的摄影记忆效果的限制。在稳定扩散v1.4的情况下，他们不太擅长记住面孔，也患有阅读障碍。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="75f9" class="kr ks iq bd kt ku ne kw kx ky nf la lb jw ng jx ld jz nh ka lf kc ni kd lh li bi translated">密码</h1><p id="477f" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">如果你想亲自尝试这个实验性的编解码器，你可以使用下面的Google Colab:</p><p id="9a4f" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated"><a class="ae ns" href="https://colab.research.google.com/drive/1Ci1VYHuFJK5eOX9TB0Mq4NsqkeDrMaaH?usp=sharing" rel="noopener ugc nofollow" target="_blank">https://colab . research . Google . com/drive/1 ci 1 vyhufjk 5 eox 9 TB 0 MQ 4 nsqkedrmaah？usp =共享</a></p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="2c4c" class="kr ks iq bd kt ku ne kw kx ky nf la lb jw ng jx ld jz nh ka lf kc ni kd lh li bi translated">结论</h1><p id="ccae" class="pw-post-body-paragraph lj lk iq ll b lm ln jr lo lp lq ju lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">稳定扩散看起来非常有希望作为有损图像压缩方案的基础。</p><p id="5ef3" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">我在这里的实验非常浅，我希望除了这里描述的技术之外，还有更多压缩潜在空间表示的潜力，但是即使是这种相对简单的量化和抖动方案也已经产生了非常令人印象深刻的结果。</p><p id="d623" class="pw-post-body-paragraph lj lk iq ll b lm mf jr lo lp mg ju lr ls mh lu lv lw mi ly lz ma mj mc md me ij bi translated">虽然专门为图像压缩设计和训练的VAE可能在这项任务中表现得更好，但使用稳定扩散VAE的巨大优势是，可以直接利用已经投入稳定扩散训练的6-7位数，而不必投入大量资金来训练这项任务的新模型。</p></div><div class="ab cl mx my hu mz" role="separator"><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc nd"/><span class="na bw bk nb nc"/></div><div class="ij ik il im in"><h1 id="adfe" class="kr ks iq bd kt ku ne kw kx ky nf la lb jw ng jx ld jz nh ka lf kc ni kd lh li bi translated">附录:附加结果</h1><div class="kg kh ki kj gt ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/e3492de922980a58457ed77e2da88bf3.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*lXEHQ_9xceooJQFNpa1TRg.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/19ced64a7b45d707105b6fb17772f8ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*HfOkQwGTUHjbvCwdLgQVjA.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/6864fb5d9bd40be611b6b45f77532e2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*LdLBHx_dUPp97lzGzuyk4g.png"/></div></figure></div><div class="ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/6a97ed6eca579aa677b451e360545206.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*-fUxF45PjiOfR45iVyb3dQ.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/5331ac1336444e3eea727e9f105d4f0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*8jLaZT7pO4AReSsHSlmaqw.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/5d748b1ef038e6a8798a5caa82ffe31c.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*N7emaEMZYxJHnJeq9A9FuA.png"/></div></figure></div><div class="ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/e66e42c079c428f4ebfa967c90985835.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*O3p6oqlG25IPwPDof0A_og.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/1708f66e0a6fa96d5a2114d6e64b825a.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*rf35a6Nd9TrLPZRGbhOVwA.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/fdbb69e7fec9912157c43640aa813687.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*RCG7lcPNGAUnpkeSsYGGbg.png"/></div></figure></div><div class="ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/26aefa532e8413c742eb3e9fc6f66ea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*HxY6MIE9aH-Kav1FHq_rvA.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/d30113513209ce1c6a13d21d451ccdeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*1U61g6uDXb7nKRnJ2zznnw.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/0c3753571c38acfc77066a852367db1d.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*a7RK1RTGpNaBX8ug2s28NQ.png"/></div></figure></div><div class="ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/238ac4ce82b00457060017f08f7595c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*tw380IfvQSOzhdCLdtVnKg.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/3b1f621204c0fd9a4e081aad7f4a47de.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*BgsP_QnoC52updwR4Lz5lw.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/5b8aace246229f138e4b0cbdc969b73e.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*MOiIOEKNYyXv-ir4gt_RBw.png"/></div></figure></div><div class="ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/29a1b9c72c939d10099f46a1fd802033.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*BrTmG1UepjrN_1Q8NWhZWQ.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/6991a2039457b54dd849dbcdeca3651f.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*z4VVlwn2T4S4Twc_PSlIvQ.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/4a65e749091496d85aa4cf61428040e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*lAli9Dr-_RKS7sOlbsIVsA.png"/></div></figure></div><div class="ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/d59c7de1866ba6446ff5067e8ba2ba4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*ud4QE-fEyHfrwGV9rS6xmA.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/b23c254aaa17fb336320c6cc88c82725.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*BBImbhbOXzCfeVw14qFutw.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/9d4e1f315d836f6843ca153abd92b8ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*24mqzBHqEb3CSjVmE35fog.png"/></div></figure></div><div class="ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/3a6723e996e8d145be0bbaa32ddec430.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*UjwLquHTz9ZSLKbtbcfY2w.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/b711d326d7eb6cadac4825e871ac40d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*GOmYXFXoSK_-Tk9n8gf_GQ.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/9cfa631ea859d3968531e1919b2c4b88.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*rng8IY_R5eymu-ANGOgLVQ.png"/></div></figure></div><div class="ab cb"><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/f1bb0031abd2fb93c43011ad10e4aa03.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Jj8SDNEZgW_ys8jLqFuMlg.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/5b279c1b2a30016c0d2c4d66a0af8f46.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Dh_XLFqxf3GMbEVXSqragQ.png"/></div></figure><figure class="mk kk ml mm mn mo mp paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><img src="../Images/676950bf784d761b8b13527779d486ba.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*NvfHC6JGRgTlYSuShgdRCw.png"/></div><figcaption class="mq mr gj gh gi ms mt bd b be z dk mu di mv mw translated">左:JPG —中:WebP —右:稳定扩散。在所有情况下，SD图像被压缩成比相应的JPG和WebP图像更小的文件大小。没有樱桃采摘的结果。</figcaption></figure></div></div></div>    
</body>
</html>