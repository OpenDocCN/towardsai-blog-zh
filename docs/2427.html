<html>
<head>
<title>How To Use Knowledge Graphs To Build Chatbots That Can Parse Ambiguous User Utterances</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用知识图来构建聊天机器人，以解析模糊的用户话语</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-to-use-knowledge-graphs-to-build-chatbots-that-can-parse-ambiguous-user-utterances-eb25fbbf9f6?source=collection_archive---------0-----------------------#2021-12-17">https://pub.towardsai.net/how-to-use-knowledge-graphs-to-build-chatbots-that-can-parse-ambiguous-user-utterances-eb25fbbf9f6?source=collection_archive---------0-----------------------#2021-12-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7749" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/nlp" rel="noopener ugc nofollow" target="_blank">自然语言处理</a></h2><div class=""/><figure class="gl gn ka kb kc kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi jz"><img src="../Images/1660c1a98ab19fcdf2fe16933ae8176d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-Itgt9bvtOa1MfSXeytDew.png"/></div></div></figure><h1 id="4c06" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">介绍</h1><p id="d45d" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">在本文中，我将解释聊天机器人如何使用知识图来解析从歧义话语中提取的实体。</p><p id="ec48" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">我们将使用<a class="ae ml" href="https://rasa.com/" rel="noopener ugc nofollow" target="_blank"> Rasa </a>作为示例聊天机器人，使用<a class="ae ml" href="https://vaticle.com/" rel="noopener ugc nofollow" target="_blank"> TypeDB </a>作为示例知识图。我假设用户熟悉这些工具的工作方式。否则，人们可以参考各自工具的快速入门指南。</p><p id="0b2e" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">本文中重现结果的代码可以在<a class="ae ml" href="https://github.com/hsm207/rasa_kg" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="c6c1" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">问题陈述</h1><p id="fcdb" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">假设您的任务是为一家电信公司构建聊天机器人，以改善他们的客户体验。这意味着机器人应该能够处理诸如账单支付、普通客户查询、在线购买等事情。</p><p id="d031" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">所以，假设有这样一句话:</p><blockquote class="mm mn mo"><p id="607f" class="li lj mp lk b ll mg ln lo lp mh lr ls mq mi lv lw mr mj lz ma ms mk md me mf im bi translated">我想买一部iphone</p></blockquote><p id="8e05" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">很明显，用户的意图是购买设备，单词“iPhone”就是该设备。因此，注释这个话语的意图和实体是简单的。</p><p id="2801" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">现在，考虑下面的话语:</p><blockquote class="mm mn mo"><p id="3ce1" class="li lj mp lk b ll mg ln lo lp mh lr ls mq mi lv lw mr mj lz ma ms mk md me mf im bi translated">苹果手机</p></blockquote><p id="78d3" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">如果没有额外的语境，很难理解如何理解上述话语。</p><p id="7a69" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">假设话语“iPhone”出现在以下上下文中:</p><figure class="mu mv mw mx gt kd gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/70d4f328eeca4fbae725854902546bd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:812/format:webp/1*PyJveoXrxGIULr5EhhkQZQ.png"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图1:示例对话</figcaption></figure><p id="c32c" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">图1显示用户想问一个问题。机器人通过要求用户澄清他们的问题是关于移动还是互联网合同来做出响应(让我们假设机器人只能处理这些类型的问题)，并为用户提供几个按钮来表明他们的意图。</p><p id="fbc8" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">让我们想象一下，用户不确定他们拥有哪个合同:他们从该公司获得了一部iPhone，但不确定它是通过移动合同还是互联网合同，因为……iPhone是一种可以用来上网冲浪的移动设备。</p><p id="23fe" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">因此，用户没有点击任何一个按钮，而是决定键入“iPhone ”,希望机器人足够聪明，能够找出正确的合同。</p><p id="d2fb" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">我们如何将这样的“智能”构建到聊天机器人中？</p><p id="ae40" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">意图或实体注释都不是可行的选项，因为话语只有一个单词，所以它缺少上下文，即周围的单词，以使意图分类或实体提取工作良好。</p><p id="873b" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">一个显而易见的解决方案是使意图分类和实体提取与上下文相关，例如，根据用户的话语和对话中的先前<code class="fe nc nd ne nf b">n</code>话轮来训练意图分类器和实体提取器。如果您正在使用的聊天机器人框架支持它，或者您愿意投资自己构建该功能所需的资源，这是一个不错的选择。</p><p id="e6e4" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">如果上市时间是一个关键因素，那么您需要尽可能地利用现有的解决方案。在这种情况下，通过知识图构建推理功能是更好的选择。</p><h1 id="de08" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">解决办法</h1><h2 id="81ce" class="ng kl it bd km nh ni dn kq nj nk dp ku lt nl nm ky lx nn no lc mb np nq lg iz bi translated">概观</h2><p id="164f" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">使用知识图来帮助聊天机器人解决不明确的实体包括3个步骤:</p><ol class=""><li id="d507" class="nr ns it lk b ll mg lp mh lt nt lx nu mb nv mf nw nx ny nz bi translated">定义知识图</li><li id="b7c1" class="nr ns it lk b ll oa lp ob lt oc lx od mb oe mf nw nx ny nz bi translated">编写逻辑代码以解析实体</li><li id="b4fb" class="nr ns it lk b ll oa lp ob lt oc lx od mb oe mf nw nx ny nz bi translated">调用歧义消除逻辑</li></ol><h2 id="54b2" class="ng kl it bd km nh ni dn kq nj nk dp ku lt nl nm ky lx nn no lc mb np nq lg iz bi translated">步骤1:定义知识图</h2><p id="7be3" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">本文将使用下面的知识图表来演示该解决方案是如何工作的:</p><figure class="mu mv mw mx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi of"><img src="../Images/4339a0f026e9fce8590dbbae93ec31ac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y-nEmm6w4gK6J3A00YxbzQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图2:一家电信公司的知识图示例</figcaption></figure><p id="db31" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">图2显示电信公司有3种设备:智能手表、路由器和电话。它有两种类型的计划:移动和互联网。“合同”将计划与设备联系起来。</p><p id="6bd5" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">在我们试图解决的问题的背景下，我们可以对图2中的知识图进行相关的观察:</p><ol class=""><li id="02ea" class="nr ns it lk b ll mg lp mh lt nt lx nu mb nv mf nw nx ny nz bi translated">有一份合同规定，一部“三星”手机附带“儿童专用”手机套餐。</li><li id="f30e" class="nr ns it lk b ll oa lp ob lt oc lx od mb oe mf nw nx ny nz bi translated">有一份合同规定“iPhone”手机附带“无限启动”移动计划。</li><li id="ad30" class="nr ns it lk b ll oa lp ob lt oc lx od mb oe mf nw nx ny nz bi translated">有一份合同规定“链接区”路由器附带“最大互联网”互联网计划。</li><li id="074a" class="nr ns it lk b ll oa lp ob lt oc lx od mb oe mf nw nx ny nz bi translated">智能手表没有合同</li><li id="e030" class="nr ns it lk b ll oa lp ob lt oc lx od mb oe mf nw nx ny nz bi translated">“一加”手机没有合约</li></ol><p id="3155" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">因此，如果用户在被问及是否有关于移动或互联网合同的问题时回答“iPhone”，那么可以合理地假设他们指的是移动合同。同样，如果他们回答“链接区”，那么他们可能指的是互联网合同。</p><p id="dc21" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">让我们看看如何实现这个逻辑。</p><h2 id="d7cf" class="ng kl it bd km nh ni dn kq nj nk dp ku lt nl nm ky lx nn no lc mb np nq lg iz bi translated">步骤2:编写逻辑代码来解析实体</h2><p id="ff6d" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">Rasa的<a class="ae ml" href="https://rasa.com/docs/rasa/2.x/custom-actions" rel="noopener ugc nofollow" target="_blank">自定义动作</a>特性允许执行任意代码。因此，这是实现自定义实体解析逻辑的好地方。下面是实现这一点的代码:</p><figure class="mu mv mw mx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi og"><img src="../Images/70d4bead2c76645cfa118c278aa5f408.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YMOtJ1HyCYS-UgpAyFeM9Q.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图3:如何消除用户对移动和互联网合同问题的答案的歧义</figcaption></figure><p id="db25" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">如果用户点击了图1中的任何一个按钮，那么<code class="fe nc nd ne nf b">contract_type</code>槽就会被正确的实体填充。这意味着我们不需要做任何事情，可以退出自定义操作(第58行)。</p><p id="0798" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">如果用户没有点击任何一个按钮，并且他们的话语包含一个<code class="fe nc nd ne nf b">device</code>实体，例如“iPhone”、“有iPhone的那个”等等，那么我们计算出设备计划的类型(第61行)并且相应地设置<code class="fe nc nd ne nf b">contract_type</code>槽。</p><p id="317f" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">以下是计算设备计划的函数:</p><figure class="mu mv mw mx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi oh"><img src="../Images/a908bc95d4df66b814835d0155a2a10f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uGk2skhn5VUvgWAnb2GAIw.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图4:如何确定设备的计划类型</figcaption></figure><p id="1ddc" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">第12–18行是我们将发送到知识图的查询，返回设备的计划。</p><p id="33cd" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">如果查询返回一个计划，那么我们返回计划的类型(第30行)。否则，我们返回<code class="fe nc nd ne nf b">None</code>(第28行)。请注意，我们假设一个设备只有一种规划类型。</p><p id="6db3" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">剩下的就是在对话过程中调用这个自定义操作。</p><h2 id="f6e0" class="ng kl it bd km nh ni dn kq nj nk dp ku lt nl nm ky lx nn no lc mb np nq lg iz bi translated">步骤3:调用歧义消除逻辑</h2><p id="ee96" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">这一步很简单:我们只需在用户表达了他们的偏好后插入对定制动作的调用。</p><p id="ad85" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">例如，如果我们使用以下规则实现了图1中的对话:</p><figure class="mu mv mw mx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi oi"><img src="../Images/a17cf55bb3838fbd724f407f47696851.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*T--c5-lTBWEsvFoEmJtIYg.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图5:图1中对话的实现</figcaption></figure><p id="0d78" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">然后，我们需要将其更改为:</p><figure class="mu mv mw mx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi oj"><img src="../Images/643e631d3ba947451db16aea25021db8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XtePBrBgmALK4lKTfEJ0WQ.png"/></div></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图6:支持实体解析的图5的更新</figcaption></figure><p id="f1aa" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">请注意，我们必须做的唯一更改是调用我们在图3中定义的自定义操作(第35行)。</p><h1 id="cbf4" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">演示</h1><p id="30d1" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">如果用户点击“移动合同”，应该会发生以下情况:</p><figure class="mu mv mw mx gt kd gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/dd796c89c09134b676a05033c5729d40.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/1*HlTWlLbW-iA4sCgGMIFHqA.gif"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图7:用户点击“移动合同”</figcaption></figure><p id="96b5" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">如果用户点击“互联网合同”:</p><figure class="mu mv mw mx gt kd gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/86f1cdc00f2533044052fff5b38474a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/1*K-9sirN0OS3pnTKpssT1Qg.gif"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图8:用户点击“互联网合同”</figcaption></figure><p id="13af" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">由于一个“iPhone”连接到一个移动计划，当用户说出“iPhone”时，我们期望得到与图7相同的结果。如果用户键入“链接区域”，类似的推理也适用:</p><figure class="mu mv mw mx gt kd gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/c4325d84834a50487d40cf2b2b512784.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/1*x1uYSLqaOxDhWoQBC28GaQ.gif"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图9:如果用户说出连接到移动计划的设备</figcaption></figure><figure class="mu mv mw mx gt kd gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/750b29fbb5cf11b9db216d8e4e71c984.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/1*oCCLzKLj0UcZnQtMcgls6g.gif"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图10:如果用户说出一个连接到互联网计划的设备</figcaption></figure><p id="e42d" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">由于“一加”手机与任何计划都无关，我们预计该机器人无法理解用户的意图:</p><figure class="mu mv mw mx gt kd gh gi paragraph-image"><div class="gh gi ok"><img src="../Images/153f773032626f986334540f428361bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/1*l2QffgSjNKiES2yC7DTL_w.gif"/></div><figcaption class="my mz gj gh gi na nb bd b be z dk translated">图11:当用户说出没有连接到移动或互联网计划的设备时</figcaption></figure><h1 id="d714" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">结论</h1><p id="5a64" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">本文展示了聊天机器人如何使用知识图来解析具有多种“含义”的实体。</p><p id="f954" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">虽然解析逻辑可以在没有知识图的情况下实现，但是使用它的好处是可以将逻辑委托给外部的专门服务。应用程序(即聊天机器人开发者)不再负责对其进行编码。这在可维护性、可伸缩性和支持更复杂的解析逻辑方面有巨大的好处。</p><p id="0df7" class="pw-post-body-paragraph li lj it lk b ll mg ln lo lp mh lr ls lt mi lv lw lx mj lz ma mb mk md me mf im bi translated">我希望这篇文章对你有用。</p></div></div>    
</body>
</html>