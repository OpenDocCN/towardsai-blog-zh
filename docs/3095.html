<html>
<head>
<title>You Can Use Databricks and AWS S3 With MLflow FREE</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">您可以将Databricks和AWS S3与MLflow FREE一起使用</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/you-can-use-databricks-and-aws-s3-with-mlflow-free-8ef071a647a0?source=collection_archive---------0-----------------------#2022-09-06">https://pub.towardsai.net/you-can-use-databricks-and-aws-s3-with-mlflow-free-8ef071a647a0?source=collection_archive---------0-----------------------#2022-09-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/08eae8e8870dcdad9e61078bdab526fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fNBVqqNkMCkVAR8pLpUfDg.jpeg"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">Aleksandr Neplokhov拍摄的照片:<a class="ae kf" href="https://www.pexels.com/photo/group-of-people-gathering-near-frees-standing-flow-letters-1238965/" rel="noopener ugc nofollow" target="_blank">https://www . pexels . com/photo/group-of-people-gathering-near-frees-standing-flow-letters-1238965/</a></figcaption></figure><p id="34ee" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您将在几分钟内获得带有数据块和S3的模型跟踪服务器。</p><p id="c9c5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">易于遵循，一步一步的解释将是你的旅程指南。</p><p id="21eb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你会喜欢的。</p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><h1 id="b85a" class="ll lm it bd ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi bi translated"><strong class="ak">内容</strong></h1><p id="df74" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated"><a class="ae kf" href="#402f" rel="noopener ugc nofollow">简介</a></p><p id="9123" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#78b1" rel="noopener ugc nofollow">作为远程服务器的数据块</a></p><p id="05a1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#0acc" rel="noopener ugc nofollow">创建数据块自由账户</a></p><p id="af6e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#bad1" rel="noopener ugc nofollow">数据块CLI和认证</a></p><p id="5c91" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#ee78" rel="noopener ugc nofollow">使用数据块作为远程服务器</a></p><p id="942b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#1af3" rel="noopener ugc nofollow"> AWS S3作为文物商店</a></p><p id="8819" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#2041" rel="noopener ugc nofollow">AWS账户的必要安排</a></p><p id="d148" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#b4b8" rel="noopener ugc nofollow">利用S3作为文物商店</a></p><p id="9948" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><a class="ae kf" href="#8f87" rel="noopener ugc nofollow">结论</a></p></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi mo"><img src="../Images/a5476b62f42d4448b4af97ea1c550eb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BTugHE3KS8VimyNQzd0now.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><h1 id="402f" class="ll lm it bd ln lo mt lq lr ls mu lu lv lw mv ly lz ma mw mc md me mx mg mh mi bi translated"><strong class="ak">简介</strong></h1><blockquote class="my mz na"><p id="9fb5" class="kg kh nb ki b kj kk kl km kn ko kp kq nc ks kt ku nd kw kx ky ne la lb lc ld im bi translated">MLflow是一个管理ML生命周期的开源平台，包括实验、再现性、部署和中央模型注册。(https://mlflow.org/)</p></blockquote><p id="fe84" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在<a class="ae kf" href="https://medium.com/@kaanboke/step-by-step-mlflow-implementations-a9872dd32d9b" rel="noopener"> <strong class="ki iu">上一篇文章</strong> </a>中，我们讨论了在本地环境中逐步实现MLflow。</p><p id="786f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本文中，我们将看到:</p><p id="02a5" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🟢:我们如何使用数据块在远程MLflow跟踪服务器上记录模型参数和工件？</p><p id="3de1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🟢:我们怎样才能把AWS S3作为一个文物商店呢？</p><p id="bb3e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们开始吧。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/acea06518872f916114f1137506104ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/0*syZuCQPdmKCy6fv9"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片来源:<a class="ae kf" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank">https://giphy.com/</a></figcaption></figure><h1 id="78b1" class="ll lm it bd ln lo mt lq lr ls mu lu lv lw mv ly lz ma mw mc md me mx mg mh mi bi translated">作为远程服务器的数据块</h1><blockquote class="my mz na"><p id="0fdb" class="kg kh nb ki b kj kk kl km kn ko kp kq nc ks kt ku nd kw kx ky ne la lb lc ld im bi translated">“Databricks是一个快速、简单、协作的基于Apache Spark的大数据分析服务，专为数据科学和数据工程而设计。”(www.azure.microsoft.com)</p></blockquote><h1 id="0acc" class="ll lm it bd ln lo mt lq lr ls mu lu lv lw mv ly lz ma mw mc md me mx mg mh mi bi translated">创建数据块自由帐户</h1><p id="8101" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">对于这项研究，我使用Databricks社区版(免费版)，所以我们不需要支付任何额外的费用。</p><p id="9710" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在继续之前，让我们在Databricks社区版上创建一个帐户。</p><p id="dd2f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，点击<a class="ae kf" href="https://accounts.cloud.databricks.com/login" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu">这里的</strong> </a>进入主登录页面</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/24ec9599e219d1fa0edb1496c879d453.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vLl-wV4Fw5WC5N-r-MphWg.png"/></div></div></figure><p id="6a6f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🛑小心点。</p><p id="f262" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">如果你想获得一个免费账号</strong>，不要用大盒子登录。</p><p id="2dcd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你必须在页面上往下一点，你会看到(希望:)我见过的最小的登录信息。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ng"><img src="../Images/2d9a7d1929413ddf6ca84bfecb1f9409.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YfKURQJC9HhY6d-s-C1HqA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="a712" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">并在此页面注册。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nh"><img src="../Images/c8ef6ba721163c1614b1d818063b4e1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DR3Ms7X6nrhQtzkKV6oRag.png"/></div></div></figure><h1 id="bad1" class="ll lm it bd ln lo mt lq lr ls mu lu lv lw mv ly lz ma mw mc md me mx mg mh mi bi translated">DATABRICKS CLI和认证</h1><p id="4d7d" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">免费注册到Databricks后，我们需要使用<a class="ae kf" href="https://docs.databricks.com/dev-tools/cli" rel="noopener ugc nofollow" target="_blank"> Databricks命令行工具</a>启动从本地计算机到Databricks的连接。</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="4c5f" class="nn lm it nj b gy no np l nq nr">pip install databricks-cli</span></pre><p id="61e1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们确认一下安装</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="2afa" class="nn lm it nj b gy no np l nq nr">databricks -v</span></pre><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/04bf1d38c60f37698d03bc7ac59c1275.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/0*LUfpfu0Gu9x48_xL"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="1ae8" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">然后，我们需要设置身份验证。</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="65d4" class="nn lm it nj b gy no np l nq nr">databricks configure</span></pre><p id="684f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">发出这个命令后，我们需要回答</p><p id="f024" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🔵<strong class="ki iu"> <em class="nb"> Databricks主机</em> </strong>(应以<a class="ae kf" rel="noopener ugc nofollow" target="_blank" href="/)"> https://)开头:</a></p><p id="af5c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">写下面→<a class="ae kf" href="https://community.cloud.databricks.com/" rel="noopener ugc nofollow" target="_blank">https://community.cloud.databricks.com/</a></p><p id="5b31" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🔵<strong class="ki iu"> <em class="nb">用户名</em> </strong> : &lt;您的用户名&gt;</p><p id="4351" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🔵<strong class="ki iu"> <em class="nb">密码</em> </strong> : &lt;您的密码&gt;</p><p id="1a58" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们检查一下</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="87d5" class="nn lm it nj b gy no np l nq nr">databricks workspace ls /Users/&lt;someone@example.com&gt;</span></pre><p id="e42f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🔵使用您的用户名，而不是<someone/></p><p id="a70d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果此命令成功，您可以看到工作环境中的对象列表。</p><p id="8cb1" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们准备进入下一步。</p><h1 id="ee78" class="ll lm it bd ln lo mt lq lr ls mu lu lv lw mv ly lz ma mw mc md me mx mg mh mi bi translated">将数据块用作远程服务器</h1><p id="d26f" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">现在，我们可以使用Databricks作为我们的远程服务器。</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="45b3" class="nn lm it nj b gy no np l nq nr">import mlflow<br/><br/><br/>mlflow.set_tracking_uri("databricks")</span><span id="2f79" class="nn lm it nj b gy nt np l nq nr">mlflow.set_experiment("/Users/&lt;your username&gt;/heart-disease-experiment")</span></pre><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nu"><img src="../Images/5cd1917bde2dbfee13998132de667547.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*D5Yl1kw4z4-Y1zNN"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="8d5b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">正如我们在<a class="ae kf" href="https://medium.com/@kaanboke/step-by-step-mlflow-implementations-a9872dd32d9b" rel="noopener"> <strong class="ki iu">上一篇文章</strong> </a>中所做的，我们可以在Databricks平台中运行我们的模型并获得模型参数和工件。</p><p id="0b86" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们运行单个模型，并在Databricks平台中查看该模型。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nv"><img src="../Images/4b48392ce2fdce9b3aeac8603c96ae34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*nTBgaTpRqRV361Xc"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/1378347aa2b688e11692789a1825208c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ZlOV2y5ABQx0j0_R"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="89f7" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们运行多个模型，并在Databricks平台中查看这些模型。</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="0099" class="nn lm it nj b gy no np l nq nr">mlflow.sklearn.autolog()<br/><br/><br/>lr = LogisticRegression(solver='liblinear')<br/>lda= LinearDiscriminantAnalysis()<br/>svm = SVC(gamma='scale')<br/>knn = KNeighborsClassifier()<br/>ada = AdaBoostClassifier(random_state=0)<br/>gb = GradientBoostingClassifier(random_state=0)<br/>rf = RandomForestClassifier(random_state=0)<br/>et=  ExtraTreesClassifier(random_state=0)<br/>xgbc = XGBClassifier(random_state=0)<br/><br/><br/>models = [lr,lda,svm,knn,ada,gb,rf,et,xgbc]<br/><br/><br/>for model in models: <br/>    with mlflow.start_run(run_name=f'Run {model}') as run:<br/>        mlflow.set_tag("model", model)<br/>        mlflow.set_tag("data scientist", "kb")<br/>        X= df.drop('HeartDisease', axis=1)<br/>        y= df['HeartDisease']<br/>        X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)<br/>        ohe= OneHotEncoder()<br/>        ct= make_column_transformer((ohe,categorical),remainder='passthrough') <br/>        pipe = make_pipeline(ct, model)<br/>        pipe.fit(X_train, y_train)<br/>        y_pred = pipe.predict(X_test)<br/>        accuracy = round(accuracy_score(y_test, y_pred),4)<br/>        mlflow.log_metric("accuracy", accuracy)</span></pre><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nx"><img src="../Images/10545d81f8664ea56062b2d2a1d05105.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vxZV5Xk0U02AAwcX"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="c531" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们比较一下模型的准确度。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nw"><img src="../Images/954b7582fb8cf5465ab2ced2144780fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*m4sFW7hl6vGQ7nqZ"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="635d" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们已经成功地安排了Databricks，我们的远程服务器。</p><p id="03dd" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们使用Databricks在远程MLflow跟踪服务器上记录了模型参数和工件。</p><p id="0af3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">好的。我们已经准备好看到故事的AWS一面。</p><h1 id="1af3" class="ll lm it bd ln lo mt lq lr ls mu lu lv lw mv ly lz ma mw mc md me mx mg mh mi bi translated">AWS S3作为一个文物商店</h1><blockquote class="my mz na"><p id="aa04" class="kg kh nb ki b kj kk kl km kn ko kp kq nc ks kt ku nd kw kx ky ne la lb lc ld im bi translated"><strong class="ki iu">工件存储</strong>是一个适合于大数据(例如S3存储桶或共享NFS文件系统)的位置，客户在这里记录他们的工件输出(例如模型)(www.mlflow.com)</p></blockquote><p id="4b42" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">即使MLflow网站没有给出如何安排S3桶作为神器商店的明确指导，你会发现按照下面的教程很容易。</p><h1 id="2041" class="ll lm it bd ln lo mt lq lr ls mu lu lv lw mv ly lz ma mw mc md me mx mg mh mi bi translated">AWS账户的必要安排</h1><p id="23b4" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">我假设您的计算机上已经安装了一个AWS帐户(对于本教程，自由层帐户就足够了)。</p><p id="3d47" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们安装最新版本的AWS AWS命令行界面。我们将遵循<a class="ae kf" href="https://docs.aws.amazon.com/cli/latest/userguide/getting-started-install.html" rel="noopener ugc nofollow" target="_blank"> <strong class="ki iu"> AWS网页</strong> </a>上给出的说明。</p><p id="cf0b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">针对MAC用户</strong></p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="3cc9" class="nn lm it nj b gy no np l nq nr">curl "https://awscli.amazonaws.com/AWSCLIV2.pkg" -o "AWSCLIV2.pkg"<br/><br/>sudo installer -pkg AWSCLIV2.pkg -target /</span></pre><p id="03de" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">对于Windows用户</strong></p><p id="fd5c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下载并运行用于Windows的AWS CLI MSI安装程序(64位):</p><p id="037f" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">https://awscli.amazonaws.com/AWSCLIV2.msi<a class="ae kf" href="https://awscli.amazonaws.com/AWSCLIV2.msi" rel="noopener ugc nofollow" target="_blank"/></p><p id="c37b" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="ki iu">针对Linux用户</strong></p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="e450" class="nn lm it nj b gy no np l nq nr">curl "https://awscli.amazonaws.com/awscli-exe-linux-x86_64.zip" -o "awscliv2.zip"<br/><br/>unzip awscliv2.zip<br/><br/>sudo ./aws/install</span></pre><p id="a642" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们用下面的命令来确认安装。</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="3a61" class="nn lm it nj b gy no np l nq nr">aws --version</span></pre><p id="f664" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在继续之前，我们必须从本地计算机配置我们的AWS帐户。</p><p id="02c3" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，确保您可以从本地计算机访问AWS S3存储桶。</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="2687" class="nn lm it nj b gy no np l nq nr">aws s3 ls</span></pre><p id="e024" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你应该得到你拥有的水桶的清单。</p><p id="f990" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您无法获得存储桶列表；输入以下命令:</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="4350" class="nn lm it nj b gy no np l nq nr">aws configure</span></pre><p id="7f26" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">按照屏幕上的指示，并提供您的钥匙。</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="dd95" class="nn lm it nj b gy no np l nq nr">[profile adminuser]<br/>aws_access_key_id = adminuser access key ID</span><span id="5304" class="nn lm it nj b gy nt np l nq nr">aws_secret_access_key = adminuser secret access key</span><span id="699e" class="nn lm it nj b gy nt np l nq nr">region = aws-region</span></pre><p id="cec0" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以我们准备使用S3桶。</p><h1 id="b4b8" class="ll lm it bd ln lo mt lq lr ls mu lu lv lw mv ly lz ma mw mc md me mx mg mh mi bi translated"><strong class="ak">利用S3作为文物商店</strong></h1><p id="2437" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">🔵首先，为MLflow工件存储创建一个新的S3存储桶。您可以使用AWS GUI或AWS CLI。</p><p id="0d4e" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🔵我将使用AWS CLI。</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="c759" class="nn lm it nj b gy no np l nq nr">aws s3 mb s3://mlflow-artifacts-2022</span></pre><p id="f423" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🔵我们指定一个s3:// <bucket> / <path>形式的URI来存储s3的工件。</path></bucket></p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="964c" class="nn lm it nj b gy no np l nq nr">expr_name = "heart-disease-exp-2"  <br/><br/>s3_bucket = "s3://mlflow-artifacts-2022"  <br/><br/>mlflow.create_experiment(expr_name, s3_bucket)<br/><br/>mlflow.set_experiment(expr_name)</span></pre><p id="6bc9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🔵让我们确保一切正常。</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="8925" class="nn lm it nj b gy no np l nq nr">with mlflow.start_run()<br/>    print(mlflow.get_artifact_uri()):</span></pre><p id="16d2" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">🔵它应该打印出一个S3桶路径。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ny"><img src="../Images/ed29214b84c64d6fe82152d90488a01f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*roOD0jThZaWMeUz_"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="de5c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就是这样。</p><p id="7657" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们运行多个模型，并在定义的S3桶中查看模型的工件。</p><pre class="mp mq mr ms gt ni nj nk nl aw nm bi"><span id="efb8" class="nn lm it nj b gy no np l nq nr">mlflow.sklearn.autolog()<br/><br/><br/>lr = LogisticRegression(solver='liblinear')<br/>lda= LinearDiscriminantAnalysis()<br/>svm = SVC(gamma='scale')<br/>knn = KNeighborsClassifier()<br/>ada = AdaBoostClassifier(random_state=0)<br/>gb = GradientBoostingClassifier(random_state=0)<br/>rf = RandomForestClassifier(random_state=0)<br/>et=  ExtraTreesClassifier(random_state=0)<br/>xgbc = XGBClassifier(random_state=0)<br/><br/><br/>models = [lr,lda,svm,knn,ada,gb,rf,et,xgbc]<br/><br/><br/>for model in models: <br/>    with mlflow.start_run(run_name=f'Run {model}') as run:<br/>        mlflow.set_tag("model", model)<br/>        mlflow.set_tag("data scientist", "kb")<br/>        X= df.drop('HeartDisease', axis=1)<br/>        y= df['HeartDisease']<br/>        X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)<br/>        ohe= OneHotEncoder()<br/>        ct= make_column_transformer((ohe,categorical),remainder='passthrough') <br/>        pipe = make_pipeline(ct, model)<br/>        pipe.fit(X_train, y_train)<br/>        y_pred = pipe.predict(X_test)<br/>        accuracy = round(accuracy_score(y_test, y_pred),4)<br/>        mlflow.log_metric("accuracy", accuracy)</span></pre><p id="680a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们转到AWS帐户，看看S3桶。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi nz"><img src="../Images/65d7bc0a7bc79dd5872c2de81955acce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2LhcHR0kF_s1sAE7"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="61a9" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们单击其中的一个并查看详细信息。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/067bbe45eb5070abf114878d73622392.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*6YYt4EREi4sG2xVw"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="7605" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们点击模型，看看里面有什么。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/fc586584e0000d219aa1c6b70d0a63d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*FMx1W8fO_hfqvu5Q"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">作者图片</figcaption></figure><p id="a197" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们已经成功地将AWS S3存储区定义为MLflow工件存储区。</p><h1 id="8f87" class="ll lm it bd ln lo mt lq lr ls mu lu lv lw mv ly lz ma mw mc md me mx mg mh mi bi translated">结论</h1><p id="caa9" class="pw-post-body-paragraph kg kh it ki b kj mj kl km kn mk kp kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">在本文中，我们已经介绍了如何使用Databricks在远程MLflow跟踪服务器上记录模型参数和工件。</p><p id="9e6a" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">除此之外，我们还将AWS S3存储区定义为MLflow跟踪服务器的工件存储区。</p><figure class="mp mq mr ms gt ju gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/37fd199196083114264ef2cf4eaf8d1e.png" data-original-src="https://miro.medium.com/v2/resize:fit:960/1*mRIoDEXtmxlWUHqyy1HNlQ.gif"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图片来源:<a class="ae kf" href="https://giphy.com/" rel="noopener ugc nofollow" target="_blank">https://giphy.com/</a></figcaption></figure><p id="aaba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文是<a class="ae kf" href="https://medium.com/@kaanboke/list/mlopsbest-practices-5a8ac9cad726" rel="noopener"> <strong class="ki iu"> MLOps最佳实践列表</strong> </a>的一部分。你可以在 这里找到<a class="ae kf" href="https://medium.com/@kaanboke/list/mlopsbest-practices-5a8ac9cad726" rel="noopener"> <strong class="ki iu">系列的其他文章。</strong></a></p><p id="d68c" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我希望它有所帮助。</p><p id="c4ba" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对了，喜欢题目的时候可以通过支持<strong class="ki iu">来展示👏</strong></p><p id="ea16" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">欢迎发表评论。</p><h1 id="5714" class="ll lm it bd ln lo mt lq lr ls mu lu lv lw mv ly lz ma mw mc md me mx mg mh mi bi translated">万事如意🤘</h1></div><div class="ab cl le lf hx lg" role="separator"><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj lk"/><span class="lh bw bk li lj"/></div><div class="im in io ip iq"><p id="b3fb" class="pw-post-body-paragraph kg kh it ki b kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你喜欢看我的内容，<a class="ae kf" href="https://medium.com/@kaanboke/membership" rel="noopener"> <em class="nb">请考虑关注我</em> </a>。还有，你可以通过<a class="ae kf" href="https://medium.com/@kaanboke/membership" rel="noopener"> <strong class="ki iu">订阅Medium </strong> </a>来支持我和其他作家。使用我的推荐链接不会额外花费你。</p></div></div>    
</body>
</html>