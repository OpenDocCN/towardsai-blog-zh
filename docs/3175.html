<html>
<head>
<title>Precision-Recall Curve</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">精确回忆曲线</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/precision-recall-curve-26f9e7984add?source=collection_archive---------0-----------------------#2022-10-03">https://pub.towardsai.net/precision-recall-curve-26f9e7984add?source=collection_archive---------0-----------------------#2022-10-03</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="5bdd" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">模型评估</h2><div class=""/><div class=""><h2 id="3835" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">PR曲线、AUC-PR和AP</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/012ace00a669e3dd537ffa854c0da48e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a2MsY8Hf7DiA-nCKsATNkQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">作者图片</figcaption></figure><p id="6f5b" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">对任何模型的评估都是至关重要的。说到<strong class="lg ja"> </strong>分类模型，无论是二进制还是多类，我们都有大量的指标可供使用。如果我们有一个平衡的数据集，你可能会选择准确性。如果真预测更重要，那么精度、召回率、特异性或F1将是选择。这里提到的所有指标都使用预测类进行评估，而不是预测分数。然而，一些指标使用预测分数，如精确召回曲线和ROC。</p><h2 id="56da" class="ma mb iq bd mc md me dn mf mg mh dp mi ln mj mk ml lr mm mn mo lv mp mq mr iw bi translated">精确度-召回曲线:</h2><p id="6795" class="pw-post-body-paragraph le lf iq lg b lh ms ka lj lk mt kd lm ln mu lp lq lr mv lt lu lv mw lx ly lz ij bi translated">精度-召回曲线显示了不同阈值的精度和召回之间的权衡。它常用于班级严重失衡的情况。例如，如果预测某个观测值属于阳性类的概率大于0.5，则该观测值被标记为阳性。然而，我们可以选择0到1之间的任何概率阈值。精度-召回曲线有助于可视化阈值如何影响分类器性能。</p><p id="0ba6" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">为了理解精确度和召回率，让我们通过参考混淆矩阵来快速刷新我们对二元分类问题中的可能结果的记忆。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi mx"><img src="../Images/532d44818e73378df69d4ac539030572.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Nmy2yezhrVm6wp8T5LjMaQ.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">困惑矩阵|作者图片</figcaption></figure><p id="9648" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg ja">精度</strong>是指某一特定类别的所有预测中正确预测的比例。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi my"><img src="../Images/afe98b4d0fa6096d1ba9cf3b8c330843.png" data-original-src="https://miro.medium.com/v2/resize:fit:464/format:webp/1*KKPyJ4SobJZmEP_aB1-Dog.jpeg"/></div></figure><p id="dcb3" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg ja">召回</strong>指的是已经被模型预测为属于特定类别的实例的比例。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi mz"><img src="../Images/d2c595e38a4b98daf2e5dea574549ce1.png" data-original-src="https://miro.medium.com/v2/resize:fit:466/format:webp/1*Ihsfoltdur1PW6Vg76EfnA.jpeg"/></div></figure><p id="b2b5" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">一个精度和召回率都很高的模型会返回很少的结果，但是大部分预测都是正确的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi na"><img src="../Images/29e7159b330f93eae0828698dba82985.png" data-original-src="https://miro.medium.com/v2/resize:fit:874/format:webp/1*dHeKnaFtqxnMqLfCdJz5bA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">PR曲线|作者图片</figcaption></figure><p id="f546" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">然而，低精度和高召回率的模型返回许多结果，但是大多数预测将是不正确的。理想的模型将具有高精度和高召回率，并且将返回许多正确预测的结果，而基线模型将具有非常低的精度。</p><pre class="kp kq kr ks gt nb nc nd ne aw nf bi"><span id="e94f" class="ma mb iq nc b gy ng nh l ni nj">from sklearn.datasets import make_classification<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.linear_model import LogisticRegression<br/>from sklearn.metrics import precision_recall_curve<br/>from sklearn.metrics import PrecisionRecallDisplay</span><span id="e479" class="ma mb iq nc b gy nk nh l ni nj">X, y = make_classification(n_samples=1000, n_classes=2,<br/>                           random_state=1)<br/>X_train, X_test, y_train, y_test = train_test_split(X, y,<br/>                                                    test_size=.2,<br/>                                                    random_state=2)<br/>lr = LogisticRegression()<br/>lr.fit(X_train, y_train)<br/>y_pred = lr.predict(X_test)<br/>y_pred_prob = lr.predict_proba(X_test)<br/>y_pred_prob = y_pred_prob[:,1]</span><span id="86e2" class="ma mb iq nc b gy nk nh l ni nj">precision, recall, threshold = precision_recall_curve(y_test, <br/>                                                      y_pred_prob)<br/>prd = PrecisionRecallDisplay(precision, recall)<br/>prd.plot()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/be99e6c2d2d70235bc5b63bb1fa61b6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:798/format:webp/1*9LB3RhceU9UFNu70j9y0aw.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">PR曲线|作者图片</figcaption></figure><p id="07d2" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg ja"> AP和AUC-PR </strong></p><p id="8a89" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">平均精度将PR曲线总结为一个指标，即每个阈值达到的精度的加权平均值。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/b29cbde23e35f54c77323e1d6da1f43d.png" data-original-src="https://miro.medium.com/v2/resize:fit:510/format:webp/1*w5h0PgO8SiL5kVVlQPP-oQ.png"/></div></figure><p id="800d" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">其中Pn和Rn是n^th阈值下的精度和召回率。</p><p id="dc18" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">AUC-PR代表曲线下面积-精确召回，它是图下的梯形面积。AP和AUC-PR是将PR曲线总结为单一指标的类似方法。</p><p id="77cd" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">高AP或AUC代表不同阈值的高精度和高召回率。AP/AUC值在1(理想模型)和0(最差模型)之间波动。</p><pre class="kp kq kr ks gt nb nc nd ne aw nf bi"><span id="7469" class="ma mb iq nc b gy ng nh l ni nj">from sklearn.metrics import average_precision_score<br/>average_precision_score(y_test, y_pred_prob)</span><span id="8b50" class="ma mb iq nc b gy nk nh l ni nj"><strong class="nc ja">Output:<br/></strong>0.927247516623891</span></pre><p id="86a3" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">我们可以把PR评分和图表结合起来。</p><pre class="kp kq kr ks gt nb nc nd ne aw nf bi"><span id="ba2f" class="ma mb iq nc b gy ng nh l ni nj">ap = average_precision_score(y_test, y_pred_prob)<br/>prd = PrecisionRecallDisplay(precision, recall, average_precision=ap)<br/>prd.plot()</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/fbc1fcb64b7b65e5a689666e6af82802.png" data-original-src="https://miro.medium.com/v2/resize:fit:768/format:webp/1*QrL-d23pt3oWmxav7wweZQ.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">PR曲线与AP |作者图片</figcaption></figure><p id="9e21" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">精确召回曲线通常使用两个类别进行评估，对于多类别或多标签分类，将为每个类别绘制直线曲线，每个类别的AP或AUC将有助于类别之间的排序。然而，要在一个指标中总结多个类别，可以计算微观、宏观和加权精度曲线和AP/AUC。请参考<a class="ae no" rel="noopener ugc nofollow" target="_blank" href="/multi-class-model-evaluation-with-confusion-matrix-and-classification-report-c92a74d5e908"> <strong class="lg ja">带混淆矩阵的多类模型评估和分类报告</strong> </a>了解微观、宏观和加权指标。</p><p id="8bee" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><em class="np">下面是为多类分类创建和绘制PR的python代码。</em></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="nq nr l"/></div></figure><pre class="kp kq kr ks gt nb nc nd ne aw nf bi"><span id="2a64" class="ma mb iq nc b gy ng nh l ni nj">from sklearn.datasets import make_classification<br/>from sklearn.preprocessing import label_binarize<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.linear_model import LogisticRegression<br/>from sklearn.multiclass import OneVsRestClassifier</span><span id="71b6" class="ma mb iq nc b gy nk nh l ni nj"># Load Dataset<br/>X, y = make_classification(n_samples=1000, n_classes=2,<br/>                           random_state=1)<br/>y = label_binarize(y, classes=[0,1,2])<br/>X_train, X_test, y_train, y_test = train_test_split(X, y,<br/>                                                    test_size=.2,<br/>                                                    random_state=2)<br/>lr = LogisticRegression()<br/>ovr = OneVsRestClassifier(lr)<br/>ovr.fit(X_train, y_train)<br/>y_pred = ovr.predict(X_test)<br/>y_pred_prob = ovr.predict_proba(X_test)</span><span id="5e4f" class="ma mb iq nc b gy nk nh l ni nj">precision, recall, threshold, ap, labels = pr_curve(y_test,<br/>                                                    y_pred_prob, <br/>                                                    labels=[0,1,2])<br/>pr_curve_plot(precision, recall, threshold, ap, labels)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/1c7f6bad5892ee44d64a5c2f8356f403.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*5IrJ8NJout8tAuptgZEmOg.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">多级PR曲线|作者图片</figcaption></figure><p id="64ab" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated"><strong class="lg ja">参考文献:</strong></p><p id="d42b" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">[1]精确度-召回曲线。<a class="ae no" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.precision_recall_curve.html#sklearn.metrics.precision_recall_curve" rel="noopener ugc nofollow" target="_blank">https://sci kit-learn . org/stable/modules/generated/sk learn . metrics . precision _ recall _ curve . html # sk learn . metrics . precision _ recall _ curve</a></p><p id="df77" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">[2]平均精度得分。<a class="ae no" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.average_precision_score.html#sklearn.metrics.average_precision_score" rel="noopener ugc nofollow" target="_blank">https://sci kit-learn . org/stable/modules/generated/sk learn . metrics . average _ precision _ score . html # sk learn . metrics . average _ precision _ score</a></p><p id="7a76" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">[3] AUC评分。<a class="ae no" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.auc.html#sklearn.metrics.auc" rel="noopener ugc nofollow" target="_blank">https://sci kit-learn . org/stable/modules/generated/sk learn . metrics . AUC . html # sk learn . metrics . AUC</a></p><p id="ccb3" class="pw-post-body-paragraph le lf iq lg b lh li ka lj lk ll kd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ij bi translated">[4]精确回忆显示。<a class="ae no" href="https://scikit-learn.org/stable/modules/generated/sklearn.metrics.PrecisionRecallDisplay.html?highlight=precisionrecalldisplay#sklearn.metrics.PrecisionRecallDisplay" rel="noopener ugc nofollow" target="_blank">https://sci kit-learn . org/stable/modules/generated/sk learn . metrics . precisionrecalldisplay . html？highlight = precisionrecalldisplay # sk learn . metrics . precisionrecalldisplay</a></p></div></div>    
</body>
</html>