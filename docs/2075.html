<html>
<head>
<title>Mask R-CNN Overlapping Bounding Boxes Problem</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">屏蔽R-CNN重叠包围盒问题</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/mask-r-cnn-overlapping-bounding-boxes-problem-a9582d41875b?source=collection_archive---------1-----------------------#2021-08-09">https://pub.towardsai.net/mask-r-cnn-overlapping-bounding-boxes-problem-a9582d41875b?source=collection_archive---------1-----------------------#2021-08-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div class="gh gi jq"><img src="../Images/ef08b33d8de5f263ba262866a8c6ddaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*v9GAIFnbUJuUwEva.jpg"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated"><a class="ae kb" href="https://www.researchgate.net/publication/324908056_Deep_Perm-Set_Net_Learn_to_Predict_Sets_with_Unknown_Permutation_and_Cardinality_Using_Deep_Neural_Networks" rel="noopener ugc nofollow" target="_blank">来源</a> [1]</figcaption></figure><p id="d6a2" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">Mask R-CNN是一种来自卷积神经网络的人工神经网络。它可以有效地检测图像中的对象，并为每个样本创建高质量的分割遮罩。</p><p id="694f" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">🔹更快的R-CNN通过在其网络中增加一个额外的分支来扩展现有的网络。</p><p id="f1c6" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">🔊你可以通过更快的R-CNN访问我在<a class="ae kb" rel="noopener ugc nofollow" target="_blank" href="/training-faster-r-cnn-using-tensorflow-object-detection-api-with-a-custom-dataset-88dd525666fd">之前发表的关于使用定制数据集的博文</a>。</p><p id="73b0" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">🔹与更快的R-CNN不同，屏蔽R-CNN是为网络输入和输出之间的逐像素对齐<strong class="ke iu"> (RoIAlign) </strong>而设计的。</p><p id="e669" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">🔔从零开始一步一步地创建一个掩模R-CNN项目；</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="le lf l"/></div></figure><p id="4c8e" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">🔔逐步在自定义数据集上创建掩膜R-CNN项目；</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="le lf l"/></div></figure><p id="484b" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">如果你已经有了一个Mask R-CNN项目，我想谈谈检测过程中可能出现的误差和阈值。正如我在题目中提到的，<strong class="ke iu"> <em class="lg">重叠的盒子</em> </strong>会造成区分物体的问题。如果只对一个类别和背景执行对象检测和分割，0.9的阈值最初应该足够了。让我们一起深入了解一些配置文件。</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="lh lf l"/></div></figure><p id="9ebb" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">上面的代码显示了如何创建一个示例配置类。变量<strong class="ke iu"><em class="lg">DETECTION _ MIN _ CONFIDENCE</em></strong>紧跟在<strong class="ke iu"><em class="lg">STEPS _ PER _ EPOCH</em></strong>变量之后，是我们的检测阈值变量。如代码中所述，如果图像中的对象以90%或更高的概率被检测到，则给出类名。虽然这种情况有时是好的，但有时会导致不良的准确性。为此，我们应该充分了解数据，选择一个合适的阈值。</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div class="gh gi li"><img src="../Images/4b26c5330201af3fc8e735409691a72e.png" data-original-src="https://miro.medium.com/v2/resize:fit:738/format:webp/1*PE2bFny0effx3OZuJurrgA.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated"><a class="ae kb" href="https://d2l.ai/chapter_computer-vision/anchor.html?highlight=threshold" rel="noopener ugc nofollow" target="_blank">来源</a>【3】</figcaption></figure><p id="90a2" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">让我们回顾一下我从《深入学习》的原始文档中获取的资料。例如，假设选择了90%的检测置信度阈值。因此，在该图像中，仅检测到蓝色框中的狗和紫色框中的猫。因为低于90%的阈值对象不幸将不会被检测到。</p><figure class="la lb lc ld gt ju gh gi paragraph-image"><div class="gh gi lj"><img src="../Images/1f48f3a614660933e9bcdd17fe00be11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1026/format:webp/1*WrbuH_8eQuwvBsI_DzjZqQ.png"/></div><figcaption class="jx jy gj gh gi jz ka bd b be z dk translated">用<strong class="bd lk">狗</strong>和<strong class="bd lk">猫</strong>标签[4]分割的物体</figcaption></figure><h2 id="31e1" class="ll lm it bd lk ln lo dn lp lq lr dp ls kn lt lu lv kr lw lx ly kv lz ma mb mc bi translated">屏蔽R-CNN重叠错误</h2><p id="3406" class="pw-post-body-paragraph kc kd it ke b kf md kh ki kj me kl km kn mf kp kq kr mg kt ku kv mh kx ky kz im bi translated">如果您在Mask R-CNN项目中使用多个类，您很可能会得到与这些阈值相关的错误。我在下面添加了我之前在模特训练中得到的尺寸误差，供您查看。</p><p id="7224" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">1️⃣ <strong class="ke iu">错误1: </strong></p><blockquote class="mi mj mk"><p id="63ca" class="kc kd lg ke b kf kg kh ki kj kk kl km ml ko kp kq mm ks kt ku mn kw kx ky kz im bi translated"><strong class="ke iu"> IndexError </strong>:布尔索引与维度0上的索引数组不匹配；</p></blockquote><p id="d7af" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">根据我对Stackoverlow的研究，我发现了这样一个解决方法:</p><p id="fa5b" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">👁‍🗨While不是核心问题的修复，您仍然可以通过将_idx重新分配给正确长度的传入类id并将它们转换为numpy布尔类型来运行和训练代码。</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="lh lf l"/></div></figure><p id="6736" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">2️⃣ <strong class="ke iu">错误2: </strong></p><p id="83b7" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">另一个错误是<em class="lg"> AssertionError </em>。在某些情况下，我们会面临由<strong class="ke iu"> visualize </strong>函数引起的错误。误差的最大来源；<br/><strong class="ke iu">* *没有实例可显示*** </strong></p><p id="1ec6" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">🧵解决这种情况的方法很简单。您可以通过增加图形大小来可视化遮罩，如下所示。</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="lh lf l"/></div></figure><p id="d214" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">3️⃣ <strong class="ke iu">错误3: </strong></p><p id="5754" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">如果你的问题仍然没有解决，我可以推荐以下3个解决方案。</p><p id="8767" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">在第一步中，应该降低☑️检测阈值。</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="lh lf l"/></div></figure><p id="9e1b" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">☑️使用的Scipy库版本应该降级。</p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="lh lf l"/></div></figure><p id="9358" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">☑️️另外，mrcnn文件夹中utils.py文件的<a class="ae kb" href="https://github.com/matterport/Mask_RCNN/blob/3deaec5d902d16e1daf56b62d5971d428dc920bc/mrcnn/utils.py#L866" rel="noopener ugc nofollow" target="_blank">第866行应该修改。您在代码的第一行看到的shift变量应该替换为下面的行。</a></p><figure class="la lb lc ld gt ju"><div class="bz fp l di"><div class="lh lf l"/></div></figure><p id="571f" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">📣这样，所有的问题都解决了。祝你健康美好的日子。</p><p id="65fe" class="pw-post-body-paragraph kc kd it ke b kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz im bi translated">🎉更多内容可以关注我的<a class="ae kb" href="https://github.com/BuseYaren" rel="noopener ugc nofollow" target="_blank"> GitHub </a>、<a class="ae kb" href="https://www.youtube.com/channel/UCzAODG3wgdKtRov8VvyXvtw" rel="noopener ugc nofollow" target="_blank"> YouTube </a>和<a class="ae kb" href="https://twitter.com/BuseYarenTekin" rel="noopener ugc nofollow" target="_blank"> Twitter </a>。</p><h2 id="f7ae" class="ll lm it bd lk ln lo dn lp lq lr dp ls kn lt lu lv kr lw lx ly kv lz ma mb mc bi translated">参考</h2><ol class=""><li id="8627" class="mo mp it ke b kf md kj me kn mq kr mr kv ms kz mt mu mv mw bi translated">深度Perm-Set网络:学习使用深度神经网络预测未知排列和基数的集合。</li><li id="b8e9" class="mo mp it ke b kf mx kj my kn mz kr na kv nb kz mt mu mv mw bi translated">He，k .，Gkioxari，g .，Dollár，p .，&amp; Girshick，R. (2017年)。屏蔽r-cnn。IEEE计算机视觉国际会议论文集(第2961-2969页)。</li><li id="349c" class="mo mp it ke b kf mx kj my kn mz kr na kv nb kz mt mu mv mw bi translated"><a class="ae kb" href="https://d2l.ai/chapter_computer-vision/anchor.html?highlight=threshold" rel="noopener ugc nofollow" target="_blank">潜入深度学习，锚盒，https://d2l.ai/chapter_computer-vision/anchor.html?高亮=阈值</a>。</li><li id="3134" class="mo mp it ke b kf mx kj my kn mz kr na kv nb kz mt mu mv mw bi translated">深入学习，语义分割，<a class="ae kb" href="https://d2l.ai/chapter_computer-vision/semantic-segmentation-and-dataset.html" rel="noopener ugc nofollow" target="_blank">https://d2l . ai/chapter _ computer-vision/Semantic-Segmentation-and-dataset . html</a></li></ol></div></div>    
</body>
</html>