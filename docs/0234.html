<html>
<head>
<title>Outlier Detection (Part 1): Univariate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">异常值检测(第1部分):单变量</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/outlier-detection-part-1-univariate-f40621b0bc?source=collection_archive---------0-----------------------#2019-12-09">https://pub.towardsai.net/outlier-detection-part-1-univariate-f40621b0bc?source=collection_archive---------0-----------------------#2019-12-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/941fb420259dfc6fcaf6e54a28865a87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*xAGz8Spb1od3LS0-bVQdKQ.png"/></div></figure><h2 id="a8af" class="iv iw ix bd b dl iy iz ja jb jc jd dk je translated" aria-label="kicker paragraph">更好地分析—做出更明智的决策</h2><div class=""/><div class=""><h2 id="4772" class="pw-subtitle-paragraph kd jg ix bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">稳健统计:R中的例子</h2></div><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi kv"><img src="../Images/c178f35cc6cbe4a840e17ccbc7afe7d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wTmoXrG73fbwh5HnOaxN6g.jpeg"/></div></div></figure><h1 id="5583" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated">表明观点</h1><p id="5054" class="pw-post-body-paragraph lw lx ix ly b lz ma kh mb mc md kk me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">一个<strong class="ly jh">流行的离群点检测工具</strong>是</p><ol class=""><li id="1568" class="ms mt ix ly b lz mu mc mv mf mw mj mx mn my mr mz na nb nc bi translated">计算每次观察的z得分。</li><li id="7f3e" class="ms mt ix ly b lz nd mc ne mf nf mj ng mn nh mr mz na nb nc bi translated">如果z得分的绝对值大于3，则将观察标记为异常值</li></ol><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/0b3d46c73d87727b84d1f2af5f90e388.png" data-original-src="https://miro.medium.com/v2/resize:fit:538/format:webp/1*msVMiqez_VB0kg9iZ1f12g.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">z分数计算</figcaption></figure><p id="d349" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated"><strong class="ly jh">例如:</strong>让我们看一个名为log_inc的对数转换数据集，它是10个人的月收入。如果你仔细观察，最后的观察结果显然是一个异常值。</p><pre class="kw kx ky kz gt nq nr ns nt aw nu bi"><span id="be56" class="nv lf ix nr b gy nw nx l ny nz">7.876638 7.681560 7.628518 … 7.764296 9.912943</span></pre><p id="00fc" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated"><strong class="ly jh"> <em class="oa">计算每次观察的z值:</em> </strong></p><pre class="kw kx ky kz gt nq nr ns nt aw nu bi"><span id="9660" class="nv lf ix nr b gy nw nx l ny nz"><br/>Mean &lt;- mean(log_inc)<br/>Sd &lt;- sd(log_inc)<br/>z_score &lt;- abs((log_inc — Mean)/Sd) <br/></span></pre><p id="c2e1" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated"><strong class="ly jh"> <em class="oa">检查z分数的绝对值是否大于3:</em></strong></p><pre class="kw kx ky kz gt nq nr ns nt aw nu bi"><span id="b99f" class="nv lf ix nr b gy nw nx l ny nz">abs(z_score) &gt; 3<br/> [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE </span></pre><blockquote class="ob oc od"><p id="1427" class="lw lx oa ly b lz mu kh mb mc mv kk me oe nn mh mi of no ml mm og np mp mq mr ij bi translated"><strong class="ly jh"> <em class="ix">未发现异常值。</em>T15】</strong></p></blockquote><p id="519f" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated">使用同一个数据集，我们将展示使用<strong class="ly jh"> <em class="oa">稳健统计</em> </strong>将最后一个变量检测为异常值</p><h1 id="d120" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated">稳健统计</h1><p id="b4f9" class="pw-post-body-paragraph lw lx ix ly b lz ma kh mb mc md kk me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">经典的统计方法依赖于(正态)假设，但即使是一个孤立点也会对结论产生重大影响，并可能导致误导性结果。</p><p id="c0f7" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated">当数据包含异常值时，稳健统计也会产生可靠的结果，并产生自动异常值检测工具。</p><blockquote class="ob oc od"><p id="2bd7" class="lw lx oa ly b lz mu kh mb mc mv kk me oe nn mh mi of no ml mm og np mp mq mr ij bi translated">常规地使用经典方法和稳健方法是完美的，只有当它们的差异大到有影响时才担心……但是当它们有差异时，你应该认真思考— <strong class="ly jh"> J.W .图基(1979) </strong></p></blockquote><h2 id="6046" class="nv lf ix bd lg oh oi dn lk oj ok dp lo mf ol om lq mj on oo ls mn op oq lu jd bi translated">X <em class="or"> n </em>位置的估计值:</h2><p id="0926" class="pw-post-body-paragraph lw lx ix ly b lz ma kh mb mc md kk me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated"><strong class="ly jh"> <em class="oa">样的意思是</em> </strong></p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi os"><img src="../Images/884eb4ee1d2b9a339f6d986d391ea439.png" data-original-src="https://miro.medium.com/v2/resize:fit:308/format:webp/1*5vB6exWjcIFt2HXToPqVlA.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">采样平均</figcaption></figure><p id="2264" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated"><strong class="ly jh"> <em class="oa">中间值</em> </strong></p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi ot"><img src="../Images/72036b834e8b29fcd81b216b7e7f8814.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*G13uFtEqhAQt5NLlZu5xhQ.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">中位数</figcaption></figure><p id="58d0" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated"><strong class="ly jh">规模的估计量:</strong></p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi ou"><img src="../Images/69f82abc0629eceb9464df84b1b8029f.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*pVRoSW8-sxC6-N9v0tZIYQ.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">样品标准偏差</figcaption></figure><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi ov"><img src="../Images/29a8e5f285fe1c7fb0faa5f377267197.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*KJY93RyRIl3qwS_s2UBzBw.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">中位数绝对偏差</figcaption></figure><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/52784cf82825baa8880b4c1ccd2f3d3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*CVbcP8y4q0fbxbbq68cNTQ.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">四分位数范围(标准化)，其中Q1和Q3是数据的第一个和第三个四分位数</figcaption></figure><p id="655b" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated"><strong class="ly jh">异常值检测的稳健z值</strong></p><p id="c6ff" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated">我们插入稳健估计量来计算<strong class="ly jh">稳健z值</strong>:</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi ox"><img src="../Images/cb223a6222aaf7c48befb8f4ae729283.png" data-original-src="https://miro.medium.com/v2/resize:fit:630/format:webp/1*qKE1l5UQrV6H3atecHVbVA.png"/></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">计算稳健z得分的稳健估计量</figcaption></figure><p id="8281" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated"><strong class="ly jh"> <em class="oa">演示</em> </strong></p><p id="3570" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated">让我们使用开始时作为示例看到的相同数据集。</p><pre class="kw kx ky kz gt nq nr ns nt aw nu bi"><span id="6785" class="nv lf ix nr b gy nw nx l ny nz">data &lt;- c(7.876638, 7.681560, 7.628518,7.234543,7.465769,<br/>          7.135876, 7.895643, 7.793432, 7.764296, 9.912943)</span><span id="4649" class="nv lf ix nr b gy oy nx l ny nz">Mean &lt;- mean(data); Sd &lt;- sd(data); Med &lt;- median(data); Mad &lt;- mad(data)</span></pre><p id="b9e7" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated"><em class="oa"> Z分数输出</em></p><pre class="kw kx ky kz gt nq nr ns nt aw nu bi"><span id="080f" class="nv lf ix nr b gy nw nx l ny nz">&gt; abs(z_score) &gt; 3<br/>[1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE</span></pre><p id="b639" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated"><em class="oa">稳定的Z分数输出</em></p><pre class="kw kx ky kz gt nq nr ns nt aw nu bi"><span id="4374" class="nv lf ix nr b gy nw nx l ny nz">&gt; abs(rob_z_score) &gt; 3<br/> [1] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE<br/>&gt; which(abs(rob_z_score) &gt; 3)<br/>[1] 10</span></pre><h1 id="6c14" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated">箱线图</h1><p id="9752" class="pw-post-body-paragraph lw lx ix ly b lz ma kh mb mc md kk me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">用来识别异常值的一个流行工具是Tukey的箱线图。如果观察值在箱线图围栏之外，则标记为异常值。</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi oz"><img src="../Images/a8af04c7a6556ba915ad918cab213e44.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZRlXq8g6PAfuq2K2Y4MdPA.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">图基箱线图</figcaption></figure><p id="34a4" class="pw-post-body-paragraph lw lx ix ly b lz mu kh mb mc mv kk me mf nn mh mi mj no ml mm mn np mp mq mr ij bi translated">让我们用一个例子数据0.02%的“<a class="ae pa" href="https://www.kaggle.com/jonasalmeida/2015-deidentified-ny-inpatient-discharge-sparcs" rel="noopener ugc nofollow" target="_blank"> (LOS)住院时间</a>”数据和plot boxplot来理解。</p><pre class="kw kx ky kz gt nq nr ns nt aw nu bi"><span id="51d1" class="nv lf ix nr b gy nw nx l ny nz">library(ggplot2)</span><span id="a430" class="nv lf ix nr b gy oy nx l ny nz">ggplot(data.frame(los), aes(x = "", y = los)) + geom_boxplot(outlier.colour = "red", outlier.shape = 16, outlier.size = 3,fill = "lightblue", width = 0.5) + xlab("") + ylab("Length Of Stay (LOS)") + theme(text = element_text(size = 25))</span></pre><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi pb"><img src="../Images/d4e6d9cbb2f5574b3f457801c5f0fa66.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZTI0cv0hvHDiO1Prgc3CPQ.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">有异常值的箱线图</figcaption></figure><h2 id="b99c" class="nv lf ix bd lg oh oi dn lk oj ok dp lo mf ol om lq mj on oo ls mn op oq lu jd bi translated">调整后的箱线图(休伯特和范德维伦，2008年)</h2><ol class=""><li id="c809" class="ms mt ix ly b lz ma mc md mf pc mj pd mn pe mr mz na nb nc bi translated">在<strong class="ly jh">不对称分布中，</strong>箱线图可能会将许多<strong class="ly jh">规则点标记为异常值</strong>。</li><li id="a989" class="ms mt ix ly b lz nd mc ne mf nf mj ng mn nh mr mz na nb nc bi translated">偏斜度调整箱线图通过在确定围栏时使用稳健的偏斜度度量来校正这一点。</li></ol><pre class="kw kx ky kz gt nq nr ns nt aw nu bi"><span id="70ba" class="nv lf ix nr b gy nw nx l ny nz">library(robustbase)</span><span id="d700" class="nv lf ix nr b gy oy nx l ny nz">adjbox_stats &lt;- adjboxStats(los)$stats</span><span id="f71d" class="nv lf ix nr b gy oy nx l ny nz">ggplot(data.frame(los), aes(x = "", y = los)) + stat_boxplot(geom = "errorbar", width = 0.2, coef = 1.5*exp(3*mc(los))) + geom_boxplot(ymin = adjbox_stats[1],ymax = adjbox_stats[5],middle = adjbox_stats[3],upper = adjbox_stats[4],lower = adjbox_stats[2],outlier.shape = NA,fill = "lightblue",width = 0.5) +<br/>geom_point(data=subset(data.frame(los),los &lt; adjbox_stats[1] | los &gt; adjbox_stats[5]),col = "red", size = 3, shape = 16) +xlab("") + ylab("Length Of Stay (LOS)") +theme(text = element_text(size = 25))</span></pre><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi pf"><img src="../Images/4e77b1fe060c3f810c81b59e5f8e8ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1g53xQTO-TtbheOLgQlhug.png"/></div></div><figcaption class="nj nk gj gh gi nl nm bd b be z dk translated">偏斜度调整的箱线图中栅栏线的比较</figcaption></figure><h1 id="f84e" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated">总结:</h1><p id="b599" class="pw-post-body-paragraph lw lx ix ly b lz ma kh mb mc md kk me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">与仅使用经典方法相比，稳健统计的使用增强了我们的异常值检测能力。</p></div></div>    
</body>
</html>