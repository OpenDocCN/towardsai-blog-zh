<html>
<head>
<title>How To Predict Multiple Variables With One Model? And Why!</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何用一个模型预测多个变量？还有为什么！</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-to-predict-multiple-variables-with-one-model-and-why-31e6a8efc09e?source=collection_archive---------6-----------------------#2022-10-24">https://pub.towardsai.net/how-to-predict-multiple-variables-with-one-model-and-why-31e6a8efc09e?source=collection_archive---------6-----------------------#2022-10-24</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0413" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">你想节省时间和成本吗？就像创建一个能够通过相同的训练和相同的预测过程预测多个变量的模型一样简单。</h2></div></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><p id="1ba7" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在文章中，我将展示一些代码，但如果你想查看完整的代码，可以在<a class="ae li" href="https://www.kaggle.com/code/peremartramanonellas/guide-multiple-outputs-with-keras-functional-api" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>和<a class="ae li" href="https://github.com/oopere/TensorFlow_Advanced/blob/main/guide-multiple-outputs-with-keras-functional-api.ipynb" rel="noopener ugc nofollow" target="_blank"> GitHub </a>上找到。在那里您可以派生、修改和执行它。</p><div class="lj lk gp gr ll lm"><a href="https://www.kaggle.com/code/peremartramanonellas/guide-multiple-outputs-with-keras-functional-api" rel="noopener  ugc nofollow" target="_blank"><div class="ln ab fo"><div class="lo ab lp cl cj lq"><h2 class="bd ir gy z fp lr fr fs ls fu fw ip bi translated">指南:使用Keras Functional API的多输出</h2><div class="lt l"><h3 class="bd b gy z fp lr fr fs ls fu fw dk translated">使用Kaggle笔记本探索和运行机器学习代码|使用葡萄酒质量数据</h3></div><div class="lu l"><p class="bd b dl z fp lr fr fs ls fu fw dk translated">www.kaggle.com</p></div></div><div class="lv l"><div class="lw l lx ly lz lv ma mb lm"/></div></div></a></div></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/6df60b372f49cab17d53fe9a9c0973b5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n3IB5EW--404lf3ZZlo2sg.jpeg"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">图片由<a class="ae li" href="https://unsplash.com/ja/@nate_dumlao?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">内森·杜姆劳</a>在<a class="ae li" href="https://unsplash.com/es/s/fotos/two-ways?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><p id="3d7e" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">当我们开始使用TensorFlow时，我们通常使用顺序格式通过Keras库创建模型。</p><p id="1af2" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">有了序列模型，我们可以解决深度学习各个领域的很多问题。无论是图像识别或分类、自然语言处理，还是序列预测……它们都是强大到足以用于大多数问题的模型。</p><p id="36b6" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated"><strong class="ko ir">但是有时我们需要在TensorFlow中使用Keras。因此，我们可以使用API来创建模型</strong>，这为我们打开了一个广阔的世界，提供了更多使用顺序模型时所没有的可能性。</p><p id="cc82" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在本文中，<strong class="ko ir">我们将看到一个模型的创建，它能够使用相同的数据和相同的学习过程预测两个不同的变量</strong>，共享大部分层。</p><p id="4187" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">也就是说，我们将创建一个具有两层分支的多输出模型。正如我们在图像中看到的:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mr"><img src="../Images/5f3e04c2dfbf29466f62b756d1e6cb9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*mHhNHRi8JT8ULbJr.png"/></div></div></figure><p id="6bab" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">该模型由一个输入层和两个密集层组成。这三层是模型的公共部分。从这里开始，模型分为两个不同的分支。在其中一个分支中，我们找到了分类变量的输出层。另一个分支由密集图层和预测回归变量的输出图层组成。</p><p id="de81" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">请注意，在右分支中，模型预测分类变量，而在左分支中，要预测的变量是回归变量。</p><p id="6e89" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在本文中，我们将只看到如何生成和执行模型。模型的数据处理和后续评估，以及如何改进的思路，可以在<a class="ae li" href="https://www.kaggle.com/code/peremartramanonellas/guide-multiple-outputs-with-keras-functional-api" rel="noopener ugc nofollow" target="_blank"> Kaggle笔记本</a>中找到。</p><h1 id="7190" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">简要介绍数据和解决的问题。</h1><p id="babc" class="pw-post-body-paragraph km kn iq ko b kp nk jr kr ks nl ju ku kv nm kx ky kz nn lb lc ld no lf lg lh ij bi translated">我使用了一个包含葡萄酒信息的Kaggle数据集。它们是表格格式的数据，有11列可以被认为是特性，两列是我们的标签。</p><p id="0b44" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">作为第一个标签，我选择了葡萄酒的质量(quality)，从0到9。我决定把它当作一个回归变量，而不是一个分类变量。既然是显示酒变好的变量。</p><p id="d49e" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">第二个标签是葡萄酒的种类(type)，表示葡萄酒是白葡萄酒还是红葡萄酒。这显然是一个分类变量。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi np"><img src="../Images/636d8045d9ec0a5d1388bb105825dc3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gxihc1_qgutnF0iWcve-oQ.png"/></div></div><figcaption class="mn mo gj gh gi mp mq bd b be z dk translated">作者图片</figcaption></figure><p id="a002" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">所以，我们在一个模型中有两个不同类型的变量要预测。</p><p id="2e89" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">看到数据集后，我们开始构建模型。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="nq nr l"/></div></figure><p id="e60b" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">正如您所看到的，创建这种类型的模型一点也不复杂，如果我们将它与顺序模型进行比较，它会打开一个新的可能性的世界。</p><p id="aa25" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">你在代码的注释中有所有的信息，但是我想指出一些事情。</p><p id="51d2" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">我通常使用相同的名称作为层的内部名称和包含层的变量的名称。不仅是为了让代码更清晰，而且当我们指出损失函数和度量时，必须指出层的内部名称。当报告模型的输出时，我们必须指出包含层的变量的名称。对我来说总是用同一个名字更容易。</p><p id="3fee" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">不同的损失函数和度量可以用于每个输出变量。</p><p id="1b65" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">我们必须在两个列表中指出它们。一个用于损失函数，另一个用于度量，在这里我们将它们与层的名称相关联。</p><pre class="md me mf mg gt ns nt nu nv aw nw bi"><span id="34d0" class="nx mt iq nt b gy ny nz l oa ob">model.compile(optimizer=optimizer, <br/>              loss = {'y_t_layer' : 'binary_crossentropy', <br/>                      'y_q_layer' : 'mse'<br/>                     },<br/>              metrics = {'y_t_layer' : 'accuracy', <br/>                         'y_q_layer': tf.keras.metrics.RootMeanSquaredError()<br/>                       }<br/>             )</span></pre><h1 id="33c8" class="ms mt iq bd mu mv mw mx my mz na nb nc jw nd jx ne jz nf ka ng kc nh kd ni nj bi translated">多输出模型有什么用？</h1><p id="4c07" class="pw-post-body-paragraph km kn iq ko b kp nk jr kr ks nl ju ku kv nm kx ky kz nn lb lc ld no lf lg lh ij bi translated">我不会假装给出一个完整的答案，因为这只是我的看法，更有经验的数据科学家可以找到它们的更多用途。</p><p id="97b5" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在必须使用大量数据进行定期训练以预测多个变量的环境中，这种类型的模型非常有用。如果我们将其与培训两个或三个不同的模型进行比较，节省的时间可能非常显著，不仅在时间上，而且在成本上。</p><p id="f600" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">也广泛用于计算机视觉，特别是物体识别。一个输出是所识别的对象的类型，而另一个输出是对象在图像中的位置。</p><p id="7aa9" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">在需要重复执行大量预测且预测结果不止一个变量的环境中，它们可以节省大量时间和流程。</p><p id="e2a3" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">另一方面，它们的调整成本更高，因为，例如，更难找到对所有变量都最优的学习率。</p></div><div class="ab cl kf kg hu kh" role="separator"><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk kl"/><span class="ki bw bk kj kk"/></div><div class="ij ik il im in"><p id="ac1f" class="pw-post-body-paragraph km kn iq ko b kp kq jr kr ks kt ju ku kv kw kx ky kz la lb lc ld le lf lg lh ij bi translated">本文是关于TensorFlow和Keras中的高级主题的系列文章的一部分，<strong class="ko ir">如果您喜欢，可以考虑关注我的</strong> <a class="ae li" href="https://medium.com/@peremartra" rel="noopener"> <strong class="ko ir">中的</strong> </a>以获取关于新文章的更新。当然，也欢迎你在 <a class="ae li" href="https://www.linkedin.com/in/pere-martra-0310631" rel="noopener ugc nofollow" target="_blank"> <strong class="ko ir"> LinkedIn </strong> </a>上<strong class="ko ir">与我连线。</strong></p><div class="lj lk gp gr ll"><div role="button" tabindex="0" class="ab bv gv cb fp oc od bn oe mb ex"><div class="of l"><div class="ab q"><div class="l di"><img alt="Pere Martra" class="l de bw og oh fe" src="../Images/92b0a2efbdea5f262a3b203de380857b.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*15GCvLcX8MrvabnQEAHteA.jpeg"/><div class="fb bw l og oh fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://medium.com/@peremartra?source=post_page-----31e6a8efc09e--------------------------------" rel="noopener follow" target="_top">佩雷·马特拉</a></p></div></div><div class="ok ol gw l"><h2 class="bd ir ts tt fp tu fr fs ls fu fw ip bi translated">张量流超越基础</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi tv au tw tx ty qf tz an eh ei ua ub uc el em eo de bk ep" href="https://medium.com/@peremartra/list/tensorflow-beyond-the-basics-24c4c6a844d8?source=post_page-----31e6a8efc09e--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="ud l fo"><span class="bd b dl z dk">3 stories</span></div></div></div><div class="ox dh oy fp ab oz fo di"><div class="di op bv oq or"><div class="dh l"><img alt="" class="dh" src="../Images/a6cc8494220dde3f66b935ddf24ef15d.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*2d72L83uHnZvYPd8"/></div></div><div class="di op bv os ot ou"><div class="dh l"><img alt="" class="dh" src="../Images/a0ef9ec52ab60f8a8c436e6dcafd270b.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*n3IB5EW--404lf3ZZlo2sg.jpeg"/></div></div><div class="di bv ov ow ou"><div class="dh l"><img alt="" class="dh" src="../Images/641c560d79ca678019b7ddabb33854e2.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/1*fsP7FbIqO2MEl4SsaP374g.jpeg"/></div></div></div></div></div></div></div>    
</body>
</html>