<html>
<head>
<title>Secrets — Python module for strong random number and token generation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">秘密——用于生成强随机数和令牌的Python模块</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/secrets-python-module-for-strong-random-number-and-token-generation-39af0392352b?source=collection_archive---------3-----------------------#2021-11-22">https://pub.towardsai.net/secrets-python-module-for-strong-random-number-and-token-generation-39af0392352b?source=collection_archive---------3-----------------------#2021-11-22</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="5060" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="891a" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">生成加密的强密码和令牌</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/c9d16bbe46a7200c4011c6223f1abe03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9yLrTe99TGDWbz01JbuoJA.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">作者图片</figcaption></figure></div><div class="ab cl li lj hy lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="in io ip iq ir"><h1 id="950c" class="lp lq iu bd lr ls lt lu lv lw lx ly lz kj ma kk mb km mc kn md kp me kq mf mg bi translated">介绍</h1><p id="ca59" class="pw-post-body-paragraph mh mi iu mj b mk ml ke mm mn mo kh mp mq mr ms mt mu mv mw mx my mz na nb nc in bi translated">你知道Python有一个名为<strong class="mj je"> secrets </strong>的内置模块，可以用来生成加密的强密码、令牌和其他相关的秘密吗？<strong class="mj je"> secrets </strong>模块最早是在<strong class="mj je"> Python 3.6 </strong> (PEP 506)中引入的。</p><p id="aa56" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated">在Python中引入<strong class="mj je"> secrets </strong>模块之前，大多数开发人员使用<strong class="mj je"> random </strong>模块来生成密码、令牌等。但是<strong class="mj je"> random </strong>模块生成的随机数是伪随机数，不具备密码安全性。因此，Python 3.6以后引入了<strong class="mj je">秘密</strong>模块。</p><p id="b42a" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated">你会在<a class="ae ni" href="https://docs.python.org/3/library/random.html" rel="noopener ugc nofollow" target="_blank"> <strong class="mj je">随机</strong> </a> <strong class="mj je"> </strong>模块<strong class="mj je"> </strong>官方文档页面看到下面的警告—“<em class="nj">本模块的伪随机发生器不应该用于安全目的。对于安全或加密用途，请参见</em> <code class="fe nk nl nm nn b"><a class="ae ni" href="https://docs.python.org/3/library/secrets.html#module-secrets" rel="noopener ugc nofollow" target="_blank"><em class="nj">secrets</em></a></code> <em class="nj">模块。”</em></p><h1 id="10a5" class="lp lq iu bd lr ls no lu lv lw np ly lz kj nq kk mb km nr kn md kp ns kq mf mg bi translated">秘密</h1><p id="f410" class="pw-post-body-paragraph mh mi iu mj b mk ml ke mm mn mo kh mp mq mr ms mt mu mv mw mx my mz na nb nc in bi translated">秘密模块的功能可以分为两个部分——生成随机数的<strong class="mj je">和生成令牌的<strong class="mj je">和</strong>。</strong></p><h2 id="c373" class="nt lq iu bd lr nu nv dn lv nw nx dp lz mq ny nz mb mu oa ob md my oc od mf ja bi translated"><strong class="ak">生成随机数</strong></h2><p id="d7b0" class="pw-post-body-paragraph mh mi iu mj b mk ml ke mm mn mo kh mp mq mr ms mt mu mv mw mx my mz na nb nc in bi translated"><strong class="mj je">secrets . choice(<em class="nj">sequence</em>)—</strong>从非空序列中返回随机元素。以下两个示例返回A-Za-z范围内的随机字符和0-10范围内的随机数。</p><pre class="kt ku kv kw gu oe nn of og aw oh bi"><span id="97a4" class="nt lq iu nn b gz oi oj l ok ol">&gt;&gt;&gt; secrets.choice(seq=string.ascii_letters)<br/>'B'</span><span id="edab" class="nt lq iu nn b gz om oj l ok ol">&gt;&gt;&gt; secrets.choice(seq=range(10))<br/>2</span></pre><p id="661d" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated"><strong class="mj je">rand below(<em class="nj">n</em>)—</strong>返回0-n(不包括n)范围内的随机整数。下面的示例返回一个0-10范围内的随机整数。</p><pre class="kt ku kv kw gu oe nn of og aw oh bi"><span id="3110" class="nt lq iu nn b gz oi oj l ok ol">&gt;&gt;&gt; secrets.randbelow(exclusive_upper_bound=10)<br/>5</span></pre><p id="60bf" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated"><strong class="mj je"> randbits( <em class="nj"> k </em> ) — </strong>返回一个k位随机整数。以下示例返回一个由8位组成的随机整数。</p><ul class=""><li id="9f07" class="on oo iu mj b mk nd mn ne mq op mu oq my or nc os ot ou ov bi translated">如果k=4，那么随机整数将从0到15。</li><li id="f1e5" class="on oo iu mj b mk ow mn ox mq oy mu oz my pa nc os ot ou ov bi translated">如果k=8，那么随机整数将从0到255。</li><li id="a4e6" class="on oo iu mj b mk ow mn ox mq oy mu oz my pa nc os ot ou ov bi translated">如果k=16，那么随机整数将从0到65，535，依此类推。</li></ul><pre class="kt ku kv kw gu oe nn of og aw oh bi"><span id="81af" class="nt lq iu nn b gz oi oj l ok ol">&gt;&gt;&gt; secrets.randbits(k=8)<br/>46</span></pre><p id="4d05" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated"><strong class="mj je"> SystemRandom() — </strong>每个操作系统都有一个生成安全且强随机数的来源。<strong class="mj je"> SystemRandom </strong>是在<strong class="mj je"> random </strong>模块中可用的一个类，该模块反过来使用<strong class="mj je"> os.urandom() </strong>函数来生成安全随机数。</p><p id="fea9" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated">在引入<strong class="mj je"> secrets </strong>模块之前，<strong class="mj je"> SystemRandom </strong>类用于生成安全且加密性强的随机数/令牌。事实上，您可以使用SystemRandom对象访问所有随机模块函数/方法。</p><p id="27c1" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated">从下面的代码中可以看出，您可以使用<strong class="mj je"> SystemRandom </strong>类来访问随机模块函数。您可以尝试随机模块中可用的其他函数/方法。</p><pre class="kt ku kv kw gu oe nn of og aw oh bi"><span id="dbfe" class="nt lq iu nn b gz oi oj l ok ol">&gt;&gt;&gt; import secrets<br/>&gt;&gt;&gt; sys_random = secrets.SystemRandom()</span><span id="42ca" class="nt lq iu nn b gz om oj l ok ol">&gt;&gt;&gt; sys_random.choice(seq=range(10))<br/>6</span><span id="0eb5" class="nt lq iu nn b gz om oj l ok ol">&gt;&gt;&gt; sys_random.getrandbits(k=8)<br/>88</span><span id="ced3" class="nt lq iu nn b gz om oj l ok ol">&gt;&gt;&gt; sys_random.randrange(1, 100)<br/>45</span><span id="dcde" class="nt lq iu nn b gz om oj l ok ol">&gt;&gt;&gt; sys_random.sample(range(100), 5)<br/>[85, 73, 31, 88, 48]</span></pre><h2 id="477d" class="nt lq iu bd lr nu nv dn lv nw nx dp lz mq ny nz mb mu oa ob md my oc od mf ja bi translated"><strong class="ak">生成令牌</strong></h2><p id="5d07" class="pw-post-body-paragraph mh mi iu mj b mk ml ke mm mn mo kh mp mq mr ms mt mu mv mw mx my mz na nb nc in bi translated"><strong class="mj je"> secrets </strong>模块还提供了可用于密码重置、难以猜测的URL等应用的功能。如下所述。</p><p id="9950" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated"><strong class="mj je"> token_bytes — </strong>返回安全随机字节字符串，其字节在<strong class="mj je"> nbytes </strong>参数中指定。如果<strong class="mj je"> <em class="nj"> nbytes </em> </strong>为<em class="nj"> None </em>或未提供，则使用合理的默认值。</p><pre class="kt ku kv kw gu oe nn of og aw oh bi"><span id="3162" class="nt lq iu nn b gz oi oj l ok ol">&gt;&gt;&gt; secrets.token_bytes(16)<br/>b'\xe81\xedT\xfcOP\xe9\x9e\x87\xa4\xec\xa0\xffH9'</span></pre><p id="fb4f" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated"><strong class="mj je"> token_hex — </strong>返回十六进制格式的安全随机字节字符串，其字节在<strong class="mj je"> nbytes </strong>参数中指定。如果<strong class="mj je"> <em class="nj"> nbytes </em> </strong>为<em class="nj"> None </em>或未提供，则使用合理的默认值。</p><pre class="kt ku kv kw gu oe nn of og aw oh bi"><span id="8899" class="nt lq iu nn b gz oi oj l ok ol">&gt;&gt;&gt; secrets.token_hex(16)<br/>'6e8b324b58f0d94d5f6440b90c59d350'</span></pre><p id="f13d" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated"><strong class="mj je"> token_urlsafe — </strong>返回一个安全的随机URL安全文本字符串，其字节在<strong class="mj je"> nbytes </strong>参数中指定。</p><pre class="kt ku kv kw gu oe nn of og aw oh bi"><span id="9e4d" class="nt lq iu nn b gz oi oj l ok ol">&gt;&gt;&gt; secrets.token_urlsafe(16)<br/>'kJkUOJIUZRAYkEgFR6X52w'</span></pre><h2 id="773f" class="nt lq iu bd lr nu nv dn lv nw nx dp lz mq ny nz mb mu oa ob md my oc od mf ja bi translated">例子</h2><p id="657f" class="pw-post-body-paragraph mh mi iu mj b mk ml ke mm mn mo kh mp mq mr ms mt mu mv mw mx my mz na nb nc in bi translated">基于我们从上述函数中获得的知识，我们现在可以创建加密的强密码、OTP、令牌等。让我们看几个用例。</p><p id="2193" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated"><strong class="mj je"> (1)生成8位字符的字母数字密码</strong></p><pre class="kt ku kv kw gu oe nn of og aw oh bi"><span id="feb3" class="nt lq iu nn b gz oi oj l ok ol">&gt;&gt;&gt; import string<br/>&gt;&gt;&gt; import secrets</span><span id="d126" class="nt lq iu nn b gz om oj l ok ol">&gt;&gt;&gt; alphabet = string.ascii_letters + string.digits<br/>&gt;&gt;&gt; password = ''.join(secrets.choice(alphabet) for i in range(8))<br/>&gt;&gt;&gt; password<br/>'ubHLOZY1'</span></pre><p id="5f89" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated"><strong class="mj je"> (2)生成6位数字的动态口令</strong></p><pre class="kt ku kv kw gu oe nn of og aw oh bi"><span id="6ed7" class="nt lq iu nn b gz oi oj l ok ol">&gt;&gt;&gt; import string<br/>&gt;&gt;&gt; import secrets</span><span id="b24a" class="nt lq iu nn b gz om oj l ok ol">&gt;&gt;&gt; numbers = string.digits<br/>&gt;&gt;&gt; OTP = ''.join(secrets.choice(numbers) for i in range(8))<br/>&gt;&gt;&gt; OTP<br/>'904447'</span></pre><p id="a0f5" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated"><strong class="mj je"> (3)生成10个字符的密码，至少包含一个大写字母、一个小写字母、一个数字、一个特殊字符和至少5个字母。</strong></p><pre class="kt ku kv kw gu oe nn of og aw oh bi"><span id="46f7" class="nt lq iu nn b gz oi oj l ok ol">&gt;&gt;&gt; import string<br/>&gt;&gt;&gt; import secrets<br/>&gt;&gt;&gt; alphabet = string.ascii_letters + string.digits + string.punctuation</span><span id="5de5" class="nt lq iu nn b gz om oj l ok ol">&gt;&gt;&gt; while True:<br/>...     password = ''.join(secrets.choice(alphabet) for i in range(10))<br/>...     if (any(c.islower() for c in password)<br/>...             and any(c.isupper() for c in password)<br/>...             and any(c.islower() for c in password)<br/>...             and any(c.isdigit() for c in password)<br/>...             and any(c in string.punctuation for c in password)<br/>...             and sum(c.isalpha() for c in password) &gt;= 5):<br/>...         break</span><span id="db04" class="nt lq iu nn b gz om oj l ok ol">&gt;&gt;&gt; password<br/>"hMyo&gt;'A5&lt;="</span></pre><p id="4b79" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated"><strong class="mj je"> (4)生成用于密码重置的临时URL安全令牌<br/> </strong>假设您可能忘记了某个网站的密码。当您请求密码重置时，在通过用户id、电子邮件id或其他身份验证方法进行身份验证后，您将获得一个用于密码重置的安全URL。下面是使用<strong class="mj je"> token_urlsafe </strong>()的样例代码。</p><pre class="kt ku kv kw gu oe nn of og aw oh bi"><span id="0a7a" class="nt lq iu nn b gz oi oj l ok ol">&gt;&gt;&gt; print("Password Reset link:")<br/>&gt;&gt;&gt; SecureURL = "<a class="ae ni" href="https://mysite.com/user/chetanambi/passwordreset=" rel="noopener ugc nofollow" target="_blank">https://mysite.com/user/chetanambi/passwordreset=</a>"<br/>&gt;&gt;&gt; SecureURL += secrets.token_urlsafe(32)<br/>&gt;&gt;&gt; print(SecureURL)<br/>Password Reset link:<br/><a class="ae ni" href="https://mysite.com/user/chetanambi/passwordreset=urtFK4CeJvJ0f7nVbPAAZw" rel="noopener ugc nofollow" target="_blank">https://mysite.com/user/chetanambi/passwordreset=urtFK4CeJvJ0f7nVbPAAZw</a></span></pre><h1 id="acd1" class="lp lq iu bd lr ls no lu lv lw np ly lz kj nq kk mb km nr kn md kp ns kq mf mg bi translated">PRNG对中国共产党</h1><p id="4be3" class="pw-post-body-paragraph mh mi iu mj b mk ml ke mm mn mo kh mp mq mr ms mt mu mv mw mx my mz na nb nc in bi translated"><strong class="mj je"> PRNG </strong>代表伪随机数发生器<strong class="mj je"> CSPRNG </strong>表示密码强伪随机数发生器。</p><p id="9cc2" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated">由任何软件生成的随机数本质上都是伪随机的，因为它们来自某种分布，并且如果种子是已知的，则可以预测。另一方面，真正的随机数使用一些外部来源，这对于随机数生成是不可预测的。Python中的CSPRNG是一个真正的随机数生成器。</p><h1 id="16f0" class="lp lq iu bd lr ls no lu lv lw np ly lz kj nq kk mb km nr kn md kp ns kq mf mg bi translated">结论</h1><p id="22b8" class="pw-post-body-paragraph mh mi iu mj b mk ml ke mm mn mo kh mp mq mr ms mt mu mv mw mx my mz na nb nc in bi translated">在本文中，已经向您介绍了Python <strong class="mj je"> secrets </strong>模块。secrets模块用于生成加密性强且安全的密码、OTP、令牌和其他相关机密。Python中的<strong class="mj je"> random </strong>模块也可以用来生成随机数，但是不安全。最后，我希望上面的例子可以帮助你开始使用secrets模块。</p><p id="610c" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated"><em class="nj">原载于2021年11月4日pythonsimplifed.com</em><strong class="mj je"><em class="nj"/></strong><em class="nj">。</em></p><h1 id="d286" class="lp lq iu bd lr ls no lu lv lw np ly lz kj nq kk mb km nr kn md kp ns kq mf mg bi translated">进一步阅读</h1><ul class=""><li id="7ef9" class="on oo iu mj b mk ml mn mo mq pb mu pc my pd nc os ot ou ov bi translated"><a class="ae ni" rel="noopener ugc nofollow" target="_blank" href="/the-difference-between-a-a-b-and-a-b-in-python-a7338d96e408">Python中a=a+b和a+=b的区别</a></li><li id="8606" class="on oo iu mj b mk ow mn ox mq oy mu oz my pa nc os ot ou ov bi translated"><a class="ae ni" href="https://pythonsimplified.com/generate-fake-data-using-faker-and-python/" rel="noopener ugc nofollow" target="_blank">用Faker和Python生成假数据</a></li><li id="833b" class="on oo iu mj b mk ow mn ox mq oy mu oz my pa nc os ot ou ov bi translated"><a class="ae ni" href="https://pythonsimplified.com/difference-between-sort-and-sorted-in-python/" rel="noopener ugc nofollow" target="_blank">Python中sort()和sorted()的区别</a></li><li id="dd6f" class="on oo iu mj b mk ow mn ox mq oy mu oz my pa nc os ot ou ov bi translated"><a class="ae ni" href="https://pythonsimplified.com/the-most-controversial-python-walrus-operator/" rel="noopener ugc nofollow" target="_blank">最有争议的Python的海象算子</a></li><li id="91b3" class="on oo iu mj b mk ow mn ox mq oy mu oz my pa nc os ot ou ov bi translated"><a class="ae ni" href="https://pythonsimplified.com/understanding-indexing-and-slicing-in-python/" rel="noopener ugc nofollow" target="_blank">了解Python中的索引和切片</a></li><li id="17e6" class="on oo iu mj b mk ow mn ox mq oy mu oz my pa nc os ot ou ov bi translated"><a class="ae ni" href="https://pythonsimplified.com/making-sense-of-python-iterables-and-iterators/" rel="noopener ugc nofollow" target="_blank">理解Python中的可迭代项和迭代器</a></li><li id="2a6c" class="on oo iu mj b mk ow mn ox mq oy mu oz my pa nc os ot ou ov bi translated"><a class="ae ni" href="https://pythonsimplified.com/understanding-generators-in-python/" rel="noopener ugc nofollow" target="_blank">理解Python中的生成器</a></li></ul><p id="df72" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated">我希望你喜欢阅读这篇文章。如果你喜欢我的文章并想订阅Medium，你可以在这里订阅:</p><div class="pe pf gq gs pg ph"><a href="https://chetanambi.medium.com/membership" rel="noopener follow" target="_blank"><div class="pi ab fp"><div class="pj ab pk cl cj pl"><h2 class="bd je gz z fq pm fs ft pn fv fx jd bi translated">通过我的推荐链接加入媒体- Chetan Ambi</h2><div class="po l"><h3 class="bd b gz z fq pm fs ft pn fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="pp l"><p class="bd b dl z fq pm fs ft pn fv fx dk translated">chetanambi.medium.com</p></div></div><div class="pq l"><div class="pr l ps pt pu pq pv lc ph"/></div></div></a></div></div><div class="ab cl li lj hy lk" role="separator"><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln lo"/><span class="ll bw bk lm ln"/></div><div class="in io ip iq ir"><h1 id="c575" class="lp lq iu bd lr ls lt lu lv lw lx ly lz kj ma kk mb km mc kn md kp me kq mf mg bi translated">参考</h1><p id="8e21" class="pw-post-body-paragraph mh mi iu mj b mk ml ke mm mn mo kh mp mq mr ms mt mu mv mw mx my mz na nb nc in bi translated">[1].<a class="ae ni" href="https://docs.python.org/3/library/secrets.html" rel="noopener ugc nofollow" target="_blank">https://docs.python.org/3/library/secrets.html</a></p><p id="a7f2" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated">[2].<a class="ae ni" href="https://www.python.org/dev/peps/pep-0506/" rel="noopener ugc nofollow" target="_blank">https://www.python.org/dev/peps/pep-0506/</a></p><p id="3f9b" class="pw-post-body-paragraph mh mi iu mj b mk nd ke mm mn ne kh mp mq nf ms mt mu ng mw mx my nh na nb nc in bi translated">[3].https://pynative.com/python-secrets-module/<a class="ae ni" href="https://pynative.com/python-secrets-module/" rel="noopener ugc nofollow" target="_blank"/></p></div></div>    
</body>
</html>