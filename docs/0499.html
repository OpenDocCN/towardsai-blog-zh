<html>
<head>
<title>Artificial Neural Network Bank Customer Churn Prediction Model</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">人工神经网络银行客户流失预测模型</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/artificial-neural-network-bank-customer-churn-prediction-model-4cc3ee57b811?source=collection_archive---------1-----------------------#2020-05-16">https://pub.towardsai.net/artificial-neural-network-bank-customer-churn-prediction-model-4cc3ee57b811?source=collection_archive---------1-----------------------#2020-05-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="b66a" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">机器学习</h2><div class=""/><p id="54fd" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">这篇博客的目的是设计一个神经网络模型来预测银行客户流失。因为该模型的目标是预测客户是否会继续留在银行，或者他们是否会选择退出银行服务。这个模型的本质将是分类。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi kx"><img src="../Images/e56f60ae105907606e7acc7a4c651e67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FfkP5gbU5o-_Ps2yc16dAQ.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">神经网络体系结构</figcaption></figure><p id="2fa7" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">输入数据集包含14列，其中13列用作独立要素，最后一列是从属要素。以下是数据集的链接:</p><blockquote class="ln lo lp"><p id="c781" class="jz ka lq kb b kc kd ke kf kg kh ki kj lr kl km kn ls kp kq kr lt kt ku kv kw im bi translated"><a class="ae lu" href="https://gist.github.com/viv07/b39116817460a394210c5a0b01088221" rel="noopener ugc nofollow" target="_blank">https://gist . github . com/VIV 07/b 39116817460 a 394210 C5 a0b 01088221</a></p></blockquote><ol class=""><li id="e4e6" class="lv lw it kb b kc kd kg kh kk lx ko ly ks lz kw ma mb mc md bi translated"><strong class="kb jd">进口先决条件:</strong></li></ol><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="e114" class="mj mk it mf b gy ml mm l mn mo">import pandas as pd<br/>import seaborn as sn<br/>import numpy as np<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.preprocessing import StandardScaler<br/>import keras<br/>from keras.models import Sequential<br/>from keras.layers import Dense<br/>import matplotlib.pyplot as plt<br/>from sklearn.metrics import accuracy_score<br/>from sklearn.metrics import confusion_matrix<br/>from sklearn.metrics import classification_report</span></pre><blockquote class="ln lo lp"><p id="1e9d" class="jz ka lq kb b kc kd ke kf kg kh ki kj lr kl km kn ls kp kq kr lt kt ku kv kw im bi translated">keras库用于设计和训练神经网络。</p></blockquote><p id="80df" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">2.<strong class="kb jd">数据争吵/争论</strong></p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="89e9" class="mj mk it mf b gy ml mm l mn mo">df=pd.read_csv(r’D:\python_coding\NeuralNetworks\customer_churn.csv')<br/>df.columns</span><span id="eaf6" class="mj mk it mf b gy mp mm l mn mo">#columns<br/>Index(['RowNumber', 'CustomerId', 'Surname', 'CreditScore', 'Geography',        'Gender', 'Age', 'Tenure', 'Balance', 'NumOfProducts', 'HasCrCard',        'IsActiveMember', 'EstimatedSalary', 'Exited'],       dtype='object')</span><span id="98e8" class="mj mk it mf b gy mp mm l mn mo">df.head(10)</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi mq"><img src="../Images/2c37b50b2273f8bc0099068a1f79e60e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*65NQRxeegN3AoUFuxtwLTg.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">资料组</figcaption></figure><p id="a27c" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">填充数据集中存在的空值:</strong>特性<strong class="kb jd">估计值</strong>和<strong class="kb jd">退出</strong>中的一些值为NaN或空值。所以我们将使用pandas <strong class="kb jd"> ffill() </strong>方法来填充这些列的值。</p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="2662" class="mj mk it mf b gy ml mm l mn mo">df[‘Exited’].isnull()<br/>df[‘EstimatedSalary’].isnull()<br/>df=df.fillna(method=’ffill’,limit=1)</span></pre><p id="f9ce" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">数据集准备:</strong></p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="55f3" class="mj mk it mf b gy ml mm l mn mo">#segregate input and output variables<br/>x = df.iloc[:, 3:13]<br/>y = df.iloc[:,13]</span></pre><p id="e73e" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">一个热编码:</strong>数据集包含两个分类变量'<strong class="kb jd">性别'</strong>和'<strong class="kb jd">地理'</strong>分类值属于字符串数据类型，并且是模型训练中的一个基本特征，因此使用一次性编码值将被转换为数值。</p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="68ea" class="mj mk it mf b gy ml mm l mn mo">geography=pd.get_dummies(x[“Geography”])<br/>geography</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi mr"><img src="../Images/351fc80095288dd90ea791552b0b9cea.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*7QaB8KFXpNKdbEPF0KiQ0g.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">地理类别值</figcaption></figure><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="87dd" class="mj mk it mf b gy ml mm l mn mo">gender=pd.get_dummies(x[‘Gender’])<br/>gender</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi ms"><img src="../Images/9e1a0a7d5dc4cca6a8b9d45f8662dcf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:426/format:webp/1*5QZrBma4jgMlTrvPY0SH1A.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">性别分类值</figcaption></figure><p id="ee41" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">数据合并:</strong>合并用主数据集创建的分类集</p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="6b2e" class="mj mk it mf b gy ml mm l mn mo">x=pd.concat([x,geography,gender],axis=1)<br/>x=x.drop(['Geography','Gender'],axis=1)<br/>x</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi mt"><img src="../Images/2bc89f34d4775cb29b371079c1ff7001.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7AQpq7CiJwmwyz64JKeR9A.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">合并数据</figcaption></figure><p id="067e" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">训练和测试数据集拆分:</strong></p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="5a87" class="mj mk it mf b gy ml mm l mn mo">x_train, x_test, y_train, y_test = train_test_split(x, y, test_size = 0.2, random_state = 0)<br/>print(x_train.shape, x_test.shape, y_train.shape, y_test.shape)</span><span id="ae71" class="mj mk it mf b gy mp mm l mn mo">#output:<br/>(5578, 13) (1395, 13) (5578,) (1395,)</span></pre><p id="c779" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd"> 3。特征缩放:这是一种标准化独立输入特征的技术。进行特征缩放是为了避免一个特征优于另一个特征，并且有助于避免预测结果。</strong></p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="1621" class="mj mk it mf b gy ml mm l mn mo">from sklearn.preprocessing import StandardScaler<br/>sc = StandardScaler()<br/>x_train = sc.fit_transform(x_train)<br/>x_test = sc.transform(x_test)</span></pre><p id="c995" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">x_train和x_test现在已缩放，将用于训练和测试模型。</p><p id="dc53" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd"> 4。神经网络建立和模型训练:</strong></p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="cd82" class="mj mk it mf b gy ml mm l mn mo">#create an object of sequential model<br/>nn_classifier = Sequential()</span><span id="9f01" class="mj mk it mf b gy mp mm l mn mo"># Add the first hidden layer<br/>nn_classifier.add(Dense(output_dim = 16 ,activation=’relu’,input_dim = 13))</span><span id="8f27" class="mj mk it mf b gy mp mm l mn mo"># Adding the second hidden layer<br/>nn_classifier.add(Dense(output_dim = 16,activation=’relu’))</span><span id="9913" class="mj mk it mf b gy mp mm l mn mo"># Adding the output layer<br/>nn_classifier.add(Dense(output_dim = 1, activation = ‘sigmoid’))</span></pre><p id="033d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd"> input_dim </strong>指输入/独立特征的数量。</p><p id="922d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd"> activation_function </strong>:激活函数通过计算加权和并进一步加上偏置来决定是否激活一个神经元。激活功能的目的是<strong class="kb jd">将非线性</strong>引入神经元的输出。</p><p id="cebb" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">两种类型的激活函数:<strong class="kb jd"> RELU </strong>和<strong class="kb jd"> SIGMOID </strong>用于建立模型。</p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="a602" class="mj mk it mf b gy ml mm l mn mo">nn_classifier.compile(optimizer = ‘sgd’, loss = ‘binary_crossentropy’, metrics = [‘accuracy’])</span><span id="b11e" class="mj mk it mf b gy mp mm l mn mo">#model is trained over 100 epochs<br/>model=nn_classifier.fit(x_train, y_train ,validation_split=0.33, batch_size = 10, nb_epoch = 100)</span></pre><p id="0bd4" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">一个<strong class="kb jd">时期</strong>是向前和向后传播的组合，并且对于每一步，在优化器和学习率变量的帮助下调整权重，以最小化损失函数。</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi mu"><img src="../Images/baf92b3aba3d89685ff90927b0565376.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xFAx5QdQwJMcs4vd01aCvA.png"/></div></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">模特培训</figcaption></figure><p id="ed9d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">正如我们所看到的，在第100个<strong class="kb jd">纪元</strong>时，损耗被最小化，而精确度提高了。</p><p id="fea1" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd"> 5。分类报告和混淆矩阵绘制:</strong></p><p id="7e59" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">分类报告</strong>用于衡量分类算法的预测质量。有多少预测是真的，有多少是假的。更具体地说，真阳性、假阳性、真阴性和假阴性。</p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="9c16" class="mj mk it mf b gy ml mm l mn mo">from sklearn.metrics import classification_report<br/>print(classification_report(y_test.astype(‘int’), y_pred.astype(‘int’)))</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/307b558e38fcc190e4e62e9b75979e61.png" data-original-src="https://miro.medium.com/v2/resize:fit:918/format:webp/1*WfaOchlMqokU7JAtAN5P3w.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">分类报告</figcaption></figure><p id="bef8" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd">混淆矩阵和绘图:</strong>混淆矩阵是一个二维数组，用于比较<strong class="kb jd">预测的</strong>类别标签和<strong class="kb jd">真实的</strong>标签。对于二元分类，这些是<em class="lq">真阳性、真阴性、假阳性、</em>和<em class="lq">假阴性</em>类别。</p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="5721" class="mj mk it mf b gy ml mm l mn mo">conf_matrix = confusion_matrix(y_test.astype(‘int’), y_pred.astype(‘int’))<br/>sn.heatmap(conf_matrix,annot=True,fmt = “d”,square = True,<br/> xticklabels=[“not churn”,”churn”],<br/> yticklabels=[“not churn”,”churn”],<br/> linewidths = 2,linecolor = “w”,cmap = “Set1”)<br/>plt.subplots_adjust(wspace = .3,hspace = .3)</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/e8ff3472c4660275ae7859fdcdbe019e.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/format:webp/1*txRQYV6Da9_zey1eQcO2vA.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">混淆矩阵绘图</figcaption></figure><p id="c71b" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><strong class="kb jd"> 6。可视化损失和准确性</strong></p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="046e" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf jd">#Accuracy vs Value Accuracy</strong><br/>model.history.keys()<br/># summarize history for accuracy<br/>plt.plot(model.history[‘acc’])<br/>plt.plot(model.history[‘val_acc’])<br/>plt.title(‘model accuracy’)<br/>plt.ylabel(‘Accuracy’)<br/>plt.xlabel(‘EPOCH’)<br/>plt.legend([‘train’, ‘test’], loc=’upper left’)<br/>plt.show()</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/b07a999af0b5bd62503fdc8ea977e97d.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*wKsr55o2xz_dosnFsQqTug.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">精度与值精度的关系</figcaption></figure><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="a5dc" class="mj mk it mf b gy ml mm l mn mo"><strong class="mf jd">#loss vs value loss</strong><br/>plt.plot(model.history[‘loss’])<br/>plt.plot(model.history[‘val_loss’])<br/>plt.title(‘model loss’)<br/>plt.ylabel(‘loss’)<br/>plt.xlabel(‘epoch’)<br/>plt.legend([‘train’, ‘test’], loc=’upper left’)<br/>plt.show()</span></pre><figure class="ky kz la lb gt lc gh gi paragraph-image"><div class="gh gi my"><img src="../Images/e2c4e3e618d7ba383207a43d2b20297a.png" data-original-src="https://miro.medium.com/v2/resize:fit:862/format:webp/1*0vK4DIO9pFDRdK5D8WRzgA.png"/></div><figcaption class="lj lk gj gh gi ll lm bd b be z dk translated">损失与价值损失</figcaption></figure><p id="1bf9" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">7。预测和模型得分/准确性</p><pre class="ky kz la lb gt me mf mg mh aw mi bi"><span id="57e6" class="mj mk it mf b gy ml mm l mn mo">#prediction variable<br/>y_pred = nn_classifier.predict(x_test)</span><span id="0c62" class="mj mk it mf b gy mp mm l mn mo">#Model score calculation<br/>from sklearn.metrics import accuracy_score<br/>score=accuracy_score(y_pred.astype(‘int’),y_test.astype(‘int’))<br/>print(score)</span><span id="c5e6" class="mj mk it mf b gy mp mm l mn mo">#output: 0.8021505376344086</span></pre><p id="456d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">准确率约为80%。因此，我们的模式确实很好，但的确，总有改进的余地。</p><h1 id="6508" class="mz mk it bd na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv bi translated">总结:</h1><p id="b431" class="pw-post-body-paragraph jz ka it kb b kc nw ke kf kg nx ki kj kk ny km kn ko nz kq kr ks oa ku kv kw im bi translated">人工神经网络体系结构</p><p id="3c93" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">Keras库实现人工神经网络</p><p id="2236" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">数据争论</p><p id="0267" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">一种处理分类变量的热编码</p><p id="1ada" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">神经网络层构建</p><p id="c991" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">激活功能</p><p id="5131" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">向前和向后传播，损失函数</p><p id="0bae" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">分类报告和混淆矩阵</p><p id="3d26" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">模型精度</p><p id="587a" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">感谢所有人阅读我的文章，如果你喜欢我的内容和解释，请在Medium上关注我并分享你的反馈，这将永远帮助我们所有人提高我们的知识。</p><p id="a862" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">谢谢</p><p id="479c" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">Vivek Chaudhary</p></div></div>    
</body>
</html>