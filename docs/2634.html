<html>
<head>
<title>Manipulating Time Series Data In Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Python中操作时间序列数据</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/manipulating-time-series-data-in-python-49aed42685a0?source=collection_archive---------0-----------------------#2022-03-24">https://pub.towardsai.net/manipulating-time-series-data-in-python-49aed42685a0?source=collection_archive---------0-----------------------#2022-03-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0f76" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">Python Pandas中时间序列数据操作的实用指南</h2></div><p id="f154" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated">ime系列数据是行业中最常见的数据类型之一，在您的职业生涯中可能会用到它。因此，了解如何使用它以及如何应用分析和预测技术对于每个有抱负的数据科学家来说至关重要。在这一系列文章中，我将介绍处理时间序列数据的基本技术，从数据操作、分析和可视化开始，以了解您的数据并为其做准备，然后使用统计、机器和深度学习技术进行预测和分类。这更像是一个实践指南，我将把每个讨论和解释的概念应用到真实数据中。</p><p id="02e3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个系列将由10篇文章组成:</p><ol class=""><li id="7b30" class="ln lo it kk b kl km ko kp kr lp kv lq kz lr ld ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/manipulating-time-series-data-in-python-49aed42685a0">在Python Pandas中操作时间序列数据【实用指南】</a>(你来了！)</li><li id="48ee" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/time-series-data-analysis-in-python-1492ee4ca974">Python Pandas中的时间序列分析【实用指南】</a></li><li id="ef53" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated"><a class="ae lw" href="https://medium.com/towards-artificial-intelligence/time-series-data-visualization-in-python-2b1959726312" rel="noopener">用Python可视化时间序列数据【实用指南】</a></li><li id="2573" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/time-series-forecasting-with-arima-models-in-python-part-1-c2940a7dbc48">利用Python中的ARIMA模型进行时间序列预测【第一部分】</a></li><li id="ac6c" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/time-series-forecasting-with-arima-models-in-python-part-2-91a30d10efb0">利用Python中的ARIMA模型进行时间序列预测【第二部分】</a></li><li id="2088" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/machine-learning-for-time-series-data-in-python-regression-5e19fa2e7471">时间序列数据的机器学习【回归】</a></li><li id="306b" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated">时间序列数据的机器学习[分类](即将推出)</li><li id="4ce7" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated">时间序列数据的深度学习[实用指南](即将推出)</li><li id="db8f" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated">使用统计分析、机器学习和深度学习的时间序列预测项目(即将推出)</li><li id="63b5" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated">使用统计分析、机器学习和深度学习进行时间序列分类(即将推出)</li></ol><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi mc"><img src="../Images/ac628a1e3b0ffe072b88e67b0545da24.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*EBRlcTG0OlJiguGL"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">时间序列数据/照片由<a class="ae lw" href="https://unsplash.com/@chrisliverani?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">克里斯·利维拉尼</a>在<a class="ae lw" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="f14b" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">目录:</h1><ol class=""><li id="7986" class="ln lo it kk b kl nk ko nl kr nm kv nn kz no ld ls lt lu lv bi translated">在Pandas中处理时间序列</li><li id="769f" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated">基本时序指标和重采样</li><li id="e104" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated">窗口功能:滚动和扩展指标</li><li id="f19b" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated">构建价值加权指数</li></ol><p id="81f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所有使用的代码和数据都可以在这个<a class="ae lw" href="https://github.com/youssefHosni/Time-Series-Analysis/tree/main/Manipulating%20Time%20Series%C2%A0Data" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">呼吸</strong> </a>中找到。</p></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><p id="ad67" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">如果你想免费学习数据科学和机器学习，看看这些资源:</strong></p><ul class=""><li id="1a80" class="ln lo it kk b kl km ko kp kr lp kv lq kz lr ld nw lt lu lv bi translated">免费互动路线图，自学数据科学和机器学习。从这里开始:<a class="ae lw" href="https://aigents.co/learn/roadmaps/intro" rel="noopener ugc nofollow" target="_blank">https://aigents.co/learn/roadmaps/intro</a></li><li id="6d8c" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nw lt lu lv bi translated">数据科学学习资源搜索引擎(免费)。将你最喜欢的资源加入书签，将文章标记为完整，并添加学习笔记。<a class="ae lw" href="https://aigents.co/learn" rel="noopener ugc nofollow" target="_blank">https://aigents.co/learn</a></li><li id="8fe8" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nw lt lu lv bi translated">想要在导师和学习社区的支持下从头开始学习数据科学吗？免费加入这个学习圈:<a class="ae lw" href="https://community.aigents.co/spaces/9010170/" rel="noopener ugc nofollow" target="_blank">https://community.aigents.co/spaces/9010170/</a></li></ul><p id="23ad" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想在数据科学&amp;人工智能领域开始职业生涯，但你不知道如何开始。我提供数据科学指导课程和长期职业指导:</p><ul class=""><li id="c839" class="ln lo it kk b kl km ko kp kr lp kv lq kz lr ld nw lt lu lv bi translated">长期指导:<a class="ae lw" href="https://lnkd.in/dtdUYBrM" rel="noopener ugc nofollow" target="_blank">https://lnkd.in/dtdUYBrM</a></li><li id="42fd" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nw lt lu lv bi translated">辅导课程:<a class="ae lw" href="https://lnkd.in/dXeg3KPW" rel="noopener ugc nofollow" target="_blank">https://lnkd.in/dXeg3KPW</a></li></ul><p id="f40a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="nx">加入</em> </strong> <a class="ae lw" href="https://youssefraafat57.medium.com/membership" rel="noopener"> <strong class="kk iu"> <em class="nx">中等会员</em> </strong> </a> <strong class="kk iu"> <em class="nx">计划，只需5美元，继续无限制学习。如果你使用下面的链接，我会收到一小部分会员费，不需要你额外付费。</em> </strong></p><div class="ny nz gp gr oa ob"><a href="https://youssefraafat57.medium.com/membership" rel="noopener follow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">加入我的介绍链接媒体-优素福胡斯尼</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">阅读Youssef Hosni(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">youssefraafat57.medium.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op mm ob"/></div></div></a></div></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="d994" class="ms mt it bd mu mv oq mx my mz or nb nc jz os ka ne kc ot kd ng kf ou kg ni nj bi translated">1.在Pandas中处理时间序列</h1><p id="4a07" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">本节为利用强大的时间序列功能奠定了基础，这些功能是通过Pandas表示日期(尤其是DateTimeIndex)实现的。您将学习如何创建和操作日期信息和时间序列，以及如何使用具有时间意识的数据框架进行计算，以便及时移动数据或创建特定时期的回报。</p><h2 id="4bb0" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">1.1.如何使用熊猫的数据和时间</h2><p id="ab86" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">使用Pandas时间戳(<strong class="kk iu"> pd)在python中创建时间序列数据的基本构件。【时间戳)</strong>如下例所示:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="8151" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">时间戳对象有许多属性，可用于检索数据的特定时间信息，如年份和工作日。在下面的示例中，检索的是数据的年份。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="46fd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第二个构件是<strong class="kk iu">周期</strong>对象。period对象有一个freq属性来存储频率信息。默认为每月频率，您可以从一个频率转换到另一个频率，如下例所示。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/500aa344b275c20362bab96d4ac76deb.png" data-original-src="https://miro.medium.com/v2/resize:fit:434/format:webp/1*dphicXuiu3A3H4rlo8FaWg.png"/></div></figure><p id="e694" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输出显示默认频率是月频率。您可以使用下面的代码将其转换为每日频率。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pn"><img src="../Images/de709211b7756f491c0503d2cc376cd7.png" data-original-src="https://miro.medium.com/v2/resize:fit:464/format:webp/1*xi0V_t86OBwlHSWiZnvsbw.png"/></div></figure><p id="028b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您还可以将period转换为timestamp，反之亦然。如下例所示。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="b714" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以进行基本的数据算术运算，例如，以月频率从2017年1月的period对象开始，只需添加数字2即可获得2017年3月的月周期。如下例所示。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="e4cb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输出如下图所示:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi po"><img src="../Images/262da925a418d0d277dc3999d93acdce.png" data-original-src="https://miro.medium.com/v2/resize:fit:400/format:webp/1*ZsmN8BtJhbp8jrqnpVIAGg.png"/></div></figure><p id="83de" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要创建时间序列，您需要创建一个日期序列。要创建时间戳序列，使用熊猫的函数<strong class="kk iu"> date_range </strong>。您需要指定开始日期和/或结束日期，或者多个期间。默认值为每日频率。该函数将日期序列作为带有频率信息的DateTimeindex返回。您将认识到第一个元素是熊猫的时间戳。</p><p id="8e25" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如下例所示，输出如下图所示:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/579e2f778cc2bd39733594579c3adf35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1164/format:webp/1*p09YPGV-_OmKiZiSFhGMLA.png"/></div></figure><h2 id="b1e9" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">1.2.索引和重采样时间序列</h2><p id="0b20" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">基本的转换包括解析以字符串形式提供的日期，并将结果转换为匹配的名为datetime64的Pandas数据类型。它们还包括选择时间序列的子周期，以及设置或更改DateTimeIndex的频率。您可以将频率更改为更高或更低的值:上采样涉及增加时间频率，这需要生成新数据。下采样意味着降低时间-频率，这需要聚集数据。</p><p id="5a7c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了更好地理解这些转换，我们将把它应用到<a class="ae lw" href="https://github.com/youssefHosni/Time-Series-Analysis/tree/main/Time%20Series%20Manipulation" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">谷歌股票价格数据</strong> </a>。首先，如果您检查日期列的类型，它是一个对象，所以我们想通过下面的代码将其转换为日期类型。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/a38625e142b77ed1490645cee5ac923d.png" data-original-src="https://miro.medium.com/v2/resize:fit:674/format:webp/1*C08Zt-57o8s1o60h1wu7QA.png"/></div></figure><p id="c492" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">日期信息从字符串(对象)转换为datetime64，我们还将日期列设置为数据框的索引，因为使用以下代码可以更容易地处理数据:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/f1c085a379ccc2cde6727d5992c8f670.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*ViX3oaRX9OLXVLKOqO1j5w.png"/></div></figure><p id="b5d8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了更直观地了解数据的样子，让我们使用下面的代码绘制价格与时间的关系图:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/a2a0983e2ea1135de3e0dde60a4d6bec.png" data-original-src="https://miro.medium.com/v2/resize:fit:950/format:webp/1*vPHqRmnGnbut5T9W1LnMog.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">谷歌股价随时间的变化。</figcaption></figure><p id="09e1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您还可以使用日期索引对数据进行部分索引，如下例所示:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/273631826c61be677b6e882553a4903c.png" data-original-src="https://miro.medium.com/v2/resize:fit:916/format:webp/1*zxlGe5Xf4jNx37GVvbyllg.png"/></div></figure><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/5709a415afcf94a57d7be0bb832e7140.png" data-original-src="https://miro.medium.com/v2/resize:fit:970/format:webp/1*ORs0Cp42FQCnDt9mYegA_Q.png"/></div></figure><p id="f49b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可能已经注意到我们的DateTimeIndex没有频率信息。您可以使用<strong class="kk iu"> dot-asfreq </strong>设置频率信息。别名“D”代表日历日频率。因此，DateTimeIndex现在包含许多股票未被买入或卖出的日期。</p><p id="d084" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">以下示例显示了如何将google股票数据的DateTimeIndex转换为日历日频率:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/4866bfe46d41bc8f620d2a6ad8b7d7a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1326/format:webp/1*vdCKtNq7sppyISOW8CKNEg.png"/></div></figure><p id="6d0d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">由于这种每日采样，实例数量已增加到756个。下面的代码打印每日重新采样数据的前五行:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pw"><img src="../Images/1a16c38a3565da9e7d3086f7eeb49101.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*3Ft75xyghcM0yuVus1TBYw.png"/></div></figure><p id="9fa3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以看到，由于这种每日重采样，有一些NaN值丢失了新数据。</p><p id="47c4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以使用相同的方法将DateTimeIndex设置为工作日频率，但是要将。asfreq()方法。如下例所示:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="7ca4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果我们打印前五行，将如下图所示:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi px"><img src="../Images/2feac3bd4d13459a49dd970ff17d7c3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:414/format:webp/1*xaHoZTPHEzCQUc1GfZ4UaQ.png"/></div></figure><p id="ddfe" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在可用的数据只有工作日的数据。</p><h2 id="2cc0" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">1.3.股票价格序列的滞后、变化和回报</h2><p id="add5" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">在时间上向后或向前移动或滞后值。shift():在过去和未来之间移动数据。默认值是未来的一个周期，但是您可以通过给periods变量指定所需的移位值来更改它。</p><p id="e368" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面显示了一个shift方法的示例:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="e253" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输出如下图所示:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi py"><img src="../Images/788362f381efdfb0428dbfd7a6142835.png" data-original-src="https://miro.medium.com/v2/resize:fit:482/format:webp/1*-98rZaKZhDl0nlhwYsAyUw.png"/></div></figure><p id="64ec" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要将数据移至过去，您可以使用<strong class="kk iu"> periods=-1 </strong>，如下图所示:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/8d6aedff4804d45533bc247bc709b423.png" data-original-src="https://miro.medium.com/v2/resize:fit:616/format:webp/1*c5fh-wFi7_s1Q8pSjqkmXQ.png"/></div></figure><p id="76e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">股票价格数据以及时间序列数据的一个重要属性是百分比变化。它的公式是:((X(t)/X(t-1))-1)*100。</p><p id="eb26" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">有两种方法可以计算它，我们可以使用内置函数<strong class="kk iu"> df.pct_change() </strong>或者使用函数<strong class="kk iu"> df.div.sub()。mul() </strong>和都将给出相同的结果，如下例所示:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/00afd24a823b4683d6e12225d2cd5ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*sNTz1E7GZ6uTibBiqpxlBA.png"/></div></figure><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qb"><img src="../Images/dd5cab4122f0b54abc0b717d9dfb755c.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/1*LMm4ZpKYSKMM5PeKLUbmeg.png"/></div></figure><p id="ae0b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们还可以使用<strong class="kk iu"> df.pct_change() </strong>方法中的<strong class="kk iu"> periods </strong>变量来获得多期回报，如下例所示。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qc"><img src="../Images/6c7a2f80998f181c4f5d29959555e944.png" data-original-src="https://miro.medium.com/v2/resize:fit:504/format:webp/1*B82umaRyOGN6fiFeQcf67Q.png"/></div></figure></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="f918" class="ms mt it bd mu mv oq mx my mz or nb nc jz os ka ne kc ot kd ng kf ou kg ni nj bi translated"><strong class="ak"> 2。基本时间序列指标&amp;重采样</strong></h1><p id="1a94" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">在这一节中，我们将深入探讨通过pandas DataTimeIndex提供的基本时间序列功能。我们将介绍重采样以及如何通过标准化起始点来比较不同的时间序列。</p><h2 id="0fa2" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">2.1.重采样</h2><p id="f6c1" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">我们将从改变时间序列数据频率的重采样开始。这是一个非常常见的操作，因为您经常需要将两个时间序列转换到一个共同的频率来一起分析它们。当您通过将数据转换到更高的频率来进行上采样时，您会创建新的行，并且需要告诉pandas如何填充或插入这些行中缺失的值。当您进行下采样时，您减少了行数，并且需要告诉pandas如何聚合现有数据。</p><p id="eeef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了说明对数据进行上采样时会发生什么，让我们以相对较低的季度频率为2016年创建一个序列，其整数值为1-4。当您选择季度频率时，pandas默认为第四季度末的十二月，您可以通过使用带有季度别名的不同月份来修改它。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="204c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，让我们看看当您使用<strong class="kk iu"> dot-asfreq() </strong>将频率从季度转换为月度来对时间序列进行上采样时会发生什么。熊猫在现有日期之间向DateTimeIndex添加新的月末日期。因此，现在有几个月在3月和12月之间缺少数据。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="2a76" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">输出如下所示:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qd"><img src="../Images/0064f8c4eba5182b18de0b31670029f4.png" data-original-src="https://miro.medium.com/v2/resize:fit:354/format:webp/1*4txRPKZOrvXALTXPViqEPQ.png"/></div></figure><p id="86e6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们比较一下熊猫在上采样时填充缺失值的三种方法。前两个选项涉及选择填充方法，向前填充或回填。第三种选择是提供全部价值。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qe"><img src="../Images/5b3999e13769a37d4f17d44464ca551d.png" data-original-src="https://miro.medium.com/v2/resize:fit:634/format:webp/1*Aodk9k0WVPGv2UwiK5FTnw.png"/></div></figure><p id="f3c4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果比较结果，您会发现如果未来包含缺失值，正向填充会将任何值传播到未来。回填对过去做同样的事情，fill_value只是替换缺失的值。</p><p id="b0a2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您想要覆盖全年的每月DateTimeIndex，您可以使用<strong class="kk iu">点重新索引</strong>。Pandas将现有数据与新的月值对齐，并在其他地方生成缺失值。您可以对<strong class="kk iu">点重新索引</strong>使用与您刚刚对<strong class="kk iu">点重新索引</strong>完全相同的填充选项。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qf"><img src="../Images/6b295f20e657f62888849bdedb49bea0.png" data-original-src="https://miro.medium.com/v2/resize:fit:474/format:webp/1*FnBloR1VY9-RLVfPuF9alQ.png"/></div></figure><h2 id="702e" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">2.2.上采样和插值</h2><p id="3089" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">重采样方法遵循类似于<strong class="kk iu">点分组法</strong>的逻辑:它在重采样周期内对数据进行分组，并对该组应用一种方法。它采用此方法得出的值，并在重采样周期内分配一个新的日期。新日期由所谓的偏移量确定，例如，可以在周期的开始或结束位置，也可以在自定义位置。您将使用重采样来应用在上采样时填充或内插缺失日期的方法，或者在下采样时进行聚合的方法。</p><p id="d50f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们将把重采样方法应用于<a class="ae lw" href="https://github.com/youssefHosni/Time-Series-Analysis/tree/main/Time%20Series%20Manipulation" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">月失业率</strong> </a>。首先，我们将使用<strong class="kk iu">日期</strong>列上传并保存它，并使它成为一个索引。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi qg"><img src="../Images/b8a376f3d32d6858fa2e4daedfc7ce09.png" data-original-src="https://miro.medium.com/v2/resize:fit:374/format:webp/1*No11zvo1fUOmEeJjhuNYdw.png"/></div></div></figure><p id="3626" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">自2010年以来使用read_csv导入的85个数据点没有频率信息。对第一行的检查表明，数据是在每个日历月的第一天报告的。因此，让我们在每个日历月的开始使用<strong class="kk iu">点重采样</strong>和<strong class="kk iu">点频率</strong>方法对其进行重采样。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qh"><img src="../Images/bc36ff34272253aba26785929e6e9ca4.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*kHtUNeg-ZzGiwIVZvyC77g.png"/></div></figure><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qi"><img src="../Images/ca9917ed159109a11bbb1b97d3c1c97b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*BIDylfyPoBBXPGiB7ZQivw.png"/></div></figure><p id="3957" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这两种方法是一样的。当按月进行重采样时，我们目前关注的是月末频率。换句话说，重采样后，新数据将被分配到每个月的最后一个日历日。但是，下表显示了相当多的替代方案:</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="mi mj di mk bf ml"><div class="gh gi qj"><img src="../Images/2ce7fe1322c4d10a95ea4832d4a53fc2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XV234kUJtiw_psWPk-KqQg.png"/></div></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">重采样周期和频率偏移</figcaption></figure><p id="cbfb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">根据您的上下文，您可以重新采样到日历月或业务月的开始或结束。</p><p id="d0e8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">重采样实现了以下逻辑:上采样时，重采样周期会比数据点多。每个重新采样周期都有一个给定的日期偏移，例如月末频率。然后您需要决定如何为新的重采样周期创建数据。新的数据点将被分配给日期偏移。相反，下采样时，数据点比重采样周期多。因此，您需要决定如何聚合数据以获得每个日期偏移的单个值。</p><p id="37f5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们用一个季度序列，实际GDP增长。您会看到同样没有频率信息，但是前几行确认了每个季度第一天报告的数据。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qk"><img src="../Images/ee792da36fce5c89d8e2e2a52e822de5.png" data-original-src="https://miro.medium.com/v2/resize:fit:406/format:webp/1*F3KNxJRHCvPoNQF_jHI_zA.png"/></div></figure><p id="f302" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用<strong class="kk iu">点重采样</strong>将这个序列转换为月初频率，然后向前填充逻辑来填充间隙。我们使用<strong class="kk iu">点加后缀</strong>来区分列标签和我们接下来要产生的变体。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi ql"><img src="../Images/bc0b3a6e28e6463ff2eba1926d698073.png" data-original-src="https://miro.medium.com/v2/resize:fit:486/format:webp/1*rH57BwFfYG5ax1RGw4m_1w.png"/></div></figure><p id="54e4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">重采样还允许您对缺失的值进行插值，即填充位于现有季度增长率之间的直线上的值。看一下前几行显示了如何对平均值的现有值进行插值。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qm"><img src="../Images/216d10ce21f8d99fbfcea121885a806b.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*Iko-S6U-YapH-DlqT4S_Wg.png"/></div></figure><p id="2f01" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们现在将使用熊猫<strong class="kk iu">点连接</strong>函数连接两个数据帧来合并这两个序列。使用axis=1使pandas水平连接数据帧，对齐行索引。过去两年的数据图显示了新数据点如何位于现有数据点之间的线上，而向前填充则创建了一个类似台阶的模式。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qn"><img src="../Images/ad6cc444e42cb35824c48b34ddfdf15b.png" data-original-src="https://miro.medium.com/v2/resize:fit:910/format:webp/1*P5u0sIrk4G9hVAvz7jWutQ.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">重采样gdp_growth图</figcaption></figure><p id="7b38" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对GDP增长进行重采样后，您可以根据其常见频率绘制失业率和GDP序列。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qo"><img src="../Images/08e37ea4c61dbbf99f6d1408615600f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*ZKjUh-gVv3mNoJvOjqZNNg.png"/></div></figure><h2 id="b032" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">2.3.缩减采样和聚合</h2><p id="2fe6" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">到目前为止，我们已经关注了上采样，即增加时间序列的频率，以及如何填充或插值任何缺失值。下采样则相反，是如何降低时间序列数据的频率。例如，这包括将每小时的数据转换为每天的数据，或者将每天的数据转换为每月的数据。在这种情况下，您需要决定如何汇总现有数据，因为24小时变成了一天。您的选择是熟悉的聚合指标，如平均值或中值，或者只是最后一个值，您的选择将取决于上下文。</p><p id="c3bb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们先用<strong class="kk iu"> read_csv </strong>从环保局导入<a class="ae lw" href="https://github.com/youssefHosni/Time-Series-Analysis/tree/main/Time%20Series%20Manipulation" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">空气质量数据</strong> </a>。它包含了纽约市从2000年开始的日平均臭氧浓度。由于导入的DateTimeIndex没有频率，让我们首先使用<strong class="kk iu">点重采样</strong>分配日历日频率。产生的DateTimeIndex有附加条目，以及预期的频率信息。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qp"><img src="../Images/b463d91fcce7fa265a35c9c3cf7cdb1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:986/format:webp/1*H_3sZd_1-fVe3H5HMH_54g.png"/></div></figure><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="6807" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要将每日臭氧数据转换为每月频率，只需使用新的采样周期和偏移量应用重新采样方法。我们选择默认月末偏移的月度频率。接下来，应用平均值方法将每日数据聚合为单个月值。您可以看到月平均值已被分配到日历月的最后一天。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qq"><img src="../Images/cf027cd2dfc849d2753fa7e945b637b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:572/format:webp/1*QFmCiVuBudNJM84oNwjpow.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">每月重新取样后的臭氧数据。</figcaption></figure><p id="efe9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您可以以完全相同的方式应用中间值。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qr"><img src="../Images/e39577deb18be9658279a203c0d94f91.png" data-original-src="https://miro.medium.com/v2/resize:fit:360/format:webp/1*OBcAlRDOrZK12NlNx4njVA.png"/></div></figure><p id="6f9c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">类似于<strong class="kk iu"> groupby </strong>方法，您也可以一次应用多个聚合。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qs"><img src="../Images/fa1304f382435194d057dbc2f5ba9328.png" data-original-src="https://miro.medium.com/v2/resize:fit:484/format:webp/1*lgGR69GDTvVXxxW5rbP2Ew.png"/></div></figure><p id="df26" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们以日历-每日的频率来可视化相对于原始数据的重新采样的聚合序列。我们将绘制从2016年开始的数据，以便您可以看到更多细节。Matplotlib允许您通过引用包含绘图的axes对象在同一对象上多次绘图。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qt"><img src="../Images/8e9f54822dc13f85dd5aad0c27177211.png" data-original-src="https://miro.medium.com/v2/resize:fit:980/format:webp/1*v3d5fSqCkvICmOf06L01MQ.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">相对于原始数据的重新采样的聚合序列</figcaption></figure><p id="abb7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一个图是原始系列，第二个图包含带后缀的重新采样系列，以便图例反映差异。你可以看到，重新采样的数据平滑多了，因为月波动率已经被平均了。我们也来看看如何对几个系列进行重采样。</p><h1 id="2b94" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">3.窗口功能:滚动和扩展指标</h1><p id="d036" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">在本节中，我们将向您展示如何使用window函数来计算滚动和扩展窗口的时间序列指标。</p><h2 id="9698" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">3.1.熊猫的窗口功能</h2><p id="2faf" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">窗口函数非常有用，因为它们允许您对时间序列的子周期进行操作。特别是，窗口函数计算窗口内数据的指标。然后，这种计算的结果形成新的时间序列，其中每个数据点代表原始时间序列的几个数据点的汇总。我们将讨论两种主要类型的窗口:<strong class="kk iu">滚动窗口</strong>在时间序列上滑动时保持相同的大小，因此每个新的数据点都是给定数量的观察的结果。<strong class="kk iu">扩展窗口</strong>随着时间序列增长，因此产生新数据点的计算是所有先前数据点的结果。</p><p id="8612" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们计算一个简单的移动平均线，看看它在实践中是如何工作的。我们将再次使用过去几年的谷歌股价数据。我们将看到两种定义滚动窗口的方法:</p><p id="99ef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们应用整数窗口大小为30的<strong class="kk iu">滚动</strong>。这意味着窗口将包含前30个观察或交易日。当选择基于整数的窗口大小时，如果窗口没有缺失值，pandas将只计算平均值。您可以通过将min_periods参数设置为小于窗口大小30的值来更改此默认值。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qu"><img src="../Images/a6c27bc1a5e484029feeba534931bedc.png" data-original-src="https://miro.medium.com/v2/resize:fit:424/format:webp/1*10tWfNaZbYCTe3oWkmzXOw.png"/></div></figure><p id="ae32" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">您还可以基于日期偏移创建窗口。例如，如果您选择30D，该窗口将包含过去30个日历日内股票交易的天数。虽然窗口在周期长度方面是固定的，但是观察的数量将会变化。我们来看看滚动平均是什么样子的。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pw"><img src="../Images/5f47331f444588f1f2d92d064d465964.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*9XFAJkDUNyeDKiGMLvYwSQ.png"/></div></figure><p id="360c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你也可以计算90个日历日的滚动平均值，并将其加入到股票价格中。join方法允许您沿着轴1(即水平方向)连接一个系列或数据帧。这只是你以前见过的使用<strong class="kk iu">点连接</strong>函数的不同方式。您可以看到新的时间序列变得更加平滑，因为每个数据点现在都是之前90个日历日的平均值。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qv"><img src="../Images/4cd027b94c92ebda9f116b8eb90efe6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:932/format:webp/1*MldEGHJ5OOyeiuShSXbR0Q.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">90天内的价格与平均价格。</figcaption></figure><p id="b341" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要了解延长时间跨度对均线的影响，让我们加上360日历日均线。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qw"><img src="../Images/34b112d4c0c02f629fa941ab77391cc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*md1yxhIpVkZgzcnXEUmlbw.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">90°和360°表示滚动平均值。</figcaption></figure><p id="8772" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">该系列现在看起来更加平滑，你可以更清楚地看到短期趋势何时偏离长期趋势，例如2015年90天平均线何时跌破360天平均线。</p><p id="dd18" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">与<strong class="kk iu"> dot-groupby </strong>类似，您也可以使用<strong class="kk iu"> dot-agg </strong>方法同时计算多个指标。有了90天移动平均线和标准差，你可以很容易地辨别出波动加剧的时期。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qw"><img src="../Images/6faeba9cbed427aa0c1af3ccdc742f4a.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*LiqZXok_NKD8WFX47TuqOQ.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">90天移动平均线和标准差。</figcaption></figure><p id="a1c7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，让我们显示一个360个日历日的滚动中位数，或50%的分位数，以及10%和90%的分位数。同样，你可以看到股票价格的范围是如何随着时间的推移而变化的，有些时期比其他时期波动更大。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qw"><img src="../Images/9c1c94123490b759f0ac843e6a00a1eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*_FyLU2TFf9Bn3sTktjWI0w.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">90日历日滚动中位数，10%和90%分位数。</figcaption></figure><h2 id="a3b8" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">3.2.用熊猫扩展窗口功能</h2><p id="1e48" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">我们将从滚动窗口转向扩展窗口。现在，您将计算变大的组的指标，以排除截至当前日期的所有数据。生成的时间序列的每个数据点反映了到该点为止的所有历史值。扩展窗口有助于计算累积回报率或连续最大值或最小值。在pandas中，您可以使用方法expanding，它的工作方式就像rolling，或者在一些情况下，可以使用累积和、积、最小值和最大值的简写方法。</p><p id="0bc4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本节的实际例子中，我们将使用最近十年的<a class="ae lw" href="https://github.com/youssefHosni/Time-Series-Analysis/tree/main/Time%20Series%20Manipulation" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> S &amp; P500数据</strong> </a> <strong class="kk iu"> </strong>。让我们先来看看如何计算回报:简单的期间回报只是当前价格除以最后价格减1。几个周期的回报是所有周期回报加1再减1的乘积。</p><p id="9d07" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">所以为了更清楚起见，周期回报是:r(t) = (p(t)/p(t-1)) -1，多周期回报是:R(T) = (1+r(1))(1+r(2))……..(1+r(T)) — 1。</p><p id="2319" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">熊猫使这些计算变得简单，你已经看到了百分比变化的方法。pct_change)和基础数学(。diff()，。div()，。mul())，现在您将了解累积积。</p><p id="63ea" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要获得SP500的累积或运行回报率，只需遵循上述步骤:计算有百分比变化的期间回报率，加1计算累积积，减1。您可以将结果乘以100，并以百分比形式绘制结果。这方面的代码如下所示:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qx"><img src="../Images/136f5da7e9af7dbbe6e3b7172d959857.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*xzwdNte6xGQFLBvg0CmIhw.png"/></div></figure><p id="813d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从图中，我们可以看到SP500自2007年以来上涨了60%，尽管在2009年下跌了60%。您还可以轻松计算时间序列的运行最小值和最大值:只需应用扩展方法和各自的聚合方法。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qy"><img src="../Images/c7895ca61e558a4b4bb47e36fbed38cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*40nTvnNlLVNzF27YSt5m6A.png"/></div></figure><p id="e1c6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">橙色和绿色线条概述了到当前日期为止每天的最小值和最大值。您还可以将滚动窗口的概念与累积计算结合起来。让我们来计算滚动年收益率，即数据覆盖的十年期间所有360个日历日期间的累计收益率。这种累积计算不能作为内置方法使用。但是没问题，只要定义你自己的多周期函数，并使用<strong class="kk iu">应用</strong>它来运行滚动窗口中的数据。滚动窗口中的数据作为<strong class="kk iu"> numpy </strong>数组可用于multi_period_return函数。加1以增加所有回报，应用<strong class="kk iu"> numpy </strong>乘积函数，并减1以实现上面的公式。只需在为每日回报创建360°日历日窗口后，通过此功能进行申请。将滚动的1年回报率乘以100，以百分比的形式显示，并使用等于真的支线图绘制在指数旁边。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qy"><img src="../Images/3b2090f64e53015b17f6f3c43f2502d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*M093czCSsHVSA7gTcAmvkw.png"/></div></figure><p id="d5f2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">结果显示，2008年危机之后，年度回报率出现了大幅波动。</p><h2 id="c097" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">3.4.随机漫步和模拟</h2><p id="01af" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">众所周知，每日股票回报很难预测，模型通常假设它们遵循随机游走。我们将使用NumPy在时序上下文中生成随机数。您还将再次使用累积积从一系列退货中创建一系列价格。</p><p id="e67a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在第一个例子中，我们将从钟形正态分布中生成随机数。这意味着平均值附近的值比极端值更有可能，就像股票回报的情况一样。在第二个例子中，您将随机选择实际的标准普尔500回报，然后模拟标准普尔500价格。</p><p id="618b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要生成随机数，首先从numpy的模块random导入正态分布和种子函数。此外，从scipy导入norm包来比较随机样本的正态分布。从numpy的正常函数生成1000个随机返回，除以100以适当地缩放值。让我们画出1000个随机回报的分布图，并对您的样本进行正态分布拟合。您可以看到样本非常符合正态分布的形状。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qz"><img src="../Images/3d964c1c4c871c4224815410ce24e18b.png" data-original-src="https://miro.medium.com/v2/resize:fit:736/format:webp/1*OFE2ytqTto9QOl6ll3Q_OA.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">正态分布和1000次随机返回。</figcaption></figure><p id="6a5b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了从你的随机回报中创建一个随机价格路径，在将numpy数组转换为pandas系列之后，我们将遵循小节中的过程。将周期回报加1，计算累积积，然后减1。画出累积回报乘以100，你会看到结果价格。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qx"><img src="../Images/0f7292cd94ed433eb4563a6fd6ec36a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*RP2BjOhtaRXMkzr7ZNsYVw.png"/></div><figcaption class="mo mp gj gh gi mq mr bd b be z dk translated">随机回报。</figcaption></figure><p id="b3f3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们使用随机扩展行走来模拟SP500。导入该指数最近10年的数据，删除缺失值，并将每日回报率作为新列添加到数据框架中。指数和回报系列图显示了+/-2–3%之间的典型日回报范围，以及2008年危机期间的一些异常值。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi ra"><img src="../Images/112077c587d1da8de7398ab2b5d79e7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*Awcis--XRDR_Xzb8W4kk1g.png"/></div></figure><p id="f3b9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">标准普尔500回报分布与正态分布的比较表明，它们的形状不太匹配。这是一个典型的发现，每日股票回报比正态分布更容易出现异常值。</p><p id="90dc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们从实际的标准普尔500收益中随机选择。您将使用Numpy随机模块中的选择函数。它返回一个NumPy数组，其中包含从一个数字列表中随机抽取的样本，在我们的例子中，返回的是标准普尔500。只需向choice函数提供想要的返回样本和观察次数。接下来，将NumPy数组转换为pandas系列，并将索引设置为标准普尔500返回的日期。你的随机漫步将从第一个标准普尔500价格开始。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="dd6a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用带有日历日偏移的“第一个”方法来选择第一个标准普尔500价格。然后将随机回报加1，并将回报序列追加到起始值。现在你已经准备好计算给定实际标准普尔500起始值的累积回报了。加1，算累计积，减1。结果是基于实际回报的随机样本的SP500随机游走。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qy"><img src="../Images/d0d65aa9d5d653dd12adfc1374445fc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1208/format:webp/1*s7SJSq-0CqjJFzURnioH9g.png"/></div></figure><h2 id="c63b" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">3.4.时间序列之间的相关性</h2><p id="d1db" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">相关性是衡量两个变量之间线性关系的关键指标。例如，在金融市场中，资产回报之间的相关性对于预测模型和风险管理非常重要。Pandas和seaborn有各种工具来帮助你计算和可视化这些关系。</p><p id="c08d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">相关系数查看变量之间的成对关系，并测量两个变量围绕其各自平均值成对移动的相似性。这种成对的共同运动称为协方差。相关系数将该测量值除以每个变量的标准偏差的乘积。因此，系数在-1和+1之间变化。相关系数越接近正1或负1，两个系列的配对图就越像一条直线。系数的符号意味着正的或负的关系。正相关意味着当一个变量高于其均值时，另一个变量也可能高于其均值，反之则为负相关。然而，有许多类型的非线性关系是相关系数不能捕捉的。</p><p id="8008" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在本节中，我们将使用五项资产的<a class="ae lw" href="https://github.com/youssefHosni/Time-Series-Analysis/tree/main/Time%20Series%20Manipulation" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">价格序列</strong> </a>来分析它们之间的关系。你现在有了两个股票指数、一个债券指数、石油和黄金的10年数据。</p><p id="9af4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Seaborn有一个联合图，可以很容易地显示每个变量的分布以及显示联合分布的散点图。我们将使用每日收益进行分析。联合绘图采用一个数据帧，然后为每个轴采用两个列标签。例如，标准普尔500和债券指数具有低相关性，给出了更分散的点云和负相关性，如数据点的轻微下降趋势所示。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi rb"><img src="../Images/ce300c67a9dbbb09eba412f84672f912.png" data-original-src="https://miro.medium.com/v2/resize:fit:878/format:webp/1*81XGHzZiSXw5tbdF3G9Q6Q.png"/></div></figure><p id="1926" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Pandas允许你用一个叫做<strong class="kk iu">点相关</strong>的方法计算所有的成对相关系数。将它应用于返回数据帧，您将得到一个新的带有成对系数的数据帧。数据自然是围绕对角线对称的，对角线只包含值1，因为变量与其自身的相关性当然是1。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/b8b2f5666eb845a4971e1d9a8ddc2267.png" data-original-src="https://miro.medium.com/v2/resize:fit:814/format:webp/1*6EAmvaS7DxfQGAkkkCm1yg.png"/></div></figure><p id="e788" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Seaborn再次提供了一个简洁的工具来可视化成对相关系数。热图将具有相关系数的数据帧作为输入，并在反映相关值范围的色标上显示每个值。参数“不能等于真”确保相关系数的值也显示出来。你可以看到，不同资产类别之间的日收益相关性差异很大。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi rc"><img src="../Images/146e5b61cec428249c130174f05399cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:716/format:webp/1*5wpGNn_zWVuK_d-8nTeYsg.png"/></div></figure></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><h1 id="669b" class="ms mt it bd mu mv oq mx my mz or nb nc jz os ka ne kc ot kd ng kf ou kg ni nj bi translated">4.把所有这些放在一起:建立一个价值加权指数</h1><p id="2cf7" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">本章结合了前面的概念，教你如何创建一个价值加权指数。该指数使用证券交易所上市公司中包含的市值数据来计算权重和2016年股价信息。然后将索引性能与基准进行比较，以评估您创建的索引的性能。</p><p id="306d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要建立一个基于价值的指数，你将采取几个步骤:你将使用实际的股票交易数据作为指数成分，从每个行业中选择最大的公司。然后，您将计算每家公司的股票数量，并从文件中选择匹配的股票价格系列。接下来，您将计算每个公司的权重，并基于这些计算每个时期的指数。您还将评估和比较索引性能。</p><h2 id="e117" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">4.1选择索引组件和导入数据</h2><p id="4db2" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">首先，让我们使用pandas的<strong class="kk iu"> read_excel </strong>函数导入公司数据。您将从特定交易所导入带有列表信息的<a class="ae lw" href="https://github.com/youssefHosni/Time-Series-Analysis/blob/main/Time%20Series%20Manipulation/listings.xlsx" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu">工作表</strong> </a>，同时确保正确识别缺失值。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi rd"><img src="../Images/94c98577fe8149b18925626ecc8fc21b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*X_3mUyW3QKQdbwHpfRMbYg.png"/></div></figure><p id="6837" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">接下来，将股票代码移动到索引中。因为您将从每个行业中选择最大的公司，所以删除没有行业信息的公司。您可以使用' subset '关键字来标识一个或多个列，以过滤掉缺少的值。您已经看到了用于避免创建数据帧副本的关键字“inplace”。最后，将市值除以100万，以百万美元表示价值。结果是来自纽约证券交易所的2177家公司。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="a9ae" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要选择每个行业中最大的公司，请按行业对这些公司进行分组，选择“市场资本总额”列，并应用带有参数1的方法<strong class="kk iu"> nlargest </strong>。结果是一个多指数系列，市值以百万计。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="3633" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">第一个索引级别包含部门，第二个是股票代码。要从第二个指数级别中选择分笔成交点，请选择系列指数，并将方法“get_level_values”与指数名称“股票代码”一起应用。您也可以使用值1来选择第二个索引级别。打印代码，你会看到结果是一个单一的数据帧指数。使用方法<strong class="kk iu">点对列表</strong>获得列表形式的结果。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="72e0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，使用ticker list从使用read_csv导入的一组更广泛的最近价格时间序列中选择您的股票。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><h2 id="79a1" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">4.2构建市值加权指数</h2><p id="c5a1" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">要构造市值加权指数，需要同时使用市值和最新股价来计算股票数量，因为市值只是股票数量和每股价格的乘积。接下来，您将使用历史股票价格将其转换为一系列市场价值。然后通过从100开始对序列进行归一化，将其转换为指数。您还将看到指数回报以及每个组成部分对结果的贡献。</p><p id="ecde" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">要计算股数，用市值除以最后的价格就可以了。因为我们是以百万美元计算市值，所以你也以百万美元计算股票。现在，您可以将历史股价系列乘以股票数量。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="db90" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">结果是市场资本总额的时间序列，即每家公司的股票市场价值。通过选择这个系列的第一天和最后一天，你可以比较每家公司的市值在这一年中的变化。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="19cc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您差不多有了自己的指数:只需使用sum方法获得所有公司每期的市场价值，参数axis等于1，对每一行求和。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi re"><img src="../Images/b454ed6b764a14f585034a40ddb15ebe.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*nIUT3UJtInTFV2d5h9xk9g.png"/></div></figure><p id="f86e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在，您只需要将这个序列从1开始归一化，将这个序列除以它的第一个值，这个值是使用<strong class="kk iu"> dot-iloc </strong>得到的。将结果乘以100，您将得到方便的起始值100，其中与起始值的差异是以百分比表示的变化。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><h2 id="fe2d" class="oy mt it bd mu oz pa dn my pb pc dp nc kr pd pe ne kv pf pg ng kz ph pi ni pj bi translated">4.3.评估索引性能</h2><p id="011b" class="pw-post-body-paragraph ki kj it kk b kl nk ju kn ko nl jx kq kr ov kt ku kv ow kx ky kz ox lb lc ld im bi translated">现在您已经构建了一个加权指数，可以分析它的性能了。你分析的重要因素将是:首先，看看指数回报，以及每个组成部分对结果的贡献。接下来，将你的指数与标准普尔500指数等基准指数进行比较，后者覆盖了更广泛的市场，也是价值加权的。您可以比较子期间的整体绩效或滚动回报。</p><p id="940d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">首先，我们来看看每只股票对一年来总增值的贡献。从第一个值中减去总市值的最后一个值，可以看到指数中的公司增加了3150亿美元的市值。要查看每家公司对总变化的贡献，请将diff方法应用于每家公司和每段时间的市值系列的最后一个和第一个值。最后一行现在包含自第一天以来的总市值变化。您可以使用dot-loc和与最后一行相关的日期选择最后一行，或使用参数-1选择<strong class="kk iu"> iloc </strong>。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="50d1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了计算每个成分对指数回报的贡献，让我们首先计算成分权重。选择指数成分的市值。通过将其市值除以所有组件的市值总和来计算组件权重。如您所见，权重在2%和13%之间变化。现在，通过将最后一个指数值除以第一个值，减去1，然后乘以100来计算总指数回报。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="c08c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">现在让我们继续将同期的综合指数表现与标准普尔500进行比较。将索引系列转换为数据框架，以便可以插入新列。像以前一样从美联储导入数据。然后归一化标准普尔500，从100开始，就像你的指数一样，作为一个新列插入，然后绘制两个时间序列。你可以看到，你的指数在这段时间里提高了几个百分点。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi rf"><img src="../Images/10f7fdf80005ec27c6e91043d1e82b4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*ROF73Z6Y8f5sWN0glFXmHg.png"/></div></figure><p id="7547" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最后，为了比较不同子周期的性能，创建一个多周期回报函数，它将周期回报的NumPy数组复合成一个多周期回报，就像在第3章中所做的那样。创建您的指数和标准普尔500的每日回报，一个30个日历日的滚动窗口，并应用您的新函数。该图显示了每个系列的所有30天回报率，并说明了30天内投资于指数或标准普尔500哪个更好。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pk pl l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qx"><img src="../Images/8f0cf58c5a8a6cfc2150633a88792554.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*EANp8hY63D6U7_nbsojKVg.png"/></div></figure></div><div class="ab cl np nq hx nr" role="separator"><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu nv"/><span class="ns bw bk nt nu"/></div><div class="im in io ip iq"><div class="md me mf mg gt ob"><a href="https://youssefraafat57.medium.com/membership" rel="noopener follow" target="_blank"><div class="oc ab fo"><div class="od ab oe cl cj of"><h2 class="bd iu gy z fp og fr fs oh fu fw is bi translated">加入我的介绍链接媒体-优素福胡斯尼</h2><div class="oi l"><h3 class="bd b gy z fp og fr fs oh fu fw dk translated">阅读Youssef Hosni(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="oj l"><p class="bd b dl z fp og fr fs oh fu fw dk translated">youssefraafat57.medium.com</p></div></div><div class="ok l"><div class="ol l om on oo ok op mm ob"/></div></div></a></div><p id="62e4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="nx">感谢阅读！如果你喜欢这篇文章，一定要鼓掌(高达50！)并在</em> <a class="ae lw" href="https://www.linkedin.com/in/youssef-hosni-b2960b135/" rel="noopener ugc nofollow" target="_blank"> <em class="nx"> LinkedIn </em> </a> <em class="nx">上与我联系，并在</em><a class="ae lw" href="https://youssefraafat57.medium.com/" rel="noopener"><em class="nx">Medium</em></a><em class="nx">上关注我的新文章。</em></p></div></div>    
</body>
</html>