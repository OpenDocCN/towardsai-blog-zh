<html>
<head>
<title>Setting up Alpaca API for algorithmic trading</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">为算法交易设置羊驼API</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/setting-up-alpaca-api-for-algorithmic-trading-490db5be4e4?source=collection_archive---------1-----------------------#2020-07-22">https://pub.towardsai.net/setting-up-alpaca-api-for-algorithmic-trading-490db5be4e4?source=collection_archive---------1-----------------------#2020-07-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="912b" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph">API，<a class="ae ep" href="https://towardsai.net/p/category/education" rel="noopener ugc nofollow" target="_blank">教育</a>，<a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="93d3" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用API向经纪公司下订单。完整的参考代码<a class="ae kr" href="https://github.com/alpacahq" rel="noopener ugc nofollow" target="_blank">可以在这个Github库</a>获得。这个代码<a class="ae kr" href="https://github.com/arditoibryan/Projects/tree/master/20200722_Alpaca_API" rel="noopener ugc nofollow" target="_blank">在我的回购</a>。</h2></div><p id="fdd5" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">在网上，你可以找到几家允许你交易的经纪公司。羊驼提供了一个非常先进的界面，让您通过浏览器与其主终端进行通信，甚至使用代码进行信息交流。</p><p id="9c3e" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">在这篇文章中，我不会解释贸易的基础知识，也许只是一些特定的术语，以免让人混淆。这是一篇关于如何通过使用API来协调自动事务的技术文章。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/5ce8ea9e24f7c700ee9d4d520e55e14c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hDQWsctiI00uCcp8Lc57NQ.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">来源:<a class="ae kr" href="https://alpaca.markets/" rel="noopener ugc nofollow" target="_blank">https://alpaca.markets/</a></figcaption></figure><blockquote class="me"><p id="a576" class="mf mg it bd mh mi mj mk ml mm mn ln dk translated">***如果你是编码/金融初学者，要知道每个经纪公司都提供一个简单的界面，你可以在那里放置你的头寸。我所做的是绕过接口，通过使用代码来放置事务。***</p></blockquote><h2 id="e8c8" class="mo mp it bd mq mr ms dn mt mu mv dp mw lb mx my mz lf na nb nc lj nd ne nf iz bi translated">如果我可以手动做同样的事情，为什么还要使用代码呢？</h2><p id="9880" class="pw-post-body-paragraph ks kt it ku b kv ng kd kx ky nh kg la lb ni ld le lf nj lh li lj nk ll lm ln im bi translated">如果只是需要交易，完全没有必要使用代码。事实上，事情可能会更复杂。但是，如果你需要根据几秒钟一变的指标，每天做几百个微交易，那么你就不是在正常交易，你是在做<strong class="ku jd">量化交易</strong>。</p><h2 id="75e7" class="mo mp it bd mq mr nl dn mt mu nm dp mw lb nn my mz lf no nb nc lj np ne nf iz bi translated">注册账户</h2><p id="a7ff" class="pw-post-body-paragraph ks kt it ku b kv ng kd kx ky nh kg la lb ni ld le lf nj lh li lj nk ll lm ln im bi translated">在这个帐户中，我将建立一个模拟。真正的账户还没有设立。事实上，在使用算法用真钱交易之前，要确保你的代码运行良好。您可以通过简单地实现一个模拟来做到这一点。出了问题，<strong class="ku jd">可以复位</strong>。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi nq"><img src="../Images/5efa983da9a82c29a4106e1c7666b5c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nKs7BQ3w8RjJDReG-Bp7fw.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">您必须单击才能立即开始模拟的屏幕截图，无必填信息</figcaption></figure><p id="57fc" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">一旦你注册了一个账户，你就可以点击“让我先试试纸交易API”进入界面。你将进入羊驼主界面。在这里，您可以手动打开您的交易。我将通过使用代码来做到这一点。</p><h2 id="1a0a" class="mo mp it bd mq mr nl dn mt mu nm dp mw lb nn my mz lf no nb nc lj np ne nf iz bi translated">导入库</h2><pre class="lp lq lr ls gt nr ns nt nu aw nv bi"><span id="1233" class="mo mp it ns b gy nw nx l ny nz">!pip3 install alpaca-trade-api</span></pre><h2 id="7cee" class="mo mp it bd mq mr nl dn mt mu nm dp mw lb nn my mz lf no nb nc lj np ne nf iz bi translated">设置连接</h2><p id="5d77" class="pw-post-body-paragraph ks kt it ku b kv ng kd kx ky nh kg la lb ni ld le lf nj lh li lj nk ll lm ln im bi translated">对于您将要连接的每个API，您可能需要获得您的API密钥。当您进入控制面板时，您会立即在屏幕右侧看到这个框，其中包含建立连接所需的信息。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/25d33b856cb78be680d4691fb3ed58c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1054/format:webp/1*ZdxlsgPJ1UV1kPXu7iZ4Aw.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">这是如何找到两把钥匙</figcaption></figure><pre class="lp lq lr ls gt nr ns nt nu aw nv bi"><span id="4470" class="mo mp it ns b gy nw nx l ny nz">import alpaca_trade_api as tradeapi</span><span id="d07d" class="mo mp it ns b gy ob nx l ny nz">#estabilish connection<br/>api = tradeapi.REST(<br/>'key #1', <br/>'key #2', <br/>'<a class="ae kr" href="https://paper-api.alpaca.markets'" rel="noopener ugc nofollow" target="_blank">https://paper-api.alpaca.markets'</a>, 'v2')</span></pre><p id="639d" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">通过使用上面的代码，您已经创建了<strong class="ku jd"> api </strong>对象，它充当您和代理之间的连接。</p><h2 id="95ef" class="mo mp it bd mq mr nl dn mt mu nm dp mw lb nn my mz lf no nb nc lj np ne nf iz bi translated">获取请求:获取输入</h2><pre class="lp lq lr ls gt nr ns nt nu aw nv bi"><span id="9755" class="mo mp it ns b gy nw nx l ny nz">#get open positions<br/>pos = api.list_positions()<br/>pos</span></pre><p id="8ef0" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">通过这行代码，您将创建您的<strong class="ku jd"> pos </strong>对象。这是您当前投资组合中所有未平仓头寸的列表。要访问它的任何变量，请记住这是一个类:</p><h2 id="b893" class="mo mp it bd mq mr nl dn mt mu nm dp mw lb nn my mz lf no nb nc lj np ne nf iz bi translated">市场如何运作:下单与持仓</h2><p id="e671" class="pw-post-body-paragraph ks kt it ku b kv ng kd kx ky nh kg la lb ni ld le lf nj lh li lj nk ll lm ln im bi translated">这个概念很简单:在你下单之前，它会变成一个头寸。这就像你在向券商申请进入市场的许可。如果你有足够的资金，并且所有的信息都是正确的，那么订单就被下了，并且现在在队列中。</p><p id="23e6" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">在等待接受的队列中，订单和空缺职位之间有很大的区别。在未平仓的情况下，您的押注目前活跃在市场上，您可能会盈利或亏损。有些职位是可以立即开仓的，除非你要求具体的参数。例如，您可能希望只在一只股票达到特定的价格限制时才买入它。<strong class="ku jd">只有当条件满足</strong>时，该指令才成为持仓指令。</p><h2 id="646c" class="mo mp it bd mq mr nl dn mt mu nm dp mw lb nn my mz lf no nb nc lj np ne nf iz bi translated">发布请求:下订单</h2><p id="ef15" class="pw-post-body-paragraph ks kt it ku b kv ng kd kx ky nh kg la lb ni ld le lf nj lh li lj nk ll lm ln im bi translated">我们可以使用以下代码在交易平台上轻松下单:</p><pre class="lp lq lr ls gt nr ns nt nu aw nv bi"><span id="1bcc" class="mo mp it ns b gy nw nx l ny nz">try:<br/>    placing_order = api.submit_order(<br/>      symbol='', #GOOG, AMZN, FB...<br/>      qty=quantity,#10, 100, 1000...<br/>      side='', #buy, sell<br/>      type='', #market, limit<br/>      time_in_force='day',<br/>      limit_price=limit,<br/>      stop_price=stop<br/>    )<br/>    #print(placing_order)<br/>  except:<br/>    print('Something went wrong')<br/>    return 0<br/>  print('Successful')<br/>  return 1</span></pre><p id="8142" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">有了这个代码，你就可以把你需要的所有规格的订单发送给经纪公司。它将打印出订单是否成功。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi oc"><img src="../Images/5c55427122afc606c6210705f06d1cbb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LyuR-VKAdUn1xnhNYGieog.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">顺便说一下，这是一个模拟，股票是随机挑选的</figcaption></figure><h2 id="38d6" class="mo mp it bd mq mr nl dn mt mu nm dp mw lb nn my mz lf no nb nc lj np ne nf iz bi translated">用羊驼毛还能做什么？</h2><p id="5d56" class="pw-post-body-paragraph ks kt it ku b kv ng kd kx ky nh kg la lb ni ld le lf nj lh li lj nk ll lm ln im bi translated">到目前为止，我决定用最重要的工具与羊驼交易经纪公司沟通。在<a class="ae kr" href="https://github.com/alpacahq" rel="noopener ugc nofollow" target="_blank">链接库</a>中，您可以根据需要找到完整的列表。</p><p id="b232" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">与必须手动输入所有订单的经纪人相比，量化金融无疑让你处于优势，但如果你的代码不稳定，这也是一件危险的事情。</p></div></div>    
</body>
</html>