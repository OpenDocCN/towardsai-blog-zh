<html>
<head>
<title>How Many Ads Have You Watched Today?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">你今天看了多少广告？</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-many-ads-have-you-watched-today-70d42062109f?source=collection_archive---------4-----------------------#2021-08-11">https://pub.towardsai.net/how-many-ads-have-you-watched-today-70d42062109f?source=collection_archive---------4-----------------------#2021-08-11</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="8a20" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-science" rel="noopener ugc nofollow" target="_blank">数据科学</a>在R</h2><div class=""/><div class=""><h2 id="a25e" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">ads数据的完整时间序列分析</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/c9d3f0c02d5d713f72b008ef6fca5467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZzOdt-Lz0mlv-6WT_kO69w.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片作者<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="0c02" class="ln lo it lj b gy lp lq l lr ls"><strong class="lj jd">Table of Contents</strong></span><span id="836d" class="ln lo it lj b gy lt lq l lr ls">· <a class="ae lh" href="#4cf3" rel="noopener ugc nofollow">Library</a><br/>· <a class="ae lh" href="#87d7" rel="noopener ugc nofollow">Dataset</a><br/>· <a class="ae lh" href="#49a0" rel="noopener ugc nofollow">Data Cleaning</a><br/>· <a class="ae lh" href="#38bd" rel="noopener ugc nofollow">Decomposition</a><br/>· <a class="ae lh" href="#31b3" rel="noopener ugc nofollow">Metrics and Validation</a><br/>· <a class="ae lh" href="#ec7b" rel="noopener ugc nofollow">Modeling</a><br/>  ∘ <a class="ae lh" href="#b2b4" rel="noopener ugc nofollow">Holt-Winters Exponential</a><br/>  ∘ <a class="ae lh" href="#9aaa" rel="noopener ugc nofollow">SARIMA</a><br/>  ∘ <a class="ae lh" href="#0f8b" rel="noopener ugc nofollow">Auto ARIMA</a><br/>· <a class="ae lh" href="#3a4d" rel="noopener ugc nofollow">Assumptions</a><br/>  ∘ <a class="ae lh" href="#cb02" rel="noopener ugc nofollow">No-autocorrelated residuals</a><br/>  ∘ <a class="ae lh" href="#8a5c" rel="noopener ugc nofollow">Normally distributed residuals</a><br/>· <a class="ae lh" href="#8b69" rel="noopener ugc nofollow">Conclusion</a></span></pre><p id="9a2a" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi mq translated"><span class="l mr ms mt bm mu mv mw mx my di"> H </span>你有没有看过一个游戏内广告拼命收集硬币和钻石，或者复活到一个关卡再来一次？如果是这样，你并不孤单。有些广告是可以的，我的意思是，他们需要推广他们的产品，并在这样做的时候抓住它，但其他人只是直截了当地讨厌。如果你看了足够多的YouTube，你知道我在说什么。</p><p id="4c86" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">事实证明，人们更倾向于在一天中的特定时段观看手机游戏广告。在本文中，我们将尝试预测这种行为。具体来说，我们将从手机游戏数据中调查每小时观看的广告，并尝试预测未来24小时将有多少广告被观看。</p><h1 id="4cf3" class="mz lo it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">图书馆</h1><p id="7516" class="pw-post-body-paragraph lu lv it lw b lx nq kd lz ma nr kg mc md ns mf mg mh nt mj mk ml nu mn mo mp im bi translated">在本文中，我们将使用R。首先，导入必要的库。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="b02f" class="ln lo it lj b gy lp lq l lr ls">library(dplyr)          # data wrangling<br/>library(lubridate)      # date functions<br/>library(xts)            # time series object<br/>library(padr)           # padding time series<br/>library(forecast)       # forecasting time series<br/>library(tseries)        # where is pewdiepie<br/>library(ggplot2)        # graphing</span></pre><h1 id="87d7" class="mz lo it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">资料组</h1><p id="c080" class="pw-post-body-paragraph lu lv it lw b lx nq kd lz ma nr kg mc md ns mf mg mh nt mj mk ml nu mn mo mp im bi translated">我们来读一下数据集。该数据集可在<a class="ae lh" href="https://www.kaggle.com/kashnitsky/mlcourse" rel="noopener ugc nofollow" target="_blank"> Kaggle </a>上获得。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="4a5c" class="ln lo it lj b gy lp lq l lr ls">ads &lt;- read.csv('ads.csv')<br/>head(ads)</span><span id="6d9b" class="ln lo it lj b gy lt lq l lr ls">#&gt;                  Time    Ads<br/>#&gt; 1 2017-09-13T00:00:00  80115<br/>#&gt; 2 2017-09-13T01:00:00  79885<br/>#&gt; 3 2017-09-13T02:00:00  89325<br/>#&gt; 4 2017-09-13T03:00:00 101930<br/>#&gt; 5 2017-09-13T04:00:00 121630<br/>#&gt; 6 2017-09-13T05:00:00 116475</span><span id="4b01" class="ln lo it lj b gy lt lq l lr ls">range(ads$Time)</span><span id="4de2" class="ln lo it lj b gy lt lq l lr ls">#&gt; [1] "2017-09-13T00:00:00" "2017-09-21T23:00:00"</span><span id="2489" class="ln lo it lj b gy lt lq l lr ls">range(ads$Ads)</span><span id="f4d1" class="ln lo it lj b gy lt lq l lr ls">#&gt; [1]  70335 169900</span></pre><p id="d315" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">我们有一个从<strong class="lw jd">2017–09–13 00:00:00</strong>到<strong class="lw jd">2017–09–21 23:00:00</strong>的一个小时的时间序列数据，显示一款手机游戏观看了多少个广告，从7万到17万左右不等。</p><h1 id="49a0" class="mz lo it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">数据清理</h1><p id="2454" class="pw-post-body-paragraph lu lv it lw b lx nq kd lz ma nr kg mc md ns mf mg mh nt mj mk ml nu mn mo mp im bi translated">先来一个定义。</p><blockquote class="nv nw nx"><p id="a818" class="lu lv ny lw b lx ly kd lz ma mb kg mc nz me mf mg oa mi mj mk ob mm mn mo mp im bi translated">时间序列是按时间顺序索引(或列出或绘制)的一系列数据点。因此，数据由相对确定的时间戳组织，与随机采样数据相比，可能包含我们可以提取的附加信息。</p></blockquote><p id="5f3a" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">首先，我们可以将<code class="fe oc od oe lj b">Time</code>特性从字符转换为时间格式，填充以使时间段均匀，然后检查缺失的值。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="90a5" class="ln lo it lj b gy lp lq l lr ls">ads &lt;- ads %&gt;% <br/>  mutate(Time = ymd_hms(Time)) %&gt;% <br/>  arrange(Time) %&gt;% <br/>  pad()<br/><br/>ads %&gt;% is.na() %&gt;% colSums()</span><span id="8b4e" class="ln lo it lj b gy lt lq l lr ls">#&gt; Time  Ads <br/>#&gt;    0    0</span></pre><p id="4d6d" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">太好了！不存在缺失值。</p><p id="b31d" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">现在，我们需要从数据中创建一个时序对象。因为我们的数据是以小时为间隔的，所以我们可以使用<code class="fe oc od oe lj b">xts()</code>函数来实现。按<code class="fe oc od oe lj b">time_index</code>排序数据，这只是一个小时的索引，如<code class="fe oc od oe lj b">Time</code>原始数据中的特征。此外，我们需要将频率设置为24，因为在每24个时间戳中，数据具有周期性。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="8e72" class="ln lo it lj b gy lp lq l lr ls">time_index &lt;- seq(<br/>  from = as.POSIXct("2017-09-13 00:00:00"), <br/>  to = as.POSIXct("2017-09-21 23:00:00"), <br/>  by = "hour"<br/>)<br/><br/>ads_xts &lt;- xts(ads$Ads, order.by = time_index, frequency = 24)<br/>ads_xts %&gt;% autoplot() + ggtitle("Ads Watched per Hour")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/7f52cce3cb579609a00f2592289b6423.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ggYFH8WmJLOWyWhTK5GBqQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片作者<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><p id="56ca" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">由于源自<code class="fe oc od oe lj b">xts()</code> <a class="ae lh" href="https://github.com/joshuaulrich/xts/issues/177" rel="noopener ugc nofollow" target="_blank">的时间序列对象不容易分解</a>，从现在开始我们将使用<code class="fe oc od oe lj b">ts()</code>函数将其转换为另一个时间序列对象。因此，我们可以应用许多内置函数(如<code class="fe oc od oe lj b">decompose()</code>)，尽管作为一个缺点，时间索引的每小时间隔将被忽略。如果有更简单的解决方案，直接使用源自<code class="fe oc od oe lj b">xts()</code>的时间序列，作者将不胜感激。请在下面的回复部分告诉我！</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="567e" class="ln lo it lj b gy lp lq l lr ls">ads_ts &lt;- ts(ads_xts, frequency = 24)</span></pre><h1 id="38bd" class="mz lo it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">分解</h1><p id="2ef8" class="pw-post-body-paragraph lu lv it lw b lx nq kd lz ma nr kg mc md ns mf mg mh nt mj mk ml nu mn mo mp im bi translated">一个时间序列基本上是由三个基本时间序列组成的<em class="ny">:</em></p><ol class=""><li id="96f4" class="og oh it lw b lx ly ma mb md oi mh oj ml ok mp ol om on oo bi translated">趋势:数据的总体方向，是持平、上升还是下降。如果趋势仍然有波动，这意味着数据中有某种模式没有被分解。</li><li id="0f18" class="og oh it lw b lx op ma oq md or mh os ml ot mp ol om on oo bi translated">季节性:在固定时间戳内出现的周期性模式。</li><li id="cc9c" class="og oh it lw b lx op ma oq md or mh os ml ot mp ol om on oo bi translated">余数:未计入趋势和季节的任何模式。</li></ol><p id="9d98" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">我们这里所说的<em class="ny">合成</em>只是这三种分解的加法或乘法。加法型时间序列始终具有相对恒定的方差，而乘法型时间序列则具有方差增大或减小的趋势。作为例证，请看下图。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/ac2fdd5c8ea2c273ef18f83c0a057a5e.png" data-original-src="https://miro.medium.com/v2/1*AYQrDG7UQXh6jlPKJx30Zw.gif"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://www.crystalballservices.com/Portals/0/CB_Material/CrystalBallUserGuides/en/Predictor%20Users%20Guide/frameset.htm?ch03s04s01.html" rel="noopener ugc nofollow" target="_blank">甲骨文水晶球预测用户</a></figcaption></figure><p id="1e62" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">乘法时间序列可以进行对数变换，以创建加法时间序列。显然，我们的数据已经是一个附加的时间序列。让我们观察它的分解。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="c9ec" class="ln lo it lj b gy lp lq l lr ls">dim(ads_ts) &lt;- NULL<br/>ads_ts %&gt;% decompose() %&gt;% autoplot()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/17fb3dad31b8b7f1b5c402cebf3fdaff.png" data-original-src="https://miro.medium.com/v2/format:webp/1*vriJkc0clSYc5I64QYO-Eg.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片作者<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><p id="860b" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">很明显，我们有一个相当平坦的趋势(没有趋势)。然而，在2017年9月16日至17日，趋势曲线有一个轻微的凸起。这是因为这两天是周末，人们似乎在周末玩更多的手机游戏，因此观看更多的广告。请注意，由于在计算趋势曲线时使用了中心移动平均线，我们在趋势曲线的开始和结束时各丢失了半天的信息。</p><p id="ad14" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">同样清楚的是，我们有24小时的季节性。让我们放大一点。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="ed89" class="ln lo it lj b gy lp lq l lr ls">window(<br/>  x = ads_xts, <br/>  start = as.POSIXct("2017-09-13 00:00:00"), <br/>  end = as.POSIXct("2017-09-13 23:00:00")<br/>) %&gt;% autoplot() + ggtitle("Ads Watched per Hour on 13 September 2017")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/90184edcc4b400ed3b03f8679ed02e58.png" data-original-src="https://miro.medium.com/v2/format:webp/1*rmdt1bKuVncDcAJ1BAW15Q.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片作者<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><p id="455e" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">上图是我们2017年9月13日全天的时间序列数据(用于分析目的的代表性数据)。夜间观看的广告数量约为80k。这个数字不断增加，并在04:00左右达到峰值120k。也许一些早上的游戏玩家来到他们的手机前，想看一些游戏中的事件？然后，这个数字在早上的例行活动中下降，并在中午12:00左右增加到第二个峰值160k。在此之后，似乎有些人结束了一天的工作并继续玩，而其他人则回到工作中，直到16:00才稍有减少。该数字再次增加，在18:00-19:00(下班后)达到第三个也是最后一个峰值160，000-170，000，然后在晚上回落到大约80，000。</p><p id="bbdb" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">最后，除了2017年9月16日至17日的一些峰值外，我们其余的数据都很小(这很好)。同样，这可能来自于周末的不规律。</p><h1 id="31b3" class="mz lo it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">度量和验证</h1><p id="0101" class="pw-post-body-paragraph lu lv it lw b lx nq kd lz ma nr kg mc md ns mf mg mh nt mj mk ml nu mn mo mp im bi translated">我们将使用MAPE(平均绝对百分比误差)作为我们的衡量标准，因为它不依赖于数据的大小，只依赖于原始数据的百分比，这便于比较不同模型的性能。此外，我们将照常将数据分为<code class="fe oc od oe lj b">train</code>和<code class="fe oc od oe lj b">test</code>进行模型验证。测试数据将是我们需要预测的最后24小时，正如问题陈述询问我们的那样。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="a3f5" class="ln lo it lj b gy lp lq l lr ls">test_num &lt;- 24<br/>test &lt;- tail(ads_ts, test_num)<br/>train &lt;- head(ads_ts, length(ads_ts)-length(test))</span></pre><h1 id="ec7b" class="mz lo it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">建模</h1><p id="d8c7" class="pw-post-body-paragraph lu lv it lw b lx nq kd lz ma nr kg mc md ns mf mg mh nt mj mk ml nu mn mo mp im bi translated">我们有几个简单的模型可供选择，以及它们适用于哪些时间序列数据:</p><ol class=""><li id="aa94" class="og oh it lw b lx ly ma mb md oi mh oj ml ok mp ol om on oo bi translated">简单移动平均线(SMA) →无趋势和季节性</li><li id="3823" class="og oh it lw b lx op ma oq md or mh os ml ot mp ol om on oo bi translated">指数平滑法</li></ol><ul class=""><li id="7132" class="og oh it lw b lx ly ma mb md oi mh oj ml ok mp ou om on oo bi translated">简单指数平滑(SES) →无趋势和季节性</li><li id="cdac" class="og oh it lw b lx op ma oq md or mh os ml ot mp ou om on oo bi translated">双指数平滑(霍尔特指数平滑)→趋势无季节性</li><li id="8eae" class="og oh it lw b lx op ma oq md or mh os ml ot mp ou om on oo bi translated">三重指数平滑(霍尔特-温特斯)→趋势和季节性</li></ul><p id="5afd" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">3.自回归综合移动平均线(ARIMA) →无季节性趋势</p><p id="aa73" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">4.季节性ARIMA (SARIMA) →符合潮流和季节性</p><p id="3666" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">由于我们有季节性数据，我们将使用霍尔特-温特斯和萨里玛。</p><h2 id="b2b4" class="ln lo it bd na ov ow dn ne ox oy dp ni md oz pa nk mh pb pc nm ml pd pe no iz bi translated">霍尔特-温特斯指数</h2><p id="92a5" class="pw-post-body-paragraph lu lv it lw b lx nq kd lz ma nr kg mc md ns mf mg mh nt mj mk ml nu mn mo mp im bi translated">首先，建立模型。霍尔特-温特斯模型自动给我们这个问题的平滑参数<em class="ny"> α </em> = 0.92、<em class="ny"> β </em> = 0、<em class="ny"> γ </em> = 1。我们可以手动调整这些参数，但现在，我们将坚持什么给定的。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="2519" class="ln lo it lj b gy lp lq l lr ls">hw_model &lt;- HoltWinters(x = train)<br/>hw_model</span><span id="8c80" class="ln lo it lj b gy lt lq l lr ls">#&gt; Holt-Winters exponential smoothing with trend and additive seasonal component.<br/>#&gt; <br/>#&gt; Call:<br/>#&gt; HoltWinters(x = train)<br/>#&gt; <br/>#&gt; Smoothing parameters:<br/>#&gt;  alpha: 0.9177049<br/>#&gt;  beta : 0<br/>#&gt;  gamma: 1<br/>#&gt; <br/>#&gt; Coefficients:<br/>#&gt;            [,1]<br/>#&gt; a   116134.6370<br/>#&gt; b     -112.5410<br/>#&gt; s1  -42551.9149<br/>#&gt; s2  -46114.6303<br/>#&gt; s3  -38622.4558<br/>#&gt; s4  -23062.7216<br/>#&gt; s5     766.4552<br/>#&gt; s6   -2643.0073<br/>#&gt; s7  -10590.9356<br/>#&gt; s8  -16361.4525<br/>#&gt; s9  -18599.8027<br/>#&gt; s10  -9730.1904<br/>#&gt; s11   6773.7268<br/>#&gt; s12  23255.7037<br/>#&gt; s13  32034.0766<br/>#&gt; s14  29038.2208<br/>#&gt; s15  27572.8383<br/>#&gt; s16  26323.7715<br/>#&gt; s17  24075.6307<br/>#&gt; s18  26062.1503<br/>#&gt; s19  36996.4620<br/>#&gt; s20  39800.2418<br/>#&gt; s21  16732.8980<br/>#&gt; s22 -12780.5149<br/>#&gt; s23 -27289.9691<br/>#&gt; s24 -40084.6370</span></pre><p id="9c88" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">现在，预测时间…</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="98a7" class="ln lo it lj b gy lp lq l lr ls">hw_forecast &lt;- forecast(hw_model, h = test_num)<br/>hw_forecast</span><span id="8c79" class="ln lo it lj b gy lt lq l lr ls">#&gt;          Point Forecast     Lo 80     Hi 80     Lo 95     Hi 95<br/>#&gt; 9.000000       73470.18  64566.94  82373.42  59853.85  87086.51<br/>#&gt; 9.041667       69794.92  57710.82  81879.03  51313.88  88275.97<br/>#&gt; 9.083333       77174.56  62587.46  91761.66  54865.52  99483.60<br/>#&gt; 9.125000       92621.75  75902.26 109341.24  67051.50 118192.00<br/>#&gt; 9.166667      116338.39  97729.27 134947.50  87878.20 144798.57<br/>#&gt; 9.208333      112816.38  92492.58 133140.19  81733.81 143898.96<br/>#&gt; 9.250000      104755.91  82851.24 126660.59  71255.60 138256.23<br/>#&gt; 9.291667       98872.86  75493.96 122251.75  63117.92 134627.79<br/>#&gt; 9.333333       96521.97  71756.45 121287.48  58646.38 134397.55<br/>#&gt; 9.375000      105279.04  79200.53 131357.54  65395.40 145162.67<br/>#&gt; 9.416667      121670.41  94341.92 148998.90  79875.09 163465.73<br/>#&gt; 9.458333      138039.85 109516.10 166563.60  94416.54 181663.16<br/>#&gt; 9.500000      146705.68 117034.78 176376.58 101327.96 192083.40<br/>#&gt; 9.541667      143597.28 112821.97 174372.60  96530.50 190664.06<br/>#&gt; 9.583333      142019.36 110177.91 173860.81  93322.07 190716.65<br/>#&gt; 9.625000      140657.75 107784.73 173530.78  90382.80 190932.70<br/>#&gt; 9.666667      138297.07 104423.87 172170.27  86492.48 190101.66<br/>#&gt; 9.708333      140171.05 105326.37 175015.72  86880.72 193461.38<br/>#&gt; 9.750000      150992.82 115203.03 186782.61  96257.06 205728.58<br/>#&gt; 9.791667      153684.06 116973.47 190394.64  97540.06 209828.05<br/>#&gt; 9.833333      130504.17  92895.33 168113.01  72986.41 188021.93<br/>#&gt; 9.875000      100878.22  62392.08 139364.36  42018.75 159737.69<br/>#&gt; 9.916667       86256.22  46912.35 125600.10  26084.96 146427.49<br/>#&gt; 9.958333       73349.02  33165.70 113532.33  11893.94 134804.09</span></pre><p id="ac25" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">…和情节。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="f772" class="ln lo it lj b gy lp lq l lr ls">train %&gt;% <br/>  autoplot(series = "train") +<br/>  autolayer(test, series = "test") +<br/>  autolayer(hw_model$fitted[,1], series = "fitted") +<br/>  autolayer(hw_forecast$mean, series = "forecast") + <br/>  ggtitle("Holt-Winters Prediction")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/6fff0484bb46165d6befb60ce8fa470c.png" data-original-src="https://miro.medium.com/v2/format:webp/1*4934VosZd7AG6c0o193XdA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片作者<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="2765" class="ln lo it lj b gy lp lq l lr ls">hw_mape &lt;- cbind(<br/>  'train_mape' = accuracy(hw_model$fitted[,1], train)[, 'MAPE'],<br/>  'test_mape' = accuracy(hw_forecast$mean, test)[, 'MAPE']<br/>)<br/><br/>hw_mape &lt;- as.data.frame(hw_mape)<br/>rownames(hw_mape) &lt;- c('Holt-Winters')<br/>hw_mape</span><span id="5bb2" class="ln lo it lj b gy lt lq l lr ls">#&gt;              train_mape test_mape<br/>#&gt; Holt-Winters   3.800135  3.691772</span></pre><p id="9a8a" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">从上面的图和MAPE分数，我们实际上从霍尔特-温特斯模型得到了不错的结果，除了一些午餐后的工作时间。但是我们不能真的责怪这个模型，因为数据显示在这几个小时内模式不规则。</p><h2 id="9aaa" class="ln lo it bd na ov ow dn ne ox oy dp ni md oz pa nk mh pb pc nm ml pd pe no iz bi translated">萨里玛</h2><p id="cbff" class="pw-post-body-paragraph lu lv it lw b lx nq kd lz ma nr kg mc md ns mf mg mh nt mj mk ml nu mn mo mp im bi translated">使用SARIMA带来了一个复杂性:我们必须确定许多参数，并基于所选择的参数构建模型，假设数据是静态的。为了断言这个平稳假设，我们可以使用所谓的增广Dickey-Fuller假设检验(或简称为ADF检验)。</p><ul class=""><li id="f028" class="og oh it lw b lx ly ma mb md oi mh oj ml ok mp ou om on oo bi translated">H₀:数据不是静止的</li><li id="7303" class="og oh it lw b lx op ma oq md or mh os ml ot mp ou om on oo bi translated">H₁:数据是稳定的</li></ul><p id="8615" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">祝p值&lt; alpha (0.05) so that H₀ is rejected and the data is stationary.</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="fd37" class="ln lo it lj b gy lp lq l lr ls">adf.test(train)</span><span id="9303" class="ln lo it lj b gy lt lq l lr ls">#&gt; <br/>#&gt;  Augmented Dickey-Fuller Test<br/>#&gt; <br/>#&gt; data:  train<br/>#&gt; Dickey-Fuller = -4.9338, Lag order = 5, p-value = 0.01<br/>#&gt; alternative hypothesis: stationary</span><span id="6173" class="ln lo it lj b gy lt lq l lr ls">train %&gt;% <br/>  tsdisplay()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/a02ca48a99c6c6287baac9f19754d5d8.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ge318CE69as1IpT2KlYfIQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">Image by <a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><p id="0d20" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">根据上面的ADF测试，数据已经是稳定的。这并不奇怪，因为数据不会随着时间的推移而改变其统计属性，即均值和方差。我们可以在图上看到这一点:没有明显的趋势(所以平均值是恒定的),方差非常稳定。唯一剩下的是季节性，这是我们在建模之前必须处理的。为了做到这一点，让我们采取季节差异，这意味着一个简单的减法序列本身与滞后等于季节周期。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="6500" class="ln lo it lj b gy lp lq l lr ls">train %&gt;% <br/>  diff(lag = 24) %&gt;%<br/>  adf.test()</span><span id="a1fd" class="ln lo it lj b gy lt lq l lr ls">#&gt; <br/>#&gt;  Augmented Dickey-Fuller Test<br/>#&gt; <br/>#&gt; data:  .<br/>#&gt; Dickey-Fuller = -2.4897, Lag order = 5, p-value = 0.3719<br/>#&gt; alternative hypothesis: stationary</span><span id="c84b" class="ln lo it lj b gy lt lq l lr ls">train %&gt;% <br/>  diff(lag = 24) %&gt;%<br/>  tsdisplay()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/ccb68d978c98e95a2f487e4ac04e8239.png" data-original-src="https://miro.medium.com/v2/format:webp/1*5665Ifu1FF0RUOHpnxtd1g.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><p id="00d2" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">随着季节性的消失，数据变得非平稳(p值&gt; 0.05)。此外，ACF图仍然显示了许多明显的滞后。为了解决这个问题，我们将取第一个差值，用滞后1减去序列本身。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="6983" class="ln lo it lj b gy lp lq l lr ls">train %&gt;% <br/>  diff(lag = 24) %&gt;%<br/>  diff() %&gt;%<br/>  adf.test()</span><span id="7809" class="ln lo it lj b gy lt lq l lr ls">#&gt; <br/>#&gt;  Augmented Dickey-Fuller Test<br/>#&gt; <br/>#&gt; data:  .<br/>#&gt; Dickey-Fuller = -6.4821, Lag order = 5, p-value = 0.01<br/>#&gt; alternative hypothesis: stationary</span><span id="61de" class="ln lo it lj b gy lt lq l lr ls">train %&gt;% <br/>  diff(lag = 24) %&gt;%<br/>  diff() %&gt;%<br/>  tsdisplay()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/aa2f2a473b7a0e7ffbdf2904b6efb7e2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*ZHkGhxKo75GaRfSmtGehtQ.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片作者<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><p id="994a" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">现在我们开始工作了！我们来确定参数。</p><ol class=""><li id="47d9" class="og oh it lw b lx ly ma mb md oi mh oj ml ok mp ol om on oo bi translated">既然我们是做季节差一次，先差一次，那么<em class="ny"> d </em> = 1，<em class="ny"> D </em> = 1。</li><li id="71b8" class="og oh it lw b lx op ma oq md or mh os ml ot mp ol om on oo bi translated">从PACF和ACF图中，我们看到滞后3和4是显著的，因此<em class="ny"> p </em> = 3或4，<em class="ny"> q </em> = 3或4。</li><li id="63e8" class="og oh it lw b lx op ma oq md or mh os ml ot mp ol om on oo bi translated">从PACF图来看，滞后24和48是显著的，所以<em class="ny"> P </em> = 1或2。</li><li id="e36f" class="og oh it lw b lx op ma oq md or mh os ml ot mp ol om on oo bi translated">从ACF图来看，滞后24很重要，但滞后48不重要，因此<em class="ny"> Q </em> = 0或1。</li></ol><p id="306e" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">总而言之，</p><blockquote class="nv nw nx"><p id="bc8e" class="lu lv ny lw b lx ly kd lz ma mb kg mc nz me mf mg oa mi mj mk ob mm mn mo mp im bi translated">p = 3或4</p><p id="f64b" class="lu lv ny lw b lx ly kd lz ma mb kg mc nz me mf mg oa mi mj mk ob mm mn mo mp im bi translated">d = 1</p><p id="9df5" class="lu lv ny lw b lx ly kd lz ma mb kg mc nz me mf mg oa mi mj mk ob mm mn mo mp im bi translated">q = 3或4</p><p id="14e6" class="lu lv ny lw b lx ly kd lz ma mb kg mc nz me mf mg oa mi mj mk ob mm mn mo mp im bi translated">P = 1或2</p><p id="0a28" class="lu lv ny lw b lx ly kd lz ma mb kg mc nz me mf mg oa mi mj mk ob mm mn mo mp im bi translated">D = 1</p><p id="d774" class="lu lv ny lw b lx ly kd lz ma mb kg mc nz me mf mg oa mi mj mk ob mm mn mo mp im bi translated">Q = 0或1</p></blockquote><p id="3898" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">基于这些参数，我们将制作如下4个SARIMA模型。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="d41c" class="ln lo it lj b gy lp lq l lr ls">sarima1_model &lt;- Arima(y = train, order = c(4,1,4), seasonal = c(2,1,1))<br/>sarima2_model &lt;- Arima(y = train, order = c(4,1,4), seasonal = c(1,1,1))<br/>sarima3_model &lt;- Arima(y = train, order = c(3,1,3), seasonal = c(1,1,1))<br/>sarima4_model &lt;- Arima(y = train, order = c(3,1,3), seasonal = c(1,1,0))</span></pre><p id="3cd5" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">看一看每个模型的AIC。请记住，AIC是信息损失的一个衡量标准，这使得<code class="fe oc od oe lj b">sarima3_model</code>成为目前最好的衡量标准。然而，较低的AIC并不意味着模型在数据集<code class="fe oc od oe lj b">test</code>上表现更好。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="8b41" class="ln lo it lj b gy lp lq l lr ls">sarima1_model$aic</span><span id="618d" class="ln lo it lj b gy lt lq l lr ls">#&gt; [1] 3383.505</span><span id="de15" class="ln lo it lj b gy lt lq l lr ls">sarima2_model$aic</span><span id="0185" class="ln lo it lj b gy lt lq l lr ls">#&gt; [1] 3382.48</span><span id="7433" class="ln lo it lj b gy lt lq l lr ls">sarima3_model$aic</span><span id="b903" class="ln lo it lj b gy lt lq l lr ls">#&gt; [1] 3379.964</span><span id="32b3" class="ln lo it lj b gy lt lq l lr ls">sarima4_model$aic</span><span id="4745" class="ln lo it lj b gy lt lq l lr ls">#&gt; [1] 3410.026</span></pre><p id="60b6" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">和以前一样，预测时间…</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="a886" class="ln lo it lj b gy lp lq l lr ls">sarima1_forecast &lt;- forecast(sarima1_model, h = test_num)<br/>sarima2_forecast &lt;- forecast(sarima2_model, h = test_num)<br/>sarima3_forecast &lt;- forecast(sarima3_model, h = test_num)<br/>sarima4_forecast &lt;- forecast(sarima4_model, h = test_num)</span></pre><p id="eeba" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">…和情节。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="1c49" class="ln lo it lj b gy lp lq l lr ls">train %&gt;% <br/>  autoplot(series = "train") +<br/>  autolayer(test, series = "test") +<br/>  autolayer(sarima1_model$fitted, series = "fitted") +<br/>  autolayer(sarima1_forecast$mean, series = "forecast") +<br/>  ggtitle("ARIMA(4,1,4)(2,1,1)[24] Prediction")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/e0d421b71a40912511bf59634d7160e0.png" data-original-src="https://miro.medium.com/v2/format:webp/1*tyBGg_kD4BpgxgJ0Ak-W2A.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="efba" class="ln lo it lj b gy lp lq l lr ls">train %&gt;% <br/>  autoplot(series = "train") +<br/>  autolayer(test, series = "test") +<br/>  autolayer(sarima2_model$fitted, series = "fitted") +<br/>  autolayer(sarima2_forecast$mean, series = "forecast") +<br/>  ggtitle("ARIMA(4,1,4)(1,1,1)[24] Prediction")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/ef4a81fc809a34dbb0dcdbeb158eb4b9.png" data-original-src="https://miro.medium.com/v2/format:webp/1*TMv7iS0VmP3Rulh6GzCjcA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片作者<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="1913" class="ln lo it lj b gy lp lq l lr ls">train %&gt;% <br/>  autoplot(series = "train") +<br/>  autolayer(test, series = "test") +<br/>  autolayer(sarima3_model$fitted, series = "fitted") +<br/>  autolayer(sarima3_forecast$mean, series = "forecast") +<br/>  ggtitle("ARIMA(3,1,3)(1,1,1)[24] Prediction")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/6e2b5f8a12e92fb2dbf61e986b234a61.png" data-original-src="https://miro.medium.com/v2/format:webp/1*h9rGXzjd-cptjA7YPa30iw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="47c6" class="ln lo it lj b gy lp lq l lr ls">train %&gt;% <br/>  autoplot(series = "train") +<br/>  autolayer(test, series = "test") +<br/>  autolayer(sarima4_model$fitted, series = "fitted") +<br/>  autolayer(sarima4_forecast$mean, series = "forecast") +<br/>  ggtitle("ARIMA(3,1,3)(1,1,0)[24] Prediction")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/153346b569179b5459c4208c652a2c59.png" data-original-src="https://miro.medium.com/v2/format:webp/1*BEAejiaHexXfho-rjOC-SA.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><p id="5e9d" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">这四种型号之间只有细微的差别。就像Holt-Winters一样，这些模型很难预测午餐后的工作时间，甚至无法预测12:00的第二个高峰。我们还可以看到<code class="fe oc od oe lj b">sarima4_model</code>在预测早晨时间方面是最好的。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="8ebb" class="ln lo it lj b gy lp lq l lr ls">train_mape &lt;- rbind(<br/>  'ARIMA(4,1,4)(2,1,1)[24]' = accuracy(sarima1_model)[, 'MAPE'],<br/>  'ARIMA(4,1,4)(1,1,1)[24]' = accuracy(sarima2_model)[, 'MAPE'],<br/>  'ARIMA(3,1,3)(1,1,1)[24]' = accuracy(sarima3_model)[, 'MAPE'],<br/>  'ARIMA(3,1,3)(1,1,0)[24]' = accuracy(sarima4_model)[, 'MAPE']<br/>)<br/><br/>test_mape &lt;- rbind(<br/>  accuracy(sarima1_forecast$mean, test)[, 'MAPE'],<br/>  accuracy(sarima2_forecast$mean, test)[, 'MAPE'],<br/>  accuracy(sarima3_forecast$mean, test)[, 'MAPE'],<br/>  accuracy(sarima4_forecast$mean, test)[, 'MAPE']<br/>)<br/><br/>sarima_mape &lt;- cbind(train_mape, test_mape)<br/>sarima_mape &lt;- as.data.frame(sarima_mape)<br/>colnames(sarima_mape) &lt;- c('train_mape', 'test_mape')<br/>result &lt;- rbind(hw_mape, sarima_mape)<br/>result</span><span id="f523" class="ln lo it lj b gy lt lq l lr ls">#&gt;                         train_mape test_mape<br/>#&gt; Holt-Winters              3.800135  3.691772<br/>#&gt; ARIMA(4,1,4)(2,1,1)[24]   2.628641  4.185137<br/>#&gt; ARIMA(4,1,4)(1,1,1)[24]   2.680071  4.013859<br/>#&gt; ARIMA(3,1,3)(1,1,1)[24]   2.711371  3.995025<br/>#&gt; ARIMA(3,1,3)(1,1,0)[24]   3.341027  3.758555</span></pre><p id="aba8" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">SARIMA的前三个模型在某种程度上表明过度拟合。另一方面，最后一个模型在<code class="fe oc od oe lj b">train</code>数据集上肯定比霍尔特-温特斯好，但在<code class="fe oc od oe lj b">test</code>数据集上比霍尔特-温特斯稍差。</p><h2 id="0f8b" class="ln lo it bd na ov ow dn ne ox oy dp ni md oz pa nk mh pb pc nm ml pd pe no iz bi translated">ARIMA汽车</h2><p id="bccf" class="pw-post-body-paragraph lu lv it lw b lx nq kd lz ma nr kg mc md ns mf mg mh nt mj mk ml nu mn mo mp im bi translated">我们实际上可以自动搜索萨里玛模型的参数。然而，结果并不总是比手动调谐更好，这里有一些运气参与。让我们开始吧。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="0eb9" class="ln lo it lj b gy lp lq l lr ls">auto_arima_model &lt;- auto.arima(train)<br/>auto_arima_model</span><span id="e31f" class="ln lo it lj b gy lt lq l lr ls">#&gt; Series: train <br/>#&gt; ARIMA(3,0,3)(1,1,0)[24] <br/>#&gt; <br/>#&gt; Coefficients:<br/>#&gt;          ar1      ar2     ar3      ma1     ma2      ma3     sar1<br/>#&gt;       1.5185  -1.0912  0.4706  -0.5546  0.6366  -0.3294  -0.3786<br/>#&gt; s.e.  0.2028   0.2050  0.1065   0.2012  0.1330   0.1084   0.0756<br/>#&gt; <br/>#&gt; sigma^2 estimated as 38627419:  log likelihood=-1705.08<br/>#&gt; AIC=3426.17   AICc=3427.07   BIC=3451.16</span></pre><p id="a874" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">我们得到了<code class="fe oc od oe lj b">ARIMA(3,0,3)(1,1,0)[24]</code>模型，它非常接近我们之前最好的SARIMA模型，唯一的差异是<em class="ny"> d </em>参数。这个新模型没有像早期过程建议的那样考虑1个滞后的差异。AIC也是迄今为止遇到的所有模型中最差的。然而，让我们继续下去，看看会发生什么。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="bf9c" class="ln lo it lj b gy lp lq l lr ls">auto_arima_forecast &lt;- forecast(auto_arima_model, h = test_num)</span><span id="d993" class="ln lo it lj b gy lt lq l lr ls">train %&gt;% <br/>  autoplot(series = "train") +<br/>  autolayer(test, series = "test") +<br/>  autolayer(auto_arima_model$fitted, series = "fitted") +<br/>  autolayer(auto_arima_forecast$mean, series = "forecast") + <br/>  ggtitle("Auto ARIMA Prediction")</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/b9a2bb909efe1a6a1e6f9016665312e3.png" data-original-src="https://miro.medium.com/v2/format:webp/1*lzZWuOY3xSJV1mZoWGgTUw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片作者<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="9940" class="ln lo it lj b gy lp lq l lr ls">auto_arima_mape &lt;- cbind(<br/>  'train_mape' = accuracy(auto_arima_model)[, 'MAPE'],<br/>  'test_mape' = accuracy(auto_arima_forecast$mean, test)[, 'MAPE']<br/>)<br/><br/>auto_arima_mape &lt;- as.data.frame(auto_arima_mape)<br/>rownames(auto_arima_mape) &lt;- c('Auto ARIMA')<br/>result &lt;- rbind(result, auto_arima_mape)<br/>result</span><span id="8256" class="ln lo it lj b gy lt lq l lr ls">#&gt;                         train_mape test_mape<br/>#&gt; Holt-Winters              3.800135  3.691772<br/>#&gt; ARIMA(4,1,4)(2,1,1)[24]   2.628641  4.185137<br/>#&gt; ARIMA(4,1,4)(1,1,1)[24]   2.680071  4.013859<br/>#&gt; ARIMA(3,1,3)(1,1,1)[24]   2.711371  3.995025<br/>#&gt; ARIMA(3,1,3)(1,1,0)[24]   3.341027  3.758555<br/>#&gt; Auto ARIMA                3.332454  2.890477</span></pre><p id="a70d" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">我们找到冠军了！不仅在<code class="fe oc od oe lj b">train</code>数据集上表现良好，而且自动ARIMA在<code class="fe oc od oe lj b">test</code>数据集上表现也非常好。这是迄今为止我们创造的最好的模型。</p><h1 id="3a4d" class="mz lo it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">假设</h1><p id="b23e" class="pw-post-body-paragraph lu lv it lw b lx nq kd lz ma nr kg mc md ns mf mg mh nt mj mk ml nu mn mo mp im bi translated">我们将只测试最佳模型(自动ARIMA)的假设。对时间序列数据的假设进行测试，以确定从建模中获得的残差是否足以解释趋势和季节性成分已经获取了尽可能多的信息。最佳模型是没有自相关残差且残差呈正态分布的模型。</p><h2 id="cb02" class="ln lo it bd na ov ow dn ne ox oy dp ni md oz pa nk mh pb pc nm ml pd pe no iz bi translated">非自相关残差</h2><p id="9066" class="pw-post-body-paragraph lu lv it lw b lx nq kd lz ma nr kg mc md ns mf mg mh nt mj mk ml nu mn mo mp im bi translated">如果残差是自相关的，那么仍然会留下一些信息，这些信息应该用于进一步改进模型。为了看到这一点，我们可以绘制ACF和PACF残差图，看看是否仍然有明显的滞后。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="4c96" class="ln lo it lj b gy lp lq l lr ls">auto_arima_model$residuals %&gt;% <br/>  tsdisplay()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/5c45df3af94ac6bfd244c748fc2654b2.png" data-original-src="https://miro.medium.com/v2/format:webp/1*D6NrxHcGrIn8MsmRddYl9g.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><p id="e720" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">正如我们所看到的，ACF和PACF图中没有明显的滞后。等等，实际上有一些:ACF图中的滞后42和PACF图中的滞后27。然而，这些滞后离现在太远，因此它们的意义可以忽略不计。</p><p id="c5b4" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">如果很难从图中检验这个假设，有一个更客观的方法:Box-Ljung检验。</p><ul class=""><li id="8014" class="og oh it lw b lx ly ma mb md oi mh oj ml ok mp ou om on oo bi translated">H0:残差没有自相关</li><li id="93e4" class="og oh it lw b lx op ma oq md or mh os ml ot mp ou om on oo bi translated">H1:残差具有自相关性</li></ul><p id="7e45" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">我们希望p值&gt;α(0.05)，以便H0不会被拒绝，并且残差没有自相关。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="6472" class="ln lo it lj b gy lp lq l lr ls">Box.test(auto_arima_model$residuals, type = "Ljung-Box")</span><span id="2fd0" class="ln lo it lj b gy lt lq l lr ls">#&gt; <br/>#&gt;  Box-Ljung test<br/>#&gt; <br/>#&gt; data:  auto_arima_model$residuals<br/>#&gt; X-squared = 0.044539, df = 1, p-value = 0.8329</span></pre><p id="6142" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">如我们所见，p值&gt; 0.05，这证实了之前从ACF和PACF图观察到的结果。</p><h2 id="8a5c" class="ln lo it bd na ov ow dn ne ox oy dp ni md oz pa nk mh pb pc nm ml pd pe no iz bi translated">正态分布残差</h2><p id="e480" class="pw-post-body-paragraph lu lv it lw b lx nq kd lz ma nr kg mc md ns mf mg mh nt mj mk ml nu mn mo mp im bi translated">为了验证这一点，我们可以从残差直方图中观察。它们正态分布在零附近吗？</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="679c" class="ln lo it lj b gy lp lq l lr ls">hist(auto_arima_model$residuals)</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="ab gu cl of"><img src="../Images/701436ce276b11cd74f889fcc0417d61.png" data-original-src="https://miro.medium.com/v2/format:webp/1*3GjYdq495hxLyadY6mmZ6g.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片由<a class="ae lh" href="https://dwiuzila.medium.com/" rel="noopener">作者</a></figcaption></figure><p id="d1eb" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">如果很难说，夏皮罗-维尔克测试永远是我们的朋友。</p><ul class=""><li id="574d" class="og oh it lw b lx ly ma mb md oi mh oj ml ok mp ou om on oo bi translated">H0:残差呈正态分布</li><li id="b69b" class="og oh it lw b lx op ma oq md or mh os ml ot mp ou om on oo bi translated">H1:残差不是正态分布的</li></ul><p id="025d" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">我们希望p值&gt;α(0.05)，这样H0不会被拒绝，并且残差是正态分布的。</p><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="2430" class="ln lo it lj b gy lp lq l lr ls">shapiro.test(auto_arima_model$residuals)</span><span id="aaa0" class="ln lo it lj b gy lt lq l lr ls">#&gt; <br/>#&gt;  Shapiro-Wilk normality test<br/>#&gt; <br/>#&gt; data:  auto_arima_model$residuals<br/>#&gt; W = 0.94388, p-value = 0.0000008032</span></pre><p id="4ca9" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">因为p值低于alpha (0.05)，所以拒绝H0。因此，残差不是正态分布的。</p><h1 id="8b69" class="mz lo it bd na nb nc nd ne nf ng nh ni ki nj kj nk kl nl km nm ko nn kp no np bi translated">结论</h1><pre class="ks kt ku kv gt li lj lk ll aw lm bi"><span id="4247" class="ln lo it lj b gy lp lq l lr ls">result</span><span id="590d" class="ln lo it lj b gy lt lq l lr ls">#&gt;                         train_mape test_mape<br/>#&gt; Holt-Winters              3.800135  3.691772<br/>#&gt; ARIMA(4,1,4)(2,1,1)[24]   2.628641  4.185137<br/>#&gt; ARIMA(4,1,4)(1,1,1)[24]   2.680071  4.013859<br/>#&gt; ARIMA(3,1,3)(1,1,1)[24]   2.711371  3.995025<br/>#&gt; ARIMA(3,1,3)(1,1,0)[24]   3.341027  3.758555<br/>#&gt; Auto ARIMA                3.332454  2.890477</span></pre><p id="dc37" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">我们已经在每小时的移动游戏广告数据集上实现了时间序列预测。由于数据集具有季节性，我们使用Holt-Winters和SARIMA模型。我们看到，参数为<code class="fe oc od oe lj b">ARIMA(3,0,3)(1,1,0)[24]</code>的自动ARIMA是最好的模型，在训练数据集上有3.33%的MAPE，在测试数据集上有2.89%的MAPE。然而，该模型违反了时间序列数据的正态分布残差假设。</p></div><div class="ab cl pf pg hx ph" role="separator"><span class="pi bw bk pj pk pl"/><span class="pi bw bk pj pk pl"/><span class="pi bw bk pj pk"/></div><div class="im in io ip iq"><p id="4a90" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated">嗨！感谢到达终点。这是我的“R中的数据科学”系列的第五篇文章。请为你好奇的头脑找到其他的:</p><div class="pm pn gp gr po"><div role="button" tabindex="0" class="ab bv gv cb fp pp pq bn pr lb ex"><div class="ps l"><div class="ab q"><div class="l di"><img alt="Albers Uzila" class="l de bw pt pu fe" src="../Images/b4f51438d99b29f789091dd239d7cfa6.png" width="20" height="20" loading="lazy" data-original-src="https://miro.medium.com/v2/resize:fill:40:40/1*WVCVz-tM5PW1TaWqnVXRLQ.jpeg"/><div class="fb bw l pt pu fc n aw fd"/></div><div class="hh l fo"><p class="bd b dl z fp fq fr fs ft fu fv fw dk translated"><a class="ae af ag ah ai aj ak al am an ao ap aq ar as" href="https://dwiuzila.medium.com/?source=post_page-----70d42062109f--------------------------------" rel="noopener follow" target="_top">艾伯斯·乌兹拉</a></p></div></div><div class="px py gw l"><h2 class="bd jd vc og fp vd fr fs ve fu fw jc bi translated">R中的数据科学</h2></div><div class="ab q"><div class="l fo"><a class="bd b be z bi vf au vg vh vi rs vj an eh ei vk vl vm el em eo de bk ep" href="https://dwiuzila.medium.com/list/data-science-in-r-0a8179814b50?source=post_page-----70d42062109f--------------------------------" rel="noopener follow" target="_top">View list</a></div><div class="vn l fo"><span class="bd b dl z dk">7 stories</span></div></div></div><div class="qk dh ql fp ab qm fo di"><div class="di qc bv qd qe"><div class="dh l"><img alt="" class="dh" src="../Images/e52e43bf7f22bfc0889cc794dcf734dd.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*10B3radiyQGAp-QA"/></div></div><div class="di qc bv qf qg qh"><div class="dh l"><img alt="" class="dh" src="../Images/945fa9100c2a00b46f8aca3d3975f288.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*o6A863Vdwq7ThlmW"/></div></div><div class="di bv qi qj qh"><div class="dh l"><img alt="" class="dh" src="../Images/3ca9e4b148297dbc4e7da0a180cf9c99.png" width="194" height="194" loading="lazy" role="presentation" data-original-src="https://miro.medium.com/v2/resize:fill:388:388/0*ekmX89TW6N8Bi8bL"/></div></div></div></div></div><p id="b2fc" class="pw-post-body-paragraph lu lv it lw b lx ly kd lz ma mb kg mc md me mf mg mh mi mj mk ml mm mn mo mp im bi translated"><em class="ny">如果想支持我写作，可以考虑</em> <a class="ae lh" href="https://dwiuzila.medium.com/membership" rel="noopener"> <strong class="lw jd"> <em class="ny">成为中等会员</em> </strong> </a> <em class="ny">。每月只需5美元，你就可以阅读Medium上的所有报道。你的会员费直接支持我和你看的其他作家。</em></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><a href="https://dwiuzila.medium.com/membership"><div class="gh gi qq"><img src="../Images/f767019309a71e9b3b70d2f9b1016aad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q_dzEmnimgItuotIZ-y73A.png"/></div></a></figure></div></div>    
</body>
</html>