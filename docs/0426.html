<html>
<head>
<title>Data Visualisation using Pandas and Plotly</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Pandas和Plotly实现数据可视化</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/data-visualisation-using-pandas-and-plotly-970df88fba6f?source=collection_archive---------0-----------------------#2020-04-23">https://pub.towardsai.net/data-visualisation-using-pandas-and-plotly-970df88fba6f?source=collection_archive---------0-----------------------#2020-04-23</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="4161" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-science" rel="noopener ugc nofollow" target="_blank">数据科学</a>，<a class="ae ep" href="https://towardsai.net/p/category/data-visualization" rel="noopener ugc nofollow" target="_blank">数据可视化</a></h2><div class=""/><figure class="gl gn ka kb kc kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi jz"><img src="../Images/c15ad6ae48c4d056f56c28d891ffd0a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GavfS8hlVeD5E4P6jOA3Xg.jpeg"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">来源— Dribbble</figcaption></figure><p id="e128" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">让我们假设你正试图说服一个客户投资你的公司。您以excel表格的形式展示所有员工的记录及其成就，而不是条形图或饼图。想象你站在客户的角度。你会有什么反应？(数据多了不会这么铺天盖地吗？).这就是数据可视化发挥作用的地方。</p><p id="e44e" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">数据可视化是指将原始数据转换成可视化的图形和图表，以使人类大脑更容易理解。主要目标是使研究和数据分析更快，并有效地传达趋势和模式。</p><blockquote class="lm ln lo"><p id="ad87" class="ko kp lp kq b kr ks kt ku kv kw kx ky lq la lb lc lr le lf lg ls li lj lk ll im bi translated">与冗长的纯文本相比，人脑对视觉上吸引人的数据的理解能力更强。</p></blockquote><p id="d738" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在本文中，让我们获取一个数据集，根据需要清理数据，并尝试可视化数据。数据集取自Kaggle。这里可以找到<a class="ae lt" href="https://www.kaggle.com/sudalairajkumar/covid19-in-india" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="fafa" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">首先，为了从外部源加载数据并清理它，我们将使用Pandas库。你可以在我之前的文章<a class="ae lt" href="https://medium.com/towards-artificial-intelligence/introduction-to-the-pandas-library-4e00f07fc18" rel="noopener">这里</a>研究更多关于熊猫的内容。</p><p id="13c4" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">为了使用它，我们需要导入Pandas库。我们可以用它来导入。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="e2f9" class="md me it lz b gy mf mg l mh mi">import pandas as pd</span></pre><p id="4184" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">让我们加载取自Kaggle的CSV文件，尝试了解更多。</p><figure class="lu lv lw lx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mj"><img src="../Images/87d38440b315ca2cd52fe1fe3389ef65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wd1Dyfllm7nyAO7B3ncLgA.png"/></div></div></figure><p id="3264" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">我们可以理解数据集总共有9列。日期和时间列表示最后更新的日期和时间。我们不打算使用ConfirmedIndianNational和ConfirmedForeignNational列。因此，让我们删除这两列。时间栏也无关紧要。让我们也放弃吧。由于数据帧已经有了索引，因此也不需要序列号(Sno)列。</p><figure class="lu lv lw lx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mk"><img src="../Images/ed9b50b3ffcd1c365b2eece08d5a5c9e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yfebIKyO_wGooGPSJmcMLw.png"/></div></div></figure><p id="313b" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">马上，我们可以看到数据帧只有5列。丢弃冗余数据是一个很好的做法，因为保留冗余数据会占用不必要的空间，并且可能会使运行时陷入停滞。</p><p id="eef7" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在这里，Kaggle数据集每天更新。追加新数据，而不是覆盖现有数据。例如，4月13日数据集有925行，每行代表一个特定州的累积数据。但是在4月14日，数据集有958行，这意味着4月14日追加了34个新行(因为数据集中总共有34个不同的州)。</p><figure class="lu lv lw lx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ml"><img src="../Images/6392a6b26bb36b0dc3528c2a096b9dcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M39WD5ALup8DIWn3DoCbqQ.png"/></div></div></figure><p id="a27a" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在上图中，您可以注意到相同的状态名称，但请尝试观察其他列中的变化。每天都有新病例的数据被添加到数据集中。这种形式的数据有助于了解传播趋势。就像-</p><ol class=""><li id="8dde" class="mm mn it kq b kr ks kv kw kz mo ld mp lh mq ll mr ms mt mu bi translated">随着时间的推移病例数量的增加。</li><li id="be9a" class="mm mn it kq b kr mv kv mw kz mx ld my lh mz ll mr ms mt mu bi translated">执行时间序列分析</li></ol><p id="0925" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">但是我们只对分析最新的数据感兴趣，而不考虑以前的数据。因此，让我们删除那些不需要的行。</p><p id="cf8c" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">首先，让我们按日期降序排列数据。并通过使用州名对数据进行分组来消除重复值。</p><figure class="lu lv lw lx gt kd gh gi paragraph-image"><div class="gh gi na"><img src="../Images/c34e87bc5f7201e4165b33a1dbd34968.png" data-original-src="https://miro.medium.com/v2/resize:fit:1342/format:webp/1*9Lc_bWe6dpjZRIoGKysZ0Q.png"/></div></figure><p id="635c" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您可以看到df_states数据框只有30行，这意味着有一个唯一的行显示每个州的最新统计信息。当我们使用日期列对数据框进行排序时，我们将根据日期以降序对数据框进行排序(注意，在代码中ascending = False ), remove _ duplicates存储第一次出现的值，并删除所有重复出现的值。</p><figure class="lu lv lw lx gt kd gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/aea2bd4a1eeecd2aa21d6084babbd540.png" data-original-src="https://miro.medium.com/v2/resize:fit:1398/format:webp/1*Zc3sAGtyMjv1-gsAZOtzHA.png"/></div></figure></div><div class="ab cl nc nd hx ne" role="separator"><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh ni"/><span class="nf bw bk ng nh"/></div><div class="im in io ip iq"><p id="1c67" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">现在让我们来谈谈数据可视化。我们将使用Plotly来可视化上面的数据框。</p><p id="fbd7" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">直方图、条形图、散点图能有效地解释模式和趋势，但由于我们处理的是地理数据，我更喜欢choropleth图。</p><p id="51ef" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated"><strong class="kq jd">什么是Choropleth地图？</strong></p><p id="ae3f" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">根据Plotly的说法，Choropleth地图描绘了划分的地理区域，这些地理区域相对于数据变量而言是有颜色或阴影的。这些地图提供了一种快速简单的方法来显示一个地理区域的价值，也揭示了趋势和模式。</p><figure class="lu lv lw lx gt kd gh gi paragraph-image"><div class="gh gi nj"><img src="../Images/843f997f9a5b2b3e2377696f538505d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1206/format:webp/1*Q4Rvnix3KEA_IV1ovWjOFQ.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">来源——Youtube</figcaption></figure><p id="65b2" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在上图中，区域根据人口密度进行着色。颜色越深意味着该地区的人口越多。现在关于我们的数据集，我们也将基于确诊病例创建一个choropleth图。确诊病例越多，特定区域的颜色越深。</p><p id="dd50" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">要呈现一幅印度地图，我们需要一个带有州坐标的shapefile。我们可以在这里下载印度<a class="ae lt" href="https://www.igismap.com/download-india-boundary-shapefile-free-states-boundary-assembly-constituencies-village-boundaries/" rel="noopener ugc nofollow" target="_blank">的shapefile。</a></p><blockquote class="lm ln lo"><p id="cd16" class="ko kp lp kq b kr ks kt ku kv kw kx ky lq la lb lc lr le lf lg ls li lj lk ll im bi translated">根据维基百科的说法，<strong class="kq jd"> shapefile </strong>格式是地理信息系统(GIS)的地理空间矢量数据格式。</p></blockquote><p id="bdb8" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">在使用shapefiles之前，我们需要安装GeoPandas，这是一个python包，可以轻松处理地理空间数据。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="6a88" class="md me it lz b gy mf mg l mh mi">pip install geopandas<br/>import geopandas as gpd</span></pre><figure class="lu lv lw lx gt kd gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/b611f786e1905bb0df98b937e33494dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*WRA2DbKVrCom34mc6ayrTA.png"/></div></figure><p id="5cae" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">您可以看到数据框有一个州名及其矢量形式的坐标。现在我们将把这个shapefile转换成所需的<strong class="kq jd"> JSON </strong>格式。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="29c2" class="md me it lz b gy mf mg l mh mi">import json</span><span id="5c16" class="md me it lz b gy nl mg l mh mi">#Read data to json.</span><span id="283c" class="md me it lz b gy nl mg l mh mi">merged_json = json.loads(map_df.to_json())</span></pre><p id="b65d" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">接下来，我们将使用Plotly Express创建Choropleth地图。<code class="fe nm nn no lz b">px.choropleth</code>功能。制作choropleth地图需要几何信息。</p><ol class=""><li id="fafd" class="mm mn it kq b kr ks kv kw kz mo ld mp lh mq ll mr ms mt mu bi translated">这可以是以GeoJSON格式(我们在上面创建的)提供的，其中每个要素都有一个唯一的标识值(就像我们例子中的st_nm)</li></ol><p id="64c1" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">2.Plotly中包含美国各州和世界各国的现有几何图形</p><p id="5cdd" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">GeoJSON数据，即(我们上面创建的merged_json)被传递给<code class="fe nm nn no lz b">geojson</code>参数，测量的度量被传递给<code class="fe nm nn no lz b">px.choropleth.</code>的<code class="fe nm nn no lz b">color</code>参数</p><p id="c8ce" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">每个choropleth地图都有一个<code class="fe nm nn no lz b">locations</code>参数，它将州/国家作为参数。因为我们正在为印度的不同邦创建choropleth地图，所以我们将State列传递给参数。</p><pre class="lu lv lw lx gt ly lz ma mb aw mc bi"><span id="07ad" class="md me it lz b gy mf mg l mh mi">fig = px.choropleth(df_states, <br/>                    geojson=merged_json, <br/>                    color="Confirmed", <br/>                    locations="State/UnionTerritory", <br/>                    featureidkey="properties.st_nm",<br/>                    color_continuous_scale  = ["#ffffb2","#fecc5c","#fd8d3c","#f03b20","#bd0026"],<br/>                    projection="mercator"<br/>)</span><span id="0e81" class="md me it lz b gy nl mg l mh mi">fig.update_geos(fitbounds="locations", visible=False)</span><span id="b8d8" class="md me it lz b gy nl mg l mh mi">fig.update_layout(margin={"r":0,"t":0,"l":0,"b":0})</span><span id="489b" class="md me it lz b gy nl mg l mh mi">fig.show()</span></pre><p id="5086" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">第一个参数是数据框本身，颜色将根据确认的值而变化。我们将<code class="fe nm nn no lz b">fig.updtae_geos()</code>中的<code class="fe nm nn no lz b">visible</code>参数设置为假，以隐藏底图和框架。我们还设置了<code class="fe nm nn no lz b">fitbounds = "locations"</code>来自动缩放世界地图以显示我们感兴趣的区域。</p><figure class="lu lv lw lx gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi np"><img src="../Images/673726942de77986c2e1ea66284162e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KSFCFzA3wRge3sNzoF8nNg.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">我们可以在各州之间盘旋，以了解更多关于它们的信息。</figcaption></figure><p id="e0ed" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">你可以在Github <a class="ae lt" href="https://github.com/kurasaiteja/Data-Visualisation" rel="noopener ugc nofollow" target="_blank">这里查看完整代码。</a></p><p id="473c" class="pw-post-body-paragraph ko kp it kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll im bi translated">数据可视化是一门被高度低估的艺术。希望您已经掌握了一些在实时可视化数据时会有所帮助的概念。请随时分享您的反馈和回应。如果你今天学到了新东西，请举手。</p></div></div>    
</body>
</html>