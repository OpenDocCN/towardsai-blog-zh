<html>
<head>
<title>An Illustrated Explanation Of How Rasa’s AugmentedMemoization Policy Works</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rasa的强化成员化政策如何运作的图解说明</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/an-illustrated-explanation-of-how-rasas-augmentedmemoization-policy-works-da436aa20cff?source=collection_archive---------2-----------------------#2021-08-24">https://pub.towardsai.net/an-illustrated-explanation-of-how-rasas-augmentedmemoization-policy-works-da436aa20cff?source=collection_archive---------2-----------------------#2021-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="6e78" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/nlp" rel="noopener ugc nofollow" target="_blank">自然语言处理</a></h2><div class=""/><figure class="gl gn ka kb kc kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi jz"><img src="../Images/75acd5823caaa3e7c622a89c2f8e7564.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a42M9k3PJReSbX55zQgRvQ.png"/></div></div></figure><h1 id="8c87" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">介绍</h1><p id="6c31" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">在这篇文章中，我将解释Rasa的<a class="ae mg" href="https://rasa.com/docs/rasa/policies/#augmented-memoization-policy" rel="noopener ugc nofollow" target="_blank">增强记忆</a>政策是如何运作的。重点将放在理解“遗忘机制”是如何实现的。</p><p id="3665" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">我假设读者熟悉使用Rasa构建聊天机器人以及<a class="ae mg" href="https://en.wikipedia.org/wiki/Memoization" rel="noopener ugc nofollow" target="_blank">记忆化</a>的概念。如果不是这样，那么<a class="ae mg" href="https://www.youtube.com/playlist?list=PL75e0qA87dlEjGAc9j9v3a5h1mxI2Z9fi" rel="noopener ugc nofollow" target="_blank">在youtube上观看这些系列视频</a>来快速跟上进度。</p><p id="0e98" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">重现本文所述结果的代码可以在<a class="ae mg" href="https://github.com/hsm207/rasa_moodbot/tree/memo" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h1 id="8db9" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">设置</h1><p id="93a6" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">让我们首先回顾一下与增强的成员化策略相关的bot实现细节。</p><h2 id="0732" class="mm kl it bd km mn mo dn kq mp mq dp ku lt mr ms ky lx mt mu lc mb mv mw lg iz bi translated">发展环境</h2><p id="43e4" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">这个机器人是用这个版本的Rasa构建的:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi mx"><img src="../Images/c756ebd3443efcac2d007e5015601388.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tHNEHiNk6KKf9uopRjfiVg.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图1:用于构建机器人的Rasa版本</figcaption></figure><h2 id="1d90" class="mm kl it bd km mn mo dn kq mp mq dp ku lt mr ms ky lx mt mu lc mb mv mw lg iz bi translated">核心网模型</h2><p id="664e" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">该机器人的策略配置非常简单:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/e80596888992997c92e338284c4137ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1340/format:webp/1*Bn-XsaRz4J6AHn_JO4OCUQ.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图config.yml中的策略部分</figcaption></figure><h2 id="df6f" class="mm kl it bd km mn mo dn kq mp mq dp ku lt mr ms ky lx mt mu lc mb mv mw lg iz bi translated">培训故事</h2><p id="8fa2" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">我们将根据这两个故事训练机器人:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/7a0f5f79c5d24edd0c66b5dbaae9ba7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*dopw4Sx1r6d44nycGrYeTA.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图3:培训故事</figcaption></figure><h2 id="85fb" class="mm kl it bd km mn mo dn kq mp mq dp ku lt mr ms ky lx mt mu lc mb mv mw lg iz bi translated">测试故事</h2><p id="4935" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">这些是我们将用来评估对话管理模式的测试案例:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/4cbacc005ed92da064d58b46d436927c.png" data-original-src="https://miro.medium.com/v2/resize:fit:892/format:webp/1*vu28XiBrsu43iRf5XSQncg.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图4:测试案例</figcaption></figure><p id="3284" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">请注意，<code class="fe nj nk nl nm b">test story 1</code>与图3中的故事<code class="fe nj nk nl nm b">happy path</code>相同。</p><p id="80f4" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated"><code class="fe nj nk nl nm b">test story 2</code>与<code class="fe nj nk nl nm b">sad path 1</code>故事相同，除了最后一个回合，即<code class="fe nj nk nl nm b">test story 2</code>是<code class="fe nj nk nl nm b">sad path 1</code>的扩展，用户通过发出<code class="fe nj nk nl nm b">bye-bye!</code>继续对话，机器人预计会用<code class="fe nj nk nl nm b">utter_goodbye</code>回应。</p><h1 id="bc66" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">记忆是如何工作的</h1><p id="98f1" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">我们需要先了解记忆是如何工作的，然后才能理解遗忘机制是如何工作的。</p><h2 id="682d" class="mm kl it bd km mn mo dn kq mp mq dp ku lt mr ms ky lx mt mu lc mb mv mw lg iz bi translated">代表一个故事</h2><p id="e0be" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">鉴于这个故事:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/6f14754b56ddb9903aa69c8a5531df94.png" data-original-src="https://miro.medium.com/v2/resize:fit:832/format:webp/1*Xszaau1caCXWy95YeNt72w.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图5:演示记忆化过程的yaml格式的故事</figcaption></figure><p id="7012" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">Rasa将在其<a class="ae mg" href="https://rasa.com/docs/rasa/tracker-stores" rel="noopener ugc nofollow" target="_blank">追踪器</a>中将其转换为以下事件序列:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi no"><img src="../Images/228f76fe533e05e76b203bce5b4fe99e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*HXq4WXeEmNquRPo-A6ycmA.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图6:图5中故事的跟踪器表示</figcaption></figure><p id="6d4f" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">请注意，图5中的故事有4个步骤，但追踪器中的相同故事有7个步骤，因为在故事的开始、意图之前和最后一个动作之后添加了<code class="fe nj nk nl nm b">action_listen</code>“步骤”。</p><h2 id="1d82" class="mm kl it bd km mn mo dn kq mp mq dp ku lt mr ms ky lx mt mu lc mb mv mw lg iz bi translated">根据故事构建要素和标签</h2><p id="a718" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">一个<a class="ae mg" href="https://rasa.com/docs/rasa/policies/" rel="noopener ugc nofollow" target="_blank">策略</a>的目标是预测机器人应该采取的下一步行动，给定到目前为止在对话中发生的事情。</p><p id="6c1f" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">在训练期间，每当在故事的跟踪器表示中发现一个<code class="fe nj nk nl nm b">ActionExecuted</code>事件时，将要求一个策略进行预测。这意味着对于图6中的故事，策略将被要求在步骤1、步骤3、步骤4、步骤6和步骤7进行预测。</p><p id="a965" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">策略将用于在相应步骤进行预测的特征是到该点为止的事件序列。标签是要执行的操作的名称。</p><p id="73a1" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">这些是将用于为每个步骤训练策略的功能和标签:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi np"><img src="../Images/f079b6b31fe6ea068954efafea441469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5BY92tbhiwC70ZDPgrSigQ.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图7:使用图6中的故事来训练策略的特性和标签</figcaption></figure><p id="3012" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">在步骤1中，对话刚刚开始，因此还没有交互。这就是为什么特征是空的，即<code class="fe nj nk nl nm b">{}</code>。</p><p id="c04b" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">构成一个步骤的特征是在最后一次预测中使用的特征，以及在紧接它之前的步骤中添加的最新动作和意图。</p><p id="5008" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">例如，考虑步骤6中用于预测<code class="fe nj nk nl nm b">utter_cheer_up</code>的特性。</p><p id="3cac" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">步骤5是紧接在它之前的步骤。在这一步，机器人的最新动作和用户的最新意图分别是<code class="fe nj nk nl nm b">action_listen</code>和<code class="fe nj nk nl nm b">mood_unhappy</code>。</p><p id="a384" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">需要预测的最后一步是步骤4。</p><p id="94c4" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">因此，用于在步骤6预测<code class="fe nj nk nl nm b">utter_cheer_up</code>的特征将是步骤4中使用的特征和我们从步骤5中导出的特征。</p><p id="e626" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">注意:图5中的故事非常简单。请参考附录I，了解如何突出带有位置和实体的故事。附录II显示了<code class="fe nj nk nl nm b">max_history</code>参数如何影响特征化。</p><h2 id="bf62" class="mm kl it bd km mn mo dn kq mp mq dp ku lt mr ms ky lx mt mu lc mb mv mw lg iz bi translated">“培训”记忆策略</h2><p id="eb69" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">记忆策略上下文中的训练意味着散列步骤1、3、4、6和7中的特征序列，并将其用作存储在字典中的密钥。键的值是标签。</p><p id="6a2f" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">让我们把这本字典叫做查找表。</p><p id="1da2" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">下面是根据图3中的故事训练后的查找表:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nq"><img src="../Images/310745442afb0fa90f9efc5f8ee5feab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zbHAOSS2L98agvzEIZYnjQ.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图8:基于图3中训练故事的查找表</figcaption></figure><h2 id="1f11" class="mm kl it bd km mn mo dn kq mp mq dp ku lt mr ms ky lx mt mu lc mb mv mw lg iz bi translated">推理时的记忆策略</h2><p id="6e59" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">在推理时，如果需要预测，记忆策略将散列当前跟踪器的状态，并尝试将其与查找表匹配。</p><p id="40c7" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">如果找到匹配，则返回对应于该散列键的值作为预测的下一个动作。</p><p id="0b50" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">例如，考虑机器人预计预测<code class="fe nj nk nl nm b">utter_cheer_up</code>时的<code class="fe nj nk nl nm b">test story 2</code>:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/dc32cbe4096f4cc09a234bc362c3ea61.png" data-original-src="https://miro.medium.com/v2/resize:fit:808/format:webp/1*alpaMOnLa_sa53alVSymDg.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图9:测试故事2片段</figcaption></figure><p id="5232" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">在对话的这一点上，跟踪器的当前状态如下所示(通过在调试模式下运行rasa shell获得):</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ns"><img src="../Images/423c305529fd7b27f9cd716b8078b3ea.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hxtX4Zq5YB0JfUzl70Irqw.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图10:当机器人将要预测“欢呼雀跃”时的对话状态</figcaption></figure><p id="920d" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">不难看出，图10中当前的跟踪器状态与为<code class="fe nj nk nl nm b">sad path 1</code>故事的步骤6创建的特性是相同的(参见图7)。因此，记忆策略将预测<code class="fe nj nk nl nm b">utter_cheer_up</code>，因为这是分配给该特定特征序列的标签。</p><h1 id="6638" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">遗忘机制是如何工作的</h1><p id="18e7" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">现在让我们考虑当用户的意图是<code class="fe nj nk nl nm b">test story 2</code>中的<code class="fe nj nk nl nm b">goodbye</code>之后，机器人被要求做出预测时会发生什么。为了方便起见，下面是整个故事:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/c4b9737af04df9469d6760ce4badaede.png" data-original-src="https://miro.medium.com/v2/resize:fit:848/format:webp/1*qX9UwbiiY8-lxjVLRdF_MQ.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图11:整个测试故事2</figcaption></figure><p id="3f04" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">机器人应该预测<code class="fe nj nk nl nm b">utter_goodbye</code>时的对话状态如下所示:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nt"><img src="../Images/fdcd75a4e9471af2c45a5df6cba55e30.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7VOtEY3koB_MJnbLJFNN-A.png"/></div></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图12:当机器人被期望预测“绝对再见”时的对话状态</figcaption></figure><p id="a8b0" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">图12中的会话状态与查找表中存储的任何状态都不匹配。这意味着机器人将不得不“忘记”跟踪器中的一些元素，以便在查找表中找到匹配。</p><h2 id="0492" class="mm kl it bd km mn mo dn kq mp mq dp ku lt mr ms ky lx mt mu lc mb mv mw lg iz bi translated">概观</h2><p id="ace0" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">遗忘机制分两个阶段发生。</p><p id="e98a" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">在第一阶段:</p><ol class=""><li id="16a8" class="nu nv it lk b ll mh lp mi lt nw lx nx mb ny mf nz oa ob oc bi translated">从当前跟踪器产生一个<a class="ae mg" href="https://github.com/RasaHQ/rasa/blob/44c23484c2187b6f88cc1c733dcc59f48e291525/rasa/shared/core/trackers.py#L467" rel="noopener ugc nofollow" target="_blank">应用事件</a>的列表</li><li id="7734" class="nu nv it lk b ll od lp oe lt of lx og mb oh mf nz oa ob oc bi translated">从第一个<code class="fe nj nk nl nm b">ActionExecuted</code>事件开始减少列表</li><li id="2ca5" class="nu nv it lk b ll od lp oe lt of lx og mb oh mf nz oa ob oc bi translated">基于步骤2中的事件列表生成新的对话状态</li><li id="f25d" class="nu nv it lk b ll od lp oe lt of lx og mb oh mf nz oa ob oc bi translated">将步骤2中创建的会话状态与查找表匹配</li><li id="8569" class="nu nv it lk b ll od lp oe lt of lx og mb oh mf nz oa ob oc bi translated">如果找不到匹配，则进入第2阶段</li></ol><p id="a490" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">阶段2与阶段1相同，除了事件列表从第二次出现<code class="fe nj nk nl nm b">ActionExecuted</code>事件开始减少。我们重复阶段2的过程，直到事件列表为空。</p><h2 id="953a" class="mm kl it bd km mn mo dn kq mp mq dp ku lt mr ms ky lx mt mu lc mb mv mw lg iz bi translated">细节</h2><p id="4ad4" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">回到<code class="fe nj nk nl nm b">test story 2</code>的例子，在机器人需要预测<code class="fe nj nk nl nm b">utter_goodbye</code>的时候应用的事件是:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi no"><img src="../Images/be6eaa3d136a23e60680120d0562f5e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*BICTv_ES7QD1rFtD4x6LMA.png"/></div></figure><p id="d3e3" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">按照阶段1的程序，我们从第一次出现<code class="fe nj nk nl nm b">ActionExecuted</code>事件开始，通过选择截断来缩短列表。这对应的是<code class="fe nj nk nl nm b">Step 1: ActionExecuted, action, action_listen</code>。新的事件列表现在看起来像这样(是的，事件列表仍然是相同的，但这通常不是真的):</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi oi"><img src="../Images/7b4b0de3cdebadd6db3936900e9bdf92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1204/format:webp/1*uStirOUOT1W6RT9nZpilWw.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图13:在阶段1结束时更新的应用事件列表</figcaption></figure><p id="0235" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">新列表将生成以下对话状态:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi oj"><img src="../Images/b025f355061f5a083dffe9862205d8da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rYqtKSLwDXOZdEgFxIWY4A.png"/></div></div></figure><p id="ccbe" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">这与图12中的对话状态相同，我们已经知道它与查找表不匹配。所以我们进入了第二阶段。</p><p id="8fe2" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">现在，我们需要从第二次出现的<code class="fe nj nk nl nm b">ActionExecuted</code>事件开始截断当前应用的事件列表。参见图13，这对应于<code class="fe nj nk nl nm b">Step 3: ActionExecuted, action, utter_greet</code>，因此新列表为:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi no"><img src="../Images/fa06db805e840b6c399430fe9b10f450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*w40ZiThfqkRRBdOVggW9Sg.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图14:在阶段2的第一次迭代结束时更新的列表</figcaption></figure><p id="5ba6" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">这会产生以下对话状态:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ok"><img src="../Images/5b016624658e23e9f44fc2441429462c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KJ4KHjbh0HSaVa870CqJ5g.png"/></div></div></figure><p id="ccda" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">这仍然与查找表不匹配。</p><p id="2df6" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">因此，我们基于图14中的列表再次重复阶段2。这给出了:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi ol"><img src="../Images/10c2dd746e8fe29c6575a33c40aadba9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*qG4EV-4mwyiZ1wZXSzqY2Q.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图15:在阶段2的第二次迭代中更新的列表</figcaption></figure><p id="79a0" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">这会产生以下对话状态:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi om"><img src="../Images/067eade7e15e816a304fb8dfa655b3c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*POElzQFgLxXq3_o_S9zkag.png"/></div></div></figure><p id="f8b9" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">这仍然与查找表不匹配。</p><p id="29b7" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">所以我们继续按照同样的模式重复第二阶段。</p><p id="9fc7" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">最终，应用事件的列表将缩短为:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi on"><img src="../Images/6879d621adae34a56b07b235dce29f8a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*fFlBzQH7GrzKLglbf7iF4g.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图16:在阶段2的最后一次迭代中更新的列表</figcaption></figure><p id="4749" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">这会产生以下对话状态:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi oo"><img src="../Images/362f0480b9ff112193092dc3b3895468.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xnd6I3NDLkmHfLJ-NhroEQ.png"/></div></div></figure><p id="27f4" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">如果此对话状态不匹配，则AugmentedMemoizationPolicy将无法做出预测，因为没有第二次出现<code class="fe nj nk nl nm b">ActionExecuted</code>事件，从而产生一个更短的列表来继续阶段2过程。</p><h1 id="c4b8" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">解决方案</h1><p id="16a0" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">有没有不修改bot的config.yml就能通过<code class="fe nj nk nl nm b">test story 2</code>的方法？</p><p id="c5fa" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">是的，只需将以下故事添加到培训故事中即可:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi op"><img src="../Images/ae4c53207bc6ba8fd53121e2e93b358b.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*XooJou5TKPTzCZK9BK3cdA.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图17:将通过测试故事2的故事</figcaption></figure><p id="e10d" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">注意，下面的故事虽然与图17相似，但不会通过<code class="fe nj nk nl nm b">test story 2</code>:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi op"><img src="../Images/f146a668ffe4be807c86679b3af8c206.png" data-original-src="https://miro.medium.com/v2/resize:fit:792/format:webp/1*7OjOp_YxhmFLb31conavQw.png"/></div><figcaption class="nc nd gj gh gi ne nf bd b be z dk translated">图18:不能通过测试的故事故事2</figcaption></figure><p id="343d" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">乍一看，这看起来很奇怪，因为人们会认为图18中的故事会让机器人记住意图<code class="fe nj nk nl nm b">goodbye</code>后面应该跟着响应<code class="fe nj nk nl nm b">utter_goodbye</code>。然而，思考一下这两个故事是如何成为特色的，就会发现观察到的行为一点也不奇怪。</p><h1 id="1d6c" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">结论</h1><p id="a2cb" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">这篇文章描述了Rasa的强化记忆策略中的遗忘机制是如何工作的。</p><p id="b749" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">该机制的工作原理是丢弃过去的事件，直到某个事件可以与查找表相匹配。</p><p id="d162" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">我希望你已经发现这是有用的。</p><h1 id="b933" class="kk kl it bd km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh bi translated">附录</h1><h2 id="b6b5" class="mm kl it bd km mn mo dn kq mp mq dp ku lt mr ms ky lx mt mu lc mb mv mw lg iz bi translated">附录I:有槽和实体的故事</h2><p id="afcc" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">这个故事:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/508accb9ab1f2682ebe7c482e81380b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:800/format:webp/1*54gldRx-3IU_6JvjgBp1FQ.png"/></div></figure><p id="eb2e" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">在跟踪器中具有以下表示形式:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ol"><img src="../Images/798b7089dee34a5b23df94e9e2dac020.png" data-original-src="https://miro.medium.com/v2/resize:fit:1212/format:webp/1*MQX43A25IQ1O-CEvWa_GeQ.png"/></div></div></figure><p id="44df" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">其特点如下:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi or"><img src="../Images/ea1c47f6b64e77f159aa6c7a4b24c9e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*miW3b6oCgN6TOzdZP1m0JA.png"/></div></div></figure><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi os"><img src="../Images/ee9dc6f2fad57f1ab999ce4f2506695c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uz16QOQ2yjxr-NvPxgOENA.png"/></div></div></figure><p id="7b39" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">注意，当一个槽在一个特定的步骤被设置时，它的值被带到下一个步骤。实体就不是这样了。</p><h2 id="31f9" class="mm kl it bd km mn mo dn kq mp mq dp ku lt mr ms ky lx mt mu lc mb mv mw lg iz bi translated">附录二:当max_history不为5时</h2><p id="d9ef" class="pw-post-body-paragraph li lj it lk b ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf im bi translated">下表比较了当参数<code class="fe nj nk nl nm b">max_history</code>设置为5和2时<code class="fe nj nk nl nm b">sad path 1</code>故事的特征:</p><figure class="my mz na nb gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi ot"><img src="../Images/bc073eb4612c42c76053e212b70c6450.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*K2O-Cm0J-571MdAqff58vA.png"/></div></div></figure><p id="1871" class="pw-post-body-paragraph li lj it lk b ll mh ln lo lp mi lr ls lt mj lv lw lx mk lz ma mb ml md me mf im bi translated">我们看到将<code class="fe nj nk nl nm b">max_history</code>设置为<code class="fe nj nk nl nm b">n</code>意味着用于在给定步骤进行预测的特征将是最后的<code class="fe nj nk nl nm b">n</code>交互。</p></div></div>    
</body>
</html>