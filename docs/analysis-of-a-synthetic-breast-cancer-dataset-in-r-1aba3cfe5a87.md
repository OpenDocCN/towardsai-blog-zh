# 一个合成乳腺癌数据集的分析

> 原文：<https://pub.towardsai.net/analysis-of-a-synthetic-breast-cancer-dataset-in-r-1aba3cfe5a87?source=collection_archive---------0----------------------->

## [数据分析](https://towardsai.net/p/category/data-analysis)

## 充分探索事件发生时间数据

T 他的帖子是关于我分析一个包含 6 万乳腺癌患者记录的合成数据集。这是真实的数据(就结构而言)，但没有泄露任何患者隐私。你可以在这里找到[请求数据的网站](https://iknl.nl/nkr/cijfers-op-maat/synthetische-dataset)，它是荷兰语的。这方面的伟大之处在于，这些数据集不仅允许我们在不知道患者是谁的情况下分析患者数据，还允许我们在具有临床结构的数据上测试新的算法或方法。因此，如果你在合成数据上开发一些东西，它肯定会在(新的)病人数据上有价值。

那么，我们开始吧。数据集很大，可以做的模型很多。我的目标是探索这些数据，并建立一个基于生存模型的临床决策工具。

我将展示标准的图形化探索、缺失数据分析、生存模型和惩罚等精炼过程。

我希望这篇文章能激励更多的人更深入地研究这个数据集。我在这里制作的东西绝不是最终产品，我也不希望它是最终产品。那里太多了。

我们开始吧！

让我们加载库。

首先，我将导入数据，从一个基本的角度探索它，然后通过重构、组合或重命名来创建新的变量。

![](img/1f24131429f0613dc33fa3703f77b8fb.png)

包含大量数据，许多数据的完成率为 100%。图片:作者。

让我们做一些基本的探索

![](img/2c8c86d1b01c931411b1cc1770160f39.png)

大量非缺失数据的可视化确认。图片:作者。

然后，让我们继续深入研究缺失的数据。

![](img/951c6a5398e6885471a7a5f2a8f3b6d5.png)

如你所见，大多数时候只有五个变量是真正缺失的。有各种各样的失踪模式，但没有什么令人兴奋的。有了 60k 的唱片，你可以相当安全地玩它。图片:作者。

![](img/f8c5792b967f8fe5d4dbb16a9d67bf14.png)![](img/53148600c9e71fe659b36df2dd3847d9.png)![](img/6de990d6993fb99f4f18e51df5e34a6a.png)![](img/07a5a2725dcbc84d8c7e109eef98e4db.png)

基于某些分类变量的缺失的进一步探讨。没什么特别的。图片:作者。

丢失的数据模式并没有真正让我担心，所以是时候深入研究数据了。有很多，R 也不喜欢我用这么多观察点和线之类的传统图。因此，这就是为什么热图是最好的，但我无法抗拒深入研究数据的冲动，仍然使用旧的散点图。

![](img/461763c073c45ecffee81281c4c0d0e7.png)![](img/2cbdb1c212ffdfefd2235aea7788e253.png)![](img/b6323a76705059553ea237aac0c028fd.png)![](img/da8d541cbcde393f11b9e09e97b439a6.png)

不同的散点图，主要观察存活时间、事件之间的关系，以及年龄、性别、肿瘤大小、分期和所研究的淋巴结。它们看起来不错，但确实很有帮助。图片:作者。

让我们尝试更多的东西，很多其他的东西。如你所见，我没有选择传统的散点图矩阵，因为它们在这里没有价值——75%的变量是分类变量。

![](img/4345763bf38d84ba0f190694ed71b78b.png)

每个纳入年份的数据。图片:作者。

![](img/d6f595ff4f8b82d4d02cd15a7ee93940.png)

按纳入年份划分的存活时间。图片:作者。

![](img/86a245a3878ba95e6c9ce6f314342df6.png)![](img/856db19cf45094a8dc448eab4ca7de31.png)![](img/e1e9c72fa9206c88887428b1d354058d.png)![](img/a0465ae4333f4c48449b0417c62ba533.png)![](img/d1fc4c957b50c577de1c5f01b29c28b7.png)![](img/26daebcdd951bce0d23abadd82064025.png)![](img/7c16da592d370c61d2d2ea7ebf509e5f.png)![](img/20226cd74e14f805c2e0fcf4ae5bab7b.png)

生存时间由很多变量决定，其中包括 NA 选项。找到模式并不容易，尽管它们确实存在。图片:作者。

![](img/f664cf73b77a651141a894eb63d60c58.png)

按纳入年份划分的存活时间。老实说，包容年没有帮助。虽然这是治疗效果增加的一个很好的标志，但除了存活时间本身之外，它并没有提供更多。图片:作者。

下图试图显示存活时间、患者年龄、纳入年份和名为 *gen_stat* 的变量之间的关系，该变量是一个新的组合变量，包括三个激素标记: *her2* 、 *er、*和 *pr* 。如果发现这些标记中的任何一个，不管分数如何，它们都被标记为 1。因此，在 *gen_stat* 上的三分意味着患者在所有三个标记上都得分为阳性。

比这些标记更有趣的是患者的年龄。我们以后会证明，年龄确实有一个分界点。

![](img/c4df47b5bd48c4d7619dbdfc2037ea60.png)![](img/5dfdca8151064a99d3d0c200f84f2bf5.png)![](img/2ca5ef5cd23c818aee875d927b9d95e7.png)![](img/e27a58e1a2f0ba9ea6f69348c6e9d6d0.png)![](img/e3db98d6bb71f9416492ef4d1a887cb1.png)![](img/67749fdfc3c0dcb9e1ea751478892b67.png)

以及多个不同关系上的一些样条模型。有些看起来真的很好，有些看起来很时髦，这可能是样条曲线的自然行为。图片:作者。

让我们转到生存分析本身。这不是我第一次发表关于进行生存分析的文章，更深入的介绍请阅读[这里](https://medium.com/@marc.jacobs012/survival-analysis-in-sas-kaplan-meier-cox-regression-time-varying-predictors-recurrent-events-4ae7cd95f8c0)和[这里](https://medium.com/@marc.jacobs012/introduction-to-survival-analysis-in-cows-using-r-28b82c2821fb)。

最简单的模型是只查看整个数据集的存活情况

![](img/62f2a0d6dc2eef87e0c8f951c654c25e.png)

看起来非常好，很多数据，很多事件，但是一条曲线显示的非常非常少。图片:作者。

让我们看看生存差异，从参与者的纳入年份开始。图片:作者。

![](img/1448a0c7e630e674aba62f0efaf82fea.png)

显而易见，最早纳入的患者的生存曲线看起来不错，但对后来的患者来说就不那么好了。乳腺癌是一种五年存活率非常高的疾病。事实上，许多人在 9 年后仍然活着。图片:作者。

让我们按肿瘤种类来看一看。

![](img/0ed173c7f8b1723b730be8cfef9f6df7.png)

这里我们清楚地看到了统计上的差异，但不清楚这是由于风险函数的真正差异还是审查数量的差异。图片:作者。

有一些很好的功能，比如自动驾驶仪，可以识别一个对象，并将一个合适的图形连接到它。这里，一个以因子为预测因子的模型。

![](img/50705ccb62b1ed8f3d92cdd00edf6777.png)![](img/04fdb3bed4fc3c046ab5bee87818c3b2.png)![](img/b562980684848c470c68bc1c748f1329.png)![](img/649a14bb8a48d9aa0c42fe1dbe26c1cd.png)

用纳入年份分割生存曲线真的不是一个好主意——纳入年份只是生存曲线长度的代表。图片:作者。

按肿瘤分期划分

![](img/f9bd4438147ce44093458fb996b14d95.png)

图片:作者。

然后我开始用几乎所有能想到的变量进行分割。

![](img/fa76bb42f9f188185720920bf5570334.png)![](img/10b8558dbfff2601cb7cd738334adb7e.png)![](img/b0f32b7a2139b6bd1bff7905db353134.png)![](img/9ee92b3d8dbc0231df01f36acfee17ef.png)![](img/674dcd7e089b77236d8cf51700893439.png)![](img/4f402a3e6cfe770d0a6aa178c9771f08.png)![](img/fe8abc12232cad8a71c1d4be764d56eb.png)

这些图清楚地表明，我不能用单一的分类变量来预测存活率。图片:作者。

我们有很多数据要用，但变量不多，而且只有几个是连续的。那些是连续的，让我们看看是否能找到产生完全不同的生存曲线的切割点。或者至少，带上一些有意思的曲线。不要认为这整个过程是统计驱动的——通常，生物学应该驱动假说，应该首先努力通过数据来验证它们。唉，让我们从统计方法入手，从年龄开始。

![](img/ffb8387bf6739b4295ddc211d791d642.png)

临界点定在 72 岁。所以我们有高于和低于 72 的。图片:作者。

![](img/797e72925bf9538f3a1bdb69ef1279cf.png)![](img/53e9b71b90ea035a740e54e56ac21dd7.png)

这是一个非常有趣的切入点。有趣的是，如果你看一些最早的图表，你已经可以看到，70 岁左右的年龄产生了一个生存时间的陡坡。图片:作者。

让我们重新画一些图。图片:作者。

![](img/8a5bab0ddb768047fbc78723a1c0e3e9.png)

的确，72 岁很有意思。图片:作者。

![](img/f785b5f781db00db173e41f9248eab36.png)![](img/d3e2c427bf89d4d3c35f96062d30c86a.png)

同样在这里，72 岁是非常有趣的，但只有结合某些共同预测。图片:作者。

![](img/5467ecc8cb404267ece534057e82e6dd.png)![](img/dc84c6408d770640179ff02c7fc5f6d2.png)

图片:作者。

现在，让我们创建一些生存曲线，我们只看 72 岁以上。

![](img/7d502b131c6fc046cec7d0d5f6257b1f.png)![](img/40b49c2bd8dda4c563158805998be7ff.png)

现在，生存曲线开始变得更加有趣，因为它们是更大曲线的终点。这是严重事件开始发生的地方。可以发现肿瘤位置的差异，但不是激素指标。图片:作者。

![](img/34c9150d89f381d399f7ea6f58e76a61.png)

还有肿瘤大小的差异。图片:作者。

在这里，我把年龄分成 10 组，从 10 岁到 100 岁。

![](img/75869533d6dc59db56ffddbf55a59e3a.png)

现在我们看到了一些不同之处。图片:作者。

很好，我们有适合年龄的东西。让我们看看我们是否也能找到一些关于阳性淋巴结数量的东西。这一项并不容易，因为大部分都检查了相当多的淋巴结，但大多数并不呈阳性。

![](img/03093e08b9d34e80eac36c6945f2e04b.png)![](img/853afeb814e3e2fac878bdce20e03112.png)

正如你所看到的，差异是可以发现的，但是很早就发现了。我想知道这将如何在模型中保持。图片:作者。

最后但同样重要的是，肿瘤的大小。

![](img/d1c886f0c7adc90062fee50e7fab612b.png)![](img/f510de90c99535a2a6251f45ac1337a4.png)

单从肿瘤大小来看，没有发现有意义的结果，但从生物学角度来看，我想这是有意义的。让我们看看。图片:作者。

然后我忍不住去看包容年。这实际上没有意义，因为它是一个分类因素，但无论如何让我们看一看。

![](img/5016ebe9df39ac3ea531b51dfb199242.png)![](img/aa98567c5f3053221f84685e32b21e8d.png)

截断点定在 2015 年。这是有道理的——他们只是还没有积累必要的存活时间，并且审查的数据不像事件数据那样计算。图片:作者。

好吧，我做了一些探索性的单变量生存曲线。让我们进一步结合多个变量进行 Cox 回归分析。

![](img/d9f0fb1de1b6faca2081c8334a468b2f.png)

如您所见，事件的总比例约为 25%。这将为我们提供足够的能量来发现一个信号，如果它存在的话。图片:作者。

下面是包含样条的 cos 回归代码，寻找预测能力(一致性)，并显示每个变量的影响。

![](img/07f0e64f8ca6d9dd0a6b6bb8a5fc2482.png)![](img/36a55884ce25927d739f46628ea6e7ce.png)

c-统计量设置为 0.77，等于生存分析中的 ROC 曲线。图片:作者。

![](img/44a4280274525c0519ec5812519e9b58.png)

以及令人印象深刻的风险比图。对于交流来说一点用都没有，但是看起来还是不错的。图片:作者。

如果我们不首先检查半参数 Cox 回归的假设，上述所有内容都是无用的。这意味着危险比应该是成比例的，并且随着时间的推移保持稳定。我还会检查样条曲线是否符合数据。

![](img/a94dda2be461c9ea15b9c5e358e46503.png)

p 值使用起来很好，但并不真正有用。这里的“重大”是指比例假设不能成立。这并不好，因为这是 Cox 回归最重要的假设。如果违反了，风险比是不稳定的，因此是时间的函数。图片:作者。

![](img/9befe58a3b46c8eba0f2298c13a4d6d7.png)

令人担忧的是，我们没有舍恩菲尔德残差图来检验 PH 假设。图片:作者。

偏差残差是 Cox 回归中的标准化残差。你希望它们是同质的。

![](img/0f612e735f149047e65a672cf4192e40.png)![](img/a69dbc8329764164e525d5529c1acd14.png)

这看起来不错，但也很奇怪。尤其是左边。图片:作者。

![](img/8fd008aa542af303a4c803e4388c22b2.png)

看起来也不错。图片:作者。

我想更深入地挖掘样条的适用性。有一个函数可以做到这一点，但是它不接受样条。所以，就一瞥，我们用三次多项式来看一下。

![](img/6670fa44732d4d44922ca96ad5a5ef8d.png)

对于这三者，鞅残差都不是线性的。如果我看到这一点，我开始相信对连续数据进行分类并不是一件坏事，即使这意味着我可能会失去一些预测能力。我们已经看到分界点提供了一些解释，尽管不是全部。图片:作者。

所以，在下一个模型中，我删除了阳性淋巴结数量的样条。这些变量可能需要转换，但是让我们通过查看[方差膨胀因子](https://en.wikipedia.org/wiki/Variance_inflation_factor) (VIF)来看看这个模型现在表现如何。VIF 提供了变量互相关的指标。

![](img/6f5669dd3e60e7e14d2df235ff6483a0.png)

让我们来看看方差膨胀因子。一个特别突出的变量是 **gedrag** ，这意味着肿瘤的位置。我们需要更仔细地研究一下。图片:作者。

![](img/41aac40ad1243183489d0c9ed90f460a.png)

现在我们有舍恩菲尔德残差图。他们看起来不错！我不想追求 p 值，因为对于 60k 的观测值，即使是最轻微的偏差也会被视为具有统计学意义。图片:作者。

![](img/40055577b81823fb0a814fa5041ebd7e.png)![](img/3a5f4d21b19e86862d7570b5aa0aef19.png)![](img/49e924b11605ed5082345478c47daf0c.png)

以及残差和线性假设。我可以忍受这些情节。图片:作者。

明智的下一步是评估该模型的预测能力。嗯，实际上，我想看看这个模型是否能区分不同的群体，所以我做了三个风险分析(我甚至不确定它们是否有生物学意义),看看这个模型能预测什么。

![](img/bc9d46a9f13e06bc6858c95e81db0f73.png)![](img/3a1c73492a67e2b244ac25d2c1ddb5ff.png)![](img/5b3fa9db7b7ecd6c368628540b0d21b5.png)

我不确定这些风险简介是否有意义，但它们肯定是有区别的。图片:作者。

我已经说过，要评估一个模型，你可以看看残差和一致性统计。在 [rms 包](https://cran.r-project.org/web/packages/rms/index.html)中，也有一些很棒的工具可以通过引导来验证你的模型。在特定的时间点。让我们看看结果如何。

![](img/1cacb46bd64c82e91339154ef4a01982.png)![](img/8230ae52c2622feefc6d24d99121147c.png)![](img/3cb107ee1141c0ec0c73c00962dbd601.png)

1000、2000 和 3000 天的引导校准图。不是很好，也不是非常糟糕，但我们肯定可以做得更好。图片:作者。

在这个机器学习的时代，我们可以去尝试一些额外的模型。第一个实际上是一个旧的，[尼尔森-艾伦估计](https://en.wikipedia.org/wiki/Nelson%E2%80%93Aalen_estimator)，它是半参数的 Cox 回归的非参数兄弟。Nelson-Aalen 专注于风险函数，并将为我们提供图表，显示每个预测因子对风险函数的影响。相当重要的信息。

![](img/2d39b4a6585c3c282a55d8cf431cec29.png)

这里是每个预测因素对风险的影响。你要找的是一个趋势。由于正在进行的审查次数，置信区间在最后增加是正常的。正如你所看到的，他们中的一些人似乎没有什么影响，但其他人肯定有。图片:作者。

接下来，是真正的机器学习。随机森林。对我来说，这只是一个工具，看看哪些变量被认为是重要的，而不是用它来预测。原因是随机森林很容易变得无法解释。

第一次尝试，我用的是[游侠](https://cran.r-project.org/web/packages/ranger/ranger.pdf)套装。

![](img/0c1d3ce217cbb541acd1515ccffd33ee.png)![](img/c26cf7d24552b38578decdcad1abe510.png)

左边是生存曲线，右边是预测生存曲线。图片:作者。

![](img/54031cc249603fb94c7f1b6bbdd5c4b3.png)

可变重要指标。正如你所看到的，有些真的很重要，而有些肯定不重要。基于 p 值，只能包括**年龄**、**马里**和**肿瘤大小**。图片:作者。

让我们试试另一个包— [randomforestSRC](https://cran.r-project.org/web/packages/randomForestSRC/index.html) 。除了为时间-事件数据运行随机森林之外，它还提供了绘制数据的好方法。标准选项将构建 500 棵树。

![](img/9c9528637568ef5236039ead3c81e1a9.png)

迄今为止最重要的指标。与错误率相关的树的数量，以及可变重要性图。这个包的随机森林和之前的**游侠**包的随机森林一致。图片:作者。

![](img/9d076db99383df686c1aa563488d9169.png)

由**肿瘤种类**绘制的误差率。图片:作者。

![](img/32dfd5495c1f2f2add8969434822709b.png)

随机森林中的一棵树。尽管一棵树是完全可以解释的，但如果你这样看待它，它会变得非常顽固。图片:作者。

![](img/b7e5f1ff637c049f8939755fccf5c1c8.png)![](img/bd2e4a45264b09df088918c17b61a63c.png)

预测的生存概率。图片:作者。

![](img/684a3921f1e680dade0a1181e6b974f5.png)![](img/249dbb661999d4c9a6c53fdc3b860277.png)

**年龄**和**肿瘤种类的部分相关图。**图片:作者。

![](img/05803bcb550130f6827c6026d0eb759a.png)![](img/3ddecf9407db0c1d5d0a0e95976b54ef.png)

显示所包含变量的最小深度的图表。树中变量的最小深度等于在该变量上分裂的最接近树根的节点的深度。如果它很低，那么大量的观察结果将根据这个变量被分组。您可以看到上面的值是如何与变量重要性图相关的。图片:作者。

![](img/ab193346d2a536d03f8c2b0d7675f923.png)![](img/9e361c1b093d7096ee109ba23cd55297.png)![](img/2dc2b16d71ced2ca1c9bca385ad9238f.png)![](img/178fc6f08f4946fc944460a66db40b85.png)![](img/c2f647a2a46877e4fc2e0181e3458c18.png)![](img/dec0444256041b9e9dfb2f03bec3a1fe.png)

显示随机森林模型中变量和存活率之间关系的图。图片:作者。

![](img/8a799df3fa68239644cd5d28fb650042.png)

交互最小深度-包含的变量相对于包含的其他变量的重要性。记住，越低越好。图片:作者。

上面的随机森林模型已经清楚地表明，一些变量并不那么有趣，而另一些却很有趣。现在，查看变量及其重要性的最佳方法之一是包括 L1 和 L2 惩罚方法—套索和岭回归。我[之前贴过](https://medium.com/@marc.jacobs012/predictive-regression-using-splines-partial-least-squares-penalization-cross-validation-and-339b74a7e108)关于这些和其他变量选择方法。

这些方法被应用于数据的子集，因为整个数据集给出了我无法解决的内存大小问题。如你所见，我只进行了一次二次抽样，但更好的方法是循环这个数据集并多次进行，这样你就可以得到它们重要性的自举估计。目前，我们保持简单，并制作 10k 的子集。

首先，我们将要求[惩罚包](https://cran.r-project.org/web/packages/penalized/index.html)分析 L1 和 L2 参数，然后搜索它们的最优值。一旦我们有了这些，我们就把它们都用上。通过应用这两者，我们展开了所谓的[弹性网](https://en.wikipedia.org/wiki/Elastic_net_regularization)。

![](img/94632e73c628e8cdf645b19c0d830f0a.png)

在这里，你可以看到 L1 和 L2 通过他们的情节路径工作。他们之间的区别是，L1 将删除变量，将它们的系数缩小到零，而 L2 将调整它们。L1 花了很多时间来发挥作用，最后只选择了少数。图片:作者。

![](img/8e6d1b6dcab74a0917f6e1682b85f14e.png)

通过收缩选择最佳 L1 变量。图片:作者。

![](img/24e369af3d6d1379cb5f10b2bdad343d.png)

最佳 L2 系数。图片:作者。

![](img/69122282c1e1dd04056c1e76aea8b2e5.png)

弹性网的系数。如你所见，一些因素变量的类别已经被完全废除了。这是例如肿瘤阶段(**体育场**)和激素受体( **gen_stat** )的情况。图片:作者。

![](img/56027beeebf3181783a51fe6c205c7cf.png)

基于弹性网络的预测模型。图片:作者。

![](img/ca76d74f93a3a5c8f57d1615f66e0920.png)

10k 的预测生存曲线包括患者。形状似乎是正确的，但话说回来，当你有这么多的 id 时，这个图真的没有帮助。图片:作者。

除了处罚包，还有 [GLMNET 包](https://cran.r-project.org/web/packages/glmnet/glmnet.pdf)。让我们也试试这个。

![](img/99534b341c0aa82523b4ddaeb759a38b.png)![](img/51e45901b0ac149e4fe51a5069b51f54.png)

L1，并通过交叉验证寻找最优的 lamba。图片:作者。

![](img/1706ace5eafe1638ca69c5a395eaa70e.png)![](img/6ffb555c6f0539cc4f7ea25838d889d0.png)

应用交叉验证的 lambda 值，并查看如何从模型中删除纳入年份( **incjr** )、差异分级( **diffgrad** )和手术( **org_chir** )。图片:作者。

下面的部分对这个特殊的数据集来说有点实验性，因为我并不真的需要它。下面你会看到我拟合参数化生存模型，它试图通过超越数据的建模将生存曲线带到底。现在，通过(统计)模型在数据之外建模总是很棘手，但这种模型被接受并经常用于卫生技术评估程序。

进行参数模型和各种模型后评估的代码。图片:作者。

![](img/7dc839dc0bcf3469a30fa2bbd23a5e97.png)

如果没有特别说明，survreg 程序自动符合威布尔模型。图片:作者。

![](img/52e61beca61afa0e1334a7f3bf7b635e.png)

基于事件发生时间数据( **vit_stat_int** )、肿瘤种类、肿瘤分期(**体育场**)和年龄(**left**)的模型拟合。不太适合。图片:作者。

![](img/528cb58b93af4fe963b820bedda34bc1.png)

条件模型。图片:作者。

![](img/18c4138a1e63bc6dced8f849cb6a46c8.png)

检查哪种分布最合适的图。如你所见，大部分根本装不下。图片:作者。

因此，参数生存模型并没有真正给我带来什么，也许数据对这种建模来说并不太好。乳腺癌的存活率很高，参数化的存活率模型远远超出了现有的数据。很可能太远了。所以，让我们坚持我们所拥有的，并达成协议。

在这里，你可以看到我使用 RMS 包和 [DynNom 包](https://cran.r-project.org/web/packages/DynNom/index.html)构建了一个稳定且动态的列线图。

![](img/31834ab86748fa27f22ce0d1741cab50.png)![](img/73242eb6a680669d162a66d1880472be.png)

图片:作者。

很好，我们现在讨论了数据集建模的最重要方面，包括可视化探索、单变量生存模型、多变量 cox 回归模型、模型评估和验证、惩罚和变量重要性以及参数生存。现在，我已经展示了一个潜在的合理途径是什么，可以形成一个可用于临床的动态诺模图，让我们重温一下我们所学到的，建立第二层模型。

我的决定时间到了。让我们制作出我们想要的模型，并更加关注它。基于以上，我会做出以下选择:

1.  仅女性→虽然男性也有可能患乳腺癌，但我们有更多关于女性的数据。
2.  仅肿瘤种类 501300→大部分数据位于此处。
3.  不包括纳入年份——生存的替代指标
4.  从惩罚模型中，只有以下变量被认为是重要的:*年龄*、*分化等级*、*肿瘤位置*、*激素指标*、*手术*和*肿瘤分期*。
5.  从随机森林模型中，只有以下变量被认为是重要的:*年龄*、*手术过程*、*肿瘤大小*、*肿瘤分期*、*进行的前哨淋巴结手术*、*进行的手术*、*发现的阳性淋巴结数目*、*分化等级*和*激素受体*。

让我们通过绘制一些基本的比例表来尝试和重新验证上述内容。我希望看到的是，所包含的变量在它们的水平上显示出事件和非事件的相同比例。如果是这种情况，那么这个变量的吸引力有限。

首先，检查矩阵每一行中肿瘤种类、性别、偏侧化和纳入年份的比例。

![](img/b0846c8cd620c044da14c1a25bfa9eb4.png)![](img/2ef7241cb80dca23413664f8039e6688.png)

看起来不错。安全的做法是只关注女性，以及数据最多、存活率最低的肿瘤类型。图片:作者。

![](img/b60ad7c086781c3815adad1b8a9abec3.png)

侧化确实不是一个区分变量。图片:作者。

![](img/36d42cc778d752cf82549f4983f88f78.png)

纳入年份和事件比例。最早纳入年份的事件数最高，这本身反映了存活时间。把它作为一个代理会损害分析，所以我们确实把它踢出去了。图片:作者。

然后，让我们看看被认为重要的变量。

![](img/459a98ac21c9715a978aed861a52ca5e.png)![](img/1b1386ec77e9c09661bdf5bea5f0bb32.png)![](img/988e82cdad1934a75c1eabcfd6738ca6.png)![](img/2a52e771dedf6ada854a4658b8de150f.png)![](img/fd73e208e4bd2cf1da788f06107a4c09.png)![](img/367334808a22d8b033557d8d2aa093ff.png)

老实说，它们没有表现出很大的差异？好吧，至少大多数不会，而有些会产生重大影响，如肿瘤的位置( **gedrag** )。2*2 矩阵的问题是，它只能显示边际效应，没有什么非常有条件的。图片:作者。

为了简化模型，我将重构一些包含的变量，以淡化因素的数量。我还会切掉两个连续变量。通常，这真的不是一件聪明的事情，因为你会失去预测能力，但为了预测模型，我可能有意义。

![](img/a8898f644c94eb683ea3789b611d3714.png)

图片:作者。

![](img/ad5954a1e684b49f13855dcb667eba0e.png)

图片:作者。

现在，让我们重新运行模型，看看我们将在哪里着陆。我肯定不会是完美的，因为这个模型是在没有肿瘤学家或其他任何人对如何治疗乳腺癌有丰富知识的情况下制作的。

![](img/8a12a1b8230ad0e2f63d5d1fb299d9b0.png)

我们应该有足够的事件。图片:作者。

![](img/9ee9d09940bd34e5080536fd286bed1c.png)

模型拟合，包含一个年龄和级差之间的相互作用。图片:作者。

![](img/775b1e7a2a38526f6eadb2420b4de51b.png)

总生存曲线。几乎为零。图片:作者。

![](img/d0ffa908d7b22e9dc659085386b969e6.png)

差异通货膨胀系数。肯定有些高水平。这个模型可能还有很多变量。图片:作者。

![](img/87fb71f16ba89fd567f8ead65497dd0d.png)

不算太坏，但我希望达到 0.8 以上的神奇门槛。让我们稍后看看校准线是如何移动的。图片:作者。

![](img/429116206fc721a14e5626edf08cbf1b.png)

不算太坏——也不完美。图片:作者。

![](img/3369052c0e581e2cba6fae50fc759bf9.png)![](img/b9639c5e9c29778fd0eedd30eea098d0.png)![](img/23bef86c79d74663ce49ee00b9fc2f88.png)

嗯，残差在最后消失了。图片:作者。

![](img/6064d8c8f82a770816471e12472b22c7.png)

校准图。有一个奇怪的凹痕，我很确定是由年龄引起的，因为年龄是生存时间的一个很大的预测因素，因为年龄越大，生存时间越短(无论是应对癌症的能力，还是能活的年数)。图片:作者。

![](img/3e5c69de0adb158beb1e306a73d95758.png)

诺模图对年龄、阶段、肿瘤位置以及是否进行了 Mari 手术给予了相当大的重视。其余的就没那么有趣了。图片:作者。

![](img/5f5f95aff221692273f11179072eb20f.png)

和动态列线图。图片:作者。

![](img/97cd4ea9d4eec886c214dda713f0e161.png)![](img/f0d4e584a5d731b4f13ae93ce4eb5a49.png)![](img/a5bda61f5729a6e4939f952f7cb33bcc.png)![](img/2d6d5d017ecc32fcbdc5a197e8b2676c.png)

这里你可以看到，每次我做一个预测，曲线都会被加上，还有置信区间和显示风险状况的表格。图片:作者。

好了，伙计们，现在就这样。我当然还没说完，但我需要一些时间来思考。我还会写一篇文章向你展示如何托管这个闪亮的应用程序。

如果这篇文章有问题，或者有错误，或者你有问题，你知道在哪里可以找到我！

尽情享受吧！