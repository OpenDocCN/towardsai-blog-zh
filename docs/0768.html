<html>
<head>
<title>Using Twitter Rest APIs in Python to Search and Download Tweets in Bulk</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python中的Twitter Rest APIs来批量搜索和下载Tweets</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/using-twitter-rest-apis-in-python-to-search-and-download-tweets-in-bulk-da234b5f155a?source=collection_archive---------2-----------------------#2020-08-06">https://pub.towardsai.net/using-twitter-rest-apis-in-python-to-search-and-download-tweets-in-bulk-da234b5f155a?source=collection_archive---------2-----------------------#2020-08-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7415" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-mining" rel="noopener ugc nofollow" target="_blank">数据挖掘</a>，<a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="6c1b" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">了解如何对推文应用语言检测和情感分析</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/8339733132c5457979af5a62abcb1396.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4V2xEt3KRenVOE-_"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">照片由<a class="ae lh" href="https://unsplash.com/@purzlbaum?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">🇨🇭·克劳迪奥·施瓦茨| @purzlbaum </a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="c8fc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">获取Twitter数据</strong></p><p id="dfe5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们使用python中的Tweepy包，而不是直接处理Twitter API。我们将对这个包做的两件事是，授权我们自己使用API，然后使用光标访问twitter搜索API。</p><p id="6aa7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们继续装进口货吧。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="09fd" class="mj mk it mf b gy ml mm l mn mo">import tweepy<br/>import pandas as pd<br/>import matplotlib.pyplot as plt<br/>import seaborn as sns<br/>import numpy as np</span><span id="a90d" class="mj mk it mf b gy mp mm l mn mo">sns.set()<br/>%matplotlib inline</span></pre><h2 id="c9a1" class="mj mk it bd mq mr ms dn mt mu mv dp mw lr mx my mz lv na nb nc lz nd ne nf iz bi translated">Twitter授权</h2><p id="f342" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">要使用Twitter API，您必须首先注册以获得API密钥。要安装Tweepy，只需通过pip安装Tweepy。Tweepy文档最擅长解释如何进行身份验证，但是我将介绍基本步骤。</p><p id="62c7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦你注册了你的应用程序，你将会收到API密匙，接下来使用Tweepy来获得一个OAuthHandler。我将密钥存储在一个单独的配置字典中。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="cbee" class="mj mk it mf b gy ml mm l mn mo">config = {"twitterConsumerKey":"XXXX", "twitterConsumerSecretKey" :"XXXX"} <br/>auth = tweepy.OAuthHandler(config["twitterConsumerKey"], config["twitterConsumerSecretKey"]) <br/>redirect_url = auth.get_authorization_url() <br/>redirect_url</span></pre><p id="cdc1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">既然我们已经为Tweepy提供了生成OAuthHandler的密钥，现在我们将使用该处理程序来获取一个重定向URL。从浏览器中的输出转到URL，您可以允许您的应用程序授权您的帐户，以便您可以访问API。</p><p id="cd53" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦你用该应用程序授权了你的帐户，你将获得一个PIN。使用Tweepy中的那个数字让它知道您已经用API授权了它。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="f06b" class="mj mk it mf b gy ml mm l mn mo">pin = "XXXX"<br/>auth.get_access_token(pin)</span></pre><h1 id="b6aa" class="nl mk it bd mq nm nn no mt np nq nr mw ki ns kj mz kl nt km nc ko nu kp nf nv bi translated">搜索推文</h1><p id="702b" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">获得授权后，我们可以用它来搜索所有包含“英航”一词的推文；我们已将最大结果限制为1000。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="1cd5" class="mj mk it mf b gy ml mm l mn mo">query = 'British Airways'<br/>max_tweets = 10<br/>searched_tweets = [status for status in tweepy.Cursor(api.search, q=query,tweet_mode='extended').items(max_tweets)]</span><span id="9f21" class="mj mk it mf b gy mp mm l mn mo">search_dict = {"text": [], "author": [], "created_date": []}</span><span id="8c12" class="mj mk it mf b gy mp mm l mn mo">for item in searched_tweets:<br/>    if not item.retweet or "RT" not in item.full_text:<br/>        search_dict["text"].append(item.full_text)<br/>        search_dict["author"].append(item.author.name)<br/>        search_dict["created_date"].append(item.created_at)</span><span id="6b59" class="mj mk it mf b gy mp mm l mn mo">df = pd.DataFrame.from_dict(search_dict)<br/>df.head()</span><span id="88dc" class="mj mk it mf b gy mp mm l mn mo"># <!-- -->Out:<br/>    text                                                author      created_date<br/>0   @RwandAnFlyer @KenyanAviation @KenyaAirways @U...   Bkoskey     2019-03-06 10:06:14<br/>1   @PaulCol56316861 Hi Paul, I'm sorry we can't c...   British Airways     2019-03-06 10:06:09<br/>2   @AmericanAir @British_Airways do you agree wit...   Hat     2019-03-06 10:05:38<br/>3   @Hi_Im_AlexJ Hi Alex, I'm glad you've managed ...   British Airways     2019-03-06 10:02:58<br/>4   @ZRHworker @British_Airways @Schmidy_87 @zrh_a...   Stefan Paetow   2019-03-06 10:02:33</span></pre><h1 id="d989" class="nl mk it bd mq nm nn no mt np nq nr mw ki ns kj mz kl nt km nc ko nu kp nf nv bi translated">语言检测</h1><p id="e7dc" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">上面的代码下载的tweets可以是任何语言，在我们使用这些数据进行进一步的文本挖掘之前，我们应该通过执行语言检测来对其进行分类。</p><p id="f367" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">通常，语言检测是由基于朴素贝叶斯算法或更现代的神经网络的预训练文本分类器来执行的。Google的<a class="ae lh" href="https://github.com/google/cld3" rel="noopener ugc nofollow" target="_blank">compact language detector library</a>是生产级工作负载的绝佳选择，您必须在不到几分钟的时间内分析成千上万的文档。然而，设置起来有点棘手，因此，许多人依赖于调用第三方提供商如Algorithmia的<a class="ae lh" href="https://algorithmia.com/algorithms/specrom/NaturalLanguageDetection" rel="noopener ugc nofollow" target="_blank">语言检测API </a>，该API每月可免费使用数百次(需要免费注册，无需信用卡)。</p><p id="ebc1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们在这个例子中保持简单，只使用一个名为Langid的Python库，它比上面讨论的选项慢几个数量级，但在这个例子中对我们来说应该没问题，因为我们只分析大约100条推文。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="5c2d" class="mj mk it mf b gy ml mm l mn mo">from langid.langid import LanguageIdentifier, model<br/>def get_lang(document):<br/>    identifier = LanguageIdentifier.from_modelstring(model, norm_probs=True)<br/>    prob_tuple = identifier.classify(document)<br/>    return prob_tuple[0]</span><span id="57a9" class="mj mk it mf b gy mp mm l mn mo">df["language"] = df["text"].apply(get_lang)</span></pre><p id="408b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们发现输出中有四种独特语言的推文，100条推文中只有45条是英语，如下所示进行过滤。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="75b0" class="mj mk it mf b gy ml mm l mn mo">print(df["language"].unique())<br/>df_filtered = df[df["language"]=="en"]<br/>print(df_filtered.shape)</span><span id="42ce" class="mj mk it mf b gy mp mm l mn mo">#Out:<br/>array(['en', 'rw', 'nl', 'es'], dtype=object)<br/>(45, 4)</span></pre><h1 id="b103" class="nl mk it bd mq nm nn no mt np nq nr mw ki ns kj mz kl nt km nc ko nu kp nf nv bi translated">让情绪为推文评分</h1><p id="36d5" class="pw-post-body-paragraph li lj it lk b ll ng kd ln lo nh kg lq lr ni lt lu lv nj lx ly lz nk mb mc md im bi translated">我们可以使用前面部分创建的df_filtered，并通过预先训练的情感分析库运行它。出于说明的目的，我们使用Textblob中的一个，但是，我强烈建议使用更准确的情绪模型，如coreNLP中的模型，或者使用Sklearn或Keras训练您自己的模型。</p><p id="3e1b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">或者，如果你选择通过API途径，那么在Algorithmia上有一个非常好的<a class="ae lh" href="https://algorithmia.com/algorithms/specrom/GetSentimentsScorefromText" rel="noopener ugc nofollow" target="_blank">情绪API </a>。</p><pre class="ks kt ku kv gt me mf mg mh aw mi bi"><span id="69db" class="mj mk it mf b gy ml mm l mn mo">from textblob import TextBlob</span><span id="8ebc" class="mj mk it mf b gy mp mm l mn mo">def get_sentiments(text):<br/>    blob = TextBlob(text)<br/><em class="nw">#     sent_dict = {}</em><br/><em class="nw">#     sent_dict["polarity"] = blob.sentiment.polarity</em><br/><em class="nw">#     sent_dict["subjectivity"] = blob.sentiment.subjectivity</em><br/>    <br/>    if blob.sentiment.polarity &gt; 0.1:<br/>        return 'positive'<br/>    elif blob.sentiment.polarity &lt; -0.1:<br/>        return 'negative'<br/>    else:<br/>        return 'neutral'</span><span id="04a6" class="mj mk it mf b gy mp mm l mn mo">def get_sentiments_score(text):<br/>    blob = TextBlob(text)<br/>    return blob.sentiment.polarity<br/>    <br/>df_filtered["sentiments"]=df_filtered["text"].apply(get_sentiments)<br/>df_filtered["sentiments_score"]=df_filtered["text"].apply(get_sentiments_score)<br/>df_filtered.head()<br/>#Out:<br/>    text                                                author          created_date    language    sentiments  sentiments_score<br/>0   @British_Airways Having some trouble with our ...   Rosie Smith     2019-03-06 10:24:57     en  neutral     0.025<br/>1   @djban001 This doesn't sound good, Daniel. Hav...   British Airways     2019-03-06 10:24:45     en  positive    0.550<br/>2   First #British Airways Flight to #Pakistan Wil...   Developing Pakistan     2019-03-06 10:24:43     en  positive    0.150<br/>3   I don’t know why he’s not happy. I thought he ...   Joyce Stevenson     2019-03-06 10:24:18     en  negative    -0.200<br/>4   Fancy winning a global holiday for you and a f...   Selective Travel Mgt 🌍  2019-03-06 10:23:40     en  positive    0.360</span></pre><p id="fc79" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">让我们绘制情绪得分图，看看人们为“英国航空公司”发送了多少负面、中立和正面的推文。您也可以将其保存为CSV文件，以便以后进一步处理。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/6e782e185c52fcc67cf69fba392ae59d.png" data-original-src="https://miro.medium.com/v2/resize:fit:780/format:webp/0*ZaumfkVl73AGsOHY.jpg"/></div></figure></div><div class="ab cl ny nz hx oa" role="separator"><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od oe"/><span class="ob bw bk oc od"/></div><div class="im in io ip iq"><p id="641a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="nw">原载于2019年2月1日</em><a class="ae lh" href="http://jaympatel.com/2019/02/using-twitter-rest-apis-in-python-to-search-and-download-tweets-in-bulk/" rel="noopener ugc nofollow" target="_blank"><em class="nw">http://jaympatel.com</em></a><em class="nw">。</em></p></div></div>    
</body>
</html>