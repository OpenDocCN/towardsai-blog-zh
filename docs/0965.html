<html>
<head>
<title>Building An End to End Deep Learning Model with Deployment on AWS Cloud using Amazon Sagemaker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Amazon Sagemaker构建端到端深度学习模型，并部署在AWS云上</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/building-an-end-to-end-deep-learning-model-with-deployment-on-aws-cloud-using-amazon-sagemaker-6b8584c9c6e7?source=collection_archive---------2-----------------------#2020-09-23">https://pub.towardsai.net/building-an-end-to-end-deep-learning-model-with-deployment-on-aws-cloud-using-amazon-sagemaker-6b8584c9c6e7?source=collection_archive---------2-----------------------#2020-09-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="f0e7" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/cloud-computing" rel="noopener ugc nofollow" target="_blank">云计算</a>，<a class="ae ep" href="https://towardsai.net/p/category/machine-learning/deep-learning" rel="noopener ugc nofollow" target="_blank">深度学习</a></h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/63ac0b6d062e804fb77415d8765f7055.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4L_syAlyprmBr6KqqAA2tA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">图片提供:亚马逊网络服务</figcaption></figure><p id="86c2" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这篇文章的目标是指导你通过使用AWS云计算服务SageMaker，使用RESNET-50架构建立一个端到端的机器学习管道，涉及深度学习和对象检测。我们还将发现如何使用Amazon Sagemaker Ground Truth在几分钟内标记大型数据集。</p><p id="0142" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这篇文章将涵盖机器学习开发生命周期的所有主要方面:</p><ol class=""><li id="a4b6" class="lj lk iq kn b ko kp ks kt kw ll la lm le ln li lo lp lq lr bi translated"><strong class="kn ja">下载图像数据集:</strong></li></ol><p id="45b6" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在我们开始下载数据集之前，我们将启动一个sagemaker笔记本实例:我们可以这样做</p><ol class=""><li id="910c" class="lj lk iq kn b ko kp ks kt kw ll la lm le ln li lo lp lq lr bi translated">去你的console.aws.com</li><li id="a5fa" class="lj lk iq kn b ko ls ks lt kw lu la lv le lw li lo lp lq lr bi translated">选择sagemaker服务-&gt;笔记本实例-&gt;创建笔记本实例</li><li id="80a5" class="lj lk iq kn b ko ls ks lt kw lu la lv le lw li lo lp lq lr bi translated">如下所示填写详细信息</li></ol><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi lx"><img src="../Images/64ef1a5d5eb83cf6ac8bf051bf71c440.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*R6g4Hce8xcf13Je6W6RqQg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">截图1</figcaption></figure><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi mc"><img src="../Images/f7793e2577c9ff1c79fec8bd16713418.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*arLVgDr0K0CEAl_4iih8eA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">截图2</figcaption></figure><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi md"><img src="../Images/08ced26ffd0d83078b1fca87778ce4ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hslYjOySgnIk1MD8FWfFwQ.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">截图三</figcaption></figure><p id="be63" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kn ja">行话预警:</strong> <strong class="kn ja">弹性推理:</strong>这使得GPU加速可以提高你的深度学习模型的吞吐量，降低延迟。</p><p id="e38e" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kn ja"> IAM角色:</strong>对于刚接触云计算的人来说，这是一个提供AWS服务特定权限的角色。</p><p id="f1a8" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">一旦实例准备就绪，您就可以在Sagemaker实例中打开jupyterlab笔记本。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi me"><img src="../Images/7f431a295fbbddf225797fe4d84e08e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fnRWb4wfbFr--gQ36jHQzA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图4</figcaption></figure><p id="ab97" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">一旦您打开Jupyterlab，您就可以从这个<a class="ae mf" href="https://github.com/anuragbisht12/AWS-SageMaker-Deployment/blob/master/Object%20Detection/ObjectDetection_SageMaker.ipynb" rel="noopener ugc nofollow" target="_blank">链接</a>中克隆存储库。您必须导航到对象检测文件夹。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi mg"><img src="../Images/fdd3a17f4edb62c1eafd395657029e6e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7gjnci-mv-znFog4QtuZBQ.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图5</figcaption></figure><p id="d271" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们将使用这个包含500张蜜蜂图片的开源数据集<a class="ae mf" href="http://aws-tc-largeobjects.s3-us-west-2.amazonaws.com/DIG-TF-200-MLBEES-10-EN/dataset.zip" rel="noopener ugc nofollow" target="_blank">链接</a>。因此，第一项任务是下载文件，解压缩并上传到亚马逊S3桶，因为亚马逊sagemaker使用S3桶来存储工件。</p><p id="6974" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在Jupyter笔记本中编写以下命令，将数据集和清单文件解压缩并复制到S3存储桶中。</p><pre class="ly lz ma mb gt mh mi mj mk aw ml bi"><span id="901c" class="mm mn iq mi b gy mo mp l mq mr">#Download &amp; unzip the files to the ec2 instance of Amazon sagemaker<br/>!wget http://aws-tc-largeobjects.s3-us-west-2.amazonaws.com/DIG-TF-200-MLBEES-10-EN/dataset.zip <br/>!unzip -qo dataset.zip</span><span id="d083" class="mm mn iq mi b gy ms mp l mq mr"><em class="mt"># S3 bucket must be created in us-west-2 (Oregon) region</em><br/>BUCKET = '&lt;Your s3 bucket name&gt;'<br/>PREFIX = 'input' <em class="mt"># this is the root path to your working space, feel to use a different path</em></span><span id="0a1d" class="mm mn iq mi b gy ms mp l mq mr">#Copy the files  to the s3 bucket<br/>!aws s3 sync --exclude="*" --include="[0-9]*.jpg" . s3://$BUCKET/$PREFIX/</span></pre><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi mu"><img src="../Images/7be2e9e9071c63dc30d7bf08e949d33e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4U3QuDFbvDIF5EaMPYtB-w.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图6</figcaption></figure><p id="1a80" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">一旦上传了数据，相应的s3存储桶将包含所有图像，如下所示。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi mv"><img src="../Images/3889359694e3dc17e145ecca31add558.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AD9-RQMGlahEMWto-aYKzg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图7</figcaption></figure><p id="dac8" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kn ja"> 2。使用亚马逊地面真相创建图像标签工作</strong></p><p id="7876" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">一旦您将图像放入S3桶，您就可以开始手动标记它们，或者您可以使用AWS powered服务来自动标记图像。让我们来看看能做什么。</p><p id="62a9" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在“标记作业”部分，您可以创建标记作业</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi mw"><img src="../Images/de14daf69aefc8d0d46045ec2b32c40b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gjkKoiNPdoUCELpQfHVePA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图8</figcaption></figure><p id="0fed" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">您可以按照截图中提到的方式填写详细信息</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi mx"><img src="../Images/13965a2dcb780667d5acd3ca54f2874b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2THNoIZtFuzisF0Az9CGVg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图9</figcaption></figure><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi my"><img src="../Images/dcd405b9d45abc516f3b0207a08b7cfc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*atS6WCzq86K0zrt4HFgQBg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">截图10</figcaption></figure><p id="00d1" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">确保单击“完整数据设置”选项为输入图像创建清单文件。清单文件包含键值对格式的数据集图像的所有位置。您还需要为标记作业指定IAM角色来访问S3存储桶。</p><p id="8aea" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，您甚至可以选择是标记整个数据集还是该数据集中的样本。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi mz"><img src="../Images/39b418b467cdaba7d5a30e4909452ab4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9X4Xq7vaSQadARyFCwWc4A.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图11</figcaption></figure><p id="f084" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">完成后，您需要为贴标机指定任务类别。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi na"><img src="../Images/f33c8ee7dbe098ddeeb77464529331eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*khwQ4Qk6AOZ8pirq10rDyA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图12</figcaption></figure><p id="070f" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在，您可以为您的贴标工作选择工人类型:私人，供应商管理，或亚马逊土耳其机械公司(公共)。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nb"><img src="../Images/c8acedfc6cfc08048c31dcc1b8c7c42f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a01LDtDmB0X6yp8cgCrCUg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图13</figcaption></figure><p id="385f" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在你要描述标签，好的和坏的例子。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nc"><img src="../Images/761d277996146fe044e6a01a0eea7d2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kcWl89oOZ3B0tjsuN989xw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图14</figcaption></figure><p id="8927" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">这份工作看起来像这样。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nd"><img src="../Images/5751c08e8616dd0e035546e55d0eff3f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_xFS6AopdbjdTo77glOHtw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图15</figcaption></figure><p id="3581" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">要查看带注释的图像，我们可以下载清单文件，其中包含由标记作业完成的注释的所有信息。</p><pre class="ly lz ma mb gt mh mi mj mk aw ml bi"><span id="345d" class="mm mn iq mi b gy mo mp l mq mr"># Enter the name of your job here<br/>labeling_job_name = 'bees-sample'</span><span id="9721" class="mm mn iq mi b gy ms mp l mq mr">import boto3<br/>client = boto3.client('sagemaker')</span><span id="6374" class="mm mn iq mi b gy ms mp l mq mr">s3_output = client.describe_labeling_job(LabelingJobName=labeling_job_name)['OutputConfig']['S3OutputPath'] + labeling_job_name<br/>augmented_manifest_url = f'{s3_output}/manifests/output/output.manifest'</span><span id="99d4" class="mm mn iq mi b gy ms mp l mq mr">import os<br/>import shutil</span><span id="fa42" class="mm mn iq mi b gy ms mp l mq mr">try:<br/>    os.makedirs('od_output_data/', exist_ok=False)<br/>except FileExistsError:<br/>    shutil.rmtree('od_output_data/')</span><span id="efe1" class="mm mn iq mi b gy ms mp l mq mr"># now download the augmented manifest file and display first 3 lines<br/>!aws s3 cp $augmented_manifest_url od_output_data/<br/>augmented_manifest_file = 'od_output_data/output.manifest'<br/>!head -3 $augmented_manifest_file</span><span id="aeca" class="mm mn iq mi b gy ms mp l mq mr">#Plotting function<br/>import matplotlib.pyplot as plt<br/>import matplotlib.patches as patches<br/>from PIL import Image<br/>import numpy as np<br/>from itertools import cycle</span><span id="2345" class="mm mn iq mi b gy ms mp l mq mr">def show_annotated_image(img_path, bboxes):<br/>    im = np.array(Image.open(img_path), dtype=np.uint8)<br/>    <br/>    # Create figure and axes<br/>    fig,ax = plt.subplots(1)</span><span id="d49c" class="mm mn iq mi b gy ms mp l mq mr"># Display the image<br/>    ax.imshow(im)</span><span id="1646" class="mm mn iq mi b gy ms mp l mq mr">colors = cycle(['r', 'g', 'b', 'y', 'c', 'm', 'k', 'w'])<br/>    <br/>    for bbox in bboxes:<br/>        # Create a Rectangle patch<br/>        rect = patches.Rectangle((bbox['left'],bbox['top']),bbox['width'],bbox['height'],linewidth=1,edgecolor=next(colors),facecolor='none')</span><span id="7aa1" class="mm mn iq mi b gy ms mp l mq mr"># Add the patch to the Axes<br/>        ax.add_patch(rect)</span><span id="014c" class="mm mn iq mi b gy ms mp l mq mr">plt.show()<br/></span><span id="0871" class="mm mn iq mi b gy ms mp l mq mr">#Show the annotated images</span><span id="85ad" class="mm mn iq mi b gy ms mp l mq mr">!pip -q install --upgrade pip<br/>!pip -q install jsonlines<br/>import jsonlines<br/>from itertools import islice</span><span id="2c8e" class="mm mn iq mi b gy ms mp l mq mr">with jsonlines.open(augmented_manifest_file, 'r') as reader:<br/>    for desc in islice(reader, 10):<br/>        img_url = desc['source-ref']<br/>        img_file = os.path.basename(img_url)<br/>        file_exists = os.path.isfile(img_file)</span><span id="5a55" class="mm mn iq mi b gy ms mp l mq mr">bboxes = desc[labeling_job_name]['annotations']<br/>        show_annotated_image(img_file, bboxes)</span></pre><p id="3abd" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">将绘制10幅带注释的图像</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ne"><img src="../Images/4c2dcb7c03a396a8b83a6b7758a52ace.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ter34Swop0y5N0K55YCv6w.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图16</figcaption></figure><p id="397b" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在我们使用训练作业训练模型之前，将数据分成训练和验证部分是很重要的。在这里，清单文件将方便我们分割数据样本。</p><pre class="ly lz ma mb gt mh mi mj mk aw ml bi"><span id="e42b" class="mm mn iq mi b gy mo mp l mq mr">import json,jsonlines<br/>import numpy as np</span><span id="3877" class="mm mn iq mi b gy ms mp l mq mr">with jsonlines.open('output.manifest', 'r') as reader:<br/>    lines = list(reader)<br/>    # Shuffle data in place.<br/>    np.random.shuffle(lines)<br/>    <br/>dataset_size = len(lines)<br/>num_training_samples = round(dataset_size*0.8)</span><span id="890c" class="mm mn iq mi b gy ms mp l mq mr">train_data = lines[:num_training_samples]<br/>validation_data = lines[num_training_samples:]</span><span id="bf77" class="mm mn iq mi b gy ms mp l mq mr">augmented_manifest_filename_train = 'train.manifest'</span><span id="477d" class="mm mn iq mi b gy ms mp l mq mr">with open(augmented_manifest_filename_train, 'w') as f:<br/>    for line in train_data:<br/>        f.write(json.dumps(line))<br/>        f.write('\n')</span><span id="f5ac" class="mm mn iq mi b gy ms mp l mq mr">augmented_manifest_filename_validation = 'validation.manifest'</span><span id="29b8" class="mm mn iq mi b gy ms mp l mq mr">with open(augmented_manifest_filename_validation, 'w') as f:<br/>    for line in validation_data:<br/>        f.write(json.dumps(line))<br/>        f.write('\n')<br/>        <br/>print(f'training samples: {num_training_samples}, validation samples: {len(lines)-num_training_samples}')</span><span id="271a" class="mm mn iq mi b gy ms mp l mq mr">pfx_training = PREFIX + '/training' if PREFIX else 'training'<br/># Defines paths for use in the training job request.<br/>s3_train_data_path = 's3://{}/{}/{}'.format(BUCKET, pfx_training, augmented_manifest_filename_train)<br/>s3_validation_data_path = 's3://{}/{}/{}'.format(BUCKET, pfx_training, augmented_manifest_filename_validation)</span><span id="d898" class="mm mn iq mi b gy ms mp l mq mr">!aws s3 cp train.manifest s3://$BUCKET/$pfx_training/<br/>!aws s3 cp validation.manifest s3://$BUCKET/$pfx_training/</span></pre><p id="35f0" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">下面是拆分的输出，一旦清单文件上传回S3存储桶。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nf"><img src="../Images/4c7cf60139be97ebac1cfc507f97755a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j3tep11pTgtpJbR9KSr3sA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图17</figcaption></figure><p id="eafd" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kn ja"> 3。使用标记的数据训练模型。</strong></p><p id="c508" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">创建培训工作有两种选择:</p><ol class=""><li id="d515" class="lj lk iq kn b ko kp ks kt kw ll la lm le ln li lo lp lq lr bi translated">使用API和代码方法:代码在笔记本中提供，我们将研究基于控制台的方法。</li><li id="4770" class="lj lk iq kn b ko ls ks lt kw lu la lv le lw li lo lp lq lr bi translated">使用sagemaker控制台:</li></ol><p id="20a6" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们将转到Sagemaker-&gt;培训工作-&gt;创建培训工作</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ng"><img src="../Images/e41493320f39ddbfb5485485ae6cea0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TPaL0M3Z_VLCSR1Tct2WMg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图18</figcaption></figure><p id="5bc9" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">选择输入模式可能是主观的，您有两种选择:</p><p id="5945" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">文件模式:您的培训数据将被复制到培训作业开始的EC2实例中。</p><p id="251c" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">管道模式:您的训练数据将实时传输到EC2实例。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nh"><img src="../Images/80829524ad11173a757334379640e4db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VsbyVekVzmA2HaftCHACzA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图19</figcaption></figure><p id="9c11" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">下一步是选择培训工作的资源类型，您可以选择标准计算实例或GPU驱动的实例。</p><p id="00ea" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们必须为我们的培训工作指定超参数。最常见的在下面的截图中指定。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ni"><img src="../Images/8586b5f4a5fd0b304fe7edb5210acef4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_IgxglcLgN7sRGXu08pGAA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">截图20</figcaption></figure><p id="bfc2" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们为训练和验证通道指定了两个输入配置，为输出数据通道指定了一个输出配置。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nj"><img src="../Images/5f750bf434a4b739d95352e37aba9301.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Co2_vFEgZ_wsl_wk_oq_og.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">培训配置1</figcaption></figure><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nk"><img src="../Images/ef3a28cec9ec28f93ec31caa65db232d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cT_virRXRMsX427qXxMUxQ.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">培训配置2</figcaption></figure><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi my"><img src="../Images/39bb322ad0a8b0467598b7c30cf51677.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-CKJgf913E3MsXOIn7-FbA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">验证配置</figcaption></figure><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nl"><img src="../Images/65b45f2b6669ad7f120cd742267ab51e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PUNEfhml1NG-oiCCk_KAsw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">输出配置</figcaption></figure><p id="2bd8" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">培训工作开始后，您可以监控其进度。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nm"><img src="../Images/146a8f0c8fbe79a398929663953a6589.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vi53G9J_ZseP3PlJfVYVUg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图21</figcaption></figure><p id="ec86" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">您还可以通过代码以编程方式查看培训作业的状态。</p><pre class="ly lz ma mb gt mh mi mj mk aw ml bi"><span id="967e" class="mm mn iq mi b gy mo mp l mq mr">##### REPLACE WITH YOUR OWN TRAINING JOB NAME<br/># In the above console screenshots the job name was 'bees-detection-resnet'.<br/># But if you used Python to kick off the training job,<br/># then 'training_job_name' is already set, so you can comment out the line below.<br/>training_job_name = 'bees-training'<br/>##### REPLACE WITH YOUR OWN TRAINING JOB NAME</span><span id="8df3" class="mm mn iq mi b gy ms mp l mq mr">training_info = client.describe_training_job(TrainingJobName=training_job_name)</span><span id="12c2" class="mm mn iq mi b gy ms mp l mq mr">print("Training job status: ", training_info['TrainingJobStatus'])<br/>print("Secondary status: ", training_info['SecondaryStatus'])</span></pre><p id="e954" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kn ja"> 4。模型的创建和部署</strong></p><p id="d643" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">要创建一个模型，您必须使用由使用describe_training_job API的培训作业创建的模型工件。</p><pre class="ly lz ma mb gt mh mi mj mk aw ml bi"><span id="5728" class="mm mn iq mi b gy mo mp l mq mr">import time<br/>timestamp = time.strftime('-%Y-%m-%d-%H-%M-%S', time.gmtime())<br/>model_name = training_job_name + '-model' + timestamp</span><span id="6bdf" class="mm mn iq mi b gy ms mp l mq mr">training_image = training_info['AlgorithmSpecification']['TrainingImage']<br/>model_data = training_info['ModelArtifacts']['S3ModelArtifacts']</span><span id="8a46" class="mm mn iq mi b gy ms mp l mq mr">primary_container = {<br/>    'Image': training_image,<br/>    'ModelDataUrl': model_data,<br/>}</span><span id="4c85" class="mm mn iq mi b gy ms mp l mq mr">from sagemaker import get_execution_role</span><span id="8204" class="mm mn iq mi b gy ms mp l mq mr">role = get_execution_role()</span><span id="80bc" class="mm mn iq mi b gy ms mp l mq mr">create_model_response = client.create_model(<br/>    ModelName = model_name,<br/>    ExecutionRoleArn = role,<br/>    PrimaryContainer = primary_container)</span><span id="aca3" class="mm mn iq mi b gy ms mp l mq mr">print(create_model_response['ModelArn'])</span></pre><p id="32ee" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在我们部署模型之前，我们必须创建一个端点配置。这在您执行a/b测试或者尝试您的端点后面的模型的不同变体的情况下特别有用。</p><pre class="ly lz ma mb gt mh mi mj mk aw ml bi"><span id="896f" class="mm mn iq mi b gy mo mp l mq mr">timestamp = time.strftime('-%Y-%m-%d-%H-%M-%S', time.gmtime())<br/>endpoint_config_name = training_job_name + '-epc' + timestamp<br/>endpoint_config_response = client.create_endpoint_config(<br/>    EndpointConfigName = endpoint_config_name,<br/>    ProductionVariants=[{<br/>        'InstanceType':'ml.t2.medium',<br/>        'InitialInstanceCount':1,<br/>        'ModelName':model_name,<br/>        'VariantName':'AllTraffic'}])</span><span id="6838" class="mm mn iq mi b gy ms mp l mq mr">print('Endpoint configuration name: {}'.format(endpoint_config_name))<br/>print('Endpoint configuration arn:  {}'.format(endpoint_config_response['EndpointConfigArn']))</span></pre><p id="4c10" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">一旦创建了端点配置，您就可以通过sagemaker仪表板或使用create_endpoint API来创建端点。</p><pre class="ly lz ma mb gt mh mi mj mk aw ml bi"><span id="2e76" class="mm mn iq mi b gy mo mp l mq mr">timestamp = time.strftime('-%Y-%m-%d-%H-%M-%S', time.gmtime())<br/>endpoint_name = training_job_name + '-ep' + timestamp<br/>print('Endpoint name: {}'.format(endpoint_name))</span><span id="e5b9" class="mm mn iq mi b gy ms mp l mq mr">endpoint_params = {<br/>    'EndpointName': endpoint_name,<br/>    'EndpointConfigName': endpoint_config_name,<br/>}<br/>endpoint_response = client.create_endpoint(**endpoint_params)<br/>print('EndpointArn = {}'.format(endpoint_response['EndpointArn']))</span><span id="992d" class="mm mn iq mi b gy ms mp l mq mr">#check the endpoint status<br/>endpoint_name="endpoint name from above steps"<br/># get the status of the endpoint<br/>response = client.describe_endpoint(EndpointName=endpoint_name)<br/>status = response['EndpointStatus']<br/>print('EndpointStatus = {}'.format(status))</span></pre><p id="4aa9" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">一旦端点准备就绪，我们就可以使用下面的代码执行一个推理请求。</p><pre class="ly lz ma mb gt mh mi mj mk aw ml bi"><span id="5d3b" class="mm mn iq mi b gy mo mp l mq mr">#Check for the test images<br/>import glob<br/>test_images = glob.glob('test/*')<br/>print(*test_images, sep="\n")</span><span id="cd68" class="mm mn iq mi b gy ms mp l mq mr">def prediction_to_bbox_data(image_path, prediction):<br/>    class_id, confidence, xmin, ymin, xmax, ymax = prediction<br/>    width, height = Image.open(image_path).size<br/>    bbox_data = {'class_id': class_id,<br/>               'height': (ymax-ymin)*height,<br/>               'width': (xmax-xmin)*width,<br/>               'left': xmin*width,<br/>               'top': ymin*height}<br/>    return bbox_data</span><span id="dca2" class="mm mn iq mi b gy ms mp l mq mr">import matplotlib.pyplot as plt</span><span id="93bc" class="mm mn iq mi b gy ms mp l mq mr">runtime_client = boto3.client('sagemaker-runtime')</span><span id="c63c" class="mm mn iq mi b gy ms mp l mq mr"># Call SageMaker endpoint to obtain predictions<br/>def get_predictions_for_img(runtime_client, endpoint_name, img_path):<br/>    with open(img_path, 'rb') as f:<br/>        payload = f.read()<br/>        payload = bytearray(payload)</span><span id="f317" class="mm mn iq mi b gy ms mp l mq mr">response = runtime_client.invoke_endpoint(EndpointName=endpoint_name, <br/>                                       ContentType='application/x-image', <br/>                                       Body=payload)</span><span id="70ce" class="mm mn iq mi b gy ms mp l mq mr">result = response['Body'].read()<br/>    result = json.loads(result)<br/>    return result</span><span id="0a0f" class="mm mn iq mi b gy ms mp l mq mr"># wait until the status has changed<br/>client.get_waiter('endpoint_in_service').wait(EndpointName=endpoint_name)<br/>endpoint_response = client.describe_endpoint(EndpointName=endpoint_name)<br/>status = endpoint_response['EndpointStatus']<br/>if status != 'InService':<br/>    raise Exception('Endpoint creation failed.')</span><span id="1742" class="mm mn iq mi b gy ms mp l mq mr">for test_image in test_images:<br/>    result = get_predictions_for_img(runtime_client, endpoint_name, test_image)<br/>    confidence_threshold = .2<br/>    best_n = 3<br/>    # display the best n predictions with confidence &gt; confidence_threshold<br/>    predictions = [prediction for prediction in result['prediction'] if prediction[1] &gt; confidence_threshold]<br/>    predictions.sort(reverse=True, key = lambda x: x[1])<br/>    bboxes = [prediction_to_bbox_data(test_image, prediction) for prediction in predictions[:best_n]]<br/>    show_annotated_image(test_image, bboxes)</span></pre><p id="b772" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kn ja"> 5。使用模型调整作业的超参数优化。</strong></p><p id="c2c1" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">尽管我们已经创建并部署了我们的模型。为了提高模型的准确性，我们可能需要调整超参数。</p><p id="4cd5" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">要创建超参数优化作业，可以使用API或AWS控制台。你可以使用贝叶斯优化策略或随机搜索策略。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nn"><img src="../Images/f1be4f760782be74dc481da3434c88bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eg2fRJtGdIFuZpPMAF-KaA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图22</figcaption></figure><p id="5e86" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在职务定义中，参数几乎与培训职务部分相同。唯一的区别是您现在可以选择选项或指定范围。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi no"><img src="../Images/93e6a9ff358087971a85087cd1431b79.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y04T-4cVe9LLDkDEbpT2TQ.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图23</figcaption></figure><p id="dab5" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">训练、验证和输出通道的配置如下所示。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi np"><img src="../Images/ee26e1d55942020162d88c54eb997d47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Vjkb0GWyIyDHMzKfcKrgmw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图24</figcaption></figure><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nq"><img src="../Images/106824597ff00b89e2c5f43abeff549b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CH8HROsrbE4Z6DdSTknbHw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图25</figcaption></figure><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nr"><img src="../Images/46dbb9d83bb58b2cae1d972e95f698f6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eGNmT3Hmtm7-6wEtDjulpw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图26</figcaption></figure><p id="55a7" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">现在您可以配置资源了。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ns"><img src="../Images/495e3b0908a7aac1ccc39b4628719226.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PNBusDKNpRhTdj6bYl9e-g.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图27</figcaption></figure><p id="12bd" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在下一步中，您将指定资源限制。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nt"><img src="../Images/47b75eab6a460acc081442ae2a3d6e02.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h45EWP_-AK7aOV1VG74-Cg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图28</figcaption></figure><p id="d954" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">超参数作业完成后，您可以查看具有最佳客观指标值的作业历史记录</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ca"><img src="../Images/3fd8f11010ed1cfa2911859c3d0e22c2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E354LnGX-qSC3zHiJ4r2iA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">屏幕截图29</figcaption></figure><p id="9223" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">您可以从摘要中选择超参数的最佳组合。</p><figure class="ly lz ma mb gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nu"><img src="../Images/1e9041286ece1a4b193bceb2dd2be224.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fAIqGtIKKN0Ga9Wwn8Riog.png"/></div></div></figure><p id="b768" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated"><strong class="kn ja"> 6。如果需要，清理不必要的资源</strong></p><p id="33eb" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">您可以使用delete_endpoint API删除不必要的资源或端点。</p><pre class="ly lz ma mb gt mh mi mj mk aw ml bi"><span id="a5cc" class="mm mn iq mi b gy mo mp l mq mr">client.delete_endpoint(EndpointName=endpoint_name)</span></pre><p id="b8ac" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">真实世界用例中需要的数据工程方面超出了本文的范围。我们一定会在以后的文章中讨论这些设计原则。</p><p id="3c48" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">我们还将详细讨论如何在单个端点后使用多模型架构，转移一部分流量，进行A/B测试，并用新的生产变体替换模型。</p><p id="578c" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">如果你真的喜欢这篇文章，那么请考虑关注我，获取关于人工智能/机器学习、数据分析和商业智能的高质量内容和教程。</p><p id="9f6c" class="pw-post-body-paragraph kl km iq kn b ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li ij bi translated">在<a class="ae mf" href="https://www.linkedin.com/in/anurag-bisht-39935a59/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上查看我</p></div></div>    
</body>
</html>