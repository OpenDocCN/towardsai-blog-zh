<html>
<head>
<title>How To Build An ARIMA+GARCH Trading Strategy Using quantstart</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用quantstart建立ARIMA+GARCH交易策略</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-to-build-an-arima-garch-trading-strategy-using-quantstart-a6eec45b6f7d?source=collection_archive---------1-----------------------#2021-05-09">https://pub.towardsai.net/how-to-build-an-arima-garch-trading-strategy-using-quantstart-a6eec45b6f7d?source=collection_archive---------1-----------------------#2021-05-09</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="ef78" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-visualization" rel="noopener ugc nofollow" target="_blank">数据可视化</a></h2><div class=""/><figure class="gl gn ka kb kc kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi jz"><img src="../Images/05d6b0c2ccd4c20d480feb44203b5cc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*jFKrS5jyN4aXd8NT"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">马克西姆·霍普曼在<a class="ae ko" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><h1 id="073b" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">介绍</h1><p id="975a" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">在这篇文章中，我将展示我如何使用quant strat R软件包构建ARIMA+GARCH交易策略。</p><p id="76a6" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">我假设读者熟悉构成quantstrat交易策略的基本构件。如果不是这样，我强烈推荐阅读[1]的第1章到第5章。</p><p id="f934" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">可以在这个<a class="ae ko" href="https://github.com/hsm207/arimagarch_quantstrat" rel="noopener ugc nofollow" target="_blank">报告</a>中找到重现本文中描述的结果的代码。</p><h1 id="af59" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">动机</h1><p id="68e7" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我遇到的所有关于quantstrat的在线教程都使用了技术指标，这些指标可以通过<a class="ae ko" href="https://cran.r-project.org/web/packages/TTR/index.html" rel="noopener ugc nofollow" target="_blank"> TTR </a>包现成获得，以演示quant strat是如何工作的。我找不到任何描述如何建立自定义指标，所以我必须做一些探索，并认为我会分享我的发现。</p><h1 id="1ead" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">战略概述</h1><p id="d003" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我们将实施[2]中描述的策略。</p><p id="16ad" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">简而言之，该策略包括使用ARIMA+GARCH模型预测第二天的回报，该模型是在过去500天的回报滚动窗口上训练的。</p><p id="6a5d" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">如果预测的回报是正的，我们把它作为做多的信号，如果是负的，它是做空的信号。</p><h1 id="a7c4" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">实施细节</h1><h2 id="e370" class="mq kq it bd kr mr ms dn kv mt mu dp kz ly mv mw ld mc mx my lh mg mz na ll iz bi translated">资料组</h2><p id="7707" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我们将使用SPDR 标准普尔500交易所交易基金信托(股票代码:SPY)来评估这一交易策略。</p><p id="74bb" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">拟合ARIMA和GARCH模型是一项计算量很大的任务，因此为了节省时间，我们将使用可用数据的一小部分。我们将开始日期设定为2017年1月1日，结束日期设定为2021年5月2日。下面是数据的一个片段:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nb"><img src="../Images/f4a81c0762e462093b9551d3747f31e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EXLfaRf4On_d001p1ZmdSA.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图1:原始事物的样子</figcaption></figure><p id="e25f" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">专栏<code class="fe ng nh ni nj b">date</code>到<code class="fe ng nh ni nj b">adjusted</code>是从Yahoo！财务，而<code class="fe ng nh ni nj b">daily_return</code>是手动计算的，是基于<code class="fe ng nh ni nj b">close</code>价格的日志回报。</p><p id="b6e0" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">我们要让quantstrat知道这件事。一种方法是创建一个根据股票代码命名的全局变量，即SPY，并以xts格式指定tibble的值。这是如何做到的:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/f8dbf855a25bed2cd3da5b4f0da8ab99.png" data-original-src="https://miro.medium.com/v2/resize:fit:1194/format:webp/1*QnWuvq1kgnTugr3SjKKMmQ.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图quantstrat看到的数据</figcaption></figure><h2 id="31fc" class="mq kq it bd kr mr ms dn kv mt mu dp kz ly mv mw ld mc mx my lh mg mz na ll iz bi translated">构建指标</h2><p id="52af" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">该指标基于GARCH(1，1)模型的预测，其ARIMA阶(即p和q (d设置为0 ))是通过拟合过去回报的最佳ARIMA模型得到的。如果预测的下一期回报率为正，则指标应返回1，否则返回-1。</p><p id="32ff" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">这是一个复杂的指标，因此将其分解成几个较小的函数会有助于避免错误。</p><p id="4d09" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">首先，我们有一个函数，它将找到给定单变量时间序列的最佳ARIMA模型，并返回AR(即p)和MA(即q)顺序的值:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/e66df7dbb583283c610e9eb1d1a19269.png" data-original-src="https://miro.medium.com/v2/resize:fit:904/format:webp/1*vckYmlf7VcBgRhHr2d0ugQ.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图3:如何找到最佳p和q</figcaption></figure><p id="e4cd" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">接下来，给定一个单变量时间序列和期望的AR和MA顺序，我们编写一个适合GARCH(1，1)模型的函数:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div class="gh gi nm"><img src="../Images/343db0258ead29cafb3bbd7da4b8b716.png" data-original-src="https://miro.medium.com/v2/resize:fit:944/format:webp/1*onwaDop6AeqEZ_36PSU2MA.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图4:符合GARCH(1，1)模型的逻辑</figcaption></figure><p id="d998" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">请注意，我们将对<code class="fe ng nh ni nj b">ugarchfit</code>的调用包装在一个<code class="fe ng nh ni nj b">tryCatch</code>调用中，这样我们就可以知道fit何时无法收敛(如果发生这种情况，函数将抛出警告，这就是为什么我们要捕捉它)。</p><p id="ba3e" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">将所有内容放在一起，我们现在可以编写函数来计算我们在本节开始时描述的指标:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nn"><img src="../Images/ffac140cdff0ea864217760bf485735d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5a6tkWZyf_TVhsRR9IQ6kA.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图5:ARIMA+GARCH指标</figcaption></figure><p id="5ca5" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">请注意，我们已经决定返回1，以防GARCH(1，1)模型无法收敛。</p><p id="53ff" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">当给定一个单变量时间序列时，图5中的函数工作良好。但要让它与quantstrat一起工作，还有一些工作要做。</p><p id="b377" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">我们需要告诉quantstrat如何使用图2中的数据来计算指标的滚动版本:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi no"><img src="../Images/4f9ae6aa887b90e1c7fef5104574e14e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ic07aiHejcv6pLNc3ytKfA.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图6:滚动ARIMA+GARCH指标</figcaption></figure><p id="1d1b" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">图6中的函数将图2中的数据、窗口大小和列名作为参数，我们希望它们符合ARIMA+GARCH模型。由于quanstrat期望数据是xts对象，并且该函数使用<a class="ae ko" href="https://github.com/business-science/tidyquant" rel="noopener ugc nofollow" target="_blank"> tidyquant </a>包来实现期望数据是tibble对象的滚动逻辑，我们需要在这两个对象之间来回转换。</p><p id="3271" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">最后，我们可以将ARIMA+GARCH指标添加到我们想要回测的策略中:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div class="gh gi np"><img src="../Images/ade01d88d668abfdd1a8d0d75dfe09a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:774/format:webp/1*vcVcqgV2d5nDijof7yVEdQ.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图7:将ARIMA+GARCH指标添加到策略中</figcaption></figure><h2 id="0a84" class="mq kq it bd kr mr ms dn kv mt mu dp kz ly mv mw ld mc mx my lh mg mz na ll iz bi translated">产生信号</h2><p id="f0fa" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">当ARIMA+GARCH指标为1时，我们要做多，当指标为-1时，我们要做空。该代码片段将创建两个布尔列来指示我们应该何时这样做:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/25a723d7e46344e96a4fa2d270da349b.png" data-original-src="https://miro.medium.com/v2/resize:fit:646/format:webp/1*v4ZhRMlgqx23xv7KaDpJNQ.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图8:何时做多/做空</figcaption></figure><h2 id="dd8f" class="mq kq it bd kr mr ms dn kv mt mu dp kz ly mv mw ld mc mx my lh mg mz na ll iz bi translated">交换信号</h2><p id="9fb1" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">我们需要做的最后一件事是告诉quantstrat如何交易信号。我们会让事情变得简单。</p><p id="bf53" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">对于空缺职位:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/02b4dc81b57d99a3fd1fc6c87e5f117f.png" data-original-src="https://miro.medium.com/v2/resize:fit:578/format:webp/1*BFHYkEsM3Jxo5gRyP8koKg.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图9:如何开仓多空</figcaption></figure><p id="b269" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">对于平仓:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/13b46c811367254f593e147a92a03b43.png" data-original-src="https://miro.medium.com/v2/resize:fit:528/format:webp/1*KgxSIyDDPD4TVOGfd-VDog.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图9:如何退出多头和空头头寸</figcaption></figure><p id="81d2" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">除了这些规则之外，我们还对任何给定的多头或空头头寸规定了4，439的最大持有量。在这个数量上，我们几乎用完了我们所有的初始资本100万美元。非常不现实，特别是对于一个短期职位，但无论如何。我们也不想立即持有最大头寸，所以每个订单都是最大持有量的一半。以下是施加这些约束的代码:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div class="gh gi nt"><img src="../Images/f9baa2110e6068412240be72238de306.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*evmVpHYK4oPfmvTBtyWKmA.png"/></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图10:订单大小的约束</figcaption></figure><h1 id="d75a" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结果</h1><p id="b268" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">这种交易策略的结果真是可悲:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nu"><img src="../Images/30a833c30344e2954bccc4cdf0a67827.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jMJdS60yevYHwW34heMNbQ.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图11:策略的年度“风险”和回报</figcaption></figure><p id="856a" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">这是该策略与买入并持有策略的对比:</p><figure class="nc nd ne nf gt kd gh gi paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gh gi nv"><img src="../Images/6803bcb45b548567f4e2fe213b8e9b2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6RZEdNgtD1leyu8fybZO5Q.png"/></div></div><figcaption class="kk kl gj gh gi km kn bd b be z dk translated">图12:ARIMA+GARCH策略与买入并持有策略</figcaption></figure><p id="5d37" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">这种策略的表现一直不如买入并持有。然而，直到2020年1月，它仍能产生可观的回报。新冠肺炎崩盘后，ARIMA+GARCH指标的预测信号似乎明显恶化，因为它仍未从2021年4月的下跌中恢复过来，但自2020年9月以来，买入并持有一直在创下新高。</p><p id="a1ce" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">回购中有更多的统计数据。</p><h1 id="7af6" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">结论</h1><p id="ba77" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">本文展示了如何使用quantstrat对包含自定义指标的交易策略进行回溯测试。quantstrat和R丰富的统计程序库的结合使得建立和测试包含复杂统计计算的交易策略变得非常容易。</p><h1 id="0299" class="kp kq it bd kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll lm bi translated">参考</h1><p id="01b1" class="pw-post-body-paragraph ln lo it lp b lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh mi mj mk im bi translated">[1] <a class="ae ko" href="https://timtrice.github.io/backtesting-strategies/" rel="noopener ugc nofollow" target="_blank">用R </a>回测策略。蒂姆·崔斯。2016.最后访问时间2021年5月6日。</p><p id="d507" class="pw-post-body-paragraph ln lo it lp b lq ml ls lt lu mm lw lx ly mn ma mb mc mo me mf mg mp mi mj mk im bi translated">[2] <a class="ae ko" href="https://www.quantstart.com/articles/ARIMA-GARCH-Trading-Strategy-on-the-SP500-Stock-Market-Index-Using-R/" rel="noopener ugc nofollow" target="_blank"> ARIMA+GARCH交易策略对S &amp; P500股票市场指数使用R </a>。QuantStart。最后访问时间2021年5月6日。</p></div></div>    
</body>
</html>