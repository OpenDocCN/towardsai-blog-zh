<html>
<head>
<title>Automate Testing of TensorFlow Lite Model Implementation</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">TensorFlow Lite模型实现自动化测试</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/automate-testing-of-tensorflow-lite-model-implementation-5d1e919f7e07?source=collection_archive---------0-----------------------#2019-06-13">https://pub.towardsai.net/automate-testing-of-tensorflow-lite-model-implementation-5d1e919f7e07?source=collection_archive---------0-----------------------#2019-06-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/1216c6efe63f819dcc2527ea835e876c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q5mz8mhhRwWA4SJMrfDGxg.png"/></div></div></figure><h2 id="a870" class="jc jd je bd b dl jf jg jh ji jj jk dk jl translated" aria-label="kicker paragraph">测试TensorFlow Lite | <a class="ae ep" href="https://towardsai.net" rel="noopener ugc nofollow" target="_blank">朝向AI </a></h2><div class=""/><div class=""><h2 id="b0db" class="pw-subtitle-paragraph kk jn je bd b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dk translated">确保您的ML模型在移动应用程序上正确工作(第2部分)</h2></div><p id="1b19" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><em class="ly">本文最初发表于</em><a class="ae lz" href="https://thinkmobile.dev" rel="noopener ugc nofollow" target="_blank"><em class="ly">think mobile . dev</em></a><em class="ly">—一个关于在移动应用中实现智能解决方案的博客(</em> <a class="ae lz" href="https://thinkmobile.dev/automate-testing-of-tensorflow-lite-model-implementation/" rel="noopener ugc nofollow" target="_blank"> <em class="ly">链接到文章</em> </a> <em class="ly">)。</em></p><p id="a534" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这是关于测试为移动设备创建的机器学习模型的第二篇文章。在之前的帖子— <a class="ae lz" href="https://thinkmobile.dev/testing-tensorflow-lite-image-classification-model/" rel="noopener ugc nofollow" target="_blank">测试TensorFlow Lite图像分类模型</a>中，我们构建了一个笔记本，将TensorFlow模型导出到TensorFlow Lite，并并排比较它们。但是因为转换过程大多是自动的，所以没有太多地方可以打破一些东西。我们可以发现量化和非量化模型之间的差异，或者确保TensorFlow Lite的工作方式与TensorFlow相似，但真正的问题可能出现在其他地方——客户端实现。<br/>在这篇文章中，我将建议一些在Android应用程序端测试TensorFlow Lite模型的解决方案。</p><h1 id="3d63" class="ma mb je bd mc md me mf mg mh mi mj mk kt ml ku mm kw mn kx mo kz mp la mq mr bi translated">测试自动化</h1><p id="b9d2" class="pw-post-body-paragraph lc ld je le b lf ms ko lh li mt kr lk ll mu ln lo lp mv lr ls lt mw lv lw lx im bi translated">通常，最初的实现依赖于手工测试。如果我们有一个像MobileNet这样的模型，我们可以把它放到应用程序中，在一个设备上运行，只需指出我们周围一些物体上的摄像头，就可以看到结果。像旋转位图或不良裁剪这样的问题会导致突出的分类。</p><p id="4565" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">以后就没那么容易了。我们将添加更复杂的图像预处理(例如在<a class="ae lz" href="https://thinkmobile.dev/mobile-intelligence-tensorflow-lite-classification-on-android/" rel="noopener ugc nofollow" target="_blank"> MNIST分类器</a>的博客文章中，颜色被反转，对比度被提高)。我们会纠结位图到字节缓冲区的转换(应该是每个像素的[0，1]值范围，还是[-1，1]，还是YUV或者RGB格式？).如果我们用更新的、改进的版本来更新这个模型呢？如何确保我们没有打破任何东西？</p><h1 id="2cb9" class="ma mb je bd mc md me mf mg mh mi mj mk kt ml ku mm kw mn kx mo kz mp la mq mr bi translated">TF Lite模型的Android仪器测试</h1><p id="b749" class="pw-post-body-paragraph lc ld je le b lf ms ko lh li mt kr lk ll mu ln lo lp mv lr ls lt mw lv lw lx im bi translated">在Android上测试TensorFlow Lite模型，尤其是在模拟器上，并不简单。影像分类是一个多步骤的过程，如下所示:</p><ol class=""><li id="91e5" class="mx my je le b lf lg li lj ll mz lp na lt nb lx nc nd ne nf bi translated">从设备的照相机捕捉图像或帧。</li><li id="13cb" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nc nd ne nf bi translated">预处理位图(裁剪、旋转、变换或颜色增强)。</li><li id="7044" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nc nd ne nf bi translated">将位图转换为机器学习模型支持的格式。</li><li id="c634" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nc nd ne nf bi translated">运行推理。</li><li id="682b" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nc nd ne nf bi translated">解释结果并显示出来。</li></ol><p id="d8b1" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">简单的单元测试在某些地方可能会有所帮助，但是为了确保整个过程正确工作，这个流程需要更高层次的东西。它的完美候选可以是UI测试框架— <a class="ae lz" href="https://developer.android.com/training/testing/espresso" rel="noopener ugc nofollow" target="_blank"> Espresso </a>。</p><p id="9884" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">Espresso是为在设备或模拟器上运行的<a class="ae lz" href="https://developer.android.com/training/testing/unit-testing/instrumented-unit-tests" rel="noopener ugc nofollow" target="_blank">仪器测试</a>而设计的，因此它们可以充分受益于Android APIs。这就是我们在这里需要的——访问资产(加载tflite模型)，或者访问UI(验证结果是否正确显示)。<br/>在这里，我们将构建一些测试来检查移动应用程序上的推理过程是否会给出与Colab笔记本上相同的结果。<br/>但在他们之前，我们先来看看一些局限性。</p><h1 id="6100" class="ma mb je bd mc md me mf mg mh mi mj mk kt ml ku mm kw mn kx mo kz mp la mq mr bi translated">仪器测试的局限性</h1><p id="a192" class="pw-post-body-paragraph lc ld je le b lf ms ko lh li mt kr lk ll mu ln lo lp mv lr ls lt mw lv lw lx im bi translated">在撰写本文时，Espresso或Android测试的工作方式存在一些限制。以下是其中的一些:</p><p id="b06e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo">模仿相机预览</strong>并不容易。最近，由于增强现实的支持，可以在Android模拟器上<a class="ae lz" href="https://developers.google.com/ar/develop/c/emulator" rel="noopener ugc nofollow" target="_blank">模拟虚拟场景，但这既不能自动完成，也不容易将图像放在那里以获得完全可预测的结果。</a></p><figure class="nm nn no np gt iv gh gi paragraph-image"><div class="gh gi nl"><img src="../Images/47c0cc954ad521ceb43aeeb1663a1646.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/0*Rcbg-fRzUN1A8UaD"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">Android模拟器中的虚拟场景在验证MobileNet等通用模型时会很有帮助</figcaption></figure><p id="d8ff" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><strong class="le jo">如果不将调试视图或管理测试资源包含在应用程序的源代码中，就不容易添加调试视图或管理测试资源</strong>。在这里，我们将添加来自验证批处理的图像，并构建自定义活动来预览结果。如果我们不想将这些资源和代码添加到应用程序中，并将其保存在<strong class="le jo"> androidTest </strong> /目录中，那么这样做有点棘手。<br/>先睹为快:我们将需要为我们想要测试的机器学习模型创建一个单独的Android模块。</p><h1 id="d234" class="ma mb je bd mc md me mf mg mh mi mj mk kt ml ku mm kw mn kx mo kz mp la mq mr bi translated">客户端测试的数据</h1><p id="6419" class="pw-post-body-paragraph lc ld je le b lf ms ko lh li mt kr lk ll mu ln lo lp mv lr ls lt mw lv lw lx im bi translated">在构建Android应用之前，我们将扩展用于TensorFlow和TensorFlow Lite比较的<a class="ae lz" href="https://colab.research.google.com/github/frogermcs/TFLite-Tester/blob/master/notebooks/Testing_TFLite_model.ipynb" rel="noopener ugc nofollow" target="_blank"> Colab笔记本代码</a>。它应该导出具有预期结果的验证批次数据，这样我们可以稍后在移动应用程序上比较它们。</p><p id="eacc" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们希望有一个32图像(默认批量大小)的档案，这是自我描述。我们将使用文件名格式<strong class="le jo"> n{}_true{}_pred{}。jpg </strong>其中第一个数字是索引，第二个数字是真实标签索引，最后一个数字是当前tflite模型预测的标签索引。</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">将验证数据批次导出至存档</figcaption></figure><p id="2f6e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">以全质量导出图像是很重要的，所以我们确信Colab笔记本中的tflite模型和移动应用程序中的模型使用相同的输入数据。</p><p id="5363" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">生成的图像将被放入Android应用程序测试代码中的<strong class="le jo"> /asset </strong>目录。</p><h1 id="d057" class="ma mb je bd mc md me mf mg mh mi mj mk kt ml ku mm kw mn kx mo kz mp la mq mr bi translated">TensorFlow Lite型号的浓缩咖啡测试</h1><figure class="nm nn no np gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nw"><img src="../Images/ee8eed04af8597242ea67daea41b5e67.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*RjFuZN-ltzPFbEzy"/></div></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">浓缩咖啡测试检查验证数据批次预览。</figcaption></figure><p id="c5a3" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在关于测试TFLite模型的<a class="ae lz" href="https://thinkmobile.dev/testing-tensorflow-lite-image-classification-model/" rel="noopener ugc nofollow" target="_blank">博文</a>中，我们构建了一个笔记本，为花卉分类创建TensorFlow Lite模型。代码可从Github库获得:<a class="ae lz" href="https://github.com/frogermcs/TFLite-Tester" rel="noopener ugc nofollow" target="_blank"> TFLite-Tester </a>。<br/>现在我们将添加实现它的Android项目，这样我们就可以用设备的摄像头做分类了。之后，我们将添加一些浓缩咖啡测试来自动化QA过程。</p><p id="3b00" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">示例Android应用程序将由两个模块组成:</p><ul class=""><li id="aada" class="mx my je le b lf lg li lj ll mz lp na lt nb lx nx nd ne nf bi translated"><strong class="le jo"> app </strong> —带相机预览的应用模块(使用<a class="ae lz" href="https://github.com/natario1/CameraView" rel="noopener ugc nofollow" target="_blank">相机视图库</a>)，</li><li id="808e" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nx nd ne nf bi translated"><strong class="le jo"> ml_model </strong> — Android库模块，实现了在Colab笔记本中创建的机器学习模型。</li></ul><h1 id="2eaa" class="ma mb je bd mc md me mf mg mh mi mj mk kt ml ku mm kw mn kx mo kz mp la mq mr bi translated">应用代码</h1><p id="56ee" class="pw-post-body-paragraph lc ld je le b lf ms ko lh li mt kr lk ll mu ln lo lp mv lr ls lt mw lv lw lx im bi translated">应用程序代码很简单——有两个类:<code class="fe ny nz oa ob b">MainActivity</code>显示相机预览和分类结果:</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">MainActivity显示摄像机预览和分类结果。</figcaption></figure><p id="0df9" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">而<code class="fe ny nz oa ob b">ClassificationFrameProcessor</code>是<strong class="le jo"> ml_model </strong>库中摄像机预览和分类逻辑之间的接口。</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">ClassificationFrameProcessor只是相机预览屏幕和机器学习分类逻辑在单独模块中的接口。</figcaption></figure><h1 id="5cbd" class="ma mb je bd mc md me mf mg mh mi mj mk kt ml ku mm kw mn kx mo kz mp la mq mr bi translated">机器学习模型库</h1><p id="4bc6" class="pw-post-body-paragraph lc ld je le b lf ms ko lh li mt kr lk ll mu ln lo lp mv lr ls lt mw lv lw lx im bi translated">ml_model Android库中的代码稍微复杂一点。它加载*。tflite文件和模型标签，将位图转换为适当的格式，并在TF Lite模型上运行推理过程。大多数逻辑驻留在<code class="fe ny nz oa ob b">ModelClassificator</code>类中。</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">模型分类器加载模型和标签，运行推理过程并解释其结果</figcaption></figure><p id="5e28" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这里就不赘述了。如果您想了解更多信息，请查看以下文章:</p><ul class=""><li id="e9ec" class="mx my je le b lf lg li lj ll mz lp na lt nb lx nx nd ne nf bi translated"><a class="ae lz" href="https://thinkmobile.dev/mobile-intelligence-tensorflow-lite-classification-on-android/" rel="noopener ugc nofollow" target="_blank">安卓上的TensorFlow Lite分类</a></li><li id="f1b5" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nx nd ne nf bi translated"><a class="ae lz" href="https://thinkmobile.dev/inspecting-tensorflow-lite-image-classification-model/" rel="noopener ugc nofollow" target="_blank">检验TensorFlow Lite影像分类模型</a></li></ul><p id="1d3c" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果我们运行我们的应用程序，它会对相机预览进行实时分类。</p><h1 id="f18c" class="ma mb je bd mc md me mf mg mh mi mj mk kt ml ku mm kw mn kx mo kz mp la mq mr bi translated">仪器测试代码</h1><p id="4add" class="pw-post-body-paragraph lc ld je le b lf ms ko lh li mt kr lk ll mu ln lo lp mv lr ls lt mw lv lw lx im bi translated"><strong class="le jo">重要通知:</strong>如“限制”一段所述，下面描述的测试代码结构只可能出现在<strong class="le jo">Android库项目</strong>中。原因是调试和AndroidManifest.xml文件的活动是分开的。<br/>在一个标准的Android app模块中，manifest已经存在于代码中，所以它不能被来自<strong class="le jo"> androidTest/ </strong>目录的manifest替换。</p><p id="4825" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在<strong class="le jo"> androidTest/ </strong>目录中，我们将重新创建整个Android项目结构，包括:</p><ul class=""><li id="e7a3" class="mx my je le b lf lg li lj ll mz lp na lt nb lx nx nd ne nf bi translated"><strong class="le jo">资产</strong> —验证数据批次，</li><li id="0a5f" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nx nd ne nf bi translated">java  —用于测试和调试/预览的代码，</li><li id="7301" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nx nd ne nf bi translated"><strong class="le jo"> AndroidManifest.xml </strong> —预览活动需要在此注册，</li><li id="83db" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nx nd ne nf bi translated"><strong class="le jo">RES</strong>—Activity和AndroidManifest所需的所有资源。</li></ul><figure class="nm nn no np gt iv gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/cf42b1bbaeb7a544bb032c2988dfb7b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/0*lLZARlNKkIJ3RIV-"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">ml _模型库测试的项目结构</figcaption></figure><p id="2685" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">现在我们将构建<code class="fe ny nz oa ob b">ModelTestActivity</code>——可视化UI测试的活动，同时也让Espresso有可能断言一些布局逻辑。</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">ModelTestActivity不是应用程序代码的一部分。它驻留在androidTest目录中，不会包含在客户端应用程序中。</figcaption></figure><p id="b101" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><code class="fe ny nz oa ob b">ModelTestActivity</code>有一个模型分类实例，所以它可以自己运行推理过程(<code class="fe ny nz oa ob b">classifyImage()</code>方法)。其他方法如<code class="fe ny nz oa ob b">setImagePreview()</code>或<code class="fe ny nz oa ob b">showClassificationResults()</code>在这里只是为了可视化测试过程。</p><h2 id="bf34" class="od mb je bd mc oe of dn mg og oh dp mk ll oi oj mm lp ok ol mo lt om on mq jk bi translated">试验</h2><p id="393b" class="pw-post-body-paragraph lc ld je le b lf ms ko lh li mt kr lk ll mu ln lo lp mv lr ls lt mw lv lw lx im bi translated">现在让我们写一些测试。首先，我们想看看我们的<code class="fe ny nz oa ob b">ModelTestActivity</code>中的推理过程是否工作并显示出期望的结果。为此，我们将尝试对保存在<strong class="le jo">androidTest/assets/tulip . jpg</strong>中的郁金香图像进行分类。</p><figure class="nm nn no np gt iv gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/737fa9b09e1c9e91745468a0d3e792d2.png" data-original-src="https://miro.medium.com/v2/resize:fit:500/0*JQ4w7ULh7xwwhI9T"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">郁金香图片取自TensorFlow flower_photos <a class="ae lz" href="https://storage.googleapis.com/download.tensorflow.org/example_images/flower_photos.tgz" rel="noopener ugc nofollow" target="_blank">数据集</a>。</figcaption></figure><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">MLModelTest包含TensorFlow Lite模型的仪器测试。</figcaption></figure><p id="3bdb" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">代码看起来很简单，但是有一些事情需要注意。首先，我们使用<code class="fe ny nz oa ob b">ModelTestActivity</code>，它是<strong class="le jo">测试</strong> APK的一部分(不是<strong class="le jo">测试的</strong>那个)。值得了解的是，这里到底测试的是什么。不是UI，而是<code class="fe ny nz oa ob b">ModelClassificator.process()</code>及其背后的逻辑(位图预处理，推理过程)。同样，方法:<code class="fe ny nz oa ob b">ResultsUtils.resultsToStr()</code>使推理结果人性化。<br/>虽然这个测试让我们对分类流程有了很好的了解，但它不能很好地检查模型的准确性。</p></div><div class="ab cl op oq hx or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="im in io ip iq"><p id="bd96" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">让我们创建另一个测试——根据验证数据批次检查模型的测试。值得一提的是，这里的活动是完全不需要的，我们将使用它只是为了预览测试过程。</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">MLModelTest检查TFLite模型的验证数据批次</figcaption></figure><p id="a651" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">该测试假设在<strong class="le jo">androidTest/assets/val _ batch/</strong>目录中有图像。<br/>这些是我们在Colab笔记本中创建的图像:</p><figure class="nm nn no np gt iv gh gi paragraph-image"><div class="gh gi ow"><img src="../Images/2c1cb2897d14d241c022ebee25174bf4.png" data-original-src="https://miro.medium.com/v2/resize:fit:552/0*QhBXflFbNUpJ2lfq"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">va_batch包含来自验证数据批次的32个图像。</figcaption></figure><p id="c51b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><code class="fe ny nz oa ob b">ModelClassificator</code>在每幅图像上运行推理过程，并将结果放入<code class="fe ny nz oa ob b">batchClassificationResults</code>图中。基于文件名，我们构建了另一个映射——<code class="fe ny nz oa ob b">batchClassificationExepectedResults</code>，它包含了预期的结果(来自运行在Colab notebook上的推理过程)。<br/>最后，我们将使用<a class="ae lz" href="https://truth.dev/" rel="noopener ugc nofollow" target="_blank">Truth</a>——在Java和Android代码中执行更复杂断言的库(kudos <a class="ae lz" href="https://twitter.com/DBarwacz" rel="noopener ugc nofollow" target="_blank">张秀坤</a>向我展示了这一点！).当测试出现问题时，下面是它的输出示例:</p><figure class="nm nn no np gt iv"><div class="bz fp l di"><div class="nu nv l"/></div><figcaption class="nq nr gj gh gi ns nt bd b be z dk translated">Truth执行复杂的断言，如并排地图比较。</figcaption></figure><p id="71b5" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">旁注—您知道这个输出是如何产生的吗？在实现模型时，我在字节缓冲区中使用了不同的值范围([-1，1]而不是[0，1])。32幅图像中只有两幅显示了不同的分类结果。在手动测试中发现它的可能性有多大？</p><p id="23e0" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">知道测试什么<br/>上面的测试涵盖了分类过程的很大一部分，但不是全部。下面是我们的测试所检查的操作(只有快乐的路径):</p><ul class=""><li id="c5df" class="mx my je le b lf lg li lj ll mz lp na lt nb lx nx nd ne nf bi translated">❌从相机预览中获取帧，</li><li id="7d20" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nx nd ne nf bi translated">❌转换相机帧(特定于我们使用的库)为位图，</li><li id="29da" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nx nd ne nf bi translated">✅位图预处理并将其转换为模型的输入数据，</li><li id="6153" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nx nd ne nf bi translated">✅运行推论，</li><li id="2430" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nx nd ne nf bi translated">✅阅读分类结果，</li><li id="e96e" class="mx my je le b lf ng li nh ll ni lp nj lt nk lx nx nd ne nf bi translated">✅介绍他们。</li></ul><p id="30b3" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如你所见，我们有一些东西，但肯定的是，它远非完美。够不够？通常由我们决定。但是至少我们应该知道到底什么是测试的，什么是不测试的。</p><p id="f2a2" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">希望这篇文章能为如何让TF Lite机型的QA流程更加自动化带来一些启发。</p><p id="6d3a" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">源代码，参考资料<br/>这篇博文的源代码可以在Github (Colab笔记本和移动应用程序)上找到:<a class="ae lz" href="https://github.com/frogermcs/TFLite-Tester" rel="noopener ugc nofollow" target="_blank">https://github.com/frogermcs/TFLite-Tester</a></p><p id="341e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">笔记本完整代码:<a class="ae lz" href="https://colab.research.google.com/github/frogermcs/TFLite-Tester/blob/master/notebooks/Testing_TFLite_model.ipynb" rel="noopener ugc nofollow" target="_blank">链接</a>。</p><div class="is it gp gr iu ox"><a href="https://colab.research.google.com/github/frogermcs/TFLite-Tester/blob/master/notebooks/Testing_TFLite_model.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd jo gy z fp pc fr fs pd fu fw jn bi translated">谷歌联合实验室</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">编辑描述</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">colab.research.google.com</p></div></div><div class="pg l"><div class="ph l pi pj pk pg pl ja ox"/></div></div></a></div><p id="c58e" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">感谢阅读！🙂请在下面分享您的反馈。👇</p></div><div class="ab cl op oq hx or" role="separator"><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou ov"/><span class="os bw bk ot ou"/></div><div class="im in io ip iq"><p id="3089" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">如果您想知道如何将您的TensorFlow Lite模型与其TensorFlow实现进行比较，请查看这篇博文:</p><div class="is it gp gr iu ox"><a href="https://thinkmobile.dev/testing-tensorflow-lite-image-classification-model/" rel="noopener  ugc nofollow" target="_blank"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd jo gy z fp pc fr fs pd fu fw jn bi translated">测试TensorFlow Lite图像分类模型“思考，移动！</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">确保您的ML模型在移动应用程序(第1部分)上正确工作，寻找如何自动测试TensorFlow…</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">thinkmobile.dev</p></div></div><div class="pg l"><div class="pm l pi pj pk pg pl ja ox"/></div></div></a></div><p id="5778" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated"><em class="ly">本文最初发表于</em><a class="ae lz" href="https://thinkmobile.dev" rel="noopener ugc nofollow" target="_blank"><em class="ly">think mobile . dev</em></a><em class="ly">—一个关于在移动应用中实现智能解决方案的博客(</em> <a class="ae lz" href="https://thinkmobile.dev/automate-testing-of-tensorflow-lite-model-implementation/" rel="noopener ugc nofollow" target="_blank"> <em class="ly">链接到文章</em> </a> <em class="ly">)。</em></p><div class="is it gp gr iu ox"><a href="https://thinkmobile.dev/automate-testing-of-tensorflow-lite-model-implementation/" rel="noopener  ugc nofollow" target="_blank"><div class="oy ab fo"><div class="oz ab pa cl cj pb"><h2 class="bd jo gy z fp pc fr fs pd fu fw jn bi translated">TensorFlow Lite模型实现的自动化测试“思考，移动！</h2><div class="pe l"><h3 class="bd b gy z fp pc fr fs pd fu fw dk translated">确保您的ML模型在移动应用程序上正确工作(第2部分)这是关于测试机器的第2篇文章…</h3></div><div class="pf l"><p class="bd b dl z fp pc fr fs pd fu fw dk translated">thinkmobile.dev</p></div></div><div class="pg l"><div class="pn l pi pj pk pg pl ja ox"/></div></div></a></div></div></div>    
</body>
</html>