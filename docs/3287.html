<html>
<head>
<title>Amazing SQL Queries for Data Science</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学的惊人SQL查询</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/useful-intermediate-sql-queries-for-data-science-408c724b67d0?source=collection_archive---------0-----------------------#2022-11-07">https://pub.towardsai.net/useful-intermediate-sql-queries-for-data-science-408c724b67d0?source=collection_archive---------0-----------------------#2022-11-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="239e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">SQL是开发人员、工程师和数据专业人员的基本语言。SQL中级知识让您在数据科学职业生涯中占据优势。</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/76b5a076913c7e7f4a41d82b15a78c61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CaggAi8cFuMRXd883vGkfw.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">由<a class="ae kv" href="https://unsplash.com/s/photos/data-science?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae kv" href="https://unsplash.com/@theshubhamdhage?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Shubham Dhage </a>拍摄的照片</figcaption></figure><p id="16c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因此，在这篇文章中，我们将讨论一些数据专业人员的基本中间SQL查询。我们将讨论4个SQL查询，问题是，为什么要学习这4个SQL查询？</p><p id="da89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们都熟悉用<strong class="ky ir"> SQL、</strong>创建数据库，但更重要的是知道如何根据我们的需要有效地清理和过滤数据。这些查询就是这样帮助我们的，所以让我们看看这些查询是什么</p><ol class=""><li id="8fc5" class="ls lt iq ky b kz la lc ld lf lu lj lv ln lw lr lx ly lz ma bi translated"><strong class="ky ir">SQL中的触发器，</strong>以及如何在我们的查询中使用？</li><li id="09e5" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">SQL中的</strong>分区</li><li id="6829" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated">SQL中的<strong class="ky ir"> Limit，</strong>以及我们如何使用<strong class="ky ir"> LIMIT </strong>语法来限制我们在SQL表中的查询？</li><li id="57ae" class="ls lt iq ky b kz mb lc mc lf md lj me ln mf lr lx ly lz ma bi translated"><strong class="ky ir">SQL中的COALESCE函数</strong>，它如何帮助我们摆脱<strong class="ky ir">空值</strong>？</li></ol><h1 id="97b0" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated"><strong class="ak"> 1。SQL中的触发器</strong></h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi my"><img src="../Images/0014ecc35c2cc2dc4a2412d74568e0bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*TMki6yvi-qussqoKljfqKQ.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">SQL中的触发器|来源:作者图片</figcaption></figure><p id="e8b8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在本帖中，我们将讨论SQL中<strong class="ky ir">触发器的威力。</strong></p><p id="19f2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">什么是SQL中的触发器？</strong></p><p id="6e74" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">触发器是一个SQL代码，在事件执行时自动运行。例如:在下面的查询中，当用户试图在表中插入值时，我们的触发器运行。</p><p id="4864" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">触发器主要分为三个部分</p><p id="f8da" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 1。触发_时间<br/> 2。触发_事件<br/> 3。表名</strong></p><p id="9c2a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 1。Trigger_Time: </strong>触发时间是指您希望该触发器运行的时间，例如，在事件之前或之后。<br/>在我们下面的查询中，我们使用了before why？因为我们希望代码在插入到表中之前运行。</p><p id="98a4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 2。Trigger_Event: </strong>触发事件是当我们想要运行这个触发器时，比如<strong class="ky ir">插入</strong>、<strong class="ky ir">更新</strong>、<strong class="ky ir">删除</strong></p><p id="c71f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在上面的例子中，我们使用INSERT，因为我们希望在执行INSERT事件时运行我们的触发器。</p><p id="95be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 3。表名:</strong>表名是我们的表的名称</p><p id="654c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">所以让我们用一个合适的实用解释来详细讨论触发器语法</strong></p><p id="ea3d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在从<strong class="ky ir">开始</strong>到<strong class="ky ir">结束</strong>的这段代码中，每当我们在投票者表中插入一个值时，触发器都会检查年龄，是小于18岁还是大于18岁。如果它大于或等于18，什么都不会发生，但如果它小于18，触发器将显示一个错误，我们设置消息。</p><p id="fe63" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">例如，见上图，<strong class="ky ir">我们设置message_text = ' age必须是&gt; =18 '，</strong>所以每当我们试图<strong class="ky ir">插入小于18的值时，这个错误消息显示</strong>。在输出部分，当我们试图插入17岁的Andrew时，查询显示一个错误，其中包含我们的<strong class="ky ir">定制消息</strong>。这就是SQL中的触发器以及如何在查询中使用它们。</p><p id="0ff7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">查看以下代码，获得更实际的理解</strong></p><pre class="kg kh ki kj gt mz na nb bn nc nd bi"><span id="a95d" class="ne mh iq na b be nf ng l nh ni">DELIMITER $$<br/>/* creating a trigger whose name is age_checker */<br/>  CREATE TRIGGER age_checker<br/>     /* defining when our trigger run before inserting or after inserting<br/>        in our case we choose before inserting that's why we use BEFORE */<br/>      BEFORE INSERT ON Voter FOR EACH ROW<br/>      BEGIN <br/>     /* Now we are checking the inserted value in our age column if it is <br/>        less then 18 then show our error message */ <br/>        IF NEW.age &lt; 18<br/>        THEN <br/>           SIGNAL SQLSTATE '45000'<br/>              /* setting our error message in the MESSAGE_TEXT */<br/>              SET MESSAGE_TEXT = 'AGE MUST BE &gt;= 18';<br/>        END IF;<br/>     END;<br/>DELIMETER;</span></pre><h1 id="48be" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated"><strong class="ak"> 2。SQL中的分区依据</strong></h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/c672896d1f4b8852e14b44ae43f82465.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kBVqjH0II7gX_vJQEVNemw.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">SQL中的分区依据|来源:作者图片</figcaption></figure><p id="f1ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这篇文章将讨论<strong class="ky ir">分区</strong>以及如何在SQL中使用它。</p><p id="de11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以第一个问题是，SQL 中的<strong class="ky ir">分区是什么？</strong></p><p id="55cb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">分区的工作是对具有相似值的行进行分组，但不对行进行限制。<br/> </strong>为了更清楚起见，我们举个例子。</p><p id="658b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">请看上面第二张图片。<br/> </strong>表格中有五行，其中有一个名为gender的列有三个男性候选人和两个女性候选人，那么如果我们想要一个显示男性和女性数量的新列呢？</p><p id="af60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">partition语法根据相似的值对行进行分组，这意味着在我们的查询中，我们使用按性别划分。这意味着我们要根据性别对我们的行进行分组，所以在性别列中只有两个唯一的值第一个是M，第二个是F，所以它将行分成两组。<br/> 1性别栏中包含M的行<br/> 2性别栏中包含F的行</p><p id="6c12" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">，所以这就是SQL <br/>中partition的工作，我们使用count函数对组中的几行进行计数。</p><p id="3f40" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在输出中，您可以看到构建了新列，其名称为no_of_male_female，并且该列包含组中的行数。比如F组有两行，所以显示2，M组有三行，所以显示3。</p><p id="367d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">有些人可能想知道SQL中的group by和partition by有什么区别，因为两者的工作是相似的。所以答案是，如果你使用一个组，你的五行只转换成两行。为什么？</p><p id="b051" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">因为group by显示了组的数量，在我们上面的查询中，我们的表分为M和F两个组，所以group by只显示每个组的第一行，这意味着如果组包含10行，但它在输出中只显示1行<strong class="ky ir"> </strong>，因为它显示每个组的1行。</p><p id="a4c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但是如果您在那时使用partition，您的行数保持不变，因为您看到输出中的行数和表中的行数保持不变。<br/><strong class="ky ir">SQL中的分区显示所有行。<br/> </strong>两者都有优点和缺点你可以根据你的要求使用它们。</p><p id="3e8e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">如果你需要，检查下面的代码</strong></p><pre class="kg kh ki kj gt mz na nb bn nc nd bi"><span id="befd" class="ne mh iq na b be nf ng l nh ni">/* count function used to count number of gender after partition and then <br/>   show output in no_of_male_female column */<br/><br/>SELECT * , COUNT(gender) OVER (PARTITION BY gender) <br/>AS no_of_male_female FROM EMPLOYEE;</span></pre><h1 id="28fb" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated"><strong class="ak"> 3。限额查询</strong></h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/0a1d8684f24c753adfe9d1d2d144cc37.png" data-original-src="https://miro.medium.com/v2/resize:fit:1312/format:webp/1*HvO_v8bARd1WirCoZCSqNg.jpeg"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">SQL | Source中的限制:图片由作者提供</figcaption></figure><p id="c4a2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">SQL中的LIMIT及其工作方式，尽管某些SQL数据库不支持LIMIT，如SQL servers和MS access。</strong></p><p id="5ea6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">LIMIT子句在SQL数据库中广泛使用，主要用于限制行。<br/>举个例子:如果我们想从数据库中找出前10或最差的10张专辑，那么限制是有益的。我们在最后一个查询中使用了LIMIT 10，我们的工作就完成了。</p><p id="6fe4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">但这里有一个问题，极限是如何工作的，我们如何有效地使用它？</p><p id="4102" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">我们可以在两种类型中使用极限</strong></p><p id="7725" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 1。LIMIT(任意常数值)<br/> </strong>例如，下面的代码从表中选择前八行<br/><strong class="ky ir">SELECT * FROM table _ name LIMIT 8；</strong></p><p id="e709" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir"> 2。LIMIT(x，y) <br/> </strong>这是一种更精确的限制我们的表格的方法。<br/>x参数用于从顶部删除几行。<br/>y参数显示消去后所需的行数。<br/>例如:<br/><strong class="ky ir">Select * FROM table _ name LIMIT 3，2；<br/> </strong>该查询从顶部删除三行，然后显示删除三行后的两行。</p><p id="4c0a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">检查下面的代码。</p><pre class="kg kh ki kj gt mz na nb bn nc nd bi"><span id="f882" class="ne mh iq na b be nf ng l nh ni">/* This command is used to select first two rows */<br/><br/>SELECT * FROM EMPLOYEE LIMIT 2;<br/><br/><br/>/* This command is used to select 3 rows after eliminating first two rows */<br/><br/>SELECT * FROM EMPLOYEE LIMIT 2,3;<br/></span></pre><h1 id="8ed6" class="mg mh iq bd mi mj mk ml mm mn mo mp mq jw mr jx ms jz mt ka mu kc mv kd mw mx bi translated"><strong class="ak"> 4。合并功能</strong></h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nj"><img src="../Images/31e14fc27bc8eb0be9758b9b1b9a37a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HjSrUtwfylmY8JUmRzwk5A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">SQL | Source中的联合函数:作者图片</figcaption></figure><p id="eff0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">您知道SQL中有一些很棒的函数可以节省您的时间吗？<br/>这里我说的是<strong class="ky ir"> COALESCE函数，</strong>这个函数让你很惊讶，所以请阅读全文。</p><p id="533f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">COALESCE函数接受n个值。</strong></p><pre class="kg kh ki kj gt mz na nb bn nc nd bi"><span id="4a91" class="ne mh iq na b be nf ng l nh ni">COALESCE(value_1,value_2,......, value_n)</span></pre><p id="3a53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">所以让我们明白这一点；请看上面的第四张图。您会看到有一个EMPLOYEE表，其中包含一个名为的列，在该列中有3个空值。那么，如果我们想用一个有意义的词来代替空值呢？如上图所示，我们希望用Missing_value替换所有的空值。</p><p id="a39b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我们可以通过查看上图中的代码来使用COALESCE函数。COALESCE函数用单词Missing_value替换所有空值。</p><p id="ad88" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">让我们一步一步地理解COALESCE函数。<br/> <strong class="ky ir">第一步:</strong>我们在COALESCE函数中传递的第一个参数是我们要在其中查找空值的列名。这就是我们使用位置的原因。</p><p id="6547" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">第二步</strong>:如果找到一些值，那么什么都不会发生；正如您将在图像中的代码输出中看到的，值保持不变，但如果它发现了空值，那么它只是用我们给定的单词替换该空值，作为联合函数的第二个参数，我们给定Missing_value作为第二个参数，这就是为什么它用Missing_value替换location列中存在的所有空值。</p><p id="538e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">这就是如何在SQL中合并函数工作。我们举了一个使用单个列的例子。如果我们想要替换多个列中的空值，我们也做同样的事情；我们也可以按照上面的语法来做。</p><p id="4544" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><strong class="ky ir">查看下面的代码。</strong></p><pre class="kg kh ki kj gt mz na nb bn nc nd bi"><span id="0671" class="ne mh iq na b be nf ng l nh ni">/* So we are targeting the location column from our EMPLOYEE table and <br/>   then replacing the NULL values with Missing_value text */<br/>SELECT COALESCE(location,"Missing_value") as Location<br/>FROM EMPLOYEE;</span></pre><p id="9fc3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">我希望这篇文章能简要解释如何在SQL中使用这些基本查询，以及使用它有什么好处。如果你有任何问题，欢迎在评论区提问。</p><p id="033f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">订阅我的时事通讯</p></div><div class="ab cl nl nm hu nn" role="separator"><span class="no bw bk np nq nr"/><span class="no bw bk np nq nr"/><span class="no bw bk np nq"/></div><div class="ij ik il im in"><p id="0806" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在<a class="ae kv" href="https://www.linkedin.com/in/ashbabkhan" rel="noopener ugc nofollow" target="_blank"> Linkedin </a>上与我联系</p><p id="78a1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">在那之前，祝你编码愉快。</p></div></div>    
</body>
</html>