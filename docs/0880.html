<html>
<head>
<title>Azure Cognitive Services Sentiment Analysis v3.0 using Databricks PySpark</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Databricks PySpark的Azure认知服务情感分析3.0版</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/azure-cognitive-services-sentiment-analysis-v3-using-pyspark-b38bfcfd20fb?source=collection_archive---------2-----------------------#2020-09-02">https://pub.towardsai.net/azure-cognitive-services-sentiment-analysis-v3-using-pyspark-b38bfcfd20fb?source=collection_archive---------2-----------------------#2020-09-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="a005" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/cloud-computing" rel="noopener ugc nofollow" target="_blank">云计算</a>，<a class="ae ep" href="https://towardsai.net/p/category/nlp" rel="noopener ugc nofollow" target="_blank">自然语言处理</a></h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/80704af2ef9f1e275e17e8c939441a21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u9hJxyBxk4f3Bda2_RsbhQ.png"/></div></div></figure><p id="35ac" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">Azure Cognitive Services文本分析是一个很好的工具，可以用来快速评估文本数据集的积极或消极情绪。例如，服务提供商可以快速轻松地将评论评估为正面或负面，并根据检测到的情感得分对其进行排名。</p><p id="1984" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">随着越来越多的企业依赖于与客户的电子通信，了解与您的产品、服务或形象相关的整体情感变得前所未有的重要。情感分析允许公司以快速和高度可扩展的方式自动检测任何文本(评论、保险索赔、分类等)中的情感。</p><p id="ad19" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">我最近的一个项目是与一家物业管理公司合作，目的是利用客户对物业的反馈中的情绪得分来识别和优先处理主要问题，从而更快地解决问题并改善客户服务。</p><p id="9613" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">今天，我将介绍如何使用Azure Cognitive Services文本分析，使用Databricks PySpark Notebook来分析新冠肺炎推文的情绪，并返回情绪得分和指标，以确定它是正面还是负面的推文。</p><h1 id="dd16" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">什么是Azure认知服务文本分析？</h1><p id="c7a9" class="pw-post-body-paragraph kh ki iq kj b kk md km kn ko me kq kr ks mf ku kv kw mg ky kz la mh lc ld le ij bi translated">认知服务是微软为解决人工智能(AI)领域的问题而开发的一套机器学习算法。开发人员可以通过互联网对他们的应用程序、网站或工作流中的认知服务API进行标准REST调用来使用这些算法。</p><p id="fb3e" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">对于本文，我们将关注文本分析API情感分析特性，该特性评估文本并返回每个文档和句子的情感分数和标签。这有助于检测社交媒体、客户评论、论坛等中任何语言的积极和消极情绪。</p><h1 id="9c1a" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">使用PySpark使用情感分析API。</h1><p id="e6bf" class="pw-post-body-paragraph kh ki iq kj b kk md km kn ko me kq kr ks mf ku kv kw mg ky kz la mh lc ld le ij bi translated">为了分析文本并返回数据的情感分析，我们需要代码来完成以下步骤。</p><ol class=""><li id="fb69" class="mi mj iq kj b kk kl ko kp ks mk kw ml la mm le mn mo mp mq bi translated">导入带有文本列的数据集。</li><li id="e4d7" class="mi mj iq kj b kk mr ko ms ks mt kw mu la mv le mn mo mp mq bi translated">设置一个参数来标识输入数据集文本列名，使我们的代码动态化。</li><li id="2d7e" class="mi mj iq kj b kk mr ko ms ks mt kw mu la mv le mn mo mp mq bi translated">设置Azure认知服务API和密钥。</li><li id="1343" class="mi mj iq kj b kk mr ko ms ks mt kw mu la mv le mn mo mp mq bi translated">创建只包含Id和文本列的API post输入数据帧。</li><li id="d5da" class="mi mj iq kj b kk mr ko ms ks mt kw mu la mv le mn mo mp mq bi translated">将Dataframe转换为JSON，为API Post做好准备。</li><li id="89af" class="mi mj iq kj b kk mr ko ms ks mt kw mu la mv le mn mo mp mq bi translated">将JSON文档发布到情绪分析API。</li><li id="4eac" class="mi mj iq kj b kk mr ko ms ks mt kw mu la mv le mn mo mp mq bi translated">将JSON API响应展平到包含行和列的数据帧中。</li><li id="4653" class="mi mj iq kj b kk mr ko ms ks mt kw mu la mv le mn mo mp mq bi translated">将数据帧与原始数据集连接起来，以生成最终数据集并显示出来进行分析。</li></ol><p id="94de" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated"><strong class="kj ja">步骤</strong></p><ol class=""><li id="5aeb" class="mi mj iq kj b kk kl ko kp ks mk kw ml la mm le mn mo mp mq bi translated">将以下导入添加到您的文件PySpark Notebook中，并通过导入COVID19 Tweet数据集来创建输入数据帧。</li></ol><figure class="mw mx my mz gt ka"><div class="bz fp l di"><div class="na nb l"/></div></figure><figure class="mw mx my mz gt ka"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="f15e" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">结果</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nc"><img src="../Images/98bd53647ba8548c94a06280fd04e512.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6nkT5TwES3CZl9osju-RxA.png"/></div></div></figure><p id="11f0" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">2.创建并设置文本列参数的名称，将其设置为要分析的列的名称。</p><figure class="mw mx my mz gt ka"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="52ce" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">3.出于本演示的目的，我们将手动设置情感分析API参数。请注意，更安全的方法是使用Azure Key Vault来提供更高级别的安全性。</p><figure class="mw mx my mz gt ka"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="c86c" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">4.API的有效负载由一系列JSON文档组成，这些文档是包含一个<code class="fe nd ne nf ng b">id, language</code>和一个<code class="fe nd ne nf ng b">text</code>属性的元组。<code class="fe nd ne nf ng b">text</code>属性存储要分析的文本，<code class="fe nd ne nf ng b">language</code>是文本语言，<code class="fe nd ne nf ng b">id</code>可以是任何值。因此，我们需要添加一个<code class="fe nd ne nf ng b">id</code>列，并且只为API有效负载选择列<code class="fe nd ne nf ng b">id,language</code>和<code class="fe nd ne nf ng b">text</code>。</p><figure class="mw mx my mz gt ka"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="52b3" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">5.以API的正确格式将DataFrame dfCog转换为JSON字符串的DataFrame。</p><figure class="mw mx my mz gt ka"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="f9cb" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">输出如下。</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nh"><img src="../Images/c9ca0cca7037ef6f70889457d46894ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ufk0328wje3r_uWwxk2jVQ.png"/></div></div></figure><p id="2d57" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">6.将JSON有效负载发送到API，并传入subscription_key、端点和文档。</p><figure class="mw mx my mz gt ka"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="afe0" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">成功回应。</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ni"><img src="../Images/f8d0eeb908966a3d5bc93b251b9374d9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*a6sRIUFXDS1MCI96_Rn6LQ.png"/></div></div></figure><p id="a9b7" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">7.现在我们已经在JSON中返回了响应，我们必须将文档分成行和列。</p><figure class="mw mx my mz gt ka"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="87b8" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">8.最后，我们可以将分析的数据集连接到输入数据集，删除添加的ID列并显示最终输出。</p><figure class="mw mx my mz gt ka"><div class="bz fp l di"><div class="na nb l"/></div></figure><p id="0bed" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">最终结果提供了一个介于0.0和1.0之间的情绪得分和一个总体情绪标签，得分越高表明情绪越积极。</p><figure class="mw mx my mz gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nj"><img src="../Images/65ac0b34031abd9e8121dea600d0ef81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4VKA9JTzXTb8s2Y7-xlU5A.png"/></div></div></figure><p id="870f" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">我将它创建成了一个可重用的PySpark函数。如果你想要一本，请给我留言，我可以给你发一个链接到我的私人GIT回购。</p><p id="efea" class="pw-post-body-paragraph kh ki iq kj b kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le ij bi translated">我希望这有助于节省您理解Azure认知情绪分析和PySpark的时间。非常欢迎任何想法、问题、更正和建议:)</p><h1 id="56ba" class="lf lg iq bd lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc bi translated">如果你喜欢这篇文章，这里有一些你可能喜欢的其他文章:</h1><div class="nk nl gp gr nm nn"><a rel="noopener  ugc nofollow" target="_blank" href="/databricks-pyspark-type-2-scd-function-for-azure-synapse-analytics-8c0ff8862a11"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ja gy z fp ns fr fs nt fu fw iz bi translated">用于Azure Synapse分析的Databricks PySpark Type 2 SCD函数</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">渐变维度(SCD)是数据仓库中一种常用的维度建模技术，用于捕获…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">pub.towardsai.net</p></div></div><div class="nw l"><div class="nx l ny nz oa nw ob kf nn"/></div></div></a></div><div class="nk nl gp gr nm nn"><a href="https://rorymcmanus.medium.com/databricks-upsert-to-azure-sql-using-pyspark-5937e8303fbf" rel="noopener follow" target="_blank"><div class="no ab fo"><div class="np ab nq cl cj nr"><h2 class="bd ja gy z fp ns fr fs nt fu fw iz bi translated">Databricks:使用PySpark升级到Azure SQL</h2><div class="nu l"><h3 class="bd b gy z fp ns fr fs nt fu fw dk translated">Upsert是RDBMS的一个特性，它允许DML语句的作者自动插入一行，或者如果该行…</h3></div><div class="nv l"><p class="bd b dl z fp ns fr fs nt fu fw dk translated">rorymcmanus.medium.com</p></div></div><div class="nw l"><div class="oc l ny nz oa nw ob kf nn"/></div></div></a></div></div></div>    
</body>
</html>