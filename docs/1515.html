<html>
<head>
<title>Connect Colab to GCS Bucket Using gcsfuse</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用gcsfuse将Colab连接到GCS桶</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/connect-colab-to-gcs-bucket-using-gcsfuse-29f4f844d074?source=collection_archive---------4-----------------------#2021-02-10">https://pub.towardsai.net/connect-colab-to-gcs-bucket-using-gcsfuse-29f4f844d074?source=collection_archive---------4-----------------------#2021-02-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="d00a" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">云计算</h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/4c1a3e50df181c128729a9ad73be9577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dF4nfHCmrwQTOJn0"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">由<a class="ae kl" href="https://unsplash.com/@kelvin1987?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Kelvin Ang </a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><h1 id="73d8" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">目录</h1><p id="66f1" class="pw-post-body-paragraph lk ll iq lm b ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh ij bi translated"><a class="ae kl" href="#cf6d" rel="noopener ugc nofollow">简介</a> <br/> <a class="ae kl" href="#5cb7" rel="noopener ugc nofollow">步骤1:标识自己</a> <br/> <a class="ae kl" href="#8378" rel="noopener ugc nofollow">步骤2:安装gcsfuse </a> <br/> <a class="ae kl" href="#3280" rel="noopener ugc nofollow">步骤3:将Colab连接到GCS Bucket </a> <br/> <a class="ae kl" href="#1dc7" rel="noopener ugc nofollow">步骤4:将文件复制到你的VM </a> <br/> <a class="ae kl" href="#4613" rel="noopener ugc nofollow">资源</a></p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="cf6d" class="km kn iq bd ko kp mp kr ks kt mq kv kw kx mr kz la lb ms ld le lf mt lh li lj bi translated">介绍</h1><p id="9656" class="pw-post-body-paragraph lk ll iq lm b ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh ij bi translated">当您想要将数据集下载到Google Colab虚拟机时，您通常使用放置在Google Drive上的数据。但是如果你的数据集比较大(超过15 Gb)，有更多的人想一天下载几次呢？免费的G-Drive对磁盘容量和日常数据传输都有限制。在这种情况下，值得借助<a class="ae kl" href="https://cloud.google.com/free/docs/gcp-free-tier#free-tier-usage-limits" rel="noopener ugc nofollow" target="_blank">、免费等级或信用点</a>在谷歌云平台上创建一个桶。</p><p id="8f3b" class="pw-post-body-paragraph lk ll iq lm b ln mu lp lq lr mv lt lu lv mw lx ly lz mx mb mc md my mf mg mh ij bi translated">问题仍然是，如何轻松地将谷歌云存储桶连接到Colab虚拟机？提议的解决方案基于使用由Google直接开发的<a class="ae kl" href="https://github.com/GoogleCloudPlatform/gcsfuse" rel="noopener ugc nofollow" target="_blank"> gcsfuse </a>适配器。由于这个简单的解决方案，即使是通过特定的gmail访问数据的第三方也能够将您的数据集下载到Colab。</p><p id="7eec" class="pw-post-body-paragraph lk ll iq lm b ln mu lp lq lr mv lt lu lv mw lx ly lz mx mb mc md my mf mg mh ij bi translated">本文末尾包含一个带有代码的Colab笔记本。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="5cb7" class="km kn iq bd ko kp mp kr ks kt mq kv kw kx mr kz la lb ms ld le lf mt lh li lj bi translated">第一步:表明自己的身份</h1><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="6bbd" class="ni kn iq ne b gy nj nk l nl nm">from google.colab import auth<br/>auth.authenticate_user()</span></pre><p id="e0cf" class="pw-post-body-paragraph lk ll iq lm b ln mu lp lq lr mv lt lu lv mw lx ly lz mx mb mc md my mf mg mh ij bi translated">以下命令会将您重定向到Google Cloud SDK权限面板，并要求您提供连接到特定gmail帐户的所有服务的凭据。</p><figure class="mz na nb nc gt ka gh gi paragraph-image"><div class="gh gi nn"><img src="../Images/1818ee3d38ca151e16c27d066ed17283.png" data-original-src="https://miro.medium.com/v2/resize:fit:1186/0*M0WiXdbJ7bGbWDd7"/></div></figure><p id="dcb9" class="pw-post-body-paragraph lk ll iq lm b ln mu lp lq lr mv lt lu lv mw lx ly lz mx mb mc md my mf mg mh ij bi translated">这个过程看起来与通过授权连接到g盘是一样的，所以让我们深入研究一下。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="8378" class="km kn iq bd ko kp mp kr ks kt mq kv kw kx mr kz la lb ms ld le lf mt lh li lj bi translated"><strong class="ak">第二步:安装gcsfuse </strong></h1><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="b270" class="ni kn iq ne b gy nj nk l nl nm">!echo "deb http://packages.cloud.google.com/apt gcsfuse-bionic main" &gt; /etc/apt/sources.list.d/gcsfuse.list<br/>!curl https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add -<br/>!apt -qq update<br/>!apt -qq install gcsfuse</span></pre><p id="c84e" class="pw-post-body-paragraph lk ll iq lm b ln mu lp lq lr mv lt lu lv mw lx ly lz mx mb mc md my mf mg mh ij bi translated">下面的命令集做一些事情:</p><ol class=""><li id="0a9c" class="no np iq lm b ln mu lr mv lv nq lz nr md ns mh nt nu nv nw bi translated">添加gcsfuse分发URL作为包源，并导入其公钥</li><li id="07a8" class="no np iq lm b ln nx lr ny lv nz lz oa md ob mh nt nu nv nw bi translated">更新可用软件包列表</li><li id="c817" class="no np iq lm b ln nx lr ny lv nz lz oa md ob mh nt nu nv nw bi translated">安装gcsfuse</li></ol><figure class="mz na nb nc gt ka gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/a26031b1b586ea51169a217f33b663ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1032/format:webp/1*HE2Q2wYhXoXZueb7rEqtkg.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">gscfuse安装输出</figcaption></figure><p id="d9fe" class="pw-post-body-paragraph lk ll iq lm b ln mu lp lq lr mv lt lu lv mw lx ly lz mx mb mc md my mf mg mh ij bi translated">如果您的控制台的输出与上面显示的类似，请转到下一步。</p></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="3280" class="km kn iq bd ko kp mp kr ks kt mq kv kw kx mr kz la lb ms ld le lf mt lh li lj bi translated">步骤3:将Colab连接到GCS桶</h1><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="0a62" class="ni kn iq ne b gy nj nk l nl nm">!mkdir googleBucketFolder<br/>!gcsfuse --implicit-dirs colab-connect-bucket googleBucketFolder</span></pre><p id="1cd7" class="pw-post-body-paragraph lk ll iq lm b ln mu lp lq lr mv lt lu lv mw lx ly lz mx mb mc md my mf mg mh ij bi translated">现在你只需在你的虚拟机上创建一个<code class="fe od oe of ne b">googleBucketFolder</code>并调用带有<code class="fe od oe of ne b">--implicit-dirs</code>标志的<code class="fe od oe of ne b">gcsfuse</code>来确保来自<code class="fe od oe of ne b">colab-connect-bucket</code>的所有文件夹和文件在Colab的文件浏览器中可见。</p><figure class="mz na nb nc gt ka gh gi paragraph-image"><div class="gh gi og"><img src="../Images/f9e87f79904e5b404ea442dbab47d059.png" data-original-src="https://miro.medium.com/v2/resize:fit:1088/format:webp/1*Vnz2EfQkIcKva33jl-eOJA.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">Colab的文件浏览器视图</figcaption></figure></div><div class="ab cl mi mj hu mk" role="separator"><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn mo"/><span class="ml bw bk mm mn"/></div><div class="ij ik il im in"><h1 id="1dc7" class="km kn iq bd ko kp mp kr ks kt mq kv kw kx mr kz la lb ms ld le lf mt lh li lj bi translated">步骤4:将文件复制到您的虚拟机</h1><pre class="mz na nb nc gt nd ne nf ng aw nh bi"><span id="fa36" class="ni kn iq ne b gy nj nk l nl nm">!gsutil cp /content/googleBucketFolder/cat.jpg .</span></pre><p id="f792" class="pw-post-body-paragraph lk ll iq lm b ln mu lp lq lr mv lt lu lv mw lx ly lz mx mb mc md my mf mg mh ij bi translated">现在，你可以从你的桶中复制(或解压)文件，享受一只美妙的猫🐈(或30gb以上的数据集🤖)在你的可乐上。</p><p id="3ab4" class="pw-post-body-paragraph lk ll iq lm b ln mu lp lq lr mv lt lu lv mw lx ly lz mx mb mc md my mf mg mh ij bi translated">维奥拉。</p><figure class="mz na nb nc gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi oh"><img src="../Images/2935bffeaeefac83e22c3d21867cf766.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*yG2n-27g4NYqbwFm"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">照片由<a class="ae kl" href="https://unsplash.com/@ramche?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拉米兹·德达科维奇</a>在<a class="ae kl" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure><h1 id="4613" class="km kn iq bd ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj bi translated">资源</h1><p id="def4" class="pw-post-body-paragraph lk ll iq lm b ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh ij bi translated"><a class="ae kl" href="https://colab.research.google.com/github/maciej-zieniewicz/gcsfuse-for-colab/blob/main/google_storage.ipynb" rel="noopener ugc nofollow" target="_blank"> Colab笔记本</a></p></div></div>    
</body>
</html>