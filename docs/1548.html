<html>
<head>
<title>Create Your NAS Database Server on Raspberry Pi</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">在Raspberry Pi上创建您的NAS数据库服务器</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/create-your-own-nas-on-raspberry-pi-6892025996cb?source=collection_archive---------2-----------------------#2021-02-17">https://pub.towardsai.net/create-your-own-nas-on-raspberry-pi-6892025996cb?source=collection_archive---------2-----------------------#2021-02-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/45e4a5b7d64bb6e910caa2a2d2559281.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*lni32yJQ_Xo0lPmF"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">数据库，但我们需要把它放进树莓派里——照片由<a class="ae jg" href="https://unsplash.com/@jankolar?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">扬·安东宁·科拉尔</a>在<a class="ae jg" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="26b3" class="jh ji jj bd b dl jk jl jm jn jo jp dk jq translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-science" rel="noopener ugc nofollow" target="_blank">数据科学</a>、<a class="ae ep" href="https://towardsai.net/p/category/iot" rel="noopener ugc nofollow" target="_blank">物联网</a>、<a class="ae ep" href="https://towardsai.net/p/category/technology" rel="noopener ugc nofollow" target="_blank">技术</a></h2><div class=""/><div class=""><h2 id="f954" class="pw-subtitle-paragraph kp js jj bd b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dk translated">带有PostGIS和时标的容器化Postgres服务器b</h2></div><p id="53b5" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">网络附加存储(NAS)是一个集中的数据存储库，可由同一计算机网络中的其他设备访问。对于那些不熟悉它的人来说，可以把它想象成Google Drive或dropbox，可以通过网络访问数据。由于其可访问性，NAS是以数据库形式跨设备共享数据的最佳解决方案之一，无论是关系数据库还是非SQL数据库。</p><p id="5df2" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在这篇博客中，我们将介绍如何在Raspberry Pi上组装和设置您自己的NAS。我们的数据库服务器将是Docker容器中的Postgres数据库，以确保可移植性和健壮性。我们还将使用PostGIS和TimescaleDB扩展Postgres。PostGIS将使我们能够有效地处理和存储地理空间数据，而TimescaleDB可以被视为Postgres上的时间序列专业知识。由于涵盖了GIS和时间序列，这种NAS应该可以满足我们对集中式数据库的大多数日常需求。</p><blockquote class="md"><p id="707c" class="me mf jj bd mg mh mi mj mk ml mm mc dk translated">但是，我们为什么需要NAS呢？</p></blockquote><h2 id="ff82" class="mn mo jj bd mp mq mr dn ms mt mu dp mv lq mw mx my lu mz na nb ly nc nd ne jp bi translated">个人动机</h2><p id="1981" class="pw-post-body-paragraph lh li jj lj b lk nf kt lm ln ng kw lp lq nh ls lt lu ni lw lx ly nj ma mb mc im bi translated">很长时间以来，我一直将数据保存为pickle、平面文件，偶尔保存在本地数据库中。虽然这比较容易开始，但它很快就失去了控制，导致了三个主要问题:</p><ul class=""><li id="8393" class="nk nl jj lj b lk ll ln lo lq nm lu nn ly no mc np nq nr ns bi translated">重复数据占用了额外的空间</li><li id="f6ce" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated">数据集中缺乏版本控制，这导致了各种不一致和不匹配</li><li id="459f" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated">项目相互交叉引用，以访问相同的数据片段，从而绕过第一个点</li><li id="0cb0" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated">数据只在我的桌面上可用，而在其他设备上不可用，这意味着我可能需要将数据提交给Git，这是一个大禁忌</li></ul><p id="eb34" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">所有这些纠结都导致了难以想象的痛苦，尤其是当我不小心删除了一个很多人都在引用的个人项目文件夹时。几个月的工作付之东流。如果只有数据位于NAS中，上述所有问题都不会存在，而且更重要的是，可以避免挫折。</p><h2 id="2848" class="mn mo jj bd mp mq ny dn ms mt nz dp mv lq oa mx my lu ob na nb ly oc nd ne jp bi translated">面向未来的动机</h2><p id="25ce" class="pw-post-body-paragraph lh li jj lj b lk nf kt lm ln ng kw lp lq nh ls lt lu ni lw lx ly nj ma mb mc im bi translated">想象一下，你开始收集数据，无论是财务、天气、日历，还是智能家居传感器，如湿度传感器、温度传感器等。将它存储在平面文件中是不可伸缩的。您将无法高效、轻松地处理已有的数据。</p><p id="5450" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然而，房间里仍然有一个大象:为什么不只是一个数据库托管在我的电脑上？公平点！事实上，如果你不介意让你的电脑全天候运行，这是一个可行的选择。但是NAS为您节省的是电费和与延长PC运行时间相关的维护成本。</p><blockquote class="md"><p id="a500" class="me mf jj bd mg mh mi mj mk ml mm mc dk translated">那么我们有什么选择呢？</p></blockquote><p id="e2ea" class="pw-post-body-paragraph lh li jj lj b lk od kt lm ln oe kw lp lq of ls lt lu og lw lx ly oh ma mb mc im bi translated">打包的NAS通常很贵，例如<a class="ae jg" href="https://amzn.to/3pryeMN" rel="noopener ugc nofollow" target="_blank"> Synology </a>，但是它们有非常好的规格和配套软件，所以基本上，它们可以立即投入运行。插上硬盘和电源线和viola！如果您对获得这些NAS解决方案感兴趣，请在这里查看<a class="ae jg" href="https://amzn.to/3phrxN1" rel="noopener ugc nofollow" target="_blank"/>。</p><blockquote class="md"><p id="2207" class="me mf jj bd mg mh mi mj mk ml mm mc dk translated">但是当所有东西都是预先包装好的时候，有什么乐趣呢？</p></blockquote><figure class="oi oj ok ol om iv"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">跳进食谱就像——来源:<a class="ae jg" href="https://giphy.com/gifs/14uzPzKMOuVIPu" rel="noopener ugc nofollow" target="_blank">吉菲</a></figcaption></figure><h2 id="4b53" class="mn mo jj bd mp mq ny dn ms mt nz dp mv lq oa mx my lu ob na nb ly oc nd ne jp bi translated">硬件成分</h2><ul class=""><li id="7f06" class="nk nl jj lj b lk nf ln ng lq op lu oq ly or mc np nq nr ns bi translated">树莓派3B+: 我有一个3B+型号，是我从另一个副业项目中退役的。虽然这是完全有能力推动我们正在建设的，随时可以用一个模型4交换一些额外的力量。链接到<a class="ae jg" href="https://amzn.to/3ddb61L" rel="noopener ugc nofollow" target="_blank">车型3B+ </a>和<a class="ae jg" href="https://amzn.to/3tVxQcG" rel="noopener ugc nofollow" target="_blank">车型4 </a></li><li id="421a" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><strong class="lj jt">保护壳(可选):</strong>好的保护壳的两大优点(1)散热更好，(2)更美观。链接到<a class="ae jg" href="https://amzn.to/37dWRGl" rel="noopener ugc nofollow" target="_blank">型号2/3/3B+ </a>和<a class="ae jg" href="https://amzn.to/3rR3sOQ" rel="noopener ugc nofollow" target="_blank">型号4 </a></li><li id="6fb9" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><strong class="lj jt"> Micro SD卡:</strong>只是用来启动Pi的，不需要很花哨。即使是普通的16 GB卡也足够了！记得检查你是否有连接到你的电脑的适配器，因为我们需要把操作系统刷新到卡上。链接到带有SD适配器的<a class="ae jg" href="https://amzn.to/3rTwopw" rel="noopener ugc nofollow" target="_blank"> 16GB微型SD卡</a></li><li id="c4bd" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><strong class="lj jt">外部存储器:</strong>这是存储实际数据的地方。我选择了1TB的外置硬盘，但也可以根据您的需求随意扩展！一般来说，我会避免SSD，因为HDD会给你更好的性价比，而且SSD只允许有限数量的读写操作。如果你不介意通过额外的电缆工程，你也可以去与硬盘驱动器，可以提供更好的速度和性能！链接到<a class="ae jg" href="https://amzn.to/2Na5T05" rel="noopener ugc nofollow" target="_blank"> 1TB外置硬盘</a>和<a class="ae jg" href="https://amzn.to/3rQ5j6z" rel="noopener ugc nofollow" target="_blank"> 1TB 3.5英寸硬盘</a></li></ul><p id="34cd" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">除上述之外，您还需要一些额外的电缆来为构建供电:</p><ul class=""><li id="3822" class="nk nl jj lj b lk ll ln lo lq nm lu nn ly no mc np nq nr ns bi translated"><strong class="lj jt">电源线:</strong> Raspberry Pi需要5V 3A的电源连接，所以在开始组装之前，请确保你已经有了。如果您计划构建多个Raspberry Pi，例如一个用于媒体中心，一个用于智能镜像，一个用于VPN服务器等，您可能需要一个USB集线器和单独的电缆。链接到<a class="ae jg" href="https://www.amazon.co.uk/gp/product/B07PMJ9C1W/ref=as_li_qf_asin_il_tl?ie=UTF8&amp;tag=louischan08-21&amp;creative=6738&amp;linkCode=as2&amp;creativeASIN=B07PMJ9C1W&amp;linkId=756aeea3ba894463ddb5e4726e720bc2" rel="noopener ugc nofollow" target="_blank">单电源电缆</a>、<a class="ae jg" href="https://www.amazon.co.uk/gp/product/B00YSA0WI8/ref=as_li_qf_asin_il_tl?ie=UTF8&amp;tag=louischan08-21&amp;creative=6738&amp;linkCode=as2&amp;creativeASIN=B00YSA0WI8&amp;linkId=d4baab6f0a5ef5e8d39beea587c95352" rel="noopener ugc nofollow" target="_blank"> USB集线器</a>和<a class="ae jg" href="https://www.amazon.co.uk/gp/product/B07Q2WJMQK/ref=as_li_qf_asin_il_tl?ie=UTF8&amp;tag=louischan08-21&amp;creative=6738&amp;linkCode=as2&amp;creativeASIN=B07Q2WJMQK&amp;linkId=24c3f6435aac37d738a344a12187c166" rel="noopener ugc nofollow" target="_blank">电缆包</a></li><li id="f6f1" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><strong class="lj jt">局域网线缆:</strong>用于连接局域网。我不建议在NAS上使用WIFI，因为这会大大降低性能。链接到<a class="ae jg" href="https://amzn.to/2N9cE2n" rel="noopener ugc nofollow" target="_blank"> CAT7 LAN电缆</a></li><li id="5503" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><strong class="lj jt"> SATA线缆:</strong>用于连接硬盘。在我的情况下，我去了一个带有USB电缆的外置硬盘，所以我不需要这个。</li><li id="f57f" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><strong class="lj jt"> HDMI线、显示器和键盘:</strong>这些对于Pi的第一次开机会很有用。</li></ul><h2 id="ca58" class="mn mo jj bd mp mq ny dn ms mt nz dp mv lq oa mx my lu ob na nb ly oc nd ne jp bi translated">UBUNTU图像</h2><p id="7c30" class="pw-post-body-paragraph lh li jj lj b lk nf kt lm ln ng kw lp lq nh ls lt lu ni lw lx ly nj ma mb mc im bi translated">我们需要首先准备图像。首先将SD卡插入您的电脑。Raspberry Pi有一个成像仪，我们可以在这里下载<a class="ae jg" href="https://www.raspberrypi.org/software/" rel="noopener ugc nofollow" target="_blank">来更新我们的SD卡。</a></p><figure class="ot ou ov ow gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi os"><img src="../Images/335f0ec0a4efb0552d793d944cd35a7e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sapOLViFqig8mC8ujfzDxQ.png"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">Raspberry Pi成像仪</figcaption></figure><p id="6229" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在操作系统下，选择<strong class="lj jt">其他通用OS</strong>&gt;<strong class="lj jt">Ubuntu</strong>&gt;<strong class="lj jt">Ubuntu Server 20.10 64 Bit</strong>。在SD卡下，选择您刚刚插入的卡。点击写，拿一杯咖啡，这可能需要一段时间！</p><p id="511f" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">完成后，在SD卡的根目录下创建一个名为<strong class="lj jt"> ssh </strong>的空文件。这将允许我们在将来SSH到Pi。现在，是时候组装硬件了。将micro SD卡插入您的Raspberry Pi，连接硬盘、键盘、显示器和<strong class="lj jt">，然后连接</strong>电源线。</p><h2 id="a36e" class="mn mo jj bd mp mq ny dn ms mt nz dp mv lq oa mx my lu ob na nb ly oc nd ne jp bi translated">连接到您的Pi</h2><p id="d920" class="pw-post-body-paragraph lh li jj lj b lk nf kt lm ln ng kw lp lq nh ls lt lu ni lw lx ly nj ma mb mc im bi translated">当提示输入密码时，只需键入<code class="fe ox oy oz pa b">ubuntu</code>；您还会被要求更改密码。接下来，执行<code class="fe ox oy oz pa b">ip a</code>。你应该可以在以<code class="fe ox oy oz pa b">192.168.</code>开头的<code class="fe ox oy oz pa b">eth0</code>下看到你的IP地址。在我的案例中，IP是<code class="fe ox oy oz pa b">192.168.1.100</code>。现在尝试使用<code class="fe ox oy oz pa b">ssh ubuntu@192.168.1.100</code>从PC SSH到您的Pi。当出现关于<code class="fe ox oy oz pa b">ECDSA key fingerprint</code>的提示时，键入<code class="fe ox oy oz pa b">yes</code>，然后尝试使用新密码登录。如果成功了，你应该得到这样的问候:</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="902c" class="mn mo jj pa b gy pf pg l ph pi">Welcome to Ubuntu 20.10 (GNU/Linux 5.8.0-1006-raspi aarch64)</span><span id="a164" class="mn mo jj pa b gy pj pg l ph pi">* Documentation:  https://help.ubuntu.com</span><span id="aec1" class="mn mo jj pa b gy pj pg l ph pi">* Management:     https://landscape.canonical.com</span><span id="fe08" class="mn mo jj pa b gy pj pg l ph pi">* Support:        https://ubuntu.com/advantage</span><span id="3324" class="mn mo jj pa b gy pj pg l ph pi">System information as of Sun Feb 14 00:13:59 UTC 2021</span><span id="4a52" class="mn mo jj pa b gy pj pg l ph pi">System load:              0.03</span><span id="84cf" class="mn mo jj pa b gy pj pg l ph pi">Usage of /:               23.8% of 28.98GB</span><span id="0f01" class="mn mo jj pa b gy pj pg l ph pi">Memory usage:             43%</span><span id="4644" class="mn mo jj pa b gy pj pg l ph pi">Swap usage:               0%</span><span id="a4bc" class="mn mo jj pa b gy pj pg l ph pi">Temperature:              52.6 C</span><span id="d66a" class="mn mo jj pa b gy pj pg l ph pi">Processes:                165</span><span id="ea07" class="mn mo jj pa b gy pj pg l ph pi">Users logged in:          1</span><span id="a256" class="mn mo jj pa b gy pj pg l ph pi">IPv4 address for eth0:    192.168.1.100</span></pre><p id="f654" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果您知道如何为您的Pi分配一个静态IP，现在是在您的路由器上分配与您已获得的IP完全相同的IP的最佳时机。拥有静态IP意味着当连接到路由器时，您的Pi将始终拥有相同的IP，这样，当动态IP租约到期或您需要重新启动Pi时，您就不必时不时地检查路由器是否有新的IP。您应该能够通过浏览器浏览<code class="fe ox oy oz pa b">192.168.1.1</code>来访问您的路由器。一旦您设置了静态IP，让我们尝试重新启动Pi</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="baec" class="mn mo jj pa b gy pf pg l ph pi">$ sudo reboot now</span></pre><p id="fcb6" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">给它几分钟时间，并尝试使用与以前相同的IP进行SSH。如果成功，那么您已经成功分配了静态IP。否则，请查看路由器文档，了解如何分配静态IP。</p><h2 id="892c" class="mn mo jj bd mp mq ny dn ms mt nz dp mv lq oa mx my lu ob na nb ly oc nd ne jp bi translated">设置您的Pi</h2><p id="ed53" class="pw-post-body-paragraph lh li jj lj b lk nf kt lm ln ng kw lp lq nh ls lt lu ni lw lx ly nj ma mb mc im bi translated">现在我们可以SSH到Pi，我们不再需要显示器和键盘了。在SSH会话中，让我们从更新Pi开始:</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="c423" class="mn mo jj pa b gy pf pg l ph pi">$ sudo apt update &amp;&amp; sudo apt full-upgrade<br/>$ sudo usermod -aG sudo ubuntu<br/>$ sudo whoami</span><span id="bb6a" class="mn mo jj pa b gy pj pg l ph pi"># this should print root</span></pre><p id="b25f" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">下一步是检查我们的外部硬盘的文件系统。从跑步开始</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="c4c8" class="mn mo jj pa b gy pf pg l ph pi">$ sudo lsblk -o NAME,FSTYPE,SIZE,MOUNTPOINT</span><span id="c533" class="mn mo jj pa b gy pj pg l ph pi">NAME        FSTYPE SIZE   MOUNTPOINT        <br/>loop0              48.8M  /snap/core18/1888 <br/>loop1              48.9M  /snap/core18/1990 <br/>loop2              61M    /snap/lxd/17938 <br/>loop3              62.9M  /snap/lxd/19390 <br/>loop4              27M    /snap/snapd/11043 <br/>loop5              26.9M  /snap/snapd/9730 <br/>sda                931.5G <br/>└─sda1      ntfs   931.5G                   <br/>mmcblk0            29.8G <br/>├─mmcblk0p1 vfat   256M   /boot/firmware    <br/>└─mmcblk0p2 ext4   29.5G  / writable</span></pre><p id="06db" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我们可以在<code class="fe ox oy oz pa b">sda</code>(存储设备A的简称)下看到我的1TB HDD。如果<code class="fe ox oy oz pa b">FSTYPE</code>如果<code class="fe ox oy oz pa b">ntfs</code>那么您需要将文件系统更改为<code class="fe ox oy oz pa b">ext4</code>(一个原生的Linux文件系统)以确保Postgres可以在您的硬盘上顺利运行:</p><blockquote class="pk pl pm"><p id="e0b7" class="lh li pn lj b lk ll kt lm ln lo kw lp po lr ls lt pp lv lw lx pq lz ma mb mc im bi translated">注:这将删除硬盘上的所有数据。如果你用的是Windows桌面，把它换成ext4也意味着你不能再把硬盘插到你的Windows机器上了。</p></blockquote><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="a946" class="mn mo jj pa b gy pf pg l ph pi">$ sudo mkfs.ext4 /dev/sda1</span></pre><p id="35d9" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">完成后，再次检查文件系统:</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="a5dc" class="mn mo jj pa b gy pf pg l ph pi">$ sudo lsblk -o NAME,FSTYPE,SIZE,MOUNTPOINT</span><span id="8ae2" class="mn mo jj pa b gy pj pg l ph pi">NAME        FSTYPE SIZE   MOUNTPOINT        <br/>loop0              48.8M  /snap/core18/1888 <br/>loop1              48.9M  /snap/core18/1990 <br/>loop2              61M    /snap/lxd/17938 <br/>loop3              62.9M  /snap/lxd/19390 <br/>loop4              27M    /snap/snapd/11043 <br/>loop5              26.9M  /snap/snapd/9730 <br/>sda                931.5G <br/>└─sda1      ext4   931.5G                   <br/>mmcblk0            29.8G <br/>├─mmcblk0p1 vfat   256M   /boot/firmware    <br/>└─mmcblk0p2 ext4   29.5G  / writable</span></pre><p id="648a" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">文件系统排序后，让我们将HDD安装到Pi，以便Pi和访问驱动器。首先创建一个目标文件夹，作为存储设备的挂载点。这种情况下使用的挂载点名称是<code class="fe ox oy oz pa b">postgres</code>。您可以指定自己选择的名称:</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="e3ab" class="mn mo jj pa b gy pf pg l ph pi">$ sudo mkdir /mnt/postgres</span></pre><p id="8a3d" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">通过列出以下内容来验证存储设备是否已成功装载:</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="8c0b" class="mn mo jj pa b gy pf pg l ph pi">$ ls /mnt/<!-- -->postgres</span></pre><p id="e74e" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">更改驱动器的权限，以便我们对其进行写入:</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="7386" class="mn mo jj pa b gy pf pg l ph pi">$ sudo chown -R $USER:$USER ~/<!-- -->postgres</span></pre><h2 id="3a81" class="mn mo jj bd mp mq ny dn ms mt nz dp mv lq oa mx my lu ob na nb ly oc nd ne jp bi translated">设置Docker</h2><p id="cf89" class="pw-post-body-paragraph lh li jj lj b lk nf kt lm ln ng kw lp lq nh ls lt lu ni lw lx ly nj ma mb mc im bi translated">如果我们需要将NAS迁移到其他地方，我们将使用Docker来设置我们的数据库，以确保环境是可移植的，并且更易于调试。</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="9282" class="mn mo jj pa b gy pf pg l ph pi">$ <!-- -->curl -fsSL https://get.docker.com -o get-docker.sh<br/>$ sudo sh get-docker.sh</span></pre><p id="adbd" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">确保<code class="fe ox oy oz pa b">ubuntu</code>是<code class="fe ox oy oz pa b">docker</code>用户组的一部分，这样当我们需要运行<code class="fe ox oy oz pa b">docker</code>命令时，就不需要每次都使用<code class="fe ox oy oz pa b">sudo</code></p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="d2e2" class="mn mo jj pa b gy pf pg l ph pi">$ <!-- -->sudo usermod -aG docker ubuntu<br/>$ sudo reboot now</span></pre><p id="942c" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">SSH返回到Pi，并验证您可以运行以下内容:</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="4312" class="mn mo jj pa b gy pf pg l ph pi">$ docker run hello-world<!-- --> </span><span id="cfac" class="mn mo jj pa b gy pj pg l ph pi">Unable to find image 'hello-world:latest' locally<br/>latest: Pulling from library/hello-world<br/>256ab8fe8778: Pull complete <br/>Digest: sha256:95ddb6c31407e84e91a986b004aee40975cb0bda14b5949f6faac5d2deadb4b9<br/>Status: Downloaded newer image for hello-world:latest</span><span id="b9c4" class="mn mo jj pa b gy pj pg l ph pi">Hello from Docker!<br/>This message shows that your installation appears to be working correctly.</span><span id="8280" class="mn mo jj pa b gy pj pg l ph pi">To generate this message, Docker took the following steps:<br/> 1. The Docker client contacted the Docker daemon.<br/> 2. The Docker daemon pulled the "hello-world" image from the Docker Hub.<br/>    (arm64v8)<br/> 3. The Docker daemon created a new container from that image which runs the<br/>    executable that produces the output you are currently reading.<br/> 4. The Docker daemon streamed that output to the Docker client, which sent it<br/>    to your terminal.</span><span id="b1aa" class="mn mo jj pa b gy pj pg l ph pi">To try something more ambitious, you can run an Ubuntu container with:<br/> $ docker run -it ubuntu bash</span><span id="c663" class="mn mo jj pa b gy pj pg l ph pi">Share images, automate workflows, and more with a free Docker ID:<br/> <a class="ae jg" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/</a></span><span id="40a6" class="mn mo jj pa b gy pj pg l ph pi">For more examples and ideas, visit:<br/> <a class="ae jg" href="https://docs.docker.com/get-started/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/get-started/</a></span></pre><h2 id="a5ea" class="mn mo jj bd mp mq ny dn ms mt nz dp mv lq oa mx my lu ob na nb ly oc nd ne jp bi translated"><strong class="ak">带PostGIS的Postgres&amp;时标DB </strong></h2><p id="33eb" class="pw-post-body-paragraph lh li jj lj b lk nf kt lm ln ng kw lp lq nh ls lt lu ni lw lx ly nj ma mb mc im bi translated">作为本教程的一部分，我们将使用PostGIS(任何地理空间分析的基本工具)和TimescaleDB(任何时间序列数据的基本工具)来设置我们的Postgres服务器。幸运的是，Eddie有一个包含Docker映像的<a class="ae jg" href="https://github.com/dekiesel/arm7v32_timescaledb" rel="noopener ugc nofollow" target="_blank">存储库</a>，其中包含所有关键组件，并且是为像我们的Pi这样的ARM芯片定制的。向埃迪致敬！</p><p id="6fe5" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">让我们定义我们自己的Postgres配置文件来传递给Eddie的映像:</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="7a07" class="mn mo jj pa b gy pf pg l ph pi">$ cd /mnt/postgres<br/>$ mkdir data<br/>$ vim .env</span></pre><p id="f8df" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在vim的终极迷宫中，键入:</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="2a33" class="mn mo jj pa b gy pf pg l ph pi">POSTGRES_PASSWORD=password</span></pre><p id="c020" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">要退出vim，按下<code class="fe ox oy oz pa b">Esc</code>，然后按下<code class="fe ox oy oz pa b">Shift + Z + Z</code>。</p><p id="d8ef" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在让我们试着打开容器:</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="407e" class="mn mo jj pa b gy pf pg l ph pi">docker run --name pi-postgres -p 5432:5432 --env-file .env -v data:/var/lib/postgresql/data dekiesel/timescaledb-postgis:1.7.4-pg12</span></pre><p id="386b" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果您能看到这条消息，那么我们就快到了:</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="b3e3" class="mn mo jj pa b gy pf pg l ph pi">LOG:  database system is ready to accept connections</span></pre><p id="f314" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在在你的电脑上打开另一个终端。在不进入您的Pi的情况下，尝试:</p><blockquote class="pk pl pm"><p id="48d7" class="lh li pn lj b lk ll kt lm ln lo kw lp po lr ls lt pp lv lw lx pq lz ma mb mc im bi translated">注意:您需要在本地安装Postgres才能运行该行。如果您没有Postgres，请遵循此处的说明<a class="ae jg" href="https://www.postgresql.org/download/" rel="noopener ugc nofollow" target="_blank"/>。</p></blockquote><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="f2c3" class="mn mo jj pa b gy pf pg l ph pi">$ psql -h pi.postgres -p 5432 -U postgres postgres</span></pre><p id="fbe3" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果它提示输入密码，那么我们只需要返回Pi再做一件事！</p><h2 id="4503" class="mn mo jj bd mp mq ny dn ms mt nz dp mv lq oa mx my lu ob na nb ly oc nd ne jp bi translated">TMUX:会议万岁</h2><p id="8a74" class="pw-post-body-paragraph lh li jj lj b lk nf kt lm ln ng kw lp lq nh ls lt lu ni lw lx ly nj ma mb mc im bi translated">为了完成这个难题，我们将从Tmux运行docker容器。对于那些不熟悉它的人来说，Tmux允许在一个窗口中同时访问多个终端会话。Tmux还允许远程会话保持活动状态，这样即使我们与Pi断开连接，我们仍然能够使用<code class="fe ox oy oz pa b">tmux attach</code>访问同一个会话，否则这是不可能的。保持会话活动使我们能够更容易地调试和监控后端。为此，运行以下命令:</p><pre class="ot ou ov ow gt pb pa pc pd aw pe bi"><span id="6793" class="mn mo jj pa b gy pf pg l ph pi">$ tmux<br/>$ docker stop pi-postgres<br/>$ docker rm pi-postgres<br/>$ docker run --name pi-postgres -p 5432:5432 --env-file .env -v data:/var/lib/postgresql/data dekiesel/timescaledb-postgis:1.7.4-pg12</span></pre><p id="188d" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">要从Tmux会话中分离，请运行<code class="fe ox oy oz pa b">tmux detach</code>。这不会停止容器，只是在视觉上隐藏了终端会话。要重新连接到会话，请尝试<code class="fe ox oy oz pa b">tmux attach</code>。你也可以尝试断开SSH，重新SSH，尝试<code class="fe ox oy oz pa b">tmux attach</code>看看容器是否还在运行。</p></div><div class="ab cl pr ps hx pt" role="separator"><span class="pu bw bk pv pw px"/><span class="pu bw bk pv pw px"/><span class="pu bw bk pv pw"/></div><div class="im in io ip iq"><p id="32c1" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">瞧啊。这就是Raspberry Pi上的NAS Postgres服务器，带有PostGIS和TimescaleDB。PostGIS和TimescaleDB应该可以满足我们的大部分需求，但是您可以随时使用docker容器，并向您的堆栈中添加新的组件。</p><p id="7ffe" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这是这个博客的内容。希望你觉得博客或代码有用！如果我错过了什么，或者如果你有任何问题，请随时回复或pm。如果你想了解更多关于Python、数据科学或机器学习的知识，你可能想看看这些帖子:</p><ul class=""><li id="bd7a" class="nk nl jj lj b lk ll ln lo lq nm lu nn ly no mc np nq nr ns bi translated"><a class="ae jg" rel="noopener ugc nofollow" target="_blank" href="/3-common-problems-with-neural-network-initialisation-5e6cacfcd8e6">神经网络初始化的3个常见问题</a></li><li id="f7a5" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><a class="ae jg" href="https://towardsdatascience.com/google-deepminds-rfa-approximating-softmax-attention-mechanism-in-transformers-d685345bbc18" rel="noopener" target="_blank">谷歌的RFA:近似于变形金刚中的Softmax注意力机制</a></li><li id="bb29" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><a class="ae jg" href="https://towardsdatascience.com/7-easy-ways-for-improving-your-data-science-workflow-b2da81ea3b2" rel="noopener" target="_blank">改进数据科学工作流程的7种简单方法</a></li><li id="85d4" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><a class="ae jg" href="https://towardsdatascience.com/efficient-implementation-of-conditional-logic-on-pandas-dataframes-4afa61eb7fce" rel="noopener" target="_blank">熊猫数据帧上的高效条件逻辑</a></li><li id="23d1" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><a class="ae jg" href="https://towardsdatascience.com/memory-efficiency-of-common-python-data-structures-88f0f720421" rel="noopener" target="_blank">常见Python数据结构的内存效率</a></li><li id="bd22" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><a class="ae jg" href="https://towardsdatascience.com/parallelism-with-python-part-1-196f0458ca14" rel="noopener" target="_blank">与Python并行</a></li><li id="b88a" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><a class="ae jg" href="https://towardsdatascience.com/cookiecutter-plugin-for-jupyter-easily-organise-your-data-science-environment-a56f83140f72" rel="noopener" target="_blank">数据科学的基本Jupyter扩展设置</a></li><li id="2823" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><a class="ae jg" href="https://towardsdatascience.com/mastering-root-searching-algorithms-in-python-7120c335a2a8" rel="noopener" target="_blank">Python中高效的根搜索算法</a></li></ul><p id="050d" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果你想了解更多关于将机器学习应用于投资的知识，这里有一些你可能想看看的其他帖子:</p><ul class=""><li id="bf89" class="nk nl jj lj b lk ll ln lo lq nm lu nn ly no mc np nq nr ns bi translated"><a class="ae jg" href="https://medium.com/towards-artificial-intelligence/genetic-algorithm-for-trading-strategy-optimization-in-python-614eb660990d" rel="noopener">Python中交易策略优化的遗传算法</a></li><li id="ebc7" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><a class="ae jg" href="https://medium.com/towards-artificial-intelligence/genetic-algorithm-stop-overfitting-trading-strategies-5df671d5cde1" rel="noopener">遗传算法——停止过度拟合交易策略</a></li><li id="7da1" class="nk nl jj lj b lk nt ln nu lq nv lu nw ly nx mc np nq nr ns bi translated"><a class="ae jg" href="https://medium.com/towards-artificial-intelligence/ann-recommendation-system-for-stock-selection-c9751a3a0520" rel="noopener">人工神经网络选股推荐系统</a></li></ul><figure class="ot ou ov ow gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi py"><img src="../Images/59fad6764665d4d77efcc13cbf1e2709.png" data-original-src="https://miro.medium.com/v2/resize:fit:690/1*ZQOTw24seljdPG0hvnUnUQ.gif"/></div></div></figure></div><div class="ab cl pr ps hx pt" role="separator"><span class="pu bw bk pv pw px"/><span class="pu bw bk pv pw px"/><span class="pu bw bk pv pw"/></div><div class="im in io ip iq"><div class="ot ou ov ow gt pz"><a href="https://www.linkedin.com/in/louis-chan-b55b9287" rel="noopener  ugc nofollow" target="_blank"><div class="qa ab fo"><div class="qb ab qc cl cj qd"><h2 class="bd jt gy z fp qe fr fs qf fu fw js bi translated">Louis Chan—FTI Consulting | LinkedIn数据科学总监</h2><div class="qg l"><h3 class="bd b gy z fp qe fr fs qf fu fw dk translated">雄心勃勃的，好奇的和有创造力的个人，对分支知识和知识之间的相互联系有强烈的信念</h3></div><div class="qh l"><p class="bd b dl z fp qe fr fs qf fu fw dk translated">www.linkedin.com</p></div></div><div class="qi l"><div class="qj l qk ql qm qi qn ja pz"/></div></div></a></div><figure class="ot ou ov ow gt iv gh gi paragraph-image"><a href="https://www.buymeacoffee.com/louischan"><div class="gh gi qo"><img src="../Images/da3aff0c3084d4947b2ec1e61ca695a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:340/format:webp/0*Cpr-p1u_iYtIzstu.png"/></div></a></figure></div><div class="ab cl pr ps hx pt" role="separator"><span class="pu bw bk pv pw px"/><span class="pu bw bk pv pw px"/><span class="pu bw bk pv pw"/></div><div class="im in io ip iq"><blockquote class="pk pl pm"><p id="55e7" class="lh li pn lj b lk ll kt lm ln lo kw lp po lr ls lt pp lv lw lx pq lz ma mb mc im bi translated">声明:如果您通过博客中的链接购买零件，我们将不胜感激。但是如果你不习惯使用这些链接，你可以自己在亚马逊上用关键词搜索。</p></blockquote></div></div>    
</body>
</html>