<html>
<head>
<title>Abraham Lincoln Lyceum Speech, NLP sentiment analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">亚伯拉罕·林肯中学演讲，NLP情感分析</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/abraham-lincoln-lyceum-speech-nlp-sentiment-analysis-3749f4ad4e22?source=collection_archive---------4-----------------------#2021-08-02">https://pub.towardsai.net/abraham-lincoln-lyceum-speech-nlp-sentiment-analysis-3749f4ad4e22?source=collection_archive---------4-----------------------#2021-08-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="63f8" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/nlp" rel="noopener ugc nofollow" target="_blank">自然语言处理</a></h2><div class=""/><div class=""><h2 id="d4d7" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用TextBlob执行情感分析。完整的代码可在我的回购<a class="ae kr" href="https://github.com/arditoibryan/Projects/tree/master/20210719_TextBlob_sentiment_analysis" rel="noopener ugc nofollow" target="_blank">。</a></h2></div><p id="57c6" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">在本文中，我将解释一个简单的代码，它能够抓取包含亚伯拉罕·林肯演讲的HTML页面，然后，在清理数据后，我将对每个句子进行情感分析，以更好地理解数据。本文的目的是让您对这项技术的工作原理有一个基本的了解，以及基本的NLP数据处理是如何完成的。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/679c2ea4083d041ed7d66f604ff69889.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Y77ADstz6_0sTMmv.jpg"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">亚伯拉罕·林肯吸血鬼猎人，2012</figcaption></figure><p id="9232" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">有很多软件可以进行情感分析，其中最先进的一个可以在HuggingFace库中找到。然而，为了简化和最小化复杂性，我将限制自己使用这个开源工具。</p><p id="a558" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">本文将遵循这些简单的步骤:</p><ol class=""><li id="dd6c" class="me mf it ku b kv kw ky kz lb mg lf mh lj mi ln mj mk ml mm bi translated">导入库</li><li id="3cc7" class="me mf it ku b kv mn ky mo lb mp lf mq lj mr ln mj mk ml mm bi translated">网络抓取演讲</li><li id="f321" class="me mf it ku b kv mn ky mo lb mp lf mq lj mr ln mj mk ml mm bi translated">从代码中分离出语音</li><li id="0838" class="me mf it ku b kv mn ky mo lb mp lf mq lj mr ln mj mk ml mm bi translated">清理文本</li><li id="1f26" class="me mf it ku b kv mn ky mo lb mp lf mq lj mr ln mj mk ml mm bi translated">把演讲分成句子</li><li id="dd25" class="me mf it ku b kv mn ky mo lb mp lf mq lj mr ln mj mk ml mm bi translated">执行情感分析</li><li id="f4f9" class="me mf it ku b kv mn ky mo lb mp lf mq lj mr ln mj mk ml mm bi translated">打印结果</li><li id="62b6" class="me mf it ku b kv mn ky mo lb mp lf mq lj mr ln mj mk ml mm bi translated">使用散点图绘制交互结果</li></ol><h2 id="8834" class="ms mt it bd mu mv mw dn mx my mz dp na lb nb nc nd lf ne nf ng lj nh ni nj iz bi translated">导入库</h2><p id="c5dc" class="pw-post-body-paragraph ks kt it ku b kv nk kd kx ky nl kg la lb nm ld le lf nn lh li lj no ll lm ln im bi translated">为了执行web抓取，我将使用Beautifulsoup库。据我所知，这是可用的最简单的web抓取库。它可以在大多数网站上运行，除非他们有防止网络抓取的保护措施。从简单的HTML中提取信息将是小菜一碟。</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="a264" class="ms mt it nq b gy nu nv l nw nx">#download data<br/>import requests<br/>from bs4 import BeautifulSoup</span></pre><h2 id="1a64" class="ms mt it bd mu mv mw dn mx my mz dp na lb nb nc nd lf ne nf ng lj nh ni nj iz bi translated">网络抓取演讲</h2><p id="fbcb" class="pw-post-body-paragraph ks kt it ku b kv nk kd kx ky nl kg la lb nm ld le lf nn lh li lj no ll lm ln im bi translated">我要做的第一件事是连接到网站下载HTML。我特意选择了一个包含林肯演讲的简单网站。</p><p id="a359" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">程序将把HTML保存在一个变量中。然后，我需要解析和清理字符串。</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="1e25" class="ms mt it nq b gy nu nv l nw nx">URL = '<a class="ae kr" href="http://www.abrahamlincolnonline.org/lincoln/speeches/lyceum.htm'" rel="noopener ugc nofollow" target="_blank">http://www.abrahamlincolnonline.org/lincoln/speeches/lyceum.htm'</a><br/>page = requests.get(URL)</span><span id="dc6d" class="ms mt it nq b gy ny nv l nw nx">#next step: parsing<br/>soup = BeautifulSoup(page.content, 'html.parser')<br/>soup</span></pre><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi nz"><img src="../Images/3acfba3f00c67540b1ec670119f79e7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gzt9_uY-vHifeGeWAULYoA.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">正如我们所看到的，文本还不能用于NLP任务</figcaption></figure><h2 id="0fa8" class="ms mt it bd mu mv mw dn mx my mz dp na lb nb nc nd lf ne nf ng lj nh ni nj iz bi translated">从代码中分离出语音</h2><p id="0e01" class="pw-post-body-paragraph ks kt it ku b kv nk kd kx ky nl kg la lb nm ld le lf nn lh li lj no ll lm ln im bi translated">因为整个HTML页面包含的字符和信息比我需要的要多，所以通过打印演讲的第一句和最后一句的索引，我将能够直接从字符串中选择它。只有这样，我才会继续打扫。</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="6ba3" class="ms mt it nq b gy nu nv l nw nx">#extract full speech, from beginning to end<br/>print(str(soup).find('As a subject fo'))<br/>print(str(soup).find('not prevail against')+len('not prevail against'))</span><span id="b950" class="ms mt it nq b gy ny nv l nw nx">speech = str1[2285:23012]</span><span id="09f5" class="ms mt it nq b gy ny nv l nw nx">#show last 100 words<br/>speech[-100:]</span><span id="6845" class="ms mt it nq b gy ny nv l nw nx">Output:<br/>2285<br/>23009<br/>As a subject for the remarks of the evening, &lt;i&gt;the perpetuation of\nour political institutions,&lt;/i&gt; is selected.&lt;p&gt;\n\nIn the great journal of things happening under the sun, we, the\nAmerican People, find our account running, under date of the\nnineteenth century of the Christian era.--We find ourselves in the\npeaceful possession, of the fairest portion of the earth, as regards\nextent of territory, fertility of soil, and salubrity of climate.\nWe...</span></pre><h2 id="7704" class="ms mt it bd mu mv mw dn mx my mz dp na lb nb nc nd lf ne nf ng lj nh ni nj iz bi translated">清理文本</h2><p id="e8e1" class="pw-post-body-paragraph ks kt it ku b kv nk kd kx ky nl kg la lb nm ld le lf nn lh li lj no ll lm ln im bi translated">有时候，清理字符串是非常复杂的，特别是如果它们的长度很大，我们无法手动检查(让我们想想大数据)。幸运的是，这次我没有遇到很多问题。首先，我将使用regex命令清除每个HTML组件中的文本，然后删除返回的字符串，然后只进行一些自定义编辑(删除圣路易斯的点)。</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="05b4" class="ms mt it nq b gy nu nv l nw nx">#clean speech from characters used in html<br/>import re</span><span id="54d7" class="ms mt it nq b gy ny nv l nw nx">def cleanhtml(raw_html):<br/>  cleanr = re.compile('&lt;.*?&gt;')<br/>  cleantext = re.sub(cleanr, '', raw_html)<br/>  return cleantext</span><span id="fe94" class="ms mt it nq b gy ny nv l nw nx">cleaned_speech = cleanhtml(speech).replace("\n" , " ")<br/>#St. Louis would have split into a single sentence<br/>cleaned_speech = cleanhtml(cleaned_speech).replace("St. Louis" , "St Louis")</span><span id="8717" class="ms mt it nq b gy ny nv l nw nx">Output:<br/>As a subject for the remarks of the evening, the perpetuation of our political institutions, is selected.  In the great journal of things happening under the sun, we, the American People, find our account running, under date of the nineteenth century of the Christian era.--We find ourselves in the peaceful possession, of the fairest portion of the earth, as regards extent of territory, fertility of soil, and salubrity of climate. We...</span></pre><h2 id="db3a" class="ms mt it bd mu mv mw dn mx my mz dp na lb nb nc nd lf ne nf ng lj nh ni nj iz bi translated">把演讲分成句子</h2><p id="1732" class="pw-post-body-paragraph ks kt it ku b kv nk kd kx ky nl kg la lb nm ld le lf nn lh li lj no ll lm ln im bi translated">现在这个演讲已经完全干净了，看起来像一个没有任何奇怪字符的常规字符串，我将把它分成句子，把每个句子存储在一个数组中。</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="aff5" class="ms mt it nq b gy nu nv l nw nx">#split sentences by . and put them in a list<br/>sentences = cleaned_speech.split('.')</span><span id="9369" class="ms mt it nq b gy ny nv l nw nx">Output:<br/>['As a subject for the remarks of the evening, the perpetuation of our political institutions, is selected',  <br/>'In the great journal of things happening under the sun, we, the American People, find our account running, under date of the nineteenth century of the Christian era',  <br/>'--We find ourselves in the peaceful possession, of the fairest portion of the earth, as regards extent of territory, fertility of soil, and salubrity of climate',  <br/>'We...</span></pre><h2 id="14ac" class="ms mt it bd mu mv mw dn mx my mz dp na lb nb nc nd lf ne nf ng lj nh ni nj iz bi translated">执行情感分析</h2><p id="be3d" class="pw-post-body-paragraph ks kt it ku b kv nk kd kx ky nl kg la lb nm ld le lf nn lh li lj no ll lm ln im bi translated">我现在需要做的就是遍历每一个句子并进行情感分析。TextBlob是一个非常简单的工具，使得执行任务非常容易。最后，我将把我的结果存储在一个数据集中。</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="b491" class="ms mt it nq b gy nu nv l nw nx">from textblob import TextBlob</span><span id="b84e" class="ms mt it nq b gy ny nv l nw nx">df = list()<br/>for sentence in sentences:<br/>  testimonial = TextBlob(sentence)<br/>  #testimonial.sentiment (polarity, subjectvity)<br/>  testimonial.sentiment.polarity<br/>  df.append([sentence, testimonial.sentiment.polarity, testimonial.subjectivity])<br/>df</span><span id="b523" class="ms mt it nq b gy ny nv l nw nx">import pandas as pd</span><span id="624f" class="ms mt it nq b gy ny nv l nw nx">df = pd.DataFrame(df)<br/>df.columns=['sentence', 'polarity', 'subjectivity']</span></pre><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi oa"><img src="../Images/c1a44f8f16e8ecb9fe4e235e1e5fff09.png" data-original-src="https://miro.medium.com/v2/resize:fit:1380/format:webp/1*xnloFw_9U146gx5m9OtN9w.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">最终数据集的样本</figcaption></figure><h2 id="a542" class="ms mt it bd mu mv mw dn mx my mz dp na lb nb nc nd lf ne nf ng lj nh ni nj iz bi translated">打印结果</h2><p id="a960" class="pw-post-body-paragraph ks kt it ku b kv nk kd kx ky nl kg la lb nm ld le lf nn lh li lj no ll lm ln im bi translated">我现在将根据情感分析的结果打印出前5句和后5句。</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="59a5" class="ms mt it nq b gy nu nv l nw nx">print('\n', 'top 5 sentences for polarity')<br/>display(df.sort_values('polarity', ascending=False)[0:5])</span><span id="229f" class="ms mt it nq b gy ny nv l nw nx">print('\n', 'lowest 5 sentences for polarity')<br/>display(df.sort_values('polarity', ascending=True)[0:5])</span><span id="6946" class="ms mt it nq b gy ny nv l nw nx">print('\n', 'top 5 sentences for subjectivity')<br/>display(df.sort_values('subjectivity', ascending=False)[0:5])</span><span id="8238" class="ms mt it nq b gy ny nv l nw nx">print('\n', 'lowest 5 sentences for subjectivity')<br/>display(df.sort_values('subjectivity', ascending=True)[0:5])</span></pre><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi ob"><img src="../Images/caf291ae0bd72e0d754067b51dd64478.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*N3rSG9FnRJSLX78sbpg1Zg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">决赛成绩</figcaption></figure><h2 id="8f08" class="ms mt it bd mu mv mw dn mx my mz dp na lb nb nc nd lf ne nf ng lj nh ni nj iz bi translated">使用散点图绘制交互结果</h2><p id="363f" class="pw-post-body-paragraph ks kt it ku b kv nk kd kx ky nl kg la lb nm ld le lf nn lh li lj no ll lm ln im bi translated">通过使用plotly，我能够使用交互式图表来可视化我的结果:</p><pre class="lp lq lr ls gt np nq nr ns aw nt bi"><span id="5b31" class="ms mt it nq b gy nu nv l nw nx">import requests<br/>from bs4 import BeautifulSoup<br/>from textblob import TextBlob<br/>import pandas as pd<br/>import re<br/>import plotly.express as px</span><span id="839f" class="ms mt it nq b gy ny nv l nw nx">fig = px.scatter(df, title='Lincoln', x='polarity', y='subjectivity', hover_data=['sentence'])<br/>fig.show()</span></pre><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi oc"><img src="../Images/93a363e6b4ee74b1f2aa2b887e5a94fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9llaIw8WyppALe4Vb60TCg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">基于主观性和极性的结果散点图</figcaption></figure></div></div>    
</body>
</html>