<html>
<head>
<title>Deploying Machine Learning Models as API using AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用AWS将机器学习模型部署为API</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/deploying-machine-learning-models-as-api-using-aws-a25d05518084?source=collection_archive---------1-----------------------#2020-06-12">https://pub.towardsai.net/deploying-machine-learning-models-as-api-using-aws-a25d05518084?source=collection_archive---------1-----------------------#2020-06-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="3b04" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a>，<a class="ae ep" href="https://towardsai.net/p/category/cloud-computing" rel="noopener ugc nofollow" target="_blank">云计算</a></h2><div class=""/><div class=""><h2 id="48bd" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Lambda函数通过API访问SageMaker机器学习模型端点的指南。</h2></div><p id="424d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">作为一个机器学习从业者，我以前是做模型的。但是仅仅建立模型对于实时产品来说是远远不够的。ML模型需要与web或移动应用程序集成。解决这个问题的最好方法之一是将模型部署为API，并在需要时推断结果。</p><blockquote class="ln lo lp"><p id="cd06" class="kr ks lq kt b ku kv kd kw kx ky kg kz lr lb lc ld ls lf lg lh lt lj lk ll lm im bi translated">将模型部署为API的主要优势在于，ML工程师可以将代码与其他开发人员分开，并在不对Web或应用程序开发人员造成干扰的情况下更新模型。</p></blockquote><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi lu"><img src="../Images/e3219ba709de7aa7e1c379364c8c6c00.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nwmT4UYwfqB3y6Md71Q9YA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">建筑(使用apps.diagrams.net设计)</figcaption></figure><p id="4606" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">工作流程</strong>:客户端向API发送请求。API触发器被添加到Lambda函数中，这导致调用SageMaker端点并通过API将预测返回给客户端。</p><p id="2dfc" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">在本文中，我将构建一个简单的分类模型，并使用<strong class="kt jd"> Postman </strong>测试部署的模型API。</p><h2 id="d554" class="mk ml it bd mm mn mo dn mp mq mr dp ms la mt mu mv le mw mx my li mz na nb iz bi translated">我们开始吧！我们将遵循的步骤是:</h2><ol class=""><li id="b663" class="nc nd it kt b ku ne kx nf la ng le nh li ni lm nj nk nl nm bi translated">构建SageMaker模型端点。</li><li id="687e" class="nc nd it kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">创建Lambda函数。</li><li id="5c1f" class="nc nd it kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">作为API部署。</li><li id="291d" class="nc nd it kt b ku nn kx no la np le nq li nr lm nj nk nl nm bi translated">与邮递员一起测试。</li></ol></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="1e57" class="nz ml it bd mm oa ob oc mp od oe of ms ki og kj mv kl oh km my ko oi kp nb oj bi translated">构建SageMaker模型端点</h1><p id="ebc1" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ok lc ld le ol lg lh li om lk ll lm im bi translated">让我们建立一个鸢尾物种预测模型。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="ef75" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd">注</strong>:训练SageMaker分类模型时，目标变量应该是第一列，如果是连续的，则将其转换为离散的。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="on oo l"/></div></figure><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div class="gh gi op"><img src="../Images/67f916f59c9fba46c6b01efdfc5c81fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1184/format:webp/1*SCtzw7J5rEoqqNVe489YSA.png"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">数据集结构</figcaption></figure><p id="ca29" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 1。</strong>创建、训练和验证数据，以训练和测试模型。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="on oo l"/></div></figure><p id="ce83" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 2。</strong>对模型进行训练，得到该模型在当前区域的图像URI。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">创建xgboost模型估计器。</figcaption></figure><p id="ce6d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 3。</strong>设置模型的超参数(您可以使用SageMaker Auto-Pilot实验为您的模型获取最佳超参数，也可以手动设置您自己的超参数)。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">超参数调谐。</figcaption></figure><p id="c323" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 4。</strong>用训练和验证数据拟合模型。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">模型拟合。</figcaption></figure><p id="3244" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 5。</strong>现在为模型创建一个端点。</p><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">端点创建。</figcaption></figure><p id="518b" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">您可以在SageMaker UI中查看端点配置。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi oq"><img src="../Images/4ad32d8631cd9d7b9325adc0bb555325.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e03qIadCw_O2W2T87EqqQA.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">SageMaker端点</figcaption></figure><h1 id="314f" class="nz ml it bd mm oa or oc mp od os of ms ki ot kj mv kl ou km my ko ov kp nb oj bi translated">创建Lambda函数</h1><p id="a332" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ok lc ld le ol lg lh li om lk ll lm im bi translated">现在我们有了一个SageMaker模型端点。让我们看看如何从Lambda调用它。有一个API动作叫做SageMaker Runtime，我们使用<em class="lq">boto 3</em><a class="ae ow" href="https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/sagemaker-runtime.html" rel="noopener ugc nofollow" target="_blank"><em class="lq">SageMaker-Runtime . invoke _ endpoint()</em>。</a>从AWS Lambda控制台中，选择<strong class="kt jd">创建功能</strong>。</p><ol class=""><li id="4551" class="nc nd it kt b ku kv kx ky la ox le oy li oz lm nj nk nl nm bi translated">创建一个新角色，以便Lambda函数有权调用SageMaker端点。</li></ol><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi oq"><img src="../Images/7df15cfa422d9fae576a1364c3370eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uZf6b0XptJkojHup_MJ3iw.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">Lambda函数初始设置(图片由作者提供)</figcaption></figure><figure class="lv lw lx ly gt lz"><div class="bz fp l di"><div class="on oo l"/></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">Lambda函数(作者供图)</figcaption></figure><p id="cf92" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><code class="fe pa pb pc pd b"><strong class="kt jd">2.</strong> ENDPOINT_NAME</code>是一个环境变量，保存我们刚刚部署的SageMaker模型端点的名称。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi pe"><img src="../Images/1ecc4da2537e986e43c53cd70cd0c55e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PlIEkBL_VEQ9NmySQj1T7A.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">环境变量(作者提供照片)</figcaption></figure><h1 id="f1d7" class="nz ml it bd mm oa or oc mp od os of ms ki ot kj mv kl ou km my ko ov kp nb oj bi translated">部署API</h1><p id="bd48" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ok lc ld le ol lg lh li om lk ll lm im bi translated"><strong class="kt jd"> 1。</strong>打开亚马逊API网关控制台。选择<strong class="kt jd"> Create API，</strong>选择REST API(当我们发送post请求并得到响应时)。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi pe"><img src="../Images/96293350c45c4715e1f037f5f0e9b393.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZDXMFu4e7Vw5bZ9NUELtFQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">(作者供图)</figcaption></figure><p id="f818" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 2 </strong>。将您的API命名为，并将端点类型选择为Regional(因为它应该在您的区域内被访问)。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi pf"><img src="../Images/509ec0b5eea0e1bbb40f8b8a8b81f807.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9cCBlzZ4bOZSBRK0flGx9Q.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">创建REST API(作者提供图片)</figcaption></figure><p id="1b52" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 3。</strong>从<strong class="kt jd">动作</strong>下拉列表中选择，创建一个<strong class="kt jd">资源</strong>，命名为“irispredict”。单击以创建资源。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi pg"><img src="../Images/06d458e3e43201a3fd8884faff43b4e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_wbi4n_itA9v_LkQE_qJKQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">创建资源(作者照片)</figcaption></figure><p id="13cb" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 4。</strong>创建资源后，从同一个下拉列表中选择“创建方法”来创建发布方法。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi ph"><img src="../Images/34e83be0a563727ff2c500d99d47d205.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BxXao-yIAIwTt1zEO_UzAQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">添加帖子方法(作者供图)</figcaption></figure><p id="7e89" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 5。</strong>在出现的屏幕上，执行以下操作:</p><ul class=""><li id="7c0e" class="nc nd it kt b ku kv kx ky la ox le oy li oz lm pi nk nl nm bi translated">对于集成类型，选择Lambda函数。</li><li id="33ac" class="nc nd it kt b ku nn kx no la np le nq li nr lm pi nk nl nm bi translated">对于Lambda函数，输入所创建函数的名称。</li></ul><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi pj"><img src="../Images/b5d1cddd2376698b0a24852caa58b13d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gY6wsrycjk9F8u4tRlxMJg.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">用API网关连接Lamda函数(作者供图)</figcaption></figure><p id="f082" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">6。 API结构看起来类似下图:</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi pk"><img src="../Images/0eea3f8e18bd5b843b04a3928cbc8f10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y1C15yUrZqwvpCQpPjRwhg.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">(作者供图)</figcaption></figure><p id="fdf3" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated">7。从<em class="lq">动作</em>中选择<em class="lq">部署API </em>。在出现的页面上，创建一个新阶段。称之为“物种”，点击<strong class="kt jd">部署</strong>。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi pl"><img src="../Images/a2955fd1299ff48c2d705ac34e83a266.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*BEdutInKbV3t_mFh8bSPtw.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">部署API(作者提供图片)</figcaption></figure><p id="7e21" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 8。</strong>出现一个窗口，显示已创建的阶段。转到post方法，将生成调用URL，这是最终的API端点。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi pm"><img src="../Images/2d035a04bcd6ac45878dea2b6432cd89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5pakPYY1gWIPiX-4CExG8A.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">API URL(作者提供图片)</figcaption></figure><h1 id="02ff" class="nz ml it bd mm oa or oc mp od os of ms ki ot kj mv kl ou km my ko ov kp nb oj bi translated">邮递员测试</h1><p id="493d" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ok lc ld le ol lg lh li om lk ll lm im bi translated"><strong class="kt jd"> Postman </strong>是一个流行的API客户端，让开发者可以轻松地创建、共享、测试和记录API。</p><p id="29c9" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 1。</strong>在通过Postman调用API之前，在授权部分添加您的AWS密钥和访问密钥。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi pf"><img src="../Images/77bfe0662f71c06773de05cbecb7452f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*96zYhj4C41QZC9Bx0v5hYw.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">(作者供图)</figcaption></figure><p id="274d" class="pw-post-body-paragraph kr ks it kt b ku kv kd kw kx ky kg kz la lb lc ld le lf lg lh li lj lk ll lm im bi translated"><strong class="kt jd"> 2。</strong>考验邮递员。在正文中以JSON的形式给出输入。当您点击<em class="lq">发送</em>请求到API时，输出会相应显示。</p><figure class="lv lw lx ly gt lz gh gi paragraph-image"><div role="button" tabindex="0" class="ma mb di mc bf md"><div class="gh gi pf"><img src="../Images/725d8424b0ea9a0350c3607e573014e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Y_sGINyeyfwPgCVF9idzAQ.png"/></div></div><figcaption class="mg mh gj gh gi mi mj bd b be z dk translated">与邮递员一起测试(作者提供照片)</figcaption></figure><h1 id="198e" class="nz ml it bd mm oa or oc mp od os of ms ki ot kj mv kl ou km my ko ov kp nb oj bi translated">结论</h1><p id="6946" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ok lc ld le ol lg lh li om lk ll lm im bi translated">现在我们已经使用Lambda(无服务器组件)成功地将机器学习模型部署为API。只需一次点击就可以调用这个API，用户和开发人员可以很容易地进行推断。</p><h1 id="1e7b" class="nz ml it bd mm oa or oc mp od os of ms ki ot kj mv kl ou km my ko ov kp nb oj bi translated">最后的想法</h1><p id="bcea" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ok lc ld le ol lg lh li om lk ll lm im bi translated">我将使用ElasticBeanStalk和其他AWS服务将ML模型部署为Web应用程序。在那之前，呆在家里，保持安全，继续探索！</p><h1 id="9ff2" class="nz ml it bd mm oa or oc mp od os of ms ki ot kj mv kl ou km my ko ov kp nb oj bi translated">取得联系</h1><p id="7005" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ok lc ld le ol lg lh li om lk ll lm im bi translated">我希望你觉得这篇文章很有见地。我很乐意听到你的反馈，以便更好地即兴发挥和回来！如果你想联系，请在 <a class="ae ow" href="https://www.linkedin.com/in/findtharun/" rel="noopener ugc nofollow" target="_blank"> <strong class="kt jd"> LinkedIn </strong> </a>上<strong class="kt jd">联系我。感谢阅读！</strong></p></div><div class="ab cl ns nt hx nu" role="separator"><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx ny"/><span class="nv bw bk nw nx"/></div><div class="im in io ip iq"><h1 id="f0b0" class="nz ml it bd mm oa ob oc mp od oe of ms ki og kj mv kl oh km my ko oi kp nb oj bi translated">参考</h1><p id="5b4a" class="pw-post-body-paragraph kr ks it kt b ku ne kd kw kx nf kg kz la ok lc ld le ol lg lh li om lk ll lm im bi translated">[1] : AWS文档<a class="ae ow" href="https://docs.aws.amazon.com/sagemaker/latest/dg/getting-started-client-app.html" rel="noopener ugc nofollow" target="_blank">https://docs . AWS . Amazon . com/sage maker/latest/DG/getting-started-client-app . html</a></p></div></div>    
</body>
</html>