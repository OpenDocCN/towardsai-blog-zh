<html>
<head>
<title>Foods Around Jakarta (Part 1): Zomato Web Scraping with Selenium</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">雅加达周围的食物(第一部分):佐马托网刮硒</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/foods-around-jakarta-part-1-zomato-web-scraping-with-selenium-8a96b0547466?source=collection_archive---------0-----------------------#2020-10-20">https://pub.towardsai.net/foods-around-jakarta-part-1-zomato-web-scraping-with-selenium-8a96b0547466?source=collection_archive---------0-----------------------#2020-10-20</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="a545" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a>，<a class="ae ep" href="https://towardsai.net/p/category/web-scraping" rel="noopener ugc nofollow" target="_blank">网页抓取</a></h2><div class=""/><div class=""><h2 id="b8ee" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">想知道大榴莲有什么样的食物(和饮料)吗？还是用硒刮吧！</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/f19e1161d657d8f5b15761174879a197.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*9neCFYLXu4GA0r-2"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Soto和Nasi Uduk，印度尼西亚最好的美食|照片由<a class="ae le" href="https://unsplash.com/@raphiella?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">拉斐尔·阿尔法里兹</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="b9e1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> <em class="mb">免责声明:</em> </strong> <em class="mb">本文仅出于教育目的。我们不鼓励任何人抓取网站，尤其是那些可能有条款和条件反对此类行为的网站。</em></p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><p id="5ef3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi mj translated">阿卡塔现在进入了新冠肺炎疫情的第八个月，从目前的情况来看，情况并没有好转。我们的政府正在这个城市实施断断续续的社会限制。</p><p id="2c2f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">建议人们呆在家里和在家工作，非必需品行业建议暂时关闭，是的，这包括你喜欢的餐馆或甜品店！</p><p id="b264" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">去年每个周末我都在我家附近的商场闲逛，探索那里的餐厅，现在不行了。有趣的事实是，印尼人喜欢聚集到餐馆，和他们的家人、朋友出去吃饭或约会。这是我们文化的一部分。现在，疫情彻底改变了我们的外出就餐文化。</p><blockquote class="ms"><p id="4be5" class="mt mu iq bd mv mw mx my mz na nb ma dk translated">做饭，还是不做饭，这是个问题。</p></blockquote><p id="dcb5" class="pw-post-body-paragraph lf lg iq lh b li nc ka lk ll nd kd ln lo ne lq lr ls nf lu lv lw ng ly lz ma ij bi translated">当社会限制条例开启时，<em class="mb">外出就餐</em>被扔出窗外。我们可以买食材，然后自己做饭，因此有了'<em class="mb">到</em> <em class="mb">做饭'</em>的选项。</p><p id="897c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">“不做饭”的选择:买外卖食品，或者更安全的，在网上订餐。作为一名雅加达人，我努力避免在这座城市出现新的COVID病例，由于印度尼西亚食品配送技术的兴起，我有时会在网上订餐</p><p id="7c32" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我发现自己一遍又一遍地通过<em class="mb"> GoFood </em>在同一家餐厅点同样的食物。当我渴望鸡肉时，我发现自己从<em class="mb">肯德基</em>和<em class="mb">麦当劳</em>点菜(是的，<em class="mb">麦当劳</em>在印度尼西亚供应鸡肉)。当我渴望索托的时候，我发现自己在索托·库杜斯·布洛克·米·特贝特等店点餐。</p><p id="2c8b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">雅加达有数千家餐馆，在8个月的疫情中，我只在雅加达不到20家餐馆点过菜。</p><p id="6f97" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">意识到这一点，并阅读<a class="nh ni ep" href="https://medium.com/u/10e15784e2a?source=post_page-----8a96b0547466--------------------------------" rel="noopener" target="_blank"> Regita H. Zakia </a>的“<a class="ae le" href="https://towardsdatascience.com/foods-around-me-google-maps-data-scraping-with-python-google-colab-588986c63db3" rel="noopener" target="_blank">我身边的食物:用Python抓取谷歌地图数据&amp;Google Colab“</a><strong class="lh ja">，</strong>我被吸引着将她所做的扩展到更大的范围。</p><p id="644f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这座城市实际上提供多少种食物？有多少家餐厅提供我最喜欢的印尼食物，Soto，和Rendang？这么多问题。</p><p id="7a78" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">所以这一次，我不打算从谷歌上搜集食品服务行业的数据，而是从Zomato上搜集。为什么？这是Jakartan美食家评分和撰写评论的地方。这是食物参考的可靠来源。</p><p id="e553" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了做到这一点，我将使用Selenium库编写一个Python脚本，通过成千上万的餐馆页面自动执行抓取过程，然后使用熊猫构建数据集。</p></div><div class="ab cl mc md hu me" role="separator"><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh mi"/><span class="mf bw bk mg mh"/></div><div class="ij ik il im in"><h1 id="6d93" class="nj nk iq bd nl nm nn no np nq nr ns nt kf nu kg nv ki nw kj nx kl ny km nz oa bi translated">我们要搜集什么数据？</h1><p id="ab2e" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">首先，由于Zomato中有大量的数据，我们必须列出我们的小研究中需要的数据。检查完<a class="ae le" href="https://www.zomato.com/id/jakarta" rel="noopener ugc nofollow" target="_blank"> Zomato页面</a>后，我决定我将刮:</p><h2 id="6eff" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">从搜索页面中:</h2><ol class=""><li id="ac87" class="or os iq lh b li ob ll oc lo ot ls ou lw ov ma ow ox oy oz bi translated">雅加达地区所有餐馆的网址</li><li id="75f1" class="or os iq lh b li pa ll pb lo pc ls pd lw pe ma ow ox oy oz bi translated">雅加达地区提供送货服务的餐馆的网址</li></ol><h2 id="fb43" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">从(个人)餐厅页面:</h2><ol class=""><li id="2fcc" class="or os iq lh b li ob ll oc lo ot ls ou lw ov ma ow ox oy oz bi translated">餐馆名称</li><li id="711e" class="or os iq lh b li pa ll pb lo pc ls pd lw pe ma ow ox oy oz bi translated">餐厅类型</li><li id="5e8a" class="or os iq lh b li pa ll pb lo pc ls pd lw pe ma ow ox oy oz bi translated">餐厅区</li><li id="bea7" class="or os iq lh b li pa ll pb lo pc ls pd lw pe ma ow ox oy oz bi translated">餐馆等级</li><li id="ade5" class="or os iq lh b li pa ll pb lo pc ls pd lw pe ma ow ox oy oz bi translated">餐馆评论</li><li id="7368" class="or os iq lh b li pa ll pb lo pc ls pd lw pe ma ow ox oy oz bi translated">餐厅的平均价格为2</li><li id="74be" class="or os iq lh b li pa ll pb lo pc ls pd lw pe ma ow ox oy oz bi translated">餐厅地址</li><li id="5b2b" class="or os iq lh b li pa ll pb lo pc ls pd lw pe ma ow ox oy oz bi translated">餐厅的附加信息/设施</li><li id="2cf0" class="or os iq lh b li pa ll pb lo pc ls pd lw pe ma ow ox oy oz bi translated">餐厅纬度和经度</li></ol><h1 id="cf38" class="nj nk iq bd nl nm pf no np nq pg ns nt kf ph kg nv ki pi kj nx kl pj km nz oa bi translated">基本准备</h1><p id="6c39" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">既然我们要使用Selenium，当然，第一步是确保我们有必要的库Selenium。因为Selenium最初是一个在web浏览器中自动执行该过程的库，所以我们需要在您的计算机上安装一个真正的浏览器，以及一个控制它的浏览器驱动程序。</p><p id="6cb1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这次我会用Google Chrome，你可以在这里下载浏览器驱动<a class="ae le" href="https://chromedriver.chromium.org/downloads/version-selection" rel="noopener ugc nofollow" target="_blank">。</a></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">从Selenium开始，将此放在代码的顶部！</figcaption></figure><h1 id="fcd9" class="nj nk iq bd nl nm pf no np nq pg ns nt kf ph kg nv ki pi kj nx kl pj km nz oa bi translated">检查搜索页面</h1><h2 id="bfd0" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">雅加达地区所有餐馆的网址列表</h2><p id="8f3e" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">Selenium是一个非常方便的库，可以使用各种方式来查找HTML元素，如<em class="mb"> id </em>、<em class="mb">类名</em>、<em class="mb">标记名</em>、<em class="mb">链接文本</em>、<em class="mb"> XPath </em>或<em class="mb"> CSS选择器</em>。有了这个指南，我还将介绍我在抓取Zomato Page时发现的各种问题，然后解释如何解决它们。</p><p id="50d2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们看看下面的搜索页面。如果我们将我们的位置锁定在雅加达，目前有1002页，每页包含大约15家餐馆。这可能意味着雅加达大约有15000家餐馆！哇，太不可思议了！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pm"><img src="../Images/0f93725f27e2839acc45c9c08a9fc065.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qipCnJAMAm4hbDHErqDrVQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">Zomato搜索第1页</figcaption></figure><p id="eedf" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在我们要刮的只是每个搜索页面上的<strong class="lh ja">网址</strong>，以后可以单独打开。想象一下手动打开1000多页，那肯定会很累(老实说，也很无聊)。硒来拯救！</p><p id="fb01" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在写Python代码之前，我们必须知道2 Selenium<em class="mb">“Find Element”</em>工具的区别:</p><ul class=""><li id="356d" class="or os iq lh b li lj ll lm lo pn ls po lw pp ma pq ox oy oz bi translated"><em class="mb">查找元素</em>:查找一个<strong class="lh ja">单个</strong>元素，通过声明<strong class="lh ja">特定的</strong> HTML元素定位器来定位</li><li id="f0e5" class="or os iq lh b li pa ll pb lo pc ls pd lw pe ma pq ox oy oz bi translated"><em class="mb">查找元素</em>:查找元素的<strong class="lh ja">列表</strong>，通过在您想要查找的元素中声明一个<strong class="lh ja">公共</strong> HTML元素定位器来定位</li></ul><p id="f47c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在我们的例子中，由于我们想要抓取每个搜索页面上的所有网站地址，我们将使用<em class="mb"> find elements </em>工具。好的，酷，那么如何识别这些餐馆列表中的网址呢？</p><p id="ac57" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们必须检查页面的HTML，然后在每个搜索页面的所有网址中找到共同的HTML元素。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi pr"><img src="../Images/4fda84aea5f39df557c1b3c7a27f0efe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ut5bJBArxE9Jyz3TDbfG_Q.jpeg"/></div></div></figure><p id="c586" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在我检查了这个搜索页面上的所有网址后，我得出结论，网址的一个常见HTML元素是它们的<em class="mb">类名</em>。</p><p id="1a70" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在，我们可以通过编写如下代码来获得<em class="mb"> Selenium Web元素</em>的列表:</p><pre class="kp kq kr ks gt ps pt pu pv aw pw bi"><span id="7818" class="og nk iq pt b gy px py l pz qa">url_elt = driver.find_elements_by_class_name("result-title")</span></pre><p id="fe40" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">看起来很简单，但是我们的目标是网站地址，对吗？我们只需要编写额外的代码，通过遍历列表，从每个<em class="mb"> Web元素</em>中提取URL页面的<strong class="lh ja">属性(href) </strong>。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="d596" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">使用上面的代码，我们将能够创建一个web地址列表。现在，让我们将它与代码结合起来，在Zomato中循环搜索所有1002个页面。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="320a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们已经编写了抓取网址的基本代码，但是我们可以通过编写代码来显示网页抓取的进度来进一步改进它，就像这样。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="2704" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">通过添加两个简单的打印代码，我们可以在每次成功遍历搜索页面时获得信息通知。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi qb"><img src="../Images/d9a5462be7a0bba606c7cb48f697ede6.png" data-original-src="https://miro.medium.com/v2/resize:fit:852/format:webp/1*2U2n0h3gaqXKlXPWfUUwmA.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">简单而丰富的是我们所需要的</figcaption></figure><p id="e70f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">不要忘记将列表转换成熊猫数据帧，这样我们就可以使数据排列整齐。</p><pre class="kp kq kr ks gt ps pt pu pv aw pw bi"><span id="0ab3" class="og nk iq pt b gy px py l pz qa">out_df = pd.DataFrame(out_lst, columns=['Website'])</span></pre><p id="16d1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">结果:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi qc"><img src="../Images/cf82bd556eb43823151d2627bb29adff.png" data-original-src="https://miro.medium.com/v2/resize:fit:866/format:webp/1*LMLCLiSOg86QgAoowWnNnA.png"/></div></figure><h2 id="70d6" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">雅加达地区提供外卖服务的所有餐厅的网址列表</h2><p id="55c4" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">接下来，我们要做完全相同的事情来获取雅加达地区提供外卖服务的餐馆列表。唯一的区别是搜索页面的URL和我们想要循环的搜索页面的数量。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="c45c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">结果:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi qd"><img src="../Images/5466e31d96305958fe47215cabb53c4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:826/format:webp/1*LuxZThROtzmvTqve3L1IQA.png"/></div></figure><h2 id="b0b1" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">删除重复的Web地址</h2><p id="0824" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">现在，雅加达地区有14886家餐馆，其中3306家提供外卖服务。在深入研究web抓取之前，我们必须确保没有重复的条目，因为搜索页面结果有时会包含重复的条目。</p><p id="3897" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们可以很容易地发现，使用一个非常简单的熊猫法，<em class="mb">复制。</em></p><pre class="kp kq kr ks gt ps pt pu pv aw pw bi"><span id="8727" class="og nk iq pt b gy px py l pz qa"># Observe whether we have duplicate websites or not</span><span id="4150" class="og nk iq pt b gy qe py l pz qa">out_df[out_df.duplicated(['Website'], keep='first')]</span></pre><p id="9cc7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">使用上面的代码，我们将看到数据帧中重复的网址列表，除了重复的第一个条目的<strong class="lh ja">。</strong></p><p id="15b4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们创建一个没有重复值的新数据框架，既包括所有餐馆的数据框架，也包括外卖餐馆的数据框架。</p><pre class="kp kq kr ks gt ps pt pu pv aw pw bi"><span id="2773" class="og nk iq pt b gy px py l pz qa"># Make A New DataFrame - without duplicated values</span><span id="c98e" class="og nk iq pt b gy qe py l pz qa">out_df_nd = out_df[~out_df.duplicated(['Website'], keep='first')]<br/>outdlv_df_nd = outdlv_df[~outdlv_df.duplicated(['Website'], keep='first')]</span></pre><h1 id="248d" class="nj nk iq bd nl nm pf no np nq pg ns nt kf ph kg nv ki pi kj nx kl pj km nz oa bi translated">检查单个餐馆页面</h1><p id="c787" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">我们现在拥有全雅加达约14500家餐厅的唯一网址。通过使用这个，我们可以遍历每个web地址并收集我们需要的信息。让我们继续写更多的代码！</p><h2 id="ecbd" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">餐馆名称</h2><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi qf"><img src="../Images/b1fbdfd2c29a8ec023a14acf9265ba82.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z5SDEVWyS_SiM2mPSyIhlA.png"/></div></div></figure><p id="0fab" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">从上图中可以很明显地看出，在HTML代码中，餐馆名称被标记为<em class="mb"> h1 </em>。以前，我们使用<em class="mb">类名</em>在HTML代码中查找元素，现在我们将使用<em class="mb">标记名</em>来查找。</p><pre class="kp kq kr ks gt ps pt pu pv aw pw bi"><span id="871f" class="og nk iq pt b gy px py l pz qa">name_anchor = driver.find_element_by_tag_name('h1')</span></pre><p id="9493" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">不要忘记find元素返回一个<em class="mb"> Selenium Web元素</em>，所以我们必须进一步提取它以获得我们需要的数据。在我们的例子中，我们可以通过使用这段代码来实现。</p><pre class="kp kq kr ks gt ps pt pu pv aw pw bi"><span id="5beb" class="og nk iq pt b gy px py l pz qa">name = name_anchor.text</span></pre><p id="302d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下面是抓取<strong class="lh ja">餐馆名称</strong>的完整代码:</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="820c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">抓取餐馆页面几分钟或几小时后，您的程序可能会停止，显示一条错误消息，因为某些页面的<em class="mb"> h1 </em>元素无法抓取。在Zomato案例中，有这样的页面:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi qg"><img src="../Images/207fb528bdc0e321f6f47396fcf58332.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c6UlZEsdHvQpTIom2TzNog.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">404错误</figcaption></figure><p id="8465" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如果我们的浏览器点击了这个页面，程序就会停止，因为它无法抓取它的h1。我们可以通过使用Selenium库中的另一个函数轻松解决这个问题:<em class="mb"> NoSuchElementException。</em>如果我们没有找到我们想要的web元素，结合<em class="mb"> if </em>语句，我们可以重新路由程序，让它通过。首先，我们必须在代码的开头导入这个函数。</p><pre class="kp kq kr ks gt ps pt pu pv aw pw bi"><span id="b818" class="og nk iq pt b gy px py l pz qa">from selenium.common.exceptions import NoSuchElementException</span></pre><p id="cab8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">之后，我们将使用一个<em class="mb"> try-except </em>语句来实现程序的逻辑。如果我们没有找到任何h1元素，只需将“404错误”写入<strong class="lh ja">餐厅名称</strong>，然后传递到下一页。</p><p id="abfc" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">此外，像我们之前所做的一样，让我们编写一些<em class="mb"> print </em>代码来显示网页抓取的进度。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div></figure><p id="d19b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">结果:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi qh"><img src="../Images/9651bbb67bd84a56db8d1444b146cdf0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*8mOeYiedCbxj1CWWdOgTnA.png"/></div></figure><h2 id="a581" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">餐厅类型</h2><p id="1795" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">下一步，我们要收集雅加达每个餐馆的类型。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi qf"><img src="../Images/1a595725c0f00ba21b6be235260f7021.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tYM-0eXfvmhxYaJIw8Jssg.jpeg"/></div></div></figure><p id="bb14" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">像Web地址一样，我们将使用<em class="mb"> find元素</em>,因为我们想要抓取多个元素。问题是，我们最好用什么定位器来找到这个元素？如果我们仔细观察，<em class="mb">标签名</em> ( <em class="mb"> div </em>)不够唯一，而<em class="mb">类名</em> ( <em class="mb"> sc-jxGEy0 </em>)在一些餐厅页面中可以不同。这就是为什么我们不能这两个定位器。</p><p id="57f7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这就是XPath 变得非常方便的地方。然而什么是<em class="mb"> XPath </em>？它代表<em class="mb"> XML路径语言</em>，我们可以用它来定位我们想要抓取的元素，因为Zomato的餐馆页面的结构大部分是相同的。</p><p id="3c5a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们如何获得这个有用的XPath呢？只需右键单击您想要的HTML代码，然后单击<em class="mb"> Copy - &gt; XPath </em>。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi qi"><img src="../Images/bf4cea96a9c1b72247b9ce9bff24b57c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rCYrUyu8YQeknGkW6Nj9UA.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">放松点。</figcaption></figure><p id="4bb4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在我们已经有了<em class="mb"> XPath </em>，只需将它粘贴到您的编码程序中，并添加这段代码。请注意，就像<em class="mb"> rest_name </em>一样，我们也要做一个空单:<em class="mb"> rest_type </em>在最上面。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div></figure><h2 id="5830" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">餐厅区域和地址</h2><p id="230b" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">接下来，我们需要刮<strong class="lh ja">餐厅区域</strong>和<strong class="lh ja">地址</strong>。这更容易，因为我们只需要抓取1个元素，就像之前一样，我们将通过<em class="mb"> XPath </em>抓取它。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div></figure><h2 id="af52" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">餐厅评论和评级</h2><p id="2433" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">在我们完成了姓名、地区和地址之后，让我们转到稍微复杂一点的信息:评论和评级。随着你的深入，你会发现并不是所有的餐馆都有这些信息。就像餐馆名称一样，我们将利用<em class="mb"> NoSuchElementException </em>。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div></figure><h2 id="d0c2" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">餐厅的平均价格为2</h2><p id="f899" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">到目前为止，<em class="mb"> XPath </em>方法非常方便地收集我们需要的数据。现在，对于这些数据，我们必须用几个<em class="mb"> if-else </em>语句来修改我们的<em class="mb">“通过XPath查找元素”</em>。原因是，对于这个特定的数据，在每个餐馆页面中的位置是不同的。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi qf"><img src="../Images/42fad48a427072df2068f9d86c90e53a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u1EtfWrS4cs9c8C2BbkvPg.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">红框显示了使基本XPath方法不能很好工作的信息</figcaption></figure><p id="b7d4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">上图中，<em class="mb">【平均成本】</em>位于<em class="mb">【大众菜】</em><em class="mb">“人们说这个地方以</em>闻名。在大多数Zomato页面中，这两条信息是不显示的，这就是为什么在有这两条信息的页面中平均成本的位置不同。</p><p id="1212" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们将使用一个字符串切片函数来检查我们抓取的数据是否以“Rp”/“No”开头。如果不是以这两个字符串开始，我们将刮另一个<em class="mb"> XPath </em>。</p><p id="daa3" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们在代码中实现这个逻辑。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div></figure><h2 id="c2f2" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">餐厅附加信息</h2><p id="b1be" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">我们已经通过各种定位器抓取了单个web元素，具有相同<em class="mb">类名</em>的多个web元素，一个<em class="mb"> XPath </em>中的多个web元素，现在我们将学习抓取一个更加独特的东西！</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi qf"><img src="../Images/de15c77177a8c09be1ddf64d7b68838e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*I9Rpw7eZtNvsU4Vnn16Ygg.jpeg"/></div></div></figure><p id="8269" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">正如你在上面的图片中看到的，我们想要抓取包含在蓝框中的所有文本信息。如果我们看到左边的HTML代码，信息分散在不同的代码中。</p><p id="790c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了有效地抓取，我们将做的是:通过<em class="mb"> XPath </em>找到蓝框的元素，然后通过使用结果，我们通过标签名<em class="mb"> p. </em>找到文本的多个元素。这里是该逻辑的代码版本<em class="mb">。</em></p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div></figure><h2 id="781d" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">餐厅纬度和经度</h2><p id="dbac" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">这种信息搜集和以前一样棘手。为了知道为什么让我们来看看。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi qf"><img src="../Images/3b5bcebaa40eb34e95dfecac99904771.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rNrOfrO41B1GO8eKG0pcgA.png"/></div></div></figure><p id="114b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">如您所见，每个餐馆的纬度和经度都位于地图的网址中。我们不需要打开地图的网址来获取经纬度。</p><p id="b55b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们可以简单地从web元素中提取web地址，然后使用python中可用的字符串函数对其进行切分。瞧啊。</p><figure class="kp kq kr ks gt kt"><div class="bz fp l di"><div class="pk pl l"/></div></figure><h2 id="1cc8" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">另一个旁注</h2><p id="4633" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">既然我们为想要抓取的每个数据编写了代码，我们就可以将它们组合在一起，从每个页面中抓取所有这些信息。</p><p id="9c2c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">但在此之前，我们最好导入另一个重要的库，我们将使用它来暂停程序的执行。</p><p id="2df4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为什么？因为，根据您的互联网连接速度，以及我们想要抓取的信息的数量/类型，我们可能需要等待浏览器完全加载页面。</p><pre class="kp kq kr ks gt ps pt pu pv aw pw bi"><span id="2b7b" class="og nk iq pt b gy px py l pz qa">import time</span><span id="26ec" class="og nk iq pt b gy qe py l pz qa"># To delay the execution of next coding line<br/>time.sleep(8)</span></pre><h2 id="1a18" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">收集所有餐厅数据</h2><p id="4460" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">编织所有上述代码，当我们运行代码时，我们会得到这个。我们可以清楚地看到网页抓取过程的进展(你也可以看到抓取过程中是否有一些错误！).</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi qj"><img src="../Images/3f5236fa56e3447ad8e62ed4965d4ad8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*94x9Q7sjP8YqcPhY-6e9XA.png"/></div></div></figure><p id="2412" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">别忘了我们抓取的结果是一个列表的集合。我们需要将它们组合在一起，创建一个紧凑、整洁的数据集。</p><pre class="kp kq kr ks gt ps pt pu pv aw pw bi"><span id="a88d" class="og nk iq pt b gy px py l pz qa">rdf = pd.DataFrame({"Restaurant Name" : rest_name[:], "Restaurant Type" : rest_type[:], "Restaurant Area" : rest_area[:], "Restaurant Rating" : rest_rating[:], "Restaurant Review" : rest_review[:], "Price for 2" : price_for_2[:], "Restaurant Address" : rest_address[:], "Additional Info" : rest_info[:], "Latitude" : rest_lat[:], "Longitude" : rest_long[:]})</span></pre><p id="f933" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">结果:</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi qk"><img src="../Images/4e5f6a03ccda5b17d5daa4bdfb4dba08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kTpW-BH2Wzura5xhNx63nw.png"/></div></div></figure><p id="c04b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">你可以在<a class="ae le" href="https://github.com/RizqiEka/ZomatoWebScraping" rel="noopener ugc nofollow" target="_blank"> Github </a>上看到抓取个人餐厅页面的完整代码。</p><h1 id="93db" class="nj nk iq bd nl nm pf no np nq pg ns nt kf ph kg nv ki pi kj nx kl pj km nz oa bi translated">结论</h1><p id="2750" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">好了，电子表格结束了！我们现在从Zomato那里获得了雅加达食品服务行业的数据。在第2部分中，我将带您完成下一步，用反向地理编码来完成这些数据！</p><p id="03c1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">也是为了你，我想说<strong class="lh ja">恭喜</strong>！您刚刚学习了如何从Zomato获取餐馆数据。在这个过程中，您还学会了使用各种技术来面对不同种类的HTML代码。</p><p id="1a13" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">此外，还要注意Zomato也可能改变它的HTML结构，所以如果有这样的变化，你可能要进一步适应。每个网站都是不同的，这就是为什么调整技术/代码来抓取它是很重要的。</p><p id="0f41" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在疫情期间保持健康，祝你刮网愉快！</p><h1 id="e16f" class="nj nk iq bd nl nm pf no np nq pg ns nt kf ph kg nv ki pi kj nx kl pj km nz oa bi translated">感谢阅读</h1><p id="80cf" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">我真的希望你喜欢这篇文章！我真的希望你能从中学到一些新的有用的东西。如果你真的这样做，请在下面鼓掌，如果你有任何反馈，请在下面留下你的想法！</p><h2 id="aa1b" class="og nk iq bd nl oh oi dn np oj ok dp nt lo ol om nv ls on oo nx lw op oq nz iw bi translated">保持联系</h2><ul class=""><li id="8d54" class="or os iq lh b li ob ll oc lo ot ls ou lw ov ma pq ox oy oz bi translated">请关注我的下一篇文章</li><li id="0389" class="or os iq lh b li pa ll pb lo pc ls pd lw pe ma pq ox oy oz bi translated">一起讨论还是想合作？让我们在<a class="ae le" href="https://www.linkedin.com/in/rizqiekamaulana/" rel="noopener ugc nofollow" target="_blank"> LinkedIn </a>上连线</li></ul></div></div>    
</body>
</html>