<html>
<head>
<title>How To Speed Up Your Grid Search 60x</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何将网格搜索速度提高60倍</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-to-speed-up-your-grid-search-60x-fec2a8250517?source=collection_archive---------3-----------------------#2022-06-06">https://pub.towardsai.net/how-to-speed-up-your-grid-search-60x-fec2a8250517?source=collection_archive---------3-----------------------#2022-06-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c0a7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">包括示例笔记本和数据集</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/e974cc4f60b6214d249d0290738b0576.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*hnNhqkfMKh5kPcuM"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">照片由<a class="ae lb" href="https://unsplash.com/@pictorious?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">威廉·基瑟林</a>在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h1 id="2cb8" class="lc ld iq bd le lf lg lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz bi translated">示例笔记本</h1><p id="043f" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">在本文中，我们将使用一个名为GridSearchCV的笔记本，它是使用来自GeeksforGeeks网站上的<a class="ae lb" href="https://www.geeksforgeeks.org/hyperparameter-tuning-using-gridsearchcv-and-kerasclassifier/" rel="noopener ugc nofollow" target="_blank">帖子</a>的代码创建的。我们将调整Keras分类器的网格搜索超参数。</p><p id="3212" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">以下是您自己下载和运行笔记本所需的文件:</p><ul class=""><li id="ed64" class="mf mg iq jp b jq jr ju jv jy mh kc mi kg mj kk mk ml mm mn bi translated"><a class="ae lb" href="https://drive.google.com/file/d/1PiCEL8SwmMx7Hvzrk_zK8rA6Y6aYgmab/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">笔记本</a></li><li id="3452" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated"><a class="ae lb" href="https://drive.google.com/file/d/1mGqI-SZAcD8aPheTAXxqCswGRNqfD96H/view?usp=sharing" rel="noopener ugc nofollow" target="_blank">数据集</a></li></ul></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="34d7" class="lc ld iq bd le lf na lh li lj nb ll lm ln nc lp lq lr nd lt lu lv ne lx ly lz bi translated">网格搜索刷新程序</h1><p id="3ffa" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">网格搜索是一种技术，通过系统地测试超参数的不同组合，帮助数据科学家找到模型的最佳设置。</p><p id="3c81" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">例如，假设您正在训练一个神经网络来对手写数字的图像进行分类。您可能希望试验不同数量的隐藏层和每层中不同数量的神经元。网格搜索不是随机猜测这些超参数的不同值，而是允许数据科学家系统地尝试不同的值组合，并查看哪一个给出最佳结果。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="ca29" class="lc ld iq bd le lf na lh li lj nb ll lm ln nc lp lq lr nd lt lu lv ne lx ly lz bi translated">基线性能</h1><p id="b4aa" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">由于网格搜索是本例中计算量最大的部分，我们将只关注包含网格搜索的单元格(单元格#5)。</p><p id="68c7" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了获得单元运行时的基线性能，我们使用了一台具有8个CPU内核和32gb RAM的笔记本电脑。细胞在26分43秒内完成。</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="112d" class="lc ld iq bd le lf na lh li lj nb ll lm ln nc lp lq lr nd lt lu lv ne lx ly lz bi translated">我们的增强功能</h1><p id="8f6f" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">让我们对这种细胞有更多的了解，并研究加速它的方法。</p><ol class=""><li id="592d" class="mf mg iq jp b jq jr ju jv jy mh kc mi kg mj kk nf ml mm mn bi translated"><strong class="jp ir">并行化网格搜索</strong></li></ol><p id="06cd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">默认情况下，网格搜索只使用1个CPU内核，笔记本电脑上的其他7个内核处于空闲状态。这可以通过并行化来改善，网格搜索非常适合并行化。</p><p id="8260" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">下面的屏幕截图显示了笔记本电脑的资源利用率，您可以看到不到一半的内核正在使用。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ng"><img src="../Images/c3435d8a7f468d6953df2ebda677db2d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sUFtPkfdt-f9jwlan3xEAg.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">使用1个内核的网格搜索</figcaption></figure><p id="90d9" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第一个增强是最低限度的，只需要对代码做一点小小的调整。我们将GridSearchCV调用中的n_jobs参数设置为-2，以便使用除1个内核之外的所有内核。剩下的1个核心是为其他计算机进程留出回旋的空间，这通常是一种好的做法。</p><p id="98c8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们的代码行应该如下所示:</p><pre class="km kn ko kp gt nh ni nj nk aw nl bi"><span id="6876" class="nm ld iq ni b gy nn no l np nq">GridSearchCV(estimator=model, param_grid=params, cv=10, n_jobs=-2)</span></pre><p id="2a4d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们在之前实验使用的同一台笔记本电脑上运行，该单元在7分34秒内完成。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ng"><img src="../Images/b317ac2d64ac31668cb1b9528ee1deae.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*mqG_B_gnw3Udoz8Evhmt5A.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">使用所有7个核心进行网格搜索</figcaption></figure><p id="4f7b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 2。利用更大的机器</strong></p><p id="6a83" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">第二个增强是非侵入性的，不需要修改代码。相反，由于网格搜索现在能够在给定的尽可能多的内核上并行运行，我们在一台拥有120个内核的更大的机器上运行了它。</p><p id="462c" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">正如预期的那样，该单元使用了119个内核，并在27秒内完成—比第一次运行时提高了60倍！</p><blockquote class="nr ns nt"><p id="aaf4" class="jn jo nu jp b jq jr js jt ju jv jw jx nv jz ka kb nw kd ke kf nx kh ki kj kk ij bi translated">🏎27秒后</p></blockquote></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="c81d" class="lc ld iq bd le lf na lh li lj nb ll lm ln nc lp lq lr nd lt lu lv ne lx ly lz bi translated">关键要点</h1><p id="5522" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">那么，在前进的道路上，我们应该记住什么？</p><ul class=""><li id="e514" class="mf mg iq jp b jq jr ju jv jy mh kc mi kg mj kk mk ml mm mn bi translated">网格搜索是非常并行的任务(因为没有一个训练实验是相互依赖的)，但是一开始我们没有利用这个属性。单核处理是某些软件包中的默认设置，因此请确保检查您笔记本电脑的资源利用率。</li><li id="e142" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">从1核到119核，性能一路提升。由于网格搜索的并行性，在其他网格搜索情况下，可以预期类似的缩放。然而，数据集的大小可能会产生影响(例如，如果您使用的是大型数据集，将会有更多的RAM开销)，并且可能会有一个收益递减点(例如，300个内核可能会降低网格搜索的速度)。</li></ul></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="ce4f" class="lc ld iq bd le lf na lh li lj nb ll lm ln nc lp lq lr nd lt lu lv ne lx ly lz bi translated">解决方案选项</h1><p id="32bc" class="pw-post-body-paragraph jn jo iq jp b jq ma js jt ju mb jw jx jy mc ka kb kc md ke kf kg me ki kj kk ij bi translated">最后，完成本文中的目标需要什么工具或资源？</p><p id="ee5b" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">要获得与上面类似的结果，您需要一台拥有120个CPU内核的机器。除非你或你的公司有一个现成的，否则你的选择可能是:</p><ul class=""><li id="cd65" class="mf mg iq jp b jq jr ju jv jy mh kc mi kg mj kk mk ml mm mn bi translated">自己调配一个云实例。</li><li id="3e7f" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">请DevOps或IT部门调配云实例。</li><li id="b1e3" class="mf mg iq jp b jq mo ju mp jy mq kc mr kg ms kk mk ml mm mn bi translated">使用提供云实例的ML服务。确保您正在评估的服务可以访问您需要的实例类型。</li></ul><p id="ea05" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">快乐实验🧪</p></div></div>    
</body>
</html>