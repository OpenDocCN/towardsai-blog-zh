<html>
<head>
<title>Learning Rate Scheduling for Deep Learning using Tensorflow 2</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Tensorflow 2进行深度学习的学习率调度</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/learning-rate-scheduling-for-deep-learning-using-tensorflow-2-fb2f14cc955?source=collection_archive---------2-----------------------#2021-07-27">https://pub.towardsai.net/learning-rate-scheduling-for-deep-learning-using-tensorflow-2-fb2f14cc955?source=collection_archive---------2-----------------------#2021-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="bddc" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning/deep-learning" rel="noopener ugc nofollow" target="_blank">深度学习</a></h2><div class=""/><p id="2d5c" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">这是什么？为什么要用？以及如何在Tensorflow 2中创建您的自定义学习率计划程序</p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi kx"><img src="../Images/e3b16e4fb89694a6720130505a7939e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cj1PuiUWz0zMPcSW9je9ug.png"/></div></div></figure><p id="861a" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">学习率计划就是在神经网络训练期间改变学习率的过程。</p><p id="dba8" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">一些出版物显示，通过在训练期间改变学习率，可以更快地接近全局最小值。此外，你的训练过程将避免陷入局部最小值或鞍点。</p><p id="c4f5" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">一些研究人员强调了在训练过程中改变学习速度的必要性。这就是为什么我们发现关于自适应学习率(或学习率调度)的不同方法的出版物，如[1]和[2]。</p><p id="91ca" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">这些学习率调度技术中的许多已经在Tensorflow 2中实现。例如，我们可以找到指数衰减、InverseTimeDecay和PiecewiseConstantDecay。</p><p id="0f5c" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">在训练过程中，这些学习率计划都遵循一定的行为。Tensorflow 2中已经实现了这些类型的计划。要使用它们，您所要做的就是作为优化器的一部分调用它们。下面是TF2文档中的一个例子:</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="994d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">您可以对InverseTimeDecay和PeicewiseConstantDecay做同样的事情。</p><p id="4c91" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">但是如果你想定义你自己的学习进度呢？你如何在Tensorflow 2中实现它？</p><p id="d713" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">事实上，有两种方法可以做到这一点(据我所知)。第一种方法是通过创建一个函数来定义你的学习率计划，然后将它作为回调的一部分传递给<strong class="kb jd"> <em class="ll"> fit </em> </strong>方法。</p><p id="c649" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">第二种方法是创建一个从<code class="fe lm ln lo lp b">tf.keras.optimizers.schedules.LearningRateSchedule</code>继承的类，然后覆盖这个类的一些方法。然后，您可以使用您的类，就像我上面提到的预先实现的调度程序一样。</p><p id="eae0" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">让我们看看如何使用这两种方法。</p><h2 id="ad85" class="lq lr it bd ls lt lu dn lv lw lx dp ly kk lz ma mb ko mc md me ks mf mg mh iz bi translated">使用回调的学习率调度</h2><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="7c8d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">如您所见，将您的学习率计划定义为回调非常简单。但是这种方法有一个缺点。您只能在纪元结束时更新学习率。此外，据我所知，您只能向调度函数传递2个参数。如果你想在某个时期结束前更新你的学习率，该怎么办？也许你想每半个纪元更新一次你的学习速度。你如何实现这一点？</p><p id="8c49" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">这就是第二种方法的用武之地。将调度器定义为从<code class="fe lm ln lo lp b">tf.keras.optimizers.schedules.LearningRateSchedule</code>继承的类</p><h2 id="790f" class="lq lr it bd ls lt lu dn lv lw lx dp ly kk lz ma mb ko mc md me ks mf mg mh iz bi translated">一种更通用的学习速率调度方法</h2><p id="93f5" class="pw-post-body-paragraph jz ka it kb b kc mi ke kf kg mj ki kj kk mk km kn ko ml kq kr ks mm ku kv kw im bi translated">下面是我在论文[1]中描述的实现循环学习率调度器的尝试。虽然看起来这里有很多细节，但事实上很简单。</p><figure class="ky kz la lb gt lc"><div class="bz fp l di"><div class="lj lk l"/></div></figure><p id="3c20" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">类<code class="fe lm ln lo lp b">tf.keras.optimizers.schedules.LearningRateSchedule</code>有一些你需要覆盖的方法。<strong class="kb jd">总</strong>。这些方法分别是<strong class="kb jd"> <em class="ll"> __call__ </em> </strong>和<strong class="kb jd"> <em class="ll"> get_config </em> </strong>。<strong class="kb jd"> <em class="ll"> __call__ </em> </strong>方法在每一步都被调用，这就是为什么它把步骤作为参数。所以在每一步之后，你可以更新你的学习速度，不像之前的方法使用回调。</p><p id="1f86" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">对于<strong class="kb jd"> <em class="ll"> get_config </em> </strong>方法，它只是返回您选择的值的字典。但是这里值得一提的是，你的字典中的值需要是字符串。如果按原样返回值(<strong class="kb jd"><em class="ll">float</em></strong>)，那么Tensorflow将引发异常，因为<strong class="kb jd"> <em class="ll"> float </em> </strong>值是非JSON可序列化的。将浮点值转换成字符串是我的变通方法，如果失败了，不要责怪Tensorflow，而是责怪我:D</p><p id="48ef" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">什么时候你用一种方法而不用另一种方法？</p><p id="7642" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">简单。</p><p id="4505" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">如果你正在为你的学习率计划做快速实验，并且你只需要在每个时期结束时更新你的学习率，那么使用回调方法。</p><p id="7acf" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">另一方面，如果你正在实现一个学习率调度器，需要在纪元结束前更新，那么使用第二种方法。</p><p id="ac47" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">对于我上面定义的循环学习率，您可以使用回调方法来实现它。但是我使用了<code class="fe lm ln lo lp b">LearningRateSchedule</code>方法来实现它，所以我可以向您展示这种技术的演示。</p><p id="888b" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><em class="ll">如果你觉得这篇文章有用，就关注我的</em> <a class="ae mn" href="https://nourislam.medium.com/" rel="noopener"> <em class="ll">中</em> </a> <em class="ll">！</em></p><p id="205d" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><em class="ll">如果你喜欢每日了解ML，那就关注我</em><a class="ae mn" href="https://www.linkedin.com/in/nour-islam-mokhtari-07b521a5/" rel="noopener ugc nofollow" target="_blank"><em class="ll">LinkedIn</em></a><em class="ll">。我几乎每天都在那里贴机器学习的比特！</em></p><p id="1eda" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><em class="ll">如果你喜欢更结构化的学习材料，那么我邀请你加入“</em> <a class="ae mn" href="https://www.aifee.co/p/the-complete-deep-learning-for-computer-vision-bootcamp" rel="noopener ugc nofollow" target="_blank"> <strong class="kb jd"> <em class="ll">计算机视觉完整深度学习训练营</em> </strong> </a> <em class="ll">”在这里你将了解:图像识别、物体检测、图像分割，以及如何在本地和谷歌云人工智能平台上训练你的模型。您将</em> <strong class="kb jd"> <em class="ll">构建3个现实生活中的AI项目</em> </strong> <em class="ll">！</em></p><h1 id="5884" class="mo lr it bd ls mp mq mr lv ms mt mu ly mv mw mx mb my mz na me nb nc nd mh ne bi translated">参考</h1><p id="0646" class="pw-post-body-paragraph jz ka it kb b kc mi ke kf kg mj ki kj kk mk km kn ko ml kq kr ks mm ku kv kw im bi translated">[1]<a class="ae mn" href="https://arxiv.org/abs/1506.01186" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/abs/1506.01186</a></p><p id="7977" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">[2]<a class="ae mn" href="https://arxiv.org/pdf/1412.7419.pdf" rel="noopener ugc nofollow" target="_blank">https://arxiv.org/pdf/1412.7419.pdf</a></p><figure class="ky kz la lb gt lc gh gi paragraph-image"><div role="button" tabindex="0" class="ld le di lf bf lg"><div class="gh gi nf"><img src="../Images/19ef6d22c9f52b6848a7b0461beee61a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*44NKMZcpU3kvPBxe.png"/></div></div><figcaption class="ng nh gj gh gi ni nj bd b be z dk translated">作者制作的图像</figcaption></figure><p id="7e98" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">我是一名机器学习工程师，致力于解决具有挑战性的计算机视觉问题。我想帮助你学习应用于计算机视觉问题的机器学习。以下是方法。</p><ol class=""><li id="fabd" class="nk nl it kb b kc kd kg kh kk nm ko nn ks no kw np nq nr ns bi translated">通过帮助您了解该领域的最新动态。我几乎每天都在<a class="ae mn" href="https://www.linkedin.com/in/nour-islam-mokhtari-07b521a5/" rel="noopener ugc nofollow" target="_blank"><strong class="kb jd">【LinkedIn】</strong></a>和<a class="ae mn" href="https://twitter.com/NourIslamMo" rel="noopener ugc nofollow" target="_blank"><strong class="kb jd">Twitter</strong></a><strong class="kb jd"/>上分享小型博客帖子。所以跟我去吧！</li><li id="8c81" class="nk nl it kb b kc nt kg nu kk nv ko nw ks nx kw np nq nr ns bi translated">每周给你一份我的<a class="ae mn" href="https://nourislam.ck.page/dc3e8b7e12" rel="noopener ugc nofollow" target="_blank"> <strong class="kb jd">时事通讯</strong> </a>上那些小帖子的摘要。所以订阅吧！</li><li id="369b" class="nk nl it kb b kc nt kg nu kk nv ko nw ks nx kw np nq nr ns bi translated">通过在Medium上写关于机器学习不同主题的文章。所以跟我来吧！</li><li id="9563" class="nk nl it kb b kc nt kg nu kk nv ko nw ks nx kw np nq nr ns bi translated">给你一份免费的机器学习工作清单，帮助你检查你需要学习的所有要点，如果你计划在ML，特别是在计算机视觉方面的职业生涯。你可以在这里 获得核对表<a class="ae mn" href="https://www.aifee.co/free-resources" rel="noopener ugc nofollow" target="_blank"> <strong class="kb jd">。</strong></a></li></ol><p id="d785" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">5.最后但同样重要的是，通过与你分享我的<a class="ae mn" href="https://aifee.teachable.com/p/introduction-to-tensorflow-2-for-computer-vision" rel="noopener ugc nofollow" target="_blank"> <strong class="kb jd">免费入门张量流课程</strong> </a>，它有超过<strong class="kb jd"> <em class="ll"> 4小时</em>的视频内容</strong>，你可以在那里问我任何问题。</p><p id="28dc" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">此外，如果您有任何问题或者您只是想聊聊ML，请随时在LinkedIn或Twitter上联系我！</p></div></div>    
</body>
</html>