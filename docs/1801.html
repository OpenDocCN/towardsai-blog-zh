<html>
<head>
<title>Data Versioning for Efficient Workflows with MLFlow and LakeFS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用MLFlow和LakeFS实现高效工作流的数据版本控制</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/data-versioning-for-efficient-workflows-with-mlflow-and-lakefs-892df1f8e7d8?source=collection_archive---------1-----------------------#2021-04-29">https://pub.towardsai.net/data-versioning-for-efficient-workflows-with-mlflow-and-lakefs-892df1f8e7d8?source=collection_archive---------1-----------------------#2021-04-29</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="6efc" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a>，<a class="ae ep" href="https://towardsai.net/p/category/software-engineering" rel="noopener ugc nofollow" target="_blank">软件工程</a></h2><div class=""/><div class=""><h2 id="f142" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">构建弹性、原子和版本化的数据湖操作</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/821a565bca001193a495f59ca6aff2a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z01oHkvKDaxDAH53"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">照片由<a class="ae li" href="https://unsplash.com/@egla" rel="noopener ugc nofollow" target="_blank">汉尼斯·艾格勒</a>在<a class="ae li" href="https://unsplash.com/photos/nT4k2JDtwTQ" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><h2 id="a918" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">介绍</h2><p id="25a4" class="pw-post-body-paragraph me mf iu mg b mh mi ke mj mk ml kh mm ls mn mo mp lw mq mr ms ma mt mu mv mw in bi translated">版本控制系统，比如Git，是对源代码进行版本控制和归档的重要工具。版本控制帮助您跟踪代码中的更改。当进行更改时，也可能引入错误，但是使用源代码控制工具，开发人员可以回滚到工作状态，并将其与非工作代码进行比较。这最大限度地减少了对可能正在处理代码的其他团队成员的干扰，并帮助他们有效地协作。</p><blockquote class="mx"><p id="519b" class="my mz iu bd na nb nc nd ne nf ng mw dk translated">除了代码，数据也会改变。</p></blockquote><p id="cb24" class="pw-post-body-paragraph me mf iu mg b mh nh ke mj mk ni kh mm ls nj mo mp lw nk mr ms ma nl mu mv mw in bi translated">通常，数据科学家需要访问一系列数据集来完成特定任务。从特征工程到模型训练或选择和超参数优化，数据也会得到处理和改变。除此之外，实验和结果观察也是数据科学家日常工作中的一项普遍任务，这意味着他们需要来回切换特定的数据格式或版本。可以想象，这使得整个过程既耗时又容易出错。</p><p id="4b25" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">在本文中，我们将探索<strong class="mg je"><em class="nr">lakeFS</em></strong>——一个帮助团队<strong class="mg je">像管理代码</strong>一样管理数据的强大工具。我们将讨论它如何处理数据版本，以及它如何潜在地帮助数据团队构建更高效的工作流，并且更不容易出错。此外，我们将看到它如何与<code class="fe ns nt nu nv b"><a class="ae li" href="https://mlflow.org" rel="noopener ugc nofollow" target="_blank">mlflow</a></code>一起使用，以建立一个工作流，对数据和经过训练的机器学习模型进行版本化。</p></div><div class="ab cl nw nx hy ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="in io ip iq ir"><h2 id="1557" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">什么是lakeFS</h2><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj od"><img src="../Images/378aed7b1df01c9fb20d61b59321ab81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zIcFP7R2x01IV3H-17KgRQ.png"/></div></div></figure><p id="5929" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">LakeFS是一个开源平台，提供了一个类似Git的模型来帮助团队版本化和管理数据。从复杂的ETL任务到数据科学和分析，LakeFS为您的数据湖提供了弹性、原子性和可管理性。它可以与所有现代数据框架无缝协作，如Apache Kafka、Apache Spark等。同时，它还支持最广泛使用的云存储，如AWS S3、谷歌云存储和Azure Blob存储。</p><p id="bccb" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">使用lakeFS，您可以为数据创建一个<strong class="mg je">开发环境</strong>,就像您为源代码所做的一样。这样的环境将帮助您在不会影响您的生产环境的<a class="ae li" href="https://lakefs.io/data-lakes/" rel="noopener ugc nofollow" target="_blank">数据湖</a>的隔离快照中试验工具和代码更改。得益于其分支和提交模型，lakeFS为您提供了在任何时候回滚到数据湖本身的特定版本所需的所有工具。</p><p id="e86f" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">此外，该平台允许您通过实施模式兼容性、格式实施和命名约定等最佳实践的机制来构建防弹的<strong class="mg je">连续数据集成和部署</strong>工作流。您甚至可以配置您的工作流，将数据接收到非生产分支，以便防止重大更改进入您的生产环境，从而最大限度地减少中断。</p><p id="4aa6" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">在本文接下来的部分中，我们将探讨如何在数据版本化的上下文中使用lakeFS。我们将展示如何在一瞬间启动并运行它，并使用它来构建易于管理且高效的数据工作流。</p></div><div class="ab cl nw nx hy ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="in io ip iq ir"><h2 id="c21f" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">LakeFS入门</h2><p id="7f79" class="pw-post-body-paragraph me mf iu mg b mh mi ke mj mk ml kh mm ls mn mo mp lw mq mr ms ma mt mu mv mw in bi translated">首先，让我们从使用Docker Compose运行lakeFS的本地实例开始。如果您的机器上没有安装Docker和Docker Compose，请确保按照Docker文档中的<a class="ae li" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">官方指南进行安装。确保合成版本为1.25.04或更高版本也很重要。</a></p><p id="6bd7" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">一旦您确认Docker已经成功安装在您的机器上，您就可以打开您的终端并运行下面的命令来启动lakeFS实例。</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="42ce" class="lj lk iu nv b gz oi oj l ok ol">curl https://compose.lakefs.io | docker-compose -f - up</span></pre><p id="a6c8" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">如果一切按计划进行，您现在应该会看到类似于下面所示的输出。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj om"><img src="../Images/d9f1cd86e2ae527368d15e59d21c6b51.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YwEMdhRsBrefs1AZsr1Rsw.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">跑步湖</figcaption></figure><p id="02d9" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">现在，让我们通过在您首选的web浏览器中打开<a class="ae li" href="http://127.0.0.1:8000/setup" rel="noopener ugc nofollow" target="_blank">http://127 . 0 . 0 . 1:8000/setup</a>来检查我们的安装。如果安装成功，您应该能够看到初始设置页面，要求您输入管理员用户名。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj on"><img src="../Images/8fe136c553ceb09eff758f7deaf33127.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HeM9fntTXxwVNInJYcTm7w.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">LakeFS初始设置页面</figcaption></figure><p id="3a6c" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">添加您的首选用户名，然后单击设置。在下一页，您将获得身份验证凭据—访问密钥ID和秘密访问密钥。请确保将它们安全地存放在某个地方，因为一路上你会用到它们。现在转到登录屏幕，使用上一步生成的凭证登录。如果凭据正确，通常会显示以下屏幕:</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj oo"><img src="../Images/ef0fa31eb5ace4b76bfe26fa33af512b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*d53oP6EfiR-0HQiUHU009w.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">LakeFS主页</figcaption></figure><p id="d8c7" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">在此页面上，您将能够看到您的数据存储库和访问管理实用程序(如访问控制),并与之进行交互。</p></div><div class="ab cl nw nx hy ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="in io ip iq ir"><p id="a3a8" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated"><code class="fe ns nt nu nv b">lakeFS</code>还自带名为<code class="fe ns nt nu nv b"><strong class="mg je">lakectl</strong></code>的原生命令行界面(CLI)。CLI可用于Linux、OSX和Windows，并作为一个没有外部依赖性的二进制文件分发。</p><p id="1a45" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">为了下载并安装<code class="fe ns nt nu nv b">lakectl</code>,只需遵循以下步骤:</p><ol class=""><li id="594d" class="op oq iu mg b mh nm mk nn ls or lw os ma ot mw ou ov ow ox bi translated">访问 <code class="fe ns nt nu nv b"><a class="ae li" href="https://docs.lakefs.io/downloads.html" rel="noopener ugc nofollow" target="_blank">lakeFS</a></code> <a class="ae li" href="https://docs.lakefs.io/downloads.html" rel="noopener ugc nofollow" target="_blank">文档</a>中的<a class="ae li" href="https://docs.lakefs.io/downloads.html" rel="noopener ugc nofollow" target="_blank">下载部分</a></li><li id="ab45" class="op oq iu mg b mh oy mk oz ls pa lw pb ma pc mw ou ov ow ox bi translated">点击“二进制版本”</li><li id="e104" class="op oq iu mg b mh oy mk oz ls pa lw pb ma pc mw ou ov ow ox bi translated">上一步将引导您到lakeFS GitHub存储库上的发布——向下滚动到“Assets”部分</li></ol><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pd"><img src="../Images/be942cea2b6a1dc0f595dfdea509ba15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h-UaGRgx1UqEH07TvcHDwQ.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">GitHub上的LakeFS二进制文件</figcaption></figure><p id="9f04" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">4.点击下载符合您机器规格的<code class="fe ns nt nu nv b">.tar.gz</code>文件</p><p id="a2a9" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">5.现在提取下载的<code class="fe ns nt nu nv b">tar.gz</code>的内容。举个例子，</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="8d4e" class="lj lk iu nv b gz oi oj l ok ol">tar -xzvf lakeFS_0.40.0_Darwin_x86_64.tar.gz</span></pre><p id="43ef" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">上面的命令应该提取3个文件:<code class="fe ns nt nu nv b">README.md</code>、<code class="fe ns nt nu nv b">lakefs</code>和<code class="fe ns nt nu nv b">lakectl</code>。</p><p id="9f13" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">6.将<code class="fe ns nt nu nv b">lakectl</code>移到<code class="fe ns nt nu nv b">PATH</code>中—这取决于操作系统，对于*nix系统，这通常是<code class="fe ns nt nu nv b">/usr/local/bin</code>:</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="692b" class="lj lk iu nv b gz oi oj l ok ol">mv lakectl /usr/local/bin</span></pre><p id="fa12" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">您可以通过运行help命令来确保一切正常。</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="3ba1" class="lj lk iu nv b gz oi oj l ok ol">$ lakectl -h </span></pre><p id="7210" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">如果一切按计划进行，您现在应该能够检查上述命令的输出，并了解如何使用<code class="fe ns nt nu nv b">lakeFS</code> CLI。</p><p id="da16" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated"><strong class="mg je">OSX注意:</strong>如果由于任何原因操作系统不允许你运行<code class="fe ns nt nu nv b">lakectl</code>因为开发者不被认可，你可能需要运行<code class="fe ns nt nu nv b">sudo spctl --master-disable</code>。</p><p id="4ea9" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">7.一旦您确认安装了<code class="fe ns nt nu nv b">lakectl</code>，现在您需要配置CLI以使用您之前创建的凭证。为此，只需运行</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="1ca5" class="lj lk iu nv b gz oi oj l ok ol">$ lakectl config</span></pre><p id="9975" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">并填写访问密钥ID、秘密访问密钥和服务器端点URL。</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="8ae8" class="lj lk iu nv b gz oi oj l ok ol">192:lakefs-demo gmyrianthous$ lakectl config<br/>Config file /Users/gmyrianthous/.lakectl.yaml will be used<br/>Access key ID: AKIAJKTJORSSALEG7RQQ<br/>Secret access key: **************************<br/>Server endpoint URL: http://127.0.0.1:8000</span></pre><p id="2dc6" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">最后，让我们通过运行一个示例命令来验证配置:</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="21e1" class="lj lk iu nv b gz oi oj l ok ol">$ lakectl branch list lakefs://example<br/>+--------+-----------+<br/>| BRANCH | COMMIT ID |<br/>+--------+-----------+<br/>+--------+-----------+</span></pre><p id="dceb" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">如果您在输出中看不到分支，请不要担心——这是我们所期望的，因为我们还没有创建任何分支。</p></div><div class="ab cl nw nx hy ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="in io ip iq ir"><h2 id="bdd6" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">使用LakeFS进行数据版本控制</h2><p id="d99e" class="pw-post-body-paragraph me mf iu mg b mh mi ke mj mk ml kh mm ls mn mo mp lw mq mr ms ma mt mu mv mw in bi translated">现在我们已经启动并运行了LakeFS，还安装了它的本机CLI，是时候演示如何使用它来版本化特定的数据集了。</p><p id="e6a6" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">显然，我们首先需要创建一个存储库，在那里我们将能够存储和版本化我们的数据。为此，只需返回到<code class="fe ns nt nu nv b">lakeFS</code>用户界面，点击“存储库”选项卡，然后点击“创建存储库”。您可以为您的存储库id选择一个任意的名称，但是如果您在本地机器上运行lakeFS，请确保使用普通的<code class="fe ns nt nu nv b">local://</code>存储名称空间。最后点击“创建存储库”。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pe"><img src="../Images/febcdc7490ee2d7b405828a2904f6548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ch-zk5832bionRszBKpwvQ.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">创建我们的第一个LakeFS存储库</figcaption></figure><p id="a7be" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">现在，您应该会被重定向到新创建的存储库。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pf"><img src="../Images/94dba9886d1206ab1bec4b0ace9572ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Mwr8baeu1Q8JA5Mft7UxBQ.png"/></div></div></figure><p id="3748" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">现在我们已经创建了我们的存储库，是时候进行我们的第一次提交了。出于演示的目的，我计划使用<a class="ae li" href="https://archive.ics.uci.edu/ml/datasets/iris" rel="noopener ugc nofollow" target="_blank"> UCI虹膜数据集</a>。让我们回到终端，将初始数据集上传到我们新创建的存储库的主分支。为此，我们需要做的就是运行<code class="fe ns nt nu nv b"><a class="ae li" href="https://docs.lakefs.io/reference/commands.html#lakectl-fs-upload" rel="noopener ugc nofollow" target="_blank">lakectl fs upload</a></code>命令:</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="7750" class="lj lk iu nv b gz oi oj l ok ol">lakectl fs upload -s iris.data lakefs://lakefs-demo/master/iris.data</span></pre><p id="324e" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">答案应该是:</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="e9ca" class="lj lk iu nv b gz oi oj l ok ol">Path: iris.data<br/>Modified Time: 2021-04-20 18:40:23 +0100 BST<br/>Size: 3151 bytes<br/>Human Size: 3.2 kB<br/>Physical Address: local://daad0433311a48d3a02c87bd4fcbbe44<br/>Checksum: 749c76812c8c96999282e757b344d473</span></pre><p id="c73d" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">最后，让我们提交刚才所做的更改。如果您想观察将要提交的更改，只需运行<code class="fe ns nt nu nv b">lakectl diff repo-uri</code>:</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="f22d" class="lj lk iu nv b gz oi oj l ok ol">$ lakectl diff lakefs://lakefs-demo/master</span><span id="fc92" class="lj lk iu nv b gz pg oj l ok ol">Ref: lakefs://lakefs-demo/master<br/>+ added iris.data</span></pre><p id="7b4e" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">现在，您可以使用</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="874c" class="lj lk iu nv b gz oi oj l ok ol">$ lakectl commit lakefs://lakefs-demo/master \<br/>  --message "Initial dataset"</span></pre><p id="940b" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">这通常会返回一个成功的响应，如下所示:</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="adcb" class="lj lk iu nv b gz oi oj l ok ol">Branch: lakefs://lakefs-demo/master<br/>Commit for branch "master" completed.<br/>ID: de34534cde4cfed0b333dfd977da551de6c0b97cfacb6e35a7833baa4e22c6b6<br/>Message: Initial dataset<br/>Timestamp: 2021-04-21 09:55:32 +0100 BST<br/>Parents: c7b2e167d9c807e5f4d1995de4a659ff40f8994926aad675fe967a19ef0</span></pre><p id="d545" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">现在，您可以通过用户界面验证初始数据是否已添加到我们的主分支中。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ph"><img src="../Images/6b772ef5eba07718a0e816d083432c95.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*j5S-Mg8lQVwDAO8ZPb_2Pg.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">lakefs仓库主分支中的数据文件</figcaption></figure></div><div class="ab cl nw nx hy ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="in io ip iq ir"><p id="ae4f" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">既然我们已经将初始数据集添加到了我们的<code class="fe ns nt nu nv b">lakeFS</code>存储库的主分支中，那么是时候展示如何创建其他特性或开发分支，并独立地处理它们了。</p><p id="3c8a" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">为此，我们需要运行命令<code class="fe ns nt nu nv b">lakectl branch create</code>并提供新的目标分支和源分支。我们将调用新分支<code class="fe ns nt nu nv b">feature-branch</code>并从<code class="fe ns nt nu nv b">master</code>分支中创建它。</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="cfee" class="lj lk iu nv b gz oi oj l ok ol">lakectl branch create lakefs://lakefs-demo/feature-branch --source lakefs://lakefs-demo/master</span></pre><p id="1a27" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">现在，新的分支也应该在用户界面上可见，如下所示。请注意，您也可以直接从UI创建分支。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pi"><img src="../Images/5a8953fc6555b708e6f14da536d27d47.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*B2YWIcXkuPDZ2eJjPb8sDQ.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">LakeFS存储库中的分支列表</figcaption></figure><p id="2a24" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">为了这个例子，我们将应用一个非常基本的变换。下面提供的代码片段只是将数据集的第一列乘以标量<code class="fe ns nt nu nv b">-1</code>:</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="pj pk l"/></div></figure><p id="a253" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">既然已经修改了<code class="fe ns nt nu nv b">iris.data</code>文件，我们可以将更新后的文件上传到我们在上一步中创建的分支中，名为<code class="fe ns nt nu nv b">feature-branch</code>:</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="c4bc" class="lj lk iu nv b gz oi oj l ok ol">lakectl fs upload -s iris.data lakefs://lakefs-demo/feature-branch/iris.data</span><span id="c1c1" class="lj lk iu nv b gz pg oj l ok ol">Path: iris.data<br/>Modified Time: 2021-04-21 14:24:14 +0100 BST<br/>Size: 3250 bytes<br/>Human Size: 3.2 kB<br/>Physical Address: local://fed67112d77f483798f441307c05ab36<br/>Checksum: ca0adaa9d6b38a9901442a0432f4c8eb</span></pre><p id="22ee" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">最后，我们提交变更:</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="ab71" class="lj lk iu nv b gz oi oj l ok ol">$ lakectl commit lakefs://lakefs-demo/feature-branch --message "Transformed the first column"</span><span id="d1a1" class="lj lk iu nv b gz pg oj l ok ol">Branch: lakefs://lakefs-demo/feature-branch<br/>Commit for branch "feature-branch" completed.<br/>ID: b9879d3219c4e39ac08613ed94d234cd86478af133464c76ae8e8de7b8f46770<br/>Message: Transformed the first column<br/>Timestamp: 2021-04-21 14:26:54 +0100 BST<br/>Parents: de34534cde4cfed0b333dfd977da551de6c0b97cfacb6e35a7833baa4e2</span></pre><p id="eba2" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">我们还可以使用<code class="fe ns nt nu nv b">lakectl diff</code>命令来观察<code class="fe ns nt nu nv b">master</code>和<code class="fe ns nt nu nv b">feature-branch</code>分支之间的区别。</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="4087" class="lj lk iu nv b gz oi oj l ok ol">lakectl diff lakefs://lakefs-demo/feature-branch lakefs://lakefs-demo/master</span><span id="bcbc" class="lj lk iu nv b gz pg oj l ok ol">Left ref: lakefs://lakefs-demo/feature-branch<br/>Right ref: lakefs://lakefs-demo/master<br/>~ modified iris.data</span></pre><p id="51bb" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">最后，一旦我们对这些变化感到满意，我们就可以将<code class="fe ns nt nu nv b">feature-branch</code>合并成<code class="fe ns nt nu nv b">master</code>:</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="1ae1" class="lj lk iu nv b gz oi oj l ok ol">lakectl merge lakefs://lakefs-demo/feature-branch  lakefs://lakefs-demo/master</span><span id="48e4" class="lj lk iu nv b gz pg oj l ok ol">Source: lakefs://lakefs-demo/feature-branch<br/>Destination: lakefs://lakefs-demo/master<br/>Merged "feature-branch" into "master" to get "5cde9f05823aaf3b0481011e4a143477cf767df7f2ac87ecf164b1a2d593f485".<br/>Added: 0<br/>Changed: 1<br/>Removed: 0</span></pre><p id="0f74" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">更改现在在<code class="fe ns nt nu nv b">master</code>分支上，提交也应该在<code class="fe ns nt nu nv b">lakeFS</code>用户界面的“提交”选项卡下可见。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pl"><img src="../Images/710fab68dc6bed7d7ccba141eadbe96b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Torin1S26JW49WUtdgmsKw.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">将特征分支合并到主分支</figcaption></figure></div><div class="ab cl nw nx hy ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="in io ip iq ir"><p id="9ad4" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">在这个快速演示中，我们展示了如何使用<code class="fe ns nt nu nv b">lakeFS</code>来管理和版本化数据，就像处理源代码一样。您可以创建开发环境，在这里您可以围绕数据本身构建工具和转换，并最终将转换后的数据合并回主分支。</p><p id="1fa4" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">如果出现任何问题，您可以使用<code class="fe ns nt nu nv b">lakectl</code> CLI或<code class="fe ns nt nu nv b">lakeFS</code> UI来观察各个分支之间的差异。此外，如果需要，该平台允许您回滚到以前的版本。</p></div><div class="ab cl nw nx hy ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="in io ip iq ir"><h2 id="0efd" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">使用LakeFS和MLFlow进行模型和数据版本控制</h2><p id="62ab" class="pw-post-body-paragraph me mf iu mg b mh mi ke mj mk ml kh mm ls mn mo mp lw mq mr ms ma mt mu mv mw in bi translated">尽管lakeFS可以单独使用，但它也可以与其他广泛使用的MLOps工具结合使用，以帮助数据团队设计高效的工作流并完成特定任务。</p><p id="1946" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">数据科学家通常希望试验各种模型和功能。这意味着他们最终可能会得到一个不同数据集和模型的池，然后对其进行进一步分析。因此，需要将模型和用于训练它们的数据集绑定在一起。</p><p id="6aee" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">为此，我们可以将<code class="fe ns nt nu nv b">lakeFS</code>和<code class="fe ns nt nu nv b">mlflow</code>结合起来负责数据版本控制，而后者将负责模型训练。</p><p id="26b7" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">MLFlow附带了一个名为<strong class="mg je">模型注册中心</strong>的组件，它是一个集中的存储库，用于存储丰富了API和用户界面的模型。它可以用于模型版本化和阶段转换(例如，当将模型从开发环境带到生产环境时)。</p><p id="3f4a" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">通常，我们需要执行一些预处理步骤和特征工程，然后用训练数据集训练模型。在本文的剩余部分，我们可以探索如何使用<code class="fe ns nt nu nv b">lakeFS</code>和<code class="fe ns nt nu nv b">mlflow</code>来准备数据集和训练模型，同时我们也对结果数据集和训练模型进行版本化。</p></div><div class="ab cl nw nx hy ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="in io ip iq ir"><p id="7a22" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">让我们假设，在第一轮中，我们对我们在前面几节中讨论的初始数据集执行一些预处理和转换步骤。我们现在可以使用<code class="fe ns nt nu nv b"><a class="ae li" href="https://docs.lakefs.io/using/python.html" rel="noopener ugc nofollow" target="_blank">lakeFS</a></code> <a class="ae li" href="https://docs.lakefs.io/using/python.html" rel="noopener ugc nofollow" target="_blank"> Python API客户端</a>来创建一个新的分支，并将我们创建的数据集提交给存储库。为此，我们首先需要使用<code class="fe ns nt nu nv b">pip</code>安装客户端:</p><pre class="kt ku kv kw gu oe nv of og aw oh bi"><span id="430e" class="lj lk iu nv b gz oi oj l ok ol">$ pip install 'lakefs_client==&lt;lakeFS version&gt;'</span></pre><p id="d5f7" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">并使用下面的代码片段创建一个新的分支，该分支将用于跨我们希望执行的实验对数据集进行版本控制。</p><p id="26f9" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">请注意，在下面的例子中，我们不会将df分成测试集和训练集，但是通常情况下，您需要这样做并将两个结果数据文件存储到存储库中。</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="pj pk l"/></div></figure><p id="c129" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">既然我们已经处理了数据集，现在我们可以继续进行模型训练和版本控制。为此，我们将使用<code class="fe ns nt nu nv b">mlflow</code>工作流API来记录模型并将其版本化到模型存储中:</p><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="pj pk l"/></div></figure><p id="8b65" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">使用<code class="fe ns nt nu nv b">mlflow.log_param</code>将<code class="fe ns nt nu nv b">lakefs</code>存储库名称记录到模型中是很重要的，这样您就可以在加载回模型时推断出这条信息。</p></div><div class="ab cl nw nx hy ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="in io ip iq ir"><p id="c6cb" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">在上面的例子中，我们已经看到了如何创建不同版本的建模数据集，这些数据集随后将用于训练模型。使用<code class="fe ns nt nu nv b">lakeFS</code>和<code class="fe ns nt nu nv b">mlflow</code>，我们可以将建模数据集和训练模型版本化，并将它们绑定在一起。这样，您可以很容易地推断出与特定模型版本相关联的数据集版本，反之亦然。您可以使用<code class="fe ns nt nu nv b">lakeFS</code>和<code class="fe ns nt nu nv b">mlflow</code>的其他组件，比如<a class="ae li" href="https://mlflow.org/docs/latest/tracking.html" rel="noopener ugc nofollow" target="_blank"> MLFlow Tracking </a>，它们有可能帮助您将代码与数据关联起来。</p><p id="21b4" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">虽然<strong class="mg je"> MLFlow </strong>可以帮助你管理机器学习生命周期，包括中央模型注册和部署，但<strong class="mg je"> lakeFS </strong>使你能够以类似Git的方式控制数据集。结合<code class="fe ns nt nu nv b">mlflow</code>和<code class="fe ns nt nu nv b">lakeFS</code>提供的工具，您可以创建高效、自动化的工作流程，促进实验并提高可重复性。</p></div><div class="ab cl nw nx hy ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="in io ip iq ir"><h2 id="f1d0" class="lj lk iu bd ll lm ln dn lo lp lq dp lr ls lt lu lv lw lx ly lz ma mb mc md ja bi translated">最后一句话</h2><p id="60a7" class="pw-post-body-paragraph me mf iu mg b mh mi ke mj mk ml kh mm ls mn mo mp lw mq mr ms ma mt mu mv mw in bi translated">数据版本化最近开始受到关注，因为它可以作为现代数据工作流中的一个关键组件。<strong class="mg je"> LakeFS </strong>是一个强大的平台，旨在为数据湖提供弹性和可管理性。在本文中，我们展示了如何安装和使用该平台及其本机CLI <code class="fe ns nt nu nv b">lakectl</code>。此外，我们探索了如何将<code class="fe ns nt nu nv b">lakeFS</code>与其他常用的MLOps工具(如<code class="fe ns nt nu nv b">mlflow</code>)一起使用，以执行特定的任务，如数据和模型版本控制。</p><p id="258b" class="pw-post-body-paragraph me mf iu mg b mh nm ke mj mk nn kh mm ls no mo mp lw np mr ms ma nq mu mv mw in bi translated">您可以在<a class="ae li" href="https://docs.lakefs.io/" rel="noopener ugc nofollow" target="_blank">官方文档</a>和<a class="ae li" href="https://github.com/treeverse/lakeFS" rel="noopener ugc nofollow" target="_blank"> GitHub资源库</a>中了解更多关于lakeFS及其功能的信息。</p></div></div>    
</body>
</html>