<html>
<head>
<title>Mastering Sentence Transformers For Sentence Similarity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">掌握句子相似性的句子转换工具</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/mastering-sentence-transformers-for-sentence-similarity-342beb562d45?source=collection_archive---------2-----------------------#2022-09-01">https://pub.towardsai.net/mastering-sentence-transformers-for-sentence-similarity-342beb562d45?source=collection_archive---------2-----------------------#2022-09-01</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6801" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">根据语义在Python中找到最相似的句子</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ki"><img src="../Images/9df7a67df6fc6631ef4be9718675c31f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/0*oR-LzrasUugQgahE.jpg"/></div><figcaption class="kq kr gj gh gi ks kt bd b be z dk translated">帕特里克·托马索在Unsplash<a class="ae ku" href="https://unsplash.com/s/photos/text?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">上的照片</a></figcaption></figure><p id="a025" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">句子转换器是一个Python框架，用于句子的最新矢量表示。有了空间中的句子，我们可以计算它们之间的距离，这样，我们可以根据它们的语义找到最相似的句子。</p><p id="6262" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">举个例子，假设我们有这两个句子:</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="fb0a" class="lw lx it ls b gy ly lz l ma mb">Coffee makes mornings better.</span><span id="a62b" class="lw lx it ls b gy mc lz l ma mb">Morning walks tend to start and end your day in a good mood.</span></pre><p id="83b7" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们想找出与下面这句话最相似的句子:</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="1d44" class="lw lx it ls b gy ly lz l ma mb">i like a nice cup of tea in the morning.</span></pre><p id="7a20" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">最接近的句子是“咖啡让早晨更美好。”因为他们都在谈论早上的饮料。即使他们不使用相同的单词，他们的矢量表示也会彼此接近。</p><h1 id="3a4f" class="md lx it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">余弦相似性</h1><p id="65d0" class="pw-post-body-paragraph kv kw it kx b ky mu ju la lb mv jx ld le mw lg lh li mx lk ll lm my lo lp lq im bi translated">为了获得两个句子向量的相似度，我们使用余弦相似度(1-余弦距离)。这是因为向量的方向在它们的语义中起着巨大的作用。例如，“咖啡”和“茶”的向量可能指向大致对应于“早晨饮料”的方向。现在，假设我们有向量a=[1，1，-1]，b=2a=[2，2，-2]。这两个向量大小不同，但方向相同。它们的余弦距离是0，但它们的欧几里德距离，不考虑方向，是4.58，在完全不同的方向上，很容易找到另一个距离更小的向量。</p><h1 id="bb6a" class="md lx it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最相似的歌词</h1><p id="25c3" class="pw-post-body-paragraph kv kw it kx b ky mu ju la lb mv jx ld le mw lg lh li mx lk ll lm my lo lp lq im bi translated">在本帖中，我们将使用Kaggle提供的<a class="ae ku" href="https://www.kaggle.com/datasets/deepshah16/song-lyrics-dataset?resource=download" rel="noopener ugc nofollow" target="_blank">歌曲歌词数据集</a>，给定文本输入，我们将找到歌词最相似的歌曲。</p><p id="140e" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">管道如下:</p><ol class=""><li id="13cd" class="mz na it kx b ky kz lb lc le nb li nc lm nd lq ne nf ng nh bi translated">获取数据集中每个歌词的嵌入</li><li id="424c" class="mz na it kx b ky ni lb nj le nk li nl lm nm lq ne nf ng nh bi translated">获取文本输入的嵌入</li><li id="9e8f" class="mz na it kx b ky ni lb nj le nk li nl lm nm lq ne nf ng nh bi translated">计算文本输入与每个歌词的余弦相似度</li><li id="be82" class="mz na it kx b ky ni lb nj le nk li nl lm nm lq ne nf ng nh bi translated">返回相似度最高的歌曲</li></ol><p id="796f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">首先，你需要安装句子转换器。</p><p id="64ab" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe nn no np ls b">pip install -U sentence-transformers</code></p><p id="05b2" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">然后，导入必要的库。</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="0656" class="lw lx it ls b gy ly lz l ma mb">import pandas as pd<br/>import numpy as np<br/>from scipy import spatial<br/>from sentence_transformers import SentenceTransformer<br/> <br/>model = SentenceTransformer('sentence-transformers/all-MiniLM-L6-v2')</span></pre><p id="e48d" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们使用的是“<strong class="kx iu"> all-MiniLM-L6-v2 </strong>”相关模型，但是您可以在<a class="ae ku" href="https://www.sbert.net/docs/pretrained_models.html" rel="noopener ugc nofollow" target="_blank"> SBERT模型页面</a>上找到更多的句子转换器。</p><p id="2fff" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">我们来读一读，看看数据。</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="8947" class="lw lx it ls b gy ly lz l ma mb">df.read_csv('lyrics.csv')<br/>df.head(3)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nq"><img src="../Images/cbc1f263bfe3c3092ba7c6af82ed0c32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*sA5OzyUK4w_jzOsG.png"/></div></div></figure><p id="ea00" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">现在，为了获得歌词的嵌入，我们使用了<strong class="kx iu"> model.encode </strong>函数。</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="92c2" class="lw lx it ls b gy ly lz l ma mb">df=df.assign(embeddings=df['Lyric'].apply(lambda x: model.encode(x)))<br/>df.head(3)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nq"><img src="../Images/06bf4a903ad723cedcde1c438fd006be.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pBt9n3dNR7FA47K4.png"/></div></div></figure><p id="9dca" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如您所见，我们得到了一个数据集，其中包含歌曲的属性以及歌词嵌入。</p><p id="065f" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">最后，我们创建了一个函数来获取输入的嵌入，然后计算余弦相似度，即1-余弦距离，然后返回具有最高余弦相似度的5首歌曲。</p><pre class="kj kk kl km gt lr ls lt lu aw lv bi"><span id="fc61" class="lw lx it ls b gy ly lz l ma mb">def closest_lyrics(inp):<br/>    data=df.copy()<br/>    inp_vector=model.encode(inp)<br/>    s=data['embeddings'].apply(lambda x: 1 - spatial.distance.cosine(x, inp_vector) )<br/>    data=data.assign(similarity=s)<br/>    return(data.sort_values('similarity',ascending=False).head(5))</span></pre><p id="e030" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">让我们来试试:</p><p id="eff3" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><code class="fe nn no np ls b">closest_lyrics('thinking about you')</code></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nq"><img src="../Images/cc21b7f1df924104680a53b424fc7cab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JmxOO6Bdzbs0XkXr.png"/></div></div></figure><p id="9164" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">如你所见，我们得到了与输入相关的歌曲。</p><h1 id="34d7" class="md lx it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">示例应用</h1><p id="1182" class="pw-post-body-paragraph kv kw it kx b ky mu ju la lb mv jx ld le mw lg lh li mx lk ll lm my lo lp lq im bi translated">举个例子，我创建了一个<a class="ae ku" href="https://billybonaros-perfume-recommendations-app-xxl8yy.streamlitapp.com/" rel="noopener ugc nofollow" target="_blank">香水推荐应用</a>，它根据风景、笔记或对香水的描述来推荐香水。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nq"><img src="../Images/f94fe3281d0a866da26362e6f95f8eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3jilkfWfIoqgOzk5.png"/></div></div></figure><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="nr ns di nt bf nu"><div class="gh gi nq"><img src="../Images/48175451976a98f57b371f4416df70e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5oCEzYshu-fMk6tt.png"/></div></div></figure><h1 id="18ae" class="md lx it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">总结一下</h1><p id="9f20" class="pw-post-body-paragraph kv kw it kx b ky mu ju la lb mv jx ld le mw lg lh li mx lk ll lm my lo lp lq im bi translated">在这篇文章中，我们讨论了如何使用句子转换器来表示空间中的句子，以及如何使用余弦相似度根据语义找到最相似的句子。</p><h1 id="8223" class="md lx it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">感谢您的阅读！</h1><ul class=""><li id="b21a" class="mz na it kx b ky mu lb mv le nv li nw lm nx lq ny nf ng nh bi translated">订阅我的<a class="ae ku" href="https://billybonaros.medium.com/subscribe" rel="noopener">简讯</a></li><li id="9d22" class="mz na it kx b ky ni lb nj le nk li nl lm nm lq ny nf ng nh bi translated">在Linkedin上关注我<a class="ae ku" href="https://www.linkedin.com/in/billybonaros/" rel="noopener ugc nofollow" target="_blank"/></li></ul><p id="b156" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated"><em class="nz">最初发表于</em><a class="ae ku" href="https://predictivehacks.com/mastering-sentence-transformers-for-sentence-similarity/" rel="noopener ugc nofollow" target="_blank"><em class="nz">https://predictivehacks.com。</em>T12】</a></p><p id="a6f1" class="pw-post-body-paragraph kv kw it kx b ky kz ju la lb lc jx ld le lf lg lh li lj lk ll lm ln lo lp lq im bi translated">参考文献:<br/> 1。歌词数据集|Kaggle，许可证:CC0公共领域。<a class="ae ku" href="https://www.kaggle.com/datasets/deepshah16/song-lyrics-dataset?resource=download" rel="noopener ugc nofollow" target="_blank">来源</a></p></div></div>    
</body>
</html>