<html>
<head>
<title>Use Python to Process PDF Work</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python处理PDF作品</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/use-python-to-process-pdf-work-e458dbaf5fc7?source=collection_archive---------0-----------------------#2022-01-16">https://pub.towardsai.net/use-python-to-process-pdf-work-e458dbaf5fc7?source=collection_archive---------0-----------------------#2022-01-16</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="6336" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/nlp" rel="noopener ugc nofollow" target="_blank">自然语言处理</a></h2><div class=""/><div class=""><h2 id="501e" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">没有Adobe PDF软件，您也可以编辑PDF，例如添加文本、拆分页面和提取信息。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/b3b920cdb54d9a414e726248ac184de7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5uf9QxA0nvR1Ais9nFPSoQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://blog.cyda.hk/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄</figcaption></figure><h1 id="e6a7" class="li lj it bd lk ll lm ln lo lp lq lr ls ki lt kj lu kl lv km lw ko lx kp ly lz bi translated">目标</h1><p id="8739" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">人们可能面临的办公室挑战之一是缺乏处理PDF编辑操作的软件。在今天的教程中，我将向您展示如何使用Python自由地从PDF中提取信息或修改PDF中的内容。读完本文后，您将了解到</p><ol class=""><li id="672a" class="mw mx it mc b md my mg mz mj na mn nb mr nc mv nd ne nf ng bi translated"><strong class="mc jd">的方法从PDF中提取</strong>关键信息。</li><li id="70a0" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated">分割PDF页面的方法。</li><li id="f440" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated"><strong class="mc jd">添加</strong>不同元素到PDF的程序。</li><li id="1297" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated"><strong class="mc jd">导出</strong>PDF为图像的方式。</li></ol><p id="d8a3" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">此外，如果你有兴趣查看其他办公室工作技巧，请随时查看我在Medium上的其他文章。</p><div class="np nq gp gr nr ns"><a href="https://towardsdatascience.com/use-python-to-stylize-the-excel-formatting-916e00e33302" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd jd gy z fp nx fr fs ny fu fw jc bi translated">使用Python来格式化Excel</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">使用Python格式化Excel电子表格的分步教程</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="oc l od oe of ob og lb ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a href="https://medium.com/mlearning-ai/use-excel-to-scrape-data-no-codes-required-f13748587b0d" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd jd gy z fp nx fr fs ny fu fw jc bi translated">使用Excel抓取数据(不需要代码)</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">用Excel内置函数抓取数据的三个简单步骤</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">medium.com</p></div></div><div class="ob l"><div class="oh l od oe of ob og lb ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a href="https://towardsdatascience.com/use-python-to-automate-the-powerpoint-update-4a385acf1243" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd jd gy z fp nx fr fs ny fu fw jc bi translated">使用Python自动更新PowerPoint</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">使用Python编辑PowerPoint幻灯片的分步教程</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">towardsdatascience.com</p></div></div><div class="ob l"><div class="oi l od oe of ob og lb ns"/></div></div></a></div><div class="np nq gp gr nr ns"><a href="https://medium.com/mlearning-ai/use-python-to-send-outlook-emails-d673ce9e33e4" rel="noopener follow" target="_blank"><div class="nt ab fo"><div class="nu ab nv cl cj nw"><h2 class="bd jd gy z fp nx fr fs ny fu fw jc bi translated">使用Python发送Outlook电子邮件</h2><div class="nz l"><h3 class="bd b gy z fp nx fr fs ny fu fw dk translated">使用Python发送通知电子邮件的分步教程</h3></div><div class="oa l"><p class="bd b dl z fp nx fr fs ny fu fw dk translated">medium.com</p></div></div><div class="ob l"><div class="oj l od oe of ob og lb ns"/></div></div></a></div></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><blockquote class="or os ot"><p id="8978" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><em class="it"> A </em> <strong class="mc jd"> <em class="it"> ll代码和资料上传到我的GitHub。你可以查一下民间的</em> </strong> <a class="ae lh" href="https://github.com/cydalytics/Python_PDF_Processing" rel="noopener ugc nofollow" target="_blank"> <strong class="mc jd"> <em class="it">这种回购</em> </strong> </a> <strong class="mc jd"> <em class="it">来进一步研究。=) </em> </strong></p></blockquote></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><h1 id="a955" class="li lj it bd lk ll oy ln lo lp oz lr ls ki pa kj lu kl pb km lw ko pc kp ly lz bi translated">数据源</h1><p id="48d5" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">为了展示技巧，首先我们需要PDF文件。在这里，我使用苹果财务报告作为例子，我们可以很容易地从它的官方网站获得这些PDF文件，如下链接所示。</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="d39b" class="pi lj it pe b gy pj pk l pl pm"><a class="ae lh" href="https://investor.apple.com/investor-relations/default.aspx" rel="noopener ugc nofollow" target="_blank">https://investor.apple.com/investor-relations/default.aspx</a></span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pn"><img src="../Images/1fa475cc298b911c6ab70072297eaa4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*M0vPyM8yGiOchTq46IJVnA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">截图自<a class="ae lh" href="https://investor.apple.com/investor-relations/default.aspx" rel="noopener ugc nofollow" target="_blank">苹果官网</a></figcaption></figure></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><h1 id="16d2" class="li lj it bd lk ll oy ln lo lp oz lr ls ki pa kj lu kl pb km lw ko pc kp ly lz bi translated">包裹</h1><p id="bfce" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">在整个教程中，我们主要使用包<code class="fe po pp pq pe b">PyMuPDF</code>。如果这是您第一次听说，您可以简单地通过</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="fb72" class="pi lj it pe b gy pj pk l pl pm">pip install PyMuPDF</span></pre><p id="ee77" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">为了向您介绍这个包，我将介绍PyMuPDF，它是用Python处理PDF的最有用和最强大的包之一。它涵盖了从提取、修改到导出等多种功能。</p><p id="0ccf" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">要导入包，可以使用下面的代码。</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="5b0f" class="pi lj it pe b gy pj pk l pl pm">import fitz as pymupdf</span></pre></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><h1 id="5515" class="li lj it bd lk ll oy ln lo lp oz lr ls ki pa kj lu kl pb km lw ko pc kp ly lz bi translated">第1部分—提取信息</h1><p id="551d" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">我在下面的列表中总结了人们希望从PDF中提取的最常见的元素。</p><ul class=""><li id="1da2" class="mw mx it mc b md my mg mz mj na mn nb mr nc mv pr ne nf ng bi translated">基本信息</li><li id="3261" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated">文本</li><li id="c8ce" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated">形象</li><li id="1b2c" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated">桌子</li><li id="0930" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated">其他人</li></ul><p id="6681" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">让我们一个一个地看。</p><blockquote class="or os ot"><p id="4c97" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 1.1基本信息</strong></p></blockquote><p id="db77" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">基本信息是指与文件结构或文件属性相关的信息，如页数、创建日期、作者等。</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="e56a" class="pi lj it pe b gy pj pk l pl pm">pdf_path = 'Apple Annual Report 2021.pdf'</span><span id="8467" class="pi lj it pe b gy ps pk l pl pm">f = pymupdf.open(pdf_path)<br/>print('Page Number:', f.page_count)<br/>print('Creation Date:', f.metadata['creationDate'])<br/>print('Modified Date:', f.metadata['modDate'])<br/>print('\nTable of Content:\n', [toc[1] for toc in f.get_toc()])<br/>f.close()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pt"><img src="../Images/6fcce28f9154d4403f8dcad47ca1f158.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sSlSWIPOMV8mjniVqNTNWg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">以上代码的输出(Photo by <a class="ae lh" href="https://blog.cyda.hk/" rel="noopener ugc nofollow" target="_blank"> cyda </a>)</figcaption></figure><p id="b439" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">我认为代码是很容易解释的。这里我只介绍三种常用的方法供你参考，帮助你提取基本信息(<code class="fe po pp pq pe b">page_count</code>、<code class="fe po pp pq pe b">metadata</code>、<code class="fe po pp pq pe b">get_toc()</code>)。</p><p id="88df" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated"><strong class="mc jd"> <em class="ou">备注:当我们使用自动化程序处理大量pdf文件时，其中一个技巧是检查修改日期，并将其作为程序启动的触发器。</em> </strong></p><blockquote class="or os ot"><p id="26a3" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 1.2文本</strong></p></blockquote><p id="fc03" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">我们一直关注的另一个信息是文本。让我们以<em class="ou">财年集锦</em>为例。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pu"><img src="../Images/a70974ca19e7f5ca9f39faebf9f04e73.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-U8VVyUGXoySlVCGETbhDg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">第23页的财政年度亮点(照片由<a class="ae lh" href="https://blog.cyda.hk/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄)</figcaption></figure><p id="e204" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">要提取文本，我们只需要考虑三件事——(1)页码，(2)文本的起点，(3)文本的终点。</p><p id="fc0c" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">要提取特定页面的文本，<em class="ou">(下面我们以第23页为例)</em></p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="9894" class="pi lj it pe b gy pj pk l pl pm">f = pymupdf.open(pdf_path)<br/>txt = f.load_page(22).get_text()<br/>f.close()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pv"><img src="../Images/63b63dc6fdcc9b8941b9fdda92d6c1da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*biRSd83yABrCnm_dwgIqPQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">以上代码的输出(图片由<a class="ae lh" href="https://blog.cyda.hk/" rel="noopener ugc nofollow" target="_blank"> cyda </a>提供)</figcaption></figure><p id="8b0b" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">通过获取整个页面的文本，您可以包含那些您可能不感兴趣的不必要的内容，如前一章的段落或页脚。要删除那些不相关的文本，有两种方法，要么设置指针索引，要么用空白替换它们。</p><p id="7f9c" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">要设置指针，可以用下面的代码来做。</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="ae28" class="pi lj it pe b gy pj pk l pl pm">start_idx = txt.find('Fiscal Year Highlights')<br/>txt = txt[start_idx:]</span></pre><p id="6975" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">要替换页脚文本，您必须理解页脚的结构，并使用正则表达式包来替换它。</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="7822" class="pi lj it pe b gy pj pk l pl pm">import re<br/>txt = re.sub("\nApple Inc. \| 2021 Form 10-K \| <strong class="pe jd">\d+</strong>\n", "", txt)</span></pre><blockquote class="or os ot"><p id="fc64" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 1.3图像</strong></p></blockquote><p id="998c" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">除了文本之外，还会提取一些图形或情节用于进一步分析。这里，我们使用品牌标志图像作为演示。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pw"><img src="../Images/5bbe4f8b9d07e9eb743e9d6f35436c8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WJH0tG_ASZY6r5aSfc3mwA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">第1页显示的带有图像的内容(照片由<a class="ae lh" href="https://blog.cyda.hk/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄)</figcaption></figure><p id="6a58" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">为了提取图像，我们需要图像对象的交叉引用号(<code class="fe po pp pq pe b">xref</code>)。您可以将其视为PDF中对象的唯一标识。为了得到这个数字，我们需要利用函数<code class="fe po pp pq pe b">get_images</code>。通过使用函数<code class="fe po pp pq pe b">get_images</code>，我们按照下面的项目结构得到一个特定页面的图像列表。<br/><em class="ou">(</em><strong class="mc jd"><em class="ou">xref</em></strong><em class="ou">，smask，width，height，bpc，colorspace，alt.colorspace，name，filter) </em></p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="7495" class="pi lj it pe b gy pj pk l pl pm">f = pymupdf.open(pdf_path)<br/>img_list = f.load_page(0).get_images()<br/>print(img_list)<br/>f.close()</span></pre><p id="a8a4" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated"><em class="ou">[(</em><strong class="mc jd"><em class="ou">489</em></strong><em class="ou">，0，46，56，8，' DeviceRGB '，''，' Im1 '，' DCTDecode')] </em></p><p id="c0a2" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">所以我们现在知道苹果品牌logo图像交叉引用号是489。接下来的工作是通过<code class="fe po pp pq pe b">extract_image</code>将图像导出。</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="90a3" class="pi lj it pe b gy pj pk l pl pm">f = pymupdf.open(pdf_path)<br/>img_xref = img_list[0][0]<br/>img_data = f.extract_image(img_xref)<br/>img_f = open("img." + img_data["ext"], "wb")<br/>img_f.write(img_data["image"])<br/>img_f.close()<br/>f.close()</span></pre><blockquote class="or os ot"><p id="dc61" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 1.4表</strong></p></blockquote><p id="e998" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">一个坏消息是，PyMuPDF目前不支持直接提取表格，但是作为数据科学家，只要我们获得文本，我们就可以找到方法将其转换成我们希望的格式，对吗？</p><p id="d2ab" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">下面我用目录作为例子。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi px"><img src="../Images/1c7b1d15be6915700d14869e840d5b10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z9BBYnsQlcX-Ag5Qc2_jIw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">第3页目录(照片由<a class="ae lh" href="https://blog.cyda.hk/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄)</figcaption></figure><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="17b4" class="pi lj it pe b gy pj pk l pl pm">import numpy as np<br/>import pandas as pd<br/>pd.set_option('display.max_colwidth', None)</span><span id="f503" class="pi lj it pe b gy ps pk l pl pm">f = pymupdf.open(pdf_path)<br/>txt = f.load_page(2).get_text()<br/>f.close()</span><span id="78ed" class="pi lj it pe b gy ps pk l pl pm">temp_table_list = txt[txt.find('Part I'):].split('\n')<br/>temp_table_list = [cell for cell in temp_table_list if cell not in ['Part I', 'Part II', 'Part III', 'Part IV', '']]<br/>table_list = []<br/>cell = ''<br/>while len(temp_table_list) &gt; 0:<br/>    temp_cell = temp_table_list.pop(0)<br/>    if cell != '':<br/>        temp_cell = cell + temp_cell<br/>        cell = ''<br/>    if temp_cell[-1] == ' ':<br/>        cell = temp_cell<br/>    else:<br/>        table_list.append(temp_cell)<br/>table = pd.DataFrame(np.array(table_list).reshape(-1, 3), columns=['Item', 'Details', 'Page Number'])<br/>table</span></pre><p id="0e41" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">基本上，程序如下。</p><ol class=""><li id="8e8f" class="mw mx it mc b md my mg mz mj na mn nb mr nc mv nd ne nf ng bi translated">加载页面并获取文本。</li><li id="1b75" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated">设置指针索引，获取我们感兴趣的文本范围。</li><li id="0f02" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated">将文本拆分到列表中。</li><li id="067b" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated">处理第5项中的换行文本问题。</li><li id="3308" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated">将列表整形为3维，并将其转换为dataframe。</li><li id="2871" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv nd ne nf ng bi translated">搞定了。</li></ol><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi py"><img src="../Images/319647a7e3b53ec1a6ba522e02f142bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ih5VEtbbrNhDp1uBOgFC-w.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">表格摘录自PDF(照片由<a class="ae lh" href="https://blog.cyda.hk/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄)</figcaption></figure><blockquote class="or os ot"><p id="d3bc" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 1.5其他</strong></p></blockquote><p id="7d10" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">除了上面列出的那些最常见的元素，我还为你的一些兴趣找到了一些额外罕见的组件及其相应的功能。</p><ul class=""><li id="519f" class="mw mx it mc b md my mg mz mj na mn nb mr nc mv pr ne nf ng bi translated">超链接:<code class="fe po pp pq pe b">page.get_links()</code></li><li id="42e6" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated">注释:<code class="fe po pp pq pe b">page.annots()</code></li><li id="f91b" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated">表单字段:<code class="fe po pp pq pe b">page.widgets()</code></li></ul></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><h1 id="6599" class="li lj it bd lk ll oy ln lo lp oz lr ls ki pa kj lu kl pb km lw ko pc kp ly lz bi translated">第2部分—修改内容</h1><p id="578d" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">除了提取信息，PDF的另一个操作是编辑文件，比如添加文本和图像。一般来说，这些类型的工作只能适用于Adobe Acrobat DC或其他PDF编辑器。然而，这些软件中的大多数都不是免费的，而在线PDF编辑器平台可能会在某种程度上导致安全问题。因此，我想分享我们如何利用Python来完成这些操作。</p><ul class=""><li id="575b" class="mw mx it mc b md my mg mz mj na mn nb mr nc mv pr ne nf ng bi translated"><strong class="mc jd">插入</strong>新的一页</li><li id="f185" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated"><strong class="mc jd">删除</strong>页</li><li id="f310" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated"><strong class="mc jd">添加</strong>文本</li><li id="4754" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated"><strong class="mc jd">添加</strong>图片</li><li id="d55b" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated">其他人</li></ul><blockquote class="or os ot"><p id="e138" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 2.1插入一页</strong></p></blockquote><p id="9184" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">要插入页面，我们可以使用方法<code class="fe po pp pq pe b">new_page</code>。该参数将是您想要插入的页码。例如</p><p id="739a" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">在第一页插入:<code class="fe po pp pq pe b">f.new_page(0)</code></p><p id="92b3" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">在最后一页插入:<code class="fe po pp pq pe b">f.new_page(-1)</code></p><p id="96f5" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">在第6页插入:<code class="fe po pp pq pe b">f.new_page(5)</code></p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="27b3" class="pi lj it pe b gy pj pk l pl pm">f = pymupdf.open(pdf_path)<br/>f.<strong class="pe jd">new_page</strong>(0, 612.0, 792.0)<br/>f.save("Modified.pdf")<br/>f.close()</span></pre><p id="77f4" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">备注:您可能会注意到有三个参数，实际上它们指的是<code class="fe po pp pq pe b">(page number, width, height)</code>。</p><blockquote class="or os ot"><p id="b963" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 2.2删除页面</strong></p></blockquote><p id="d07f" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">要删除页面，您可以使用<code class="fe po pp pq pe b">delete_page</code>或<code class="fe po pp pq pe b">delete_pages</code>，但我建议使用后者，因为前者只能通过指定页码来删除单个页面，而后者可以指示页码范围，效率会更高。例如，如果我想只保留奇数页并删除所有偶数页，</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="d475" class="pi lj it pe b gy pj pk l pl pm">f = pymupdf.open(pdf_path)<br/>print('Original Page Number:', f.page_count)<br/>f.<strong class="pe jd">delete_pages</strong>(range(0, f.page_count, 2))<br/>print('Modified Page Number:', f.page_count)<br/>f.save("Modified Apple Annual Report 2021.pdf")<br/>f.close()</span></pre><p id="6dc8" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated"><em class="ou">原页码:82 <br/>修改页码:41 </em></p><blockquote class="or os ot"><p id="b447" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 2.3添加文本</strong></p></blockquote><p id="fd13" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">要添加文本，我们需要一个文本编写器。</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="7cda" class="pi lj it pe b gy pj pk l pl pm">f = pymupdf.open(pdf_path)<br/>page = f.new_page(0, 612.0, 792.0)<br/>text_writer = pymupdf.TextWriter(page.rect)</span></pre><p id="1c9a" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated"><code class="fe po pp pq pe b">page</code>是指我们要编辑的PDF页面。<code class="fe po pp pq pe b">page.rect</code>返回用代表页面坐标的四个浮点<code class="fe po pp pq pe b">(x0, y0, x1, y1)</code>定义的矩形。为了创建文本编写器对象，我们可以使用<code class="fe po pp pq pe b">pymupdf.TextWriter(page.rect)</code>。</p><p id="a91c" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">编写文本需要两件事情，包括(1)放置文本的x-y坐标和(2)文本值。</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="bbbb" class="pi lj it pe b gy pj pk l pl pm"># Compulsory<br/>pos = (100, 200)<br/>text = "<a class="ae lh" href="https://blog.cyda.hk/" rel="noopener ugc nofollow" target="_blank">https://blog.cyda.hk/</a>"</span><span id="33de" class="pi lj it pe b gy ps pk l pl pm"># Optional<br/>font_style = pymupdf.Font("helv")<br/>font_size = 50<br/>font_opacity = 0.5<br/>font_color = (0, 0, 1)</span><span id="8198" class="pi lj it pe b gy ps pk l pl pm">text_writer.append(pos, text, font=font_style, fontsize=font_size)<br/>text_writer.write_text(page, opacity=font_opacity, color=font_color)<br/>f.save("Modified Apple Annual Report 2021.pdf")<br/>f.close()</span></pre><p id="4544" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">请注意，在上面的代码中，我列出了人们希望为字体格式更改的最常见的参数，供您参考。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/bd0095833b31fd974b5446dfdb4de65d.png" data-original-src="https://miro.medium.com/v2/resize:fit:532/format:webp/1*tdvYWu4d62Nrig2bvhToXw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">添加到PDF的文本(照片由<a class="ae lh" href="https://blog.cyda.hk/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄)</figcaption></figure><blockquote class="or os ot"><p id="4347" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 2.4添加图像</strong></p></blockquote><p id="bac7" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">要添加图像，我们只需指定用来放置图像的坐标<code class="fe po pp pq pe b">(x1, y1, x2, y2)</code>。</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="618c" class="pi lj it pe b gy pj pk l pl pm">f = pymupdf.open(pdf_path)<br/>page = f.new_page(0, 612.0, 792.0)</span><span id="a639" class="pi lj it pe b gy ps pk l pl pm">x = 100<br/>y = 200<br/>w = 300<br/>h = 300<br/>img_rect = pymupdf.Rect(x, y, x+w, y+h)<br/>page.insertImage(img_rect, filename="img.jpeg")</span><span id="8623" class="pi lj it pe b gy ps pk l pl pm">f.save("Modified Apple Annual Report 2021.pdf")<br/>f.close()</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/acd557522eb119a3b501ab0b6a8f3c7a.png" data-original-src="https://miro.medium.com/v2/resize:fit:526/format:webp/1*IdOGJzP1xgQsKdTvYiqJXg.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">添加到PDF中的图像(照片由<a class="ae lh" href="https://blog.cyda.hk/" rel="noopener ugc nofollow" target="_blank"> cyda </a>拍摄)</figcaption></figure><blockquote class="or os ot"><p id="1365" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 2.5其他</strong></p></blockquote><p id="4f21" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">可用于编辑PDF的操作远不止上述操作。我列举了其中的一些，供你参考。</p><ul class=""><li id="6496" class="mw mx it mc b md my mg mz mj na mn nb mr nc mv pr ne nf ng bi translated">移动页面:<code class="fe po pp pq pe b">f.move_page()</code></li><li id="008a" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated">复制页面:<code class="fe po pp pq pe b">f.copy_page()</code></li><li id="2837" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated">添加形状:<code class="fe po pp pq pe b">page.new_shape()</code></li><li id="22b6" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated">画线:<code class="fe po pp pq pe b">shape.draw_line()</code></li><li id="5a46" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated">绘制矩形:<code class="fe po pp pq pe b">shape.draw_rect()</code></li></ul></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><h1 id="1a10" class="li lj it bd lk ll oy ln lo lp oz lr ls ki pa kj lu kl pb km lw ko pc kp ly lz bi translated">第3部分—导出不同的格式</h1><p id="a068" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">在本教程结束之前，我想花一些话对PDF的输出格式。</p><ul class=""><li id="1cc2" class="mw mx it mc b md my mg mz mj na mn nb mr nc mv pr ne nf ng bi translated"><strong class="mc jd">分割</strong>PDF。</li><li id="7fa6" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated"><strong class="mc jd">合并</strong>pdf。</li><li id="0e4d" class="mw mx it mc b md nh mg ni mj nj mn nk mr nl mv pr ne nf ng bi translated"><strong class="mc jd">导出</strong>成图像。</li></ul><blockquote class="or os ot"><p id="d0cb" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 3.1 PDF分割</strong></p></blockquote><p id="dc75" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">有时，我们希望拆分整个文件，只提取页面的子集以供进一步处理。诀窍很简单。我们只需创建一个名为<code class="fe po pp pq pe b">new_f</code>的新PDF对象，并使用<code class="fe po pp pq pe b">insert_pdf</code>方法插入页面并保存它。</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="ad76" class="pi lj it pe b gy pj pk l pl pm">f = pymupdf.open(pdf_path)<br/>new_f = pymupdf.open()<br/>new_f.insert_pdf(f, from_page=0, to_page=1)<br/>new_f.save("Modified Apple Annual Report 2021.pdf")<br/>new_f.close()<br/>f.close()</span></pre><blockquote class="or os ot"><p id="ab2f" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 3.2 PDF合并</strong></p></blockquote><p id="9694" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">当您需要合并两个不同的pdf时，可以很容易地应用类似的技巧。基本上，我们打开两个pdf，然后将第二个插入第一个，并保存它。</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="d259" class="pi lj it pe b gy pj pk l pl pm">pdf1_path = 'Apple Annual Report 2021.pdf'<br/>pdf2_path = 'Apple Annual Report 2021.pdf'<br/>f1 = pymupdf.open(pdf1_path)<br/>f2 = pymupdf.open(pdf2_path)<br/>f1.insert_pdf(f2)<br/>f1.save("Modified Apple Annual Report 2021.pdf")<br/>f1.close()<br/>f2.close()</span></pre><blockquote class="or os ot"><p id="cff0" class="ma mb ou mc b md my kd mf mg mz kg mi ov nm ml mm ow nn mp mq ox no mt mu mv im bi translated"><strong class="mc jd"> 3.3导出图像</strong></p></blockquote><p id="7866" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">最后，你们中的一些人可能有兴趣将PDF页面保存为图像。然后，您可以利用<code class="fe po pp pq pe b">get_pixmap()</code>功能将页面转换为像素地图对象，然后保存为PNG。</p><pre class="ks kt ku kv gt pd pe pf pg aw ph bi"><span id="cd1e" class="pi lj it pe b gy pj pk l pl pm">f = pymupdf.open(pdf_path)<br/>page = f.load_page(0)<br/>pix = page.get_pixmap()<br/>pix.save("page.png")</span></pre></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><h1 id="05ef" class="li lj it bd lk ll oy ln lo lp oz lr ls ki pa kj lu kl pb km lw ko pc kp ly lz bi translated">结论</h1><p id="079f" class="pw-post-body-paragraph ma mb it mc b md me kd mf mg mh kg mi mj mk ml mm mn mo mp mq mr ms mt mu mv im bi translated">关于使用Python处理PDF文件的office技巧到此结束。如果你有兴趣了解更多这类工作技巧，请给个赞并关注。请继续关注我的下一篇教程。=)</p><p id="da71" class="pw-post-body-paragraph ma mb it mc b md my kd mf mg mz kg mi mj nm ml mm mn nn mp mq mr no mt mu mv im bi translated">如果你觉得我的文章有用，请在我的LinkedIn页面上为我的技能背书，鼓励我写更多的文章。</p></div></div>    
</body>
</html>