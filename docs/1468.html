<html>
<head>
<title>Time Series Forecasting — Building and Deploying Models, Continued</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">时间序列预测—构建和部署模型，续</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/time-series-forecasting-building-and-deploying-models-continued-deee0588b28c?source=collection_archive---------4-----------------------#2021-02-02">https://pub.towardsai.net/time-series-forecasting-building-and-deploying-models-continued-deee0588b28c?source=collection_archive---------4-----------------------#2021-02-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="d41d" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/automl" rel="noopener ugc nofollow" target="_blank">自动化机器学习</a></h2><div class=""/><div class=""><h2 id="5247" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">第2/2部分:使用ARIMA和AutoML预测液压油试验台的状况。</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/55eb36fb0cb91e1eb2be5187c0a8690f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*ArqSjl2Z4tbNywo3"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@tekton_tools?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">泰克顿</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="aa23" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在我之前的文章的后续文章<a class="ae le" href="https://medium.com/towards-artificial-intelligence/time-series-forecasting-building-and-deploying-models-f647c2ec7567" rel="noopener">中，我继续使用UCI ML知识库的液压系统</a><a class="ae le" href="https://archive.ics.uci.edu/ml/datasets/Condition+monitoring+of+hydraulic+systems" rel="noopener ugc nofollow" target="_blank">数据集</a>进行时间序列预测。在这篇文章中，我使用了ARIMA和Auto ML——所有这些都磨练了我的技能，因为我在工作中开始了一个使用带有时间戳的数据的项目。</p><p id="f5b2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我计划使用Azure ML时间序列预测，但是访问问题迫使我使用H2O的Auto ML功能。</p><p id="9208" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">零件1和零件2的GitHub repo代码在这里是<a class="ae le" href="https://github.com/Ranga2904/Hydraulics" rel="noopener ugc nofollow" target="_blank"/>。</p><p id="1cf1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">请参考第1部分(上面的链接)了解数据和业务案例的背景。在实现了ARIMA和自动ML之后，我将比较两种方法的性能。与第一篇文章一样，我将重点关注高效的应用程序，并谈到优化机会。</p></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="dc91" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated">ARIMA</h1><p id="698a" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">自回归积分移动平均依赖于我对三个超参数(p，d，q)的设置值。它们连续确定用于预测的滞后观测值的数量，是否需要微分来保持序列平稳(即季节性/趋势的影响)，以及是否应该应用移动平均来校正历史观测值中检测到的误差。我在下面记录了我的选择和想法，但是还有优化这些选择的空间。</p><p id="659b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">设置p、d和q的第一步是制作和分析自相关图，显示数值之间随时间的相关性。例如，下图告诉我，在最初的250个循环中，液压累积读数与近220个循环相关；我知道这一点，因为y轴只有在200左右才开始接近0。<em class="nf">所以</em>我设p = 200。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ng"><img src="../Images/4a10568bc92360060eaf3d066c23aba0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2KpPb03BuLosV9tjTG7zqw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图1:自相关图</figcaption></figure><p id="d3bf" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我从第一篇文章中选取了下面的图2，因为从中我了解到大多数目标标签数据没有明显的上升或下降趋势。因此，至少对于两个感兴趣的标签，我设置d = 0。对于cooler_condition，我会设置d = 1或2。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nh"><img src="../Images/40393b468ea485807b3f83cc50790deb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*50DUoq5NBGMpElc4i5UzKQ.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图2:标签数据的趋势</figcaption></figure><p id="7a8d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在我对使用移动平均线来调整ARIMA模型不感兴趣，所以我将设置q = 0。</p><p id="a316" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">由于ARIMA只关注标签，我将使用下面的代码来导入标签数据，并将标签分成训练和测试数据。然后，我用上面得到的设置将训练数据拟合到ARIMA模型中。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="aa62" class="nn mj iq nj b gy no np l nq nr"><em class="nf"># Import label data from profile.txt file in UCI repository  and name columns</em></span><span id="a851" class="nn mj iq nj b gy ns np l nq nr">label = pd.read_csv(".hyddata\\profile.txt",delim_whitespace=True,header=None)<br/>label.columns = ['cooler_condition', 'valve_condition', 'pump_leak', 'hydraulic_accumulator', 'stable_flag']</span><span id="b8f7" class="nn mj iq nj b gy ns np l nq nr"><em class="nf"># Split label into training, then import and fit ARIMA model</em></span><span id="c1b7" class="nn mj iq nj b gy ns np l nq nr">label_train, label_test = label.loc[:1000,:], label.loc[1001:,:]</span><span id="6b32" class="nn mj iq nj b gy ns np l nq nr">from statsmodels.tsa.arima.model import ARIMA</span><span id="6002" class="nn mj iq nj b gy ns np l nq nr">hydmodel = ARIMA(label_train['hydraulic_accumulator'],order=(100,0,0))<br/>hydmodel_fit = hydmodel.fit()</span></pre><p id="687f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">绘制残差(实际值小于预测值)表明预测中没有偏差，即残差中的非零均值。统计数据证实了这一点。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nt"><img src="../Images/082948cc82f5b4e24bc0af87519095f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*Lwpr0LocgMyMP1FgCumsLA.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图3:ARIMA预测的剩余误差</figcaption></figure><p id="4ad9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">检查测试装置上的预测误差显示液压累积的平均绝对误差为5.5，泵泄漏的平均绝对误差为0.65。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/08e13fc0ac452a285bd12211e7604f90.png" data-original-src="https://miro.medium.com/v2/resize:fit:1156/format:webp/1*FOS6CiyiA-gugwUTf-xzBQ.png"/></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图4:ARIMA平均绝对误差</figcaption></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="77db" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated">自动ML</h1><p id="0f40" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">我选择H2O的AutoML是因为它简单有效。他们的<a class="ae le" href="http://docs.h2o.ai/h2o/latest-stable/h2o-docs/automl.html#:~:text=The%20H2O%20AutoML%20interface%20is%20designed%20to%20have,limit%20on%20the%20number%20of%20total%20models%20trained." rel="noopener ugc nofollow" target="_blank">文档</a>提供了一个熟悉这个包的简单通道。</p><p id="0252" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">下面我正在导入h2O.ai包，并在一个开放端口初始化一个实例。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="05ef" class="nn mj iq nj b gy no np l nq nr">%pip install h2o<br/>import h2o<br/>from h2o.automl import H2OAutoML</span><span id="63d6" class="nn mj iq nj b gy ns np l nq nr">h2o.init(ip="127.0.0.1", port="8080")</span></pre><p id="2dd5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在确认了运行的实例之后——参见下面的图5——我使用tsfresh的extract_features来派生标签，以供给AutoML模型。既然<a class="ae le" href="https://medium.com/towards-artificial-intelligence/time-series-forecasting-building-and-deploying-models-f647c2ec7567" rel="noopener"> part 1 </a>深究了这个话题，我就不在这里讨论了。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nv"><img src="../Images/cc79369c5b9e004454c95d69aab98330.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*--Qee9x3wa-a0DNtsiTUMw.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图5:工作中的AutoML</figcaption></figure><p id="efa8" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">提取特征后，我把它们和标签结合起来，分成训练/测试两部分。H2O模型输入需要创建特定的H2Oframe格式，之后我声明了因变量和自变量。</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="dd80" class="nn mj iq nj b gy no np l nq nr"><em class="nf"># Creating combined dataframe of labels and features, then splitting into training and testing sets.</em></span><span id="713f" class="nn mj iq nj b gy ns np l nq nr">combined_extracted = extracted_features.join(label)<br/>combined_extracted.reset_index(inplace=True)</span><span id="adb8" class="nn mj iq nj b gy ns np l nq nr">train_extracted = combined_extracted.iloc[:1100,:]<br/>test_extracted = combined_extracted.iloc[1101:,:]</span><span id="ae76" class="nn mj iq nj b gy ns np l nq nr"><em class="nf"># Below: creating H2Oframes for use in modeling</em></span><span id="e528" class="nn mj iq nj b gy ns np l nq nr">hf_train_extracted = h2o.H2OFrame(train_extracted)<br/>hf_test_extracted = h2o.H2OFrame(test_extracted)</span><span id="9869" class="nn mj iq nj b gy ns np l nq nr"><em class="nf"># Below: declare independent (X) and dependent (y) variables</em></span><span id="2630" class="nn mj iq nj b gy ns np l nq nr">y = 'hydraulic_accumulator'<br/>X = hf_train_extracted.columns<br/>X.remove(y)</span></pre><p id="a045" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在是时候拟合H2O汽车模型，训练它，然后在测试集上评估各种模型的性能。以下是泵泄漏和液压积聚的代码:</p><pre class="kp kq kr ks gt ni nj nk nl aw nm bi"><span id="e865" class="nn mj iq nj b gy no np l nq nr">aml_search_hyd = H2OAutoML(max_runtime_secs = 600)</span><span id="b04b" class="nn mj iq nj b gy ns np l nq nr">aml_search_hyd.train(x = X, <br/>          y = y,<br/>          training_frame = hf_train_extracted,<br/>          leaderboard_frame = hf_test_extracted)</span><span id="ad50" class="nn mj iq nj b gy ns np l nq nr">aml_search_hyd.leaderboard</span><span id="0850" class="nn mj iq nj b gy ns np l nq nr"># <em class="nf">Code above declares and fits H2O Auto ML model on training set, and asks for a leaderboard of top performers using test set.</em></span><span id="0247" class="nn mj iq nj b gy ns np l nq nr"><em class="nf"># Repeating earlier process below, but now for pump leakage as dependent variable.</em></span><span id="4548" class="nn mj iq nj b gy ns np l nq nr">yleak = 'pump_leak'</span><span id="d335" class="nn mj iq nj b gy ns np l nq nr">aml_search_pump = H2OAutoML(max_runtime_secs = 600)</span><span id="30a8" class="nn mj iq nj b gy ns np l nq nr">aml_search_pump.train(x = X, <br/>          y = yleak,<br/>          training_frame = hf_train_extracted,<br/>          leaderboard_frame = hf_test_extracted)</span><span id="6ad3" class="nn mj iq nj b gy ns np l nq nr">aml_search_pump.leaderboard</span></pre><p id="c790" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">排行榜(如下图6所示)使用测试集，通过使用在训练集上训练的模型的多个指标来评估绩效。有一个<em class="nf">优化机会来降低max_runtime_secs超参数，因为模型没有超时。</em></p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nw"><img src="../Images/67f394ceb4de4d989b19e794d5223311.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dw8a1gjhKDriTQLoP00MMg.png"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">图6: H2O.ai Auto ML排行榜</figcaption></figure></div><div class="ab cl mb mc hu md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="ij ik il im in"><h1 id="71aa" class="mi mj iq bd mk ml mm mn mo mp mq mr ms kf mt kg mu ki mv kj mw kl mx km my mz bi translated">结论</h1><p id="2030" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">为了准备我的项目，我提高了对时间序列分析和预测概念的认识。此外，我还开发和部署了一些工具来帮助重工业规划和预测液压系统状况，而无需过多的测试。客户可以利用现有工具可靠预测系统状况的知识，建立规模化运营。</p><p id="adce" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">各种方法进展如何？看起来LSTM的特征提取非常有效，但是通过调整超参数，Auto ML还有一定的改进空间。</p><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/5ab2fe133f4b139206f0e3bbd7a1e72a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1366/format:webp/1*tOpePn06issJRkjYB3u5Nw.png"/></div></figure></div></div>    
</body>
</html>