<html>
<head>
<title>Build A Web App To Interpret Your ML Predictions in Seconds With Shapash</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Shapash构建一个Web应用程序，在几秒钟内解释您的ML预测</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/build-a-web-app-to-interpret-your-ml-predictions-in-seconds-with-shapash-e2ddb2df4d02?source=collection_archive---------0-----------------------#2021-03-04">https://pub.towardsai.net/build-a-web-app-to-interpret-your-ml-predictions-in-seconds-with-shapash-e2ddb2df4d02?source=collection_archive---------0-----------------------#2021-03-04</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><h2 id="f023" class="is it iu bd b dl iv iw ix iy iz ja dk jb translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-science" rel="noopener ugc nofollow" target="_blank">数据科学</a>，<a class="ae ep" href="https://towardsai.net/p/category/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a></h2><div class=""/><div class=""><h2 id="26b5" class="pw-subtitle-paragraph ka jd iu bd b kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr dk translated">一个漂亮的网络应用程序，用于解释你的机器学习预测</h2></div><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/2bb97a9e4efa8e8beea9e42d18c90cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EmMoRDFdrG9KjuEFrjdXWw.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">图片由作者提供(摘自Shapash web app)</figcaption></figure><p id="9213" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><strong class="lk je"> Shapash </strong>让你创建一个漂亮的网络应用程序，一旦你准备好模型，它就能在几秒钟内解释你的机器学习模型。你不必花时间创建自己的web应用程序。这为您和您的团队节省了大量时间。这难道不令人兴奋吗？如果你读到这里，我相信你会对此感兴趣。</p><h1 id="5b56" class="me mf iu bd mg mh mi mj mk ml mm mn mo kj mp kk mq km mr kn ms kp mt kq mu mv bi translated"><strong class="ak">目录</strong></h1><p id="e373" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated"><a class="ae nb" href="#56bc" rel="noopener ugc nofollow">可讲解ai(xai)</a><br/><a class="ae nb" href="#f9a9" rel="noopener ugc nofollow">shapash</a><br/><a class="ae nb" href="#7aa4" rel="noopener ugc nofollow">安装</a> <br/> <a class="ae nb" href="#fcce" rel="noopener ugc nofollow">实现</a> <br/> ∘ <a class="ae nb" href="#edb1" rel="noopener ugc nofollow">步骤1 —构建模型</a> <br/> ∘ <a class="ae nb" href="#7082" rel="noopener ugc nofollow">步骤2 —创建SmartExplainer </a> <br/> ∘ <a class="ae nb" href="#dff8" rel="noopener ugc nofollow">步骤3 —编译</a> <br/> ∘ <a class="ae nb" href="#b17c" rel="noopener ugc nofollow">步骤4 —启动、停止和序列化</a> <br/> ∘</p><blockquote class="nc nd ne"><p id="a818" class="li lj nf lk b ll lm ke ln lo lp kh lq ng ls lt lu nh lw lx ly ni ma mb mc md in bi translated">这篇文章假设你对SHAP和莱姆有一些基本的了解，这是e<strong class="lk je">X</strong>plain able<strong class="lk je">AI</strong>最流行的两个软件包。因为Shapash在后端使用石灰和SHAP来使你的机器学习模型可以解释。即使你不了解SHAP和莱姆，你仍然可以浏览这篇文章。一旦你理解了Shapash如何帮助解释你的模型的预测，以后你就能更深入地理解石灰和SHAP是如何工作的。</p></blockquote></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h1 id="56bc" class="me mf iu bd mg mh nq mj mk ml nr mn mo kj ns kk mq km nt kn ms kp nu kq mu mv bi translated">可解释的人工智能(XAI)</h1><p id="3bbe" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated">可解释的人工智能是指可用于使机器学习模型可解释的工具和技术。以便模型被人类专家理解，这反过来有助于决策。有许多工具或软件包可用，如SHAP，石灰，溜冰，解释毫升等。在可解释的人工智能市场。</p><p id="1dcd" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">还有其他类型的包(覆盖包)，如<strong class="lk je"> Shapash </strong>建立在SHAP和石灰之上，但提供了原始包中没有的附加功能。例如，使用Shapash，您可以获得模型预测的解释，同时，它提供了一个现成的web应用程序来直观地解释您的ML预测。</p><p id="211a" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><em class="nf">如果你有兴趣学习如何使用SHAP和莱姆来解释你的机器学习模型，我推荐以下资源。</em></p><div class="nv nw gq gs nx ny"><a rel="noopener  ugc nofollow" target="_blank" href="/lime-explaining-any-machine-learning-prediction-d663c457a740"><div class="nz ab fp"><div class="oa ab ob cl cj oc"><h2 class="bd je gz z fq od fs ft oe fv fx jd bi translated">LIME解释任何机器学习预测</h2><div class="of l"><h3 class="bd b gz z fq od fs ft oe fv fx dk translated">用石灰向可解释的人工智能迈出第一步</h3></div><div class="og l"><p class="bd b dl z fq od fs ft oe fv fx dk translated">pub.towardsai.net</p></div></div><div class="oh l"><div class="oi l oj ok ol oh om lc ny"/></div></div></a></div><div class="nv nw gq gs nx ny"><a rel="noopener  ugc nofollow" target="_blank" href="/how-to-explain-your-machine-learning-predictions-with-shap-values-a8332c3e5a11"><div class="nz ab fp"><div class="oa ab ob cl cj oc"><h2 class="bd je gz z fq od fs ft oe fv fx jd bi translated">如何用SHAP值解释你的机器学习预测</h2><div class="of l"><h3 class="bd b gz z fq od fs ft oe fv fx dk translated">SHapley加法解释</h3></div><div class="og l"><p class="bd b dl z fq od fs ft oe fv fx dk translated">pub.towardsai.net</p></div></div><div class="oh l"><div class="on l oj ok ol oh om lc ny"/></div></div></a></div><p id="c082" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">现在你已经对e <strong class="lk je"> X </strong> plainable <strong class="lk je"> AI </strong>和<strong class="lk je"> Shapash </strong>有了一些背景，让我们看看如何使用Shapash来解释你的模型预测。</p></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h1 id="f9a9" class="me mf iu bd mg mh nq mj mk ml nr mn mo kj ns kk mq km nt kn ms kp nu kq mu mv bi translated">沙帕什</h1><p id="d16b" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated">Shapash构建了一个开箱即用的web应用程序，用于解释您的机器学习模型预测。这些解释直接或间接地帮助了每个人，包括数据科学家、企业主、监管者、最终用户和客户。你也可以在Jupyter笔记本上看到这些图像。在撰写本文时，Shapash支持大多数Scikit-learn模型XGBoost、LightGBM、Catboost等。</p><h1 id="7aa4" class="me mf iu bd mg mh mi mj mk ml mm mn mo kj mp kk mq km mr kn ms kp mt kq mu mv bi translated">装置</h1><p id="cb75" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated">安装非常简单，下面的命令将安装Shapash和所有的依赖项。</p><pre class="kt ku kv kw gu oo op oq or aw os bi"><span id="6702" class="ot mf iu op b gz ou ov l ow ox">pip install shapash</span></pre><h1 id="fcce" class="me mf iu bd mg mh mi mj mk ml mm mn mo kj mp kk mq km mr kn ms kp mt kq mu mv bi translated">履行</h1><p id="e562" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated">Shapash的关键在于两个对象<code class="fe oy oz pa op b">SmartExplainer</code>和<code class="fe oy oz pa op b">SmartPredictor </code>，它们帮助你解释你的机器学习预测。让我们来看看下面例子中的<strong class="lk je">红酒质量数据集</strong>。本节末尾给出了完整的代码。</p><h2 id="edb1" class="ot mf iu bd mg pb pc dn mk pd pe dp mo lr pf pg mq lv ph pi ms lz pj pk mu ja bi translated">步骤1 —构建模型</h2><p id="beb1" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated">第一步是<strong class="lk je">建立模型</strong>。使用红酒质量数据集，让我们建立随机森林回归模型。为了简单起见，使用默认参数，并且不进行超参数调整。</p><pre class="kt ku kv kw gu oo op oq or aw os bi"><span id="9ff9" class="ot mf iu op b gz ou ov l ow ox">import shap<br/>import pandas as pd<br/>import numpy as np<br/>import matplotlib.pyplot as plt<br/>from sklearn.model_selection import train_test_split<br/>from sklearn.ensemble import RandomForestRegressor</span><span id="8ddc" class="ot mf iu op b gz pl ov l ow ox">dataset_url = '<a class="ae nb" href="https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-red.csv'" rel="noopener ugc nofollow" target="_blank">https://archive.ics.uci.edu/ml/machine-learning-databases/wine-quality/winequality-red.csv'</a><br/>df = pd.read_csv(dataset_url, sep=';')</span><span id="fba5" class="ot mf iu op b gz pl ov l ow ox">y = df['quality']<br/>X = df[['fixed acidity', ‘volatile acidity’, ‘citric acid’, ‘residual sugar’,’chlorides’, ‘free sulfur dioxide’, ‘total sulfur dioxide’, ‘density’,’pH’, ‘sulphates’, ‘alcohol’]]</span><span id="0860" class="ot mf iu op b gz pl ov l ow ox">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size = 0.2, random_state=42)</span><span id="366e" class="ot mf iu op b gz pl ov l ow ox">model = RandomForestRegressor(max_depth=6, random_state=42, n_estimators=10)<br/>model.fit(X_train, y_train)</span><span id="dd72" class="ot mf iu op b gz pl ov l ow ox">y_pred = pd.DataFrame(model.predict(X_test),columns=[‘pred’], index=X_test.index)</span></pre><h2 id="7082" class="ot mf iu bd mg pb pc dn mk pd pe dp mo lr pf pg mq lv ph pi ms lz pj pk mu ja bi translated">步骤2 —创建SmartExplainer</h2><p id="0490" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated">下一步是创建一个<strong class="lk je"> SmartExplainer </strong>对象。</p><pre class="kt ku kv kw gu oo op oq or aw os bi"><span id="e2fd" class="ot mf iu op b gz ou ov l ow ox">from shapash.explainer.smart_explainer import SmartExplainer<br/>xpl = SmartExplainer()</span></pre><h2 id="dff8" class="ot mf iu bd mg pb pc dn mk pd pe dp mo lr pf pg mq lv ph pi ms lz pj pk mu ja bi translated">第3步—编译</h2><p id="42a0" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated">在下一步中，您将运行<strong class="lk je">编译方法</strong>。<strong class="lk je">编译</strong>方法需要两个强制参数:模型&amp;测试数据。它还提供额外的可选参数，如预处理、后处理<strong class="lk je">、</strong>等。</p><pre class="kt ku kv kw gu oo op oq or aw os bi"><span id="d68c" class="ot mf iu op b gz ou ov l ow ox">xpl.compile(x=X_test, model=model, y_pred=y_pred)</span></pre><h2 id="b17c" class="ot mf iu bd mg pb pc dn mk pd pe dp mo lr pf pg mq lv ph pi ms lz pj pk mu ja bi translated">步骤4 —启动、停止和序列化</h2><p id="4b04" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated"><strong class="lk je">步骤4a)启动网络应用</strong></p><p id="c060" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">接下来，您可以通过在<strong class="lk je"> SmartExplainer </strong>对象上运行<code class="fe oy oz pa op b">app_run()</code>方法来启动web应用程序。</p><pre class="kt ku kv kw gu oo op oq or aw os bi"><span id="acdb" class="ot mf iu op b gz ou ov l ow ox">app = xpl.run_app(host='localhost')</span></pre><p id="308d" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">一个新的网页将在你最喜欢的浏览器中打开，在那里你可以得到模型的解释。web应用程序包含3种类型的可视化— <em class="nf">特性贡献、特性重要性、本地解释和测试数据</em>。</p><p id="3edd" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">有两种解释——<strong class="lk je"/>全局解释和局部解释。特征重要性和特征贡献给出了全局解释(整体模型性能),而局部解释给出了对单个预测的解释。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj ks"><img src="../Images/2bb97a9e4efa8e8beea9e42d18c90cd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*EmMoRDFdrG9KjuEFrjdXWw.png"/></div></div></figure><p id="3579" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">请参考下面的<strong class="lk je">步骤5 </strong>，了解如何阅读这些可视化内容来解释模型的预测。</p><p id="e564" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><strong class="lk je">步骤4b)停止服务</strong></p><p id="eb95" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">在查看了模型解释之后，如果您对结果满意，可以通过运行<code class="fe oy oz pa op b">kill()</code>方法来停止服务。</p><pre class="kt ku kv kw gu oo op oq or aw os bi"><span id="03a5" class="ot mf iu op b gz ou ov l ow ox">app.kill()</span></pre><p id="41d1" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><strong class="lk je">步骤4c)串行智能解释器</strong></p><p id="6e38" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">一个重要的特性是您可以序列化<code class="fe oy oz pa op b">SmartExplainer</code>对象(xpl)。下一次你可以只使用腌渍对象，并立即启动网络应用程序。</p><pre class="kt ku kv kw gu oo op oq or aw os bi"><span id="a9c5" class="ot mf iu op b gz ou ov l ow ox"># Save<br/>xpl.save('RedWineQuality_xpl.pkl')</span><span id="7679" class="ot mf iu op b gz pl ov l ow ox"># Load<br/>xpl = SmartExplainer()<br/>xpl.load('RedWineQuality_xpl.pkl')</span></pre><p id="530a" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><strong class="lk je">步骤4d)出口贡献给熊猫数据帧</strong></p><p id="5c5d" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">使用SmartExplainer对象上的<code class="fe oy oz pa op b">to_pandas()</code> <strong class="lk je"> </strong>方法，您可以将特性贡献导出到DataFrame。此外，您可以使用<code class="fe oy oz pa op b">filter()</code>方法控制summary_df中包含的特性数量。</p><pre class="kt ku kv kw gu oo op oq or aw os bi"><span id="9432" class="ot mf iu op b gz ou ov l ow ox">summary_df = xpl.to_pandas(max_contrib=3)</span></pre><h2 id="748f" class="ot mf iu bd mg pb pc dn mk pd pe dp mo lr pf pg mq lv ph pi ms lz pj pk mu ja bi translated">步骤5 —笔记本中的可视化</h2><p id="ce5f" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated">在<strong class="lk je">步骤4b </strong>中，您已经看到了3种用于解释模型预测的可视化方式。您还可以在Jupyter笔记本中获得这些可视化效果以及其他功能。</p><p id="c4d6" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><strong class="lk je">特征重要性:</strong>使用<code class="fe oy oz pa op b">xpl.plot.features_importance()</code>、<strong class="lk je">、</strong>可以得到特征重要性可视化。根据下面的特征重要性图，<code class="fe oy oz pa op b">alcohol</code>和<code class="fe oy oz pa op b">sulphates</code> <strong class="lk je"> </strong>是预测葡萄酒质量的两个最重要的特征。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pm"><img src="../Images/e6cf35a08ea76fddfa7bb899171998e6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vFQHfJgp7nIfxZY1aNj_bg.png"/></div></div></figure><p id="a913" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><strong class="lk je">特性贡献:</strong>使用<code class="fe oy oz pa op b">xpl.plot.contribution_plot()</code>，你得到如下所示的贡献图。下图显示了“酒精”特性的贡献图。该图显示，随着酒精含量的增加，葡萄酒的质量也随之提高。通过替换酒精，你可以获得其他功能的贡献。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pn"><img src="../Images/2462adb29abce10d6a6a1a7e109cd467.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i7YlW9Ihw885K5DHbR0U4A.png"/></div></div></figure><p id="d52a" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">在web应用程序中，默认情况下，您将获得具有最高要素重要性的要素的贡献图(在我们的示例中为“酒精”)。通过单击不同的特性，您可以获得该特性的特性贡献图。</p><p id="b8a3" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><strong class="lk je">本地解释:</strong>使用<code class="fe oy oz pa op b">xpl.plot.local_plot()</code>，您可以获得单个实例的本地解释。在下面的示例中，您从索引为803的测试数据中获得了一个局部解释— <code class="fe oy oz pa op b"> sulphates</code>特征对该预测有很高的正面影响，而<code class="fe oy oz pa op b">alcohol</code>对该预测有最高的负面影响。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj po"><img src="../Images/d65ec4c0104ad2ceb03b08ca1ebd0623.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H-w6vgmGS5043WtjGKm5xw.png"/></div></div></figure><p id="1af3" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">使用<code class="fe oy oz pa op b">filter()</code>方法，您可以控制包含在局部解释图中的特征数量。</p><p id="3cf9" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><strong class="lk je">比较图:</strong>使用<code class="fe oy oz pa op b">xpl.plot.compare_plot()</code>，可以得到比较图，帮助你理解几个实例的预测差异来自哪里。</p><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pp"><img src="../Images/c23bc6be73daa1cb759b2ea415cfe8e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xWZv48XOt-CK37W4icE29w.png"/></div></div></figure><h2 id="6691" class="ot mf iu bd mg pb pc dn mk pd pe dp mo lr pf pg mq lv ph pi ms lz pj pk mu ja bi translated">第6步—部署的SmartPredictor</h2><p id="eb5a" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated">你对Shapash提供的解释满意吗？现在您可以使用<code class="fe oy oz pa op b">SmartPredictor</code>对象进行部署。我们来看看SmartPredictor的特点。</p><p id="9718" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><strong class="lk je">步骤6a)序列化并加载SmartPredictor </strong></p><p id="f9fe" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">与<code class="fe oy oz pa op b">SmartExplainer</code>类似，您可以序列化<code class="fe oy oz pa op b">SmartPredictor</code>对象并根据需要加载它。</p><pre class="kt ku kv kw gu oo op oq or aw os bi"><span id="1e74" class="ot mf iu op b gz ou ov l ow ox">predictor.save('predictor.pkl')</span><span id="0d9e" class="ot mf iu op b gz pl ov l ow ox">from shapash.utils.load_smartpredictor import load_smartpredictor<br/>predictor_load = load_smartpredictor('predictor.pkl')</span></pre><p id="c9c1" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><strong class="lk je">步骤6b)使用SmartPredictor解释新数据</strong></p><p id="437c" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">假设您已经在生产中部署了<code class="fe oy oz pa op b">SmartPredictor</code>。如何用它来解释新进来的数据？这是通过将新数据传递给<code class="fe oy oz pa op b">SmartPredictor</code>上的<code class="fe oy oz pa op b">add_input()</code>方法来完成的。然后，您需要运行<code class="fe oy oz pa op b">detail_contributions()</code>方法，该方法为每个特性提供单独的贡献。为了测试，我将使用来自<code class="fe oy oz pa op b">X_test</code>的第一条记录。</p><pre class="kt ku kv kw gu oo op oq or aw os bi"><span id="a30d" class="ot mf iu op b gz ou ov l ow ox">predictor_load.add_input(x=X_test.head(1))<br/>detailed_contributions = predictor_load.detail_contributions()</span></pre><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pn"><img src="../Images/47752b1baa3dbe28415dd65742d117b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*k_ahGlRD9aizX7kzqFVzOg.png"/></div></div></figure><p id="023f" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><strong class="lk je">步骤6c)—新数据的本地解释</strong></p><p id="f7d0" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">Shapash还不支持使用<code class="fe oy oz pa op b">local_plot</code>获得本地解释(然而，在撰写本文时，他们正试图尽快添加这一功能)。同时，您可以使用下面的代码获得本地解释。</p><pre class="kt ku kv kw gu oo op oq or aw os bi"><span id="fa42" class="ot mf iu op b gz ou ov l ow ox">df = detailed_contributions.drop('ypred', axis=1).T.reset_index()<br/>df.columns= ['features', 'contribution']<br/>df = df.sort_values(by='contribution', ascending=True)</span><span id="58fb" class="ot mf iu op b gz pl ov l ow ox">import plotly.graph_objects as go<br/>from plotly.graph_objs import *</span><span id="87ce" class="ot mf iu op b gz pl ov l ow ox">df['color'] = np.where(df['contribution']&lt;0, '#f4c000', '#4a628a')</span><span id="1e56" class="ot mf iu op b gz pl ov l ow ox">fig = go.Figure(go.Bar(x=df['contribution'], <br/> y=df['features'],<br/> orientation='h', <br/> marker_color=df['color']) <br/> )<br/>fig.update_layout(template='plotly_white', title='Local Explanation', title_x=0.5)<br/>fig.show()</span></pre><figure class="kt ku kv kw gu kx gi gj paragraph-image"><div role="button" tabindex="0" class="ky kz di la bf lb"><div class="gi gj pq"><img src="../Images/07d033c43698eefd1b84cf39e124fc11.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NU0lxI2bEBKNCKj6BAY_9g.png"/></div></div><figcaption class="le lf gk gi gj lg lh bd b be z dk translated">作者图片</figcaption></figure><h2 id="6b6e" class="ot mf iu bd mg pb pc dn mk pd pe dp mo lr pf pg mq lv ph pi ms lz pj pk mu ja bi translated">完整代码</h2><figure class="kt ku kv kw gu kx"><div class="bz fq l di"><div class="pr ps l"/></div></figure></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h1 id="95ad" class="me mf iu bd mg mh nq mj mk ml nr mn mo kj ns kk mq km nt kn ms kp nu kq mu mv bi translated">结论</h1><p id="ddaa" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated">在本文中，您已经了解了如何使用Shapash在几秒钟内构建一个漂亮的web应用程序来解释您的机器学习模型。就像你刚刚经历的，Shapash有很多优点，就像这里提到的<a class="ae nb" href="https://shapash.readthedocs.io/en/latest/#shapash-features" rel="noopener ugc nofollow" target="_blank"><strong class="lk je"/></a>。Shapash文档和教程质量非常高，并且一目了然。我在下面的参考资料部分给出了链接，我建议您浏览所有的链接，以便充分利用Shapash。</p><p id="e40b" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><em class="nf">最初发表于2021年2月26日</em><a class="ae nb" href="https://pythonsimplified.com/shapash-build-a-web-app-to-interpret-your-ml-models-in-seconds/" rel="noopener ugc nofollow" target="_blank"><strong class="lk je"><em class="nf">python简化版</em> </strong> </a> <em class="nf">。</em></p><p id="9ff5" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated"><em class="nf">阅读更多关于Python和数据科学的有趣文章，</em> <a class="ae nb" href="https://pythonsimplified.com/home/" rel="noopener ugc nofollow" target="_blank"> <strong class="lk je"> <em class="nf">订阅</em> </strong> </a> <em class="nf">到我的博客</em><a class="ae nb" href="https://pythonsimplified.com/" rel="noopener ugc nofollow" target="_blank"><strong class="lk je"><em class="nf">www.pythonsimplified.com</em></strong></a><strong class="lk je"><em class="nf">。</em> </strong>你也可以通过<a class="ae nb" href="https://www.linkedin.com/in/chetanambi/" rel="noopener ugc nofollow" target="_blank"><strong class="lk je">LinkedIn</strong></a><strong class="lk je">联系我。</strong></p><p id="202d" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">我希望你喜欢阅读这篇文章。如果你喜欢我的文章并想订阅Medium，你可以在这里这样做: </p><div class="nv nw gq gs nx ny"><a href="https://chetanambi.medium.com" rel="noopener follow" target="_blank"><div class="nz ab fp"><div class="oa ab ob cl cj oc"><h2 class="bd je gz z fq od fs ft oe fv fx jd bi translated">Chetan Ambi -介质</h2><div class="of l"><h3 class="bd b gz z fq od fs ft oe fv fx dk translated">阅读Chetan Ambi在媒体上的文章。数据科学|机器学习| Python。参观https://pythonsimplified.com/…</h3></div><div class="og l"><p class="bd b dl z fq od fs ft oe fv fx dk translated">chetanambi.medium.com</p></div></div><div class="oh l"><div class="pt l oj ok ol oh om lc ny"/></div></div></a></div></div><div class="ab cl nj nk hy nl" role="separator"><span class="nm bw bk nn no np"/><span class="nm bw bk nn no np"/><span class="nm bw bk nn no"/></div><div class="in io ip iq ir"><h1 id="bd92" class="me mf iu bd mg mh nq mj mk ml nr mn mo kj ns kk mq km nt kn ms kp nu kq mu mv bi translated">参考</h1><p id="d02d" class="pw-post-body-paragraph li lj iu lk b ll mw ke ln lo mx kh lq lr my lt lu lv mz lx ly lz na mb mc md in bi translated">[1].<a class="ae nb" href="https://github.com/MAIF/shapash" rel="noopener ugc nofollow" target="_blank">https://github.com/MAIF/shapash</a></p><p id="db0d" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">[2].【https://github.com/MAIF/shapash/tree/master/tutorial T42】</p><p id="64f2" class="pw-post-body-paragraph li lj iu lk b ll lm ke ln lo lp kh lq lr ls lt lu lv lw lx ly lz ma mb mc md in bi translated">[3].<a class="ae nb" href="https://shapash.readthedocs.io/en/latest/" rel="noopener ugc nofollow" target="_blank">https://shapash.readthedocs.io/en/latest/</a></p></div></div>    
</body>
</html>