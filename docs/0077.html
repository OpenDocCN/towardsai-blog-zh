<html>
<head>
<title>Using Transfer Learning to Detect Malaria Diseases</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">利用迁移学习检测疟疾疾病</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/using-transfer-learning-to-detect-malaria-diseases-3b5305ba889a?source=collection_archive---------1-----------------------#2019-06-18">https://pub.towardsai.net/using-transfer-learning-to-detect-malaria-diseases-3b5305ba889a?source=collection_archive---------1-----------------------#2019-06-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/b57e7b3a00ae3763f3fbfbd8aebb9220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qayOtrMuR_A-aYuLMJ559w.png"/></div></div></figure><h2 id="2a62" class="jc jd je bd b dl jf jg jh ji jj jk dk jl translated" aria-label="kicker paragraph">用机器学习对抗疟疾| <a class="ae ep" href="https://towardsai.net" rel="noopener ugc nofollow" target="_blank">走向AI </a></h2><div class=""/><div class=""><h2 id="bf48" class="pw-subtitle-paragraph kk jn je bd b kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb dk translated">通过TFHub使用深度学习和转移学习帮助世界抗击疟疾</h2></div><p id="6830" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">疟疾仍然是迄今为止最常见的传染病之一，也是需要应对的全球性挑战。它是由一种寄生虫引起的，这种寄生虫通过被感染的雌性<em class="ly">按蚊</em> <strong class="le jo">蚊子</strong>的叮咬传播。导致疟疾的寄生虫是一种微小的单细胞生物，称为“<strong class="le jo">疟原虫</strong>”。</p><ul class=""><li id="9ac9" class="lz ma je le b lf lg li lj ll mb lp mc lt md lx me mf mg mh bi translated">2017年，87个国家估计有2.19亿疟疾病例，43.5万人死亡。</li><li id="e97c" class="lz ma je le b lf mi li mj ll mk lp ml lt mm lx me mf mg mh bi translated">2017年，非洲地区有92%的疟疾病例和93%的死亡病例。</li><li id="ff8b" class="lz ma je le b lf mi li mj ll mk lp ml lt mm lx me mf mg mh bi translated">疟疾最常见于非洲、南美和亚洲的热带和亚热带地区。</li><li id="1f26" class="lz ma je le b lf mi li mj ll mk lp ml lt mm lx me mf mg mh bi translated">尽管致命，但如果早期发现，它是可以治愈的。然而，准确诊断疟疾的方法是取一滴血，涂在载玻片上，然后<strong class="le jo">在显微镜下检查</strong>寻找红细胞内的疟原虫。</li></ul><figure class="mo mp mq mr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi mn"><img src="../Images/ce3557491650838bde1363187b3cae08.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CPLUmRoFevq5RL_teUfNIw.jpeg"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">图1:血涂片显微镜；(1)健康红细胞；(2)在受感染的红细胞内发展的疟原虫；(3)疟原虫即将爆发(图片鸣谢:威尔·汉密尔顿)</figcaption></figure><p id="defd" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">医疗保健行业开始转向使用机器学习和训练图像分类模型，以帮助减轻资源受限地区的显微镜专家的负担，并提高诊断准确性。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="9016" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我将使用<strong class="le jo"><em class="ly">tensor flow Hub</em></strong>中的<strong class="le jo">预训练模型组件</strong>来演示我们如何将它用于其他问题，因此也就是疟疾。本文将遵循一般的机器学习工作流程:</p><ol class=""><li id="df7f" class="lz ma je le b lf lg li lj ll mb lp mc lt md lx nd mf mg mh bi translated">通过观察显微镜照片来检查和理解数据</li><li id="f5d9" class="lz ma je le b lf mi li mj ll mk lp ml lt mm lx nd mf mg mh bi translated">构建模型的数据管道</li><li id="b595" class="lz ma je le b lf mi li mj ll mk lp ml lt mm lx nd mf mg mh bi translated">构建模型</li><li id="60e0" class="lz ma je le b lf mi li mj ll mk lp ml lt mm lx nd mf mg mh bi translated">训练模型</li><li id="75e9" class="lz ma je le b lf mi li mj ll mk lp ml lt mm lx nd mf mg mh bi translated">模型评估</li></ol><p id="9aa7" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">数据集和解释可以在<a class="ae ne" href="https://ceb.nlm.nih.gov/repositories/malaria-datasets/" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="87e5" class="nf ng je bd nh ni nj nk nl nm nn no np kt nq ku nr kw ns kx nt kz nu la nv nw bi translated">数据理解</h1><p id="4008" class="pw-post-body-paragraph lc ld je le b lf nx ko lh li ny kr lk ll nz ln lo lp oa lr ls lt ob lv lw lx im bi translated">在一个<code class="fe oc od oe of b">zip</code>文件中提供并加密红细胞的载玻片图像。我们应该确认给出了多少图像以及提供了哪些扩展。</p><figure class="mo mp mq mr gt iv gh gi paragraph-image"><div class="gh gi og"><img src="../Images/f2fa7fa2236bae7a4172774857d2e98c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1254/format:webp/1*z73EKpCIfxjG_AqdRFHKig.jpeg"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">图2:给定Zip文件中的数据</figcaption></figure><p id="d76b" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">一旦我们从列表中删除了不必要的文件(其他不是图像的文件)。然后让我们观察每个班级的样本图像。</p><figure class="mo mp mq mr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oh"><img src="../Images/757f5122140a86c9a449502820d32966.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q8z9qEWDZF2Xa6Hd6oESpw.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">图3:受感染的红细胞</figcaption></figure><figure class="mo mp mq mr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oh"><img src="../Images/31b418aed76cb37cc733643beb7bb6eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yI8dx4UJ2OOvr7EooSai6Q.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">图4:未感染的红细胞</figcaption></figure><p id="bbbd" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">通过绘制这些样本图像，我们可以看到<strong class="le jo">图像的大小不相等，这需要在输入到模型之前固定</strong>。</p><p id="19f1" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">人类善于观察和发现图像中的图案，我们可以注意到受感染的红细胞图像具有紫色的致密颜色，这表明疟疾感染。</p><h1 id="e0f1" class="nf ng je bd nh ni oi nk nl nm oj no np kt ok ku nr kw ol kx nt kz om la nv nw bi translated">数据管道</h1><p id="d1f9" class="pw-post-body-paragraph lc ld je le b lf nx ko lh li ny kr lk ll nz ln lo lp oa lr ls lt ob lv lw lx im bi translated">通常，当我们处理数据集时，我们会将这些数据加载到内存中(即<code class="fe oc od oe of b">pandas</code>数据帧或<code class="fe oc od oe of b">numpy</code>数组)。然而，当我们处理其他非结构化数据或大量数据时，我们无法将所有图像都放入内存中(也许我们可以，但成本会很高)。</p><p id="afad" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在本文中，我将演示如何使用来自<strong class="le jo"> ImageDataGenerator </strong>类的<strong class="le jo"> flow_from_directory() </strong>方法将训练图像提供给模型。</p><p id="5009" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">所以现在我们需要从我们现有的文件夹中重组，下图展示了这方面的思考过程。</p><figure class="mo mp mq mr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi on"><img src="../Images/971a5d812a4355dba4ec41057f6fa496.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yCHo-phcf8jxwFlQnSMM-Q.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">图5:构建数据管道之前的预处理</figcaption></figure><p id="4cbc" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们最终只扫描与图像相关的文件名和标签，而不会将实际的图像加载到内存中。</p><h1 id="693f" class="nf ng je bd nh ni oi nk nl nm oj no np kt ok ku nr kw ol kx nt kz om la nv nw bi translated"><strong class="ak">用TFHub转移学习</strong></h1><p id="09d7" class="pw-post-body-paragraph lc ld je le b lf nx ko lh li ny kr lk ll nz ln lo lp oa lr ls lt ob lv lw lx im bi translated">在这一步，我将使用特征提取器MobileNet V2，这是可用的<a class="ae ne" href="https://tfhub.dev/google/imagenet/mobilenet_v2_140_224/feature_vector/3" rel="noopener ugc nofollow" target="_blank">这里</a>。</p><figure class="mo mp mq mr gt iv"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">加载预训练的特征提取器模块并冻结权重</figcaption></figure><p id="5eeb" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们从TF Hub加载特征提取器，并获得预期的图像大小。当我们从每个文件夹生成数据管道来为训练、评估和测试数据集提供数据时，将会用到它。</p><figure class="mo mp mq mr gt iv"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">使用我们创建的文件夹创建数据管道</figcaption></figure><p id="6cf9" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">接下来，我们可以在<strong class="le jo"> ImageDataGenerator </strong>类中使用<strong class="le jo"> flow_from_directory </strong>()方法。</p><ul class=""><li id="f0a7" class="lz ma je le b lf lg li lj ll mb lp mc lt md lx me mf mg mh bi translated">在训练数据生成器中，我应用了一些数据增强，如缩放、移位和翻转。</li><li id="e83c" class="lz ma je le b lf mi li mj ll mk lp ml lt mm lx me mf mg mh bi translated">所有数据生成器都将缩小到[0，1]以内。</li><li id="15d2" class="lz ma je le b lf mi li mj ll mk lp ml lt mm lx me mf mg mh bi translated">然后，我们调整所有数据生成器的图像大小，以适合特征提取器模块。</li><li id="39a0" class="lz ma je le b lf mi li mj ll mk lp ml lt mm lx me mf mg mh bi translated">训练和验证生成器将被打乱，因为我们希望随机提供图像。</li></ul><p id="c4d9" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">然后，我们可以将特征提取器与分类器层包装在一起，专门用于我们的疟疾分类任务。</p><figure class="mo mp mq mr gt iv"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">向网络添加顶级分类器层</figcaption></figure><p id="3180" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">我们可以开始用我们的数据集训练网络，在回调中，我已经包含了一些回调函数来微调，如果没有改善就停止训练。</p><figure class="mo mp mq mr gt iv"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">使用发电机训练网络</figcaption></figure><p id="ffbf" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">使用历史记录来绘制培训期间的进度和信息。</p><figure class="mo mp mq mr gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi oq"><img src="../Images/1975ffa1ad185b01a320533d9a2bfa1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1116/format:webp/1*Tcu9PgPe1VJHRd00YvCuxw.png"/></div></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">图6:历史图—时期15提供最佳的val_acc和val_loss</figcaption></figure><p id="08b5" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">最后，我们可以使用模型来预测测试数据生成器。</p><figure class="mo mp mq mr gt iv"><div class="bz fp l di"><div class="oo op l"/></div><figcaption class="ms mt gj gh gi mu mv bd b be z dk translated">使用测试图像名称、真实标签和预测制作数据框</figcaption></figure><p id="66ed" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">这种简单的迁移学习可以在各项指标上取得良好的绩效。</p><pre class="mo mp mq mr gt or of os ot aw ou bi"><span id="6f72" class="ov ng je of b gy ow ox l oy oz">The AUC score: 0.9405, accuracy score: 0.9405, f1 score: 0.9413</span></pre><h1 id="18bd" class="nf ng je bd nh ni oi nk nl nm oj no np kt ok ku nr kw ol kx nt kz om la nv nw bi translated">我们还能改进什么？</h1><p id="a759" class="pw-post-body-paragraph lc ld je le b lf nx ko lh li ny kr lk ll nz ln lo lp oa lr ls lt ob lv lw lx im bi translated">基于现有的MobileNet V2模型，我们可以解冻权重，训练几个上层(不是全部)。这将允许专门检测特定模式的上层适应疟疾图像。</p></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><p id="badd" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">在本文中，我使用了来自<a class="ae ne" href="https://www.tensorflow.org/hub" rel="noopener ugc nofollow" target="_blank"><strong class="le jo"><em class="ly">TF hub</em></strong></a><strong class="le jo"><em class="ly"/></strong>的预先训练好的特征提取器来从幻灯片图像数据中预测疟疾。通过这种方法，它可以实现可重用的机器学习模块和快速的数据产品开发。</p><p id="5125" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">关于完整的代码，请访问下面的GitHub库，获取完整的笔记本解释:</p><div class="is it gp gr iu pa"><a href="https://github.com/netsatsawat/Malaria-Detection" rel="noopener  ugc nofollow" target="_blank"><div class="pb ab fo"><div class="pc ab pd cl cj pe"><h2 class="bd jo gy z fp pf fr fs pg fu fw jn bi translated">netsatsawat/疟疾检测</h2><div class="ph l"><h3 class="bd b gy z fp pf fr fs pg fu fw dk translated">演示迁移学习在TF hub-netsatsawat/疟疾检测中的应用的存储库</h3></div><div class="pi l"><p class="bd b dl z fp pf fr fs pg fu fw dk translated">github.com</p></div></div><div class="pj l"><div class="pk l pl pm pn pj po ja pa"/></div></div></a></div></div><div class="ab cl mw mx hx my" role="separator"><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb nc"/><span class="mz bw bk na nb"/></div><div class="im in io ip iq"><h1 id="25de" class="nf ng je bd nh ni nj nk nl nm nn no np kt nq ku nr kw ns kx nt kz nu la nv nw bi translated">参考</h1><p id="0cf9" class="pw-post-body-paragraph lc ld je le b lf nx ko lh li ny kr lk ll nz ln lo lp oa lr ls lt ob lv lw lx im bi translated">[1]<a class="ae ne" href="https://www.who.int/news-room/fact-sheets/detail/malaria" rel="noopener ugc nofollow" target="_blank">https://www.who.int/news-room/fact-sheets/detail/malaria</a></p><p id="5fad" class="pw-post-body-paragraph lc ld je le b lf lg ko lh li lj kr lk ll lm ln lo lp lq lr ls lt lu lv lw lx im bi translated">[2]<a class="ae ne" href="https://ceb.nlm.nih.gov/repositories/malaria-datasets/" rel="noopener ugc nofollow" target="_blank">https://ceb.nlm.nih.gov/repositories/malaria-datasets/</a></p></div></div>    
</body>
</html>