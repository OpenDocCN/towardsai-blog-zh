<html>
<head>
<title>Deep Learning Sentiment Analysis of Donald Trump’s Tweets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">唐纳德·特朗普推文的深度学习情感分析</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/deep-learning-sentiment-analysis-of-donald-trumps-tweets-fc34ed73b7f6?source=collection_archive---------1-----------------------#2022-03-15">https://pub.towardsai.net/deep-learning-sentiment-analysis-of-donald-trumps-tweets-fc34ed73b7f6?source=collection_archive---------1-----------------------#2022-03-15</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b617" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">用情感分析和深度学习理解唐纳德·J·特朗普的推文</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/e4c48469da1598ee5fb67b399a11712b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*MALkjZkmesA6VCOT"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="c650" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">众所周知，美利坚合众国第46任总统唐纳德·J·特朗普经常使用推特，从谴责他的政治对手到宣布他的政府实施的新措施。他对Twitter的争议性使用最终导致他的账户在2021年1月被暂停。在本文中，我们将尝试使用深度学习的情感分析来理解特朗普总统在2012年至2021年1月之间的推文[1]。本文中的代码写在两个独立的Kaggle笔记本中，链接在文章的末尾。</p><h1 id="9106" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">设置</h1><p id="8182" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在这一节中，我们将研究如何使用拥抱脸转换器的库来获取推文的情感极性和得分。</p><p id="54ba" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们安装拥抱脸的变形金刚库。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="efd0" class="mw lv it ms b gy mx my l mz na">pip install transformers</span></pre><p id="458b" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">首先，我们导入必要的库</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="324f" class="mw lv it ms b gy mx my l mz na">from transformers import pipeline<br/>import pandas as pd<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>import numpy as np<br/>import re<br/>import emoji<br/>import html.parser</span></pre><h1 id="fbd2" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">数据清理</h1><p id="91a0" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我们对推文进行数据清理，并提取推文中提到的信息，如标签和句柄，以供进一步分析。这些推文可以在“文本”栏中找到。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="7be1" class="mw lv it ms b gy mx my l mz na">df = pd.read_csv('/kaggle/input/donald-trump-tweets-dataset/tweets.csv')</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nb"><img src="../Images/e1291556626734f16c62476f0b80b7b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Qma5lehoYCy5ngqC"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="d37e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们使用Pandas的<code class="fe nc nd ne ms b">.pipe()</code>函数将不同的函数依次应用于数据帧。</p><p id="ce85" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">本节的剩余部分将描述这些功能中的每一个。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="a823" class="mw lv it ms b gy mx my l mz na">df = (df<br/>      .pipe(clean_column_names)<br/>      .pipe(clean_tweet)<br/>      .pipe(get_date_attr)<br/>      .pipe(get_hashtag)<br/>      .pipe(get_mention_handle)<br/>      .pipe(format_flags)<br/>      .pipe(get_retweets)<br/>      .pipe(drop_tweets))</span></pre><p id="95cc" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">标准化列名</strong></p><p id="dca7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">所有列名都改为小写</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="4e16" class="mw lv it ms b gy mx my l mz na">def clean_column_names(df):<br/>    <br/>    df.columns = [i.lower() for i in df.columns]<br/>    <br/>    return df</span></pre><p id="786f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">清理推文内容</strong></p><ol class=""><li id="d5d5" class="nf ng it la b lb lc le lf lh nh ll ni lp nj lt nk nl nm nn bi translated">删除推文中提到的网址</li><li id="3407" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">移除表情符号</li><li id="96a9" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">删除多个空格</li><li id="8cb1" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">转义HTML</li></ol><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="619e" class="mw lv it ms b gy mx my l mz na">def _clean_tweet(text):<br/>       <br/>    output = re.sub('http[\\w\\d\\D./]+', '', output).strip() #remove url<br/>    output = emoji.get_emoji_regexp().sub('', output) # remove emoji<br/>    output = re.sub('\\s\\s+', ' ', output).strip() # remove white spaces<br/>    output = html.unescape(output) # escape html</span><span id="8899" class="mw lv it ms b gy nt my l mz na">    return output</span><span id="5360" class="mw lv it ms b gy nt my l mz na">def clean_tweet(df):<br/>       <br/>    df['text'] = df['text'].apply(lambda x: _clean_tweet(x))<br/>    <br/>    return df</span></pre><p id="41e2" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">创建日期属性</strong></p><p id="0152" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">每条tweet都有一个时间戳，我们可以从中提取日期属性，如年、月、星期几和一天中的小时。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="7c36" class="mw lv it ms b gy mx my l mz na">def get_date_attr(df):<br/>       <br/>    df['date'] = pd.to_datetime(df['date'])<br/>    df['year'] = df['date'].dt.year<br/>    df['month'] = df['date'].dt.month<br/>    df['day_of_week'] = df['date'].dt.day_name()<br/>    df['hour'] = df['date'].dt.hour<br/>    <br/>    return df</span></pre><p id="e148" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">识别哈希标签</strong></p><p id="abc5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过查找推文中的<code class="fe nc nd ne ms b">#</code>符号来识别推文中出现的标签。该函数创建了一个名为<code class="fe nc nd ne ms b">hashtags</code>的新列，其中标识的hashtags以列表格式存储。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="27d0" class="mw lv it ms b gy mx my l mz na">def _get_hashtag(text):<br/>    <br/>    output = list(set(re.findall('#\\w+', text)))<br/>    <br/>    return output</span><span id="c989" class="mw lv it ms b gy nt my l mz na">def get_hashtag(df):<br/>    <br/>    df['hashtags'] = df['text'].apply(lambda x: _get_hashtag(x))<br/>    <br/>    return df</span></pre><p id="0e75" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">识别Twitter句柄</strong></p><p id="9dca" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">通过在推文中找到<code class="fe nc nd ne ms b">@</code>符号来识别推文中提到的twitter句柄。该函数创建一个名为<code class="fe nc nd ne ms b">handles_mentioned</code>的新列，其中标识的Twitter句柄以列表格式存储。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="6896" class="mw lv it ms b gy mx my l mz na">def _get_mention_handle(text):<br/>    <br/>    output = list(set(re.findall('@\\w+', text)))<br/>    <br/>    return output</span><span id="9e00" class="mw lv it ms b gy nt my l mz na">def get_mention_handle(df):<br/>    <br/>    df['handles_mentioned'] = df['text'].apply(lambda x: _get_mention_handle(x))<br/>    <br/>    return df</span></pre><p id="38a1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">格式标志</strong></p><p id="5cb8" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">将3个指示器栏中的值分别从<code class="fe nc nd ne ms b">t</code>和<code class="fe nc nd ne ms b">f</code>重命名为<code class="fe nc nd ne ms b">True</code>和<code class="fe nc nd ne ms b">False</code>。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="4f9e" class="mw lv it ms b gy mx my l mz na">def format_flags(df):<br/>    <br/>    df['isflagged'] = df['isflagged'].apply(lambda x: True if x == 't' else False)<br/>    df['isdeleted'] = df['isdeleted'].apply(lambda x: True if x == 't' else False)<br/>    df['isretweet'] = df['isretweet'].apply(lambda x: True if x == 't' else False)<br/>    <br/>    return df</span></pre><p id="1d2d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">识别转发</strong></p><p id="6ed9" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">虽然数据带有<code class="fe nc nd ne ms b">isretweet</code>标志列来识别该推文是否是转发，但仍有一些转发没有被正确标记。“RT @handle”格式通常放在推文的开头，表示推文被转发。我们使用这些信息来识别没有被正确标记的转发。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="86ed" class="mw lv it ms b gy mx my l mz na">def get_retweets(df):<br/>    <br/>    df.loc[(df['text'].str.contains('^RT @|^\\"RT @')), 'isretweet'] = True<br/>    <br/>    return df</span></pre><p id="ec53" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated"><strong class="la iu">降记录</strong></p><p id="044f" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">最后，我们删除了2012年之前的推文，转发推文，以及清理后不包含文本的推文。通常，这些推文只包含一个URL、表情符号、提及或标签，没有任何其他内容。我们还会删除包含“@realDonaldTrump”的推文。这些推文提到了特朗普总统的把柄，但不是特朗普总统本人发的。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="9c94" class="mw lv it ms b gy mx my l mz na">def drop_tweets(df):</span><span id="52c9" class="mw lv it ms b gy nt my l mz na">    df = (df<br/>          .loc[(df['clean_text'] != '') <br/>               &amp; (df['year'].between(2012,2021))<br/>               &amp; (df['isretweet'] == False)<br/>               &amp; ~(df['handles_mentioned'].apply(lambda x: '@realDonaldTrump' in x))<br/>              ]<br/>          .reset_index(drop = True))<br/>    <br/>    return df</span></pre><p id="c901" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是数据帧现在的样子。从2012年1月到2021年1月，特朗普总统发了大约3.6万条推文。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="f194" class="mw lv it ms b gy mx my l mz na">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nu"><img src="../Images/65d44a354fdb8997c0e099c509bd75f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Bx1rxBonTprZwXqI"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="56c1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将列转换为列表，列表中的每个元素都是一条tweet。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="dd07" class="mw lv it ms b gy mx my l mz na">tweets = df['text'].to_list()</span></pre><h1 id="8054" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">情感分析模型管道</h1><p id="2f7a" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">让我们建立我们的情感分析管道。我们将使用<code class="fe nc nd ne ms b">RoBERTa-Large</code>模型[2]，该模型经过微调，使用15个不同的数据集进行情感分析，其中包括短文本类推文。我们必须在“设备”参数中指定GPU设备id，以便在GPU上运行推理。请注意，这里不涉及培训，我们只是使用一个微调的模型来执行推理。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="e7f6" class="mw lv it ms b gy mx my l mz na">sentiment = pipeline(task = 'sentiment-analysis',<br/>                     model = 'siebert/sentiment-roberta-large-english',<br/>                     tokenizer = 'siebert/sentiment-roberta-large-english',<br/>                     device = 0)</span></pre><p id="fc4c" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">为了避免CUDA内存不足的问题，我们在200条tweets的较小批次中执行推理，并在最后连接结果</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="a687" class="mw lv it ms b gy mx my l mz na">BATCH_SIZE = 200<br/>results = []<br/>for  batch_no in range(int(np.ceil(len(tweets)/BATCH_SIZE))): <br/>    results.extend(sentiment(tweets[batch_no*BATCH_SIZE: (batch_no+1)*BATCH_SIZE]))<br/>    <br/>df_results = pd.DataFrame(results)<br/>df = pd.concat([df,df_results], axis = 1)</span></pre><p id="ab58" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这是最终的数据帧现在的样子。<code class="fe nc nd ne ms b">label</code>和<code class="fe nc nd ne ms b">score</code>列是由情感模型提供的结果。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="1ffb" class="mw lv it ms b gy mx my l mz na">df.head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nv"><img src="../Images/2c6fa5f363545c6e21a7e1565341b1c3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*vbcwrH4ZBVgc0TVK"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="960d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">让我们为下游任务保存输出。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="560a" class="mw lv it ms b gy mx my l mz na">df.to_csv('/kaggle/working/donald-trump-tweets-sentiment.csv', index = False)</span></pre><h1 id="8cbb" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">词云</h1><p id="9cc2" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">让我们使用WordCloud库来可视化特朗普推文中的常用词(unigrams)。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="eacf" class="mw lv it ms b gy mx my l mz na">import pandas as pd<br/>import seaborn as sns<br/>import matplotlib.pyplot as plt<br/>import numpy as np<br/>import re<br/>from ast import literal_eval<br/>from wordcloud import WordCloud, STOPWORDS<br/>from PIL import Image<br/>import ast</span><span id="11f3" class="mw lv it ms b gy nt my l mz na">sns.set(style='darkgrid')<br/>pd.set_option('display.max_colwidth', None)</span></pre><p id="b9e4" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">对特朗普推文的后续分析是在情绪评分的单独笔记本中进行的，因此我们必须加载之前保存的情绪评分数据。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="f297" class="mw lv it ms b gy mx my l mz na">df_tweets = pd.read_csv('/kaggle/input/donald-trump-tweets-sentiment/donald-trump-tweets-sentiment.csv', dtype = {'id':'object'})<br/>df_tweets['label'] = df_tweets['label'].str.lower()<br/>df_tweets['clean_text'] = df_tweets['clean_text'].apply(lambda x: str(x))<br/>df_tweets['hashtags'] = df_tweets['hashtags'].apply(lambda x: ast.literal_eval(x))<br/>df_tweets['handles_mentioned'] = df_tweets['handles_mentioned'].apply(lambda x: ast.literal_eval(x))</span></pre><p id="0e0a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">我们将基于2种不同的情绪极性(积极和消极)和4个不同的时间段创建8个不同的单词云。选择的时间段是</p><ol class=""><li id="6e20" class="nf ng it la b lb lc le lf lh nh ll ni lp nj lt nk nl nm nn bi translated">2012年至2015年:特朗普上台前</li><li id="3cce" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">2016年:特朗普正在竞选，并最终当选他的第一个任期</li><li id="e499" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">2017-2019:特朗普在任期间</li><li id="9842" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">2020-2021年1月:特朗普正在竞选他的第二个任期</li></ol><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="6cb1" class="mw lv it ms b gy mx my l mz na">STOPWORDS.update({'will', 's'})<br/>stopwords = set(STOPWORDS)<br/>year_range = [(2012,2015), (2016,2016), (2017,2019), (2020,2021)]</span><span id="11d4" class="mw lv it ms b gy nt my l mz na"># word clouds for positive sentiments<br/>for start, end in year_range:<br/>    wordcloud = WordCloud(stopwords=stopwords, background_color="white")<br/>    text = ' '.join(df_tweets.loc[(df_tweets['label'] == 'positive') &amp; (df_tweets['year'].between(start,end)), 'clean_text'].values.tolist())<br/>    wordcloud.generate(text)<br/>    plt.imshow(wordcloud, interpolation='bilinear')<br/>    plt.axis("off")<br/>    plt.show()</span><span id="d997" class="mw lv it ms b gy nt my l mz na"># word clouds for negative sentiments<br/>for start, end in year_range:<br/>    wordcloud = WordCloud(stopwords=stopwords, background_color="white", width = 800, height = 400)<br/>    text = ' '.join(df_tweets.loc[(df_tweets['label'] == 'negative') &amp; (df_tweets['year'].between(start, end)), 'clean_text'].values.tolist())<br/>    wordcloud.generate(text)<br/>    plt.imshow(wordcloud, interpolation='bilinear')<br/>    plt.axis("off")<br/>    plt.show()</span></pre><p id="da1d" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">结果汇总如下。这些被频繁提及的话让我们看到了特朗普当时的想法。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/8b27adff9a3981ecfc22738405a78aac.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/0*YqdUj4mLbonPryaF"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="16ac" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在这四个阶段中，积极情绪的最常见单字似乎相对稳定，主要是“谢谢”和“太好了”。然而，负面情绪的常见单词会随着时间而变化。</p><p id="bbf5" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在2021-2015年间，包含奥巴马总统名字和奥巴马医改的负面推文出现得相当频繁，可能是批评奥巴马总统的政府。以下是这类推文的一些例子。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nx"><img src="../Images/90dd691107e7ca5857984d376cea03dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*H07cFJtcbpu_IDhL"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="ebce" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">2016年是选举年，民主党总统候选人希拉里·克林顿的名字频繁出现在与负面情绪相关的推文中。这些是特朗普总统与希拉里·克林顿有关的顶级负面情绪推文，一般旨在谴责他的政治对手。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/5ca718d300e6956243335be67351c095.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*kwcwSQSs2ehAU0vK"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="06fb" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在2017年至2021年期间，“假新闻”在与负面情绪相关的推文中出现得相当频繁。这些推文中有许多是针对媒体报道特朗普认为是关于他的政府的假新闻。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nz"><img src="../Images/ef473e9c95843455c2494091742e005a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*t2OEoCHsTWlaPFUS"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h1 id="9ddd" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">转发和收藏</h1><p id="59c3" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">让我们更深入地看看特朗普推文的各种属性。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="12a9" class="mw lv it ms b gy mx my l mz na">summary_data = df_tweets.groupby('label', as_index = False).agg({'id':'count', 'retweets':'median', 'favorites':'median', 'isflagged':'mean', 'isdeleted':'mean'})<br/>summary_data['pct_isflagged'] = summary_data['isflagged'].apply(lambda x: round(x*100, 2))<br/>summary_data['pct_isdeleted'] = summary_data['isdeleted'].apply(lambda x: round(x*100, 2))</span></pre><p id="93b7" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">在2012年至2021年间，大约60%的推文是正面的。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/031a68f07cf98945e853eedf38a86bca.png" data-original-src="https://miro.medium.com/v2/resize:fit:820/0*46XbtUBgt2QBfGkc"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="fd50" class="mw lv it ms b gy mx my l mz na">fig, ax = plt.subplots()<br/>ax = sns.barplot(data = summary_data, x = 'label', y = 'id')<br/>ax.set_title('Number of Positive vs Negative Tweets')<br/>ax.set_xlabel('Sentiment')<br/>ax.set_ylabel('Number of Tweets')<br/>change_width(ax, 0.5)</span></pre><p id="775a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">与情绪积极的推文相比，情绪消极的推文的转发量和受欢迎程度分别是前者的2.7倍和2.6倍。一个可能的解释是，与正面推文相比，负面推文往往会引发读者更深层次的情绪，从而导致更多的分享和喜欢。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="8c3f" class="mw lv it ms b gy mx my l mz na">fig, ax = plt.subplots()<br/>ax = sns.barplot(data = summary_data, x = 'label', y = 'retweets')<br/>ax.set_title('Median Number of Retweets Per Tweet by Sentiment Polarity')<br/>ax.set_xlabel('Sentiment')<br/>ax.set_ylabel('Number of Retweets')<br/>change_width(ax, 0.5)</span><span id="e247" class="mw lv it ms b gy nt my l mz na">fig, ax = plt.subplots()<br/>ax = sns.barplot(data = summary_data, x = 'label', y = 'favorites')<br/>ax.set_title('Median Number of Favourites Per Tweet by Sentiment Polarity')<br/>ax.set_xlabel('Sentiment')<br/>ax.set_ylabel('Number of Favorites')<br/>change_width(ax, 0.5)</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ob"><img src="../Images/549c7739c7ba92c97a40a1f781af7448.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*g0Mw07CN9stmRTTF"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h1 id="440e" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">情绪在一周内如何变化</h1><p id="5d49" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">下图显示了2017年至2020年期间一周中每天积极情绪推文的百分比。看起来周五积极情绪的推特比例最高。我猜连总统都喜欢TGIF！而周日的积极情绪推特比例最低。可能是周一忧郁？</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="60d8" class="mw lv it ms b gy mx my l mz na">data = pd.pivot_table(df_tweets,<br/>                               index = ['day_of_week'],<br/>                               columns = 'label',<br/>                               aggfunc = {'id':'count', 'score':'mean'},<br/>                               fill_value = 0)<br/>data.columns = data.columns.map('_'.join).str.strip('_')<br/>data['tweet_pct_pos'] = data.apply(lambda x: round(x['id_positive']/(x['id_positive'] + x['id_negative'])*100,2), axis = 1)<br/>data.reset_index(inplace = True)</span><span id="8514" class="mw lv it ms b gy nt my l mz na">fig, ax = plt.subplots(figsize=(10,5))<br/>ax = sns.barplot(data = data,<br/>                 x = 'day_of_week',<br/>                 y = 'tweet_pct_pos',<br/>                 order = ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday', 'Sunday'])<br/>ax.set_title("% of Positive Tweets")<br/>ax.set_xlabel('Day of Week')<br/>ax.set_ylabel('% Postitive Tweets')<br/>ax.set_ylim(50,65)<br/>plt.xticks(rotation=90, ha='right')<br/>plt.show()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oc"><img src="../Images/915d233048dd0c8d7e5c31dc40f45cb6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1214/0*E2Ifcep34j3MpA6P"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h1 id="a284" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">情绪在一天中如何变化</h1><p id="741b" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">下图显示了2017年至2020年期间每天一小时内积极情绪的百分比。早上有很高比例的正面推文，然而，正面推文的比例随着一天的进展而下降，中午达到低点，晚上则反弹。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi od"><img src="../Images/705c851ae2a02713840690114e7c97aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*xzD6QTEDZgpFXl_2"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h1 id="51cb" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">情感vs散列标签</h1><p id="87ec" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">让我们来看看哪些标签经常与情感的极性联系在一起。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="71e0" class="mw lv it ms b gy mx my l mz na">df_tweets_hashtag_explode = df_tweets.explode('hashtags')<br/>data = pd.pivot_table(df_tweets_hashtag_explode,<br/>                      index = ['hashtags'],<br/>                      columns = 'label',<br/>                      aggfunc = {'id':'count', 'score':'mean'},<br/>                      fill_value = 0)<br/>data.columns = data.columns.map('_'.join).str.strip('_')<br/>data['tweet_pct_pos'] = data.apply(lambda x: round(x['id_positive']/(x['id_positive'] + x['id_negative'])*100,2), axis = 1)<br/>data.reset_index(inplace = True)<br/>data = data[(data['id_negative'] + data['id_positive']) &gt;= 20]<br/>data.sort_values('tweet_pct_pos', ascending = False).loc[:, ['hashtags', 'id_negative', 'id_positive', 'tweet_pct_pos']].head()</span></pre><p id="197e" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">只考虑至少有20条记录的hashtags。这些标签与积极情绪推特的比例最高。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/640ad37c57f3c6c6ae2b91939dbd5fb5.png" data-original-src="https://miro.medium.com/v2/resize:fit:688/0*2aT62H4yiL2wvSFp"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="e7b1" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">这些标签与负面情绪推特的比例最低。</p><pre class="kj kk kl km gt mr ms mt mu aw mv bi"><span id="3b96" class="mw lv it ms b gy mx my l mz na">data.sort_values('tweet_pct_pos', ascending = True).loc[:, ['hashtags', 'id_negative', 'id_positive', 'tweet_pct_pos']].head()</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi of"><img src="../Images/4acde96fa9062e8dd3199b10479a843d.png" data-original-src="https://miro.medium.com/v2/resize:fit:680/0*Laow-plDvSmC0Hg9"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h1 id="eb4d" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">情感vs手柄</h1><p id="3d67" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">我们可以对特朗普推文中提到的手柄做同样的事情。正面推文比例最高的句柄。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/9090d3c75d17e4b37acb5061fba251f0.png" data-original-src="https://miro.medium.com/v2/resize:fit:722/0*xxTaDM-4_uXenk2T"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><p id="9614" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">正面推文数量最少的句柄。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/5e646ddc9cb0abbeee1779f7b7d2c44b.png" data-original-src="https://miro.medium.com/v2/resize:fit:718/0*ZLqgW2te8XJihuxM"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">作者图片</figcaption></figure><h1 id="7bd2" class="lu lv it bd lw lx ly lz ma mb mc md me jz mf ka mg kc mh kd mi kf mj kg mk ml bi translated">结论</h1><p id="789f" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">在本文中，我们研究了以下内容:</p><ol class=""><li id="2bb4" class="nf ng it la b lb lc le lf lh nh ll ni lp nj lt nk nl nm nn bi translated">使用来自拥抱脸的预训练模型来获得情绪极性，并在特朗普总统的推文中评分</li><li id="f12c" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">创建单词云来可视化不同时间的高频单词</li><li id="2a33" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">转发和收藏如何基于情感极性而有所不同</li><li id="dea0" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">如何在推特上发布一天或一周的情绪变化</li><li id="b92c" class="nf ng it la b lb no le np lh nq ll nr lp ns lt nk nl nm nn bi translated">与不同标签和句柄相关联的Tweet情感</li></ol><p id="c53a" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">包含代码的Kaggle笔记本可以在这里找到:</p><ul class=""><li id="6cbb" class="nf ng it la b lb lc le lf lh nh ll ni lp nj lt oi nl nm nn bi translated"><a class="ae oj" href="https://www.kaggle.com/edwintyh/donald-trump-s-tweets-sentiment-analysis-model" rel="noopener ugc nofollow" target="_blank">第一部分:使用预训练模型的情感分析推断</a></li><li id="37b1" class="nf ng it la b lb no le np lh nq ll nr lp ns lt oi nl nm nn bi translated"><a class="ae oj" href="https://www.kaggle.com/edwintyh/donald-trump-s-tweets-sentiment-analysis" rel="noopener ugc nofollow" target="_blank">第二部分:川普推文的数据分析</a></li></ul></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><ul class=""><li id="0a4f" class="nf ng it la b lb lc le lf lh nh ll ni lp nj lt oi nl nm nn bi translated"><a class="ae oj" href="https://medium.com/@edwin.tan/membership" rel="noopener">加入灵媒</a>阅读更多这样的故事</li><li id="17ba" class="nf ng it la b lb no le np lh nq ll nr lp ns lt oi nl nm nn bi translated">关注我获取更多类似的帖子</li></ul></div><div class="ab cl ok ol hx om" role="separator"><span class="on bw bk oo op oq"/><span class="on bw bk oo op oq"/><span class="on bw bk oo op"/></div><div class="im in io ip iq"><h1 id="8882" class="lu lv it bd lw lx or lz ma mb os md me jz ot ka mg kc ou kd mi kf ov kg mk ml bi translated">参考</h1><p id="45f0" class="pw-post-body-paragraph ky kz it la b lb mm ju ld le mn jx lg lh mo lj lk ll mp ln lo lp mq lr ls lt im bi translated">[1]数据来自<a class="ae oj" href="https://www.thetrumparchive.com/" rel="noopener ugc nofollow" target="_blank">唐纳德·特朗普的推特档案</a>，经许可使用。</p><p id="fd11" class="pw-post-body-paragraph ky kz it la b lb lc ju ld le lf jx lg lh li lj lk ll lm ln lo lp lq lr ls lt im bi translated">[2]“不仅仅是一种感觉:情绪分析准确性的基准”，作者:Heitmann，Mark和Siebert，Christian和Hartmann，Jochen和Schamp，Christina。</p></div></div>    
</body>
</html>