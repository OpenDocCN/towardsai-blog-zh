<html>
<head>
<title>How to use Huggingface Datasets? A Guide to Features like Streaming, Metrics, Map, Concatenate,…</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Huggingface数据集？流、指标、地图、连接等功能指南</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/natural-language-processing-6495c10a85cb?source=collection_archive---------1-----------------------#2022-02-24">https://pub.towardsai.net/natural-language-processing-6495c10a85cb?source=collection_archive---------1-----------------------#2022-02-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="6a78" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/nlp" rel="noopener ugc nofollow" target="_blank">自然语言处理</a></h2><div class=""/><p id="0c5e" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><em class="kx">一个方便的库，可以加载数据集，轻松操作它们，并使用众所周知的指标实现来评估您的结果。</em></p><figure class="kz la lb lc gt ld gh gi paragraph-image"><div role="button" tabindex="0" class="le lf di lg bf lh"><div class="gh gi ky"><img src="../Images/3ac838e4620317b6ba9721f57ff9a07c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fKWvVdCAgkeqXZP0UJDPbA.png"/></div></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">图一。来自Huggingface数据集中心的屏幕截图显示了预览功能。</figcaption></figure><p id="ffe9" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">我使用Huggingface数据集库已经有一段时间了。不打算说谎，鉴于我使用其他库的内置数据集加载功能的经验，我起初持怀疑态度，但Huggingface做了一项顶级的工作。它提供了广泛的功能，让您可以轻松地加载大型数据集，操作它们，并评估您的工作。让我们仔细看看我在实验中发现有用的一些提到的要点。</p></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><h1 id="cd1e" class="lw lx it bd ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt bi translated">加载数据集</h1><p id="cd85" class="pw-post-body-paragraph jz ka it kb b kc mu ke kf kg mv ki kj kk mw km kn ko mx kq kr ks my ku kv kw im bi translated">第一步是展示如何加载数据集，以及是什么让这个库变得强大。<code class="fe mz na nb nc b">load_dataset()</code>函数负责几乎所有的事情。您可以使用它从Hub下载数据集，选择加载哪个分割(训练、验证、测试集)，甚至加载自定义数据集。以下代码演示了加载CNN/DailyMail [1]数据集的不同方式。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">代码1。加载CNN/DM数据集。</figcaption></figure><p id="f3f4" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated"><code class="fe mz na nb nc b">split</code>参数给你加载不同数据集组合的自由。例如，通过使用“+”像<code class="fe mz na nb nc b">train+validation</code>一样连接两个集合，或者像<code class="fe mz na nb nc b">train[:10%]</code>一样加载一定百分比的数据。阅读<a class="ae lo" href="https://huggingface.co/docs/datasets/loading.html#slice-splits" rel="noopener ugc nofollow" target="_blank">文档</a>查看所有选项及示例。</p><h2 id="84e8" class="nf lx it bd ly ng nh dn mc ni nj dp mg kk nk nl mk ko nm nn mo ks no np ms iz bi translated">数据集中心</h2><p id="c5ad" class="pw-post-body-paragraph jz ka it kb b kc mu ke kf kg mv ki kj kk mw km kn ko mx kq kr ks my ku kv kw im bi translated">可以使用相同的<code class="fe mz na nb nc b">load_dataset</code>函数从<a class="ae lo" href="https://huggingface.co/docs/datasets/loading.html#csv" rel="noopener ugc nofollow" target="_blank"> CSV </a>、<a class="ae lo" href="https://huggingface.co/docs/datasets/loading.html#json" rel="noopener ugc nofollow" target="_blank"> JSON </a>，甚至<a class="ae lo" href="https://huggingface.co/docs/datasets/loading.html#text-files" rel="noopener ugc nofollow" target="_blank">文本</a>文件中加载数据。但是强烈建议搜索<a class="ae lo" href="https://huggingface.co/datasets" rel="noopener ugc nofollow" target="_blank">中枢</a>，除非是自定义数据集。您可以按特定任务、大小、语言和许可证进行过滤。只需从顶部复制数据集的名称，并将其传递给<code class="fe mz na nb nc b">path</code>参数。此外，预览部分(图1)允许您在加载数据集之前查看一些示例和功能。</p><h1 id="6492" class="lw lx it bd ly lz nq mb mc md nr mf mg mh ns mj mk ml nt mn mo mp nu mr ms mt bi translated">有用的功能</h1><h2 id="354c" class="nf lx it bd ly ng nh dn mc ni nj dp mg kk nk nl mk ko nm nn mo ks no np ms iz bi translated">1.<a class="ae lo" href="https://huggingface.co/docs/datasets/stream.html" rel="noopener ugc nofollow" target="_blank">流</a></h2><p id="3867" class="pw-post-body-paragraph jz ka it kb b kc mu ke kf kg mv ki kj kk mw km kn ko mx kq kr ks my ku kv kw im bi translated">训练最先进的模型通常需要大量数据。它甚至可以达到万亿字节！这甚至连下载数据集都有问题，更不用说将其加载到内存中了。该库通过设置<code class="fe mz na nb nc b">Stream=True</code>返回一个迭代对象，该选项将使您能够立即批量处理数据集，而不是等待下载过程完成。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">代码2。使用流选项。</figcaption></figure><h2 id="a9d7" class="nf lx it bd ly ng nh dn mc ni nj dp mg kk nk nl mk ko nm nn mo ks no np ms iz bi translated">2.<a class="ae lo" href="https://huggingface.co/metrics" rel="noopener ugc nofollow" target="_blank">加载流行指标</a></h2><p id="13a9" class="pw-post-body-paragraph jz ka it kb b kc mu ke kf kg mv ki kj kk mw km kn ko mx kq kr ks my ku kv kw im bi translated">你将有机会获得一些著名的自然语言处理(NLP)分数，如BLEU，ROUGE，BERTScore等。请记住，有些指标可能需要您安装额外的包，但是说明很清楚，很容易理解。比如想用胭脂分就需要安装<code class="fe mz na nb nc b">rouge_score</code>包。当您第一次尝试导入软件包时，会收到一个关于如何安装软件包的错误说明。下面的代码演示了如何使用<code class="fe mz na nb nc b">load_metric()</code>函数。(<a class="ae lo" href="https://huggingface.co/metrics" rel="noopener ugc nofollow" target="_blank">可用指标列表</a>)</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">代码4。使用度量计算胭脂分数。</figcaption></figure><h2 id="05a0" class="nf lx it bd ly ng nh dn mc ni nj dp mg kk nk nl mk ko nm nn mo ks no np ms iz bi translated">3.<a class="ae lo" href="https://huggingface.co/docs/datasets/package_reference/main_classes.html?highlight=map#datasets.Dataset.map" rel="noopener ugc nofollow" target="_blank">测绘</a></h2><p id="f549" class="pw-post-body-paragraph jz ka it kb b kc mu ke kf kg mv ki kj kk mw km kn ko mx kq kr ks my ku kv kw im bi translated">显而易见，您可以使用<code class="fe mz na nb nc b">.map()</code>将函数应用于数据集。通过使用它的批处理实现，这是一个加速数据操作的好工具。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">代码4。使用map函数的示例代码</figcaption></figure><p id="504f" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">使用map函数的一个很好的例子是标记化过程，因为如果成批处理，它会快得多。上面的代码将把<code class="fe mz na nb nc b">tokenize()</code>函数映射到数据集，并将文章(输入)和突出显示(输出)标记化。它还将数据存储在4个名为<code class="fe mz na nb nc b">input_ids, attention_mask, labels, decoder_attention_mask</code>的新列中，模型将在训练过程中使用这些数据。映射功能也可以删除不必要的列。</p><h2 id="449a" class="nf lx it bd ly ng nh dn mc ni nj dp mg kk nk nl mk ko nm nn mo ks no np ms iz bi translated">4.连接多个数据集</h2><p id="a531" class="pw-post-body-paragraph jz ka it kb b kc mu ke kf kg mv ki kj kk mw km kn ko mx kq kr ks my ku kv kw im bi translated">众所周知，使用更多的数据可能会提高模型的性能。<code class="fe mz na nb nc b">concatenate_datasets()</code>函数将会做它所说的事情。我们应该确保两个数据集具有相同的列数、相同的名称和相同的顺序。在下面的示例代码中，我将合并CNN/DailyMail和XSum数据集。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">代码5。连接CNN/DailyMail和XSum数据集。</figcaption></figure><h2 id="68c4" class="nf lx it bd ly ng nh dn mc ni nj dp mg kk nk nl mk ko nm nn mo ks no np ms iz bi translated">5.添加新列</h2><p id="7bbd" class="pw-post-body-paragraph jz ka it kb b kc mu ke kf kg mv ki kj kk mw km kn ko mx kq kr ks my ku kv kw im bi translated">诚然，向数据集添加新列可能不是一个非常有用的特性，但是我需要在我的一个实验中这样做，并且对<code class="fe mz na nb nc b">add_column()</code>函数的存在感到有点惊讶。您可以传递与数据集具有相同项数的列表。</p><figure class="kz la lb lc gt ld"><div class="bz fp l di"><div class="nd ne l"/></div><figcaption class="lk ll gj gh gi lm ln bd b be z dk translated">代码6。向数据集中添加新列。</figcaption></figure></div><div class="ab cl lp lq hx lr" role="separator"><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu lv"/><span class="ls bw bk lt lu"/></div><div class="im in io ip iq"><p id="72f0" class="pw-post-body-paragraph jz ka it kb b kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku kv kw im bi translated">还值得注意的是，Datasets库不是为了与其他Huggingface库(如Transformers)兼容而构建的。您可以轻松地进行所有您喜欢的操作，并获得PyTorch的DataLoader或Tensorflow的dataset对象以在您的训练/推理循环中使用。查看文档中的<a class="ae lo" href="https://huggingface.co/docs/datasets/torch_tensorflow.html#setting-the-format" rel="noopener ugc nofollow" target="_blank">样本代码</a>。</p><h1 id="f740" class="lw lx it bd ly lz nq mb mc md nr mf mg mh ns mj mk ml nt mn mo mp nu mr ms mt bi translated">最后的话，</h1><p id="fc29" class="pw-post-body-paragraph jz ka it kb b kc mu ke kf kg mv ki kj kk mw km kn ko mx kq kr ks my ku kv kw im bi translated">我可以说，在使用Huggingface的数据集库一段时间后，我感到惊喜。无论使用什么框架，您都可以在现有代码中轻松使用这个库，这一事实使它更加强大。这是Huggingface在他们所有的图书馆里做得很好的事情。</p><blockquote class="nv"><p id="c156" class="nw nx it bd ny nz oa ob oc od oe kw dk translated">我每周给NLP的书呆子发一份时事通讯。如果您想了解自然语言处理的最新发展，可以考虑订阅。<br/> <a class="ae lo" href="https://nlpiation.github.io/" rel="noopener ugc nofollow" target="_blank">阅读更多，订阅</a> —加入酷孩子俱乐部，立即报名！</p></blockquote><p id="694f" class="pw-post-body-paragraph jz ka it kb b kc of ke kf kg og ki kj kk oh km kn ko oi kq kr ks oj ku kv kw im bi translated"><strong class="kb jd">参考文献</strong><br/>【1】<em class="kx">赫尔曼，K. M .，科希斯基，t .，格雷芬斯特特，e .，埃斯佩霍尔特，l .，凯，w .，苏莱曼，m .，&amp;布伦松，P. (2015)。教机器阅读和理解。神经信息处理系统进展，28。</em></p></div></div>    
</body>
</html>