<html>
<head>
<title>What Is timeit Module In Python?</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中的timeit模块是什么？</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/what-is-timeit-module-in-python-7a0adcb551ae?source=collection_archive---------1-----------------------#2022-03-18">https://pub.towardsai.net/what-is-timeit-module-in-python-7a0adcb551ae?source=collection_archive---------1-----------------------#2022-03-18</a></blockquote><div><div class="fc ii ij ik il im"/><div class="in io ip iq ir"><div class=""/></div><div class="ab cl jr js hy jt" role="separator"><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw jx"/><span class="ju bw bk jv jw"/></div><div class="in io ip iq ir"><figure class="jz ka kb kc gu kd gi gj paragraph-image"><div role="button" tabindex="0" class="ke kf di kg bf kh"><div class="gi gj jy"><img src="../Images/04049433c959ed961050acf9be155e80.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6q5gQigrsjJmmYUPbrNurw.jpeg"/></div></div><figcaption class="kk kl gk gi gj km kn bd b be z dk translated">作者图片</figcaption></figure><p id="53da" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated">您可能需要估计代码片段的执行时间。例如，如果您有五种方法在Python中制作列表对象的副本，那么您需要选择一种更快的方法。</p><p id="5a46" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated">你是做什么的？一种方法是使用DateTime模块来捕获任务的开始和结束时间。然后计算两者的差值。然而，这种方法效率不高，因为背景过程会扭曲估计值。那么，有什么有效的方法来估计代码片段的执行时间呢？</p><p id="a8ea" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated">Python <strong class="kq iv"> timeit </strong>模块就是为做这件事而设计的。这对于测量代码片段的执行时间很有用。让我们用一个例子来看看<strong class="kq iv"> timeit </strong>模块是如何工作的。</p><blockquote class="lm ln lo"><p id="787c" class="ko kp lp kq b kr ks kt ku kv kw kx ky lq la lb lc lr le lf lg ls li lj lk ll in bi translated">最初发表于2022年2月2日pythonsimplifed.com<strong class="kq iv"/>。</p></blockquote><h1 id="941f" class="lu lv iu bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">什么是timeit模块？</h1><p id="0e54" class="pw-post-body-paragraph ko kp iu kq b kr ms kt ku kv mt kx ky kz mu lb lc ld mv lf lg lh mw lj lk ll in bi translated"><strong class="kq iv"> timeit </strong>是Python的内置模块，可以用来估计Python代码片段的执行时间。我们在之前的博文中已经使用过几次了。</p><h2 id="171a" class="mx lv iu bd lw my mz dn ma na nb dp me kz nc nd mi ld ne nf mm lh ng nh mq ni bi translated">句法</h2><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="504c" class="mx lv iu nk b gz no np l nq nr">timeit(stmt='pass', <br/>       setup='pass', <br/>       timer=&lt;built-in function perf_counter&gt;, <br/>       number=1000000, <br/>       globals=None)</span></pre><ul class=""><li id="7222" class="ns nt iu kq b kr ks kv kw kz nu ld nv lh nw ll nx ny nz oa bi translated"><strong class="kq iv"> stmt: </strong>它是您想要度量的代码片段。默认值为“通过”</li><li id="bef3" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated"><strong class="kq iv">设置:</strong>在测量时间时，通常是您不想包含在代码片段中的导入语句。</li><li id="ed19" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated"><strong class="kq iv">定时器:</strong>定时器对象，你不用担心，因为它会自动设置。</li><li id="689f" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated"><strong class="kq iv"> number: </strong>想要执行代码片段的次数。默认值为1，000，000。</li><li id="16c4" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated"><strong class="kq iv">全局变量:</strong>您可以传递全局名称空间globals()，以便代码片段可以使用全局名称空间中的所有变量。</li></ul><h2 id="bb69" class="mx lv iu bd lw my mz dn ma na nb dp me kz nc nd mi ld ne nf mm lh ng nh mq ni bi translated">例子</h2><p id="f638" class="pw-post-body-paragraph ko kp iu kq b kr ms kt ku kv mt kx ky kz mu lb lc ld mv lf lg lh mw lj lk ll in bi translated">(1)以下示例使用一行语句作为代码片段。它计算从0到50的所有数字的平方。注意，把0到50的所有数字平方大约一百万次，大约需要16秒。</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="3aa6" class="mx lv iu nk b gz no np l nq nr">&gt;&gt;&gt; import timeit<br/>&gt;&gt;&gt; timeit.timeit(stmt="[i**2 for i in range(50)]")<br/>16.153305899999395</span></pre><p id="9a73" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated">要计算单次运行所需的时间，需要通过1到<strong class="kq iv"> <em class="lp">数</em> </strong>参数或者用16秒除以100万。</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="2d20" class="mx lv iu nk b gz no np l nq nr">&gt;&gt;&gt; timeit(stmt="[i**2 for i in range(50)]", number=1)<br/>0.00003070000093430281</span></pre><p id="980b" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated">(2)请注意，<strong class="kq iv"> timeit </strong>模块在它自己的名称空间中运行。在下面的例子中，我们试图使用math模块找到从0到50的所有数字的平方根，math模块被导入到主作用域中。由于数学模块没有被导入到<strong class="kq iv"> timeit </strong>区，下面的代码将导致一个<code class="fe og oh oi nk b">NameError. The name `math’is not defined</code>。</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="31bd" class="mx lv iu nk b gz no np l nq nr">import math<br/>import timeit</span><span id="1591" class="mx lv iu nk b gz oj np l nq nr">code = """<br/>squares = [math.sqrt(i) for i in range(50)]<br/>"""</span><span id="5084" class="mx lv iu nk b gz oj np l nq nr">timeit.timeit(stmt=stmt)</span></pre><p id="1bc3" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated">如何解决这个问题？当然，你也可以包含<strong class="kq iv"> <em class="lp">【导入数学】</em> </strong>作为你代码片段的一部分。但是，您可能不希望将它包括在内，因为您只想估计在不使用import语句的情况下生成从0到50的所有数字的平方根的代码的执行情况。有两个选项:<strong class="kq iv"> a)设置</strong>和<strong class="kq iv"> b)全局</strong>参数。</p><p id="c5b4" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated"><strong class="kq iv"> <em class="lp"> a)设置参数:</em> </strong>可以通过<strong class="kq iv">设置</strong>参数传递导入语句。setup参数中的语句只执行一次，不是代码段的一部分。</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="96c5" class="mx lv iu nk b gz no np l nq nr">&gt;&gt;&gt; import timeit</span><span id="f190" class="mx lv iu nk b gz oj np l nq nr">&gt;&gt;&gt; code = """<br/>... squares = [math.sqrt(i) for i in range(50)]<br/>... """</span><span id="5011" class="mx lv iu nk b gz oj np l nq nr">&gt;&gt;&gt; timeit.timeit(stmt=code, setup='import math')<br/>10.895839600000272</span></pre><p id="d568" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated"><strong class="kq iv"><em class="lp">b)globals参数:</em></strong>globals()是内置函数，返回属于全局模块的所有对象。如果通过将globals()传递给globals参数在全局范围内导入了math模块，则代码段可以使用import math。</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="b05a" class="mx lv iu nk b gz no np l nq nr">&gt;&gt;&gt; import math<br/>&gt;&gt;&gt; import timeit</span><span id="b557" class="mx lv iu nk b gz oj np l nq nr">&gt;&gt;&gt; code = """<br/>... squares = [math.sqrt(i) for i in range(50)]<br/>... """</span><span id="1605" class="mx lv iu nk b gz oj np l nq nr">&gt;&gt;&gt; timeit.timeit(stmt=code, globals=globals())<br/>10.318579799999952</span></pre><p id="d096" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated">希望你现在了解了<strong class="kq iv"> timeit </strong>方法的所有参数，主要是<strong class="kq iv"> <em class="lp">设置</em> </strong>和<strong class="kq iv"> <em class="lp">全局</em> </strong>参数。让我们看看<strong class="kq iv"> timeit </strong>模块中其他可用的重要方法。</p><h2 id="90ed" class="mx lv iu bd lw my mz dn ma na nb dp me kz nc nd mi ld ne nf mm lh ng nh mq ni bi translated">timeit模块上可用的方法</h2><p id="5d48" class="pw-post-body-paragraph ko kp iu kq b kr ms kt ku kv mt kx ky kz mu lb lc ld mv lf lg lh mw lj lk ll in bi translated">除了<strong class="kq iv"> timeit() </strong>方法之外，<strong class="kq iv"> timeit </strong>模块中还有两个更重要的方法。</p><p id="f10a" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated"><strong class="kq iv"> timeit.repeat(): </strong>它的工作方式与<strong class="kq iv"><em class="lp">time It . time It()</em></strong><em class="lp"/>几乎相同，主要区别在于它将<strong class="kq iv"><em class="lp">time It . time It()</em></strong>重复n次，作为传递给repeat参数。</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="3697" class="mx lv iu nk b gz no np l nq nr">&gt;&gt;&gt; import timeit</span><span id="143a" class="mx lv iu nk b gz oj np l nq nr">&gt;&gt;&gt; code = """<br/>... squares = [math.sqrt(i) for i in range(50)]<br/>... """</span><span id="11e9" class="mx lv iu nk b gz oj np l nq nr">&gt;&gt;&gt; timeit.repeat(stmt=code, setup='import math', repeat=3)<br/>[10.724541399998998, 9.994093399996927, 10.465739999999641]</span></pre><p id="ae60" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated"><strong class="kq iv">time it . default _ timer():</strong>默认定时器始终是<a class="ae lt" href="https://docs.python.org/3/library/time.html#time.perf_counter" rel="noopener ugc nofollow" target="_blank"> time.perf_counter() </a>。它返回性能计数器的值(以秒为单位)。</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="ef24" class="mx lv iu nk b gz no np l nq nr">&gt;&gt;&gt; import timeit<br/>&gt;&gt;&gt; start_time = timeit.default_timer()<br/>&gt;&gt;&gt; code = """<br/>... squares = [math.sqrt(i) for i in range(50)]<br/>... """<br/>&gt;&gt;&gt; timeit.timeit(stmt=code, setup='import math')<br/>&gt;&gt;&gt; stop_time = timeit.default_timer()<br/>&gt;&gt;&gt; print("The execution time is:", stop_time - start_time)<br/>The execution time is: 10.00125609999668</span></pre><h2 id="f6a0" class="mx lv iu bd lw my mz dn ma na nb dp me kz nc nd mi ld ne nf mm lh ng nh mq ni bi translated">命令行界面</h2><p id="f8e7" class="pw-post-body-paragraph ko kp iu kq b kr ms kt ku kv mt kx ky kz mu lb lc ld mv lf lg lh mw lj lk ll in bi translated"><strong class="kq iv"> timeit </strong>模块还提供了使用命令行界面的选项。命令行界面的语法如下所示-</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="7150" class="mx lv iu nk b gz no np l nq nr">python -m timeit [-n N] [-r N] [-u U] [-s S] [-h] [statement ...]</span></pre><ul class=""><li id="fcf7" class="ns nt iu kq b kr ks kv kw kz nu ld nv lh nw ll nx ny nz oa bi translated">-n N:要执行代码片段的次数</li><li id="cf3e" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated">-r N:希望timeit()函数重复的次数</li><li id="3615" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated">-u U:定时器输出的时间单位；可以选择毫秒、秒等。</li><li id="da9e" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated">-s S:将在代码执行之前执行的安装详细信息</li><li id="3f5f" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated">-h:求助</li><li id="ad37" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated">语句:代码段。</li></ul><p id="18c7" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated"><strong class="kq iv">一个使用命令行界面的例子:</strong>下面的例子估计了使用命令行界面计算0-50之间所有整数的平方所花费的时间。</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="7871" class="mx lv iu nk b gz no np l nq nr">&gt;&gt;&gt; (base) C:\Users\swath&gt;python -m timeit -n 1000000 "[i**2 for i in range(50)]"<br/>1000000 loops, best of 5: 16.2 usec per loop</span></pre><h2 id="20e2" class="mx lv iu bd lw my mz dn ma na nb dp me kz nc nd mi ld ne nf mm lh ng nh mq ni bi translated">Python中的%time和%%timeit是什么？</h2><p id="1ca8" class="pw-post-body-paragraph ko kp iu kq b kr ms kt ku kv mt kx ky kz mu lb lc ld mv lf lg lh mw lj lk ll in bi translated">对于Jupyter笔记本用户来说，<strong class="kq iv"> %timeit </strong>和<strong class="kq iv"> %%timeit </strong>是对代码片段计时的两个流行命令。使用这些神奇方法的一个好处是，你不必导入<strong class="kq iv"> timeit </strong>模块，因为它会在后台完成。</p><p id="9e7a" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated"><strong class="kq iv"> %time: </strong>行魔命令为单行语句代码跟随该命令。</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="1173" class="mx lv iu nk b gz no np l nq nr">%timeit squares = [i**2 for i in range(50)]</span></pre><p id="c86f" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated">输出:</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="4482" class="mx lv iu nk b gz no np l nq nr">15.3 µs ± 767 ns per loop (mean ± std. dev. of 7 runs, 10000 loops each)</span></pre><p id="76c2" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated"><strong class="kq iv"> %%timeit: </strong>覆盖Jupyter笔记本一个单元格的多行代码的单元格魔术命令。</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="000c" class="mx lv iu nk b gz no np l nq nr">%%timeit<br/>sq = []<br/>cu = []<br/>for i in range(1, 51):<br/>    sq.append(i**2)<br/>    cu.append(i**3)</span></pre><p id="58e0" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated">输出:</p><pre class="jz ka kb kc gu nj nk nl nm aw nn bi"><span id="0125" class="mx lv iu nk b gz no np l nq nr">37.4 µs ± 1.09 µs per loop (mean ± std. dev. of 7 runs, 10000 loops each)</span></pre><h1 id="3a4b" class="lu lv iu bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">结论</h1><p id="fd28" class="pw-post-body-paragraph ko kp iu kq b kr ms kt ku kv mt kx ky kz mu lb lc ld mv lf lg lh mw lj lk ll in bi translated">在本文中，您已经理解了Python中的<strong class="kq iv"> timeit </strong>模块，以及如何使用它通过示例为代码片段计时。我们已经介绍了使用<strong class="kq iv"> timeit </strong>模块的Python接口和命令行接口。此外，我们还介绍了Jupyter笔记本中流行的用于计时代码片段的<strong class="kq iv"> %timeit </strong>和<strong class="kq iv"> %%timeit </strong>魔法函数。</p><h1 id="bc9f" class="lu lv iu bd lw lx ly lz ma mb mc md me mf mg mh mi mj mk ml mm mn mo mp mq mr bi translated">进一步阅读</h1><ul class=""><li id="fead" class="ns nt iu kq b kr ms kv mt kz ok ld ol lh om ll nx ny nz oa bi translated"><a class="ae lt" rel="noopener ugc nofollow" target="_blank" href="/the-difference-between-a-a-b-and-a-b-in-python-a7338d96e408">Python中a=a+b和a+=b的区别</a></li><li id="506a" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated"><a class="ae lt" href="https://pythonsimplified.com/generate-fake-data-using-faker-and-python/" rel="noopener ugc nofollow" target="_blank">用Faker和Python生成假数据</a></li><li id="1454" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated"><a class="ae lt" href="https://pythonsimplified.com/difference-between-sort-and-sorted-in-python/" rel="noopener ugc nofollow" target="_blank">Python中sort()和sorted()的区别</a></li><li id="4e6d" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated"><a class="ae lt" href="https://pythonsimplified.com/the-most-controversial-python-walrus-operator/" rel="noopener ugc nofollow" target="_blank">最有争议的Python的海象算子</a></li><li id="1301" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated"><a class="ae lt" href="https://pythonsimplified.com/understanding-indexing-and-slicing-in-python/" rel="noopener ugc nofollow" target="_blank">了解Python中的索引和切片</a></li><li id="54cb" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated"><a class="ae lt" href="https://pythonsimplified.com/making-sense-of-python-iterables-and-iterators/" rel="noopener ugc nofollow" target="_blank">理解Python中的可迭代项和迭代器</a></li><li id="9266" class="ns nt iu kq b kr ob kv oc kz od ld oe lh of ll nx ny nz oa bi translated"><a class="ae lt" href="https://pythonsimplified.com/understanding-generators-in-python/" rel="noopener ugc nofollow" target="_blank">理解Python中的生成器</a></li></ul><p id="ec1a" class="pw-post-body-paragraph ko kp iu kq b kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ll in bi translated">我希望你喜欢阅读这篇文章。如果你喜欢我的文章并想订阅Medium，你可以在这里订阅:</p><div class="on oo gq gs op oq"><a href="https://chetanambi.medium.com/membership" rel="noopener follow" target="_blank"><div class="or ab fp"><div class="os ab ot cl cj ou"><h2 class="bd iv gz z fq ov fs ft ow fv fx it bi translated">通过我的推荐链接加入媒体- Chetan Ambi</h2><div class="ox l"><h3 class="bd b gz z fq ov fs ft ow fv fx dk translated">作为一个媒体会员，你的会员费的一部分会给你阅读的作家，你可以完全接触到每一个故事…</h3></div><div class="oy l"><p class="bd b dl z fq ov fs ft ow fv fx dk translated">chetanambi.medium.com</p></div></div><div class="oz l"><div class="pa l pb pc pd oz pe ki oq"/></div></div></a></div></div></div>    
</body>
</html>