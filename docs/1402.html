<html>
<head>
<title>Tweet Topic Modeling: Using Twint to Scrape Tweets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">推文主题建模:使用Twint抓取推文</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/tweet-topic-modeling-using-twint-to-scrape-tweets-part-1-a9274e5199d2?source=collection_archive---------3-----------------------#2021-01-18">https://pub.towardsai.net/tweet-topic-modeling-using-twint-to-scrape-tweets-part-1-a9274e5199d2?source=collection_archive---------3-----------------------#2021-01-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="91b7" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/web-scraping" rel="noopener ugc nofollow" target="_blank">网页抓取</a>，<a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="d0b0" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">这是一个多部分的系列，展示了如何为任何tweets集合收集、预处理、应用和可视化短文本主题建模</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi kr"><img src="../Images/8dffe7a9481d6311a622427075d1202f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*uiwNL8ReWla6rnergTHucg.jpeg"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">拥有健康专用Twitter账户的主要新闻来源(<em class="ld">作者图片</em>)</figcaption></figure><p id="38a5" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated"><strong class="lg jd"> <em class="ma">免责声明:</em> </strong> <em class="ma">本文仅出于教育目的。我们不鼓励任何人抓取网站，尤其是那些可能有条款和条件反对此类行为的网站。</em></p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="10ec" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated">介绍</h1><p id="ec8d" class="pw-post-body-paragraph le lf it lg b lh na kd lj lk nb kg lm ln nc lp lq lr nd lt lu lv ne lx ly lz im bi translated">主题建模是一种无监督的机器学习方法，目标是找到文本文档集合(语料库)中的“隐藏”主题(或聚类)。它真正的优势在于，你不需要带标签或带注释的数据，而是只接受原始文本数据作为输入，这也是它不受监督的原因。换句话说，模型在看到数据时并不知道主题是什么，而是使用所有文档中单词之间的统计关系来生成它们。</p><p id="35c2" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">最流行的主题建模方法之一是<strong class="lg jd">潜在狄利克雷分配(LDA) </strong>，这是一种生成概率模型算法，揭示了管理文档语义的潜在变量，这些变量代表抽象主题。LDA(以及一般的主题建模)的典型应用是将其应用于一组新闻文章，以识别共同的主题或话题，如科学、政治、金融等。然而，LDA的一个缺点是它不能很好地处理较短的文本，如<strong class="lg jd"> tweets。</strong>这是最近的<strong class="lg jd">短文本主题建模(STTM) </strong>的方法，其中一些建立在LDA之上，派上用场并且表现更好！</p><p id="595a" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">这一系列帖子旨在展示和解释如何使用Python来执行和应用特定的STTM方法(<strong class="lg jd">Gibbs Sampling Dirichlet Mixture Model</strong>或<strong class="lg jd"> GSDMM </strong>)来处理Twitter上的健康推文。它将是数据搜集/清理、编程、数据可视化和机器学习的结合。我将在接下来的4篇文章中依次讨论所有主题:</p><blockquote class="nf ng nh"><p id="a92d" class="le lf ma lg b lh li kd lj lk ll kg lm ni lo lp lq nj ls lt lu nk lw lx ly lz im bi translated"><strong class="lg jd"> <em class="it">第一部分:从Twitter中抓取推文</em> </strong></p></blockquote><p id="5ea8" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated"><a class="ae nl" href="https://medium.com/towards-artificial-intelligence/tweet-topic-modeling-part-2-cleaning-and-preprocessing-tweets-e3a08a8b1770" rel="noopener"> <em class="ma">第二部分:清理和预处理推文</em> </a></p><p id="cce5" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated"><a class="ae nl" href="https://medium.com/towards-artificial-intelligence/tweet-topic-modeling-part-3-using-short-text-topic-modeling-on-tweets-bc969a827fef" rel="noopener"> <em class="ma">第三部分:应用短文本主题建模</em> </a></p><p id="75a1" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated"><a class="ae nl" href="https://medium.com/towards-artificial-intelligence/tweet-topic-modeling-part-4-visualizing-topic-modeling-results-with-plotly-66d5dbaaf7fb" rel="noopener"> <em class="ma">第四部分:可视化主题建模结果</em> </a></p><p id="6538" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">这些文章不会深入到LDA或STTM的细节，而是解释他们的直觉和需要知道的关键概念。鼓励有兴趣对LDA有更透彻的统计理解的读者查看这些伟大的资源<a class="ae nl" href="http://www.cs.columbia.edu/~blei/papers/Blei2012.pdf" rel="noopener ugc nofollow" target="_blank"> <strong class="lg jd">这里</strong> </a>和<a class="ae nl" href="https://ldabook.com/index.html" rel="noopener ugc nofollow" target="_blank"> <strong class="lg jd">这里</strong> </a>。</p><p id="ebb2" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">作为先决条件，确保你的电脑上安装了<a class="ae nl" href="https://jupyter.readthedocs.io/en/latest/install.html" rel="noopener ugc nofollow" target="_blank"> Jupyter Notebook </a>、<a class="ae nl" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python </a>、&amp;、<a class="ae nl" href="https://git-scm.com/downloads" rel="noopener ugc nofollow" target="_blank"> Git </a>。</p><p id="057c" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">好了，我们开始吧！</p></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><h1 id="aad1" class="mi mj it bd mk ml mm mn mo mp mq mr ms ki mt kj mu kl mv km mw ko mx kp my mz bi translated"><strong class="ak">第1部分:</strong>使用Twint从Twitter中抓取推文</h1><p id="4bfb" class="pw-post-body-paragraph le lf it lg b lh na kd lj lk nb kg lm ln nc lp lq lr nd lt lu lv ne lx ly lz im bi translated">任何机器学习或数据分析任务最重要的第一步是获得所需的数据。</p><p id="ec74" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">在本次演示(以及后续文章)中，我们将浏览一个例子，该例子使用了2014年1月至2020年3月之间的推文，这些推文是从各种特定于健康的新闻Twitter帐户(如CNN、福克斯新闻频道、BBC、哈佛等)中收集的。<em class="ma">该数据集的灵感来自2020年冠状病毒健康疫情；其动机是探索和理解各种新闻来源和时间的任何趋势和/或差异。另外，你可以选择抓取任何你喜欢的tweet域名，因为这个指南是为任何场景设计的，这就是整个过程的美妙之处！</em></p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi kr"><img src="../Images/8dffe7a9481d6311a622427075d1202f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1218/format:webp/1*uiwNL8ReWla6rnergTHucg.jpeg"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">拥有特定健康推特账户的主要新闻来源(图片由作者提供)</figcaption></figure><p id="7d29" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated"><em class="ma">更进一步——如果你已经有了自己的tweet数据集(或者坦率地说任何文本数据集)，你可能想跳过这个系列的这一部分，直接进入</em> <a class="ae nl" href="https://medium.com/towards-artificial-intelligence/tweet-topic-modeling-part-2-cleaning-and-preprocessing-tweets-e3a08a8b1770" rel="noopener"> <em class="ma">第二部分</em> </a> <em class="ma">开始建模的数据处理。</em></p><h2 id="6283" class="nm mj it bd mk nn no dn mo np nq dp ms ln nr ns mu lr nt nu mw lv nv nw my iz bi translated"><strong class="ak">安装和使用Twint </strong></h2><p id="2be1" class="pw-post-body-paragraph le lf it lg b lh na kd lj lk nb kg lm ln nc lp lq lr nd lt lu lv ne lx ly lz im bi translated">Twint是一个用Python编写的高级Twitter抓取工具，允许在不使用Twitter API的情况下从Twitter帐户中抓取tweets。要了解使用Twint的更多好处，请查看下面有用的Github。</p><div class="nx ny gp gr nz oa"><a href="https://github.com/twintproject/twint" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jd gy z fp of fr fs og fu fw jc bi translated">twintproject/twint</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">没有认证。没有API。没有限制。Twint是一个用Python编写的高级Twitter抓取工具，它允许…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo kx oa"/></div></div></a></div><p id="7e36" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">首先，我们必须确保安装了Twint。您可以通过在终端中运行以下任一命令来实现这一点。</p><pre class="ks kt ku kv gt op oq or os aw ot bi"><span id="6abc" class="nm mj it oq b gy ou ov l ow ox">pip3 install twint</span></pre><p id="a320" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">如果使用PIP，请确保您拥有最新版本的Twint(自2020年12月起为2.1.21 ),因为它可能不会总是获取最新版本。如果为了解决以前的错误而进行了更新，这可能会导致抓取工具出现问题。如果是这种情况，最好使用下面的命令克隆并安装存储库。</p><pre class="ks kt ku kv gt op oq or os aw ot bi"><span id="4fe7" class="nm mj it oq b gy ou ov l ow ox">git clone --depth=1 <a class="ae nl" href="https://github.com/twintproject/twint.git" rel="noopener ugc nofollow" target="_blank">https://github.com/twintproject/twint.git</a><br/>cd twint<br/>pip3 install . -r requirements.txt</span></pre><h2 id="8201" class="nm mj it bd mk nn no dn mo np nq dp ms ln nr ns mu lr nt nu mw lv nv nw my iz bi translated"><strong class="ak">创建刮刀程序</strong></h2><p id="2e64" class="pw-post-body-paragraph le lf it lg b lh na kd lj lk nb kg lm ln nc lp lq lr nd lt lu lv ne lx ly lz im bi translated">首先，让我们导入我们需要的内容，并创建一个我们想从Twitter上收集的活跃用户帐户列表。</p><pre class="ks kt ku kv gt op oq or os aw ot bi"><span id="9cc7" class="nm mj it oq b gy ou ov l ow ox">import twint<br/>import time<br/>import pandas as pd</span><span id="428e" class="nm mj it oq b gy oy ov l ow ox">twitter_user_handles = <br/>['bbchealth', 'foxnewshealth','GdnHealthcare',  'KHNews', 'latimeshealth', 'NBCNewshealth', 'NPRHealth', 'NYTHealth', 'Reuters_Health', 'USNewsHealth', 'WSJHealth', 'TIMEHealth', 'HarvardHealth']</span></pre><p id="d3c8" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">为了创建负责抓取的程序，我们需要使用<code class="fe oz pa pb oq b">twint.Config()</code>初始化Twint配置，并定义我们想要抓取的任何配置参数。这包括配置搜索的用户句柄、日期范围、数据输出、语言、最大记录等。这里，我们将遍历所有用户，并将结果记录存储到一个数据框中。<em class="ma">注意:根据你将要抓取的潜在推文数量，你可能偶尔会收到一个错误或者无法一次抓取所有内容，因为Twitter有时会限制大量的数据请求。在这种情况下，您可能需要在日期范围内进行小批量处理，然后再将它们合并。</em></p><pre class="ks kt ku kv gt op oq or os aw ot bi"><span id="685a" class="nm mj it oq b gy ou ov l ow ox"># loop through each account using same configuration <br/>for username in twitter_user_handles:<br/> c = twint.Config()<br/> c.Lang = "en"<br/> c.Username = username<br/> c.Since = '2014-01-01'<br/> c.Until = '2020-03-28'<br/> c.Pandas = True<br/> c.Store_pandas = True<br/> c.Pandas_au = True<br/> c.Pandas_clean = False<br/> twint.run.Search(c)</span><span id="03db" class="nm mj it oq b gy oy ov l ow ox"># store in data frame<br/>tweets_df= twint.storage.panda.Tweets_df</span></pre><p id="dacd" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated"><code class="fe oz pa pb oq b">c.Store_pandas</code>允许我们将推文保存到熊猫数据框中。将<code class="fe oz pa pb oq b">c.Pandas_au</code> <strong class="lg jd"> </strong>设置为<code class="fe oz pa pb oq b">True</code>允许我们在每次迭代时自动更新数据帧，而将<code class="fe oz pa pb oq b">c.Pandas_clean</code>设置为False可确保每次刮擦时数据帧不会被清除干净。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pc"><img src="../Images/6c1e518dc0eec97f0b0aaa3aa804e487.png" data-original-src="https://miro.medium.com/v2/resize:fit:1280/format:webp/1*DqSunMDsJ0Cw8dJmRJ94jA.jpeg"/></div><figcaption class="kz la gj gh gi lb lc bd b be z dk translated">Twint创建的原始数据框</figcaption></figure><p id="d77d" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">接下来，我们可以将我们的推文保存到csv文件中。</p><pre class="ks kt ku kv gt op oq or os aw ot bi"><span id="e4f5" class="nm mj it oq b gy ou ov l ow ox">tweets_df.to_csv(r’data/health_tweets.csv’, index = False,    <br/>                 header=True)</span></pre><p id="cfe7" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">如前所述，对于较大的数据提取，我们很可能不得不成批抓取。我们可以很容易地将数据合并成一个最终的数据帧和csv格式。</p><pre class="ks kt ku kv gt op oq or os aw ot bi"><span id="36f0" class="nm mj it oq b gy ou ov l ow ox">import glob<br/>import pandas as pd<br/><br/>data_dir = 'data/'           <br/><br/>tweets_df = pd.concat([pd.read_csv(file) for file in  <br/>                      glob.glob(data_dir+'*.csv')],  <br/>                      ignore_index=True)</span><span id="a53d" class="nm mj it oq b gy oy ov l ow ox">tweets_df.to_csv(r’data/health_tweets.csv’, index = False,   <br/>                 header=True)</span></pre><p id="1884" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated">瞧👌—我们成功地收集了推文数据，并将其全部保存在一个csv <a class="ae nl" href="https://github.com/bicachu/short-text-topic-modeling-tutorial/blob/main/data/health_tweets.csv" rel="noopener ugc nofollow" target="_blank">文件</a>中！在我们的<a class="ae nl" href="https://medium.com/towards-artificial-intelligence/tweet-topic-modeling-part-2-cleaning-and-preprocessing-tweets-e3a08a8b1770" rel="noopener">下一部分</a>中，我们将对推文进行预处理，包括应用词汇化，让它们为主题建模和进一步的探索性分析做好准备。</p><p id="5f96" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated"><em class="ma">注意:在以下系列中提供和使用的CSV文件还将包括用户句柄</em> <code class="fe oz pa pb oq b"><em class="ma">cnnhealth</em></code> <em class="ma">的tweets，因为该帐户在抓取时是活动的，但现在不再是了。</em></p><h2 id="7277" class="nm mj it bd mk nn no dn mo np nq dp ms ln nr ns mu lr nt nu mw lv nv nw my iz bi translated">完整的刮刀程序代码</h2><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="pd pe l"/></div></figure></div><div class="ab cl mb mc hx md" role="separator"><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg mh"/><span class="me bw bk mf mg"/></div><div class="im in io ip iq"><div class="ks kt ku kv gt oa"><a rel="noopener  ugc nofollow" target="_blank" href="/tweet-topic-modeling-part-2-cleaning-and-preprocessing-tweets-e3a08a8b1770"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd jd gy z fp of fr fs og fu fw jc bi translated">Tweet主题建模第2部分:清理和预处理tweet</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">这是一个多部分的系列，展示了如何为任何集合抓取、预处理、应用和可视化短文本主题建模…</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">pub.towardsai.net</p></div></div><div class="oj l"><div class="pf l ol om on oj oo kx oa"/></div></div></a></div><p id="6797" class="pw-post-body-paragraph le lf it lg b lh li kd lj lk ll kg lm ln lo lp lq lr ls lt lu lv lw lx ly lz im bi translated"><strong class="lg jd">参考资料和其他有用资源</strong></p><ul class=""><li id="19fc" class="pg ph it lg b lh li lk ll ln pi lr pj lv pk lz pl pm pn po bi translated">LDA上的<a class="ae nl" href="https://ai.stanford.edu/~ang/papers/nips01-lda.pdf" rel="noopener ugc nofollow" target="_blank">原文</a></li><li id="3025" class="pg ph it lg b lh pp lk pq ln pr lr ps lv pt lz pl pm pn po bi translated"><a class="ae nl" href="https://ldabook.com/" rel="noopener ugc nofollow" target="_blank">LDA小册子</a>指南</li><li id="4814" class="pg ph it lg b lh pp lk pq ln pr lr ps lv pt lz pl pm pn po bi translated">关于STTM的<a class="ae nl" href="https://dl.acm.org/doi/10.1145/2623330.2623715" rel="noopener ugc nofollow" target="_blank">原文</a>GSD mm</li><li id="65ee" class="pg ph it lg b lh pp lk pq ln pr lr ps lv pt lz pl pm pn po bi translated">Twint <a class="ae nl" href="https://github.com/twintproject/twint" rel="noopener ugc nofollow" target="_blank"> GitHub </a></li><li id="af6b" class="pg ph it lg b lh pp lk pq ln pr lr ps lv pt lz pl pm pn po bi translated"><a class="ae nl" href="https://github.com/twintproject/twint/wiki/Configuration" rel="noopener ugc nofollow" target="_blank">可在Twint中使用的配置列表</a></li><li id="21c2" class="pg ph it lg b lh pp lk pq ln pr lr ps lv pt lz pl pm pn po bi translated">UCI机器学习知识库— <a class="ae nl" href="https://archive.ics.uci.edu/ml/datasets/Health+News+in+Twitter" rel="noopener ugc nofollow" target="_blank">健康新闻推文数据集</a></li></ul></div></div>    
</body>
</html>