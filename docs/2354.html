<html>
<head>
<title>Facebook Uses Neural Code Search to Find Relevant Code Snippets</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">脸书使用神经代码搜索来寻找相关的代码片段</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/facebook-uses-neural-code-search-to-find-relevant-code-snippets-d89eaa79624c?source=collection_archive---------1-----------------------#2021-11-22">https://pub.towardsai.net/facebook-uses-neural-code-search-to-find-relevant-code-snippets-d89eaa79624c?source=collection_archive---------1-----------------------#2021-11-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="125c" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning/deep-learning" rel="noopener ugc nofollow" target="_blank">深度学习</a></h2><div class=""/><div class=""><h2 id="c1fd" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">这是一个深度学习的领域，在过去两年里一直在以疯狂的速度前进。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/4af577879b131cda2bbe5a242a036e31.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bwMTf9C0eq2Pi1arN8cCkg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">来源:<a class="ae lh" href="https://alltopstartups.com/2018/05/25/codepilot-ai-makes-code-search-awesome/" rel="noopener ugc nofollow" target="_blank">https://alltopstartups . com/2018/05/25/code pilot-ai-makes-code-search-awesome/</a></figcaption></figure><blockquote class="li lj lk"><p id="43db" class="ll lm ln lo b lp lq kd lr ls lt kg lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我最近创办了一份专注于人工智能的教育时事通讯，已经有超过10万名订户。《序列》是一份无废话(意思是没有炒作，没有新闻等)的ML导向时事通讯，需要5分钟阅读。目标是让你与机器学习项目、研究论文和概念保持同步。请通过订阅以下内容来尝试一下:</p></blockquote><div class="mi mj gp gr mk ml"><a href="https://thesequence.substack.com/" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">序列</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">订阅人工智能世界中最相关的项目和研究论文。受到102，000多人的信任…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">thesequence.substack.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz lb ml"/></div></div></a></div><p id="bb1d" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">随着OpenAI Codex等模型的发布，代码搜索领域最近得到了很多关注。除了标题之外，重要的是回过头来回顾一些实现这种突破的技术。几年前，脸书人工智能研究所(FAIR)提出了这个领域最具创新性的想法之一。</p><p id="6be8" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">如今，Google和StackOverflow是每个开发者最好的朋友。当在一个特定的项目中工作时，开发人员经常求助于外部信息源来寻找给定问题的解决方案或代码片段。然而，搜索分辨率主要基于元数据，而不是代码本身提供的信息。例如，如果开发人员将代码片段发布到StackOverflow，它通常会包含一个描述和标签，以帮助为将来的搜索建立索引。这种方法依赖于元数据的准确性来呈现准确的搜索结果，但是它也错过了可以直接从代码中推断出来的信息。为了解决这一限制，FAIR实验室的一个团队一直在研究一种方法，使用自然语言处理(NLP)和信息检索(IR)来直接从源代码文本中推断搜索相关信息。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nd"><img src="../Images/826fd4ff175c1b71314f622ffa28138e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Q280ENUhRnDYH_MdowOwvA.png"/></div></div></figure><p id="56b7" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">FAIR团队工作的第一个实例是一个名为神经代码搜索(NCS)的工具，它接受自然语言查询并返回直接从编码语料库推断的结果。最近发表的两篇研究论文总结了NCS背后的技术:</p><ul class=""><li id="c5cc" class="ne nf it lo b lp lq ls lt na ng nb nh nc ni mh nj nk nl nm bi translated"><a class="ae lh" href="https://dl.acm.org/citation.cfm?id=3211353&amp;fbclid=IwAR3qdp2vDXwBuZb7uw2vR1op7SPngnRr0R6l3pxHrvqWH_0Unj0UXtTYpKA" rel="noopener ugc nofollow" target="_blank"> <strong class="lo jd"> NCS </strong> </a> <strong class="lo jd"> : </strong>本文描述了一种使用结合了NLP和IR技术的无监督模型的技术。</li><li id="6a2a" class="ne nf it lo b lp nn ls no na np nb nq nc nr mh nj nk nl nm bi translated"><a class="ae lh" href="https://arxiv.org/pdf/1905.03813.pdf?fbclid=IwAR3_9ejBpho2yNLfMKVCp5rZ58gAD63T_peTg3RQh8tIRLZkYwH9SquLQI8" rel="noopener ugc nofollow" target="_blank"><strong class="lo jd"/></a><strong class="lo jd">:</strong>本文提出了一种NCS的扩展，当有良好的监督数据可供训练时，使用监督神经网络模型来提高性能。</li></ul><p id="7718" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">NCS和UNIF这两种技术背后的原理是相对相似的。这两种方法都依赖于代码片段的矢量表示，这些代码片段可用于训练模型，例如语义相似的代码片段和查询在矢量空间中靠得很近。这种技术能够使用代码片段语料库直接回答自然语言查询，而不依赖于外部元数据。虽然这两种技术(NCS，UNIF)相对相似，但UNIF用一个监督模型扩展了NCS，以创建对NLP查询更准确的答案。</p><h1 id="64ad" class="ns nt it bd nu nv nw nx ny nz oa ob oc ki od kj oe kl of km og ko oh kp oi oj bi translated">无线电网络控制站（Net Control Station的缩写）</h1><p id="f617" class="pw-post-body-paragraph ll lm it lo b lp ok kd lr ls ol kg lu na om lx ly nb on mb mc nc oo mf mg mh im bi translated">这背后的核心原理是使用嵌入从代码语料库中生成向量表示，其方式是相似的代码片段在向量空间中彼此接近。在下面的例子中，有两个不同的方法体，都与关闭或隐藏Android软键盘(上面的第一个问题)有关。由于它们共享相似的语义，即使它们不共享完全相同的代码行，它们也由向量空间中彼此接近的点来表示。NCS使用方法级粒度将每个代码片段嵌入向量空间。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi op"><img src="../Images/d70844d987e1bb6de4625c1d9459a856.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Qfypd9m9O57dYNt6GUodrQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片来源:脸书人工智能研究所</figcaption></figure><p id="dc4e" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">创建矢量表示的过程有三个主要步骤:</p><p id="6800" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">1)提取单词</p><p id="5de1" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">2)构建单词嵌入</p><p id="de75" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">3)构建文档嵌入</p><p id="39bf" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">4)自然语言搜索检索</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi op"><img src="../Images/567a5793bd2fa728cb531b9f34c871ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*UNvVNY05ma0Fv-HPkAAfKw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片来源:脸书人工智能研究所</figcaption></figure><p id="a2c2" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">给定一个特定的代码片段，NCS提取不同的语法部分，比如方法名、方法调用、枚举、字符串和注释。这些工件然后使用标准英语惯例进行标记。对于输入语料库中的每个文档，NCS以能够学习每个单词的嵌入的方式标记源代码。在这一步之后，我们为每个方法体提取的单词列表类似于一个自然语言文档。</p><p id="a5b7" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">在单词提取之后，NCS继续使用<a class="ae lh" href="https://fasttext.cc/" rel="noopener ugc nofollow" target="_blank"> FastText框架</a>构建单词嵌入。在这个过程中，FastText使用两层密集神经网络计算向量表示，该网络可以在大型语料库上进行无监督训练。更具体地说，NCS使用skip-gram模型，其中目标标记的嵌入用于预测固定窗口大小内的上下文标记的嵌入。</p><p id="522b" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">这个阶段的最后一步是使用提取的单词嵌入来表达方法体的一般意图。NCS通过为方法体中的单词集计算单词嵌入向量的加权平均值来实现这一点。这一公式的结果被称为文档嵌入及其用户在正文中创建每个方法的索引，以便进行有效的搜索检索。</p><p id="b5c9" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">使用向量表示作为起点，NCS现在可以尝试回答与代码片段相关的自然语言查询。给定一个自然语言查询，NCS使用FastText框架遵循类似的标记化过程。使用相同的FastText嵌入矩阵，NCS对单词的向量表示进行平均，以创建用于查询句子的文档嵌入；不在词汇表中的单词将被删除。然后，NCS使用标准的相似性搜索算法<a class="ae lh" href="https://github.com/facebookresearch/faiss" rel="noopener ugc nofollow" target="_blank"> FAISS </a>来查找与查询具有最近余弦距离的文档向量。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oq"><img src="../Images/817751fac765f4b009755c74c517bf92.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*2VEYygWZ_sE3_DLs1RJjGA.gif"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片来源:脸书人工智能研究所</figcaption></figure><h1 id="812e" class="ns nt it bd nu nv nw nx ny nz oa ob oc ki od kj oe kl of km og ko oh kp oi oj bi translated">UNIF</h1><p id="ce28" class="pw-post-body-paragraph ll lm it lo b lp ok kd lr ls ol kg lu na om lx ly nb on mb mc nc oo mf mg mh im bi translated">作为一种无监督的技术，NCS的优势在于它可以以快速和简单的方式直接从编码语料库中构建知识。然而，NCS的主要限制之一是，该模型隐含地假设查询中的单词与从源代码中提取的单词来自相同的域，因为查询和代码片段都被映射到相同的向量空间。然而，有大量的例子表明代码语料库没有传达任何相关的语义信息。以下面的代码片段为例，它获取内存空间中的可用块。仅仅通过以无监督的方式生成单词embeddings，NCS将无法匹配相关的查询，例如“获得内部存储器上的空闲空间”。</p><pre class="ks kt ku kv gt or os ot ou aw ov bi"><span id="daf7" class="ow nt it os b gy ox oy l oz pa">File path = Environment.getDataDirectory();<br/>StatFs stat = new StatFs(path.getPath());<br/>long blockSize = stat.getBlockSize();<br/>long availableBlocks = stat.getAvailableBlocks();<br/>return Formatter.formatFileSize(this, availableBlocks * blockSize);</span></pre><p id="9ae0" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">UNIF是对NCS的有监督扩展，它试图弥合自然语言单词和源代码单词之间的差距。本质上，UNIF使用监督学习来修改初始令牌嵌入矩阵T，并产生两个嵌入矩阵Tc和Tq，分别用于代码和查询令牌。我们还用一种基于学习注意力的加权方案取代了编码令牌嵌入的TF-IDF加权。这种扭曲本质上解释了代码语料库中的一些语义不匹配。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi op"><img src="../Images/f8edcd29bc05c4c526aac425c5e0b51d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SnPf28zL_DQJ1VygSKaFDw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片来源:脸书人工智能研究所</figcaption></figure><h1 id="2213" class="ns nt it bd nu nv nw nx ny nz oa ob oc ki od kj oe kl of km og ko oh kp oi oj bi translated">NCS和UNIF在行动</h1><p id="353d" class="pw-post-body-paragraph ll lm it lo b lp ok kd lr ls ol kg lu na om lx ly nb on mb mc nc oo mf mg mh im bi translated">FAIR团队根据最先进的信息检索模型评估NCS和UNIF。使用StackOverflow问题的初始数据集，NCS能够在一系列不同的任务中胜过流行的BM25模型。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi op"><img src="../Images/3a728d01bc9cb86b573074108a68b932.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pyVwLMO4-FFMUCRkZKPEZQ.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片来源:脸书人工智能研究所</figcaption></figure><p id="f199" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">类似地，添加UNIF扩展显示了NCS性能的逐步提高。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi op"><img src="../Images/ebaa7b118a2b3e171abe8a5833486592.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hkjJ7vlTTarNQ_EdLv8cug.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图片来源:脸书人工智能研究所</figcaption></figure><p id="6272" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">NCS和UNIF都提出了一个聪明而简单的实现信息检索的方法。从代码搜索开始是一种提供即时价值的琐碎方式，但是NCS和UNIF背后的思想适用于许多神经搜索和信息检索场景。</p></div></div>    
</body>
</html>