<html>
<head>
<title>How To Do Remote Development With VS Code Using AWS SSM</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用AWS SSM用VS代码做远程开发</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-to-do-remote-development-with-vs-code-using-aws-ssm-415881d249f3?source=collection_archive---------0-----------------------#2020-09-18">https://pub.towardsai.net/how-to-do-remote-development-with-vs-code-using-aws-ssm-415881d249f3?source=collection_archive---------0-----------------------#2020-09-18</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="43ac" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/cloud-computing" rel="noopener ugc nofollow" target="_blank">云计算</a>，<a class="ae ep" href="https://towardsai.net/p/category/software-engineering" rel="noopener ugc nofollow" target="_blank">软件工程</a></h2><div class=""/><div class=""><h2 id="4adf" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">当您的IT部门禁止创建公共EC2实例时</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/e6d2e258b34d0bc25f60b99173f3febb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XfjEvMGS9IEOwgPERqsZRw.png"/></div></div></figure><h1 id="459b" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">介绍</h1><p id="653f" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">在本文中，我将分享一种使用<a class="ae mr" href="https://code.visualstudio.com/" rel="noopener ugc nofollow" target="_blank"> VS代码</a>连接私有EC2实例的方法，即没有公共IP地址的实例。主要思想是使用由<a class="ae mr" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/ssm-agent.html" rel="noopener ugc nofollow" target="_blank"> AWS SSM </a>管理的SSH连接来连接到该实例。</p><p id="7fb5" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">我假设读者对用VS代码编码和在AWS上创建EC2实例有基本的了解。</p><p id="3f1d" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">可以在<a class="ae mr" href="https://github.com/hsm207/vscode_remote_ssm" rel="noopener ugc nofollow" target="_blank">这里</a>找到重现运行AWS命令的环境的代码。</p><p id="e4f7" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">让我们先来理解为什么有人想要将VS代码连接到远程机器上。</p><h1 id="de7d" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">为什么？</h1><p id="98a1" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">从VS代码内部连接到远程EC2实例允许您在该机器上编辑代码，就像在您的本地机器上一样，并享受VS代码附带的所有高级编辑特性和插件。</p><p id="1cda" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">作为一名数据科学家，VS Code对远程开发的支持在以下情况下会派上用场:</p><ol class=""><li id="bfc4" class="mx my it lx b ly ms mb mt me mz mi na mm nb mq nc nd ne nf bi translated">你需要一台强大的机器来快速迭代你的原型。想象在任何计算机视觉任务中使用高分辨率图像。在消费级笔记本电脑上，即使处理少量图像也会非常慢。</li><li id="7dfb" class="mx my it lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">你想要一个新的库或框架，但是它需要安装许多依赖项。在一台短暂的机器上进行试验比安装这些依赖项来搞乱本地机器更方便。</li></ol><h1 id="a294" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">动机</h1><p id="1fd0" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">VS代码通过SSH连接支持<a class="ae mr" href="https://code.visualstudio.com/docs/remote/ssh-tutorial" rel="noopener ugc nofollow" target="_blank">远程开发</a>。这需要创建一个SSH公共/私有密钥对，并且您希望连接的机器有一个公共IP地址。</p><p id="ea4b" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">一些公司有一个策略，禁止创建和存储SSH密钥对和具有公共IP地址的机器，以此来降低安全风险(这有助于减少攻击面)。</p><p id="8643" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">因此，需要寻找从VS代码内部连接到那些远程机器的替代方法。</p><h1 id="6cd4" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">先决条件</h1><p id="4b2f" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">如果您想跟进，您需要设置以下内容:</p><ol class=""><li id="ee65" class="mx my it lx b ly ms mb mt me mz mi na mm nb mq nc nd ne nf bi translated">一个没有公共IP地址的EC2实例，其IAM角色中至少有<strong class="lx jd">amazonsmsmanagedinstancecore</strong>和<strong class="lx jd">amazonsmsmfullaccess</strong>策略。对于<strong class="lx jd">amazonsmsmfullaccess</strong>策略，您实际上只需要运行<strong class="lx jd"> ssm:SendCommand </strong>的权限。</li><li id="ba3a" class="mx my it lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">EC2实例应该运行当前的AMI。在本文中，我使用的是<code class="fe nl nm nn no b">Deep Learning AMI (Ubuntu 18.04) Version 33.0</code> AMI。</li><li id="8122" class="mx my it lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">EC2必须由AWS系统经理管理。这仅仅需要创建几个VPC端点。点击<a class="ae mr" href="https://aws.amazon.com/premiumsupport/knowledge-center/ec2-systems-manager-vpc-endpoints/" rel="noopener ugc nofollow" target="_blank">此处</a>获取如何操作的说明。</li><li id="4bd9" class="mx my it lx b ly ng mb nh me ni mi nj mm nk mq nc nd ne nf bi translated">安装了<a class="ae mr" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html" rel="noopener ugc nofollow" target="_blank">会话管理器插件</a>的当前<a class="ae mr" href="https://docs.aws.amazon.com/cli/latest/userguide/cli-chap-install.html" rel="noopener ugc nofollow" target="_blank"> AWS CLI </a>。</li></ol><h1 id="d949" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">步伐</h1><h2 id="eef5" class="np le it bd lf nq nr dn lj ns nt dp ln me nu nv lp mi nw nx lr mm ny nz lt iz bi translated">步骤1:生成SSH密钥对</h2><p id="ad4c" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">使用<code class="fe nl nm nn no b"><a class="ae mr" href="https://www.ssh.com/ssh/keygen/" rel="noopener ugc nofollow" target="_blank">ssh-keygen</a></code>在本地机器上生成一个SSH密钥对。</p><p id="567b" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">有一种方法可以做到:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/52549dd1287283ab23dc47c4c7e95632.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*HRETn_M_C31h8qL0o9oZ5A.png"/></div></figure><h2 id="46ff" class="np le it bd lf nq nr dn lj ns nt dp ln me nu nv lp mi nw nx lr mm ny nz lt iz bi translated">步骤2:向EC2实例发送公钥</h2><p id="39f2" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">使用SSM的<code class="fe nl nm nn no b">send-command</code>实用程序将上一步生成的公钥包含到EC2实例的<code class="fe nl nm nn no b">authorized_keys</code>文件中:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi ob"><img src="../Images/2686ee7616721b18d5339609d330855c.png" data-original-src="https://miro.medium.com/v2/resize:fit:882/format:webp/1*TwcccAshfOhi6Bx5PMRiDg.png"/></div></figure><p id="8824" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">根据您的设置，您需要修改<code class="fe nl nm nn no b">instance_id</code>和<code class="fe nl nm nn no b">region</code>的值。</p><h2 id="268b" class="np le it bd lf nq nr dn lj ns nt dp ln me nu nv lp mi nw nx lr mm ny nz lt iz bi translated">步骤3:更新SSH配置</h2><p id="aaf1" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">在VS代码中，调用<a class="ae mr" href="https://code.visualstudio.com/docs/getstarted/userinterface#_command-palette" rel="noopener ugc nofollow" target="_blank">命令面板</a>并运行<code class="fe nl nm nn no b">Remote-SSH:Open Configuration File</code>命令打开<code class="fe nl nm nn no b">~/.ssh</code>文件夹中的<code class="fe nl nm nn no b">config</code>文件。</p><p id="d994" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">添加以下几行:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oc"><img src="../Images/ed972e760ff0533f4cab9b669795b5da.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*58UoZ-QrUFYJhuiNu3Gjbw.png"/></div></div></figure><p id="a193" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">前面一行是针对Windows的。点击<a class="ae mr" href="https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-getting-started-enable-ssh-connections.html" rel="noopener ugc nofollow" target="_blank">此处</a>查看Linux/Mac的相应设置。</p><p id="a76f" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">另外，添加以下几行:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi od"><img src="../Images/9fbe248a1b485ceb1147653186d74b74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*BBx61BGRYTNlNCBk4-pP8Q.png"/></div></figure><h2 id="e3d9" class="np le it bd lf nq nr dn lj ns nt dp ln me nu nv lp mi nw nx lr mm ny nz lt iz bi translated">步骤4:连接到EC2实例</h2><p id="9cf5" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">要使用VS代码连接到EC2实例，只需调用命令面板来执行<code class="fe nl nm nn no b">Remote-SSH:Connect to Host</code>命令。</p><p id="30b8" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">当要求选择哪个主机时，选择名称是EC2的实例ID的主机。</p><h1 id="6d71" class="ld le it bd lf lg lh li lj lk ll lm ln ki lo kj lp kl lq km lr ko ls kp lt lu bi translated">结论</h1><p id="38c1" class="pw-post-body-paragraph lv lw it lx b ly lz kd ma mb mc kg md me mf mg mh mi mj mk ml mm mn mo mp mq im bi translated">本文解释了一种通过VS代码连接到私有EC2实例的方法，以便在该实例上进行远程开发。</p><p id="7e71" class="pw-post-body-paragraph lv lw it lx b ly ms kd ma mb mt kg md me mu mg mh mi mv mk ml mm mw mo mp mq im bi translated">我希望你已经发现这是有用的。</p></div></div>    
</body>
</html>