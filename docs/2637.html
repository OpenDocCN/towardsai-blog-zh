<html>
<head>
<title>Seal the Containerized ML Deal With Podman</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">与波德曼达成集装箱化的ML交易</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/seal-the-containerized-ml-deal-with-podman-1741c5d1b870?source=collection_archive---------3-----------------------#2022-03-24">https://pub.towardsai.net/seal-the-containerized-ml-deal-with-podman-1741c5d1b870?source=collection_archive---------3-----------------------#2022-03-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="6bdd" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">带有新“Pods”的电影推荐服务演练</h2></div><p id="5fb1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">作者:<a class="ae le" href="https://www.linkedin.com/in/oscarwang114/" rel="noopener ugc nofollow" target="_blank">芝-王昊</a>(Chih haow)<a class="lf lg ep" href="https://medium.com/u/95808f83f510?source=post_page-----1741c5d1b870--------------------------------" rel="noopener" target="_blank"/>(yung Linc)</p><h1 id="00fc" class="lh li it bd lj lk ll lm ln lo lp lq lr jz ls ka lt kc lu kd lv kf lw kg lx ly bi translated">概观</h1><blockquote class="lz"><p id="67ae" class="ma mb it bd mc md me mf mg mh mi ld dk translated">pod man——下一代Linux容器工具</p></blockquote><p id="ca82" class="pw-post-body-paragraph ki kj it kk b kl mj ju kn ko mk jx kq kr ml kt ku kv mm kx ky kz mn lb lc ld im bi translated">自2013年以来，“容器”的引入为应用程序开发领域带来了新的曙光。十多年来，公司已经接受了容器化的架构，这允许他们将软件打包到标准化的单元(容器)中。软件容器的一些优点是增加的可移植性、执行的低开销、更大的灵活性和更高的部署效率。</p><p id="6386" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然<a class="ae le" href="https://www.docker.com/" rel="noopener ugc nofollow" target="_blank"> docker </a> (2013年)和<a class="ae le" href="https://kubernetes.io/" rel="noopener ugc nofollow" target="_blank"> Kubernetes </a> (2014年)一直是该领域的先驱和领先工具，但在2019年，<a class="ae le" href="https://podman.io/" rel="noopener ugc nofollow" target="_blank"> Podman </a>的诞生将我们带到了集装箱技术的另一个进步。虽然机器学习(ML)模型部署有多种方式，但容器化的ML为我们提供了另一种将模型部署到智能应用程序中的方式。<strong class="kk iu">在这篇文章中，我们将介绍你需要了解的关于Podman的知识，并通过一个简单的演示来实现一个电影推荐器。</strong> <strong class="kk iu">我们开始吧！</strong></p><h1 id="224b" class="lh li it bd lj lk ll lm ln lo lp lq lr jz ls ka lt kc lu kd lv kf lw kg lx ly bi translated">波德曼是什么？</h1><blockquote class="lz"><p id="5299" class="ma mb it bd mc md me mf mg mh mi ld dk translated">一群海豹被称为一个荚</p></blockquote><figure class="mp mq mr ms mt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi mo"><img src="../Images/7ce6d942180b144bd59ba496b2f6d9fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SIgctmLmx883kAS1"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@macgaither?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Mac Gaither </a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="c608" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如<a class="ae le" href="https://docs.podman.io/en/latest/index.html" rel="noopener ugc nofollow" target="_blank">波德曼官网</a>所述:</p><blockquote class="nf ng nh"><p id="4d95" class="ki kj ni kk b kl km ju kn ko kp jx kq nj ks kt ku nk kw kx ky nl la lb lc ld im bi translated">Podman是一个无后台容器引擎，用于在您的Linux系统上开发、管理和运行开放容器倡议(OCI)容器和容器映像。</p></blockquote><p id="9191" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Podman是短期Pod管理工具。它是一个容器引擎，可以处理容器和容器。更具体地说，容器引擎充当媒介，允许用户在容器上创建、构建、运行和维护应用程序。软件容器是将应用程序和代码捆绑在一个地方的软件单元，而pod是部署在同一主机上的一组容器。(类似一窝海豹的概念！)Podman试图通过使软件应用程序可移植、快速和安全来解决软件应用程序部署的问题。<strong class="kk iu">简而言之，Podman是一个开源工具，旨在使使用开放容器倡议(OCI)构建应用程序更加容易。</strong></p><h1 id="f8fc" class="lh li it bd lj lk ll lm ln lo lp lq lr jz ls ka lt kc lu kd lv kf lw kg lx ly bi translated">搬运工vs码头工</h1><div class="nm nn no np gt ab cb"><figure class="nq mu nr ns nt nu nv paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><img src="../Images/83d80c380e9e916d738066e1d5e5b3b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*uT9ZWm_LDYDK1T7T"/></div></figure><figure class="nq mu nw ns nt nu nv paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><img src="../Images/f6fe8e2c31b5847bcdaa0d2c0c4baa98.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/0*1qeP_W-5dnvzd0ks"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk nx di ny nz translated">照片由<a class="ae le" href="https://unsplash.com/@mikedoherty" rel="noopener ugc nofollow" target="_blank">迈克·多尔蒂</a>和<a class="ae le" href="https://unsplash.com/@amyannaasher?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">艾米·阿什</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>拍摄</figcaption></figure></div><p id="c56e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">虽然docker和Podman都是容器引擎，并且在许多方面都很相似。波德曼的一些进步包括:</p><ul class=""><li id="e178" class="oa ob it kk b kl km ko kp kr oc kv od kz oe ld of og oh oi bi translated"><strong class="kk iu">兼容性</strong>:由于Podman利用OCI在操作系统上运行并维护容器，这使得它与docker等大多数容器引擎兼容。用户只需使用别名docker=podman转换Docker命令行界面(CLI ),使其与podman一起工作。(<em class="ni">见</em> <a class="ae le" href="https://developers.redhat.com/blog/2020/11/19/transitioning-from-docker-to-podman" rel="noopener ugc nofollow" target="_blank"> <em class="ni">链接</em> </a>如何从码头工过渡到搬运工)</li><li id="5ea5" class="oa ob it kk b kl oj ko ok kr ol kv om kz on ld of og oh oi bi translated"><strong class="kk iu">无根</strong>:对于Podman来说，用户可以选择通过root或者非特权用户运行。如果你想知道无根是什么意思，无根容器是用户没有管理权限的容器。此外，Podman的fork-exec架构增加了一个额外的安全层，以确保主机上的安全性。额外的一层不仅使容器更加安全，而且还允许多个用户在同一台机器上运行。(详见<a class="ae le" href="https://developers.redhat.com/blog/2020/09/25/rootless-containers-with-podman-the-basics" rel="noopener ugc nofollow" target="_blank">链接</a>)</li><li id="5308" class="oa ob it kk b kl oj ko ok kr ol kv om kz on ld of og oh oi bi translated"><strong class="kk iu">无守护进程</strong>:与docker容器引擎不同，Podman不需要守护进程。Podman允许用户通过启动容器作为子进程来执行命令。对于那些对“守护进程”这个短语感到困惑的人，可以把它想象成一个在后台默默运行的中心枢纽。该中心集线器以root权限运行。使用docker时，用户每次都要访问中心hub。在Podman上，这个过程被跳过，因为每个用户都在自己的容器上运行。(在<a class="ae le" href="https://developers.redhat.com/blog/2018/11/20/buildah-podman-containers-without-daemons" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多关于没有守护进程的容器的信息)</li></ul><div class="nm nn no np gt ab cb"><figure class="nq mu oo ns nt nu nv paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><img src="../Images/d25c4b642ef694edcdb95e9e596481ff.png" data-original-src="https://miro.medium.com/v2/resize:fit:1004/0*I8_GGUieawbZNW5q"/></div></figure><figure class="nq mu op ns nt nu nv paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><img src="../Images/6981ba38b94ee6e516ff28c646fc7da5.png" data-original-src="https://miro.medium.com/v2/resize:fit:998/0*otaBsezyQeZaO4rL"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk oq di or nz translated">照片由<a class="ae le" href="https://unsplash.com/@sradams57?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯蒂夫·亚当斯</a>和<a class="ae le" href="https://unsplash.com/@lavalaye?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">塞巴斯蒂安·拉瓦雷</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div><p id="6c59" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">当前版本的波德曼仍然存在一些缺点:</p><ul class=""><li id="ecd7" class="oa ob it kk b kl km ko kp kr oc kv od kz oe ld of og oh oi bi translated"><strong class="kk iu"> Linux首选</strong> : Podman是一个运行Linux容器的工具。对于macOS和Windows，需要一个Linux盒子。</li><li id="27a5" class="oa ob it kk b kl oj ko ok kr ol kv om kz on ld of og oh oi bi translated"><strong class="kk iu">非全合一</strong>:与docker相比，Podman依赖于不同的任务使用不同的工具。例如，Podman使用Buildah构建图像容器。(在<a class="ae le" href="https://podman.io/blogs/2018/10/31/podman-buildah-relationship.html" rel="noopener ugc nofollow" target="_blank">链接</a>了解更多关于Buildah和Podman关系的信息)</li><li id="b27b" class="oa ob it kk b kl oj ko ok kr ol kv om kz on ld of og oh oi bi translated"><strong class="kk iu">不支持</strong>:docker上有特色的一些工具在Podman上还没有特色。例如，当涉及到管理不同主机上的不同容器时，docker用户可以求助于<a class="ae le" href="https://docs.docker.com/engine/swarm/" rel="noopener ugc nofollow" target="_blank"> docker swarm </a>，而Podman用户则被冷落。</li><li id="239b" class="oa ob it kk b kl oj ko ok kr ol kv om kz on ld of og oh oi bi translated"><strong class="kk iu">没有足够的讨论/文档</strong>:由于新成员波德曼相对来说是一个新手，所以围绕波德曼的讨论和文档(包括问题、议题等)很少。)都比docker的少。虽然随着时间的推移，这个问题可能会得到解决，但我们确实需要解决这个冷启动问题。(我们需要在<a class="ae le" href="https://github.com/containers/podman/discussions" rel="noopener ugc nofollow" target="_blank">环节</a>进行更多讨论！)</li></ul></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><h1 id="8082" class="lh li it bd lj lk oz lm ln lo pa lq lr jz pb ka lt kc pc kd lv kf pd kg lx ly bi translated">集装箱电影推荐演示</h1><figure class="nm nn no np gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi pe"><img src="../Images/1aa8ca6768f5daee23ad02c3685c54fd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*tXx2rz9wE-rE6QR2"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">照片由<a class="ae le" href="https://unsplash.com/@ewitsoe?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">埃里克·维特索</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="f490" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这是一个使用Podman运行容器的简单演示，这些容器提供一个推荐的电影id列表，给定一个用户id。电影推荐模型使用协同过滤。由于模型训练部分不是重点，我们将把更多的重点放在部署容器上。为了提高性能，我们预先计算了所有用户的前10个推荐电影id的预测，并将结果缓存在容器中。我们还进行了简单的负载测试来比较性能。</p><ol class=""><li id="5176" class="oa ob it kk b kl km ko kp kr oc kv od kz oe ld pf og oh oi bi translated"><strong class="kk iu">运行单个容器</strong></li><li id="5220" class="oa ob it kk b kl oj ko ok kr ol kv om kz on ld pf og oh oi bi translated"><strong class="kk iu">用负载均衡器运行两个容器</strong></li></ol></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><h2 id="0a01" class="pg li it bd lj ph pi dn ln pj pk dp lr kr pl pm lt kv pn po lv kz pp pq lx pr bi translated">装置</h2><figure class="nm nn no np gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi ps"><img src="../Images/338fc4b9d177edecd91010f0c442dd1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-FAVghcMt7_eZWPC"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated"><a class="ae le" href="https://unsplash.com/@steve_j?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">斯蒂夫·约翰森</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><blockquote class="nf ng nh"><p id="6951" class="ki kj ni kk b kl km ju kn ko kp jx kq nj ks kt ku nk kw kx ky nl la lb lc ld im bi translated">请注意，这个演示是在AWS小型ubuntu服务器上运行的，您可以随意在其他云服务器上运行您的实现。</p></blockquote><p id="76ce" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在Ubuntu 20.04上安装Podman:</p><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="1c60" class="pg li it pu b gy py pz l qa qb">sudo apt-get update -y</span><span id="ff21" class="pg li it pu b gy qc pz l qa qb">sudo apt-get install curl wget gnupg2 -y</span><span id="72e5" class="pg li it pu b gy qc pz l qa qb">sudo source /etc/os-release<br/>sudo sh -c "echo 'deb <a class="ae le" href="http://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/xUbuntu_${VERSION_ID}/" rel="noopener ugc nofollow" target="_blank">http://download.opensuse.org/repositories/devel:/kubic:/libcontainers:/stable/xUbuntu_${VERSION_ID}/</a> /' &gt; /etc/apt/sources.list.d/devel:kubic:libcontainers:stable.list"</span><span id="5ee3" class="pg li it pu b gy qc pz l qa qb">wget -nv <a class="ae le" href="https://download.opensuse.org/repositories/devel:kubic:libcontainers:stable/xUbuntu_${VERSION_ID}/Release.key" rel="noopener ugc nofollow" target="_blank">https://download.opensuse.org/repositories/devel:kubic:libcontainers:stable/xUbuntu_${VERSION_ID}/Release.key</a> -O- | sudo apt-key add -</span><span id="2ecb" class="pg li it pu b gy qc pz l qa qb">sudo apt-get update -qq -y<br/>sudo apt-get -qq --yes install podman</span></pre><p id="c04d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">安装开发依赖项:</p><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="23af" class="pg li it pu b gy py pz l qa qb">pip install -r requirements.dev.txt</span></pre><h2 id="25a6" class="pg li it bd lj ph pi dn ln pj pk dp lr kr pl pm lt kv pn po lv kz pp pq lx pr bi translated">训练协同过滤模型</h2><figure class="nm nn no np gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qd"><img src="../Images/f4be727e7c9d6f063534904a4941522c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*wiOygXADQNFOUC6r"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">由<a class="ae le" href="https://unsplash.com/@kellysikkema?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Kelly Sikkema </a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="dd0f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">运行<code class="fe qe qf qg pu b">train_model.ipynb</code>来训练模型，并获得所有610个用户的前10个电影id的预测，保存在<code class="fe qe qf qg pu b">top_n_movie_ids.pkl</code>中。</p><blockquote class="nf ng nh"><p id="d48f" class="ki kj ni kk b kl km ju kn ko kp jx kq nj ks kt ku nk kw kx ky nl la lb lc ld im bi translated">你可以在我们的<a class="ae le" href="https://github.com/OscarWang114/podman-movie-demo" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到<code class="fe qe qf qg pu b">train_model.ipynb</code>的文件。</p></blockquote></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><h1 id="0595" class="lh li it bd lj lk oz lm ln lo pa lq lr jz pb ka lt kc pc kd lv kf pd kg lx ly bi translated">用集装箱装</h1><h2 id="93eb" class="pg li it bd lj ph pi dn ln pj pk dp lr kr pl pm lt kv pn po lv kz pp pq lx pr bi translated">1.单个容器</h2><figure class="nm nn no np gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qh"><img src="../Images/ae487c1c760ad7ffa679f7136dcffe3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Z65YqzOL0wFMDY40"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated"><a class="ae le" href="https://unsplash.com/@pic_parlance?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">刘嘉玲</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的照片</figcaption></figure><p id="0ee0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">构建一个映像并在后台运行一个名为<code class="fe qe qf qg pu b">deployment</code>的容器:</p><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="a0a5" class="pg li it pu b gy py pz l qa qb">podman build -t deployment .<br/>podman run -d --name deployment -p 5000:5000 deployment</span></pre><p id="4aeb" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">测试API:</p><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="c828" class="pg li it pu b gy py pz l qa qb">curl localhost:5000/recommend/10<br/># should return 1204,898,1237,1262,1272,1196,50,112552,318,904</span></pre><p id="574a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用Apache Bench执行简单的负载测试(200个并发请求，总共10000个请求)</p><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="fd60" class="pg li it pu b gy py pz l qa qb"># if not installed, run `sudo apt install apache2-utils`<br/>ab -n 10000 -c 200 <a class="ae le" href="http://localhost:5000/recommend/10" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/recommend/10</a></span></pre><p id="ddad" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">来自Apache Bench的百分比结果:</p><blockquote class="nf ng nh"><p id="fff4" class="ki kj ni kk b kl km ju kn ko kp jx kq nj ks kt ku nk kw kx ky nl la lb lc ld im bi translated">请注意，服务器代码中特意添加了100毫秒的睡眠时间来模拟延迟</p></blockquote><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="24e7" class="pg li it pu b gy py pz l qa qb">Percentage of the requests served within a certain time (ms)<br/>  50%    309<br/>  66%    317<br/>  75%    323<br/>  80%    327<br/>  90%    350<br/>  95%    381<br/>  98%   1325<br/>  99%   1349<br/> 100%   3360 (longest request)</span></pre><p id="6fc0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">停下集装箱</p><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="55bc" class="pg li it pu b gy py pz l qa qb">podman stop deployment</span></pre><h2 id="baeb" class="pg li it bd lj ph pi dn ln pj pk dp lr kr pl pm lt kv pn po lv kz pp pq lx pr bi translated">2.带有负载平衡器的两个容器</h2><div class="nm nn no np gt ab cb"><figure class="nq mu qi ns nt nu nv paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><img src="../Images/99811d3ed036de468dcb786594a2c212.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*FddbID2NZN88GsdZ"/></div></figure><figure class="nq mu qi ns nt nu nv paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><img src="../Images/b31d1510d0a19fe5df5e2d65ef7e510e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/0*GDuL61_WxX7ubDtJ"/></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk nx di ny nz translated">照片由<a class="ae le" href="https://unsplash.com/@pic_parlance?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">刘嘉玲</a>在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure></div><p id="0157" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">创建一个名为<code class="fe qe qf qg pu b">deployment_net</code>的波德曼网络</p><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="611a" class="pg li it pu b gy py pz l qa qb">podman network create deployment_net</span></pre><p id="2af7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">构建一个映像，并在后台运行两个名为<code class="fe qe qf qg pu b">deployment1</code>和<code class="fe qe qf qg pu b">deployment2</code>的容器。指定<code class="fe qe qf qg pu b">--network deployment_net</code>以便容器驻留在相同的网络空间中:</p><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="a56e" class="pg li it pu b gy py pz l qa qb">podman build -t deployment .<br/>podman run -d --name deployment1 --network deployment_net deployment<br/>podman run -d --name deployment2 --network deployment_net deployment</span></pre><p id="4ad0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">构建并运行NGINX容器，作为前台的负载平衡器:</p><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="4445" class="pg li it pu b gy py pz l qa qb">podman run -v `pwd`/nginx.conf:/etc/nginx/nginx.conf:Z -p 5000:5000 \<br/>--name nginx --network deployment_net docker.io/library/nginx</span><span id="0074" class="pg li it pu b gy qc pz l qa qb"># If success, you should see "/docker-entrypoint.sh: Configuration complete; ready for start up"</span></pre><p id="dca1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在另一个shell会话中测试API:</p><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="2db0" class="pg li it pu b gy py pz l qa qb">curl localhost:5000/recommend/10<br/># should return 1204,898,1237,1262,1272,1196,50,112552,318,904</span></pre><p id="635b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">用Apache Bench执行一个简单的负载测试(200个并发请求，总共10000个请求)</p><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="fb04" class="pg li it pu b gy py pz l qa qb"># if not installed, run `sudo apt install apache2-utils`<br/>ab -n 10000 -c 200 <a class="ae le" href="http://localhost:5000/recommend/10" rel="noopener ugc nofollow" target="_blank">http://localhost:5000/recommend/10</a></span></pre><p id="e674" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">来自Apache Bench的百分比结果:</p><blockquote class="nf ng nh"><p id="54b9" class="ki kj ni kk b kl km ju kn ko kp jx kq nj ks kt ku nk kw kx ky nl la lb lc ld im bi translated">请注意，服务器代码中特意添加了100毫秒的睡眠时间来模拟延迟</p></blockquote><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="1de3" class="pg li it pu b gy py pz l qa qb">Percentage of the requests served within a certain time (ms)<br/>  50%    218<br/>  66%    232<br/>  75%    240<br/>  80%    245<br/>  90%    257<br/>  95%    269<br/>  98%    287<br/>  99%    305<br/> 100%    360 (longest request)</span></pre><p id="9d9c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">停下集装箱</p><ol class=""><li id="c405" class="oa ob it kk b kl km ko kp kr oc kv od kz oe ld pf og oh oi bi translated">在NGINX容器的shell会话中按Ctrl + C</li><li id="2257" class="oa ob it kk b kl oj ko ok kr ol kv om kz on ld pf og oh oi bi translated">拦住另外两个集装箱</li></ol><pre class="nm nn no np gt pt pu pv pw aw px bi"><span id="b2a3" class="pg li it pu b gy py pz l qa qb">podman stop deployment1<br/>podman stop deployment2</span></pre><h2 id="e5cb" class="pg li it bd lj ph pi dn ln pj pk dp lr kr pl pm lt kv pn po lv kz pp pq lx pr bi translated">解决纷争</h2><p id="095f" class="pw-post-body-paragraph ki kj it kk b kl qj ju kn ko qk jx kq kr ql kt ku kv qm kx ky kz qn lb lc ld im bi translated">问题:<code class="fe qe qf qg pu b">Error: error creating container storage: the container name "&lt;name&gt;" is already in use by "&lt;id&gt;". You have to remove that container to be able to reuse that name.: that name is already in use</code>。</p><p id="c1b6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">解决方案:<code class="fe qe qf qg pu b">podman rm --storage &lt;id&gt;</code></p></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><h1 id="91e2" class="lh li it bd lj lk oz lm ln lo pa lq lr jz pb ka lt kc pc kd lv kf pd kg lx ly bi translated">收场白</h1><figure class="nm nn no np gt mu gh gi paragraph-image"><div role="button" tabindex="0" class="mv mw di mx bf my"><div class="gh gi qo"><img src="../Images/286f926a7823cb8fa1d1104f50b393c1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*PiIOs9RXUb2z3xT1"/></div></div><figcaption class="nb nc gj gh gi nd ne bd b be z dk translated">Erik Mclean 在<a class="ae le" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片</figcaption></figure><p id="0df1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">非常感谢您阅读我们的文章！从我们的演示中可以得出一个简短的结论:带有负载均衡器的两个容器的响应时间比一个容器要好。当我们有一个容器时，当98%的请求在特定时间(1325 ms)内得到满足时，它就会遇到瓶颈。另一方面，具有负载平衡器的两个容器在287毫秒内工作良好。因此，在生产ML系统设置中，容器可用于提供更好的电影推荐流服务。</p><p id="1683" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">你可以在我们的<a class="ae le" href="https://github.com/OscarWang114/podman-movie-demo" rel="noopener ugc nofollow" target="_blank"> Github </a>上找到完整的代码。</p></div><div class="ab cl os ot hx ou" role="separator"><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox oy"/><span class="ov bw bk ow ox"/></div><div class="im in io ip iq"><h1 id="f4ad" class="lh li it bd lj lk oz lm ln lo pa lq lr jz pb ka lt kc pc kd lv kf pd kg lx ly bi translated">参考</h1><p id="18b7" class="pw-post-body-paragraph ki kj it kk b kl qj ju kn ko qk jx kq kr ql kt ku kv qm kx ky kz qn lb lc ld im bi translated">[1]<a class="ae le" href="https://podman.io/" rel="noopener ugc nofollow" target="_blank">https://podman.io/</a></p><p id="450a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[2]梅塞格尔，b .，松冈，j .，波科尔尼·玛雅·科斯坦蒂尼，f .，波科尔尼，f .，科斯坦蒂尼，m .，辛格，K. (2021年5月13日)。<em class="ni">构建容器化应用</em>。红帽开发者。于2022年3月16日从https://developers.redhat.com/topics/containers检索</p><p id="5e23" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[3] Jethva，H. (2021年11月25日)。<em class="ni">如何在ubuntu 20.04上安装使用Podman</em>。Atlantic.Net。2022年3月16日检索，来自<a class="ae le" href="https://www.atlantic.net/dedicated-server-hosting/how-to-install-and-use-podman-on-ubuntu-20-04/" rel="noopener ugc nofollow" target="_blank">https://www . Atlantic . net/dedicated-server-hosting/how-to-install-and-use-podman-on-Ubuntu-20-04/</a></p><p id="0960" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[4]斯托杜尔卡，J. (2021，10月20日)。<em class="ni">协同过滤:矩阵分解推荐系统</em>。吉里·斯托杜尔卡。于2022年3月16日从<a class="ae le" href="https://www.jiristodulka.com/post/recsys_cf/" rel="noopener ugc nofollow" target="_blank">https://www.jiristodulka.com/post/recsys_cf/</a>检索</p><p id="849e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[5]麦丘内，M. (2020年，12月27日)。<em class="ni">跟Nginx和Podman </em>乱搞。埃尔米科的笔记。检索于2022年3月16日，来自<a class="ae le" href="https://notes.elmiko.dev/2020/12/27/messing-around-with-nginx-podman.html" rel="noopener ugc nofollow" target="_blank">https://notes . El miko . dev/2020/12/27/messing-around-with-nginx-pod man . html</a></p></div></div>    
</body>
</html>