<html>
<head>
<title>Outlier Detection (Part 2): Multivariate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">异常值检测(第2部分):多元</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/outlier-detection-part-2-multivariate-df486f658d09?source=collection_archive---------0-----------------------#2019-12-10">https://pub.towardsai.net/outlier-detection-part-2-multivariate-df486f658d09?source=collection_archive---------0-----------------------#2019-12-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/cafb63c14456e6cd996ba80408117fb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:900/format:webp/1*Ef-RUQ1zwv95iA66tGSq3w.png"/></div></figure><h2 id="f4d9" class="iv iw ix bd b dl iy iz ja jb jc jd dk je translated" aria-label="kicker paragraph">更好地分析—做出更明智的决策</h2><div class=""/><div class=""><h2 id="0df8" class="pw-subtitle-paragraph kd jg ix bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">马氏距离|稳健估计(MCD):R中的示例</h2></div><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi kv"><img src="../Images/10b016d7b993d24f3355e4f0e18b26a7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CyJKa9ylPtxcxy3RSYpAOA.jpeg"/></div></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">原始图像见<a class="ae li" href="https://images.app.goo.gl/Z7FnPjqYZS77FDZ46" rel="noopener ugc nofollow" target="_blank">此处</a></figcaption></figure><p id="8225" class="pw-post-body-paragraph lj lk ix ll b lm ln kh lo lp lq kk lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi mf translated"><span class="l mg mh mi bm mj mk ml mm mn di">在</span> <a class="ae li" href="https://medium.com/towards-artificial-intelligence/outlier-detection-part-1-univariate-f40621b0bc" rel="noopener">第一部分(<strong class="ll jh"> <em class="mo">异常值检测:单变量</em> </strong> ) </a>中，我们学习了如何使用稳健的方法来检测单变量异常值。这一部分我们将看到如何更好地识别多元异常值。</p><blockquote class="mp mq mr"><p id="68d5" class="lj lk mo ll b lm ln kh lo lp lq kk lr ms lt lu lv mt lx ly lz mu mb mc md me ij bi translated">多元统计——同时观察和分析一个以上的结果变量</p></blockquote><p id="1665" class="pw-post-body-paragraph lj lk ix ll b lm ln kh lo lp lq kk lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">我们将使用来自R中的"<strong class="ll jh"> MASS" </strong>包的"<strong class="ll jh"> Animals " </strong>数据进行演示。</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/ad99a62cd0fed947e9b72809c672fb9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:624/format:webp/1*JgvIiXN2h__9gCGRqcII_w.png"/></div><figcaption class="le lf gj gh gi lg lh bd b be z dk translated">R中批量包装的动物数据</figcaption></figure><p id="14b5" class="pw-post-body-paragraph lj lk ix ll b lm ln kh lo lp lq kk lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">用于演示的变量是动物的体重和大脑重量，它们被转换成对数形式<em class="mo">(使高度偏斜的分布不那么偏斜)</em></p><pre class="kw kx ky kz gt mw mx my mz aw na bi"><span id="2b8d" class="nb nc ix mx b gy nd ne l nf ng">Y &lt;- data.frame(body = log(Animals$body), brain = log(Animals$brain))</span><span id="3127" class="nb nc ix mx b gy nh ne l nf ng">plot_fig &lt;- ggplot(Y, aes(x = body, y = brain)) + geom_point(size = 5) +<br/>  xlab("log(body)") + ylab("log(brain)") + ylim(-5, 15) +<br/>  scale_x_continuous(limits = c(-10, 16), breaks = seq(-15, 15, 5))</span></pre><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi ni"><img src="../Images/ffa9d9bcacea16e47841d6d92fac68ed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1232/format:webp/1*Nt9vQY1CUMZ6btXvAE-uUQ.png"/></div></figure><p id="304a" class="pw-post-body-paragraph lj lk ix ll b lm ln kh lo lp lq kk lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">在进入分析部分之前。让我们试着理解一些基础知识。</p><h1 id="f541" class="nj nc ix bd nk nl nm nn no np nq nr ns km nt kn nu kp nv kq nw ks nx kt ny nz bi translated">马哈拉诺比斯距离</h1><blockquote class="mp mq mr"><p id="eabe" class="lj lk mo ll b lm ln kh lo lp lq kk lr ms lt lu lv mt lx ly lz mu mb mc md me ij bi translated">观测的Mahalanobis(或广义)距离是从该观测到中心的距离，考虑了协方差矩阵。</p></blockquote><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi oa"><img src="../Images/2751509dde58df09a4b0c87e83dcc7a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:664/format:webp/1*oVP6BbXQp1Y4Z8fyjUGsmA.png"/></div></figure><ol class=""><li id="21cf" class="ob oc ix ll b lm ln lp lq ls od lw oe ma of me og oh oi oj bi translated"><strong class="ll jh"> <em class="mo">经典马氏距离</em> : </strong> <strong class="ll jh">样本均值</strong>作为位置估计，<strong class="ll jh">样本协方差矩阵</strong>作为散布估计。</li><li id="9adb" class="ob oc ix ll b lm ok lp ol ls om lw on ma oo me og oh oi oj bi translated">为了检测多元异常值，将Mahalanobis距离与从卡方分布导出的截止值进行比较</li><li id="1d72" class="ob oc ix ll b lm ok lp ol ls om lw on ma oo me og oh oi oj bi translated">在二维空间中，我们可以构建相应的97.5%容差椭球体，该椭球体由Mahalanobis距离不超过截止值的那些观察值定义。</li></ol><pre class="kw kx ky kz gt mw mx my mz aw na bi"><span id="d85a" class="nb nc ix mx b gy nd ne l nf ng">Y_center &lt;- colMeans(Y)<br/>Y_cov &lt;- cov(Y)<br/>Y_radius &lt;- sqrt(qchisq(0.975, df = ncol(Y)))</span><span id="54b5" class="nb nc ix mx b gy nh ne l nf ng">library(car)<br/>Y_ellipse &lt;- data.frame(ellipse(center = Y_center,<br/>                                 shape = Y_cov,radius = Y_radius, segments = 100, draw = FALSE))<br/>colnames(Y_ellipse) &lt;- colnames(Y)</span><span id="2bb1" class="nb nc ix mx b gy nh ne l nf ng">plot_fig &lt;- plot_fig +<br/>  geom_polygon(data=Y_ellipse, color = "dodgerblue",<br/>               fill = "dodgerblue", alpha = 0.2) +<br/>  geom_point(aes(x = Y_center[1], y = Y_center[2]),<br/>             color = "blue", size = 6)<br/>plot_fig</span></pre><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi op"><img src="../Images/e519ed21f80a722c661d7ee0c43e5ab0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*Wy_g9UgTsXWWE8WelEIL6g.png"/></div></figure><p id="fc28" class="pw-post-body-paragraph lj lk ix ll b lm ln kh lo lp lq kk lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">上面的方法给了我们3个潜在的异常值观察值，它们接近椭圆线。</p><p id="c83e" class="pw-post-body-paragraph lj lk ix ll b lm ln kh lo lp lq kk lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">这是否足够强大？或者，如果我们使用不同的方法，我们会看到更多的异常值吗？</p><h2 id="ef7d" class="nb nc ix bd nk oq or dn no os ot dp ns ls ou ov nu lw ow ox nw ma oy oz ny jd bi translated">位置和散布的稳健估计</h2><p id="a44f" class="pw-post-body-paragraph lj lk ix ll b lm pa kh lo lp pb kk lr ls pc lu lv lw pd ly lz ma pe mc md me ij bi translated"><strong class="ll jh"> <em class="mo">最小协方差行列式(MCD)</em></strong>rousse uw估计量是一种流行的多元位置和散度的稳健估计量。</p><ol class=""><li id="18e8" class="ob oc ix ll b lm ln lp lq ls od lw oe ma of me og oh oi oj bi translated">MCD寻找那些经典协方差矩阵具有<em class="mo">最低可能行列式</em>的<strong class="ll jh"> <em class="mo"> h </em> </strong>观测值。</li><li id="a6dd" class="ob oc ix ll b lm ok lp ol ls om lw on ma oo me og oh oi oj bi translated">MCD对位置的估计是这些 <strong class="ll jh"> <em class="mo"> h </em> </strong> <em class="mo">观察值</em>的平均值</li><li id="6bdf" class="ob oc ix ll b lm ok lp ol ls om lw on ma oo me og oh oi oj bi translated">分散的MCD估计是这些 <strong class="ll jh"> <em class="mo"> h </em> </strong> <em class="mo">点</em>的<em class="mo">样本协方差矩阵(乘以一致性因子)。</em></li><li id="e346" class="ob oc ix ll b lm ok lp ol ls om lw on ma oo me og oh oi oj bi translated">应用重新加权步骤来提高正常数据的效率。</li><li id="5389" class="ob oc ix ll b lm ok lp ol ls om lw on ma oo me og oh oi oj bi translated">MCD的计算是困难的，但是提出了几种快速算法。</li></ol><h2 id="9919" class="nb nc ix bd nk oq or dn no os ot dp ns ls ou ov nu lw ow ox nw ma oy oz ny jd bi translated">使用MCD的位置和散布的稳健估计</h2><pre class="kw kx ky kz gt mw mx my mz aw na bi"><span id="05e6" class="nb nc ix mx b gy nd ne l nf ng">library(robustbase)<br/>Y_mcd &lt;- covMcd(Y)<br/># Robust estimate of location<br/>Y_mcd$center<br/># Robust estimate of scatter<br/>Y_mcd$cov</span></pre><p id="4c24" class="pw-post-body-paragraph lj lk ix ll b lm ln kh lo lp lq kk lr ls lt lu lv lw lx ly lz ma mb mc md me ij bi translated">通过在马哈拉诺比斯距离的定义中插入这些位置和散布的稳健估计，我们获得稳健的距离，并且可以创建稳健的容差椭球(RTE)。</p><h2 id="230b" class="nb nc ix bd nk oq or dn no os ot dp ns ls ou ov nu lw ow ox nw ma oy oz ny jd bi translated">强健耐受椭球:动物</h2><pre class="kw kx ky kz gt mw mx my mz aw na bi"><span id="d7a2" class="nb nc ix mx b gy nd ne l nf ng">Y_mcd &lt;- covMcd(Y)</span><span id="2ce5" class="nb nc ix mx b gy nh ne l nf ng">ellipse_mcd &lt;- data.frame(ellipse(center = Y_mcd$center,<br/>                                  shape = Y_mcd$cov,<br/>                                  radius= Y_radius, <br/>                                  segments=100,draw=FALSE))</span><span id="063f" class="nb nc ix mx b gy nh ne l nf ng">colnames(ellipse_mcd) &lt;- colnames(Y)</span><span id="bd35" class="nb nc ix mx b gy nh ne l nf ng">plot_fig &lt;- plot_fig +<br/>  geom_polygon(data=ellipse_mcd, color="red", fill="red", <br/>  alpha=0.3) +<br/>  geom_point(aes(x = Y_mcd$center[1], y = Y_mcd$center[2]),<br/>             color = "red", size = 6)<br/>plot_fig</span></pre><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi pf"><img src="../Images/b6418e07fe19d60287190523a336c9e8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1246/format:webp/1*G9otZ7Z4SZihTyAjdbck-Q.png"/></div></figure><h2 id="1b76" class="nb nc ix bd nk oq or dn no os ot dp ns ls ou ov nu lw ow ox nw ma oy oz ny jd bi translated">距离-距离图</h2><p id="7e75" class="pw-post-body-paragraph lj lk ix ll b lm pa kh lo lp pb kk lr ls pc lu lv lw pd ly lz ma pe mc md me ij bi translated"><strong class="ll jh">距离-距离图</strong>显示了每次观测的稳健距离与其经典Mahalanobis距离的对比，后者是从MCD物体直接获得的。</p><pre class="kw kx ky kz gt mw mx my mz aw na bi"><span id="f185" class="nb nc ix mx b gy nd ne l nf ng">plot(Y_mcd, which = "dd")</span></pre><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi pg"><img src="../Images/47b7ff01244609e8630751ee62075d20.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*1EJ-Ze1bLmeaw1nDXrDl3w.png"/></div></div></figure><h2 id="7730" class="nb nc ix bd nk oq or dn no os ot dp ns ls ou ov nu lw ow ox nw ma oy oz ny jd bi translated">检查异常值</h2><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/64525022e7430e3974a8cc01b0195286.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/1*hW-pLSfcM_5lBo-Ti_jMFQ.png"/></div></figure><h1 id="6a9d" class="nj nc ix bd nk nl nm nn no np nq nr ns km nt kn nu kp nv kq nw ks nx kt ny nz bi translated"><strong class="ak">总结</strong></h1><p id="ec72" class="pw-post-body-paragraph lj lk ix ll b lm pa kh lo lp pb kk lr ls pc lu lv lw pd ly lz ma pe mc md me ij bi translated"><strong class="ll jh"> <em class="mo">最小协方差行列式</em> </strong>插有<strong class="ll jh">马氏距离</strong>的估计为我们提供了比我们的经典方法更好的异常值检测能力。</p></div></div>    
</body>
</html>