<html>
<head>
<title>A Data Scientist’s Guide To Getting Started With Kubernetes On AWS</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学家在AWS上使用Kubernetes的入门指南</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/a-data-scientists-guide-to-getting-started-with-kubernetes-on-aws-281e034dc980?source=collection_archive---------1-----------------------#2020-04-29">https://pub.towardsai.net/a-data-scientists-guide-to-getting-started-with-kubernetes-on-aws-281e034dc980?source=collection_archive---------1-----------------------#2020-04-29</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><figure class="gl gn jr js jt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi jq"><img src="../Images/77186414d4c21621a7da5be22d3c2934.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*uvIoULagzho0Lfi5.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">来源:<a class="ae kf" href="https://aws.amazon.com/eks/" rel="noopener ugc nofollow" target="_blank">https://aws.amazon.com/eks/</a></figcaption></figure><h1 id="994c" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">介绍</h1><p id="3a92" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在本文中，我将分享如何使用Kubernetes来运行数据科学工作负载。我将首先展示如何在AWS上设置Kubernetes集群。然后，我将展示如何使用Kubeflow手动启动Jupyter笔记本。在这个过程中，您将学习一些管理Kubernetes集群的命令。</p><p id="5825" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我假设读者知道如何启动EC2实例，并且能够阅读简单的bash脚本。如果不是这样，那么请参考本<a class="ae kf" href="https://aws.amazon.com/getting-started/hands-on/get-started-dlami/" rel="noopener ugc nofollow" target="_blank">教程</a>来了解如何启动EC2实例，并参考本<a class="ae kf" href="https://medium.com/towards-artificial-intelligence/how-i-wrangle-data-at-the-command-line-17ad48faf699?source=post_stats_page---------------------------" rel="noopener">文章</a>来了解关于数据科学bash脚本的入门知识。</p><p id="ec5e" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">本文中提到的所有代码和脚本都可以在这个<a class="ae kf" href="https://github.com/hsm207/eks_getting_started" rel="noopener ugc nofollow" target="_blank"> repo </a>中获得。</p><h1 id="7416" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">动机</h1><p id="65a6" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">本文的目标读者是想要评估Kubernetes作为数据科学平台的可行性的数据科学家。因此，重点是快速启动并运行Kubernetes集群，以便他们可以继续探索使用它来运行数据科学工作负载的许多选项。</p><h1 id="e83a" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">先决条件</h1><p id="5826" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如果您想按照本文中描述的步骤进行操作，您将需要以下内容:</p><ol class=""><li id="2557" class="mh mi it lg b lh mc ll md lp mj lt mk lx ml mb mm mn mo mp bi translated">附加了IAM角色的EC2实例，其中包含AdministratorAccess策略。</li><li id="87be" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb mm mn mo mp bi translated">Visual Studio代码(VS代码)</li></ol><p id="75bb" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">使用EC2实例的原因是，在AWS上创建Kubernetes集群需要一些工具和配置。我决定通过EC2实例来实现，因为我不想破坏我的本地环境。我为这个EC2实例使用的图像是“深度学习AMI (Ubuntu 18.04)”。</p><p id="19d3" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我使用VS代码连接到EC2实例。这只是为了方便起见，因为它附带了许多漂亮的特性，使得与远程机器一起工作变得容易。有关将VS代码连接到远程机器的更多详细信息，请参考本<a class="ae kf" href="https://code.visualstudio.com/docs/remote/ssh" rel="noopener ugc nofollow" target="_blank">指南</a>。注意，我使用的是内部版本的VS代码，所以我启动它的命令是<code class="fe mv mw mx my b">code-insiders</code>而不是<code class="fe mv mw mx my b">code</code>。</p><h1 id="0678" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">启动Kubernetes集群</h1><h2 id="f398" class="mz kh it bd ki na nb dn km nc nd dp kq lp ne nf ku lt ng nh ky lx ni nj lc nk bi translated">概观</h2><p id="bd4c" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们将使用亚马逊EKS创建一个Kubernetes集群。这包括以下步骤:</p><ol class=""><li id="c035" class="mh mi it lg b lh mc ll md lp mj lt mk lx ml mb mm mn mo mp bi translated">安装<code class="fe mv mw mx my b">eksctl</code>和<code class="fe mv mw mx my b">kubectl</code></li><li id="658d" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb mm mn mo mp bi translated">创造一个<code class="fe mv mw mx my b">ClusterConfig</code></li><li id="b72d" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb mm mn mo mp bi translated">应用<code class="fe mv mw mx my b">ClusterConfig</code></li></ol><h2 id="a590" class="mz kh it bd ki na nb dn km nc nd dp kq lp ne nf ku lt ng nh ky lx ni nj lc nk bi translated">步骤1安装<code class="fe mv mw mx my b">eksctl</code>和<code class="fe mv mw mx my b">kubectl</code></h2><p id="fa80" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><code class="fe mv mw mx my b">eksctl</code>是创建EKS集群的工具，而<code class="fe mv mw mx my b">kubectl</code>是用于管理集群的工具。</p><p id="15ee" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在安装这些工具之前，我们需要运行以下命令:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图1:设置环境</figcaption></figure><p id="bc8e" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">图1的要点是将<code class="fe mv mw mx my b">awscli</code>工具升级到最新版本，并将<code class="fe mv mw mx my b">ap-southeast-1</code>设置为默认区域，因为我希望在该区域创建集群，并且不希望每次需要引用集群时都必须提供<code class="fe mv mw mx my b">--region</code>参数。</p><p id="2ef0" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在我们准备用以下命令安装<code class="fe mv mw mx my b">eksctl</code>:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图2:安装eksctl</figcaption></figure><p id="ce16" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">下面是安装<code class="fe mv mw mx my b">kubectl</code>的命令:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图3:安装kubectl</figcaption></figure><h2 id="4c5e" class="mz kh it bd ki na nb dn km nc nd dp kq lp ne nf ku lt ng nh ky lx ni nj lc nk bi translated">步骤2创建一个<code class="fe mv mw mx my b"> ClusterConfig</code></h2><p id="69fa" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">一个<code class="fe mv mw mx my b">ClusterConfig</code>是一个YAML文件，它告诉<code class="fe mv mw mx my b">eksctl</code>我们希望我们的集群拥有的属性。这里有一个简单的例子:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图4:最小集群配置</figcaption></figure><p id="d02c" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">图4描述了一个名为<code class="fe mv mw mx my b">dev</code>的集群，它是在<code class="fe mv mw mx my b">ap-southeast-1</code>区域中提供的。该集群将始终有两个节点属于一个名为<code class="fe mv mw mx my b">ng-1</code>的组。该组中的节点将在<code class="fe mv mw mx my b">ap-southeast-1a</code>可用性区域中创建。节点的类型将仅为<code class="fe mv mw mx my b">t3a.2xlarge</code>点实例。</p><h2 id="5802" class="mz kh it bd ki na nb dn km nc nd dp kq lp ne nf ku lt ng nh ky lx ni nj lc nk bi translated">步骤3应用<code class="fe mv mw mx my b">ClusterConfig</code></h2><p id="640a" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">假设我们已经将上一节中的<code class="fe mv mw mx my b">ClusterConfig</code>保存在一个名为<code class="fe mv mw mx my b">minimal.yaml</code>的文件中，我们可以通过运行以下命令来创建集群:</p><pre class="nl nm nn no gt nr my ns nt aw nu bi"><span id="930b" class="mz kh it my b gy nv nw l nx ny">eksctl create cluster -f minimal.yaml</span></pre><p id="c429" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">此时，您可以安装Kubernetes仪表板来帮助您监控集群和启动服务。但是我更喜欢通过命令行来做事情，所以我将跳过它。如果你想了解一下，你可以参考<a class="ae kf" href="https://github.com/hsm207/eks_getting_started/blob/master/scripts/kubernetes/06a_install_dashboard.sh" rel="noopener ugc nofollow" target="_blank">06a _ install _ dashboard . sh</a>和<a class="ae kf" href="https://github.com/hsm207/eks_getting_started/blob/master/scripts/kubernetes/06b_connect_dashboard.sh" rel="noopener ugc nofollow" target="_blank">06b _ connect _ dashboard . sh</a>脚本的安装说明。</p><h1 id="8589" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">手动启动Jupyter笔记本</h1><h2 id="9811" class="mz kh it bd ki na nb dn km nc nd dp kq lp ne nf ku lt ng nh ky lx ni nj lc nk bi translated">快速简单的方法</h2><p id="95c9" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">要启动Jupyter笔记本，只需执行以下命令:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图5:如何在Kubernetes上发布Jupyter笔记本</figcaption></figure><p id="5065" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">图5告诉Kubernetes使用DockerHub上的<code class="fe mv mw mx my b">jupyter/tensorflow-notebook</code>映像创建一个名为<code class="fe mv mw mx my b">Juypter</code>的部署。</p><p id="7f9b" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">要检查部署是否成功，您可以运行<code class="fe mv mw mx my b">kubectl get pods -w</code>来监控部署的pod的状态。pod是容器的集合，在我们的例子中，它只是基于<code class="fe mv mw mx my b">jupyter/tensorflow-notebook</code>图像的一个容器。</p><p id="4740" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">您的输出将如下所示:</p><figure class="nl nm nn no gt ju gh gi paragraph-image"><div class="gh gi nz"><img src="../Images/7de5179cb5db5b399594959b586fdb8c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*qMPZ25Fr8zqgNy34g2s-_g.png"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图6:监控部署的进度</figcaption></figure><p id="08b8" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">当状态转换到<code class="fe mv mw mx my b">Running</code>时，您可以退出命令(Windows上的<code class="fe mv mw mx my b">Ctrl + C </code>)。</p><p id="9c5c" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">那么如何连接笔记本呢？因为您可能知道在本地启动笔记本，所以您需要找出在标准输出中打印的服务器令牌。</p><p id="a136" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">在这种情况下，您可以通过执行<code class="fe mv mw mx my b">kubectl logs jupyter-95bb6ffff-x6ncb</code>从容器的日志中查看令牌的详细信息。请注意，您实际上不必在<code class="fe mv mw mx my b">jupyter-</code>之后键入随机字符串。相反，您可以依靠autocomplete(作为图3中命令的一部分安装),只需在键入<code class="fe mv mw mx my b">j</code>后按下<code class="fe mv mw mx my b">TAB</code>键，因为现在集群中只有一个容器。</p><p id="d4a0" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">接下来，您需要使用<code class="fe mv mw mx my b">kubectl port-forward jupyter-95bb6ffff-x6ncb 8888:8888</code>将端口8888从EC2实例转发到容器。然后，您需要将端口8888从本地机器通过隧道传输到EC2实例。</p><p id="f116" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">VS代码的连接过程很简单，因为您可以使用远程资源管理器自动建立端口隧道。有关详细信息，请参考[1]。下面是一个截图，展示了所有东西是如何组合在一起的:</p><figure class="nl nm nn no gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi oa"><img src="../Images/8679bffcbea7f8f88db4be8e5c43747d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o3jYl-Kv6h3UJFUOXdfwGA.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图7:使用VS代码的简单端口隧道</figcaption></figure><p id="6727" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">虽然我们可以连接到笔记本电脑，但这并不是很有用，因为我们无法访问任何数据来分析、构建模型等。我们可以使用命令行工具从S3下载我们需要的东西，但是这对于大型数据集来说并不实用。</p><p id="ad5a" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">下一节将描述将S3存储桶挂载为文件系统的方法。在继续之前，让我们通过执行<code class="fe mv mw mx my b">kubectl delete deployments jupyter</code>删除当前部署。</p><h2 id="01de" class="mz kh it bd ki na nb dn km nc nd dp kq lp ne nf ku lt ng nh ky lx ni nj lc nk bi translated">安装S3铲斗</h2><p id="3a11" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">让我们使用Amazon FSx挂载一个包含我们希望处理的数据的S3存储桶。更具体地说，我们将从S3存储桶中动态创建一个Lustre文件系统。执行此操作的命令如下:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图8:动态供应Lustre文件系统</figcaption></figure><p id="7be2" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">图8中有很多内容，但主要的一点是它告诉Kubernetes创建一个名为<code class="fe mv mw mx my b">fsx-claim</code>的容量为1.2 TB的可挂载卷(第115到128行)。</p><p id="bd4d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">实际的存储将取自第95到108行中定义的名为<code class="fe mv mw mx my b">fsx-sc</code>的存储类。这部分定义了我们希望Lustre文件系统拥有的属性。需要注意的关键是，我们希望将这个文件系统与存储在<code class="fe mv mw mx my b">AWS_BUCKET</code>变量中的S3存储桶连接起来。</p><p id="9682" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">其余的命令通过分配正确的权限、端口和可用性区域来确保集群可以访问文件系统。</p><p id="172c" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">最后一个命令监视<code class="fe mv mw mx my b">fsx-claim</code>的创建。如果一切设置正确，您应该会看到它的状态从<code class="fe mv mw mx my b">Pending</code>变为<code class="fe mv mw mx my b">Bound</code>:</p><figure class="nl nm nn no gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ob"><img src="../Images/57cdab2f46a7abd8ea6ecfb0af818c0c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*U7mze-NRl_prog5loLs4_A.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图9:监控fsx-claim的创建</figcaption></figure><p id="a5b7" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在我们已经准备好部署一个内部安装了<code class="fe mv mw mx my b">fsx-claim</code>的Jupyter笔记本容器。</p><p id="1fa5" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">不幸的是，这不是用一行程序就能完成的。我们必须创建一个YAML文件来描述我们想要的部署。</p><p id="7228" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">最好设计一个简单的模板，然后修改它，而不是从头开始编写YAML文件。下面是如何为名为<code class="fe mv mw mx my b">jupyter</code>的部署生成一个模板，该部署部署一个<code class="fe mv mw mx my b">jupyter/tensorflow-notebook</code>容器:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图10:从模板中定制部署</figcaption></figure><p id="5c54" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">图10中的第1行将模板存储在<code class="fe mv mw mx my b">tmp</code>目录中一个名为<code class="fe mv mw mx my b">deploy.yaml</code>的文件中。第2行打开VS代码，这样我们可以编辑它来满足我们的需要。一旦完成，第3行将创建一个部署，如<code class="fe mv mw mx my b">deploy.yaml</code>中所定义的。</p><p id="98fa" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated"><code class="fe mv mw mx my b">deploy.yaml</code>应该是这样的，以便安装<code class="fe mv mw mx my b">fsx-claim</code>:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图11:使用FSx部署Jupyter的配置</figcaption></figure><p id="7c89" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">需要注意的重要事项是:</p><ul class=""><li id="ffa5" class="mh mi it lg b lh mc ll md lp mj lt mk lx ml mb oc mn mo mp bi translated">第32至38行将<code class="fe mv mw mx my b">fsx-claim</code>安装到容器内的<code class="fe mv mw mx my b">/home/jovyan/fsx</code>目录中。</li><li id="4a1c" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb oc mn mo mp bi translated">默认情况下，<code class="fe mv mw mx my b">/home/jovyan/fsx</code>的内容将归<code class="fe mv mw mx my b">root</code>所有，因此用户<code class="fe mv mw mx my b">jovyan</code>可以读取但不能写入。第40行修改了这一点，使得该目录的所有者是group 100，其中也包括用户<code class="fe mv mw mx my b">joyvan</code>。</li><li id="e892" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb oc mn mo mp bi translated">不幸的是，在写的时候第40行被破坏了。因此，第21到27行是它的变通方法。它启动一个容器来更改<code class="fe mv mw mx my b">/home/jovyan/fsx</code>中的权限，这样<strong class="lg iu">任何人</strong>都可以读/写它。参考[4]以理解该许可的含义。</li></ul><p id="a87b" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">本文附带的存储库有一个<a class="ae kf" href="https://github.com/hsm207/eks_getting_started/blob/master/notebooks/demo-fashion-mnist.ipynb" rel="noopener ugc nofollow" target="_blank">演示笔记本</a>，展示了如何读写这个文件系统。</p><p id="7409" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">有关使用FSx Lustre文件系统的利弊，请参考[5]。</p><h1 id="7f46" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">使用Kubeflow发布Jupyter笔记本电脑</h1><p id="9bc6" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">手动启动Jupyter笔记本是一个很好的学习体验，有助于理解构成Kubernetes集群的各个部分。但是，对于日常使用来说，非常繁琐。在这种情况下，Kubeflow是正确的选择。</p><p id="2095" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">来自Kubeflow <a class="ae kf" href="https://www.kubeflow.org/docs/about/kubeflow/" rel="noopener ugc nofollow" target="_blank">项目网站</a>:</p><blockquote class="od oe of"><p id="34fc" class="le lf og lg b lh mc lj lk ll md ln lo oh me lr ls oi mf lv lw oj mg lz ma mb im bi translated">Kubeflow项目致力于使在Kubernetes上部署机器学习(ML)工作流变得简单、可移植和可扩展。我们的目标不是重新创建其他服务，而是提供一种简单的方法来将ML的最佳开源系统部署到不同的基础设施上。无论你在哪里运行Kubernetes，你都应该能够运行Kubeflow。</p></blockquote><p id="f794" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">Kubeflow可以做的不仅仅是运行Jupyter笔记本。一些有趣的使用案例包括:</p><ul class=""><li id="c378" class="mh mi it lg b lh mc ll md lp mj lt mk lx ml mb oc mn mo mp bi translated">超参数调谐</li><li id="a650" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb oc mn mo mp bi translated">神经结构搜索</li><li id="9eac" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb oc mn mo mp bi translated">分布式培训</li><li id="5860" class="mh mi it lg b lh mq ll mr lp ms lt mt lx mu mb oc mn mo mp bi translated">模型服务</li></ul><p id="3b04" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">要在EKS集群上安装Kubeflow，首先需要安装AWS iam验证器，可以使用以下命令来完成:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图12:安装aws iam验证器</figcaption></figure><p id="1685" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">然后，要安装Kubeflow:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图13:安装Kubeflow</figcaption></figure><p id="98ef" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">图13中的最后一个命令将EC2实例的端口8080转发到Kubeflow的仪表板。因此，您需要从本地机器通过隧道连接到端口8080。</p><p id="f766" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">继续在Kubeflow仪表板中创建一个名为<code class="fe mv mw mx my b">anonymous</code>的名称空间。[6]有关于用Kubeflow启动Jupyter笔记本的详细说明，所以我在这里不再重复。</p><p id="12c6" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如果您想像我们手动启动笔记本时那样附加一个FSx Lustre文件系统，那么您将需要创建一个YAML文件来描述在<code class="fe mv mw mx my b">anonymous </code>名称空间中的声明，例如:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图14:在Kubeflow中使用的FSx声明</figcaption></figure><p id="90c8" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">图14与图11中的对应部分完全相同，除了我将in命名为<code class="fe mv mw mx my b">fsx-claim-kf</code>，并将它的名称空间指定为<code class="fe mv mw mx my b">anonymous</code>，以匹配我们之前创建的Kubeflow名称空间。默认行为是在<code class="fe mv mw mx my b">default</code>名称空间中创建声明，这不是我们想要的。</p><p id="0f84" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">现在，您只需在创建笔记本电脑服务器时，在数据卷部分键入索赔的名称，即<code class="fe mv mw mx my b">fsx-claim-kf</code>:</p><figure class="nl nm nn no gt ju gh gi paragraph-image"><div role="button" tabindex="0" class="jv jw di jx bf jy"><div class="gh gi ok"><img src="../Images/c8bc420519555502d4292ba5b817cef0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4aKdbjTNxxiTmQcgXEkdqg.png"/></div></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图15:在Kubeflow笔记本中安装FSx卷</figcaption></figure><p id="49a7" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">您将可以从挂载点访问存储在该文件系统中的任何数据。</p><h1 id="24bf" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">清除</h1><p id="d375" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在Kubernetes上工作时，跟踪自己创建的AWS资源，并在完成后删除它们，以避免产生不必要的成本，这一点很重要。</p><p id="9c53" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">如果你一直在阅读这篇文章，下面是一些需要清理的命令:</p><figure class="nl nm nn no gt ju"><div class="bz fp l di"><div class="np nq l"/></div><figcaption class="kb kc gj gh gi kd ke bd b be z dk translated">图16:删除本文中创建的AWS资源的命令</figcaption></figure><h1 id="dbe8" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">结论</h1><p id="6fdf" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">本文向您展示了如何使用亚马逊的EKS服务快速建立Kubernetes集群，以及如何部署Jupyter笔记本。此时，您已经有足够的知识来探索Kubernetes上的其他数据科学用例，例如运行Spark集群。</p><p id="dc14" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">我希望这篇文章对你有用。</p><h1 id="f746" class="kg kh it bd ki kj kk kl km kn ko kp kq kr ks kt ku kv kw kx ky kz la lb lc ld bi translated">参考</h1><p id="ca62" class="pw-post-body-paragraph le lf it lg b lh li lj lk ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">[1] <a class="ae kf" href="https://code.visualstudio.com/docs/remote/ssh#_forwarding-a-port-creating-ssh-tunnel" rel="noopener ugc nofollow" target="_blank">使用VS代码的端口转发/隧道</a></p><p id="7cbd" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">[2] <a class="ae kf" href="https://eksctl.io/" rel="noopener ugc nofollow" target="_blank"> eksctl文档</a></p><p id="b60d" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">[3] <a class="ae kf" href="https://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands" rel="noopener ugc nofollow" target="_blank"> kubectl文档</a></p><p id="0630" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">【4】<a class="ae kf" href="https://linuxize.com/post/what-does-chmod-777-mean/" rel="noopener ugc nofollow" target="_blank">chmod 777是什么意思</a></p><p id="f6cd" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">【5】<a class="ae kf" href="https://docs.aws.amazon.com/fsx/latest/LustreGuide/what-is.html" rel="noopener ugc nofollow" target="_blank">什么是亚马逊FSx for Lustre？</a></p><p id="3188" class="pw-post-body-paragraph le lf it lg b lh mc lj lk ll md ln lo lp me lr ls lt mf lv lw lx mg lz ma mb im bi translated">[6]<a class="ae kf" href="https://www.kubeflow.org/docs/notebooks/why-use-jupyter-notebook/" rel="noopener ugc nofollow" target="_blank">kube flow中Jupyter笔记本概述</a></p></div></div>    
</body>
</html>