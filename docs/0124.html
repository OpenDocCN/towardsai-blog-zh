<html>
<head>
<title>Analyzing the Mood of Chat Messages with Google Cloud’s Natural Language API</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用谷歌云的自然语言API分析聊天信息的情绪</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/analyzing-the-mood-of-chat-messages-with-google-cloud-nlps-api-a8f5d6c6de76?source=collection_archive---------1-----------------------#2019-08-02">https://pub.towardsai.net/analyzing-the-mood-of-chat-messages-with-google-cloud-nlps-api-a8f5d6c6de76?source=collection_archive---------1-----------------------#2019-08-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="a48f" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph">使用谷歌云的机器学习作为服务| <a class="ae ep" href="https://towardsai.net" rel="noopener ugc nofollow" target="_blank">面向AI </a></h2><div class=""/><p id="7d06" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">在类似谷歌云的自然语言API这样的NLP服务的帮助下，分析一段文字的情绪是可能的。谷歌称这项功能为“情感分析”。让我们来探索这是如何工作的，以及如何将它用于您的聊天机器人或CRM。</p><p id="8df5" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">在开始开发之前，让我们快速浏览一下<a class="ae ku" href="https://cloud.google.com/natural-language/" rel="noopener ugc nofollow" target="_blank">试用工具</a>。您可以在文本字段中输入随机消息，然后单击“分析”。在我的例子中，我输入了信息<em class="kv">“我很高兴慕尼黑这里阳光明媚，我们可以在伊萨尔河游泳。”</em>。</p><p id="87eb" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">如您所见，该服务检测到了消息中的各种内容，例如，像慕尼黑广场这样的实体。但是我们对情感分析感兴趣，所以请选择“情感”选项卡。</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div role="button" tabindex="0" class="lc ld di le bf lf"><div class="gh gi kw"><img src="../Images/ea312fde8557a080c0c271d9109d2916.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*PBAxWqU_VULEKLqnIdB5Sg.png"/></div></div></figure><p id="bd91" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">情感分析的结果显示我提供的文本的得分为0.8，幅度为0.8。正如你在配色方案中看到的，介于0.25和1.0之间的分数代表积极情绪，介于-0.25和0.25之间的分数代表中性情绪，介于-0.25和-1.0之间的分数代表消极情绪。量级告诉你检测到的情绪有多强烈。该值可以从0.0到无穷大。</p><p id="8d8c" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">令人印象深刻，不是吗？那么，我们如何利用这个特性呢？在我的例子中，我正在分析来自WhatsApp用户的聊天信息。例如，如果你正在通过WhatsApp Business API提供客户服务，并想知道客户的心情如何，这就很有用。在这里，您可以看到我们如何在<a class="ae ku" href="https://www.messengerpeople.com" rel="noopener ugc nofollow" target="_blank"> MessengerPeople </a>使用它:</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi li"><img src="../Images/254df9b7439ae1ca428b1bc57bdf3b2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1148/format:webp/1*_7sO4swqnoPkJk9kqpjgvw.png"/></div></figure><p id="84b5" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">所以，如果你现在很激动，我将向你展示如何实现这个特性。</p><h1 id="15c2" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">先决条件</h1><p id="30da" class="pw-post-body-paragraph jw jx iq jy b jz mh kb kc kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ij bi translated">当然，你需要一个谷歌云账户来使用这个API。如果你已经有了，你可以直接跳到GCP NLP文档的<a class="ae ku" href="https://cloud.google.com/natural-language/docs/quickstart" rel="noopener ugc nofollow" target="_blank">快速入门</a>部分。NLP API的基础在这里解释<a class="ae ku" href="https://cloud.google.com/natural-language/docs/basics" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="9d44" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">现在您必须创建一个GCP控制台项目，并为您的<a class="ae ku" href="https://console.cloud.google.com/iam-admin/serviceaccounts" rel="noopener ugc nofollow" target="_blank">服务帐户</a>添加一个密钥。然后，您必须将该键作为JSON文件存储在您的系统中，并将该键的路径作为环境变量添加到您的系统中，如下所示:</p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="2f44" class="mr lk iq mn b gy ms mt l mu mv">export GOOGLE_APPLICATION_CREDENTIALS="/home/user/Downloads/service-account-file.json"</span></pre><p id="ae11" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">现在，您基本上已经准备好调用NLP API了。喜欢的话可以先试试<a class="ae ku" href="https://cloud.google.com/natural-language/docs/quickstart#quickstart-analyze-entities-cli" rel="noopener ugc nofollow" target="_blank">命令行版本</a>。然而，在我的例子中，我将向您展示如何使用<a class="ae ku" href="https://cloud.google.com/natural-language/docs/quickstart-client-libraries#client-libraries-install-php" rel="noopener ugc nofollow" target="_blank"> PHP客户端库</a>。</p><h1 id="24e5" class="lj lk iq bd ll lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg bi translated">真实世界的用例</h1><p id="0d1d" class="pw-post-body-paragraph jw jx iq jy b jz mh kb kc kd mi kf kg kh mj kj kk kl mk kn ko kp ml kr ks kt ij bi translated">好了，开始编码吧！请注意，我只给你举几个简单的例子。这不是生产就绪的代码！</p><p id="05cc" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">首先，在项目中安装PHP客户端库:</p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="aa6c" class="mr lk iq mn b gy ms mt l mu mv">composer require google/cloud</span></pre><p id="3c19" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">然后加载库:</p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="1b6b" class="mr lk iq mn b gy ms mt l mu mv">use Google\Cloud\Language\LanguageClient;</span></pre><p id="3ad0" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">现在，我可以在自己的函数中使用客户端的方法:</p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="fcf4" class="mr lk iq mn b gy ms mt l mu mv">public function sendToGoogleCloud($text)<br/>{<br/>    // Your Google Cloud Platform project ID<br/>    $projectId = 'xxxxxxxxx';<br/>    $keyfilepath = "/var/www/xxxxxxxx.json";<br/><br/>    // Instantiates a client<br/>    $language = new LanguageClient([<br/>        'projectId' =&gt; $projectId,<br/>        'keyFilePath' =&gt; $keyfilepath<br/>    ]);<br/><br/>    // Detects the sentiment of the text<br/>    $annotation = $language-&gt;analyzeSentiment($text);<br/>    $sentiment = $annotation-&gt;sentiment();<br/>    $language = $annotation-&gt;language();<br/><br/>    $returnarray = [];<br/>    array_push($returnarray, $sentiment);<br/>    array_push($returnarray, $language);<br/><br/>    return $returnarray;<br/><br/>}</span></pre><p id="149a" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">在我的测试中，我遇到了环境变量的<a class="ae ku" href="https://stackoverflow.com/questions/52776236/where-do-i-put-my-api-key-in-google-cloud-php-language-client" rel="noopener ugc nofollow" target="_blank">问题，这就是为什么我使用另一种方法来提供密钥作为参数。情绪分析的响应如下所示:</a></p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="fd3e" class="mr lk iq mn b gy ms mt l mu mv">{<br/>"documentSentiment": {<br/>    "magnitude": 0.8,<br/>    "score": 0.8<br/>  },<br/>  "language": "en",<br/>  "sentences": [<br/>    {<br/>        "sentiment": {<br/>        "magnitude": 0.8,<br/>        "score": 0.8<br/>      },<br/>      "text": {<br/>        "beginOffset": 0,<br/>        "content": "I am so happy that the sun is shining here in Munich and we can swim in the Isar."<br/>      }<br/>    }<br/>  ]<br/>}</span></pre><p id="9bce" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">正如你所看到的，NLP API给你一个分数，一个量级，以及检测到的文本语言。这就是为什么我们也可以利用语言。</p><p id="69b2" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">那么我们能用这些信息做什么呢？嗯，根据检测到的情绪，我们可以在系统中设置标签，根据情绪(和语言)做出相应的反应，或者在用户的个人资料中设置一些属性。</p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="2fdb" class="mr lk iq mn b gy ms mt l mu mv">if ($sentiment_score &gt; 0.25) {<br/>    $sentiment = 'positive';<br/>    $addlabel = [3345];<br/>    $removelabel = [3344, 3346];<br/>} elseif (($sentiment_score &gt;= -0.25) &amp;&amp; ($sentiment_score &lt;= 0.25)) {<br/>    $sentiment = 'neutral';<br/>    $addlabel = [3346];<br/>    $removelabel = [3344, 3345];<br/>} elseif ($sentiment_score &lt; -0.25) {<br/>    $sentiment = 'negative';<br/>    $addlabel = [3344];<br/>    $removelabel = [3345, 3346];<br/>} else {<br/>    $sentiment = 'neutral';<br/>    $addlabel = [3346];<br/>    $removelabel = [3344, 3345];<br/>}<br/><br/><br/>$customfields = [<br/>    'customfields' =&gt; [<br/>        'sentiment_score' =&gt; $sentiment_score,<br/>        'sentiment_magnitude' =&gt; $sentiment_magnitude,<br/>        'sentiment' =&gt; $sentiment,<br/>        'language' =&gt; $sentiment_language<br/>    ],<br/>    'addlabel' =&gt; $addlabel,<br/>    'removelabel' =&gt; $removelabel<br/>];</span></pre><p id="9943" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">结果看起来像这样:</p><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi mw"><img src="../Images/077e71b99f7f6ada3ec367b865053867.png" data-original-src="https://miro.medium.com/v2/resize:fit:876/format:webp/1*ypKQJYT-gbRw3-50pnqpRA.png"/></div></figure><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi mx"><img src="../Images/803ce0424facad49cf959b416c2440a9.png" data-original-src="https://miro.medium.com/v2/resize:fit:854/format:webp/1*bdBny7aZx9dzu-Tj5SPwrg.png"/></div></figure><p id="60bb" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">我设置了标签“Gute Stimmung ”,这是德语中“好心情”的意思，我将用户属性“情绪”设置为“积极”,将“语言”设置为“en”。</p><p id="3c4d" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">当然，我们也可以根据心情发送对聊天消息的响应。所以，我们就为这个加个调用吧。</p><pre class="kx ky kz la gt mm mn mo mp aw mq bi"><span id="f6a9" class="mr lk iq mn b gy ms mt l mu mv">if ($sentiment_score &gt; 0.25) {<br/>    $responseText = "Good to hear that you are happy 😀";<br/>    $this-&gt;sendChatResponse($msg['usernumber'], $responseText);<br/>}</span></pre><figure class="kx ky kz la gt lb gh gi paragraph-image"><div class="gh gi my"><img src="../Images/a2254f78de0fd5bbe1c9a3432c74e8bd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*vNDdIDNrTGVM7K0okNPlrg.png"/></div></figure><p id="07dc" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">我希望您对NLP API可能带来的巨大成就有了一个很好的印象。最后但并非最不重要的一点是:当然也有其他供应商提供类似的产品，如微软Azure、IBM Watson或AWS。到目前为止，我还不知道哪个服务返回的结果最好。</p><p id="db9e" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">探索愉快！</p></div></div>    
</body>
</html>