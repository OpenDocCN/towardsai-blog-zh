<html>
<head>
<title>Rasa 101: Building a Weather Assistant</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Rasa 101:构建天气助手</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/rasa-101-building-a-weather-assistant-244489316d11?source=collection_archive---------1-----------------------#2021-01-19">https://pub.towardsai.net/rasa-101-building-a-weather-assistant-244489316d11?source=collection_archive---------1-----------------------#2021-01-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="1061" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/nlp" rel="noopener ugc nofollow" target="_blank">自然语言处理</a></h2><div class=""/><div class=""><h2 id="34e3" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">您将了解什么是RASA框架以及如何使用它</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/25a7a2657110a3b492341bc73a1830b9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*pR-Vu1NGDt-rRFcR.jpeg"/></div></div><figcaption class="la lb gj gh gi lc ld bd b be z dk translated">[来源:<a class="ae le" href="https://rasa.com/" rel="noopener ugc nofollow" target="_blank">拉莎</a> ]</figcaption></figure><p id="8db5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">首先，什么是Rasa？</strong></p><blockquote class="mb mc md"><p id="56a1" class="lf lg me lh b li lj ka lk ll lm kd ln mf lp lq lr mg lt lu lv mh lx ly lz ma ij bi translated">Rasa是一个开源的机器学习框架，用于自动化基于文本和语音的对话。Rasa帮助您构建能够进行分层对话的上下文助手，其中包含大量的来回对话。为了让人类与上下文助手进行有意义的交流，助手需要能够使用上下文来构建之前讨论过的东西——Rasa使您能够构建能够以可扩展的方式完成这一任务的助手。[来源:<a class="ae le" href="https://github.com/RasaHQ/rasa" rel="noopener ugc nofollow" target="_blank"> Rasa </a></p></blockquote><p id="52e4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这意味着使用Rasa，我们可以用最少的编程工作创建聊天机器人。部署更关注对话本身，而不是复杂的编程任务。</p><h2 id="d4eb" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lo mr ms mt ls mu mv mw lw mx my mz iw bi translated">安装Rasa</h2><p id="4d9d" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">我们既可以从源代码安装Rasa，也可以使用<code class="fe nf ng nh ni b">pip</code> (Rasa需要Python 3.6、3.7或3.8)。我建议后者，因为它更简单。我还建议创建一个虚拟环境，因为Rasa有许多依赖项，可能会干扰您的其他包。</p><p id="790a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">首先，让我们检查一下安装的Python和pip版本:</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="06b3" class="mi mj iq ni b gy nn no l np nq">$ python3 --version<br/>$ pip3 --version</span></pre><p id="4a5a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然后我们更新我们的系统:</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="c034" class="mi mj iq ni b gy nn no l np nq">$ sudo apt update<br/>$ sudo apt install python3-dev python3-pip</span></pre><p id="0429" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们创建一个保存在<code class="fe nf ng nh ni b">./venv</code>目录中的虚拟环境，并激活它:</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="eeb4" class="mi mj iq ni b gy nn no l np nq">$ python3 -m venv ./venv<br/>$ source ./venv/bin/activate</span></pre><p id="da07" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">现在我们必须更新我们的pip版本:</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="7c10" class="mi mj iq ni b gy nn no l np nq">$ pip3 install -U pip</span></pre><p id="2b95" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们准备安装Rasa和pip:</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="007f" class="mi mj iq ni b gy nn no l np nq">$ pip3 install rasa<br/><strong class="ni ja">Check the installed rasa version with:<br/></strong>$ rasa --version</span></pre><p id="cba1" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我的系统中安装了<code class="fe nf ng nh ni b">rasa 2.0.2</code>版本。已经发布了更新的版本，但是不要担心，我们的简单实现可以毫无问题地适应它们。</p><p id="0d06" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">创建第一个Rasa项目</strong></p><p id="2aee" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">一个很好的用途是为您正在处理的每个Rasa项目创建一个单独的文件夹。然后，在该文件夹中创建一个Rasa结构项目，包含:</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="2043" class="mi mj iq ni b gy nn no l np nq">$ mkdir weather-assistant<br/>$ cd weather-assistant<br/>$ rasa init --no-prompt</span></pre><p id="325a" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><code class="fe nf ng nh ni b">rasa init</code>命令创建一个包含所有需要的数据、动作和配置文件的新项目。通过使用<code class="fe nf ng nh ni b">--no-prompt</code>,我们将跳过一些关于新项目的问题，以及我们是否希望训练一个默认的Rasa模型。初始模型将基于一些琐碎的例子进行训练，项目结构如下:</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="98be" class="mi mj iq ni b gy nn no l np nq">.<br/>├── actions<br/>│   ├── __init__.py<br/>│   └── actions.py<br/>├── config.yml<br/>├── credentials.yml<br/>├── data<br/>│   ├── nlu.yml<br/>│   ├── rules.yml<br/>│   └── stories.yml<br/>├── domain.yml<br/>├── endpoints.yml<br/>├── models<br/>│   └── &lt;timestamp&gt;.tar.gz<br/>└── tests<br/>   └── test_stories.yml</span></pre><p id="b983" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">简单介绍一下。<strong class="lh ja"> <em class="me"> actions.py </em> </strong>文件包含了我们希望我们的助手执行的所有定制动作(我们将在后面详细讨论)。<strong class="lh ja"> <em class="me"> config.yml </em> </strong>包含Rasa用于训练的管道。<strong class="lh ja"><em class="me">credentials . yml</em></strong>包含您的机器人正在使用的语音和聊天平台的凭证。在<strong class="lh ja"> <em class="me"> nlu.yml </em> </strong>，<strong class="lh ja"> <em class="me"> stories.yml </em> </strong>和<strong class="lh ja"> <em class="me"> rules.yml </em> </strong>中定义了我们助手的所有nlu训练数据。<strong class="lh ja"> <em class="me"> domain.yml </em> </strong>定义了你的助手运作的宇宙。<strong class="lh ja"> <em class="me">端点. yml </em> </strong>包含了你的bot可以使用的不同端点。最后，每个训练好的模型都存储在<strong class="lh ja"> <em class="me">模型</em> </strong>文件夹中，所有用于测试的数据都应该存储在<strong class="lh ja"> <em class="me">测试</em> </strong>文件夹中。</p><p id="9576" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当然，我们不会全部使用。我们将首先写入所有NLU数据，我们将在域文件中定义它们，最后，我们将创建一个自定义操作来获取我们想要的天气数据。</p><h2 id="7234" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lo mr ms mt ls mu mv mw lw mx my mz iw bi translated">创建NLU数据</h2><p id="0503" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">Rasa使用3个<a class="ae le" href="https://yaml.org/spec/1.2/spec.html" rel="noopener ugc nofollow" target="_blank"/>文件管理bot的训练NLU数据，<strong class="lh ja"> <em class="me"> nlu.yml </em> </strong>，<strong class="lh ja"> <em class="me"> stories.yml </em> </strong>和<strong class="lh ja"> <em class="me"> rules.yml </em> </strong>。你可能会碰到<strong class="lh ja"> <em class="me">。md </em> </strong>文件，因为Rasa在以前的Rasa开源1.x版本中使用了它们。它们仍然受到支持，但不推荐使用，因为它们会降低训练速度。</p><p id="55e4" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">回到我们的助手。我们将稍微修改前两个文件。</p><p id="2621" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">nlu . yml:</strong></p><p id="6bab" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">对于助手来说，无论用户如何表达他们的信息，都要识别用户在说什么，我们需要提供助手可以学习的示例信息。</p><blockquote class="nr"><p id="d4d1" class="ns nt iq bd nu nv nw nx ny nz oa ma dk translated">我们根据信息表达的想法或目标对这些例子进行分组，这也被称为意图。</p></blockquote><p id="1456" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">意图及其示例被用作助手的自然语言理解(NLU)模型的训练数据。</p><p id="7d4c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">默认设置创造了这些琐碎的意图:问候，再见，肯定，否认，心情好，心情不好和机器人挑战。我们将添加另外3个意图:天气，天气_城市和城市。</p><p id="dba2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">第一个意图是<code class="fe nf ng nh ni b">weather</code>，用户说他想知道天气:</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="0195" class="mi mj iq ni b gy nn no l np nq">- intent: weather<br/>  examples: |<br/>    - tell me the weather<br/>    - I want to know the weather<br/>    - weather please<br/>    - what's the weather today<br/>    - what's the temperature right now<br/>    - hows the weather going to be<br/>    - i want to know the temperature</span></pre><p id="2a18" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在第二个例子中，<code class="fe nf ng nh ni b">weather_city</code>用户说他想知道一个特定城市的天气。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="5112" class="mi mj iq ni b gy nn no l np nq">- intent: weather_city<br/>  examples: |<br/>    - tell me the weather in [Paris](location)<br/>    - I want to know the weather in [London](location)<br/>    - weather for [Athens](location) please<br/>    - what's the weather today in [Berlin](location)<br/>    - what's the temperature in [Washington](location) right now<br/>    - hows the weather in [Brussels](location)<br/>    - i want the temperature at [Rome](location)</span></pre><p id="d728" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在最后一个例子中，<code class="fe nf ng nh ni b">city</code>用户只提供了一个城市。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="5b09" class="mi mj iq ni b gy nn no l np nq">- intent: city<br/>  examples: |<br/>    - [Liverpool](location)<br/>    - [Milan](location)<br/>    - [Frankfurt](location)<br/>    - [Porto](location)<br/>    - [Madrid](location)<br/>    - [Barcelona](location)<br/>    - [Oslo](location)</span></pre><p id="552d" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">机器人被训练来识别说出的意图并提取其中的实体。在我们的例子中，唯一的实体是城市名<code class="fe nf ng nh ni b">location</code>。</p><p id="8b5f" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja"> The stories.yml: </strong></p><p id="cd1b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">故事是训练助手根据用户之前在对话中所说的内容做出正确反应的示例对话。故事格式显示了用户消息的意图，随后是助手的动作或响应。你的第一个故事应该展示一个对话流，在这个对话流中，助手以一种直接的方式帮助用户完成他们的目标(愉快的路径)。稍后，您可以为用户不想提供他们的信息或切换到不相关的主题(不愉快的路径)的情况添加故事。</p><p id="d097" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们将为我们的简单助手创建2条快乐的路径，但可以随意添加更多快乐或不快乐的路径。每个故事都有以下格式。它有一个专门用于调试和步骤的名称。这里给出了3种步骤，<em class="me">意图</em>(用户所说的话)<em class="me">动作</em>(机器人如何响应)和<em class="me"> slot_was_set </em>(表示一个槽的值已经被修改)。</p><p id="3a86" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在这里，我们可以检查插槽和实体之间的区别。<strong class="lh ja">槽</strong>保存你想在对话中跟踪的信息。它们是助手的记忆。它们充当键值存储，可用于存储用户提供的信息(例如，城市)。<strong class="lh ja">实体</strong>是用户消息中的结构化信息。“实体”部分列出了助理在对话过程中提取的所有实体。</p><blockquote class="nr"><p id="0b6c" class="ns nt iq bd nu nv nw nx ny nz oa ma dk translated">这意味着机器人理解意图中的实体，我们希望这些实体存储在槽中，以便在以后的对话中使用它们的值。</p></blockquote><p id="0009" class="pw-post-body-paragraph lf lg iq lh b li ob ka lk ll oc kd ln lo od lq lr ls oe lu lv lw of ly lz ma ij bi translated">这里重要的是，如果我们用相同的名称定义一个槽和一个实体，它们会被自动映射。当然，您可以手动对它们进行不同的映射，但这超出了本文的范围。</p><p id="7e58" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">让我们看看，现在，我们的两个故事。在第一个例子中，用户询问天气。由于我们不知道是哪个城市，机器人通过<em class="me"> utter_ask_location </em>动作来请求它。这称为<strong class="lh ja">响应</strong>，在域文件中定义。然后提取<em class="me">城市</em>，并进行槽实体映射。我们执行自定义动作<em class="me"> action_get_weather </em>，它在actions.py文件中有详细的定义。最后，为了更好的用户体验，我们将插槽重置为<code class="fe nf ng nh ni b">null</code>。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="2ec2" class="mi mj iq ni b gy nn no l np nq">- story: ask weather happy path<br/>  steps:<br/>  - intent: weather<br/>  - action: utter_ask_location<br/>  - intent: city<br/>    entities:<br/>    - location: Madrid<br/>  - slot_was_set:<br/>    - location: Madrid<br/>  - action: action_get_weather<br/>  - slot_was_set:<br/>    - location: null</span></pre><p id="1ae9" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在第二种情况下，用户的意图是<code class="fe nf ng nh ni b">weather_city</code>，这意味着他首先提供了确切的位置。因此，我们将实体映射到插槽，执行自定义操作并重置插槽。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="b50b" class="mi mj iq ni b gy nn no l np nq">- story: ask weather with city happy path<br/>  steps:<br/>  - intent: weather_city<br/>    entities:<br/>    - location: Rome<br/>  - slot_was_set:<br/>    - location: Rome<br/>  - action: action_get_weather<br/>  - slot_was_set:<br/>    - location: null</span></pre><p id="3aa7" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">作为机器人的一个例子，你可以看到实体和插槽被特别设置在一个故事中(这里是马德里和罗马)。这有助于助手了解如何将实体的值映射到适当的槽。</p><p id="e38c" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">domain . yml:</strong></p><p id="ed05" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">这个文件是最重要的。它明确地定义了我们模型的所有配置，助手将在其中运行的世界。在这个文件中，我们列出了我们想要助手理解和处理的所有意图、响应、实体、槽和动作。下面我们在适当的部分为我们的天气助手添加数据。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="6e5a" class="mi mj iq ni b gy nn no l np nq">intents:<br/>  - weather<br/>  - weather_city<br/>  - city</span><span id="5574" class="mi mj iq ni b gy og no l np nq">entities:<br/>  - location</span><span id="045a" class="mi mj iq ni b gy og no l np nq">slots:<br/>  location:<br/>    type: text<br/>    influence_conversation: true</span><span id="a3ea" class="mi mj iq ni b gy og no l np nq">responses:<br/>  utter_ask_location:<br/>  - text: "For which city?"</span><span id="9fb7" class="mi mj iq ni b gy og no l np nq">actions:<br/>  - action_get_weather</span></pre><h2 id="74a6" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lo mr ms mt ls mu mv mw lw mx my mz iw bi translated">编写自定义操作</h2><p id="5a58" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">我们最后要修改的文件是<strong class="lh ja"> <em class="me"> actions.py </em> </strong>。自定义操作用于运行您想要的任何代码，例如调用API或查询数据库。我们将在这里做第一个。我们使用<a class="ae le" href="https://openweathermap.org/" rel="noopener ugc nofollow" target="_blank"> OpenWeatherMap </a> API，因为它简单且免费。你只需要创建一个基本的免费账户，你就可以通过API密匙访问他们的数据。</p><p id="0cb2" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">为了使Rasa能够与这些自定义操作(即<em class="me">操作服务器</em>)进行交互，必须启用该端点。接下来的两行在<strong class="lh ja"><em class="me">endpoints . yml</em></strong>文件中被注释掉，我们必须撤销它。如您所见，Rasa通过5055端口与动作服务器通信。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="2904" class="mi mj iq ni b gy nn no l np nq">action_endpoint:<br/> url: "<a class="ae le" href="http://localhost:5055/webhook" rel="noopener ugc nofollow" target="_blank">http://localhost:5055/webhook</a>"</span></pre><p id="ee80" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">我们创建一个动作类，并将其名称定义为<code class="fe nf ng nh ni b">action_get_weather</code>。该名称必须在actions部分下的域文件中定义。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="a120" class="mi mj iq ni b gy nn no l np nq">import requests<br/>from rasa_sdk import Action<br/>from rasa_sdk.events import SlotSet</span><span id="2586" class="mi mj iq ni b gy og no l np nq">class ActionGetWeather(Action):<br/>    """ Return today's weather forecast"""</span><span id="8967" class="mi mj iq ni b gy og no l np nq">def name(self):<br/>      return "action_get_weather"</span></pre><p id="dee5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">接下来，当我们的助手触发这个动作时，将执行<code class="fe nf ng nh ni b">run</code>方法。该方法使用了<em class="me">调度器</em>、<em class="me">、</em>、<em class="me">跟踪器</em>和<em class="me">域</em>组件。<em class="me">调度器</em>用于通过<code class="fe nf ng nh ni b">utter_message</code>方法将消息发送回用户。状态<em class="me">跟踪器</em>跟踪整个对话，这里用于使用<code class="fe nf ng nh ni b">tracker.get_slot(location)</code>访问槽值。<em class="me">域</em>包含机器人的域。</p><p id="c655" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在下一个方法中，检索槽的值，向天气API发出一个<em class="me"> get </em>请求，并将结果返回给用户。如果出现问题，机器人会说出来。最后，<code class="fe nf ng nh ni b">SlotSet("location", None)</code>重置插槽。这样，用户可以再次请求不同城市的天气预报。我认为最好有一个更通用的助手。更现实的实现是，如果存储了一个永久的城市，机器人会要求用户确认这是否是他们想要了解的城市。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="9c14" class="mi mj iq ni b gy nn no l np nq">def run(self, dispatcher, tracker, domain):</span><span id="7db5" class="mi mj iq ni b gy og no l np nq">city = tracker.get_slot('location')<br/>  api_token = &lt;YOUR_API_TOKEN&gt;<br/>  url = "<a class="ae le" href="https://api.openweathermap.org/data/2.5/weather" rel="noopener ugc nofollow" target="_blank">https://api.openweathermap.org/data/2.5/weather</a>"<br/>  payload = {"q": city, "appid": api_token, "units": "metric", "lang": "en"}<br/>  response = requests.get(url, params=payload)<br/>  if response.ok:<br/>    description = response.json()["weather"][0]["description"]<br/>    temp = round(response.json()["main"]["temp"])<br/>    city = response.json()["name"]<br/>    msg = f"The current temperature in {city} is {temp} degree Celsius. Today's forecast is {description}"<br/>  else:<br/>    msg = "I'm sorry, an error with the requested city as occured."</span><span id="1606" class="mi mj iq ni b gy og no l np nq">dispatcher.utter_message(msg)<br/>  return [SlotSet("location", None)]</span></pre><h2 id="c55f" class="mi mj iq bd mk ml mm dn mn mo mp dp mq lo mr ms mt ls mu mv mw lw mx my mz iw bi translated">训练你的模型</h2><p id="6f1d" class="pw-post-body-paragraph lf lg iq lh b li na ka lk ll nb kd ln lo nc lq lr ls nd lu lv lw ne ly lz ma ij bi translated">现在我们准备训练我们的模型。很简单，我们输入:</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="009d" class="mi mj iq ni b gy nn no l np nq">$ rasa train</span></pre><p id="6774" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">培训完成后，我们可以开始和我们的助理交谈。首先，我们必须初始化动作服务器，代码写在<em class="me"> actions.py </em>文件中。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="0972" class="mi mj iq ni b gy nn no l np nq">$ rasa run actions</span></pre><p id="91c5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">然后，我们打开一个新的bash，并与助手聊天，我们将使用最简单的选择。使用下一个命令，我们可以通过命令提示符与我们的模型聊天。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="c379" class="mi mj iq ni b gy nn no l np nq">$ rasa shell</span></pre><p id="652b" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">当然，还有更高级的选择，比如<a class="ae le" href="https://rasa.com/docs/rasa-x/" rel="noopener ugc nofollow" target="_blank"> Rasa X </a>，它包含一个GUI，是改进你的模型的一个很好的工具。您也可以使用<code class="fe nf ng nh ni b">rasa run</code>来启动Rasa服务器，并且您可以通过POST请求与助手通信。</p><p id="88c5" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">可视化模型</strong></p><p id="0520" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">Rasa附带了一个工具，可以通过下一个命令生成您的故事的可视化表示。</p><pre class="kp kq kr ks gt nj ni nk nl aw nm bi"><span id="f5f7" class="mi mj iq ni b gy nn no l np nq">$ rasa visualize</span></pre><p id="6f43" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated">在下一张图中，所有的故事都被可视化了。意图显示在蓝色方框中，机器人的响应显示在白色方框中。因为我们没有删除最初的Rasa数据，所以你会看到很多故事。我们的天气助手，两个创建的故事，在右边的两个管道中可视化。</p><blockquote class="nr"><p id="f42e" class="ns nt iq bd nu nv nw nx ny nz oa ma dk translated">这个图是一个很好的工具，可以清楚地了解所创建的代理。</p></blockquote><figure class="oi oj ok ol om kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi oh"><img src="../Images/afff3f5ff9c322ba4c4a2ae6f696f765.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WYDmB7ek5dtFcwmZ5RtLHg.png"/></div></div></figure><blockquote class="mb mc md"><p id="e286" class="lf lg me lh b li lj ka lk ll lm kd ln mf lp lq lr mg lt lu lv mh lx ly lz ma ij bi translated">谢谢大家！你可以在这个<a class="ae le" href="https://github.com/malamasn/rasa-weather-assistant" rel="noopener ugc nofollow" target="_blank"> <strong class="lh ja"> GitHub </strong> repo </a>里找到以上所有代码。</p></blockquote><p id="4491" class="pw-post-body-paragraph lf lg iq lh b li lj ka lk ll lm kd ln lo lp lq lr ls lt lu lv lw lx ly lz ma ij bi translated"><strong class="lh ja">参考文献</strong></p><ul class=""><li id="f53a" class="on oo iq lh b li lj ll lm lo op ls oq lw or ma os ot ou ov bi translated">Rasa官方文件:<a class="ae le" href="https://rasa.com/docs/rasa/" rel="noopener ugc nofollow" target="_blank">https://rasa.com/docs/rasa/</a></li><li id="c951" class="on oo iq lh b li ow ll ox lo oy ls oz lw pa ma os ot ou ov bi translated">Udemy的Rasa工作坊:<a class="ae le" href="https://www.udemy.com/course/rasa-certification-workshop/" rel="noopener ugc nofollow" target="_blank">https://www.udemy.com/course/rasa-certification-workshop/</a></li><li id="a359" class="on oo iq lh b li ow ll ox lo oy ls oz lw pa ma os ot ou ov bi translated">Rasa官方大师班:<a class="ae le" href="https://www.youtube.com/playlist?list=PL75e0qA87dlHQny7z43NduZHPo6qd-cRc" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/playlist?list = pl 75 E0 QA 87 dlhqny 7 z 43 nduzhpo 6 qd-cRc</a></li><li id="83b1" class="on oo iq lh b li ow ll ox lo oy ls oz lw pa ma os ot ou ov bi translated">项目GitHub回购:<a class="ae le" href="https://github.com/malamasn/rasa-weather-assistant" rel="noopener ugc nofollow" target="_blank">https://github.com/malamasn/rasa-weather-assistant</a></li></ul></div></div>    
</body>
</html>