<html>
<head>
<title>Credit Card Fraud Detection in R: Best AUC Score 99.2%</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">R中的信用卡欺诈检测:最佳AUC得分为99.2%</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/https-medium-com-mishtert-credit-card-fraud-detection-using-light-gbm-with-smote-data-in-r-fe28e63d5c6f?source=collection_archive---------2-----------------------#2019-12-02">https://pub.towardsai.net/https-medium-com-mishtert-credit-card-fraud-detection-using-light-gbm-with-smote-data-in-r-fe28e63d5c6f?source=collection_archive---------2-----------------------#2019-12-02</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div class="gh gi io"><img src="../Images/941fb420259dfc6fcaf6e54a28865a87.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*xAGz8Spb1od3LS0-bVQdKQ.png"/></div></figure><h2 id="43a3" class="iv iw ix bd b dl iy iz ja jb jc jd dk je translated" aria-label="kicker paragraph">欺诈|异常检测</h2><div class=""/><div class=""><h2 id="cc76" class="pw-subtitle-paragraph kd jg ix bd b ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ku dk translated">轻型GBM模型&amp;不平衡数据集中的合成数据点</h2></div><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi kv"><img src="../Images/d65760a17d0863026aa079af5beb0193.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rE2Yvjc5h7P_u7wrhieAEg.jpeg"/></div></div></figure><h1 id="0b66" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated">什么是轻GBM</h1><p id="7402" class="pw-post-body-paragraph lw lx ix ly b lz ma kh mb mc md kk me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi ms translated">ight GBM是一个高性能的梯度推进(GBDT、GBRT、GBM或MART)框架，用于分类、机器学习和排名相关的任务。</p><p id="6b0d" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">轻型GBM纵向生长树<strong class="ly jh"><em class="ng"/></strong>而其他算法横向生长树<strong class="ly jh"><em class="ng"/></strong>。</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi nh"><img src="../Images/ad50ec9e41d1a929f5fcf69d32ebb176.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*YGkAuYiey8zJA2IMvHBASA.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">轻型GBM</figcaption></figure><p id="00dd" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">Light GBM按叶生长树<strong class="ly jh"><em class="ng"/></strong>而其他算法按层生长<strong class="ly jh"><em class="ng"/></strong>。具有最大delta损失的叶子生长。通过生长相同的叶子，逐叶算法可以比逐层算法减少更多的损失。</p><p id="8c68" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">Light GBM因其速度而受到关注(Light GBM中的Light这个名称意味着速度)，并且已知使用<strong class="ly jh">低内存</strong>和<strong class="ly jh">专注于准确性</strong>以及<strong class="ly jh">支持GPU学习。</strong></p><blockquote class="nm nn no"><p id="6cd0" class="lw lx ng ly b lz nb kh mb mc nc kk me np nd mh mi nq ne ml mm nr nf mp mq mr ij bi translated"><strong class="ly jh">优点:</strong></p></blockquote><ul class=""><li id="c424" class="ns nt ix ly b lz nb mc nc mf nu mj nv mn nw mr nx ny nz oa bi translated">训练速度更快，效率更高</li><li id="bf86" class="ns nt ix ly b lz ob mc oc mf od mj oe mn of mr nx ny nz oa bi translated">低内存使用率</li><li id="e690" class="ns nt ix ly b lz ob mc oc mf od mj oe mn of mr nx ny nz oa bi translated">更高的精确度</li><li id="e058" class="ns nt ix ly b lz ob mc oc mf od mj oe mn of mr nx ny nz oa bi translated">并行和GPU学习支持</li><li id="61ec" class="ns nt ix ly b lz ob mc oc mf od mj oe mn of mr nx ny nz oa bi translated">轻松处理大规模数据。</li></ul><p id="03ba" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">一般来说，不建议对小数据集使用轻量级GBM，因为担心过度拟合。</p><p id="cca3" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">在本文中，SMOTE数据集上的Light GBM用于探索AUC相对于原始不平衡数据集如何提高。</p><h1 id="ad2c" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated"><strong class="ak">关于数据</strong></h1><p id="2606" class="pw-post-body-paragraph lw lx ix ly b lz ma kh mb mc md kk me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">本例使用的数据来自<a class="ae og" href="https://www.kaggle.com/mlg-ulb/creditcardfraud" rel="noopener ugc nofollow" target="_blank"> <strong class="ly jh"> Kaggle —信用卡欺诈检测</strong> </a></p><p id="2617" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">数据集包含欧洲持卡人在2013年9月的信用卡交易。该数据集显示了两天内发生的交易，其中284，807笔交易中有492笔欺诈。</p><p id="cacb" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">数据集高度不平衡，正类(欺诈)占所有交易的0.172%。</p><p id="b811" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">它只包含作为PCA变换结果的数字输入变量。不幸的是，由于保密问题，原始特征和更多关于数据的背景信息没有提供。</p><p id="622d" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">V1、V2……v 28是通过五氯苯甲醚获得的主要成分，唯一没有通过五氯苯甲醚转化的特征是“时间”和“数量”。特征“时间”包含数据集中每个事务和第一个事务之间经过的秒数。</p><p id="9db1" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">特征“金额”是交易金额，该特征可用于依赖于示例的成本敏感学习。特征“类别”是响应变量，在欺诈的情况下取值1，否则取值0。</p><h1 id="2293" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated">模型的准确性</h1><p id="09d6" class="pw-post-body-paragraph lw lx ix ly b lz ma kh mb mc md kk me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi translated">鉴于类别不平衡率，建议使用精确度-召回曲线下的面积(AUPRC)来测量精确度。混淆矩阵精度对于不平衡分类没有意义。精确回忆曲线下的区域(AUPRC)</p><p id="735a" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">出于解释的目的，我在本文中捕获了AUC。</p><h1 id="579c" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated">加载库和读取数据</h1><pre class="kw kx ky kz gt oh oi oj ok aw ol bi"><span id="6fa7" class="om lf ix oi b gy on oo l op oq">library(tidyverse) # metapackage with lots of helpful functions<br/>library(lightgbm) # loading LightGBM<br/>library(pROC) # to use with AUC<br/>library(smotefamily) #create SMOTE dataset<br/>library(RColorBrewer)#used for chart<br/>library(scales) #used for chart</span></pre><p id="d851" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">阅读数据和快速检查表明，数据是不平衡的，99%以上的数据被标记为非欺诈，而&lt;1% tagged as fraud transactions.</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi or"><img src="../Images/dfdcf925f25fefbf83613a96816728cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VUB_5IJ5BBxBxLPsUMfNUg.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">~99.83%% non-fraud transaction</figcaption></figure><p id="ae3e" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">Not much of EDA was performed since the data has been anonymized and doesn’t contain any explainable features except for Time (between transactions which cannot be used meaningfully in my opinion), Amount &amp; Class.</p><p id="fe50" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">So it was decided to directly get into training the model and to predict with the test set.</p><p id="b41b" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">First, the model was trained and tested with original imbalance data to understand the performance.</p><h1 id="aea6" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated">Light GBM Parameters for Original Data</h1><blockquote class="nm nn no"><p id="c37d" class="lw lx ng ly b lz nb kh mb mc nc kk me np nd mh mi nq ne ml mm nr nf mp mq mr ij bi translated">Parameter tuning or whole set of available parameters for Light GBM are not discussed here since it’s not in scope of this article</p></blockquote><p id="2601" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">Selected “auc” as metric since confusion matrix may not be the right measure for accuracy for this dataset.</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi os"><img src="../Images/e0ce34977b85e8243fda90c3f0c36173.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*2FXVXRxpI0uWHlVIFOxr5Q.png"/></div></figure><p id="aa34" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">with simple parameter tuning, we were able to get 97.99% AUC with 13 features selected as important</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ot"><img src="../Images/6d7086d8c8af451ea5de618a9a1f8f53.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NXU60RUWtLtetcF42R5m-g.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">97.99% AUC with 13 features selected</figcaption></figure><h1 id="e059" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated">Synthetic Minority Oversampling Technique (SMOTE)</h1><p id="9d58" class="pw-post-body-paragraph lw lx ix ly b lz ma kh mb mc md kk me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi ms translated"><span class="l mt mu mv bm mw mx my mz na di">是一种以平衡方式增加数据集中案例数量的</span>统计技术。该模块通过从您作为输入提供的现有少数案例生成新实例来工作。新手可以阅读<a class="ae og" href="http://rikunert.com/SMOTE_explained" rel="noopener ugc nofollow" target="_blank">这里</a>更好的理解。</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ou"><img src="../Images/6c94b98a0445682d9fdaacb0a4ac3d3b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Hmr4tgeceT8hG0lmJCGKaw.png"/></div></div><figcaption class="ni nj gj gh gi nk nl bd b be z dk translated">图片来自:<a class="ae og" href="https://www.researchgate.net/publication/276039577/figure/fig1/AS:612936859000832@1523146943418/Advantages-of-SMOTE-Black-red-and-blue-dots-indicate-majority-class-samples-minority.png" rel="noopener ugc nofollow" target="_blank">Advantages-SMOTE-Black-red-and-blue-dots-indicate-major-class-samples-minority . png</a></figcaption></figure><h1 id="f706" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated">使用SMOTE技术创建数据</h1><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ov"><img src="../Images/219b7029d759fec20a7f4bfda684c163.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8DVA-2woKRaSm82ofydbjA.png"/></div></div></figure><p id="d911" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">在上图中，代码的第一行表示，我们预计非欺诈交易数据占总交易的65%，其余35%为欺诈交易。</p><p id="f37f" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">生成新的合成数据点后，数据集包含约35%标记为欺诈的交易。实施SMOTE后，可以看到在实际欺诈交易附近生成了更多的合成数据。如果您已经看到了上面的代码行，我们选择了K=5，这将解释新数据点集中在原始数据点周围的原因。</p><h1 id="536f" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated">左:原始数据|右:SMOTE数据</h1><p id="b43b" class="pw-post-body-paragraph lw lx ix ly b lz ma kh mb mc md kk me mf mg mh mi mj mk ml mm mn mo mp mq mr ij bi ms translated">基于SMOTE数据的轻量级GBM参数和模型训练</p><div class="kw kx ky kz gt ab cb"><figure class="ow is ox oy oz pa pb paragraph-image"><img src="../Images/60e393fceac0b2087f670cec45c6cd2e.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*KcS2JWOe7CJkCd122tA7qQ.png"/></figure><figure class="ow is pc oy oz pa pb paragraph-image"><img src="../Images/2665343d991dfa2af1a1bb905c1eafe7.png" data-original-src="https://miro.medium.com/v2/resize:fit:842/format:webp/1*Jp1akaM3Wc6YzgBk1dCL5Q.png"/><figcaption class="ni nj gj gh gi nk nl bd b be z dk pd di pe pf translated">参数调整与用于提高AUC的原始数据略有不同。</figcaption></figure></div><h1 id="3545" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi translated">“结果是AUC为98.21%，最佳得分为99.2%，7个特征被捕获为重要特征，而原始数据为13个特征。”</h1><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi pg"><img src="../Images/2cd0f5360f2b2ccc517ba76cd2e1236a.png" data-original-src="https://miro.medium.com/v2/resize:fit:746/format:webp/1*0x3Ifmh_IZc_l5sgOBF-Sg.png"/></div></figure><p id="b578" class="pw-post-body-paragraph lw lx ix ly b lz nb kh mb mc nc kk me mf nd mh mi mj ne ml mm mn nf mp mq mr ij bi translated">特征重要性比较</p><figure class="kw kx ky kz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ph"><img src="../Images/75ba976f6e63a189cfc92cccec78b2f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*D7z0A0h5sdhRuZrMVlNF4g.png"/></div></div></figure><blockquote class="pi"><p id="bfd1" class="pj pk ix bd pl pm pn po pp pq pr mr dk translated">左:原始数据|右:SMOTE数据</p></blockquote><h1 id="0eb2" class="le lf ix bd lg lh li lj lk ll lm ln lo km ps kn lq kp pt kq ls ks pu kt lu lv bi translated">AUC、迭代和最佳分数的比较</h1><div class="kw kx ky kz gt ab cb"><figure class="ow is pv oy oz pa pb paragraph-image"><img src="../Images/045d849ac0d369b4ecc11c4f669f3100.png" data-original-src="https://miro.medium.com/v2/resize:fit:846/format:webp/1*eLCaWQN9eLIiUwvuq5YpNA.png"/></figure><figure class="ow is pw oy oz pa pb paragraph-image"><img src="../Images/f1537f25fb3db42769f6b64faa00c4f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*CljPBiOgqbzoXR6Fz80HCg.png"/><figcaption class="ni nj gj gh gi nk nl bd b be z dk pd di pe pf translated">SMOTE数据的最佳AUC评分为99.2%对98.2%</figcaption></figure></div><h1 id="b668" class="le lf ix bd lg lh li lj lk ll lm ln lo km lp kn lq kp lr kq ls ks lt kt lu lv bi">Comparison of AUC &amp; Iteration &amp; Best Score</h1><blockquote class="nm nn no"><p id="27be" class="lw lx ng ly b lz nb kh mb mc nc kk me np nd mh mi nq ne ml mm nr nf mp mq mr ij bi">The best AUC score for SMOTE data was 99.2% vs. 98.2%</p></blockquote><figure class="kw kx ky kz gt is gh gi paragraph-image"><div class="gh gi px"><img src="../Images/11cad025fa10d95c91b7060f231e7ccd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1368/format:webp/1*VQ8yBR0yhQ2luYVBictnDw.png"/></div></figure></div></div>    
</body>
</html>