<html>
<head>
<title>Image Segmentation of Rotating iPhone With Scikit-image</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Scikit-image实现旋转iPhone的图像分割</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/image-segmentation-of-rotating-iphone-with-scikit-image-3e27e5fad7a8?source=collection_archive---------4-----------------------#2022-08-23">https://pub.towardsai.net/image-segmentation-of-rotating-iphone-with-scikit-image-3e27e5fad7a8?source=collection_archive---------4-----------------------#2022-08-23</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="c61f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现代设备充满了不同的传感器:前后摄像头、加速度计、陀螺仪、磁力计、GPS等。智能使用这些设备可以实现大量有趣的应用，如指南针、位置检测和游戏。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/87ed8dcf76ce2a72388de7a068079121.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*I4lzHp6DNAItVU0d"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated">尼基塔·维诺格拉多夫在<a class="ae lb" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄的照片。试着把这只猫从背景中分割出来:)</figcaption></figure><p id="c762" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">其中一个应用是检测iPhone在太空中的方位，这可以通过加速度计和陀螺仪的数据来完成。在<a class="ae lb" href="https://towardsdatascience.com/sensor-fusion-explained-with-rotating-iphone-fecbcd0df144" rel="noopener" target="_blank">之前的博文</a>中，我写了利用iPhone的两个传感器:陀螺仪和加速度计的数据来检测iPhone绕一个轴的方向。iPhone方位的重建与视频进行了对比。使用传感器重建的方向结果与视频中描述的方向定性匹配良好:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lc"><img src="../Images/6e1b2c51c0a2f39e51f17805ff3e629e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*y7Zd9TC1kRhSOxnkIAUHAA.gif"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="ld">作者图片</em></figcaption></figure><p id="98d0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在这篇博文中，我介绍了利用图像分割从视频中提取iPhone倾斜角度的方法。然后，我展示了两种测量方法之间的误差比较。让我引导你通过。</p><h2 id="e8de" class="le lf iq bd lg lh li dn lj lk ll dp lm jy ln lo lp kc lq lr ls kg lt lu lv lw bi translated">视频准备</h2><p id="3599" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">在开始分段之前，需要做一些准备工作。我的视频是用iPhone录制的，帧率是可变的。为了使视频时钟与传感器时钟同步，恒定的帧速率是优选的。因此，第一步是将视频转换为恒定的帧速率。下一步是将视频分割成图像，每一帧对应一个jpeg图像。整个图像数据集可以在<a class="ae lb" href="https://rotatingiphone.s3.eu-central-1.amazonaws.com/video_red.zip" rel="noopener ugc nofollow" target="_blank">这里</a>找到。</p><h2 id="2b67" class="le lf iq bd lg lh li dn lj lk ll dp lm jy ln lo lp kc lq lr ls kg lt lu lv lw bi translated">基于Mask-R-CNN的深度学习方法</h2><p id="b7dc" class="pw-post-body-paragraph jn jo iq jp b jq lx js jt ju ly jw jx jy lz ka kb kc ma ke kf kg mb ki kj kk ij bi translated">当我们谈论图像的分割时，尝试一些很酷的深度学习算法并希望它能起作用是一种很大的诱惑。循着这种诱惑，我尝试了预先训练好的Mask-RCNN。幸运的是，手机是最初模型被训练的课程之一。第一个结果相当令人印象深刻，如下图所示:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/ae32c3e1ab566449e74b9ff2788b4054.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7l4EsdmASqSt4UAmmeo7ug.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="ld">作者图片</em></figcaption></figure><p id="991d" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">然而，经过更仔细的调查，似乎iPhone的一些图像被错误地识别了(见下图):</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/bfd94a64a404a65cb5fd4157481c8c64.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vbExnt88u6BXZ9G1pT7Tow.png"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="ld">作者图片</em></figcaption></figure><p id="cbf8" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">就像许多现实生活中的数据科学项目一样，深度学习模型的结果出人意料地好，但并没有完全达到预期。至少不是对整个数据集。克服这一挑战的一个选择是标记数据并微调原始模型。然而，鉴于这是一部几乎白色背景的红色iPhone，应该有一些更简单的方法。让我们看看它们。</p><p id="aea2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用RGB图像的经典CV方法</strong></p><p id="0b86" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">为了分割图像，我们首先尝试使用图像的三通道RGB表示，即红色、绿色和蓝色。红色对应于第一个非常高的数字，而第二个和第三个数字应该很低，有点像(255，0，0)。在这种情况下，我们可以选择所有红色像素，并希望它是iPhone。为了捕捉更多的红色阴影，我试图过滤掉第一个通道(红色)的颜色值大于130的所有像素。对于第二和第三通道，我过滤低于60的像素。这是代码。</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="38ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这种方法产生了相当好的结果:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/e19555ef0fe19c6e590e72b7bc2dbd6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QNbhpmJVcXNCoi15Cg9yXw.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="ld">作者图片</em></figcaption></figure><p id="9971" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">iPhone上还有一个摄像头“洞”，是黑色的，因此没有分段。我们可以用scikit-image工具来填补这个漏洞:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="1cc3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">人们必须设置要填充的洞的面积和要过滤掉的小物体。我选择40000作为面积。现在，细分确实包括了iPhone的摄像头:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/e059f0102f84192f2b562dc6d2e615ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Pj2Ji0y1Nr27RWitM82SBA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="ld">作者图片</em></figcaption></figure><p id="25f0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">因此，基于RGB表示的红色的分割在一幅图像上工作良好。然而，在对所有图像运行这种基于阈值的算法后，我发现有一些分割不准确:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/ad13eae39227060df321bf3abfb5d71f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XOa7YmJqMGvMjfENmMIeIA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="ld">作者图片</em></figcaption></figure><p id="f3b1" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这些不准确性可以通过操纵红色、绿色和蓝色的阈值来解决。但是，如果我们放松参数，蒙版开始捕捉棕色:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/b679866037a4ba252fc0219db519afaf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*juqQ0FFGZfzDhia8A8S2AA.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="ld">作者图片</em></figcaption></figure><p id="37d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">仍然可以在RGB中使用阈值。但是，至少有三个参数需要优化(红色、绿色和蓝色的阈值)。更简单的方法是将其减少到只有一个可调参数。为此，我们可以考虑用不同的颜色表示iPhone图像。</p><p id="579a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">使用HED图像的经典CV方法</strong></p><p id="84ea" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">在scikit-image库中，有几种从RGB到不同颜色表示的转换。我在处理旋转的iPhones图片时遇到的一个挑战是如何区分暗红色和棕色。这种颜色分离在苏木精-曙红-DAB (HED)颜色空间中得到了很好的解决，其中苏木精为深蓝色-紫色，曙红为粉红色，DAB为棕色。红色iPhone通过这种颜色表示的曙红通道可以很好地检测到，这解决了将其与棕色混淆的问题，因为棕色显示为DAB。在HED表示中，我们在曙红通道中只有一个阈值需要调整。基于曙红通道和阈值0.05，对RGB具有挑战性的图像的遮罩被正确捕获。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi mg"><img src="../Images/385243f4135273fae95cd0798a5c31a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*iq8R2lMeaJJ-GuxkExmqRA.png"/></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="ld">作者图片</em></figcaption></figure><p id="b014" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Scikit-image还提供了测量分割区域属性的工具。在其他属性中，可以测量iPhone的方向:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="b928" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">完整的分割算法将导致:</p><figure class="km kn ko kp gt kq"><div class="bz fp l di"><div class="md me l"/></div></figure><p id="49f6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">定性比较将导致:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mh"><img src="../Images/5246f4d438e5e30740c1f9ba64681149.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*y4_XmPnuiRf7lueBC_3BnA.gif"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="ld">作者图片</em></figcaption></figure><p id="adfd" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">定量比较</strong></p><p id="dfb6" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">现在可以将从分割中得到的倾斜角与从传感器数据中得到的倾斜角进行比较。它给出了一个很好的匹配:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/d30533054cddbd4761dbf53596c1208a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RQoVjoSNQ8Tydug_HhiZYQ.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="ld">作者图片</em></figcaption></figure><p id="2a90" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">传感器和视频插值之间的绝对误差为:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/d01362a0e1f5f47cd9ee2517dde0261f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Ww-uyo3NMHbg0z_zExcJ0A.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="ld">作者图片</em></figcaption></figure><p id="2cf4" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">我们可以看到，旋转越快，两种方法之间的误差越大。这也可以在前面0.5秒的旋转速度的滚动平均值对误差的曲线图上看到:</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mf"><img src="../Images/4c92d46d0ec4611f0c0433dc024952f5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FRu-EUHSWqm1LaCVNsC4eg.jpeg"/></div></div><figcaption class="kx ky gj gh gi kz la bd b be z dk translated"><em class="ld">作者图片</em></figcaption></figure><p id="997f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">附注:我要感谢我的妻子卡佳和弗拉季斯拉夫·罗索夫对邮报的帮助。</p></div></div>    
</body>
</html>