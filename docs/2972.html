<html>
<head>
<title>Reading Large Kaggle Dataset With PySpark in Google Colab</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用PySpark在Google Colab中读取大型Kaggle数据集</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/reading-large-kaggle-dataset-with-pyspark-in-google-colab-41aebb7a89c8?source=collection_archive---------0-----------------------#2022-07-21">https://pub.towardsai.net/reading-large-kaggle-dataset-with-pyspark-in-google-colab-41aebb7a89c8?source=collection_archive---------0-----------------------#2022-07-21</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="7482" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">减少本地下载/安装过程，远程和可重复地完成大部分部件</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/12abe04141d6ba3e23575947d4eef16c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*NT0S9xQ5Z8XhEeUtB3ZOhQ.jpeg"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自<a class="ae ky" href="https://unsplash.com/photos/pB3__mUOTFE" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><p id="5968" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">和我的许多同行一样，我尽可能避免在本地安装或设置环境。我尝试用远程环境替代工作，并远程完成/存储80%的工作。这包括避免在本地下载文件或在本地长时间保存文件。</p><blockquote class="lv lw lx"><p id="0a79" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">这可能是因为我无法在本地高效地跟踪依赖版本，或者我对拥有一个干净整洁的本地文件夹有多么挑剔，或者前面提到的两个原因带来了不必要的压力。再现性也是一个问题。</p><p id="8961" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">除非你把它和course🧐联系起来</p></blockquote><p id="c827" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当试图在本地安装时，Pyspark通常是一个麻烦。根据您之前安装的软件包/软件，它可能会与Pyspark的安装步骤冲突。与其试图去理解背后的“<strong class="lb iu">火箭科学</strong>”，不如用几行代码来说明如何安装Pyspark并在Google Colabs上远程使用它。</p><blockquote class="lv lw lx"><p id="6cf0" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">此外，如果您像我一样对快速设置环境或进行POC(概念验证)不耐烦，这会给您带来快乐😋</p></blockquote><h1 id="48bf" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第一步</h1><h2 id="6937" class="mu md it bd me mv mw dn mi mx my dp mm li mz na mo lm nb nc mq lq nd ne ms nf bi translated">为了跟随这个演示并在Colabs上读取Pyspark中的实际数据，我们需要利用Kaggle数据集API</h2><ul class=""><li id="9edb" class="ng nh it lb b lc ni lf nj li nk lm nl lq nm lu nn no np nq bi translated">确保您有一个Kaggle帐户。</li><li id="c70d" class="ng nh it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">前往你的Kaggle个人资料页面，点击<strong class="lb iu">账户</strong></li><li id="8f7c" class="ng nh it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">在页面上向下滚动到<strong class="lb iu"> API。</strong>点击<strong class="lb iu">创建新的API。</strong>自动下载一个名为<strong class="lb iu"> kaggle.json </strong>的文件。它包含您的API凭证。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nw"><img src="../Images/55250ec4bac31f134e8470926a7cb191.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OiTHkft_pKwRCrQcsLK4QQ.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自作者</figcaption></figure><blockquote class="lv lw lx"><p id="6e5c" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">我保证这是你为这篇文章做的唯一下载</p></blockquote><ul class=""><li id="51e5" class="ng nh it lb b lc ld lf lg li nx lm ny lq nz lu nn no np nq bi translated">打开你谷歌硬盘，把下载的文件上传到你的谷歌硬盘。最好不要放在google drive的文件夹中</li></ul><blockquote class="lv lw lx"><p id="edf0" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">此时，您可以删除本地计算机上的文件。这是最棒的部分</p></blockquote><ul class=""><li id="d664" class="ng nh it lb b lc ld lf lg li nx lm ny lq nz lu nn no np nq bi translated">打开一个新的Colabs笔记本</li><li id="41d9" class="ng nh it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">接下来，在Colab中安装你的google drive，如下图所示</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oa"><img src="../Images/7e28777c0a314dc46b395ecfda254e8e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WwZTQZw4VvSrnMwVp02N4Q.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自本文<a class="ae ky" href="https://www.analyticsvidhya.com/blog/2021/06/how-to-load-kaggle-datasets-directly-into-google-colab/" rel="noopener ugc nofollow" target="_blank">文章</a></figcaption></figure><blockquote class="lv lw lx"><p id="fe28" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">干得好！，您已经完成了25%,下一步是在notebook🥳.设置kaggle</p></blockquote><h1 id="8b4b" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第二步</h1><p id="560a" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li ob lk ll lm oc lo lp lq od ls lt lu im bi translated">假设我们想要分析来自这个数据点超过1亿行的<a class="ae ky" href="https://www.kaggle.com/datasets/mkechinov/ecommerce-behavior-data-from-multi-category-store" rel="noopener ugc nofollow" target="_blank">ka ggle页面的电子商务数据。</a></p><p id="3667" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">第一件事是通过输入以下代码从Kaggle获取数据</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="31e9" class="mu md it of b gy oj ok l ol om">! pip install kaggle</span><span id="0566" class="mu md it of b gy on ok l ol om">! mkdir ~/.kaggle</span><span id="6f62" class="mu md it of b gy on ok l ol om">!cp /content/drive/MyDrive/kaggle.json ~/.kaggle/kaggle.json</span><span id="3bb2" class="mu md it of b gy on ok l ol om">! kaggle datasets download -d mkechinov/ecommerce-behavior-data-from-multi-category-store</span><span id="b3b2" class="mu md it of b gy on ok l ol om">!unzip ecommerce-behavior-data-from-multi-category-store.zip</span></pre><p id="995c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">前三行代码</p><ul class=""><li id="15a2" class="ng nh it lb b lc ld lf lg li nx lm ny lq nz lu nn no np nq bi translated">安装Kaggle库以便能够使用Kaggle API</li><li id="65f0" class="ng nh it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">创建一个名为<strong class="lb iu">的目录/文件夹。根目录中的kaggle </strong></li><li id="517f" class="ng nh it lb b lc nr lf ns li nt lm nu lq nv lu nn no np nq bi translated">将您之前保存在驱动器中的<strong class="lb iu"> kaggle.json </strong>复制到您上面创建的新目录中。</li></ul><p id="4ae7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来的两行代码</p><ul class=""><li id="895c" class="ng nh it lb b lc ld lf lg li nx lm ny lq nz lu nn no np nq bi translated">下载您需要的特定数据。在我的案例中:“<strong class="lb iu">电子商务-行为-数据-来自-多类别-商店”</strong>。当您转到所选数据的右侧并单击:<strong class="lb iu">复制API命令</strong>时，您可以很容易地获得那一行代码。</li></ul><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oo"><img src="../Images/5c660228fc2e8875175022b5647ed0ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z1blckDbsU1IKWxSmFAnWQ.png"/></div></div></figure><blockquote class="lv lw lx"><p id="0f0d" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">没有麻烦。哈哈的笑</p></blockquote><ul class=""><li id="b4d4" class="ng nh it lb b lc ld lf lg li nx lm ny lq nz lu nn no np nq bi translated">解压文件，在我的例子中是:"<strong class="lb iu">电子商务-行为-数据-来自-多类别-商店"</strong></li></ul><blockquote class="lv lw lx"><p id="a67c" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">Kaggle数据集通常以zip文件的形式下载</p></blockquote><p id="6045" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">对于这个特定的数据集，下载了两个文件，称为</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi op"><img src="../Images/2cdc2a0ef57644f88ff08f1c2b82e71d.png" data-original-src="https://miro.medium.com/v2/resize:fit:564/format:webp/1*RGngl__uVlN6GzMmATWINA.png"/></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自作者</figcaption></figure><blockquote class="lv lw lx"><p id="a501" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">干得好！，你完成了50%。重要的部分来了:在pyspark上安装和阅读🤓</p></blockquote><h1 id="6648" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">第三步</h1><p id="aa0e" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li ob lk ll lm oc lo lp lq od ls lt lu im bi translated">下面的代码用于安装Pyspark依赖项</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="bf0a" class="mu md it of b gy oj ok l ol om">!apt-get install openjdk-8-jdk-headless -qq &gt; /dev/null</span><span id="80b2" class="mu md it of b gy on ok l ol om">!wget -q http://archive.apache.org/dist/spark/spark-3.1.1/spark-3.1.1-bin-hadoop3.2.tgz</span><span id="c429" class="mu md it of b gy on ok l ol om">!tar xf spark-3.1.1-bin-hadoop3.2.tgz</span><span id="92a3" class="mu md it of b gy on ok l ol om">!pip install -q findspark</span></pre><p id="a2b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的依赖项包括安装Java 8、Apache spark with Hadoop(随意切换到最新版本<a class="ae ky" href="https://spark.apache.org/downloads.html" rel="noopener ugc nofollow" target="_blank">这里</a>)和FindSpark，后者用于在系统中定位spark</p><p id="d979" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">接下来是通过设置Java和Spark的位置来设置允许我们在Colab环境中运行PySpark的环境路径</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="f05c" class="mu md it of b gy oj ok l ol om">import os</span><span id="4651" class="mu md it of b gy on ok l ol om">os.environ["JAVA_HOME"] = "/usr/lib/jvm/java-8-openjdk-amd64"</span><span id="8a45" class="mu md it of b gy on ok l ol om">os.environ["SPARK_HOME"] = "/content/spark-3.1.1-bin-hadoop3.2"</span></pre><blockquote class="lv lw lx"><p id="3ded" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">最后，运行一个本地spark会话来测试我们的安装😏。</p></blockquote><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="1535" class="mu md it of b gy oj ok l ol om">import findspark</span><span id="6edc" class="mu md it of b gy on ok l ol om">findspark.init()</span><span id="b96a" class="mu md it of b gy on ok l ol om">from pyspark.sql import SparkSession</span><span id="1dc9" class="mu md it of b gy on ok l ol om">spark = SparkSession.builder.master("local[*]").getOrCreate()</span><span id="5289" class="mu md it of b gy on ok l ol om">spark.conf.set("spark.sql.repl.eagerEval.enabled", True) # Property used to format output tables better</span><span id="952f" class="mu md it of b gy on ok l ol om">spark</span></pre><p id="217d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">当您运行上面的代码时，您会看到类似下图的内容</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oq"><img src="../Images/4c06d7c079e9c4841119f2842ee404fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:844/format:webp/1*ibby5NMPYQgdq8NluW1R_w.png"/></div></figure><blockquote class="lv lw lx"><p id="a931" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">这表明你可以走了</p></blockquote><p id="9e2e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">我们来读一下pyspark上从Kaggle下载的数据</p><pre class="kj kk kl km gt oe of og oh aw oi bi"><span id="d037" class="mu md it of b gy oj ok l ol om">df = spark.read.csv('2019*.csv', header=True, sep=",")</span><span id="d9db" class="mu md it of b gy on ok l ol om">df.show(5)</span></pre><p id="bb7a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">上面的代码读取Pyspark中collab笔记本中的所有CSV文件，并显示前五行</p><blockquote class="lv lw lx"><p id="24af" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">类似于熊猫的<strong class="lb iu"> df.head() </strong></p></blockquote><p id="18a5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">在我的例子中，结果是这样的</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi or"><img src="../Images/2c16f2364bdb93f1f429a5cbda5b44d7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cHPTStc81zth_o_eNcrlaA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">图片来自作者</figcaption></figure><p id="a582" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这表明您可以开始在Pyspark中分析该表。</p><p id="8b18" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">在这里找到笔记本</strong> <a class="ae ky" href="https://colab.research.google.com/drive/1NPvAX_XKfv0sflWTT0Ouboz6_D-VzRY3#scrollTo=qVXoZBzSZu-e" rel="noopener ugc nofollow" target="_blank"> <strong class="lb iu">的链接</strong> </a></p><p id="0a17" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">这个过程需要10-15分钟</p><blockquote class="lv lw lx"><p id="0602" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">减去决定使用哪些数据的时间😓</p></blockquote><h1 id="c42a" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">最后的话</h1><p id="d227" class="pw-post-body-paragraph kz la it lb b lc ni ju le lf nj jx lh li ob lk ll lm oc lo lp lq od ls lt lu im bi translated">是的，每次需要在Colabs上运行Pyspark时，您都需要重新运行所有这些设置代码。然而，这是一个几乎无关紧要的麻烦，因为您可以存储/保存这些代码行，并在需要时重新运行它们。它在某种程度上也是可复制的，因为任何人都可以拥有该笔记本，并在他们的终端上重新运行它</p><blockquote class="lv lw lx"><p id="5485" class="kz la ly lb b lc ld ju le lf lg jx lh lz lj lk ll ma ln lo lp mb lr ls lt lu im bi translated">除了不应该共享的Kaggle凭证部分</p></blockquote></div></div>    
</body>
</html>