<html>
<head>
<title>Uber AresDB is an Open Source, GPU-Powered Database for Large-Scale Analytics Workloads</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优步AresDB是一个面向大规模分析工作负载的开源、GPU驱动的数据库</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/uber-aresdb-is-an-open-source-gpu-powered-database-for-large-scale-analytics-workloads-ec82c1b2a863?source=collection_archive---------0-----------------------#2021-02-24">https://pub.towardsai.net/uber-aresdb-is-an-open-source-gpu-powered-database-for-large-scale-analytics-workloads-ec82c1b2a863?source=collection_archive---------0-----------------------#2021-02-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="4b2f" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-analytics" rel="noopener ugc nofollow" target="_blank">数据分析</a></h2><div class=""/><div class=""><h2 id="190d" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">开源堆栈正在为优步的实时分析管道提供动力。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/d0878ad8a83006085a8754a122a128e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WPRZvuWTfitTYkRc.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">来源:https://eng.uber.com/aresdb/<a class="ae lh" href="https://eng.uber.com/aresdb/" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><blockquote class="li lj lk"><p id="3064" class="ll lm ln lo b lp lq kd lr ls lt kg lu lv lw lx ly lz ma mb mc md me mf mg mh im bi translated">我最近创办了一份专注于人工智能的教育时事通讯，已经有超过70，000名订户。《序列》是一份无废话(意思是没有炒作，没有新闻等)的ML导向时事通讯，需要5分钟阅读。目标是让你与机器学习项目、研究论文和概念保持同步。请通过订阅以下内容来尝试一下:</p></blockquote><div class="mi mj gp gr mk ml"><a href="https://thesequence.substack.com/" rel="noopener  ugc nofollow" target="_blank"><div class="mm ab fo"><div class="mn ab mo cl cj mp"><h2 class="bd jd gy z fp mq fr fs mr fu fw jc bi translated">序列</h2><div class="ms l"><h3 class="bd b gy z fp mq fr fs mr fu fw dk translated">该序列解释了主要的机器学习概念，让你与最相关的项目和最新的…</h3></div><div class="mt l"><p class="bd b dl z fp mq fr fs mr fu fw dk translated">thesequence.substack.com</p></div></div><div class="mu l"><div class="mv l mw mx my mu mz lb ml"/></div></div></a></div><p id="86d2" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">优步是开源数据科学基础设施和框架的最大贡献者之一。从像<a class="ae lh" href="https://github.com/uber/horovod" rel="noopener ugc nofollow" target="_blank"> Horovod </a>或<a class="ae lh" href="http://pyro.ai/" rel="noopener ugc nofollow" target="_blank"> Pyro </a>这样的机器学习框架到像<a class="ae lh" href="https://github.com/m3db" rel="noopener ugc nofollow" target="_blank"> M3 </a>这样的时间序列基础设施，优步工程团队一直非常积极地开源不同的堆栈，这些堆栈是优步数据科学管道的关键构建模块。本周早些时候，优步推出了另一项超级酷的技术，以实现现代分析解决方案。<a class="ae lh" href="https://github.com/uber/aresdb" rel="noopener ugc nofollow" target="_blank"> AresDB </a>是一个用于大规模可扩展实时分析工作负载的数据库和运行时。</p><p id="1a3f" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">市场真的需要另一个实时分析数据库吗？这是我读到AresDB的第一反应。实时分析的挑战，特别是对时间序列数据的挑战，是众所周知的，有一些非常先进的堆栈，如<a class="ae lh" href="https://github.com/apache/incubator-pinot" rel="noopener ugc nofollow" target="_blank"> Apache Pinot </a>、<a class="ae lh" href="https://www.omnisci.com/" rel="noopener ugc nofollow" target="_blank"> OmniSci </a>，甚至在某种程度上，<a class="ae lh" href="https://www.elastic.co/" rel="noopener ugc nofollow" target="_blank"> Elasticsearch </a>支持许多这些用例。虽然这些解决方案的功能非常强大，但重要的是要认识到，优步的运营规模是市场上大多数软件平台所不知道的。优步的应用程序每秒收集数百万个数据点，需要用于在完全不同的领域做出实时决策，如欺诈检测或小费定价。图形处理单元(GPU)的主流采用开辟了扩展分析工作负载的新领域。然而，你知道有多少实时分析引擎能够有效地利用GPU。这就是AresDB设置要解决的挑战。</p><h1 id="3ec4" class="nd ne it bd nf ng nh ni nj nk nl nm nn ki no kj np kl nq km nr ko ns kp nt nu bi translated">使用GPU扩展</h1><p id="5dd9" class="pw-post-body-paragraph ll lm it lo b lp nv kd lr ls nw kg lu na nx lx ly nb ny mb mc nc nz mf mg mh im bi translated">利用GPU来扩展实时分析工作负载的想法似乎非常适合优步。ride haling公司拥有数千个分析流程，可对时间序列数据进行实时计算，这些数据由几天时间内收集的数十亿个数据点组成。与传统CPU相比，GPU为实时分析工作负载提供了非常明显的优势:</p><ul class=""><li id="2e83" class="oa ob it lo b lp lq ls lt na oc nb od nc oe mh of og oh oi bi translated">非常快速地并行处理数据。</li><li id="4858" class="oa ob it lo b lp oj ls ok na ol nb om nc on mh of og oh oi bi translated">提供更高的计算吞吐量(GFLOPS/s)，非常适合可以并行化的繁重计算任务(单位数据)。</li><li id="fb99" class="oa ob it lo b lp oj ls ok na ol nb om nc on mh of og oh oi bi translated">提供更大的计算到存储(ALU到GPU全局内存)数据访问吞吐量(而非延迟)，使其成为处理需要大量数据的I/O(内存)绑定并行任务的理想选择。</li></ul><p id="a5af" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">针对基于GPU的架构优化的实时分析引擎有机会针对数据集的大型子集扩展任意查询/计算，而无需任何数据优化。</p><h1 id="371a" class="nd ne it bd nf ng nh ni nj nk nl nm nn ki no kj np kl nq km nr ko ns kp nt nu bi translated">输入AresDB</h1><p id="b3a3" class="pw-post-body-paragraph ll lm it lo b lp nv kd lr ls nw kg lu na nx lx ly nb ny mb mc nc nz mf mg mh im bi translated">AresDB的设计结合了磁盘和内存存储以及CPU和GPU计算。该堆栈遵循MemSQL或AWS RedShift等技术中流行的列内数据存储模型。在架构上，AresDB遵循三个关键原则来实现实时分析计算的巨大性能:</p><ul class=""><li id="1577" class="oa ob it lo b lp lq ls lt na oc nb od nc oe mh of og oh oi bi translated"><strong class="lo jd">带压缩的基于列的存储:</strong>这种模式用于<strong class="lo jd"> </strong>提高存储效率(以存储数据的字节为单位减少内存使用量)和查询效率(查询期间从CPU内存到GPU内存的数据传输减少)</li><li id="2d0c" class="oa ob it lo b lp oj ls ok na ol nb om nc on mh of og oh oi bi translated"><strong class="lo jd">采用主键重复数据删除的实时更新:</strong>相关的<strong class="lo jd"> </strong>可在数秒内实现高数据准确性和近乎实时的数据更新。</li><li id="81ff" class="oa ob it lo b lp oj ls ok na ol nb om nc on mh of og oh oi bi translated"><strong class="lo jd"> GPU驱动的查询处理:</strong>使用<strong class="lo jd"> </strong>进行由GPU驱动的高度并行化的数据处理，呈现低查询延迟(亚秒到秒)。</li></ul><p id="d6d4" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">AresDB的一部分看起来像任何其他实时数据库引擎。AresDB中的数据存储在磁盘中，但会切换到内存中进行实时计算。数据摄取过程在商用CPU中工作，平台维护一个单独的数据库，其中包含核心数据结构的模式和相关元数据。然而，当处理实时查询时，AresDB将计算从主机内存切换到GPU内存，以实现更快的性能。计算引擎上的实时切换是AresDB的关键功能之一。在较高层次上，AresDB的体系结构如下图所示:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi oo"><img src="../Images/155600b4d86677fc1554cd00f1701e35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*OU-1HqodEQ7SLiy6N0xZVA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">来源:<a class="ae lh" href="https://eng.uber.com/aresdb/" rel="noopener ugc nofollow" target="_blank">https://eng.uber.com/aresdb/</a></figcaption></figure><p id="21c2" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">AresDB中的存储模型基于两组基本的表:</p><p id="d9be" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated"><strong class="lo jd">事实表:</strong> AresDB的事实表存储实时发生的事件/事实，每个事件都与一个事件时间相关联，事件时间经常查询该表。</p><p id="b510" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated"><strong class="lo jd">维度表:</strong> AresDB的维度表存储实体(包括城市、客户和司机)的当前属性。与随时间无限增长的事实表相比，维度表总是受到大小的限制。</p><p id="5461" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">在AresDB中，数据接收由一个HTTP API抽象，该API可以接收一批upsert记录。收到请求后，AresDB API将upsert批处理写入重做日志以进行恢复。接下来，AresDB会识别并跳过事实表上的延迟记录，以将其接收到实时存储中。如果记录的事件时间早于存档的截止事件时间，则该记录被认为是“晚”的。对于未被视为“迟交”的记录，AresDB使用主键索引在live store中找到应该应用这些记录的批次。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi op"><img src="../Images/5294575d5fbc1ca9b1fca08e0038abeb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1172/format:webp/1*Sy8v2NeamdBpWSF08Q5Vqw.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">资料来源:https://eng.uber.com/aresdb/</figcaption></figure><p id="e940" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">除了HTTP API之外，AresDB还提供了与多个数据源的集成，如Apache Spark、Apache Flink或Apache Kafka，以扩展大批量插入。AresDB的可扩展编程模型允许添加新的连接器来集成主流数据和业务线系统。</p><p id="9459" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">对于数据查询，AresDB依赖于Ares查询语言(AQL ),它使用类似JSON的格式来表示查询命令。AQL语法包括诸如维度或度量之类的构造，这些构造是列存储模型的本地表示。表示一个查询，例如在AQL，status = ' completed ' AND request _ at&gt;= 1512000000，SELECT count(*)FROM trips GROUP BY city _ id，如下所示:</p><pre class="ks kt ku kv gt oq or os ot aw ou bi"><span id="a693" class="ov ne it or b gy ow ox l oy oz">{<br/> “table”: “trips”,<br/> “dimensions”: [<br/>   {“sqlExpression”: “city_id”}<br/> ],<br/> “measures”: [<br/>   {“sqlExpression”: “count(*)”}<br/> ],<br/>;”&gt;  “rowFilters”: [<br/>   “status = ‘completed'”<br/> ],<br/> “timeFilter”: {<br/>   “column”: “request_at”,<br/>   “from”: “2 days ago”<br/> }<br/>}</span></pre><p id="e0ec" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">虽然AQL是AresDB中的主要查询语言，但优步工程团队正在探索也支持SQL的计划，以简化平台的采用。像任何其他新的查询语言一样，AQL需要一个新的执行引擎来解析和执行数据查询。AQL查询引擎利用<a class="ae lh" href="https://developer.nvidia.com/thrust" rel="noopener ugc nofollow" target="_blank"> NVIDIA的推力框架</a>在GPU环境中并行执行查询。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi pa"><img src="../Images/32980ea8ee0bd8e8fdf779ea31e8140f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*Mfptng9rKgIHO915ihd12A.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">来源:https://eng.uber.com/aresdb/<a class="ae lh" href="https://eng.uber.com/aresdb/" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="6e15" class="pw-post-body-paragraph ll lm it lo b lp lq kd lr ls lt kg lu na lw lx ly nb ma mb mc nc me mf mg mh im bi translated">AresDB是优步不断增长的数据科学和分析堆栈的最新成员。至少在功能上，AresDB看起来像是对其他优步技术的自然补充，例如<a class="ae lh" href="https://towardsdatascience.com/introducing-m3-8790c503ce24" rel="noopener" target="_blank"> M3 </a>，以支持高度可伸缩的时间序列分析。虽然没有多少公司在优步的数据规模上运营，但几乎所有人都会同意，对大型数据集进行实时分析绝非易事。其架构的简单性及其与广泛采用的数据基础架构的集成使AresDB能够在许多环境中支持实时分析工作负载。</p></div></div>    
</body>
</html>