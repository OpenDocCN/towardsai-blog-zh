<html>
<head>
<title>End to End Model of Data Analysis &amp; Prediction Using Python on SAP HANA Table Data</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Python对SAP HANA表数据进行数据分析和预测的端到端模型</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/end-to-end-model-of-data-analysis-prediction-using-python-on-sap-hana-table-data-800614d956ca?source=collection_archive---------1-----------------------#2019-06-28">https://pub.towardsai.net/end-to-end-model-of-data-analysis-prediction-using-python-on-sap-hana-table-data-800614d956ca?source=collection_archive---------1-----------------------#2019-06-28</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="e632" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a>，<a class="ae ep" href="https://towardsai.net/p/category/programming/python" rel="noopener ugc nofollow" target="_blank"> Python </a></h2><div class=""/><p id="f4f9" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">这个博客帮助连接SAP HANA DB(版本1.0 SPS12)，然后从HANA表/视图中提取数据，并使用Python Pandas库分析数据。然后，您可以清理和选择独立变量/特征数据，以供机器学习算法预测因变量或找到见解。</p><p id="8c63" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">在当今的数字经济中，企业无法根据陈旧的见解采取行动，因此真正的内存数据平台应该支持实时处理交易和分析公司的所有数据。SAP HANA有助于在单一内存平台中管理数据，因此您可以立即采取行动。加快创新步伐，在这个新的数字经济中运行。SAP HANA功能包括数据库服务、高级分析处理、应用程序开发、数据访问、管理和开放性。</p><p id="0177" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">Python在分析和数据科学中越来越受欢迎。它也是便携、免费和简单的。Python可以让您快速工作，更有效地集成系统。Python有一个很大的库可供你使用，所以你不必为每一件事都写自己的代码。有用于正则表达式、文档生成、单元测试、web浏览器、线程、数据库、CGI、电子邮件、图像处理和许多其他功能的库。</p><p id="840b" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja">场景:</strong>我正在获取state wise初创公司的支出(研发支出、管理支出和营销支出)和利润数据。</p><p id="1cd8" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">目标是预测给定支出值集的利润。我在这里不解释关于ML算法和参数调整的细节。我想展示从SAP HANA DB提取数据、分析、清理、特征选择和应用机器学习模型的端到端流程，最后将结果和ML算法性能指标写回到HANA表中。</p><p id="0727" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">线性回归是研究和商业中最常用的模型，也是最容易理解的，因此使用随机森林回归方法我们可以预测利润。</p><p id="fd74" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">下图显示了ML预测生命周期和用例中遵循的步骤。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ku"><img src="../Images/f50c996fc8400df881cd388513233a6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LQBzXV-mT6kLBEjaBecCWw.jpeg"/></div></div></figure><p id="5446" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">这一过程涉及的基本步骤是:</p><p id="8a04" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">1.检查HANA表数据，并在HANA Studio/WEB IDE中使用SQL进行分析。</p><p id="43f8" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">(确保您拥有对SAP HANA数据库中的表执行DML操作所需的权限。)</p><p id="7826" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">2.用python导入Pyodbc，Pandas，Sklearn，Matplotlib，seaborn库。</p><p id="0eda" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">3.创建到HANA数据库的连接，并执行所需的SQL。</p><p id="7260" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">4.将所有历史数据提取到数据框对象中，并使用pandas开始在Python中对其进行分析。</p><p id="5828" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">5.进行特征工程、数据清洗，然后将最终的一组独立变量输入到机器学习算法(随机森林)中，以预测因变量(利润)。</p><p id="bafc" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">6.分析机器学习算法指标，并通过重复步骤5进行微调以获得更高的准确性。将机器学习算法指标存储在日志表中，并将历史数据的预测值更新到HANA表中。</p><p id="63df" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">7.对于新数据集，创建python程序，该程序使用Pyodbc连接读取新数据，预测因变量(利润),并更新用于报告的实际事务表。</p><p id="8fc7" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">8.安排此计划，并持续监控模型指标和预测值。</p><h2 id="9c8a" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> 1。</strong> <strong class="ak">检查HANA表数据并使用SQL进行分析</strong></h2><p id="156f" class="pw-post-body-paragraph jw jx iq jy b jz ly kb kc kd lz kf kg kh ma kj kk kl mb kn ko kp mc kr ks kt ij bi translated">我创建了两个表，一个包含实际的公司数据，用于存储交易数据。第二个存储机器学习算法的度量(例如:平均误差、R平方、MAPE、RMSE、精确度等。)</p><p id="1352" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">请找出下面两个表格的结构。</p><p id="aba2" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">主事务数据表结构。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi md"><img src="../Images/b5d706d4f3505588ec246c7945466725.png" data-original-src="https://miro.medium.com/v2/resize:fit:1050/format:webp/1*HRb6Ujpx7QC_DpZ2R4RYPQ.png"/></div></figure><p id="1119" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">存储评估参数的ML度量表。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi me"><img src="../Images/ef56db05bbf38a270e6856c8289b5eb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1056/format:webp/1*oWMBZMxv95DiZyD9X9TdsQ.png"/></div></figure><p id="b7f6" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">预测前的历史数据(少于当前月份),各州的支出和利润如下所示。我还添加了预测利润列，使用python通过ML算法存储预测值，现在它被更新为NULL。</p><p id="e5a2" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja">从</strong>“模式”中选择 * <strong class="jy ja">。"启动_数据2 "</strong></p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi mf"><img src="../Images/2c4e62ab162b3776fea0d2b7cef15d61.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QrS9QV4X1--Ihwn2sP2F8A.png"/></div></div></figure><p id="7653" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">让我们使用HANA Studio中的SQL和可用函数来分析数据，我们可以使用下面的SQL找到平均值、标准差、中值、最大值、最小值和空值计数。(您可以尝试所有措施)</p><p id="b26e" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja">选择</strong>状态，<strong class="jy ja">总和</strong>(利润)，<strong class="jy ja">平均值</strong>(利润)，<strong class="jy ja">计数</strong>(利润)，<strong class="jy ja">最大值</strong>(利润)，<strong class="jy ja">计数</strong> ( <strong class="jy ja">截然不同的</strong>利润)<strong class="jy ja">为</strong>“独特”，<strong class="jy ja"> stddev </strong>(利润)，<strong class="jy ja">最小值</strong>(利润)，中位数(利润)，</p><p id="48a8" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><strong class="jy ja">sum</strong>(<strong class="jy ja">case</strong><strong class="jy ja">当</strong> Profit <strong class="jy ja">为</strong> <strong class="jy ja"> NULL </strong> <strong class="jy ja">则</strong>1<strong class="jy ja">ELSE</strong>0<strong class="jy ja">END</strong>)<strong class="jy ja">为</strong>【NULL数】<strong class="jy ja">来自</strong>“模式”。【启动_数据2】<strong class="jy ja">组</strong> <strong class="jy ja">由</strong>状态<strong class="jy ja">命令</strong>由状态；</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi mg"><img src="../Images/557566f0ca3b5c4b91ae10f2c85c803f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x1eobfmw_Pn0K4yY42LtHg.png"/></div></div></figure><h2 id="1388" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> 2。</strong> <strong class="ak">在python中导入Pyodbc、pandas、Sklearn库</strong></h2><p id="56be" class="pw-post-body-paragraph jw jx iq jy b jz ly kb kc kd lz kf kg kh ma kj kk kl mb kn ko kp mc kr ks kt ij bi translated">现在我来说说Python脚本接口(Jupyter或者spyder)。</p><p id="1658" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">导入所需的库。</p><p id="494b" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">PYODBC是一个开源Python模块，它使得访问ODBC数据库变得简单。它实现了DB API 2.0规范，但是打包了更方便的Pythonic。使用Pyodbc，您可以通过odbc驱动程序轻松地将Python应用程序连接到数据源。</p><p id="ce68" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">通常，Pyodbc像任何其他Python包一样通过运行以下命令来安装:</p><pre class="kv kw kx ky gt mh mi mj mk aw ml bi"><span id="8275" class="lg lh iq mi b gy mm mn l mo mp">pip install Pyodbc</span></pre><p id="94d9" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">从Windows DOS提示符或Unix shell。</p><p id="4c0d" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">要使用Conda run安装此软件包:</p><pre class="kv kw kx ky gt mh mi mj mk aw ml bi"><span id="d267" class="lg lh iq mi b gy mm mn l mo mp">conda install -c anaconda pyodbc</span></pre><p id="10d0" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">有关Pyodbc的更多信息，请参见Github Pyodbc Wiki 。</p><p id="72f0" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">Seaborn: Seaborn是一个构建在Matplotlib之上的图形库。它可以让您的图表更漂亮，并有助于一些常见的数据可视化需求</p><p id="92e4" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">Pandas是一个开源的、BSD许可的库，为<a class="ae mq" href="https://www.python.org/" rel="noopener ugc nofollow" target="_blank"> Python </a>编程语言提供高性能、易于使用的数据结构和数据分析工具。</p><p id="3160" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">Numpy: NumPy是使用Python进行科学计算的基础包。除了其明显的科学用途，NumPy还可以用作通用数据的高效多维容器</p><p id="38af" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">Sklearn: Scikit-learn通过Python中的一致接口提供了一系列监督和非监督学习算法。它具有各种<a class="ae mq" href="https://en.wikipedia.org/wiki/Statistical_classification" rel="noopener ugc nofollow" target="_blank">分类</a>、<a class="ae mq" href="https://en.wikipedia.org/wiki/Regression_analysis" rel="noopener ugc nofollow" target="_blank">回归</a>和<a class="ae mq" href="https://en.wikipedia.org/wiki/Cluster_analysis" rel="noopener ugc nofollow" target="_blank">聚类</a>算法，包括<a class="ae mq" href="https://en.wikipedia.org/wiki/Support_vector_machine" rel="noopener ugc nofollow" target="_blank">支持向量机</a>、<a class="ae mq" href="https://en.wikipedia.org/wiki/Random_forests" rel="noopener ugc nofollow" target="_blank">随机森林</a>、<a class="ae mq" href="https://en.wikipedia.org/wiki/Gradient_boosting" rel="noopener ugc nofollow" target="_blank">梯度推进</a>、<a class="ae mq" href="https://en.wikipedia.org/wiki/K-means_clustering" rel="noopener ugc nofollow" target="_blank"> k-means </a>和<a class="ae mq" href="https://en.wikipedia.org/wiki/DBSCAN" rel="noopener ugc nofollow" target="_blank"> DBSCAN </a>，并且设计用于与Python数值和科学库<a class="ae mq" href="https://en.wikipedia.org/wiki/NumPy" rel="noopener ugc nofollow" target="_blank"> NumPy </a>和<a class="ae mq" href="https://en.wikipedia.org/wiki/SciPy" rel="noopener ugc nofollow" target="_blank"> SciPy </a>互操作</p><h2 id="89d2" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> 3。</strong> <strong class="ak">创建一个到HANA数据库的连接，并执行所需的SQL。</strong></h2><p id="8554" class="pw-post-body-paragraph jw jx iq jy b jz ly kb kc kd lz kf kg kh ma kj kk kl mb kn ko kp mc kr ks kt ij bi translated">建立连接，一旦建立了连接，您的应用程序就可以执行选择、插入或其他驱动程序和数据库支持的ODBC操作。</p><pre class="kv kw kx ky gt mh mi mj mk aw ml bi"><span id="9b28" class="lg lh iq mi b gy mm mn l mo mp">conn = pyodbc.connect(‘DRIVER={HDBODBC};SERVERNODE=10.xx.xxx.xx:30115;SERVERDB=ED1;UID=USERID;PWD=PASSWORD’)</span><span id="deb5" class="lg lh iq mi b gy mr mn l mo mp">#Open connection to SAP HANA and check for count of records.</span><span id="1dfe" class="lg lh iq mi b gy mr mn l mo mp"># check if table has entries</span><span id="7b2d" class="lg lh iq mi b gy mr mn l mo mp">cursor = conn.cursor()</span><span id="87e4" class="lg lh iq mi b gy mr mn l mo mp">sql_query1 = ‘SELECT count(*) FROM SCHEMA.STARTUP_DATA2’</span><span id="1284" class="lg lh iq mi b gy mr mn l mo mp">dcount = pd.read_sql(sql_query1, conn)</span><span id="6cdf" class="lg lh iq mi b gy mr mn l mo mp">dcount</span><span id="7bfb" class="lg lh iq mi b gy mr mn l mo mp">print (‘Table exists and contains’, dcount.head(1), ‘records’ )</span></pre><h2 id="9931" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> 4。</strong> <strong class="ak">将数据提取到一个数据框对象中，并使用熊猫开始用Python对其进行分析</strong></h2><p id="f7d6" class="pw-post-body-paragraph jw jx iq jy b jz ly kb kc kd lz kf kg kh ma kj kk kl mb kn ko kp mc kr ks kt ij bi translated">执行Select SQL，读取数据并将其保存到数据框中。将数据放入数据框后，您可以应用所有统计函数来分析数据，如下所示。</p><pre class="kv kw kx ky gt mh mi mj mk aw ml bi"><span id="1364" class="lg lh iq mi b gy mm mn l mo mp">#querying the sap hana db data and store in dataframe</span><span id="b425" class="lg lh iq mi b gy mr mn l mo mp">sql_query2 = ‘SELECT * FROM SCHEMA.STARTUP_DATA2’</span><span id="36bf" class="lg lh iq mi b gy mr mn l mo mp">df = pd.read_sql(sql_query2, conn)</span><span id="01e5" class="lg lh iq mi b gy mr mn l mo mp">df.head()</span><span id="a1e4" class="lg lh iq mi b gy mr mn l mo mp">#USING GROUP BY CLAUSE TO ANALYZE THE DATA</span><span id="0256" class="lg lh iq mi b gy mr mn l mo mp">df1.groupby(‘STATE’).agg({‘PROFIT’:[‘sum’,’mean’,’count’,’max’,’std’,’min’,’median’]}).round(0)</span></pre><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi ms"><img src="../Images/06927b4113af6dd889ec5aadc466c4b7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SD-PLltp5KBp76jW4qseJw.png"/></div></div></figure><h2 id="67ab" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated">5.<strong class="ak">进行特征工程、数据清理，将最终的一组独立变量输入机器学习算法(随机森林)以预测一个因变量</strong></h2><p id="bd41" class="pw-post-body-paragraph jw jx iq jy b jz ly kb kc kd lz kf kg kh ma kj kk kl mb kn ko kp mc kr ks kt ij bi translated">使用函数检查缺失值或空值，并相应地用平均值/模式替换这些值。</p><p id="314e" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">例如，我在Rnd支出列中有两个空值，所以用平均值/中值替换。如果该列有更多的空值，那么您可以从分析中删除该列。</p><p id="2168" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">对名义值进行编码，例如，州有3个唯一值(“纽约”、“加利福尼亚”、“佛罗里达”)，使用映射函数用0、1、2代码替换它们</p><pre class="kv kw kx ky gt mh mi mj mk aw ml bi"><span id="f29a" class="lg lh iq mi b gy mm mn l mo mp">Map ({‘New York’:0,’California’:1,’Florida’:2})</span></pre><p id="d40a" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">现在找到因变量和自变量之间的相关性，以最终确定用于预测的最终自变量/特征。观察数据后，选择(R&amp;D支出、管理支出和营销支出)作为自变量，利润作为因变量。</p><p id="9dd3" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">现在我用随机森林回归来预测利润。</p><p id="9253" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">随机森林或随机决策森林是一种用于<a class="ae mq" href="https://en.wikipedia.org/wiki/Statistical_classification" rel="noopener ugc nofollow" target="_blank">分类</a>和<a class="ae mq" href="https://en.wikipedia.org/wiki/Regression_analysis" rel="noopener ugc nofollow" target="_blank">回归</a>(以及其他任务)的<a class="ae mq" href="https://en.wikipedia.org/wiki/Ensemble_learning" rel="noopener ugc nofollow" target="_blank">集成学习</a>方法，其通过在训练时构建大量<a class="ae mq" href="https://en.wikipedia.org/wiki/Decision_tree_learning" rel="noopener ugc nofollow" target="_blank">决策树</a>并输出作为个体树的类(分类)或均值预测(回归)的模式的类来操作。随机森林是<strong class="jy ja">袋装决策树</strong>模型，其在每次分割(在每次迭代中)时在特征的<strong class="jy ja">子集上训练。</strong></p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/2f97103133725b33220d99d021557544.png" data-original-src="https://miro.medium.com/v2/resize:fit:1128/format:webp/1*OP0cQMHYwtOo75fD5Vb5Ew.png"/></div></figure><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/fe7d84bdf6c75981725daf613c87d0bc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1236/format:webp/1*f4CYt1K_Wif_RWouEbmtdg.png"/></div></figure><h2 id="c2a9" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> 6。将机器学习算法指标存储在日志表中，并将预测值更新到HANA表中</strong></h2><p id="eed4" class="pw-post-body-paragraph jw jx iq jy b jz ly kb kc kd lz kf kg kh ma kj kk kl mb kn ko kp mc kr ks kt ij bi translated">使用insert和update语句，您可以将数据发送回数据库表(例如:ML度量和预测值)。在进行插入时，注意主键。</p><figure class="kv kw kx ky gt kz gh gi paragraph-image"><div role="button" tabindex="0" class="la lb di lc bf ld"><div class="gh gi mv"><img src="../Images/4c509cb5a8b0096e38f895bf8d9552f1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m4nZRq2SR9BdENRqDAvRMw.png"/></div></div></figure><p id="740f" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">检查SAP HANA表中的数据，以查看预测利润列中的更新值。</p><h2 id="b151" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated">7 .<strong class="ak">。</strong> <strong class="ak">对于新数据集，创建python程序，该程序使用Pyodbc连接读取新数据，预测因变量(利润)并更新实际交易表用于报告</strong></h2><p id="9ce5" class="pw-post-body-paragraph jw jx iq jy b jz ly kb kc kd lz kf kg kh ma kj kk kl mb kn ko kp mc kr ks kt ij bi translated">在业务中，新的事务数据将流入表/数据仓库。(在我的例子中是SAP HANA SQL数据仓库)。对于新的数据集，假设您想知道如果我下个月花费“X”支出，会有多少利润。</p><p id="ac85" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">分析这种成本增加/减少是否给你带来投资回报/利润。然后，</p><p id="f2cd" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">创建Python脚本，您可以在其中执行以下任务</p><p id="1c13" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">获取新数据集，并通过预测器/模型对其进行处理</p><p id="e5d3" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">将预测值更新回数据库。</p><p id="15e7" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">使用Windows调度程序/ python调度程序调度此python脚本</p><h2 id="a90f" class="lg lh iq bd li lj lk dn ll lm ln dp lo kh lp lq lr kl ls lt lu kp lv lw lx iw bi translated"><strong class="ak"> 8。</strong> <strong class="ak">安排此计划，并使用HANA模型/报告持续监控模型指标和预测值</strong></h2><p id="2db3" class="pw-post-body-paragraph jw jx iq jy b jz ly kb kc kd lz kf kg kh ma kj kk kl mb kn ko kp mc kr ks kt ij bi translated">您可以使用Windows调度程序/使用如下所示的调度程序来调度Python脚本。</p><pre class="kv kw kx ky gt mh mi mj mk aw ml bi"><span id="8127" class="lg lh iq mi b gy mm mn l mo mp"># sample piece of code</span><span id="61a5" class="lg lh iq mi b gy mr mn l mo mp">$ pip install schedule</span><span id="e2d1" class="lg lh iq mi b gy mr mn l mo mp">import schedule</span><span id="eca2" class="lg lh iq mi b gy mr mn l mo mp">import time</span><span id="d9c4" class="lg lh iq mi b gy mr mn l mo mp">def predict_job(x,y,z):</span><span id="3856" class="lg lh iq mi b gy mr mn l mo mp">Y_pred = rf.predict([[x,y,z]])</span><span id="ca0d" class="lg lh iq mi b gy mr mn l mo mp">print(“Predicted Value is”, Y_pred)</span><span id="a182" class="lg lh iq mi b gy mr mn l mo mp">#@daily schedule</span><span id="f179" class="lg lh iq mi b gy mr mn l mo mp">schedule.every().day.at(“10:30”).do(predict_job)</span><span id="9a70" class="lg lh iq mi b gy mr mn l mo mp">schedule.every().monday.do(predict_job)</span><span id="c5f1" class="lg lh iq mi b gy mr mn l mo mp">while True:</span><span id="ecb8" class="lg lh iq mi b gy mr mn l mo mp">schedule.run_pending()</span><span id="66ae" class="lg lh iq mi b gy mr mn l mo mp">time.sleep(1)</span></pre><p id="b027" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">现在，在SAP HANA客户端工具WEB IDE/ HANA Studio中，创建HANA模型，将主要交易数据与维度表(如时间、位置)连接起来，以用于报告目的。</p><p id="7bb1" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">各州实际利润与预测利润对比图。</p><p id="0c22" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">当使用Python IDE(如Jupyter)时，数据通过上述方法保存到客户端，这意味着当您拥有大型数据集时需要更多的处理时间，从而导致数据科学家的工作效率下降。</p><p id="4ee2" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">这就是SAP HANA数据框架能够为数据科学家的工作增加真正价值的地方。SAP HANA 2.0 SPS03版本中包含更多特性和功能，可通过Python驱动程序(hdbcli)和用于机器学习算法的Python客户端API来分析/处理数据科学用例。</p><p id="181f" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated">请在GitHub中找到python代码，以供参考</p><p id="a057" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><a class="ae mq" href="https://github.com/JOSEPHREDDY07/Linear-regression-with-SAP-HANA-DB-Integration" rel="noopener ugc nofollow" target="_blank">https://github . com/josephreddy 07/Linear-regression-with-SAP-HANA-d b-Integration</a></p><h1 id="9f5b" class="mw lh iq bd li mx my mz ll na nb nc lo nd ne nf lr ng nh ni lu nj nk nl lx nm bi translated">参考</h1><p id="9bc4" class="pw-post-body-paragraph jw jx iq jy b jz ly kb kc kd lz kf kg kh ma kj kk kl mb kn ko kp mc kr ks kt ij bi translated"><a class="ae mq" href="https://blogs.sap.com/2019/04/05/new-r-and-enhanced-python-api-for-sap-hana-machine-learning-released/" rel="noopener ugc nofollow" target="_blank">https://blogs . sap . com/2019/04/05/new-r-and-enhanced-python-API-for-sap-HANA-machine-learning-released/</a></p><p id="30f5" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><a class="ae mq" href="https://blogs.sap.com/2018/04/06/whats-new-in-sap-hana-2.0-sps-03-by-the-sap-hana-academy/" rel="noopener ugc nofollow" target="_blank">https://blogs . sap . com/2018/04/06/whats-new-in-sap-HANA-2.0-SPs-03-by-the-sap-HANA-academy/</a></p><p id="efa6" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><a class="ae mq" href="https://datatofish.com/python-script-windows-scheduler/" rel="noopener ugc nofollow" target="_blank">https://datatofish.com/python-script-windows-scheduler/</a></p><p id="96a9" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><a class="ae mq" href="https://github.com/dbader/schedule" rel="noopener ugc nofollow" target="_blank">https://github.com/dbader/schedule</a></p><p id="30e1" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><a class="ae mq" href="https://blogs.sap.com/2018/10/29/python-client-api-for-machine-learning-in-sap-hana-2.0-express-edition-sps-03-revision-33/" rel="noopener ugc nofollow" target="_blank">https://blogs . sap . com/2018/10/29/python-client-API-for-machine-learning-in-sap-HANA-2.0-express-edition-SPs-03-revision-33/</a></p><p id="1b75" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><a class="ae mq" href="https://blogs.sap.com/2018/04/20/enhancements-to-external-machine-learning-in-sap-hana-2.0-sps-03/" rel="noopener ugc nofollow" target="_blank">https://blogs . sap . com/2018/04/20/对sap-hana-2.0-sps-03/中外部机器学习的增强</a></p><p id="e68d" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><a class="ae mq" href="https://help.sap.com/viewer/42668af650f84f9384a3337bcd373692/2.0.02/en-US/b2a37c7ecec2416bbf1889b2f2883ade.html" rel="noopener ugc nofollow" target="_blank">https://help . sap . com/viewer/42668 af 650 f 84 f 9384 a 3337 BCD 373692/2 . 0 . 02/en-US/B2 a 37 c 7 ecec 2416 bbf 1889 B2 f 2883 ade . html</a></p><p id="c088" class="pw-post-body-paragraph jw jx iq jy b jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq kr ks kt ij bi translated"><a class="ae mq" href="https://towardsdatascience.com/why-random-forest-is-my-favorite-machine-learning-model-b97651fa3706" rel="noopener" target="_blank">https://towards data science . com/why-random-forest-is-my-favorite-machine-learning-model-b 97651 fa 3706</a></p></div></div>    
</body>
</html>