<html>
<head>
<title>Data Science 101: Guide to Using Pipelines in Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">数据科学101:在Python中使用管道指南</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/data-science-101-guide-to-using-pipelines-in-python-8a8667398a18?source=collection_archive---------3-----------------------#2021-02-28">https://pub.towardsai.net/data-science-101-guide-to-using-pipelines-in-python-8a8667398a18?source=collection_archive---------3-----------------------#2021-02-28</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="2c30" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-science" rel="noopener ugc nofollow" target="_blank">数据科学</a></h2><div class=""/><div class=""><h2 id="e1f9" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">在Python中使用管道的综合指南</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/c63c667e49494c2da7a359d87c0d12e7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*2GN09m8eden3KNsJ"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">由<a class="ae lh" href="https://unsplash.com/@tannerboriack?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">坦纳·博瑞克</a>在<a class="ae lh" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上拍摄</figcaption></figure><p id="1552" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我之前的文章中，我已经深入讨论了使用Python和Alteryx等不同工具构建机器学习模型的步骤。简而言之，它由以下步骤组成。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/92f83976ab38d68ccc546fede5bf64d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cm0SJX1_VrvopbX1Rgve3A.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者照片</figcaption></figure><p id="4e7c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">采样</strong>:该过程从<a class="ae lh" href="https://en.wikipedia.org/wiki/Sampling_(statistics)" rel="noopener ugc nofollow" target="_blank">数据采样</a>开始，即选择合适的数据集进行建模。</p><p id="f81c" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">探索:</strong>这一阶段通过探索变量之间预期和未预期的关系来理解数据，并在<a class="ae lh" href="https://www.alteryx.com/solutions/analytics-need/bi-visualization" rel="noopener ugc nofollow" target="_blank">数据可视化</a>的帮助下发现任何异常。</p><p id="ba5a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">修改</strong>:转换数据→创建新属性并估算缺失值。</p><p id="e74f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">模型</strong>:在建模阶段，重点是将各种建模(机器学习)技术应用于准备好的变量，以创建能够提供期望结果的模型。</p><p id="5f40" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">评估</strong>:比较不同的模型，选择一个最符合您的数据且精确度最高的模型。</p><p id="e7dc" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">每次我们向模型中添加数据时，它们都必须经过步骤1、2和3，然后才能被添加到现有模型或新模型中。当你每次想要使用不同的数据集时，不需要经历这三个阶段，你可以使用“管道”来自动执行这些数据准备步骤。在本文中，我将创建一个管道，并使用波士顿房产数据2019进行测试。我将使用相同的管道来准备2020年的波士顿房产数据。当我开始探索Pipeline时，我很少在一个地方找到所有信息的来源。本文将为管道提供一个<strong class="lk jd">综合指南，包括准备数字变量、分类变量，将它们组合成一个步骤，最后准备用于分析的数据。</strong></p><p id="12b8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">首先，我们将加载波士顿房产数据集。我们的目标是准备波士顿房产2020数据，以便能够预测单户住宅的价格。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mf mg l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">读出数据</figcaption></figure><p id="85b1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们将创建两个独立的管道—一个用于选择与单户住宅相关的行，另一个用于准备数据进行分析。</p><h1 id="b347" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated"><strong class="ak"> A)管道1:选择需要分析的行:</strong></h1><p id="7c87" class="pw-post-body-paragraph li lj it lk b ll mz kd ln lo na kg lq lr nb lt lu lv nc lx ly lz nd mb mc md im bi translated">为了选择分析所需的行，我们将创建一个自定义函数来选择行，并使用<strong class="lk jd"> FunctionTransformer </strong>函数来调用这个自定义函数(select_rows ),如下所示。最后，我们将使用<strong class="lk jd">管道</strong>功能将这些步骤添加到管道中。这个管道只有一个步骤，但是您可以在每个管道中添加多个步骤，您将在下一节中看到。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mf mg l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">管道1-选择行</figcaption></figure><h1 id="cbfd" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated"><strong class="ak"> B)管道2:数据准备</strong></h1><p id="18e1" class="pw-post-body-paragraph li lj it lk b ll mz kd ln lo na kg lq lr nb lt lu lv nc lx ly lz nd mb mc md im bi translated">管道是将应用于所选列的一系列步骤。众所周知，数字变量和分类变量有不同的数据准备步骤。因此，我们将创建3个独立的管道来处理不同类型的独立变量。</p><ol class=""><li id="4902" class="ne nf it lk b ll lm lo lp lr ng lv nh lz ni md nj nk nl nm bi translated"><strong class="lk jd">数值变量</strong>:居住面积、浴池数量、壁炉等。</li></ol><p id="d7c5" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">查看数据，变量有一些缺失值。我们将用列值的平均值来估算这些值。为此，我们将使用带有<strong class="lk jd"> strategy = 'mean' </strong>的<strong class="lk jd">简单估算器</strong>函数，如下所示。我将创建一个num_pipeline来应用这些转换。</p><p id="83f3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这里没有显示，但是数字变量的一个常用步骤是在机器学习模型中使用它们之前标准化数据。为此，可以使用<strong class="lk jd"> StandardScaler() </strong>函数。修订后的管道如下所示:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nn"><img src="../Images/85c1adc02479b81a8c4501f30e42393a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1296/format:webp/1*0u_YR_MGf8N4PisGwND3jA.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">标准标量函数</figcaption></figure><p id="c504" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> 2)分类变量</strong>:‘结构_类别’，R _屋顶_TYP，R _外部_CND等。</p><p id="f1d9" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于分类变量的一部分，我们将通过列的模式来估算缺失值。在用于机器学习模型之前，所有分类变量都必须使用<strong class="lk jd"> OneHotEncoding() </strong>进行编码。我们将把这两个步骤都添加到管道中，如下所示。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mf mg l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">分类变量流水线</figcaption></figure><p id="bc11" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">分类变量:浴室和厨房风格。</p><p id="a73a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">接下来，我们将创建厨房和浴室风格的管道。这些是分类变量，但我们需要一个单独的管道，因为我们必须用“NA”而不是“mode”来估算缺失值。与上一步类似，我们将使用onehotencoder()对变量进行编码。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mf mg l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">厨房和浴室风格管道</figcaption></figure><p id="a1ba" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，我们将使用列转换器将所有单独的管道合并到一个步骤中。要使用column transformer，您必须传递在上述步骤中创建的管道，以及该特定步骤的列名列表。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mf mg l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">最终管道:完整管道</figcaption></figure><p id="020e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，我们将下载Boston Housing Property 2020数据集，并通过两个管道传递它，如下所示。第一个管道将选择与单户住宅相关的行。然后，我们将通过完整的管道传递该管道的输出，以准备用于分析的数据。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="mf mg l"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">准备波士顿房产2020数据进行分析</figcaption></figure><h1 id="d08a" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated">结论:</h1><p id="9fe1" class="pw-post-body-paragraph li lj it lk b ll mz kd ln lo na kg lq lr nb lt lu lv nc lx ly lz nd mb mc md im bi translated">管道是用于自动化重复性任务的最重要的概念之一。本文为您提供了使用管道自动化数据准备的分步指南。</p><p id="10d7" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">你可以在这里找到完整的代码<strong class="lk jd"> </strong> <a class="ae lh" href="http://Medium_Pipeline_DataPrep.ipynb" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd">！</strong> </a></p><h1 id="28de" class="mh mi it bd mj mk ml mm mn mo mp mq mr ki ms kj mt kl mu km mv ko mw kp mx my bi translated"><strong class="ak">参考文献:</strong></h1><ol class=""><li id="dc80" class="ne nf it lk b ll mz lo na lr no lv np lz nq md nj nk nl nm bi translated">Sklearn文档</li></ol><div class="nr ns gp gr nt nu"><a href="https://scikit-learn.org/stable/modules/generated/sklearn.compose.ColumnTransformer.html" rel="noopener  ugc nofollow" target="_blank"><div class="nv ab fo"><div class="nw ab nx cl cj ny"><h2 class="bd jd gy z fp nz fr fs oa fu fw jc bi translated">sk learn . compose . column transformer-sci kit-learn 0 . 24 . 1文档</h2><div class="ob l"><h3 class="bd b gy z fp nz fr fs oa fu fw dk translated">将转换器应用于数组或pandas数据框架的列。该估计器允许不同的列或列…</h3></div><div class="oc l"><p class="bd b dl z fp nz fr fs oa fu fw dk translated">scikit-learn.org</p></div></div><div class="od l"><div class="oe l of og oh od oi lb nu"/></div></div></a></div><p id="6e26" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">2.Github链接:<a class="ae lh" href="https://github.com/evjanaki/DataPreperation/blob/master/Medium_Pipeline_DataPrep.ipynb" rel="noopener ugc nofollow" target="_blank">https://github . com/evjanaki/data preparation/blob/master/Medium _ Pipeline _ data prep . ipynb</a></p></div></div>    
</body>
</html>