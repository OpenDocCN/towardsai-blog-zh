<html>
<head>
<title>Selenium WebDriver: Browse the Web with Code</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Selenium WebDriver:用代码浏览网页</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/selenium-webdriver-browse-the-web-with-code-f064d3556a8?source=collection_archive---------3-----------------------#2020-09-22">https://pub.towardsai.net/selenium-webdriver-browse-the-web-with-code-f064d3556a8?source=collection_archive---------3-----------------------#2020-09-22</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="2757" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="30e2" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">如何与网站互动并提取数据</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/f3a9c2d387e0a04803287bcb8fdb5024.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g7exSoCdScyVGcuWnjjfVw.jpeg"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">背景图片由来自<a class="ae lh" href="https://pixabay.com/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5290463" rel="noopener ugc nofollow" target="_blank"> Pixabay </a>的<a class="ae lh" href="https://pixabay.com/users/viarami-13458823/?utm_source=link-attribution&amp;utm_medium=referral&amp;utm_campaign=image&amp;utm_content=5290463" rel="noopener ugc nofollow" target="_blank">马库斯·温克勒</a>拍摄</figcaption></figure><p id="d1a3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">自动化与Web浏览器的交互——这就是Selenium WebDriver让您做到的。而且这个东西可以有很多用例；其中包括:web应用程序测试和web抓取——这最后一件事是数据科学家最关心的。</p><p id="b356" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Selenium是一个更强大的web抓取工具。其他工具，如Beautiful Soup，只用于解析静态HTML文件并从中提取数据。如果您想要从中提取数据的web页面需要您的一些交互来使其数据可用，比如登录或向下滚动，那么这样的解析工具是没有用的。</p><p id="1b9f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是Selenium不仅仅是一个解析器。当你请求一个网页时，它实际上打开了你选择的一个浏览器，并进入那个地址。然后你可以从代码中做你通常可以在网络浏览器上做的事情:点击东西，在文本字段中输入，滚动，提取数据，等等。</p><p id="3eb4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Selenium WebDriver可用于更多编程语言:Ruby、Java、Python、C#、JavaScript、+其他非官方支持的语言。但是在本文中，我们将只使用Python版本。</p><p id="a211" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在，让我们来看看如何使用Selenium来做这些事情，我们将从它的安装开始。</p><h2 id="042d" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">装置</h2><p id="053d" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">像大多数Python包一样，安装非常简单:</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="839e" class="me mf it nc b gy ng nh l ni nj">pip install selenium</span></pre><p id="aea3" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">…或者:</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="fd90" class="me mf it nc b gy ng nh l ni nj">conda install selenium</span></pre><p id="d97f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">但是除了安装python包，我们还需要下载一个浏览器驱动程序。浏览器驱动只是由浏览器开发者提供的可执行文件，Selenium使用它。浏览器驱动可用于以下网络浏览器:<a class="ae lh" href="https://sites.google.com/a/chromium.org/chromedriver/" rel="noopener ugc nofollow" target="_blank"> Chrome </a>、<a class="ae lh" href="https://github.com/mozilla/geckodriver/" rel="noopener ugc nofollow" target="_blank"> Firefox </a>、<a class="ae lh" href="https://developer.microsoft.com/en-us/microsoft-edge/tools/webdriver/" rel="noopener ugc nofollow" target="_blank"> Edge </a>、<a class="ae lh" href="http://choice.opera.com/developer/tools/operadriver/" rel="noopener ugc nofollow" target="_blank"> Opera </a>和<a class="ae lh" href="https://developer.apple.com/documentation/webkit/testing_with_webdriver_in_safari" rel="noopener ugc nofollow" target="_blank"> Safari </a>。</p><p id="06cd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在Selenium中使用浏览器之前，我们首先需要下载所需的浏览器驱动程序，将其放入一个文件夹中(如<code class="fe nk nl nm nc b">C:\Users\username\browser_drivers</code>)，并将该文件夹添加到PATH环境变量中。</p><h2 id="3717" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">打开浏览器并四处导航</h2><p id="5e02" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">我们首先需要导入Selenium，然后，要打开特定的Web浏览器，只需构建相应的对象:</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="42ce" class="me mf it nc b gy ng nh l ni nj">from selenium import webdriver<br/></span><span id="ecfe" class="me mf it nc b gy nn nh l ni nj">chrome_driver = webdriver.Chrome()</span><span id="dc73" class="me mf it nc b gy nn nh l ni nj">firefox_driver = webdriver.Firefox()</span><span id="e5a9" class="me mf it nc b gy nn nh l ni nj">edge_driver = webdriver.Edge()</span><span id="f445" class="me mf it nc b gy nn nh l ni nj">opera_driver = webdriver.Opera()</span><span id="e637" class="me mf it nc b gy nn nh l ni nj">safari_driver = webdriver.Safari()</span></pre><p id="f407" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，当我们运行<code class="fe nk nl nm nc b">driver = webdriver.Chrome()</code>时，Chrome窗口会立即打开。</p><p id="3c67" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">如果我们只想抓取一些数据，而不想打开浏览器窗口，我们可以在无头模式下打开浏览器:</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="4a3b" class="me mf it nc b gy ng nh l ni nj">from selenium import webdriver</span><span id="55f2" class="me mf it nc b gy nn nh l ni nj">from selenium.webdriver.chrome.options import Options<br/></span><span id="fbce" class="me mf it nc b gy nn nh l ni nj">chrome_options = Options()</span><span id="420f" class="me mf it nc b gy nn nh l ni nj">chrome_options.add_argument('--headless')</span><span id="c031" class="me mf it nc b gy nn nh l ni nj">driver = webdriver.Chrome(options=chrome_options)</span></pre><p id="4045" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上面的代码将在没有用户界面的情况下打开Chrome，所以我们不会在屏幕上看到任何东西。</p><p id="1c4a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">打开浏览器后，我们可以导航到一个网址，就像调用驱动对象上的<code class="fe nk nl nm nc b">.get(“https://www.example.com”)</code>方法一样简单。</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="b2e3" class="me mf it nc b gy ng nh l ni nj">driver = webdriver.Chrome()</span><span id="e782" class="me mf it nc b gy nn nh l ni nj">driver.get('https://www.google.com')</span></pre><p id="5e23" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我们可以使用<code class="fe nk nl nm nc b">.back()</code>和<code class="fe nk nl nm nc b">.forward()</code>方法在我们的历史中来回导航。</p><p id="ca29" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="no np l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nq"><img src="../Images/b1d3d62095fbd574a6204f208b0aa18d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ESXd3acdVReyCo7bPvs--A.gif"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><h2 id="0f9f" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">与网页交互</h2><p id="422f" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">为了与网页交互，我们首先需要定位我们想要的元素，然后我们可以向它发送命令。</p><p id="fdd6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Selenium有一系列方法可以用来识别页面上的元素。</p><p id="66d4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">列举其中一些，它们是:</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="1ab3" class="me mf it nc b gy ng nh l ni nj">element = driver.find_element_by_id(‘…’)</span><span id="7017" class="me mf it nc b gy nn nh l ni nj">element = driver.find_element_by_name(‘…’)</span><span id="560d" class="me mf it nc b gy nn nh l ni nj">element = driver.find_element_by_tag_name(‘…’)</span><span id="f8be" class="me mf it nc b gy nn nh l ni nj">element = driver.find_element_by_class_name(‘…’)</span><span id="73f0" class="me mf it nc b gy nn nh l ni nj">element = driver.find_element_by_css_selector(‘…’)</span></pre><p id="d7cb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">…以及:</p><pre class="ks kt ku kv gt nb nc nd ne aw nf bi"><span id="8387" class="me mf it nc b gy ng nh l ni nj">elements = driver.find_elements_by_id(‘…’)</span><span id="f6cf" class="me mf it nc b gy nn nh l ni nj">elements = driver.find_elements_by_name(‘…’)</span><span id="66ab" class="me mf it nc b gy nn nh l ni nj">elements = driver.find_elements_by_tag_name(‘…’)</span><span id="3354" class="me mf it nc b gy nn nh l ni nj">elements = driver.find_elements_by_class_name(‘…’)</span><span id="0817" class="me mf it nc b gy nn nh l ni nj">elements = driver.find_elements_by_css_selector(‘…’)</span></pre><p id="1390" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">第一组方法只返回找到的第一个匹配标准的元素。如果没有这样的元素，则产生一个<code class="fe nk nl nm nc b">NoSuchElementException</code>。</p><p id="5e0e" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">第二组方法返回所有匹配元素的列表，如果没有这样的元素并且没有引发异常，则返回一个空列表。</p><p id="0372" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这些方法可以在一个驱动对象(由<code class="fe nk nl nm nc b">webdriver.BrowserName()</code>返回)或另一个元素上调用。</p><p id="802a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在这些方法中，在我(以及其他了解CSS的人)看来最方便的是<code class="fe nk nl nm nc b">.find_element(s)_by_css_selector</code>。这是因为在CSS选择器中，我们可以打包识别页面上的元素所需的所有信息，我们可以用所有其他方法一次完成。也就是说，在CSS选择器中，我们可以使用标签名、id、类名、属性和许多其他东西。这里的<a class="ae lh" href="https://www.freecodecamp.org/news/css-selectors-cheat-sheet/" rel="noopener ugc nofollow" target="_blank">是一个关于CSS选择器的备忘单，如果你需要的话。</a></p><p id="1335" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">在我们识别了页面上的一个元素之后，我们可以向它发送几个信号。列举几个，我们可以用<code class="fe nk nl nm nc b">element.click()</code>点击它，可以用<code class="fe nk nl nm nc b">element.send_keys(…)</code>在上面按键盘键，也可以用<code class="fe nk nl nm nc b">element.clear()</code>清除一个文本输入。</p><p id="0fb4" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><code class="fe nk nl nm nc b">.send_keys(…)</code>可用于一次发送更多文本数据(<code class="fe nk nl nm nc b">element.send_keys(‘Selenium is cool.’)</code>)或发送单个按键，如向上/向下箭头(<code class="fe nk nl nm nc b">element.send_keys(Keys.ARROW_DOWN)</code>)。</p><p id="b1f2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">以下是使用箭头键滚动的示例:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="no np l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nq"><img src="../Images/8084e0ae33b65cd1ae12d7bffe58a49a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*Latgt4pA2iL_-GkPGV_GgQ.gif"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="280d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">下面是一个在谷歌上搜索东西的例子:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="no np l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nq"><img src="../Images/93ff44e089166222a4055612ee0af41c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*ZNiLfb28Lt4EtE1eFOOxBQ.gif"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="1486" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">现在你可能想知道上面代码中的<code class="fe nk nl nm nc b">driver.switch_to.frame(iframe)</code>和<code class="fe nk nl nm nc b">driver.switch_to.default_content()</code>是怎么回事。当您使用Selenium在页面中搜索元素时，它会忽略iframes中的内容。因此，您需要使用<code class="fe nk nl nm nc b">driver.switch_to.frame(iframe)</code>来搜索iframe中的元素。然后，在您找到您要寻找的内容之后，需要调用<code class="fe nk nl nm nc b">driver.switch_to.default_content()</code>以便能够找到您先前选择的iframe之外的元素。</p><p id="1de6" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">上面的循环看起来像有人在文本域中输入，但是我们可以用<code class="fe nk nl nm nc b">search_input.send_keys(‘python find in list’)</code>一次输入所有的文本。</p><p id="9a5d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">顺便说一下，<code class="fe nk nl nm nc b">.send_keys()</code>方法也允许通过使用类似backspace: <code class="fe nk nl nm nc b">search_input.send_keys(Keys.BACKSPACE)</code>的键来删除文本。</p><h2 id="4a7e" class="me mf it bd mg mh mi dn mj mk ml dp mm lr mn mo mp lv mq mr ms lz mt mu mv iz bi translated">从网页中提取数据</h2><p id="0a31" class="pw-post-body-paragraph li lj it lk b ll mw kd ln lo mx kg lq lr my lt lu lv mz lx ly lz na mb mc md im bi translated">当我们在页面上找到一个元素后，主要有三种方法可以从中提取数据:</p><ul class=""><li id="f941" class="nr ns it lk b ll lm lo lp lr nt lv nu lz nv md nw nx ny nz bi translated">通过<code class="fe nk nl nm nc b">element.text</code>属性返回HTML元素中的文本</li><li id="6de8" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">通过使用<code class="fe nk nl nm nc b">element.get_attribute(attr_name)</code>我们可以得到一个属性的值，例如href，class，name。如果没有给定名称的属性，它返回<code class="fe nk nl nm nc b">None</code>。</li><li id="74c7" class="nr ns it lk b ll oa lo ob lr oc lv od lz oe md nw nx ny nz bi translated">通过用<code class="fe nk nl nm nc b">element.screenshot(filename)</code>截屏元素。文件名应该是图像文件的完整路径，包括。png扩展名。如果有一个<code class="fe nk nl nm nc b">IOError</code>，该方法返回False。如果一切正常，则返回True。</li></ul><p id="8310" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">例如，下面我们将提取上面看到的google搜索的页面标题和URL，并将它们放入pandas数据框中。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="no np l"/></div></figure></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><p id="770a" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">本文到此为止。我希望它让您对Selenium WebDriver的能力有了一个很好的了解。</p><p id="38ea" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><em class="om">我希望这些信息对您有用，感谢您的阅读！</em></p><p id="1e4d" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">这篇文章也贴在我自己的网站<a class="ae lh" href="https://www.nablasquared.com/selenium-webdriver-browse-the-web-with-code/" rel="noopener ugc nofollow" target="_blank">这里</a>。随便看看吧！</p></div></div>    
</body>
</html>