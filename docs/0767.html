<html>
<head>
<title>Analysing Whatsapp Group Chats using StreamLit— Part II</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用StreamLit分析Whatsapp群聊—第二部分</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/whatsapp-group-chat-analysis-part-ii-efd7d4d0b051?source=collection_archive---------1-----------------------#2020-08-06">https://pub.towardsai.net/whatsapp-group-chat-analysis-part-ii-efd7d4d0b051?source=collection_archive---------1-----------------------#2020-08-06</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7f10" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-science" rel="noopener ugc nofollow" target="_blank">数据科学</a>，<a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="6893" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">我的应用程序从笔记本到使用Streamlit和Heroku的web应用程序的旅程。</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/d1eb0f5d4029c5681fa4f3400e63824c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kh29RTZK-ZD8Z59tRmAi6w.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">web应用程序的屏幕截图。</figcaption></figure><blockquote class="lh li lj"><p id="80d3" class="lk ll lm ln b lo lp kd lq lr ls kg lt lu lv lw lx ly lz ma mb mc md me mf mg im bi translated"><strong class="ln jd">不要满足于“差不多”完成一项任务。继续，直到你完成它。</strong></p></blockquote><p id="d093" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">在数据科学中，从事实时项目非常重要。与世界分享您的工作同样重要，这可以确保我们不断收到反馈，并提高我们应用程序的性能。Jupyter笔记本，Google Colab链接是分享我们工作的好方法。但在大多数情况下，客户或最终用户是一个拥有最少技术知识的人。你如何与他们分享你的工作？</p><p id="eef0" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated"><strong class="ln jd">一款网络应用来拯救我们了！我们可以将我们的分析嵌入到Web应用程序中，并与外界共享。因此，客户端上的负载减少，这使得他们的工作更容易。请务必阅读我以前的<a class="ae mk" href="https://medium.com/towards-artificial-intelligence/whatsapp-group-chat-analysis-using-python-and-plotly-89bade2bc382" rel="noopener"> <strong class="ln jd">文章</strong> </a>，了解我们是如何执行数据收集、清理、转换和可视化部分的。在本文中，我将讲述如何使用Streamlit创建一个代码最少的web应用程序。</strong></p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="6f22" class="ms mt it bd mu mv mw mx my mz na nb nc ki nd kj ne kl nf km ng ko nh kp ni nj bi translated">什么是Streamlit？</h1><p id="fc8a" class="pw-post-body-paragraph lk ll it ln b lo nk kd lq lr nl kg lt mh nm lw lx mi nn ma mb mj no me mf mg im bi translated">Streamlit是一个开源的应用程序框架，通过它我们可以为机器学习和数据科学创建高性能和漂亮的web应用程序。一切都是纯python写的。让我们开始吧！</p><ol class=""><li id="3b4d" class="np nq it ln b lo lp lr ls mh nr mi ns mj nt mg nu nv nw nx bi translated">确保您安装了<a class="ae mk" href="https://www.python.org/downloads/" rel="noopener ugc nofollow" target="_blank"> Python 3.6 </a>或更高版本。</li><li id="494d" class="np nq it ln b lo ny lr nz mh oa mi ob mj oc mg nu nv nw nx bi translated">使用<a class="ae mk" href="https://pip.pypa.io/en/stable/installing/" rel="noopener ugc nofollow" target="_blank"> PIP </a>安装Streamlit:</li></ol><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="cf18" class="oi mt it oe b gy oj ok l ol om">pip install streamlit</span></pre><p id="160b" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">运行以下命令。</p><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="cd52" class="oi mt it oe b gy oj ok l ol om">streamlit hello</span></pre><p id="c6b6" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">就是这样！在接下来的几秒钟内，示例应用程序将在默认浏览器的新选项卡中打开。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi on"><img src="../Images/e6220069113b98bfce0c091e6059820e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*c02Ipk84rRHIv7HZFj-Qkw.png"/></div></div></figure><p id="36ef" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">可以看到一个看起来简单整洁的默认布局。为了创建我们的应用程序，让我们创建一个新的python脚本<code class="fe oo op oq oe b">Whatsapp_Analysis.py</code>并开始编写代码！<br/>首先，我们将导入所需的依赖关系。Streamlit为我们提供了一些实用功能，如<code class="fe oo op oq oe b">st.text()</code>、<code class="fe oo op oq oe b">st.sidebar.text()</code>、<code class="fe oo op oq oe b">st.markdown()</code>等。我们可以在<code class="fe oo op oq oe b">st.markdown()</code>中嵌入HTML代码，确保我们可以修改用户界面。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="or os l"/></div></figure><h2 id="2224" class="oi mt it bd mu ot ou dn my ov ow dp nc mh ox oy ne mi oz pa ng mj pb pc ni iz bi translated">输出—</h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi on"><img src="../Images/15df2668d12e78187c979a57259e7521.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cNis6NN5r8aqb00YI6fhFg.png"/></div></div></figure><p id="0b3b" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">令人惊讶的是，70%的UI都是用上面的10行代码完成的。上面的代码也是响应性的，当在手机上查看时-</p><div class="ks kt ku kv gt ab cb"><figure class="pd kw pe pf pg ph pi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/27e7e0fbfc0ed9223d267427fa4cb8ef.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*K-1LnxC3n6DZkMRf4qlO7g.png"/></div></figure><figure class="pd kw pe pf pg ph pi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/b41bb2f36f5d6dd462ec48e80cca9102.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*aicjsaWWWbV_bGc9VWJgzA.png"/></div></figure></div><p id="29ee" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">让web应用程序具有响应性是前端开发人员可能面临的最大问题，但幸运的是，框架在我们的案例中处理了这个问题。现在我们需要加载导出的聊天文件并运行分析。</p><h1 id="4d9b" class="ms mt it bd mu mv pj mx my mz pk nb nc ki pl kj ne kl pm km ng ko pn kp ni nj bi translated">数据流</h1><p id="f4a5" class="pw-post-body-paragraph lk ll it ln b lo nk kd lq lr nl kg lt mh nm lw lx mi nn ma mb mj no me mf mg im bi translated">Streamlit的架构允许我们像编写python脚本一样编写应用程序。为了在屏幕上呈现任何更新，Streamlit从上到下运行python脚本。每当我们与屏幕上的任何按钮进行交互或给出任何输入时，Streamlit都会从头到尾运行整个python脚本。</p><p id="a12d" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">您可能认为对于较长的脚本来说，这是一个乏味的过程。是的，它是！但这正是Streamlit在幕后为我们做一些繁重工作的地方。一个大玩家<code class="fe oo op oq oe b">st.cache()</code>装饰者出现了。这允许应用程序在重新运行时跳过某些高成本的计算(其输出不会改变)。</p><h1 id="58d9" class="ms mt it bd mu mv pj mx my mz pk nb nc ki pl kj ne kl pm km ng ko pn kp ni nj bi translated">小工具</h1><p id="1659" class="pw-post-body-paragraph lk ll it ln b lo nk kd lq lr nl kg lt mh nm lw lx mi nn ma mb mj no me mf mg im bi translated">当您将数据放入您想要探索的状态时，您可以添加像<code class="fe oo op oq oe b"><a class="ae mk" href="https://docs.streamlit.io/en/stable/api.html#streamlit.slider" rel="noopener ugc nofollow" target="_blank">st.slider()</a></code>、<code class="fe oo op oq oe b"><a class="ae mk" href="https://docs.streamlit.io/en/stable/api.html#streamlit.button" rel="noopener ugc nofollow" target="_blank">st.button()</a></code>或<code class="fe oo op oq oe b"><a class="ae mk" href="https://docs.streamlit.io/en/stable/api.html#streamlit.selectbox" rel="noopener ugc nofollow" target="_blank">st.selectbox()</a></code>这样的小部件。这非常简单——只需将小部件视为变量:</p><p id="fe1b" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">在我们的聊天分析应用中，我们将使用两个小部件。一个上传聊天文件，另一个根据用户输入过滤统计数据。</p><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="600b" class="oi mt it oe b gy oj ok l ol om">uploaded_file = st.file_uploader("Upload Your Whatsapp Chat.(.txt file only!)", type="txt")</span></pre><p id="02d1" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">这将创建一个文件上传器，并且只接受<code class="fe oo op oq oe b">.txt</code>类型的文件。第一个参数是这个文件上传器的标题。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi po"><img src="../Images/94135a92d6608fa4600ca5bf5ed59ed0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*Lq_pbXhvBelnxZ7kdAsHbw.png"/></div></figure><p id="a8b8" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">点击<strong class="ln jd">浏览文件</strong>会将我们导向本地系统，我们必须上传一个<code class="fe oo op oq oe b">.txt</code>文件。</p><p id="6cab" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated"><code class="fe oo op oq oe b">.txt</code>文件是一个文本文件，由导出的WhatsApp聊天组成。正如我在上一篇文章中所讨论的，我们将解析文本，将其分为日期、时间、作者、消息类别，并创建一个数据框。我们还将通过删除丢失的值来清理数据帧，并执行适当的类型转换(即将日期字符串转换为日期时间格式等。).之后，我们可以根据需要过滤数据框并创建图。</p><p id="364e" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">由于我使用Plotly进行可视化，我们可以使用函数<code class="fe oo op oq oe b">st.plotly_chart(fig)</code>创建Plotly图形。例如，为了创建一个表情符号分布图，我们将编写一个函数<code class="fe oo op oq oe b">visualize_emoji()</code>，它将通过过滤数据帧来创建一个Plotly图，并返回该图。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="32f7" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">现在我们可以使用下面的代码来绘制这个图。</p><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="9952" class="oi mt it oe b gy oj ok l ol om">st.subheader("**%s's emoji distribution 😂**"% name)<br/>st.text("Hover on Chart to see details.")<br/>st.plotly_chart(visualize_emoji(data),use_container_width=True)</span></pre><p id="6489" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">这里的名称表示个人名称或团体。</p><h2 id="d1c6" class="oi mt it bd mu ot ou dn my ov ow dp nc mh ox oy ne mi oz pa ng mj pb pc ni iz bi translated">输出-</h2><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi pp"><img src="../Images/fc90760f70d2631249c2870d85782d50.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uvtP_pPwwMHXdTAg30LbCA.png"/></div></div></figure><p id="24a5" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">同样，上一篇文章中提到的所有情节都是创造出来的。web应用程序中包含的另一个功能是基于用户过滤统计数据的能力。我们提供了一个下拉菜单，并要求用户选择一个特定的用户，其个人统计数据将被显示。</p><p id="ca73" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">要创建下拉菜单，我们将使用<code class="fe oo op oq oe b">st.selectbox()</code>命令。我们将向<code class="fe oo op oq oe b">st.selectbox()</code>命令传递一个包含唯一作者的列表和一个选项“all”(针对整个组统计)。用户选择的选项存储在名为<strong class="ln jd">选项</strong>的变量中，该变量用于过滤数据帧中的统计数据。</p><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="c5bf" class="oi mt it oe b gy oj ok l ol om">authorlist = list(data.Author.unique())<br/>authorlist.insert(0,'All')<br/>st.subheader("**Who's Stats do you want to see?**")<br/>option = st.selectbox("", authorlist)</span></pre><div class="ks kt ku kv gt ab cb"><figure class="pd kw pe pf pg ph pi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/317932659ce3424270681b0498067129.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*veitRRoOdgt1Por5N5roFw.png"/></div></figure><figure class="pd kw pe pf pg ph pi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><img src="../Images/ef3ba4c7dfe74ba2e8301bb98d313dd9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*9N2pmdua7W4XFrJI-Te5qw.png"/></div></figure></div></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="06d7" class="ms mt it bd mu mv mw mx my mz na nb nc ki nd kj ne kl nf km ng ko nh kp ni nj bi translated">圣缓存()</h1><p id="58ad" class="pw-post-body-paragraph lk ll it ln b lo nk kd lq lr nl kg lt mh nm lw lx mi nn ma mb mj no me mf mg im bi translated">正如我已经提到的，每当我们给出一个新的输入流时，它就从上到下运行python脚本。在我们的例子中，当我们从下拉列表中选择一个用户时，Streamlit运行整个脚本，包括打开文件、解析文件、创建数据框和应用过滤。</p><p id="40bf" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">这不是一个最优的方式，因为过滤只需要数据框并每次解析数据，当我们点击每个用户时再次创建数据框是不合适的。因此，我们将使用st.cache()命令和<code class="fe oo op oq oe b">load_data()</code>函数。这将确保第二次运行<code class="fe oo op oq oe b">load_data()</code>函数时，其结果将直接从缓存中取出，而不是重新运行该函数。这提高了应用程序的速度并增强了性能。</p><pre class="ks kt ku kv gt od oe of og aw oh bi"><span id="dcc3" class="oi mt it oe b gy oj ok l ol om"><a class="ae mk" href="http://twitter.com/st" rel="noopener ugc nofollow" target="_blank">@st</a>.cache(allow_output_mutation=True)<br/># This function parses the text file and creates the data frame.<br/>def load_data(uploaded_file):<br/>         .....function body</span></pre></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="48ef" class="ms mt it bd mu mv mw mx my mz na nb nc ki nd kj ne kl nf km ng ko nh kp ni nj bi translated">使用Heroku部署</h1><p id="b6b9" class="pw-post-body-paragraph lk ll it ln b lo nk kd lq lr nl kg lt mh nm lw lx mi nn ma mb mj no me mf mg im bi translated">Heroku 是一个平台即服务(PaaS ),支持开发者完全在云中构建、运行和操作应用。我们将把我们的web应用程序部署到Heroku。这是一个简短的过程，在这篇文章<a class="ae mk" href="https://towardsdatascience.com/deploy-streamlit-on-heroku-9c87798d2088" rel="noopener" target="_blank">中有很好的解释。</a></p><p id="966a" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">您可以通过点击下面的链接访问完全运行的web应用程序。<br/><a class="ae mk" href="https://group-whatsapp-analyzer.herokuapp.com/" rel="noopener ugc nofollow" target="_blank">Whatsapp-群聊-分析器</a>。</p></div><div class="ab cl ml mm hx mn" role="separator"><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq mr"/><span class="mo bw bk mp mq"/></div><div class="im in io ip iq"><h1 id="c7ee" class="ms mt it bd mu mv mw mx my mz na nb nc ki nd kj ne kl nf km ng ko nh kp ni nj bi translated">结论</h1><p id="ae3b" class="pw-post-body-paragraph lk ll it ln b lo nk kd lq lr nl kg lt mh nm lw lx mi nn ma mb mj no me mf mg im bi translated">在本文中，我试图解释使用Streamlit为一个数据科学项目创建一个web应用程序。对于数据分析师来说，以简单的方式向技术/非技术用户展示他们的结果是非常重要的。我希望你今天学到了新东西！</p><p id="ec19" class="pw-post-body-paragraph lk ll it ln b lo lp kd lq lr ls kg lt mh lv lw lx mi lz ma mb mj md me mf mg im bi translated">我希望你今天带回家一些新概念！如果你想联系，<strong class="ln jd">在</strong><a class="ae mk" href="https://www.linkedin.com/in/saiteja-kura-49803b13b/" rel="noopener ugc nofollow" target="_blank"><strong class="ln jd">LinkedIn</strong></a><strong class="ln jd">上联系我。</strong></p></div></div>    
</body>
</html>