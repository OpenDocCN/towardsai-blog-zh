<html>
<head>
<title>Ashrae Great Energy Prediction Challenge</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Ashrae大能量预测挑战</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/ashrae-great-energy-prediction-challenge-cefab05e4f2?source=collection_archive---------1-----------------------#2020-06-09">https://pub.towardsai.net/ashrae-great-energy-prediction-challenge-cefab05e4f2?source=collection_archive---------1-----------------------#2020-06-09</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="0675" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning/deep-learning" rel="noopener ugc nofollow" target="_blank">深度学习</a></h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/d138ddee6e542d0cd6abeb3e270e41bb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*irth2EFMkXOnB5gJU6bRew.jpeg"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">照片由<a class="ae kl" href="https://unsplash.com/@danielzacatenco" rel="noopener ugc nofollow" target="_blank"> <strong class="bd km">丹尼尔·萨卡特科</strong> </a> <strong class="bd km"> </strong>在<strong class="bd km"> Unsplash </strong></figcaption></figure><p id="7a5d" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">Linkedin <a class="ae kl" href="http://linkedin.com/in/gundluru-chandrasekhar-499129196" rel="noopener ugc nofollow" target="_blank">简介</a>简介&amp; Github <a class="ae kl" href="https://github.com/Chandugundluru?tab=repositories" rel="noopener ugc nofollow" target="_blank">简介</a></p><h2 id="1afb" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated"><strong class="ak">目录:</strong></h2><ol class=""><li id="bce9" class="mc md iq kp b kq me ku mf ky mg lc mh lg mi lk mj mk ml mm bi translated">问题陈述</li><li id="167a" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk mj mk ml mm bi translated">数据集</li><li id="a807" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk mj mk ml mm bi translated">将现实世界的问题映射到ML问题</li><li id="1126" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk mj mk ml mm bi translated">探索性数据分析</li><li id="75ca" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk mj mk ml mm bi translated">特征工程</li><li id="19f0" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk mj mk ml mm bi translated">极端值</li><li id="2b50" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk mj mk ml mm bi translated">特征选择</li><li id="b908" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk mj mk ml mm bi translated">模型和超参数调整</li><li id="b0cd" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk mj mk ml mm bi translated">深度学习模型</li><li id="3cd0" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk mj mk ml mm bi translated">堆积回归</li><li id="b73a" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk mj mk ml mm bi translated">参考</li></ol><h2 id="ee87" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated"><span class="l ms mt mu bm mv mw mx my mz di"> 1。</span> <strong class="ak">问题陈述</strong></h2><p id="3f3d" class="pw-post-body-paragraph kn ko iq kp b kq me ks kt ku mf kw kx ky na la lb lc nb le lf lg nc li lj lk ij bi translated">正在进行大量投资来提高建筑效率，以降低成本和排放。问题是，这些改进奏效了吗？这就是我们的切入点。在按绩效付费的融资方式下，建筑业主根据其实际能耗与未进行任何改造时的能耗之间的差异进行支付。后面的值必须来自一个模型。目前的评估方法是零散的，不能很好地扩展。有些采用特定的仪表类型，或者不适用于不同的建筑类型。</p><p id="e87f" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">在本次竞赛中，我们将在以下领域开发计量建筑能源使用的精确模型:冷水、电、热水和蒸汽仪表。这些数据来自超过1000栋建筑，历时三年。随着对这些节能投资的更好估计，大规模投资者和金融机构将更倾向于在这一领域投资，以促进建筑效率的提高。</p><p id="ac77" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">来源:【https://www.kaggle.com/c/ashrae-energy-prediction】<a class="ae kl" href="https://www.kaggle.com/c/ashrae-energy-prediction/data" rel="noopener ugc nofollow" target="_blank"><strong class="kp ja"/></a></strong></p><h2 id="28b4" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated"><strong class="ak"> 2。数据</strong></h2><p id="08f6" class="pw-post-body-paragraph kn ko iq kp b kq me ks kt ku mf kw kx ky na la lb lc nb le lf lg nc li lj lk ij bi translated">第一个观察结果是训练和测试数据分布在5个不同的CSV文件中。train、test、weather_train和weather_test是时间序列数据，每小时测量一次。Building_metadata包含建筑物的特征，例如建筑物的站点id、主要用途、平方英尺、建造年份。在天气数据集中，有与风、云、温度和压力相关的要素。</p><p id="4ad8" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">从2016年1月1日到2017年1月1日测量的天气_列车数据集。Weather_test数据集跨度为2017年1月1日至2019年1月1日。</p><p id="e2be" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">来源:https://www.kaggle.com/c/ashrae-energy-prediction/data</p><h2 id="8e8d" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated"><span class="l ms mt mu bm mv mw mx my mz di"> 3。</span> <strong class="ak">映射到现实世界的问题</strong></h2><p id="00a7" class="pw-post-body-paragraph kn ko iq kp b kq me ks kt ku mf kw kx ky na la lb lc nb le lf lg nc li lj lk ij bi translated">我们有一个回归问题。因此，使用1年的数据，我们将预测建筑物未来2年的能耗</p><p id="23a6" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">评估指标</strong></p><ul class=""><li id="0b32" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">本次竞赛的评估标准是均方根对数误差。</li></ul><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nh"><img src="../Images/04130c5bdaaa7c2fbb4cca189b6f328e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*39eUocUvQjA9KO2eiiSkqA.jpeg"/></div></div></figure><p id="ac04" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">其中:</p><p id="204e" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">n是(公共/私人)数据集中的观察总数<br/> yi^你预测的目标<br/> y是ii的实际目标。<br/> log(x)是x的自然对数</p><p id="210e" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">来源:<a class="ae kl" href="https://www.kaggle.com/c/ashrae-energy-prediction/overview/evaluation" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/c/ASHRAE-energy-prediction/overview/evaluation</a></p><h2 id="ad38" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated"><strong class="ak"> 4。探索性数据分析</strong></h2><p id="aa49" class="pw-post-body-paragraph kn ko iq kp b kq me ks kt ku mf kw kx ky na la lb lc nb le lf lg nc li lj lk ij bi translated">我使用熊猫轮廓对建筑和天气数据集进行数据分析。</p><p id="ae32" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">让我们探索构建数据集</strong></p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="fb39" class="ll lm iq nn b gy nr ns l nt nu">import pandas_profiling as pp</span><span id="5677" class="ll lm iq nn b gy nv ns l nt nu">pp.ProfileReport(building_df)</span></pre><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nw"><img src="../Images/b97c9b1f43a3f1f0644d13c3911d0d36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*79VE7sd6luw6jZoCm5yJog.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">建筑数据概述建筑数据中缺少值</figcaption></figure><ul class=""><li id="ad99" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">Building_id是该数据集的主键。来自1449栋建筑的观察。</li><li id="6f45" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">floor_count和year _ built列中超过50%的值缺失。</li><li id="4476" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">除了primary_use之外，所有列都是数字特征。</li><li id="59db" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">primary_use列是分类的，大多数值是教育、办公和公共集会。</li></ul><div class="ni nj nk nl gt ab cb"><figure class="nx ka ny nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/8dc42dce6d65e5bdacb532730788bca0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1200/format:webp/1*0GuJ8c4Si3TX7Fh_KMjQ6Q.png"/></div></figure><figure class="nx ka od nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/c2b8121c6033a05f0e491a28fa584285.png" data-original-src="https://miro.medium.com/v2/resize:fit:802/format:webp/1*cdjriWXRKAQQNnFlsVAy5A.png"/></div></figure></div><p id="f7b8" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">天气数据分析:</strong></p><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi oe"><img src="../Images/e75af53052d1d1050b2f44880298ca52.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*e8rnKTMS0Xqwt4-nHOFiVQ.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">天气数据概述天气数据中缺少值</figcaption></figure><ul class=""><li id="0047" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">除时间戳外，所有特征都是数字，并采用以下单位和范围:</li><li id="77fa" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">cloud_coverage、precip_depth_1_hr、sea_level_pressure和wind_direction的缺失值非常高。</li></ul><div class="ni nj nk nl gt ab cb"><figure class="nx ka of nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/fcd74dd810b44bb32b6632dd0e6161ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:1066/format:webp/1*xmjH8iQDgURWhShy4oEFdQ.png"/></div></figure><figure class="nx ka og nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/14f542f17ab15c43d53a7ff49c68d490.png" data-original-src="https://miro.medium.com/v2/resize:fit:936/format:webp/1*taNW9N6QSNBoGTOMZ6i_wQ.png"/></div></figure></div><p id="c3a9" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">列车_数据分析:</strong></p><ul class=""><li id="149c" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">列车数据包含仪表读数(目标值)。让我们来探讨阅读资料的分布</li><li id="f896" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">这是训练数据集中最大的数据集。几乎有2000万行，所以很难适应熊猫轮廓</li></ul><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/298d4c12bba60d41e40a7ef373e50962.png" data-original-src="https://miro.medium.com/v2/resize:fit:1126/format:webp/1*ZuRv6_IwMQ8u2d7-_ViWnA.png"/></div></figure><ul class=""><li id="aa15" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">由于它严重右偏，我将log应用于仪表读数…现在让我们检查分布情况……</li></ul><div class="ni nj nk nl gt ab cb"><figure class="nx ka oi nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/cfa6edf12d1af1afe7af37b9ab9c1e4e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*_nSGZgkvb-BQgCvUfm5lOA.png"/></div></figure><figure class="nx ka oj nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/f0b3b2b1f34d4e0b34de76fa8ece8131.png" data-original-src="https://miro.medium.com/v2/resize:fit:982/format:webp/1*goIlIT5sIcLJOVoBXhWtYQ.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk ok di ol om translated">仪表读数日志和单个仪表</figcaption></figure></div><ul class=""><li id="518b" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">很明显，在仪表读数中，大多数值为零</li><li id="80e8" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">一个显而易见的事实是。大量的观察值0来自热水、冷水和蒸汽消耗，这意味着我们在用电量方面的缺失值和观察值0更少。</li><li id="2d83" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">这张图显示了抄表值在每个电表类别中的不同分布，尤其是用电量与其他不同。因此，仪表是确定仪表读数的重要变量</li><li id="369c" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">现在，通过添加time_stamp中的月和周功能来深入分析数据，以便对仪表读数进行月和日分析</li></ul><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="6778" class="ll lm iq nn b gy nr ns l nt nu">def time_features(df):<br/># Sort by timestamp<br/>df.sort_values("timestamp")<br/>df.reset_index(drop=True)<br/>df["timestamp"] = pd.to_datetime(df["timestamp"],format="%Y-%m-%d %H:%M:%S")<br/>df["hour"] = df["timestamp"].dt.hour<br/>df["dayofweek"] = df["timestamp"].dt.weekday<br/>df['month'] = df['timestamp'].dt.month<br/>return df<br/>train_df  = time_features(train_df)</span></pre><div class="ni nj nk nl gt ab cb"><figure class="nx ka on nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/de51e489174e8c839dc4fbdcb89f2760.png" data-original-src="https://miro.medium.com/v2/resize:fit:988/format:webp/1*OF5ToJMEERB8zxc9mPReXQ.png"/></div></figure><figure class="nx ka oo nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/f0b49ac8987c00be9843b16bc74b9d21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1014/format:webp/1*5QPhdpjFWUNrG8gXYEqy3A.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk op di oq om translated">电力读数的小时和月平均值</figcaption></figure></div><ul class=""><li id="b639" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">电量观测值在0到220千瓦时之间。</li><li id="870c" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">电表读数在5月份之前都很低</li><li id="28a7" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">上半年，耗电量不超过160千瓦时。</li><li id="fa86" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">下半年，耗电量增加，在160至220千瓦时之间。总的来说，2016年用电量呈增长趋势。</li><li id="2b6f" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">每天的用电高峰出现在下午，平均约为190千瓦时</li></ul><div class="ni nj nk nl gt ab cb"><figure class="nx ka or nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/9d4e8615dae2f917e74bbdb75e0fd277.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*nTaZB0V7VfG6E8mVxSG_qw.png"/></div></figure><figure class="nx ka os nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/3de60aa451e4153b1b6fdac292528089.png" data-original-src="https://miro.medium.com/v2/resize:fit:1008/format:webp/1*kpVtGXnGjoFvAsqzbGHNUg.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk ot di ou om translated">冷水读数的小时和月平均值</figcaption></figure></div><ul class=""><li id="0209" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">冷水消耗量在130-1800千瓦时之间。</li><li id="1fc7" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">它显示了直到2016年9月高达1000千瓦时的稳定增长。在9月和10月之间，用电量出现峰值，导致范围上升到1800千瓦时。</li><li id="8b07" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">从11月开始，它呈现下降趋势。</li><li id="9059" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">冷水水表不出所料是下午的一个高峰</li></ul><div class="ni nj nk nl gt ab cb"><figure class="nx ka ov nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/98fdc1b29fcaafdf662112d1061bf710.png" data-original-src="https://miro.medium.com/v2/resize:fit:1010/format:webp/1*i4ugK3wX9C65iyxDBvLBXw.png"/></div></figure><figure class="nx ka ow nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/779178b3e5ad1465742832c662924b0d.png" data-original-src="https://miro.medium.com/v2/resize:fit:992/format:webp/1*iBlb4ccYOYsFkkUXW0qJZg.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk ox di oy om translated">蒸汽读数的小时和月平均值</figcaption></figure></div><ul class=""><li id="6505" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">蒸汽消耗量范围:0-40千瓦时。</li><li id="54fa" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">蒸汽消耗没有明显的趋势，蒸汽仅在上半年使用。</li><li id="5f21" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">在今年剩下的时间里，消费量急剧下降</li><li id="8ed0" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">2016年11月9日有一个有趣的峰值。</li><li id="e65f" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">下午3点蒸汽表峰值</li></ul><div class="ni nj nk nl gt ab cb"><figure class="nx ka oz nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/e93031020debe369d91dba6fb92e9b72.png" data-original-src="https://miro.medium.com/v2/resize:fit:1006/format:webp/1*rrUtpkssjpbfWcXvXEUZ8g.png"/></div></figure><figure class="nx ka pa nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/5e98387ad321ba853f0c89d9de597504.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*i-KQA2bM-h_JfSFySOi3KQ.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk pb di pc om translated">热水读数的小时和月平均值</figcaption></figure></div><ul class=""><li id="ddde" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">热水表量程0-500热水消耗量在冬季较高，在五月和七月之间显示最低结果。</li><li id="7a2b" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">夏季消费的减少对我们的ML模型来说是一个有用的趋势。</li><li id="abc1" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">热水表在早上达到峰值</li></ul><p id="baac" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">合并建筑和列车数据以供进一步探索</strong></p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="daeb" class="ll lm iq nn b gy nr ns l nt nu">trainbld_df = (train_df.merge(building_df,on='building_id',how='left'))</span></pre><div class="ni nj nk nl gt ab cb"><figure class="nx ka pd nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/f51054814573df4e65fd24f57ac58e5f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*gq57ah9p98XiE1eG7yjNvg.png"/></div></figure><figure class="nx ka pe nz oa ob oc paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><img src="../Images/f0fb16c35c764f837103b601f4071364.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*iJxui0MeH4I2ELIJq8E6zg.png"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk pf di pg om translated">仪表读数与站点id和楼层计数</figcaption></figure></div><ul class=""><li id="56c3" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">站点0、1、2、3、4、5、8、9、14和15具有相似的仪表读数分布</li><li id="da61" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">站点6和10的抄表值共享几乎相同的分布和汇总统计。</li><li id="3c81" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">站点id 13具有超出log_meter_reading_value 10的最宽仪表读数范围。</li><li id="4a0e" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">站点id 11的仪表读数范围最窄，集中在5左右。</li><li id="5a0c" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">站点id 13显示了最广泛的抄表分布。</li><li id="54c8" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">由于floor_count中的数据点较少，很难从图表中提取一些有意义的结论。</li></ul><h2 id="541c" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated"><strong class="ak"> 5。特征工程</strong></h2><p id="f27d" class="pw-post-body-paragraph kn ko iq kp b kq me ks kt ku mf kw kx ky na la lb lc nb le lf lg nc li lj lk ij bi translated"><strong class="kp ja"> a)填充缺失值</strong>:</p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="bbbe" class="ll lm iq nn b gy nr ns l nt nu">sea_level_filler = weather_df.groupby(['site_id','day','month'])['sea_level_pressure'].mean()</span><span id="0c5d" class="ll lm iq nn b gy nv ns l nt nu">sea_level_fillerpd.DataFrame(sea_level_filler.fillna(method='ffill'),columns=['sea_level_pressure'])</span><span id="2d5b" class="ll lm iq nn b gy nv ns l nt nu">weather_df.update(sea_level_filler,overwrite=False)</span></pre><ul class=""><li id="2a38" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">由于cloud_coverage、precip_depth_1_hr、sea_level_pressure和wind_direction的缺失值非常高，需要对其进行填充</li><li id="c63e" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">添加日、周和月功能该数据集包含每小时的天气信息。因此，我们将根据以下新的日期特征来填充缺失的值。</li><li id="0880" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">用一个月中某一天的平均温度填充缺少的气温。每个月都是一个季节，一个季节里气温变化很大。所以用年平均值填充不是一个好主意。</li><li id="ae21" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">大部分时间甚至连续多天都有数据丢失。因此，首先，计算平均云覆盖率、降水深度1小时、海平面气压和风向，然后用最后一次有效观测值填充其余缺失值。(用method='ffill '选项填充。“ffill”代表“向前填充”,并将向前传播最后一次有效观察)</li></ul><p id="8b1d" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja"> b)向数据添加特征:</strong></p><ul class=""><li id="1417" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated"><strong class="kp ja">气象_特征:</strong></li></ul><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ph"><img src="../Images/5bae97725dcb52a459e72293b2c54b8b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XSxUgkxueuzpunGIGUVp1g.png"/></div></div></figure><p id="ece4" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">在哪里</p><ul class=""><li id="0e63" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">dp =露点温度</li><li id="b591" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">RH =相对湿度</li><li id="96bd" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">Ta =气温</li></ul><p id="36db" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">我们的数据集有空气温度和露水温度，我正在计算相对湿度，并将其作为一个新特征添加进来</p><h2 id="2655" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated">RH:= 100(EXP((17.625 TD)/(243.04+TD))/EXP((17.625 * T)/(243.04+T)))</h2><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="d512" class="ll lm iq nn b gy nr ns l nt nu">df['relative_humidity'] = 100 * (np.exp((17.625 * df['dew_temperature']) / (243.04 + df['dew_temperature'])) / np.exp((17.625 * df['air_temperature'])/(243.04 + df['air_temperature'])))</span></pre><p id="5ceb" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">手感_喜欢特征:</strong></p><ul class=""><li id="55b9" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">我们通过气温、相对湿度和风力来计算感觉温度</li><li id="3de8" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">我们通过使用meteocalc库(https://pypi.org/project/meteocalc/)来得到它</li></ul><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="ae3e" class="ll lm iq nn b gy nr ns l nt nu">from meteocalc import feels_like, Temp</span><span id="fabb" class="ll lm iq nn b gy nv ns l nt nu">flike_final = []<br/>flike = []<br/>for i in range(len(df)):<br/>    at = df['air_temperature'][i]<br/>    rh = df['relative_humidity'][i]<br/>    ws = df['wind_speed'][i]<br/>    flike.append(feels_like(Temp(at, unit = 'C'), rh, ws))</span><span id="c37a" class="ll lm iq nn b gy nv ns l nt nu">for i in range(len(flike)):<br/>    flike_final.append(flike[i].f)<br/>    df['feels_like'] = flike_final</span></pre><p id="af59" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">假日_特色:</strong></p><ul class=""><li id="a205" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">通过在构建假日库(包含大多数国家的假日)中使用python，向数据集添加了is_holiday要素</li><li id="bfbb" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">然后对分类特征进行编码</li></ul><h2 id="32ab" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated"><strong class="ak"> 6。离群值:</strong></h2><ul class=""><li id="6cdf" class="mc md iq kp b kq me ku mf ky mg lc mh lg mi lk ng mk ml mm bi translated">列车数据中有一些极端的仪表读数。</li></ul><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi pi"><img src="../Images/0bbdae6fe39b55c0ecc5f4f19b52533d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SOTZSi0dEXKo5V7C6HjKMw.png"/></div></div></figure><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi pj"><img src="../Images/4dee0bd5e3b02256a1946daffb307bc6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0uE8PNufyOBLKbB9NCKQ2Q.png"/></div></div></figure><ul class=""><li id="fff8" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">因为我们发现EDA建筑1099是一个离群值，所以我们删除了它</li><li id="f66f" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">没有理由保持零电气读数，因为它不可能为零。因此这些行也被排除在数据集之外</li><li id="4ce2" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">floor_coont要素被移除，因为它包含超过76%的缺失值</li></ul><h2 id="ee44" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated"><strong class="ak"> 7。特征_选择:</strong></h2><p id="d209" class="pw-post-body-paragraph kn ko iq kp b kq me ks kt ku mf kw kx ky na la lb lc nb le lf lg nc li lj lk ij bi translated">合并建筑物后，天气和火车在新数据集中有17个特征。让我们找出每个特性的特性重要性</p><p id="dbcf" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja"> LOFO重要性(忽略一个特征)</strong></p><ul class=""><li id="e097" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">LOFO(忽略一个要素)重要性基于选择的度量计算一组要素对于选择的模型的重要性，通过迭代地从集合中移除每个要素，并基于选择的度量使用选择的验证方案来评估模型的性能。</li><li id="01af" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">LOFO首先评估包含所有输入特征的模型的性能，然后迭代地一次移除一个特征，重新训练模型，并在验证集上评估其性能。然后报告每个特征的重要性的平均值和标准偏差(跨折叠)</li></ul><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="e753" class="ll lm iq nn b gy nr ns l nt nu">import lightgbm as lgb</span><span id="ce30" class="ll lm iq nn b gy nv ns l nt nu">cat_cols = ['building_id', 'meter', 'site_id', 'primary_use','dayofweek_x','is_holiday','group_x']<br/>model = lgb.LGBMRegressor(boosting_type='gbdt', n_estimators=500,objective='regression',n_jobs=-1)<br/>from sklearn.model_selection import KFold</span><span id="fdae" class="ll lm iq nn b gy nv ns l nt nu">from lofo import LOFOImportance, Dataset, plot_importance</span><span id="452a" class="ll lm iq nn b gy nv ns l nt nu">cv = KFold(n_splits=3, shuffle=False, random_state=0)</span><span id="5b19" class="ll lm iq nn b gy nv ns l nt nu">features = ['square_feet', 'air_temperature', 'cloud_coverage', 'dew_temperature','precip_depth_1_hr', 'sea_level_pressure', 'wind_direction', 'wind_speed','relative_humidity','feels_like'] + cat_cols</span><span id="86c1" class="ll lm iq nn b gy nv ns l nt nu">dataset = Dataset(df=train_df, target="meter_reading", features=features)</span><span id="2d3c" class="ll lm iq nn b gy nv ns l nt nu">lofo_imp = LOFOImportance(dataset, model=model, cv=cv, scoring="mean_squared_error", fit_params={"categorical_feature": cat_cols})<br/>importance_df = lofo_imp.get_importance()<br/>plot_importance(importance_df, figsize=(12, 12))</span></pre><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi pk"><img src="../Images/fe2a740e7306e18198b54edae52af963.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*6n4SkkdjEF6qVibaFxFGLA.png"/></div></div></figure><ul class=""><li id="b26a" class="mc md iq kp b kq kr ku kv ky nd lc ne lg nf lk ng mk ml mm bi translated">仪表类型非常重要</li><li id="c14d" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">precip_depth_1_hr和风向伤害模型</li><li id="48f5" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">气温和海平面气压的影响最小</li><li id="e3b2" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">所以从数据中删除这些特征</li></ul><h2 id="74e8" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated"><strong class="ak"> 8。模型和超参数调整:</strong></h2><p id="85dc" class="pw-post-body-paragraph kn ko iq kp b kq me ks kt ku mf kw kx ky na la lb lc nb le lf lg nc li lj lk ij bi translated">因此，将对回归问题和竞赛结果进行均方根对数误差评估。</p><p id="68d5" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">我已经对目标应用了log1p变换，因此在整个项目中，我将使用RMSE(均方根误差)作为单一评估指标，即:</p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="3b83" class="ll lm iq nn b gy nr ns l nt nu">def rmse(y_true, y_pred):<br/>    return np.sqrt(np.mean(np.square(y_true - y_pred))))</span></pre><p id="ae6e" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">因为模型的目标是预测仪表读数。我决定从最简单直接的方法开始，将标签的平均值作为数据的随机模型</p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="9fda" class="ll lm iq nn b gy nr ns l nt nu">baseline_guess = np.median(y_train)</span><span id="6c74" class="ll lm iq nn b gy nv ns l nt nu">print('The baseline guess is a score of %0.2f' % baseline_guess)print("Baseline Performance on the valid set: RMSE = %0.4f" % rmse(y_test, baseline_guess))</span></pre><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div class="gh gi pl"><img src="../Images/901e8acc28dfb9178291b79cc8869176.png" data-original-src="https://miro.medium.com/v2/resize:fit:1240/format:webp/1*oI1WNyBBydUgfUUtVzYz2A.png"/></div></figure><p id="11c7" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">所以对于随机模型，我们的度量是2.0709</p><p id="9075" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja"> SGDRegressor </strong></p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="6da1" class="ll lm iq nn b gy nr ns l nt nu">alpha = [10 ** x for x in range(-4, 1)]<br/>eta0=[0.001,0.01,0.1]<br/>learning_rate=['invscaling','adaptive']<br/>for i in alpha:<br/>    for k in eta0:<br/>        for j in learning_rate:<br/>            linR=linear_model.SGDRegressor(loss='squared_loss',     penalty='l2', learning_rate=j, eta0=k,alpha=i,early_stopping=True)<br/>            linR.fit(X_train,y_train)<br/>            predict_y =  linR.predict(X_test)<br/>   <br/>            print ('rmse for alpha = ',i,'eta=',k,'and  learning_rate=',j,'is',sqrt(mean_squared_error(y_test, predict_y)))</span></pre><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div class="gh gi pm"><img src="../Images/0287c54afdcc13284c01655889fc7838.png" data-original-src="https://miro.medium.com/v2/resize:fit:1376/format:webp/1*6dyES4GX0PmpyKi-kxldsA.png"/></div></figure><p id="5455" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">决策树_回归器:</strong></p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="4975" class="ll lm iq nn b gy nr ns l nt nu">max_depth = [3,5,10,50,100]<br/>cv_log_error_array=[]<br/>for i in tqdm(max_depth):<br/>    regressor = DecisionTreeRegressor(max_depth=i)<br/>    regressor.fit(train,y_train)<br/>    predict_y =  regressor.predict(test)<br/>cv_log_error_array.append(sqrt(mean_squared_error(y_test, predict_y)))<br/>for i in range(len(cv_log_error_array)):<br/>    print ('rmse for max_depth and min_sample_split = ',max_depth[i],'is',cv_log_error_array[i])</span></pre><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi pn"><img src="../Images/72555c0f90867dab27f130a414890b1a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*kGwWLfhHNtKMh1rrO3YVgQ.png"/></div></div></figure><p id="f133" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">随机森林回归量:</strong></p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="f9ff" class="ll lm iq nn b gy nr ns l nt nu">estimators = [16,32,64,128]<br/>cv_log_error_array=[]<br/>for i in tqdm(max_depth):<br/>    regressor=RandomForestRegressor(n_estimators=i,  n_jobs=-1,verbose=1)<br/>    regressor.fit(train,y_train)<br/>    predict_y =  regressor.predict(test)<br/>    cv_log_error_array.append(sqrt(mean_squared_error(y_test, predict_y)))</span></pre><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div class="gh gi po"><img src="../Images/855d5f96a0593f7527324017d51ed7e3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1274/format:webp/1*NP473d5HPJWX6nGX59LqRw.png"/></div></figure><p id="305f" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">xgb回归量:</strong></p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="f770" class="ll lm iq nn b gy nr ns l nt nu">estimators = [50,100,500,1500]<br/>cv_log_error_array=[]<br/>for i in tqdm(estimators):<br/>    regressor=XGBRegressor(n_estimators=i,nthread=-1)<br/>    regressor.fit(train,y_train)<br/>    predict_y =  regressor.predict(test)<br/>    cv_log_error_array.append(sqrt(mean_squared_error(y_test, predict_y))</span></pre><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/f77da0b01d7c75e1546851a20b09e05f.png" data-original-src="https://miro.medium.com/v2/resize:fit:622/format:webp/1*TQz10KRV36dlOVdjZ42dlg.png"/></div></figure><p id="bafa" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja"> lightgbm: </strong></p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="a88e" class="ll lm iq nn b gy nr ns l nt nu">import lightgbm as lgb<br/>alpha=[25,50,150,500,1000]<br/>cv_log_error_array=[]<br/>for i in tqdm(alpha):<br/>    lgbr=lgb.LGBMRegressor(boosting_type='gbdt', n_estimators=i, objective='regression', n_jobs=-1)<br/>    model=lgbr.fit(train,y_train)<br/>    predict_y =  model.predict(test)<br/>    cv_log_error_array.append(sqrt(mean_squared_error(y_test, predict_y)))<br/>for i in range(len(cv_log_error_array)):<br/>    print ('rmse for estimators = ',alpha[i],'is',cv_log_error_array[i])</span></pre><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div class="gh gi pq"><img src="../Images/2c0140989f006c7e0f0cbd18c5ad8d3e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1132/format:webp/1*AemIik0i-x8ktA7fTLoZOg.png"/></div></figure><h2 id="78fe" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated"><strong class="ak"> 9。深度学习模型:</strong></h2><p id="589a" class="pw-post-body-paragraph kn ko iq kp b kq me ks kt ku mf kw kx ky na la lb lc nb le lf lg nc li lj lk ij bi translated"><strong class="kp ja">简单_MLP: </strong></p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="5783" class="ll lm iq nn b gy nr ns l nt nu">input_dim = train.shape[1]<br/>alpha=[64,256,512]<br/>for i in tqdm(alpha):<br/>    model = Sequential()<br/>    model.add(Dense(i, activation='relu', input_shape=(input_dim,)))<br/>    model.add(Dense(i, activation='relu')) <br/>    model.add(Dense(i, activation='relu')) <br/>    model.add(Dense(1  ,activation='linear'))</span><span id="3041" class="ll lm iq nn b gy nv ns l nt nu">def root_mean_squared_error(y_true, y_pred):<br/>return K.sqrt(K.mean(K.square(y_pred - y_true)))<br/>    model.compile(optimizer = 'adam', loss = root_mean_squared_error)<br/>      <br/>   model.fit(train,y_train,epochs=8,batch_size=2048,validation_data=[test,y_test])</span></pre><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div class="gh gi pr"><img src="../Images/b4400aad5b9bcfcdb769d4759a51c2a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1114/format:webp/1*PTk-B7ObmFj5FAbucarqwQ.png"/></div></figure><p id="7316" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja"> CNN+LSTM深度神经网络:</strong></p><p id="d74c" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">由于我们的数据包含分类和数值特征，我决定将分类特征赋予Conv1d，将数值特征赋予Lstm。</p><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div class="gh gi ps"><img src="../Images/7337f0b13073601e13de22b69028f88d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1252/format:webp/1*l310_5Tffrkcj2CSoGTWMA.png"/></div></figure><p id="100c" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">模型架构:</strong></p><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div class="gh gi pt"><img src="../Images/c3b2baf8e1d1f0e2224f0cfc70ed3e40.png" data-original-src="https://miro.medium.com/v2/resize:fit:660/format:webp/1*zQOxOPcCEpsv3JSS7NFBWw.png"/></div></figure><p id="003e" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">虽然没有得到好的结果，但是尝试总是一种好的学习习惯</p><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div class="gh gi pu"><img src="../Images/76a896b913f600a8a5ea9b932b2334fb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*ZS_Cfs7_vQdf-v2jxjukOg.png"/></div></figure><h2 id="4c3e" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated">结论_根据以上模型:</h2><p id="6343" class="pw-post-body-paragraph kn ko iq kp b kq me ks kt ku mf kw kx ky na la lb lc nb le lf lg nc li lj lk ij bi translated">我们发现，LGBRegressor模型为测试数据集提供了1.146 rmse的最佳结果。我的大部分实验都不太成功，现在让我们建立一些先进的模型，希望能得到更好的结果…</p><h2 id="1520" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated"><strong class="ak"> 10。堆叠_回归量:</strong></h2><ul class=""><li id="e42a" class="mc md iq kp b kq me ku mf ky mg lc mh lg mi lk ng mk ml mm bi translated">将列车数据分为两部分(df1)和(df2)</li><li id="a75a" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">使用df1进行基础学习者训练，然后使用这些基础学习者预测df2读数(df2_pred)和测试读数(test_pred)</li><li id="3a46" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">然后用df2_pred和y_df2训练元回归器</li><li id="1260" class="mc md iq kp b kq mn ku mo ky mp lc mq lg mr lk ng mk ml mm bi translated">然后从(test_pred)预测最终的测试标签</li></ul><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi pv"><img src="../Images/3a3079782865bc21d4d12ebf3cc5bf34.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LeplIOsDs_wfsmlNE7vhpA.png"/></div></div></figure><p id="6551" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">创建60个基数_回归量:</strong></p><p id="7b51" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">我从上面选择了最好的模型作为基础和元回归变量</p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="01c5" class="ll lm iq nn b gy nr ns l nt nu">import lightgbm as lgb</span><span id="7d99" class="ll lm iq nn b gy nv ns l nt nu">df2_pred=[]<br/>test_pred=[]<br/>for i in tqdm(range(0,60)):<br/>    df=df1.sample(n=200000,replace = True)<br/>    y_train_sam=df['meter_reading']<br/>    train_sam=df.drop(['meter_reading'], axis=1)<br/>    regressor=lgb.LGBMRegressor(boosting_type='gbdt', n_estimators=200,ma x_depth=50,objective='regression',n_jobs=-1)      regressor.fit(train_sam,y_train_sam)<br/>    predict_df2 =  regressor.predict(x_df2)<br/>    predict_test =  regressor.predict(test_df)<br/>    k=sqrt(mean_squared_error(y_df2, predict_df2))<br/>    print(k)<br/>    df2_pred.append(predict_df2)<br/>    test_pred.append(predict_test)<br/>    del train_sam,regressor, k ,df,y_train_sam,predict_df2</span></pre><p id="4b28" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">这里我使用60 lightgbm作为基础学习者。</p><p id="6011" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">对于df1，我们使用替换进行采样，制作k个不同的样本(行采样)，然后将每个样本传递给k个不同的bae模型，然后创建一个堆叠模型。</p><p id="8dbf" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><strong class="kp ja">元回归量:</strong></p><pre class="ni nj nk nl gt nm nn no np aw nq bi"><span id="f7c6" class="ll lm iq nn b gy nr ns l nt nu">regressor_meta=lgb.LGBMRegressor(boosting_type='gbdt', n_estimators=350,max_depth=50,objective='regression',n_jobs=-1)<br/>regressor_meta.fit(df2_pre,y_df2)<br/>predict_y =  regressor_meta.predict(test_pre)</span></pre><p id="759b" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">预测y的kaggle分数:</p><figure class="ni nj nk nl gt ka gh gi paragraph-image"><div class="gh gi pw"><img src="../Images/d0e4f93d746560fca8bfa3f3aea69add.png" data-original-src="https://miro.medium.com/v2/resize:fit:1390/format:webp/1*p5LSUkMGpHRW-GndV5PFvQ.png"/></div></figure><h2 id="c034" class="ll lm iq bd km ln lo dn lp lq lr dp ls ky lt lu lv lc lw lx ly lg lz ma mb iw bi translated">11。参考文献</h2><p id="b360" class="pw-post-body-paragraph kn ko iq kp b kq me ks kt ku mf kw kx ky na la lb lc nb le lf lg nc li lj lk ij bi translated"><a class="ae kl" href="https://www.appliedaicourse.com/" rel="noopener ugc nofollow" target="_blank">https://www.appliedaicourse.com</a></p><p id="8f61" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><a class="ae kl" href="https://www.kaggle.com/yamsam/ashrae-leak-data-station" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/yamsam/ashrae-leak-data-station</a></p><p id="ceaf" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><a class="ae kl" href="https://www.kaggle.com/cereniyim/save-the-energy-for-the-future-1-detailed-eda" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/cereniyim/save-the-energy-for-the-future-1-detailed-EDA</a></p><p id="bcf1" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><a class="ae kl" href="https://towardsdatascience.com/estimating-counterfactual-energy-usage-of-buildings-with-machine-learning-8ca91ec66c08" rel="noopener" target="_blank">https://towards data science . com/estimating-counter factual-energy-usage-of-buildings-with-machine-learning-8ca 91 EC 66 c 08</a></p><p id="8aba" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated"><a class="ae kl" href="https://www.kaggle.com/datadugong/locate-better-cities-by-weather-temp-fill-nans" rel="noopener ugc nofollow" target="_blank">https://www . ka ggle . com/data dugong/locate-better-cities-by-weather-temp-fill-nans</a></p><p id="bf89" class="pw-post-body-paragraph kn ko iq kp b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj lk ij bi translated">罗曼，卡格尔笔记本，“埃达为ASHRAE。”从<a class="ae kl" href="https://www.kaggle.com/nroman/eda-for-ashrae#meter" rel="noopener ugc nofollow" target="_blank">https://www.kaggle.com/nroman/eda-for-ashrae#meter</a>检索到2020年1月</p></div></div>    
</body>
</html>