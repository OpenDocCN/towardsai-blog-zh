<html>
<head>
<title>How Branchless Programming Can Speed Up Excel</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">无分支编程如何提高Excel的速度</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/an-example-of-branchless-logic-using-excel-c6afc6eef75e?source=collection_archive---------5-----------------------#2020-08-24">https://pub.towardsai.net/an-example-of-branchless-logic-using-excel-c6afc6eef75e?source=collection_archive---------5-----------------------#2020-08-24</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/f062800fc3f1fd90098c02c23901ebb7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hXdraIr1PYp_3O15opwraQ.jpeg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">来源:<a class="ae jg" href="https://unsplash.com" rel="noopener ugc nofollow" target="_blank"> Unsplash </a></figcaption></figure><h2 id="0ff8" class="jh ji jj bd b dl jk jl jm jn jo jp dk jq translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-science" rel="noopener ugc nofollow" target="_blank">数据科学</a></h2><div class=""/><div class=""><h2 id="2fbd" class="pw-subtitle-paragraph kp js jj bd b kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg dk translated">使用Excel进行分类的无分支逻辑示例</h2></div><p id="0489" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">本文以IRIS flowers数据集和<a class="ae jg" href="https://medium.com/towards-artificial-intelligence/geometric-mean-classifier-for-iris-dataset-ed83209f54f3" rel="noopener">几何平均分类器</a>为例，介绍了excel中无分支逻辑的应用。(参见下面的视频，了解更多相关信息)</p><figure class="md me mf mg gt iv"><div class="bz fp l di"><div class="mh mi l"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">无分支编程—<a class="ae jg" href="https://www.youtube.com/watch?v=bVJ-mWWL7cE" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=bVJ-mWWL7cE</a></figcaption></figure><h2 id="a9f7" class="mj mk jj bd ml mm mn dn mo mp mq dp mr lq ms mt mu lu mv mw mx ly my mz na jp bi translated">用例概述</h2><p id="5228" class="pw-post-body-paragraph lh li jj lj b lk nb kt lm ln nc kw lp lq nd ls lt lu ne lw lx ly nf ma mb mc im bi translated">这个例子将带你浏览一个例子，将一个嵌套的<strong class="lj jt"> if语句用例转换成一个没有任何if语句</strong>的更快的计算。这提高了大型excel工作簿的性能，也大大缩短了代码。</p><p id="8bf7" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">假设您正试图根据下面显示的高低范围对来自<a class="ae jg" href="https://en.wikipedia.org/wiki/Iris_flower_data_set" rel="noopener ugc nofollow" target="_blank">虹膜数据集</a>的三种花进行分类。对这个逻辑进行编程的最简单的方法是使用一个标准的IF语句来测试一个测试数据实例的几何平均值是否落在下限和上限之间。然而，随着测试数据集变得越来越大，嵌套的if语句会破坏工作簿的速度。</p><figure class="md me mf mg gt iv gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/1c53c82ddaf4ce93dde62ab6f3b54e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*NwOF1m59umO3QJP23RnxlA.png"/></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">分类器的虹膜数据高-低范围</figcaption></figure><h2 id="a824" class="mj mk jj bd ml mm mn dn mo mp mq dp mr lq ms mt mu lu mv mw mx ly my mz na jp bi translated">如何用If语句写出分类问题</h2><p id="6b49" class="pw-post-body-paragraph lh li jj lj b lk nb kt lm ln nc kw lp lq nd ls lt lu ne lw lx ly nf ma mb mc im bi translated">首先，让我们看看如何用一个If语句结合一个AND语句来写这个。这是excel中if语句的格式:</p><pre class="md me mf mg gt nh ni nj nk aw nl bi"><span id="774c" class="mj mk jj ni b gy nm nn l no np">=if(condition, output if the condition is true, output if the condition is false)</span></pre><p id="25d4" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">“And”语句看起来是这样的:</p><pre class="md me mf mg gt nh ni nj nk aw nl bi"><span id="51a1" class="mj mk jj ni b gy nm nn l no np">=AND(condition 1, condition 2,…condition n). An AND statement returns TRUE in a cell if the condition is met.</span></pre><p id="9740" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">例如:</p><pre class="md me mf mg gt nh ni nj nk aw nl bi"><span id="7b8f" class="mj mk jj ni b gy nm nn l no np">=AND(1=1,2=2) will return TRUE//</span><span id="4cc6" class="mj mk jj ni b gy nq nn l no np">=AND(1=1,2=1) will return FALSE because 2 is NOT equal to 1.</span></pre><p id="89f7" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">为了编写IF(AND)语句，可以使用以下语法:</p><pre class="md me mf mg gt nh ni nj nk aw nl bi"><span id="12f5" class="mj mk jj ni b gy nm nn l no np">=If(AND(condition 1, condition 2… , condition n), output if ALL conditions return TRUE, output if all conditions return FALSE)</span></pre><p id="d0b3" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在，让我们看看，在给定一个测试数据集实例的情况下，我们将如何从上面的语句中为Versicolor编写这个。</p><p id="8dae" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">想象一下，你的测试数据有一个2.75的几何平均值，这意味着你将把这个实例归类到Versicolor中，那么这是如何编码的呢？</p><p id="4482" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">嗯，这里有两个你必须满足的条件:</p><blockquote class="nr ns nt"><p id="8a71" class="lh li nu lj b lk ll kt lm ln lo kw lp nv lr ls lt nw lv lw lx nx lz ma mb mc im bi translated">几何平均值是否大于上面查找表中的杂色范围的下限？</p><p id="c427" class="lh li nu lj b lk ll kt lm ln lo kw lp nv lr ls lt nw lv lw lx nx lz ma mb mc im bi translated">几何平均值是否小于上面查找表中的杂色范围的高端？</p></blockquote><p id="3ff9" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果符合范围，此代码将返回TRUE，如果不符合范围，则返回FALSE:</p><pre class="md me mf mg gt nh ni nj nk aw nl bi"><span id="8c58" class="mj mk jj ni b gy nm nn l no np">=AND(geomean&gt;=low of versicolor, geomean&lt;=high of versicolor)</span></pre><p id="b011" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在我们要做的就是用if语句包装它:</p><pre class="md me mf mg gt nh ni nj nk aw nl bi"><span id="fa9d" class="mj mk jj ni b gy nm nn l no np">=If(AND(geomean&gt;=low of versicolor, geomean&lt;=high of versicolor),”versicolor”, “not versicolor”)</span></pre><p id="e74d" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然而，这仍然不能给你所有的三朵花。为了实现这一点，您必须嵌套一个IF语句:</p><pre class="md me mf mg gt nh ni nj nk aw nl bi"><span id="36b1" class="mj mk jj ni b gy nm nn l no np">=If(AND(geomean&gt;=low of versicolor, geomean&lt;=high of versicolor),”versicolor”, If(AND(geomean&gt;=low of setosa, geomean&lt;=high of setosa),”setosa”, If(AND(geomean&gt;=low of virginica, geomean&lt;=high of virginica),”virginica”……)</span></pre><blockquote class="ny"><p id="bf8d" class="nz oa jj bd ob oc od oe of og oh mc dk translated">这是一个很长的if语句，它必须一遍又一遍地计算嵌套的IF才能得到正确的花类。</p></blockquote><p id="5628" class="pw-post-body-paragraph lh li jj lj b lk oi kt lm ln oj kw lp lq ok ls lt lu ol lw lx ly om ma mb mc im bi translated">我们如何避免这种情况？有没有一种方法可以大大缩短这段代码，并把它变成一些简单的算法？有，这是我们可以引入无分支编程的地方。</p><h2 id="6e60" class="mj mk jj bd ml mm mn dn mo mp mq dp mr lq ms mt mu lu mv mw mx ly my mz na jp bi translated">Excel中的无分支编程</h2><p id="d214" class="pw-post-body-paragraph lh li jj lj b lk nb kt lm ln nc kw lp lq nd ls lt lu ne lw lx ly nf ma mb mc im bi translated">让我们先看看我们之前为Versicolor编写的AND语句。</p><pre class="md me mf mg gt nh ni nj nk aw nl bi"><span id="3af3" class="mj mk jj ni b gy nm nn l no np">AND(geomean&gt;=low of Versicolor, geomean&lt;=high of Versicolor)</span></pre><p id="91f9" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">注意，在布尔语句中，真等于1，假等于0。</p><p id="906d" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在，让我们试着理解如何用这个来代替IF逻辑。本质上，当条件评估为真或1时，我们希望重复花名(文本)1次，当它为假或0时，我们希望重复0次，即显示空白。</p><p id="ed7a" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">让我们把它写出来:</p><figure class="md me mf mg gt iv gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/1c53c82ddaf4ce93dde62ab6f3b54e69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1248/format:webp/1*NwOF1m59umO3QJP23RnxlA.png"/></div></figure><p id="263f" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">细胞:物种名称在I4、I5和I6中。低的是L列，高的是m列。下面是公式如何从测试数据集中查找您想要分类的花:</p><pre class="md me mf mg gt nh ni nj nk aw nl bi"><span id="4d75" class="mj mk jj ni b gy nm nn l no np">=REPT(I4,AND(geomeangiven&gt;=L4, geomeangiven &lt;=M4)) → versicolor</span><span id="72ad" class="mj mk jj ni b gy nq nn l no np">=REPT(I5,AND(geomeangiven &gt;=L5, geomeangiven &lt;=M5)) → setosa</span><span id="7a05" class="mj mk jj ni b gy nq nn l no np">=REPT(I6,AND(geomeangiven &gt;=L6, geomeangiven &lt;=M6)) → virginica</span></pre><p id="ae47" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">将这两者结合起来，可以替代上面的嵌套if语句:</p><pre class="md me mf mg gt nh ni nj nk aw nl bi"><span id="f6d6" class="mj mk jj ni b gy nm nn l no np">= REPT(I4,AND(geomeangiven&gt;=L4, geomeangiven &lt;=M4))&amp;REPT(I5,AND(geomeangiven &gt;=L5, geomeangiven &lt;=M5))&amp;REPT(I6,AND(geomeangiven &gt;=L6, geomeangiven &lt;=M6))</span></pre><p id="a53f" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">本质上，不是<em class="nu"> </em> <strong class="lj jt"> <em class="nu">慢慢地…计算</em> </strong> <strong class="lj jt"> <em class="nu"> 3个if语句在对方</em> </strong>内，你只是串联了三个不同的简单算术公式，其中两个将计算为空白，一个将是花的名字。</p><p id="b955" class="pw-post-body-paragraph lh li jj lj b lk ll kt lm ln lo kw lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">参考资料:</p><ol class=""><li id="05db" class="on oo jj lj b lk ll ln lo lq op lu oq ly or mc os ot ou ov bi translated">无分支编程:为什么“如果”很慢...以及我们能做些什么！—<a class="ae jg" href="https://www.youtube.com/watch?v=bVJ-mWWL7cE" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/watch?v=bVJ-mWWL7cE</a></li></ol></div></div>    
</body>
</html>