<html>
<head>
<title>How to Extract and Visualize YouTube Data in Tableau Using Google Sheets and Apps Script</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">如何使用Google Sheets和Apps脚本在Tableau中提取和可视化YouTube数据</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-to-extract-and-visualize-youtube-data-in-tableau-using-google-sheets-and-apps-script-e77dac3cfc8b?source=collection_archive---------2-----------------------#2021-12-01">https://pub.towardsai.net/how-to-extract-and-visualize-youtube-data-in-tableau-using-google-sheets-and-apps-script-e77dac3cfc8b?source=collection_archive---------2-----------------------#2021-12-01</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="fa3b" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-visualization" rel="noopener ugc nofollow" target="_blank">数据可视化</a></h2><div class=""/><figure class="gl gn jx jy jz ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi jw"><img src="../Images/61edf4464eee778562b56e95d0d5f46d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hbL_qbS5F5VOMcswVKBppA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">作者图片，灵感来自<a class="ae kl" href="https://www.figma.com/@pranay_design" rel="noopener ugc nofollow" target="_blank">普拉内·阿加瓦尔@普拉内_设计</a></figcaption></figure><p id="f0ae" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">数字数据收集很有趣，那么收集你看的和喜欢的东西呢？</p><p id="cc96" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">想象一下这样一个场景，您想要跟踪您最喜欢的YouTube频道的详细信息。这些细节可以包括订户数量、观看次数和最近的视频日期。更进一步，您可能希望将这些细节保存在方便的地方，大概是保存在一个简单的文本文件中，并且希望每隔一段时间更新一次。<br/>那么，你如何以一种简单的方式做到这一点呢？</p><p id="348b" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在本文中，您将学习如何使用Google Apps脚本将YouTube频道中的数据提取到Google Sheets中，然后使用Tableau显示这些数据。</p><h1 id="3bca" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">背景</h1><h2 id="2d87" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated">Google应用程序脚本</h2><p id="c29f" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated"><a class="ae kl" href="https://developers.google.com/apps-script/overview" rel="noopener ugc nofollow" target="_blank"> Google App Scripts </a>是一个低代码的云服务平台，允许用户毫不费力地扩展Google产品的功能，还允许跨这些平台的交互，而不需要软件开发过程中的大量知识。App Script使用JavaScript、HTML、CSS等流行的编程语言来构建服务。</p><p id="670f" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">app script还有其他扩展功能，但我们的重点将是使用app script以编程方式与Google Sheets进行交互，作为从YouTube自动输入数据的一种方式。</p><h2 id="32ff" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated">（舞台上由人扮的）静态画面</h2><p id="1d9f" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">大多数数据分析师可能听说过Tableau，这是一个可视化交互平台，有一个优秀的、令人兴奋的社区。在本文中，我们将使用Tableau Public，这是一个允许您在线发布数据可视化的免费平台。Tableau将通过连接到其平台上的Google Sheets连接器来可视化我们的最终数据。</p><p id="982b" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">让我们开始吧，但首先是你需要知道的。</p><h1 id="cbe0" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">先决条件</h1><ul class=""><li id="f5f4" class="my mz iq ko b kp mt kt mu kx na lb nb lf nc lj nd ne nf ng bi translated">一个谷歌<a class="ae kl" href="https://accounts.google.com/SignUp?hl=en" rel="noopener ugc nofollow" target="_blank">账户</a>，用于访问谷歌表单和应用程序脚本。</li><li id="e048" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">一个Tableau public a<a class="ae kl" href="https://public.tableau.com/s/" rel="noopener ugc nofollow" target="_blank">account</a>和<a class="ae kl" href="https://public.tableau.com/en-gb/s/download" rel="noopener ugc nofollow" target="_blank"> Software </a>，如果你还没有的话。</li><li id="d10a" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">初学者的JavaScript知识没问题。</li><li id="f953" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">谷歌云平台账号。</li></ul><p id="8edc" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在你已经知道需要什么，让我们开始行动的步骤。</p><h1 id="5d2a" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">编辑一个YouTube频道id列表</h1><p id="73bf" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">在开始构建之前，您需要有一个Youtube频道id列表。这个ID对于一个通道是唯一的，将用于从API中提取通道的详细信息。</p><p id="9bb1" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">为此，您必须在新的Google表单中手动填充您喜爱的频道列表。该信息不必包含信道的实际名称。填充这些名称的本质是获得目标YouTube频道的高级视图；然后，对于每个名称，搜索它们各自的url_id。</p><p id="b2a7" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">创建一个名为<em class="nm">“最受欢迎的Youtube喜剧演员”</em>的新谷歌表单</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nn"><img src="../Images/9faa494ef661556a6a0f0d9888e387dc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-GCcuG9hbKrXW-cIY9U4-g.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">YouTube频道名称列表(图片由作者提供)</figcaption></figure><h2 id="a6e9" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated">获取频道ID</h2><p id="8aea" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">这一部分处理获取与帐户相关联的惟一ID。每个频道在其URL中都有一个唯一的ID。</p><p id="2006" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在YouTube 的<a class="ae kl" href="http://youtube.com" rel="noopener ugc nofollow" target="_blank">上，搜索填充的频道名称，在返回的视频列表中点击频道名称，并从URL(</a><a class="ae kl" href="https://www.youtube.com/channel/UCfvmvOEGw6Nqd6E9qMryE3A" rel="noopener ugc nofollow" target="_blank">https://www.youtube.com/channel/UCfvmvOEGw6Nqd6E9qMryE3A</a>)复制ID。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ns"><img src="../Images/d07935a286e37f5d7355da7f1a53b507.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*4SQicQuW3t_c6ZTj"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated"><em class="nt">搜索频道名称并从YouTube URL复制ID</em>(图片由作者提供)</figcaption></figure><p id="ab5b" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">之后，创建一个新的列—<strong class="ko ja">Channel ID</strong>——并将ID粘贴到与通道所在行相关的单元格中的列下。确保对每个通道都这样做。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nn"><img src="../Images/ff1192855b60ec46059bd0e771c482db.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*su1plbc-KhvYZ_SQgVckSQ.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">频道名称及其ID(图片由作者提供)</figcaption></figure><p id="dcfb" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">相反，你会注意到一些URL不同于传统的基于ID的URL。这些频道的URL使用youtube传统用户名，并且不在URL中暴露它们的id；因此，提取通道的ID需要不同的技术。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nn"><img src="../Images/9ba5e41a6b3c637ac55f01e0dcaf0523.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IYTsj2aXtrukUWu21RqI4Q.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">使用旧用户名URL的频道(图片由作者提供)</figcaption></figure><p id="9b0d" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">为了解决这个问题，您将利用Youtube数据API</p><ul class=""><li id="dfb5" class="my mz iq ko b kp kq kt ku kx nu lb nv lf nw lj nd ne nf ng bi translated">从URL中复制频道的用户名。比如在URL-<a class="ae kl" href="https://www.youtube.com/user/MarkAngelComedy" rel="noopener ugc nofollow" target="_blank"><em class="nm">https://www.youtube.com/user/MarkAngelComedy</em></a>中，用户名为<strong class="ko ja"><em class="nm">markangelcomyce</em></strong>。</li><li id="735d" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">在浏览器中导航至<a class="ae kl" href="https://developers.google.com/youtube/v3/docs/channels/list" rel="noopener ugc nofollow" target="_blank"> Youtube API </a>，从YouTube API explorer中检索频道ID。确保您已经使用Google帐户登录。</li><li id="1242" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">点击API网页上的<code class="fe nx ny nz oa b">list (by YouTube <em class="nm">username</em>)</code>。</li><li id="0f94" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">将<strong class="ko ja"><em class="nm">Google developers</em></strong>替换为右侧面板标题为<strong class="ko ja"> Try this API </strong>的<code class="fe nx ny nz oa b">forUsername</code>文本框中的渠道用户名。</li></ul><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ob"><img src="../Images/546c61cd8e9d02c64a870ddc9a5f7e2a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*6KT8iVuqerkQz_ivl-rbXw.gif"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">从Youtube API提取频道ID(图片由作者提供)</figcaption></figure><p id="74da" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">之后，点击面板底部的<strong class="ko ja">执行</strong>按钮。此操作将要求您验证您的Google帐户，并授予访问YouTube API的权限。一旦授权访问，就会显示API的响应，如上图，从中可以得到JSON值<code class="fe nx ny nz oa b">id</code> &gt; <code class="fe nx ny nz oa b">items</code>下的通道ID。</p><p id="ac3e" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">对于这种场景下的后续频道，您只需替换<code class="fe nx ny nz oa b">forUsername</code>文本框中的用户名，然后运行<strong class="ko ja">执行</strong>命令，之后您就可以复制ID并将其粘贴到您的google sheet中。</p><p id="aacb" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">当然，在这个过程完成时，您现在在一个列中有了完整的通道id列表。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nn"><img src="../Images/f693cc7e32756ba0f1509c3e9cb6086a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AgCI-qTSYEibL2aih2ndHw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">完整的频道id(图片由作者提供)</figcaption></figure><h1 id="294a" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">Google AppScript设置</h1><h2 id="4f8d" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated">步骤1:访问谷歌应用程序脚本</h2><p id="589e" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">现在您已经在电子表格中拥有了所有的渠道id，您将不得不访问绑定到google sheet的apps脚本。这个编辑器将促进Youtube和工作表之间的数据交互。</p><ul class=""><li id="5371" class="my mz iq ko b kp kq kt ku kx nu lb nv lf nw lj nd ne nf ng bi translated">点击表单菜单栏中的<strong class="ko ja">扩展&gt;应用程序脚本</strong>编辑器。该操作将创建一个新的脚本项目，并在app脚本编辑器界面上实例化一个文件<strong class="ko ja"> code.gs </strong>。该界面看起来像常规的代码编辑器，但这一次，它运行在云平台上，并从google sheet实例化。也可以在函数中编写代码，并将其存储在单独的文件名中。</li><li id="4f5a" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">重命名您的项目名称。在脚本编辑器的左上方，将其从“<strong class="ko ja">无标题项目</strong>”更改为“<strong class="ko ja">最喜爱的Youtube频道</strong></li></ul><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nn"><img src="../Images/97a6e1d769322f2e1375a8f4bc857ca6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HPvBFAwtjK_T7GBr87zK8A.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">应用程序脚本项目重命名(图片由作者提供)</figcaption></figure><h2 id="40a5" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated">步骤2:设置Youtube服务</h2><p id="64a9" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">Apps script提供了内置的google服务，因此由于您需要YouTube频道的详细信息，您将需要YouTube数据API服务来将数据拉入工作表中。<br/>在Apps脚本中启用此YouTube服务；</p><ul class=""><li id="d795" class="my mz iq ko b kp kq kt ku kx nu lb nv lf nw lj nd ne nf ng bi translated">点击左侧面板中的<strong class="ko ja">服务&lt; &gt; </strong>。</li><li id="1391" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">选择<strong class="ko ja"> YouTube数据API v3 </strong>并点击<strong class="ko ja">添加</strong>。</li></ul><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nn"><img src="../Images/aac04fe852fffaba4441f730e2a167b8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JUpkIuSf3kwhPswAQLL3gA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">显示YouTube服务可用性的自动建议(图片由作者提供)</figcaption></figure><p id="8aa2" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">完成后，您就可以访问Youtube数据服务了，如上图所示。在下一节中，您将经历使用这个接口将数据从Youtube API提取到表单中的过程。</p></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><h1 id="9b34" class="lk ll iq bd lm ln oj lp lq lr ok lt lu lv ol lx ly lz om mb mc md on mf mg mh bi translated">数据析取</h1><p id="e7d8" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">完成上一节中的设置后，您就可以用javascript编写代码来从YouTube频道中检索详细信息了。<br/>在本文中，您将提取以下渠道详情:</p><ul class=""><li id="f5b6" class="my mz iq ko b kp kq kt ku kx nu lb nv lf nw lj nd ne nf ng bi translated">标题</li><li id="e275" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">出版日期</li><li id="3dc7" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">订户数量</li><li id="51eb" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">视图计数:累积的视图总数</li><li id="6217" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">视频计数:上传的视频总数。</li><li id="0a25" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">视频上传播放列表Id</li><li id="f5f1" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">上次上传日期</li><li id="68ef" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">收视率最高的视频标题</li><li id="c857" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">观看次数最多的视频</li></ul><p id="8878" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">为了实现这些目标，你必须采取以下行动。但是首先，创建9个标题，指定您将提取到工作表中的详细信息的列。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nn"><img src="../Images/49dcef6451c7cecb6df196bd4e7187e0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*56IOF-KUAIUhDnMCx9UODQ.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">频道详细信息的标题(作者图片)</figcaption></figure><p id="ef4e" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">以下是如何提取这些细节的概述；</p><ol class=""><li id="e261" class="my mz iq ko b kp kq kt ku kx nu lb nv lf nw lj oo ne nf ng bi translated">从工作表中读取频道id。</li><li id="14a8" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj oo ne nf ng bi translated">使用IDs从Youtube API提取数据。</li><li id="1936" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj oo ne nf ng bi translated">将数据写入工作表。</li></ol><p id="f0e0" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">随后将详细解释这些功能及其执行。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi op"><img src="../Images/ef42008bcec6fd4b3c0c63604f61b160.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*pO1AeGkCGcBQtkxXv8G_MQ.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">数据提取过程(图片由作者提供)</figcaption></figure><h2 id="cfca" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated"><em class="nt">从表单中读取频道id</em></h2><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi oq"><img src="../Images/733cc97e7f725ab826b6eafcc239bccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DCvNDLYvdHy0QgbgYy-kuA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">(图片来自作者)</figcaption></figure><p id="30a8" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在这一节中，您需要构建一个函数<code class="fe nx ny nz oa b">getChannelID()</code>。该函数将工作表中的id检索到Apps脚本中。请注意，id将用于检索频道的详细信息。</p><p id="6579" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在编辑器中，用下面的代码替换<code class="fe nx ny nz oa b">function myFunction(){}</code>:</p><figure class="no np nq nr gt ka"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="f69e" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">稍后，我们将解释每个代码的功能。暂时，<br/>保存脚本，点击菜单栏上的<strong class="ko ja">运行</strong>按钮。这将把您重定向到一个页面，以验证您的google帐户，并授予对您的Google帐户的脚本信息访问权限。一旦您接受了该流程，您的操作结果将显示在下面。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nn"><img src="../Images/4202ff25006bc2ac0a059f80dfc680ce.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*h9gWN7VvLcj6vfsKXVSuFg.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">应用程序脚本中的谷歌认证页面(图片由作者提供)</figcaption></figure><p id="632b" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在响应提示中，您不必担心安全性，因为脚本是由您创建的。但是在访问您不了解的脚本时要小心。<br/>要继续，点击<strong class="ko ja"> <em class="nm">转到喜爱的Youtube频道(不安全)</em> </strong></p><p id="605e" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">一旦您的帐户验证完成，您现在可以在编辑器中重新运行该功能。</p><p id="2abf" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">回到解释代码片段。<br/>在这个代码片段中，我们实例化了来自S <a class="ae kl" href="https://developers.google.com/apps-script/reference/spreadsheet/" rel="noopener ugc nofollow" target="_blank"> preadsheet服务</a>的类<code class="fe nx ny nz oa b">SpreadsheetApp.getActiveSpreadsheet()</code>——一个内置的Google库，允许访问和操作我们当前的电子表格。在我们的例子中，工作表是<em class="nm"> Sheet1 </em>，电子表格是<em class="nm">最喜欢的YouTube喜剧演员。</em> —不要混淆<a class="ae kl" href="https://www.computerhope.com/jargon/s/spreadsheet.htm" rel="noopener ugc nofollow" target="_blank">电子表格和</a>工作表之间的区别。</p><p id="aba0" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">之后，我们使用方法<code class="fe nx ny nz oa b">getSheetValues()</code>访问工作表中通道id所在的范围，该方法接受4个参数<code class="fe nx ny nz oa b">(startRow,startCol,numRow,numCol)</code>，描述要检索的值的范围。<br/>该函数的结果是一个二维数组中的所有频道id。<br/>你可以用<code class="fe nx ny nz oa b">console.log(col_channel_ids)</code>代替<code class="fe nx ny nz oa b">return col_channel_ids</code>函数来打印出二维数组中的数据结果。</p><p id="549f" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">要运行代码，请在菜单栏中选择函数名，然后单击run按钮。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ot"><img src="../Images/145ec79536dd69d69c980c5245c927a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*FALK6OV0J3V14vji3y8a0A.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">应用程序脚本中的频道id(图片由作者提供)</figcaption></figure><h2 id="fc82" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated"><em class="nt">从通道ID </em>获取数据</h2><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ou"><img src="../Images/57dc229cfa12a865ce61fbaea08a1c05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*F-Cnf15d-PUMhmEFwrMH9g.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">数据提取过程(图片由作者提供)</figcaption></figure><p id="8a8f" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在，我们已经可以访问应用程序脚本上的频道ID，下一个动作是查询YouTube库，以获得第一组细节——<code class="fe nx ny nz oa b"><em class="nm">Title</em></code>、<code class="fe nx ny nz oa b"><em class="nm">Published date</em></code>、<code class="fe nx ny nz oa b"><em class="nm">View Count: Total number of views accumulated</em></code>、<code class="fe nx ny nz oa b"><em class="nm">Video Count: Total number of videos uploaded</em></code>和<code class="fe nx ny nz oa b"><em class="nm">Video Uploaded Playlist Id</em></code>——这些细节将从Youtube服务<br/>中的<code class="fe nx ny nz oa b">channels.list()</code>方法获得。首先，创建一个名为<code class="fe nx ny nz oa b">getDataFromChannelID()</code>的函数，并包含下面的代码片段；</p><figure class="no np nq nr gt ka"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="99c8" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">从代码片段来看，这个函数接受两个输入参数，<code class="fe nx ny nz oa b">part</code>和<code class="fe nx ny nz oa b">channelID</code>，并返回关于通道的具体细节。它使用<code class="fe nx ny nz oa b">Youtube.Channels.list()</code>方法获取通道的数据。<br/> <br/>在第18-25行；因为来自API的响应是以JSON的形式出现的，所以我们对输入中指定的部分参数进行索引，以获得我们感兴趣的响应。part参数表示需要从API返回的信息的类别。在这个场景中，我们需要API中嵌套在<code class="fe nx ny nz oa b">snippets</code>、<code class="fe nx ny nz oa b">statistics</code>和<code class="fe nx ny nz oa b">contentDetails</code>下的信息。输出是所有初步数据细节的数组。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nn"><img src="../Images/deb610bd07f53344dc6f989a2c4e5220.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Gpns-ZTAM2OoFhYnP6ioog.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">getDataFromChannelID的示例响应(图片由作者提供)</figcaption></figure><h2 id="c862" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated">检索视频详细信息</h2><p id="8988" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">需要从频道获取的下一组信息与视频细节有关:<code class="fe nx ny nz oa b">Last Upload Date</code>、<code class="fe nx ny nz oa b">Highest-Viewed Video Title</code>和<code class="fe nx ny nz oa b">Number of views for the highest-viewed video.</code>、<br/>要获取这些信息，您需要使用视频id访问频道中的所有视频，通过视频id可以检索视频细节。<br/> <br/>在app脚本和代码部分，这将涉及以下步骤:</p><ol class=""><li id="2b23" class="my mz iq ko b kp kq kt ku kx nu lb nv lf nw lj oo ne nf ng bi translated">获取频道中与视频上传相关的播放列表ID。</li><li id="502d" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj oo ne nf ng bi translated">使用播放列表ID检索所有上传的视频ID和上次上传日期。</li><li id="d20a" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj oo ne nf ng bi translated">使用视频id检索观看率最高的视频细节。</li></ol><p id="f3ee" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">检索所有上传的视频ID和最后上传日期</strong> <br/>上传的播放列表ID已经在前面的部分中检索过了，因此您将使用该值来获取每个频道中所有上传的视频的ID和最后上传日期。该函数在下面的代码片段中实现。</p><figure class="no np nq nr gt ka"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="4dbb" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">从上面可以看出，该函数将上传的播放列表id作为输入参数。关于代码的更多内容解释如下:<br/> <br/>在函数体中，该函数查询方法<code class="fe nx ny nz oa b">Youtube.PlayListItems.list()</code>，并使用while语句遍历频道上传的播放列表中的视频列表，仅在该方法中没有更多页面可查询时停止，这由变量<code class="fe nx ny nz oa b">nextPageToken</code>跟踪。<br/> <br/>在迭代中，首先记录位于第一页查询结果顶部的<code class="fe nx ny nz oa b">Last Upload Date</code>。</p><p id="3aa4" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">之后，在第27行，由于方法<code class="fe nx ny nz oa b">Youtube.PlayListItems.list()</code>逐页返回视频内容列表，我们使用map函数从每个页面提取内容，然后索引到第28行的响应中，以获得<code class="fe nx ny nz oa b">video IDs</code>，这些内容随后被追加到一个数组中。</p><p id="960b" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">最终结果是一个包含所有<code class="fe nx ny nz oa b">video IDs</code>和<code class="fe nx ny nz oa b">Last Upload Date</code>的数组。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi nn"><img src="../Images/06ec7e12a8b1d9cc88bc97bfbe0fa76e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*npqPGoXgTRkhKvv1Xbf92g.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">视频id数组和最后上传日期(图片由作者提供)</figcaption></figure><p id="e184" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><strong class="ko ja">使用视频id</strong><br/>检索观看率最高的视频细节在获得上一节中的视频id后，您将在本节中计算剩余的视频细节— <code class="fe nx ny nz oa b">Highest-Viewed Video Title</code>和<code class="fe nx ny nz oa b">Number of views for the highest-viewed video</code>。</p><p id="de53" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">创建功能<code class="fe nx ny nz oa b">getHighestViewedFromID().</code></p><figure class="no np nq nr gt ka"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="91b8" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这个函数接受一个视频id列表，一次遍历50个id，并检索它们的视频细节。每次调用50次检索的本质是减少对API的查询次数。</p><p id="8164" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这是要点。我们正在尝试使用服务API方法<code class="fe nx ny nz oa b">YouTube.Videos.list()</code>检索每个视频的观看次数。每次查询到API成本<a class="ae kl" href="https://developers.google.com/youtube/v3/docs/videos/list" rel="noopener ugc nofollow" target="_blank"> 1单位</a>。然而，针对单个视频细节点击一次API的成本与针对多个视频细节的成本相同。因此，我们批量检索视频细节，以获得最佳的单位费用。<br/>即使有这种多重检索功能，每次调用最多允许检索50个视频。这就需要拆分视频id列表，并为单个查询实例以50个为一批来检索它们的详细信息。</p><p id="ffaa" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">不过，在迭代中，第23行，您可以看到我们通过索引响应的<code class="fe nx ny nz oa b">snippet</code>部分中的<code class="fe nx ny nz oa b">title</code>和响应的<code class="fe nx ny nz oa b">statistics</code>部分中的<code class="fe nx ny nz oa b">viewCount</code>获得了感兴趣的信息；表示视频名称和视频被观看的次数。<br/>有了这个now，才能获得最受关注的视频细节；该数组按照视图数量降序排序，如第28行所示，第一个元素被弹出。这个场景中的第一个元素是一个数组，其中包含了观看次数最多的视频及其观看次数。</p><p id="c2fc" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">完成此操作后，您现在已经检索到了所有需要的数据。下一个调用点将需要将这些数据写入表中。</p><h2 id="3ab1" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated">将数据写入工作表</h2><p id="c409" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">这是将我们的数据存储到Google sheet中的最后一个帮助函数。将数据推送到工作表需要利用电子表格库方法<code class="fe nx ny nz oa b">getActiveSpreadsheet()</code>。如代码片段所示，</p><figure class="no np nq nr gt ka"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="9b60" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">该函数接收最终结果:一个二维值数组。它利用接受4个参数的<code class="fe nx ny nz oa b">getRange()</code>函数将数据存储在工作表中，其中第3个参数表示行数，即通道数，第4个参数指定二维数组中某项的长度——列数/通道细节。</p><h2 id="d927" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated">把所有东西放在一起</h2><p id="80e0" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">现在我们所有的管道和助手函数都准备好了，我们可以把所有的东西放在一起了。前面几节涉及到处理单个通道的助手函数。您将把事情整合到处理多个频道中，就像在我们的多个喜剧频道的用例中一样。</p><figure class="no np nq nr gt ka"><div class="bz fp l di"><div class="or os l"/></div></figure><p id="e502" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们将使用一个名为<code class="fe nx ny nz oa b">executeAll()</code>的函数。首先，使用在前面的<a class="ae kl" href="#cfca" rel="noopener ugc nofollow">部分</a>中创建的方法<code class="fe nx ny nz oa b">getChannelIDs()</code>，以二维数组的形式从电子表格中检索所有频道id。我们使用map函数遍历id列表。使用map函数，我们可以只调用一次数组中的每一项，并处理它以返回二维数组中的新值。</p><p id="4efc" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">递归函数中的第一个动作从通道ID返回初步数据，这些数据是(<code class="fe nx ny nz oa b">Title</code>、<code class="fe nx ny nz oa b">Published date</code>、<code class="fe nx ny nz oa b">Number of subscribers</code>、<code class="fe nx ny nz oa b">number of views</code>、<code class="fe nx ny nz oa b">number of videos</code>和<code class="fe nx ny nz oa b">uploaded playlistID</code>)。</p><p id="fb00" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">然而，在循环内部，第7行中的下一个动作从初始数据中提取出<code class="fe nx ny nz oa b">uploaded playlist ID</code>，并将其传递给变量<code class="fe nx ny nz oa b">uploaded_playlist_id</code>。然后，我们使用<code class="fe nx ny nz oa b">uploaded_playlist_id</code>作为方法<code class="fe nx ny nz oa b">getUploadedVideoIDs_LastDt()</code>的输入参数，检索视频id列表和最新上传日期。</p><p id="dea7" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">下一个动作使用方法<code class="fe nx ny nz oa b">getHighestViewedFromID()</code>中的<code class="fe nx ny nz oa b">video IDs</code>来获取每个频道中观看率最高的视频的详细信息。</p><p id="7864" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">之后，所有需要的数据在一个二维数组中耦合在一起，该函数返回由<code class="fe nx ny nz oa b">preliminary data</code>、<code class="fe nx ny nz oa b">latest-upload date</code>、<code class="fe nx ny nz oa b">highest_viewed_video_title</code>和<code class="fe nx ny nz oa b">highest_viewed_video_count</code>组成的数据。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ov"><img src="../Images/8ae0961b06ed1cf040cf95de4564054d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*AnjY975XxbugiV62CB6YIw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">二维阵列中的样本响应(图片由作者提供)</figcaption></figure><p id="b8ac" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">最后，包含每个通道细节的二维数组数据被写入电子表格。</p><figure class="no np nq nr gt ka"><div class="bz fp l di"><div class="or os l"/></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">完整的代码片段</figcaption></figure><p id="6238" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">记得按以下顺序创建列标题:<em class="nm">标题、发布日期、订阅人数、总浏览量、总上传量、上传播放列表Id、最后上传日期、最高观看视频和最高观看视频计数。</em></p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ov"><img src="../Images/df53facc00761e4f1a69e0a7cb2bc348.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*APp7HFxJL2H1h0dpKpl6Nw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">谷歌表单中的最终数据(图片由作者提供)</figcaption></figure></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><h1 id="6654" class="lk ll iq bd lm ln oj lp lq lr ok lt lu lv ol lx ly lz om mb mc md on mf mg mh bi translated">自动化数据提取</h1><p id="5811" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">你现在在谷歌表单中有了我们的数据。我们的下一个需求点将涉及在特定时间段触发该数据的更新，这将通过应用程序脚本中的时间驱动触发器来完成。</p><p id="3ca2" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated"><a class="ae kl" href="https://developers.google.com/apps-script/guides/triggers/events" rel="noopener ugc nofollow" target="_blank">时间触发器</a>是在特定时间触发事件的保留功能。在这个上下文中，事件是更新工作表中的数据；您希望每隔12小时定期进行一次该事件。</p><p id="9697" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在应用脚本页面上，点击左侧面板上的<code class="fe nx ny nz oa b"><strong class="ko ja">Triggers</strong></code>按钮，如下图所示。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ow"><img src="../Images/f571506bff34b96ebf3e1b9fc9d06bb0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZPt2tMcuoBKCD_zINlRWWA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">触发页面(作者图片)</figcaption></figure><p id="f83d" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">完成此设置将涉及以下步骤:</p><ul class=""><li id="a00b" class="my mz iq ko b kp kq kt ku kx nu lb nv lf nw lj nd ne nf ng bi translated">点击按钮<code class="fe nx ny nz oa b">Add Trigger</code>。该操作将打开提示页面，因此我们可以根据触发器填充这些值。</li><li id="22ad" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">在文本<code class="fe nx ny nz oa b">choose which function to run</code>下，选择<code class="fe nx ny nz oa b">executeAll()</code>功能；它包含从工作表中提取数据所需的所有算法；其他函数是帮助主进程的辅助函数。</li><li id="c102" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">在<code class="fe nx ny nz oa b">select event resource</code>上选择<code class="fe nx ny nz oa b">Time-Driven</code>，</li><li id="fc0e" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">在<code class="fe nx ny nz oa b">Select type of time-based trigger</code>下选择<code class="fe nx ny nz oa b"><em class="nm">hour timer</em></code>。然后选择小时间隔为每<code class="fe nx ny nz oa b">12 hours</code>。</li></ul><p id="8e78" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">最后将<code class="fe nx ny nz oa b">Failure notifiction settings </code>设置为<code class="fe nx ny nz oa b">Notify me immediately</code>。这将在您的代码出现问题时立即发送通知消息。请注意，此消息将被发送到您的google帐户的电子邮件中。<br/>然后点击<strong class="ko ja"> <em class="nm">保存</em> </strong>按钮。<br/> <br/>保存后，触发器将从当前保存时间开始每12小时执行一次。在某些情况下，它从12点开始读取。<br/> <br/>您可以选择以编程方式为提示页面上不可用的触发间隔创建自定义的时间驱动触发器。</p></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><h1 id="fd90" class="lk ll iq bd lm ln oj lp lq lr ok lt lu lv ol lx ly lz om mb mc md on mf mg mh bi translated">数据可视化</h1><p id="e5aa" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">最后一部分是在Tableau中创建一个简单的数据可视化。在这个演示阶段，您将把Google Sheets中的数据连接到Tableau，并创建一个简单的条形图，显示视频上传数量最多的频道；以及<code class="fe nx ny nz oa b">number of subscribers</code> vs <code class="fe nx ny nz oa b">published date</code>之间的零散剧情。因此，这就是我们为实现这一目标将要做的事情。</p><h2 id="ba9e" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated">将数据连接到Tableau Public</h2><p id="903a" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">在Tableau public上，点击<strong class="ko ja"><em class="nm">Google sheet connector</em></strong><em class="nm"/></p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ov"><img src="../Images/b32e908faf96acd0fbb7915f37bac8fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DB1JRNngU8_HardBVOIPaw.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">Tableau中的Google工作表访问(图片由作者提供)</figcaption></figure><p id="9b3b" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">Tableau将请求在您的浏览器中访问您的Google Sheets，因此单击您各自的帐户并访问它。完成后，您将看到一个屏幕，通知您成功访问。</p><p id="8bfd" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">你可以安全地关闭，回到你的舞台上。</p><p id="474b" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在屏幕上，你会看到一个谷歌表列表，选择一个是为这项工作创建的。然后点击下面选项卡上的<strong class="ko ja"> <em class="nm">第1页</em> </strong>开始可视化。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ow"><img src="../Images/bfb9eaa64d18ede1089aebf1371ffbf5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nH3ciV3qfDFTmeV5hX_Nig.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">访问表(图片由作者提供)</figcaption></figure><h2 id="17aa" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated">准备数据</h2><p id="0f38" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">请注意，在左侧面板上，您会看到图标<code class="fe nx ny nz oa b">Abc</code>靠近表格面板中的变量名<code class="fe nx ny nz oa b">Last upload Date</code>和<code class="fe nx ny nz oa b">Published Date</code>。这意味着Tableau错误地将这些日期-时间变量检测为文本，因此我们必须将它们转换为日期-时间数据类型。</p><p id="899d" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">为此，我们将采取以下步骤:</p><ul class=""><li id="0a81" class="my mz iq ko b kp kq kt ku kx nu lb nv lf nw lj nd ne nf ng bi translated">选择<code class="fe nx ny nz oa b">Last Upload Date</code>和<code class="fe nx ny nz oa b">Published date</code>。</li><li id="9d6b" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">右键单击并选择<strong class="ko ja">更改数据类型&gt;日期&amp;时间。</strong></li></ul><p id="cbc9" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">日期-时间列现在成功地处于其适当的数据类型中。</p><h2 id="d189" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated">变量可视化和格式化</h2><p id="a0cf" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">在这一阶段，您将创建每个变量的图形表示。从一个简单的视频上传数量条形图开始。要做到这一点；</p><ul class=""><li id="22eb" class="my mz iq ko b kp kq kt ku kx nu lb nv lf nw lj nd ne nf ng bi translated">将左侧面板中的<code class="fe nx ny nz oa b"><em class="nm">Total Uploads</em></code>拖动到<strong class="ko ja">列</strong>中，将<code class="fe nx ny nz oa b">Title</code>拖动到<strong class="ko ja">行</strong>中。</li><li id="288d" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">再次拖动<code class="fe nx ny nz oa b">Total Uploads</code>到<strong class="ko ja">标签卡中的</strong>，<strong class="ko ja">标记</strong></li></ul><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ox"><img src="../Images/4438f6e375dce2892480563f85c71740.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*wabOizMYTOC7TweLH4mwkg.gif"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">简单条形图(作者gif)</figcaption></figure><p id="aa31" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">为了进一步探索，您可以创建一个散点图来显示<code class="fe nx ny nz oa b">Published date</code>和<code class="fe nx ny nz oa b">Number of subscribers</code>之间的关系。</p><p id="c30e" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">首先，打开一个<strong class="ko ja">新工作表</strong>；<strong class="ko ja"> </strong>分别拖动<code class="fe nx ny nz oa b">Published date</code>和<code class="fe nx ny nz oa b">Number of subscribers</code>到<strong class="ko ja">列</strong>和<strong class="ko ja">行</strong>货架。</p><p id="2b79" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">默认情况下，Tableau将数据和时间变量聚合到年份。因此，您需要按天汇总<code class="fe nx ny nz oa b">published date</code>,因为我们希望看到某个特定日期的关系。</p><p id="611f" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">接下来，右键单击<strong class="ko ja">列</strong>架中的<code class="fe nx ny nz oa b">Published date</code>，并单击<code class="fe nx ny nz oa b">select Day</code>，如下图所示。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi ox"><img src="../Images/265c3f9c0329b9a1e542ce27635dfdcb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*67mlPVtHlxvC7IY_mCwnWA.gif"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">散点图(作者gif)</figcaption></figure><p id="3716" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在<strong class="ko ja">标记</strong>卡上选择<strong class="ko ja">圆</strong>然后拖动<code class="fe nx ny nz oa b">Title</code>变量到<strong class="ko ja">标记</strong>。这将显示图表中每个圆圈的频道名称。</p><h2 id="479c" class="mi ll iq bd lm mj mk dn lq ml mm dp lu kx mn mo ly lb mp mq mc lf mr ms mg iw bi translated">仪表板创建</h2><p id="c7c0" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">现在进一步创建一个包含两个构建图表的仪表板。</p><p id="b346" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">点击菜单栏上的<strong class="ko ja">仪表盘&gt;新建仪表盘</strong>。<br/>然后将条形图拖到仪表板的右侧面板，将散点图拖到左侧面板。<br/>然后选择<strong class="ko ja">尺寸</strong>为<strong class="ko ja">自动</strong>。<br/>要添加标题，右击顶部菜单栏中的仪表板，并选择<code class="fe nx ny nz oa b">show title</code>。从那里，您可以删除标题，并根据您喜欢的标题名称重新命名。在这个示例中，我们使用了“<em class="nm">我最喜欢的Youtube喜剧分析”</em>。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi oy"><img src="../Images/b3cd7f16f57521dab986df5647736e03.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*S0k8gfgK1SsiLxjXE82MaA.gif"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">仪表板创建(作者图片)</figcaption></figure><p id="7993" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">完成后，点击<strong class="ko ja"> Ctrl + S </strong>保存Tableau public上的分析。确保您勾选了操作按钮，“<strong class="ko ja"> <em class="nm">保持我的数据与Google sheet同步，并嵌入我的凭据。</em> </strong>"然后点击保存按钮。</p><figure class="no np nq nr gt ka gh gi paragraph-image"><div role="button" tabindex="0" class="kb kc di kd bf ke"><div class="gh gi oz"><img src="../Images/ac02f0c8c90feb08e7dce6502de53ae1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Uv4acNIcw0s-Z4ue1n04nA.png"/></div></div><figcaption class="kh ki gj gh gi kj kk bd b be z dk translated">YouTube频道分析仪表板(图片由作者提供)</figcaption></figure><p id="4cf6" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">你现在可以查看你最喜欢的<a class="ae kl" href="https://public.tableau.com/app/profile/warrie.warrie/viz/YoutubeChannelsAnalytics/Dashboard1?publish=yes" rel="noopener ugc nofollow" target="_blank"> YouTuber的分析图片</a>。<br/>但是，这并没有结束，因为您可以尝试基于可用数据的其他类型的分析；例如跟踪最后的上传日期或分析具有最高观看次数的视频。</p></div><div class="ab cl oc od hu oe" role="separator"><span class="of bw bk og oh oi"/><span class="of bw bk og oh oi"/><span class="of bw bk og oh"/></div><div class="ij ik il im in"><h1 id="cf4e" class="lk ll iq bd lm ln oj lp lq lr ok lt lu lv ol lx ly lz om mb mc md on mf mg mh bi translated">临别赠言…</h1><p id="d895" class="pw-post-body-paragraph km kn iq ko b kp mt kr ks kt mu kv kw kx mv kz la lb mw ld le lf mx lh li lj ij bi translated">恭喜你，你现在有了来自你最喜欢的YouTube频道的数据，可以通过利用apps脚本在Tableau上查看、跟踪和分析这些数据。你可以利用这个想法来追踪你最喜欢的youtube频道的其他方面。并且在Tableau中创建更好更漂亮的数据可视化。本教程中使用的数据可以在这里找到<a class="ae kl" href="https://docs.google.com/spreadsheets/d/19U338q1Lu4ZqckEjMp5xJt4dOYDq9Y702HfoR_zztwA/edit#gid=0" rel="noopener ugc nofollow" target="_blank">，代码可以在这里</a>找到<a class="ae kl" href="https://gist.github.com/warrienelly/bdf5a7a436db464f67e5cdb80195a216" rel="noopener ugc nofollow" target="_blank">。</a></p><p id="a957" class="pw-post-body-paragraph km kn iq ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">谢谢大家！👋</p><h1 id="bcc1" class="lk ll iq bd lm ln lo lp lq lr ls lt lu lv lw lx ly lz ma mb mc md me mf mg mh bi translated">参考</h1><ul class=""><li id="d89b" class="my mz iq ko b kp mt kt mu kx na lb nb lf nc lj nd ne nf ng bi translated"><a class="ae kl" href="https://developers.google.com/apps-script/advanced/youtube" rel="noopener ugc nofollow" target="_blank">https://developers.google.com/apps-script/advanced/youtube</a></li><li id="464f" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">Javascript库:<a class="ae kl" href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/map" rel="noopener ugc nofollow" target="_blank">https://developer . Mozilla . org/en-US/docs/Web/JavaScript/Reference/Global _ Objects/Array/map</a></li><li id="3b33" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated">地图参考:<a class="ae kl" href="https://developers.google.com/apps-script/guides/sheets/functions#optimization" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/apps-script/guides/sheets/functions #优化</a></li><li id="315b" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated"><a class="ae kl" href="https://developers.google.com/apps-script/guides/services/authorization" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/apps-script/guides/services/authorization</a></li><li id="75c2" class="my mz iq ko b kp nh kt ni kx nj lb nk lf nl lj nd ne nf ng bi translated"><a class="ae kl" href="https://developers.google.com/apps-script/guides/triggers/events" rel="noopener ugc nofollow" target="_blank">https://developers . Google . com/apps-script/guides/triggers/events</a></li></ul></div></div>    
</body>
</html>