<html>
<head>
<title>How Machine Learning Can Be Used To Predict Application Performance</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">机器学习如何用于预测应用程序性能</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/how-machine-learning-can-be-used-to-predict-application-performance-3e98a61c1694?source=collection_archive---------3-----------------------#2021-02-03">https://pub.towardsai.net/how-machine-learning-can-be-used-to-predict-application-performance-3e98a61c1694?source=collection_archive---------3-----------------------#2021-02-03</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="76bf" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a>，<a class="ae ep" href="https://towardsai.net/p/category/programming" rel="noopener ugc nofollow" target="_blank">编程</a></h2><div class=""/><div class=""><h2 id="9104" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">预测速度和响应度的机器学习案例</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/55f38a1d129c14315408f0f83a13fcd5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4imOIsOkxspxs6QOXLJQ_w.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure><p id="7ffc" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">作为一家大型科技公司前端基础设施团队的工程师，我每天都要处理web应用程序的性能。</p><p id="c1d4" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">性能是至关重要的，但在我的职业生涯中，我看到一些团队一直在追求性能，直到他们再也无法逃脱。</p><p id="c001" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我知道性能意味着很多事情。在本文中，我用它来表示响应性，或者说用户与应用程序交互时的速度。</p><p id="e8fb" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我认为性能受到影响有两个主要原因。一、表演工作辛苦。二、对客户价值影响不大，直到变穷。因此，性能通常是被动处理的。</p><p id="f3cd" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">必须有一个更好的系统！</p><p id="336e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">从性能角度来看，我们能否主动预测发布或拉取请求是否会有问题？</p><p id="6e9b" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我想答案是肯定的。</p><p id="7c44" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">但是首先要做的是。什么是“性能好？”</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="127e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">如果一个客户来找你说“我的应用程序很慢”，他们是从他们的主观角度来说的。我不是说不要相信他们，但是我们确实需要首先建立客观的标准来衡量什么是“坏”或“好”的表现。</p><p id="5f8f" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这些指标取决于应用程序本身；但应该是慢的时候会极大影响用户体验的东西。比如从点击按钮A到看到页面b的缓冲时间。</p><p id="0eba" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在下面的例子中，我将使用一个名为<code class="fe mk ml mm mn b">"csv"</code>的度量(csv在本文中是一个度量，不是文件扩展名)。在我目前的工作中，csv用于衡量应用程序在从一个“对话线程”导航到另一个“对话线程”时的速度。注意:我大大简化了术语，使其易于理解。</p><p id="3b1b" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">因为csv是一个重要的指标，所以我的团队花了很多时间追踪可能影响csv的东西。我们跟踪了在导航过程中触发的<a class="ae mo" href="https://redux.js.org/tutorials/fundamentals/part-1-overview" rel="noopener ugc nofollow" target="_blank"> redux动作</a>的列表；我们测量了对话中有多少成员，安装了多少外部应用，缓存了多少消息，等等。</p><p id="6386" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">需要注意的重要一点是<strong class="lj jd">这些指标(不同于csv)是开发人员或产品决策者可以直接控制的。</strong>例如，工程师可以重构代码以减少redux操作的数量，或者限制缓存的消息数量，等等。</p><p id="c83d" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在我们有了所有这些指标，我们是否可以使用它们来预测特定的部署(每个部署都有一个我们可以跟踪的唯一标识符)是否会导致更差的性能？</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="a3fe" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">为了回答这个问题，我用csv数据做了一些初步的机器学习。</p><p id="af16" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我分析了2000个样本。以下是前5个培训示例:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mp"><img src="../Images/b3e3b302c5d5a9ccc25431cf4d372b3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0o-z4rBp8bQiEmpZOpfh1w.png"/></div></div></figure><p id="8426" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><code class="fe mk ml mm mn b">csv_tolerable</code>(第一列)是我们想要训练模型来预测的。True表示csv可以接受，false表示不可以接受。</p><p id="8b5a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><code class="fe mk ml mm mn b">duration_ms</code>是导航花费的时间。这是用来确定<code class="fe mk ml mm mn b">csv_tolerable</code>的。最后一列，<code class="fe mk ml mm mn b">num_actions_gte_100</code>表示导航期间触发的redux动作的数量是否大于100。</p><p id="10d6" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这2000个训练样本中，1000个有可容忍csv，1000个不可容忍csv。</p><p id="c35a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated"><strong class="lj jd">这里的目标是训练一个模型，根据员工可以控制的其他指标来预测csv是否可以容忍——这是员工无法控制的。</strong></p><p id="bc2b" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在训练模型之前，我进行了基本的数据处理，以:</p><ol class=""><li id="51e1" class="mq mr it lj b lk ll ln lo lq ms lu mt ly mu mc mv mw mx my bi translated">单独的目标列(即csv _ tolerable)。</li><li id="565b" class="mq mr it lj b lk mz ln na lq nb lu nc ly nd mc mv mw mx my bi translated">移除<code class="fe mk ml mm mn b">duration_ms</code>,因为它决定csv_tolerable。</li><li id="736b" class="mq mr it lj b lk mz ln na lq nb lu nc ly nd mc mv mw mx my bi translated">填写缺失值(NaN =&gt; False)。</li><li id="1647" class="mq mr it lj b lk mz ln na lq nb lu nc ly nd mc mv mw mx my bi translated">用一键编码转换分类变量。</li></ol><p id="96da" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">这是最终输入数据帧的样子。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ne"><img src="../Images/69a352bbeb76b1f1e9c729d955f71c22.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*q4sbgxfb1jpV0yGyONie0Q.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">前5个培训示例</figcaption></figure><p id="a1de" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">然后，我将2000个样本分成训练集和测试集。</p><p id="9349" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">现在我们准备训练一个模型。我使用Scikit-Learn的<a class="ae mo" href="https://scikit-learn.org/stable/modules/generated/sklearn.model_selection.RandomizedSearchCV.html" rel="noopener ugc nofollow" target="_blank"> RandomizedSearchCV </a>来为我的模型寻找最佳超参数。</p><pre class="ks kt ku kv gt nf mn ng nh aw ni bi"><span id="79a0" class="nj nk it mn b gy nl nm l nn no">from sklearn.model_selection import RandomizedSearchCV<br/>from scipy.stats import uniform</span><span id="e498" class="nj nk it mn b gy np nm l nn no">X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.3, random_state=42)</span><span id="a14f" class="nj nk it mn b gy np nm l nn no">logistic = LogisticRegression(max_iter=50000, random_state=0, solver='liblinear')</span><span id="a4cc" class="nj nk it mn b gy np nm l nn no">distributions = dict(C=uniform(loc=0, scale=10), penalty=['l2', 'l1'])</span><span id="a988" class="nj nk it mn b gy np nm l nn no">random_search = RandomizedSearchCV(logistic, n_iter=100, param_distributions=distributions, random_state=2)</span><span id="0e90" class="nj nk it mn b gy np nm l nn no">random_search.fit(X_train, y_train)</span><span id="52bd" class="nj nk it mn b gy np nm l nn no">result = random_search.cv_results_<br/>estimator = random_search.best_estimator_<br/>score = random_search.best_score_<br/>params = random_search.best_params_</span></pre><p id="e150" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">最佳参数和分数为:</p><pre class="ks kt ku kv gt nf mn ng nh aw ni bi"><span id="f660" class="nj nk it mn b gy nl nm l nn no">best score 0.666<br/>best params {'C': 4.3532239261827685, 'penalty': 'l2'}</span></pre><p id="0e4e" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">训练之后，我使用测试集来评估我的模型的预测能力。</p><pre class="ks kt ku kv gt nf mn ng nh aw ni bi"><span id="562a" class="nj nk it mn b gy nl nm l nn no">from sklearn.metrics import f1_score<br/>from sklearn.metrics import accuracy_score<br/>from sklearn.metrics import recall_score<br/>from sklearn.metrics import precision_score</span><span id="54a8" class="nj nk it mn b gy np nm l nn no">classifier = LogisticRegression(max_iter=50000, random_state=1000, penalty='l2', C=4.3532239261827685, solver='liblinear')</span><span id="26a6" class="nj nk it mn b gy np nm l nn no">classifier.fit(X_train, y_train)</span><span id="b086" class="nj nk it mn b gy np nm l nn no">y_pred = classifier.predict(X_test)</span><span id="237a" class="nj nk it mn b gy np nm l nn no">data = {<br/>    'accuracy': [accuracy_score(y_test, y_pred)],<br/>    'precision': [precision_score(y_test, y_pred)],<br/>    'recall': [recall_score(y_test, y_pred)],<br/>    'f1 score': [f1_score(y_test, y_pred)]<br/>}</span><span id="0f8f" class="nj nk it mn b gy np nm l nn no">pd.DataFrame.from_dict(data, orient='index', columns=['metrics'])</span></pre><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/d9cfac29ede2803cdcf1636bbdf8785f.png" data-original-src="https://miro.medium.com/v2/resize:fit:996/format:webp/1*GTZQPrEZPqocpZBgyO_b_w.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">训练模型的准确度、精确度、召回率和f1分数</figcaption></figure><p id="50fe" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我将它与一个虚拟模型进行了比较，该模型基于我们标签的分布进行预测。正如预期的那样，准确率在50%左右，因为我们50%的训练数据都有可容忍的csv。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/7f726adbe08a4e764e9dd57fb7d376c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:748/format:webp/1*L4KEdIyrDtWKTO0H_nCX8A.png"/></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">假人模型的准确度、精确度、召回率和f1分数</figcaption></figure><p id="f331" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">经过训练的模型表现明显好于虚拟模型。因此，我的结论是，工程师和产品经理可以直接控制的指标可以用来预测性能。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="d27b" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我知道60多的精确度并不好。理想情况下，我想要一个精度在80多的模型。我确实认为有可能到达那里。</p><p id="4e81" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">此示例仅为<strong class="lj jd">概念验证(POC) </strong>。<strong class="lj jd"> </strong>我走了很多捷径。首先，我使用了逻辑回归。当输入变量呈正态分布时，逻辑回归效果最佳。实际上，自变量如<code class="fe mk ml mm mn b">num_members</code>或<code class="fe mk ml mm mn b">num_messages</code>可能不具有正态分布。</p><p id="c85c" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">此外，我没有对该数据集进行任何特征选择。我也没有标准化数据或寻找异常值。我在本次概念验证中使用了最容易获得的指标。我们还有其他需要更多处理和查询才能获得的指标。这里有一个<a class="ae mo" href="https://www.keboola.com/blog/logistic-regression-machine-learning" rel="noopener ugc nofollow" target="_blank">便捷指南</a>，包含逻辑回归的数据处理步骤。</p><p id="9e7a" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">有了更好的数据和更好的算法，也许我们可以训练一个精确度在80多的模型。</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><p id="96bc" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">我个人坚信，大数据与机器学习相结合可以解决无数的性能问题，从预测拉请求是否会导致更差的性能指标，到对导致性能问题的原因进行分类。</p><p id="4fd6" class="pw-post-body-paragraph lh li it lj b lk ll kd lm ln lo kg lp lq lr ls lt lu lv lw lx ly lz ma mb mc im bi translated">在理想的世界中，工程师很少需要花时间去弄清楚为什么一个应用程序很慢；他们可以很快解决问题本身！</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ns"><img src="../Images/844eee39b7d521600925f25bf0816ee0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8Ji-5u5MNMrrVyluWxqmSg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">作者图片</figcaption></figure></div></div>    
</body>
</html>