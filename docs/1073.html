<html>
<head>
<title>Sentiments Analysis of Financial News as an Indicator for Amazon Stock Price</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">作为亚马逊股价指标的财经新闻情感分析</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/sentiments-analysis-of-financial-news-as-an-indicator-for-amazon-stock-price-26d60534a51f?source=collection_archive---------0-----------------------#2020-10-22">https://pub.towardsai.net/sentiments-analysis-of-financial-news-as-an-indicator-for-amazon-stock-price-26d60534a51f?source=collection_archive---------0-----------------------#2020-10-22</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="1973" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/nlp" rel="noopener ugc nofollow" target="_blank">自然语言处理</a></h2><div class=""/><div class=""><h2 id="693a" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">我们将使用新闻API来执行情绪分析，以便使用Python来预测亚马逊(Amazon)的股票价格</h2></div><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ko"><img src="../Images/482018cd5b4211d2a3d3e9d8d672a53c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*dEpDbbVX9t_971J5.PNG"/></div></div></figure><p id="f2a0" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在所有主要发达市场和主要新兴市场，对新闻的情绪分析已经成为产生股票买卖信号的最有力的方法之一。这个想法很简单，即提及公司名称、品牌、股票代码等的新闻文章的累积情感分数。将成为第二天股票收盘价的重要指标。</p><p id="11c1" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">这只适用于交易量高、主要媒体都有活跃新闻报道的股票。一般来说，纳斯达克、道琼斯或标准普尔500等主要市场指数的成份股都将满足这些标准。</p><p id="4e10" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">在本文中，我们将讨论为Amazon.com股票建立这样一个情绪分析管道的必要步骤。</p><p id="e15b" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">您必须选择要提取的页面部分。通常，人们希望提取新闻文章的作者姓名、日期、标题和全文。</p><h1 id="ba25" class="lw lx iq bd ly lz ma mb mc md me mf mg kf mh kg mi ki mj kj mk kl ml km mm mn bi translated">绘制亚马逊股票价格</h1><p id="24ef" class="pw-post-body-paragraph la lb iq lc b ld mo ka lf lg mp kd li lj mq ll lm ln mr lp lq lr ms lt lu lv ij bi translated">在我们开始实际获取情绪数据之前，让我们先获取亚马逊股票价格(AMZN)的股票市场数据。我喜欢用Alphavantage的API获取股市数据；它可以免费使用，但是你必须生成一个API密匙。</p><pre class="kp kq kr ks gt mt mu mv mw aw mx bi"><span id="ab7f" class="my lx iq mu b gy mz na l nb nc">import requests <br/>import json<br/>from dateutil import parser</span><span id="98e3" class="my lx iq mu b gy nd na l nb nc">import requests<br/>import json</span><span id="515e" class="my lx iq mu b gy nd na l nb nc">test_url = '<a class="ae ne" href="https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&amp;symbol=AMZN&amp;outputsize=full&amp;apikey='" rel="noopener ugc nofollow" target="_blank">https://www.alphavantage.co/query?function=TIME_SERIES_DAILY_ADJUSTED&amp;symbol=AMZN&amp;outputsize=full&amp;apikey='</a> + API_KEY + '&amp;datatype=csv'</span><span id="2e3d" class="my lx iq mu b gy nd na l nb nc">r = requests.get(url = test_url)<br/>print("Status Code: ", r.status_code)<br/>print("*"*20)<br/>print(r.headers)<br/>html_response = r.text<br/>with open("amazon_stock.csv", "w") as outfile: <br/>    outfile.write(html_response)</span><span id="8292" class="my lx iq mu b gy nd na l nb nc">from dateutil import parser<br/>datetime_obj = lambda x: parser.parse(x)</span><span id="9080" class="my lx iq mu b gy nd na l nb nc">df2 = pd.read_csv("amazon_stock.csv", parse_dates=['timestamp'], date_parser=datetime_obj)</span><span id="6b97" class="my lx iq mu b gy nd na l nb nc">#df2 = df2[(df2["timestamp"] &gt;= start_date) &amp; (df2["timestamp"] &lt;= end_date)]</span><span id="bc27" class="my lx iq mu b gy nd na l nb nc">df2.head(1)<br/># Output</span><span id="682d" class="my lx iq mu b gy nd na l nb nc">timestamp   open    high    low     close   adjusted_close  volume  dividend_amount     split_coefficient<br/>0   2020-09-28  3148.85     3175.04     3117.1684   3174.05     3174.05     4224165     0.0     1.0</span></pre><p id="ff81" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">接下来，我们将绘制这个图，以便我们可以直观地看到价格变动。正如你可能已经知道的，由于新冠肺炎·疫情，股票有了强劲的反弹。</p><pre class="kp kq kr ks gt mt mu mv mw aw mx bi"><span id="5b93" class="my lx iq mu b gy mz na l nb nc">import matplotlib.pyplot as plt <br/>import seaborn as sns <br/>top = plt.subplot2grid((4,4), (0, 0), rowspan=3, colspan=4) top.plot(df2['timestamp'], df2['close'], label = 'Closing price') plt.title('Amazon Close Price') <br/>plt.legend(loc=2) bottom = plt.subplot2grid((4,4), (3,0), rowspan=1, colspan=4) <br/>bottom.bar(df2["timestamp"], df2["volume"]) <br/>plt.title('Amazon Daily Trading Volume') <br/>plt.gcf().set_size_inches(12,8) <br/>plt.subplots_adjust(hspace=0.75)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nf"><img src="../Images/5ddcf83d87ac576485e408ec961bc684.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*-0N2Kj7_3Iu9zdvC.PNG"/></div></div></figure><h1 id="15c2" class="lw lx iq bd ly lz ma mb mc md me mf mg kf mh kg mi ki mj kj mk kl ml km mm mn bi translated">抓取新闻文章</h1><p id="55c9" class="pw-post-body-paragraph la lb iq lc b ld mo ka lf lg mp kd li lj mq ll lm ln mr lp lq lr ms lt lu lv ij bi translated">如果你打算收集多个新闻源，以结构化格式批量获取新闻文章将需要大量的数据争论。一个很好的起点是查看我们在<a class="ae ne" href="http://www.specrom.com/blog/cnn-news-web-scraping/" rel="noopener ugc nofollow" target="_blank">上的博客文章，抓取CNN新闻文章</a>，并以此为模板抓取标题、内容、日期、作者等。来自其他新闻网站。</p><p id="b71e" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">一旦你有了原始文章，你就必须将它们加载到一个全文搜索数据库中，比如Elasticsearch、Amazon Cloudsearch、Apache Solr等。然后搜索您选择的股票名称或股票代码来查找相关文章。</p><p id="ac39" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">相反，我们将使用免费的公共API，让我们查询过去7天内所有主要新闻来源的新闻文章。我们的<a class="ae ne" href="http://www.specrom.com/news-api" rel="noopener ugc nofollow" target="_blank">最新和历史新闻API </a>每个API调用最多返回100篇新闻文章，如果需要，您可以对结果进行分页。你需要注册rapidapi来获得一个密钥，但它是免费的(不需要信用卡),你可以在基础层免费使用api。</p><pre class="kp kq kr ks gt mt mu mv mw aw mx bi"><span id="4d99" class="my lx iq mu b gy mz na l nb nc">import requests<br/>import json<br/>url = "<a class="ae ne" href="https://latest-news1.p.rapidapi.com/" rel="noopener ugc nofollow" target="_blank">https://latest-news1.p.rapidapi.com/</a>"</span><span id="dec8" class="my lx iq mu b gy nd na l nb nc">payload = json.dumps({"domains": "","topic":"business","q":        "amazon","qInTitle": "", "content":"", "page":"1", "author_only":""})<br/>headers = {<br/>    'content-type': "application/json",<br/>    'x-rapidapi-key': "YOUR_RAPID_API_KEY",<br/>    'x-rapidapi-host': "latest-news1.p.rapidapi.com"<br/>    }</span><span id="d893" class="my lx iq mu b gy nd na l nb nc">response = requests.request("POST", url, data=payload, headers=headers)<br/>    # after paginating through results</span><span id="bcbd" class="my lx iq mu b gy nd na l nb nc">    print("Total results found: ", response_dict["totalResults"])<br/>    clean_response_list = clean_response_list + response_dict["Article"]<br/>len(clean_response_list)<br/>#Output<br/>fetching page  1<br/>Total results found:  1263</span></pre><p id="8835" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">让我们把它加载到pandas dataframe中，稍后用于情感分析。</p><pre class="kp kq kr ks gt mt mu mv mw aw mx bi"><span id="cb18" class="my lx iq mu b gy mz na l nb nc">import numpy as np<br/>import pandas as pd</span><span id="f745" class="my lx iq mu b gy nd na l nb nc">df = pd.DataFrame(clean_response_list)<br/>df.head()<br/>#Output<br/>author  content     description     publishedAt     source_name     source_url  title   url     urlToImage<br/>0   []  Market Overview Tickers Articles Keywords Che...    GameStop Corp (NYSE: GME) could be extending i...   2020-09-22  Benzinga    benzinga.com    Gamestop Corporation (NYSE:GME), Amazon.com, I...   <a class="ae ne" href="https://www.benzinga.com/news/20/09/17595730/c" rel="noopener ugc nofollow" target="_blank">https://www.benzinga.com/news/20/09/17595730/c</a>...   <a class="ae ne" href="https://cdn.benzinga.com/files/imagecache/og_i" rel="noopener ugc nofollow" target="_blank">https://cdn.benzinga.com/files/imagecache/og_i</a>...<br/>1   ["<a class="ae ne" href="http://www.ETAuto.com" rel="noopener ugc nofollow" target="_blank">www.ETAuto.com</a>"]  Uber investors are pressuring CEO to revamp t...    When Khosrowshahi assumed Uber’s helm from ous...   2020-09-22  ETAuto.com  indiatimes.com  Uber business strategy: Uber investors are pre...   <a class="ae ne" href="https://auto.economictimes.indiatimes.com/news" rel="noopener ugc nofollow" target="_blank">https://auto.economictimes.indiatimes.com/news</a>...   <a class="ae ne" href="https://etimg.etb2bimg.com/thumb/msid-78248237" rel="noopener ugc nofollow" target="_blank">https://etimg.etb2bimg.com/thumb/msid-78248237</a>...<br/>2   []  Xiaomi recently launched the entry-level Redm...    Xiaomi's new entry-level smartphone offers sol...   2020-09-22  News18  news18.com  Redmi 9A Goes on Sale Today on Amazon and Mi.c...   <a class="ae ne" href="https://www.news18.com/news/tech/redmi-9a-goes" rel="noopener ugc nofollow" target="_blank">https://www.news18.com/news/tech/redmi-9a-goes</a>...   <a class="ae ne" href="https://images.news18.com/ibnlive/uploads/2020" rel="noopener ugc nofollow" target="_blank">https://images.news18.com/ibnlive/uploads/2020</a>...<br/>3   []  Bolsonaro faces growing pressure to green Bra...    Bolsonaro faces growing pressure to green Braz...   2020-09-22  France 24   france24.com    Bolsonaro faces growing pressure to green Braz...   <a class="ae ne" href="https://www.france24.com/en/20200922-bolsonaro" rel="noopener ugc nofollow" target="_blank">https://www.france24.com/en/20200922-bolsonaro</a>...   <a class="ae ne" href="https://s.france24.com/media/display/aac6e8c6-" rel="noopener ugc nofollow" target="_blank">https://s.france24.com/media/display/aac6e8c6-</a>...<br/>4   []  Market Overview Tickers Articles Keywords Che...    GameStop Corp (NYSE: GME) could be extending i...   2020-09-22  Benzinga    benzinga.com    Gamestop Corporation (NYSE:GME), Amazon.com, I...   <a class="ae ne" href="https://www.benzinga.com/news/20/09/17595730/c" rel="noopener ugc nofollow" target="_blank">https://www.benzinga.com/news/20/09/17595730/c</a>...   <a class="ae ne" href="https://cdn.benzinga.com/files/imagecache/og_i" rel="noopener ugc nofollow" target="_blank">https://cdn.benzinga.com/files/imagecache/og_i</a>...</span></pre><h1 id="c251" class="lw lx iq bd ly lz ma mb mc md me mf mg kf mh kg mi ki mj kj mk kl ml km mm mn bi translated">使用NLTK的Vader进行情感分析</h1><p id="a961" class="pw-post-body-paragraph la lb iq lc b ld mo ka lf lg mp kd li lj mq ll lm ln mr lp lq lr ms lt lu lv ij bi translated">有许多算法可以计算文本的情感；最好的通常是在神经网络上训练的，例如在大数据集上的BERT。您可以使用它进行精确的分析，然而，对于像这样的经验法则研究，我们可以简单地使用NLTK库打包的vader情绪算法。情绪得分从-1到1不等，一个复合列给出了情绪得分。</p><pre class="kp kq kr ks gt mt mu mv mw aw mx bi"><span id="614e" class="my lx iq mu b gy mz na l nb nc">import nltk<br/>nltk.download('vader_lexicon')<br/>from nltk.sentiment.vader import SentimentIntensityAnalyzer<br/>vader = SentimentIntensityAnalyzer()</span><span id="2de3" class="my lx iq mu b gy nd na l nb nc">scores = df['title'].apply(vader.polarity_scores).tolist()<br/>scores[:5]<br/>#Output<br/>[{'compound': 0.1779, 'neg': 0.0, 'neu': 0.892, 'pos': 0.108},<br/> {'compound': -0.3947, 'neg': 0.143, 'neu': 0.857, 'pos': 0.0},<br/> {'compound': 0.1779, 'neg': 0.0, 'neu': 0.884, 'pos': 0.116},<br/> {'compound': -0.128, 'neg': 0.185, 'neu': 0.672, 'pos': 0.143},<br/> {'compound': 0.1779, 'neg': 0.0, 'neu': 0.892, 'pos': 0.108}]</span></pre><p id="a48b" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">让我们把这个加入到我们最初创建的数据框架中。</p><pre class="kp kq kr ks gt mt mu mv mw aw mx bi"><span id="ec21" class="my lx iq mu b gy mz na l nb nc">scores_df = pd.DataFrame(scores)<br/># join it with main dataframe<br/>df = df.join(scores_df, rsuffix='_right')</span><span id="1206" class="my lx iq mu b gy nd na l nb nc"># Convert the date column from string to datetime<br/>df['date'] = pd.to_datetime(df.publishedAt).dt.date</span><span id="7b5d" class="my lx iq mu b gy nd na l nb nc"># Group by date and ticker columns from scored_news and calculate the mean<br/>mean_scores = df.groupby(['date']).mean()<br/>mean_scores<br/># Output</span><span id="e724" class="my lx iq mu b gy nd na l nb nc">compound    neg     neu     pos<br/>date                <br/>2020-09-22  0.099078    0.079065    0.787065    0.133871<br/>2020-09-23  0.084607    0.064409    0.812341    0.123260<br/>2020-09-24  0.150295    0.045265    0.822676    0.132071<br/>2020-09-25  0.061525    0.063262    0.838885    0.097852<br/>2020-09-26  0.210888    0.044955    0.790333    0.164773<br/>2020-09-27  0.257901    0.043290    0.751855    0.204855<br/>2020-09-28  0.292509    0.020722    0.783089    0.196189</span></pre><p id="638d" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们现在需要做的就是将这一情绪得分绘制成条形图，并与股价进行比较。</p><pre class="kp kq kr ks gt mt mu mv mw aw mx bi"><span id="b7f7" class="my lx iq mu b gy mz na l nb nc">import matplotlib.pyplot as plt</span><span id="9a21" class="my lx iq mu b gy nd na l nb nc">plt.rcParams['figure.figsize'] = [10, 6]</span><span id="8030" class="my lx iq mu b gy nd na l nb nc">mean_scores = mean_scores.unstack()</span><span id="029d" class="my lx iq mu b gy nd na l nb nc"># Get the cross-section of compound in the 'columns' axis<br/>mean_scores = mean_scores.xs('compound').transpose()</span><span id="6ce8" class="my lx iq mu b gy nd na l nb nc"># Plot a bar chart with pandas<br/>mean_scores.plot(kind = 'bar')<br/>plt.grid()</span><span id="e93c" class="my lx iq mu b gy nd na l nb nc"># Plotting a subset of amazon stock price for 7 days<br/># code block 1.2 (Cont.)</span><span id="e072" class="my lx iq mu b gy nd na l nb nc"># Plotting stock and volume</span><span id="75e7" class="my lx iq mu b gy nd na l nb nc">top = plt.subplot2grid((4,4), (0, 0), rowspan=3, colspan=4)<br/>top.plot(df2['timestamp'], df2['close'], label = 'Closing price')<br/>plt.title('Amazon Close Price')<br/>plt.legend(loc=2)<br/>bottom = plt.subplot2grid((4,4), (3,0), rowspan=1, colspan=4)<br/>bottom.bar(df2["timestamp"], df2["volume"])<br/>plt.title('Amazon Daily Trading Volume')<br/>plt.gcf().set_size_inches(12,8)<br/>plt.subplots_adjust(hspace=0.75)</span></pre><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi ng"><img src="../Images/b4de7d88bd232b7840a2ee34bbb56542.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Q0HDBprunHDQqDJA.PNG"/></div></div></figure><figure class="kp kq kr ks gt kt gh gi paragraph-image"><div role="button" tabindex="0" class="ku kv di kw bf kx"><div class="gh gi nh"><img src="../Images/ee1e5c2e671ceea91f4e229da60764cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*Rl6H6X70XJcBm1h5.PNG"/></div></div></figure><p id="639a" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">我们可以立即看到，9月23日之后积极的消息情绪导致整体价格上涨。这种简单化的分析仍然有很多局限性，但它确实表明新闻的情感分析非常有效。</p><p id="0e80" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated">主要限制包括:</p><ul class=""><li id="6437" class="ni nj iq lc b ld le lg lh lj nk ln nl lr nm lv nn no np nq bi translated">当组合不同的新闻来源时，我们必须通过考虑总体<a class="ae ne" href="http://www.specrom.com/domain-ranking-and-authority-api/" rel="noopener ugc nofollow" target="_blank">领域权威和每个来源的受众总数</a>来对情感得分进行加权平均。例如,《华尔街日报》上的负面文章应该比seeking alpha博客上的负面文章获得更高的情感价值。</li><li id="ed95" class="ni nj iq lc b ld nr lg ns lj nt ln nu lr nv lv nn no np nq bi translated">我们应始终考虑特定行业中一篮子证券的股价变动，以解释任何行业或宏观经济变化，尤其是在疫情引发的市场波动的不确定时期。</li></ul></div><div class="ab cl nw nx hu ny" role="separator"><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob oc"/><span class="nz bw bk oa ob"/></div><div class="ij ik il im in"><p id="bd4a" class="pw-post-body-paragraph la lb iq lc b ld le ka lf lg lh kd li lj lk ll lm ln lo lp lq lr ls lt lu lv ij bi translated"><em class="od">最初发表于</em><a class="ae ne" href="http://www.specrom.com/blog/sentiments-analysis-financial-news-of-amazon/" rel="noopener ugc nofollow" target="_blank">T5【http://www.specrom.com】</a><em class="od">。</em></p></div></div>    
</body>
</html>