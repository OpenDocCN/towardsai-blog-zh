<html>
<head>
<title>Time Series Forecasting with ARIMA Models In Python [Part 2]</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Python中ARIMA模型的时间序列预测[第二部分]</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/time-series-forecasting-with-arima-models-in-python-part-2-91a30d10efb0?source=collection_archive---------1-----------------------#2022-05-12">https://pub.towardsai.net/time-series-forecasting-with-arima-models-in-python-part-2-91a30d10efb0?source=collection_archive---------1-----------------------#2022-05-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="43a0" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">使用Python中的ARIMA模型进行时间序列预测的实用指南</h2></div><p id="30be" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi le translated">ime系列数据是行业中最常见的数据类型之一，在您的职业生涯中可能会用到它。因此，了解如何使用它以及如何应用分析和预测技术对于每个有抱负的数据科学家来说至关重要。在这一系列文章中，我将介绍处理时间序列数据的基本技术，从数据操作、分析和可视化开始，以了解您的数据并为其做准备，然后使用统计、机器和深度学习技术进行预测和分类。这更像是一个实践指南，我将把每个讨论和解释的概念应用到真实数据中。</p><p id="cce2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这个系列将由10篇文章组成:</p><ol class=""><li id="8505" class="ln lo it kk b kl km ko kp kr lp kv lq kz lr ld ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/manipulating-time-series-data-in-python-49aed42685a0">在Python Pandas中操作时间序列数据【实用指南】</a></li><li id="9ba9" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/time-series-data-analysis-in-python-1492ee4ca974">Python Pandas中的时间序列分析【实用指南】</a></li><li id="69ad" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated"><a class="ae lw" href="https://medium.com/towards-artificial-intelligence/time-series-data-visualization-in-python-2b1959726312" rel="noopener">用Python可视化时间序列数据【实用指南】</a></li><li id="9b14" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/time-series-forecasting-with-arima-models-in-python-part-1-c2940a7dbc48">利用Python中的ARIMA模型进行时间序列预测【第一部分】</a></li><li id="930f" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/time-series-forecasting-with-arima-models-in-python-part-2-91a30d10efb0">用Python实现ARIMA模型的时间序列预测【第二部分】</a>(你在这里)</li><li id="cbb6" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated"><a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/machine-learning-for-time-series-data-in-python-regression-5e19fa2e7471">时间序列数据的机器学习【回归】</a></li><li id="cdc1" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated">时间序列数据的机器学习[分类](即将推出)</li><li id="edc0" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated">时间序列数据的深度学习[实用指南](即将推出)</li><li id="96a2" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated">使用统计分析、机器学习和深度学习的时间序列预测项目(即将推出)</li><li id="b87b" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld ls lt lu lv bi translated">使用统计分析、机器学习和深度学习进行时间序列分类(即将推出)</li></ol><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi mc"><img src="../Images/77e3b7d4f7b82bf5d117a6784f411c13.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Xs77Hz06NDZk-N-iyvUMFA.jpeg"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">预测未来</figcaption></figure><p id="967e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">本文是利用ARIMA模型进行时间序列预测的第二部分。在<a class="ae lw" rel="noopener ugc nofollow" target="_blank" href="/time-series-forecasting-with-arima-models-in-python-part-1-c2940a7dbc48"> <strong class="kk iu">第一部分</strong></a><strong class="kk iu"/>中介绍了ARIMA模型以及如何用它来预测未来。在本文中，我将更多地关注选择最佳的模型参数，以及如何通过Box-Jenkins方法为预测过程建立一个管道。</p><h1 id="4ae3" class="mo mp it bd mq mr ms mt mu mv mw mx my jz mz ka na kc nb kd nc kf nd kg ne nf bi translated">目录:</h1><h2 id="6894" class="ng mp it bd mq nh ni dn mu nj nk dp my kr nl nm na kv nn no nc kz np nq ne nr bi translated">1.寻找最好的ARIMA模特</h2><ul class=""><li id="76b7" class="ln lo it kk b kl ns ko nt kr nu kv nv kz nw ld nx lt lu lv bi translated">利用ACF和PACF寻找最佳模型参数</li><li id="24b5" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nx lt lu lv bi translated">利用AIC和BIC来缩小你的车型选择</li><li id="8804" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nx lt lu lv bi translated">模型诊断a</li><li id="adfc" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nx lt lu lv bi translated">博克斯-詹金斯方法</li></ul><h2 id="2e03" class="ng mp it bd mq nh ni dn mu nj nk dp my kr nl nm na kv nn no nc kz np nq ne nr bi translated">2.季节性ARIMA模型</h2><ul class=""><li id="fd2f" class="ln lo it kk b kl ns ko nt kr nu kv nv kz nw ld nx lt lu lv bi translated">季节性时间序列简介</li><li id="df33" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nx lt lu lv bi translated">季节性ARIMA模型</li><li id="3b0c" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nx lt lu lv bi translated">流程自动化和模型保存</li><li id="cb67" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nx lt lu lv bi translated">季节性时间序列的SARIMA和Box-Jenkins</li></ul><h2 id="cff8" class="ng mp it bd mq nh ni dn mu nj nk dp my kr nl nm na kv nn no nc kz np nq ne nr bi translated"><strong class="ak"> 3。参考文献</strong></h2><blockquote class="ny nz oa"><p id="eae2" class="ki kj ob kk b kl km ju kn ko kp jx kq oc ks kt ku od kw kx ky oe la lb lc ld im bi translated">本文中使用的代码和数据可以在这个<a class="ae lw" href="https://github.com/youssefHosni/Time-Series-With-Python/tree/main/Arima%20Models%20in%20Python" rel="noopener ugc nofollow" target="_blank"> <strong class="kk iu"> GitHub资源库</strong>中找到。</a></p></blockquote></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><p id="bb92" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">如果你想免费学习数据科学和机器学习，看看这些资源:</strong></p><ul class=""><li id="4529" class="ln lo it kk b kl km ko kp kr lp kv lq kz lr ld nx lt lu lv bi translated">免费互动路线图，自学数据科学和机器学习。从这里开始:<a class="ae lw" href="https://aigents.co/learn/roadmaps/intro" rel="noopener ugc nofollow" target="_blank">https://aigents.co/learn/roadmaps/intro</a></li><li id="05a1" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nx lt lu lv bi translated">数据科学学习资源搜索引擎(免费)。将你最喜欢的资源加入书签，将文章标记为完整，并添加学习笔记。<a class="ae lw" href="https://aigents.co/learn" rel="noopener ugc nofollow" target="_blank">https://aigents.co/learn</a></li><li id="a447" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nx lt lu lv bi translated">想要在导师和学习社区的支持下从头开始学习数据科学吗？免费加入这个学习圈:<a class="ae lw" href="https://community.aigents.co/spaces/9010170/" rel="noopener ugc nofollow" target="_blank">https://community.aigents.co/spaces/9010170/</a></li></ul><p id="2a27" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果你想在数据科学领域开始职业生涯，而你不知道如何开始。我提供数据科学指导课程和长期职业指导:</p><ul class=""><li id="6781" class="ln lo it kk b kl km ko kp kr lp kv lq kz lr ld nx lt lu lv bi translated">长期指导:<a class="ae lw" href="https://lnkd.in/dtdUYBrM" rel="noopener ugc nofollow" target="_blank">https://lnkd.in/dtdUYBrM</a></li><li id="a8a6" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nx lt lu lv bi translated">辅导会议:<a class="ae lw" href="https://lnkd.in/dXeg3KPW" rel="noopener ugc nofollow" target="_blank">https://lnkd.in/dXeg3KPW</a></li></ul><p id="9bd8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> <em class="ob">加入</em> </strong> <a class="ae lw" href="https://youssefraafat57.medium.com/membership" rel="noopener"> <strong class="kk iu"> <em class="ob">中等会员</em> </strong> </a> <strong class="kk iu"> <em class="ob">计划，只需5美元，继续无限制学习。如果你使用下面的链接，我会收到一小部分会员费，不需要你额外付费。</em>T13】</strong></p><div class="om on gp gr oo op"><a href="https://youssefraafat57.medium.com/membership" rel="noopener follow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">加入我的介绍链接媒体-优素福胡斯尼</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">阅读Youssef Hosni(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">youssefraafat57.medium.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd mi op"/></div></div></a></div></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><h1 id="7dd4" class="mo mp it bd mq mr pe mt mu mv pf mx my jz pg ka na kc ph kd nc kf pi kg ne nf bi translated">1.寻找最好的ARIMA模特</h1><p id="63df" class="pw-post-body-paragraph ki kj it kk b kl ns ju kn ko nt jx kq kr pj kt ku kv pk kx ky kz pl lb lc ld im bi translated">在本节中，我们将学习如何从数据本身中识别有希望的模型订单，然后，一旦最有希望的模型被训练，您将学习如何从这个合适的选择中选择最佳模型。您还将学习如何使用Box-Jenkins方法构建时间序列项目。</p><h2 id="b8f9" class="ng mp it bd mq nh ni dn mu nj nk dp my kr nl nm na kv nn no nc kz np nq ne nr bi translated">1.1.利用ACF和PACF寻找最佳模型参数</h2><p id="80db" class="pw-post-body-paragraph ki kj it kk b kl ns ju kn ko nt jx kq kr pj kt ku kv pk kx ky kz pl lb lc ld im bi translated">在上一节中，我们知道了如何使用ARIMA模型进行预测，但是，我们没有讨论如何选择预测模型的阶数。模型阶数是影响预测质量的一个非常重要的参数。识别正确模型阶次的最佳方法之一是自相关函数(ACF)和偏自相关函数(PACF)。</p><p id="12ff" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu"> ACF </strong>可以定义为一个时间序列与其自身的n个滞后的相关性。所以ACF(1)是时间序列和它自身的一步滞后版本之间的相关性。ACF(2)是时间序列与其自身的一步滞后版本之间的相关性，以此类推。为了更好地理解ACF，让我们为地震时间序列绘制10个滞后。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi po"><img src="../Images/7801256e370f122149ca9cb1c581bee5.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*fXN-OuKiQDA30oEaLTp3uQ.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">地震时间序列的ACF。</figcaption></figure><p id="24bd" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上图中的条形显示了时间序列在每个滞后时间点的相关性。如果条形位于蓝色阴影区域内，这意味着它在统计上不显著。</p><p id="adf2" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">另一方面，<strong class="kk iu"> PACF </strong>是一个时间序列和其自身的滞后版本在减去较小滞后的相关性影响后的相关性。所以它可以被认为是特定滞后的相关性。为了更好地理解PACF，让我们为十个滞后的地震时间序列绘制它。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi po"><img src="../Images/9dcfbb5842c33ab5c8cb3ff9aa5ca3e4.png" data-original-src="https://miro.medium.com/v2/resize:fit:760/format:webp/1*un17vpTxcTOBv2lhw8NYyQ.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">地震时间序列的PACF。</figcaption></figure><p id="3ee4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">上图中的条形显示了在减去较小滞后相关性的影响后，时间序列在每个滞后与其自身的相关性。如果条形位于蓝色阴影区域内，这意味着它在统计上不显著。</p><blockquote class="ny nz oa"><p id="0ac2" class="ki kj ob kk b kl km ju kn ko kp jx kq oc ks kt ku od kw kx ky oe la lb lc ld im bi translated">在绘制这些图之前，时间序列必须是平稳的。如果ACF值很高并且非常非常慢地变小，那么这是数据不稳定的迹象，并且它需要不同。另一方面，如果滞后-1处的自相关非常负，这是我们已经取了太多次差的信号。</p></blockquote><p id="2cb5" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过比较时间序列的ACF和PACF，我们可以指出模型的阶次。有三种主要可能性:</p><ul class=""><li id="2f3a" class="ln lo it kk b kl km ko kp kr lp kv lq kz lr ld nx lt lu lv bi translated">AR(p)模型:在滞后p之后，ACF减弱，PACF截止。下图显示了AR(2)的ACF和PACF图。</li></ul><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/fa266cda779db6ceb7d663007662ec59.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*hmMgwX9MkoVU5G_QLH_bbA.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">AR的ACF和PACF图(2)</figcaption></figure><ul class=""><li id="4dc9" class="ln lo it kk b kl km ko kp kr lp kv lq kz lr ld nx lt lu lv bi translated">MA(q)模型:ACF的振幅在滞后q之后截止，而PACF逐渐减弱。下图显示了MA(2)的ACF和PACF图。</li></ul><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pp"><img src="../Images/66c2f1b8eed9ee8530d05bf561e693ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1152/format:webp/1*_f9ufDNzqPDNdf7GQaTg6A.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">用于并购的ACF和PACF图(2)</figcaption></figure><ul class=""><li id="66a3" class="ln lo it kk b kl km ko kp kr lp kv lq kz lr ld nx lt lu lv bi translated">ARIMA(p，q)模型:如果ACF和PACF的振幅都截止，那么这将是ARIMA模型，然而，我们将不能从图中推导出模型阶数(p，q)。</li></ul><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="pr ps di pt bf pu"><div class="gh gi pq"><img src="../Images/9f54320dec856e94bfea474125b22fed.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zNWKtJ7FU4f_ct-ydnzhIw.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">ARIMA(p，q)模型的ACF和PACF图。</figcaption></figure><p id="cc61" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们把这个应用到地震时间序列中，之前我们画出了ACF和PACF。看起来像是ACF在PACF以1的滞后截止时逐渐减弱。因此，它遵循第一种情况，时间序列可以使用AR(1)模型建模。</p><h2 id="b1ec" class="ng mp it bd mq nh ni dn mu nj nk dp my kr nl nm na kv nn no nc kz np nq ne nr bi translated">1.2.利用AIC和BIC来缩小你的车型选择</h2><p id="3916" class="pw-post-body-paragraph ki kj it kk b kl ns ju kn ko nt jx kq kr pj kt ku kv pk kx ky kz pl lb lc ld im bi translated">我们在第三种情况中提到，当ACF和PACF的振幅都截止时，可以使用ARIMA(p，q)模型对时间序列进行建模。然而，模型(p，q)的阶数可以从ACF和PACF图中得到。然而，赤池信息准则(AIC)和贝叶斯信息准则(BIC)可以用来找到他们的价值。</p><p id="1d40" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">对AIC和BIC来说，较低的数值意味着更好的模型。AIC和BIC都惩罚带有大量参数的复杂模型。然而，它们的不同之处在于这样做的方式以及对模型复杂性的影响程度。BIC对额外模型订单的处罚比AIC更重，因此BIC有时会建议比AIC更简单的模型。他们通常会建议相同的模型，但如果不是，你将不得不根据你的优先级选择其中之一。如果你的目标是确定一个更好的预测模型，那么AIC将是一个更好的选择，如果你的目标是确定一个良好的解释模型，那么BIC将是一个很好的选择。</p><p id="a70f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们将其应用于之前使用的地震数据集，并将结果与使用ACF/PACF得到的结果进行比较。我们预测拟合数据的最佳模型是AR(1)。我们将计算p和q从0到2的不同变化的AIC和BIC。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="4855" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">每个模型的排序AIC和BIC如下所示</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pv"><img src="../Images/0d2dd26a25763ade1d1c61dd677558de.png" data-original-src="https://miro.medium.com/v2/resize:fit:734/format:webp/1*cfA1_pv3waIZ2Ai8-QjF2A.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">模型根据AIC和BIC进行排序。</figcaption></figure><p id="396d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">结果表明，拟合数据的最佳模型是(1，1)，这不同于使用PACF/ACF发现的模型。</p><h2 id="a494" class="ng mp it bd mq nh ni dn mu nj nk dp my kr nl nm na kv nn no nc kz np nq ne nr bi translated">3.3.模型诊断</h2><p id="9f43" class="pw-post-body-paragraph ki kj it kk b kl ns ju kn ko nt jx kq kr pj kt ku kv pk kx ky kz pl lb lc ld im bi translated">下一步是诊断模型，以了解模型是否表现良好。为了诊断模型，我们将关注训练数据的残差。残差是模型的一步预测和时间序列的真实值之间的差值。</p><p id="0111" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在statsmodels中，可以使用results对象的dot-resid属性来访问训练期间的残差。结果存储为熊猫系列。这显示在下面的代码中:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pw"><img src="../Images/65d71a359701fc4f76e70fa57f83cfa9.png" data-original-src="https://miro.medium.com/v2/resize:fit:656/format:webp/1*VBn8-6N7Nr7RohQfJTJzsQ.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">用参数(1，1)的ARIMA模型预测地震时间序列数据的残差。</figcaption></figure><p id="013e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了知道预测值离真实值有多远，我们可以计算残差的平均绝对误差。这显示在下面的代码中:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="0ef3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">理想模型的残差应该是以零为中心的不相关高斯白噪声。我们可以使用结果对象的<strong class="kk iu">。plot_diagnostics </strong>方法来生成四个用于评估的公共图。这方面的代码如下所示:</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi px"><img src="../Images/12208d27740b6250d752ac04682a658f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1216/format:webp/1*PGx2T1wOQb_zd1wKlwkYWg.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">地震数据的残差诊断图。</figcaption></figure><p id="6130" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">残差诊断图中有四个图:</p><ul class=""><li id="f51b" class="ln lo it kk b kl km ko kp kr lp kv lq kz lr ld nx lt lu lv bi translated"><strong class="kk iu">标准化残差图:</strong>左上图显示一步标准化残差。如果我们的模型工作正常，残差中应该没有明显的模式。在这个案例中显示了这一点。</li><li id="e906" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nx lt lu lv bi translated"><strong class="kk iu">直方图加估计密度图</strong>:该图显示了残差的分布。直方图向我们展示了测量的分布；橙色线显示直方图的平滑版本，绿色线显示正态分布。如果模型是好的，这两条线应该是相同的。这里它们之间有一些小的差异，这表明我们的模型做得很好。</li><li id="69f8" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nx lt lu lv bi translated"><strong class="kk iu">正态Q-Q图:</strong>Q-Q图将残差的分布与正态分布进行比较。如果残差的分布是正态的，那么除了末端的一些值之外，所有点都应该位于红线上。</li><li id="8e9f" class="ln lo it kk b kl lx ko ly kr lz kv ma kz mb ld nx lt lu lv bi translated"><strong class="kk iu">相关图:</strong>相关图是残差的ACF图，而不是数据。大于零的滞后的95%的相关性应该是不显著的(在蓝色阴影内)。如果残差中存在显著相关性，则意味着数据中存在模型未捕捉到的信息。</li></ul><p id="150f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">我们可以使用结果<strong class="kk iu">获得模型残差的汇总统计数据。总结</strong>方法。在下面显示的结果表中，Prob(Q)是与残差没有相关结构的零假设相关联的p值。Prob(JB)是与残差为高斯正态分布的零假设相关联的p值。如果任一p值小于0.05，我们拒绝该假设。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="pr ps di pt bf pu"><div class="gh gi py"><img src="../Images/67a5bae8d34c08cf0429d1a2c31ca271.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bec0mAoOh0EW7lMlL0VfkQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">模型残差的汇总统计。</figcaption></figure><p id="c659" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">Prob(Q)和Prob(JB)的值都大于0.05，所以我们不能拒绝残差是高斯正态分布的零假设。</p><h2 id="1e54" class="ng mp it bd mq nh ni dn mu nj nk dp my kr nl nm na kv nn no nc kz np nq ne nr bi translated">3.4.博克斯-詹金斯方法</h2><p id="27d2" class="pw-post-body-paragraph ki kj it kk b kl ns ju kn ko nt jx kq kr pj kt ku kv pk kx ky kz pl lb lc ld im bi translated">Box-Jenkins方法是一个帮助您从原始数据到准备生产的模型的清单。在这种方法中，从原始数据到生产就绪模型的三个主要步骤是:识别、估计、模型诊断和基于模型诊断的决策制定。下图对此进行了总结。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi pz"><img src="../Images/1882fd08692669fb0ef8de60cc43a5c9.png" data-original-src="https://miro.medium.com/v2/resize:fit:640/format:webp/1*A90Dd-Lz6w4lHPNv1Oqq5g.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">Box-Jenkins方法允许您从原始时间序列数据转换到准备生产的模型。</figcaption></figure><p id="fbfa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">识别</strong></p><p id="f462" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在识别步骤中，我们探索和表征数据以找到数据的适当形式，以便在估计步骤中使用。首先，我们将研究数据是否是平稳的。如果数据不是平稳的，我们将找到哪种转换会将数据转换为平稳的，最后，我们将确定最有希望的p和q的顺序。</p><p id="bb32" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在这一步骤中使用的工具是绘图、增强的dicky-fuller检验、差分和其他变换，例如对数变换，以及用于识别有希望的模型阶次的ACF和PACF。</p><p id="e23c" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">估计</strong></p><p id="8cbc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在估计步骤中，模型被训练，数据的AR和MA系数。这是由<strong class="kk iu">模型拟合</strong>方法自动完成的。在这一步，我们可以拟合许多模型，并使用BIC和AIC将它们缩小到更有希望的模型。</p><p id="88b1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><strong class="kk iu">模型诊断</strong></p><p id="c2ac" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">使用在诊断步骤中从统计测试和绘图中收集的信息，我们需要做出决定。这个模型够好了吗？还是我们需要回去重做它？如果残差不是应有的，我们将返回并重新考虑我们在前两步中的选择。如果残差是好的，那么我们可以继续进行预测！</p><p id="c339" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这应该是开发时序模型时的一般项目工作流程。为了建立一个合适的模型，你可能需要重复这个过程几次。</p><p id="facf" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们将Box-Jenkins方法应用于新数据。将使用的数据是1958年至2018年间的二氧化碳排放量。我们将经历三个步骤。我们先从<strong class="kk iu">鉴定</strong>开始。首先，我们将使用下面的代码加载和绘制数据。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qa"><img src="../Images/d8599996db5921cd438bd833aec814b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:840/format:webp/1*iji4G_MTjrUVPbb-leA-jA.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">从1959年到2018年每年的二氧化碳排放量。</figcaption></figure><p id="34f1" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">很明显数据有趋势。然后我们将应用扩展的迪基-富勒测试。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qb"><img src="../Images/69e5452d71d2bc72232da68f399d94d8.png" data-original-src="https://miro.medium.com/v2/resize:fit:714/format:webp/1*xsI_d3zTdQGTbp7mWC4iRQ.png"/></div></figure><p id="f9ef" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">p值为1，这意味着我们不能拒绝时间序列是非平稳的零假设。要将其转换为信纸，让我们取第一个差异，绘制它并应用扩展的Dicky-Fuller测试。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qc"><img src="../Images/47c5f48237d69493f29cee06b3a0086e.png" data-original-src="https://miro.medium.com/v2/resize:fit:740/format:webp/1*HmIf_ol38_LfJ5dY6H-wgA.png"/></div></figure><p id="370d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">p值小于0.05，因此我们可以拒绝零假设，并且可以假设数据是平稳的。二氧化碳数据的第一个差异如下图所示。</p><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qd"><img src="../Images/3c6f70e1b61d131ea2c5ce0f492bd659.png" data-original-src="https://miro.medium.com/v2/resize:fit:828/format:webp/1*p6adu_gTczU7CLWwPjrIWw.png"/></div></figure><p id="adf7" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">识别的最后一步是为co2排放数据中的第一个差异绘制ACF和PACF图。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="pr ps di pt bf pu"><div class="gh gi qe"><img src="../Images/f10159fd8c46d0c0ba982a7cc2b58817.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lvm7xOrQtHvYmLdoEHOrRA.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">ACF和PACF的co2排放数据的第一个差异。</figcaption></figure><p id="09d9" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ACF和PACF的情节没有遵循一定的模式。因此很难识别模型顺序。因此，我们将使用AIC和BIC来缩小模型阶数的选择范围，然后将数据拟合到最佳模型。这是第二步，即<strong class="kk iu">估算</strong>步骤。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qf"><img src="../Images/2755c2ea704c938cba87325b9dfc8d84.png" data-original-src="https://miro.medium.com/v2/resize:fit:522/format:webp/1*ktqvRhCpKq5Fp85Bd7Jirg.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">每个型号订单的AIC和BIC。</figcaption></figure><p id="82fa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最佳模型阶数是(4，4)。让我们用这个顺序来拟合数据，然后通过分析模型残差来诊断模型。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="pr ps di pt bf pu"><div class="gh gi qg"><img src="../Images/bf4466a237ed4b5653a6923af53cb858.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cbCUPt5zeULP5kjOiShBoQ.png"/></div></div></figure><p id="ed1a" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从图中，我们可以做出模型在数据上运行良好的决定，并且不需要进行另一次迭代。</p></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><h1 id="fde8" class="mo mp it bd mq mr pe mt mu mv pf mx my jz pg ka na kc ph kd nc kf pi kg ne nf bi translated">2.季节性ARIMA模型</h1><p id="bc06" class="pw-post-body-paragraph ki kj it kk b kl ns ju kn ko nt jx kq kr pj kt ku kv pk kx ky kz pl lb lc ld im bi translated">在最后一节，我们将讨论如何使用季节性ARIMA模型来拟合更复杂的数据。您将了解如何将这些数据分解为季节性和非季节性部分，然后您将有机会在最后一次全球预测挑战中使用所有ARIMA工具。</p><h2 id="ff2a" class="ng mp it bd mq nh ni dn mu nj nk dp my kr nl nm na kv nn no nc kz np nq ne nr bi translated">2.1.季节性时间序列简介</h2><p id="9b30" class="pw-post-body-paragraph ki kj it kk b kl ns ju kn ko nt jx kq kr pj kt ku kv pk kx ky kz pl lb lc ld im bi translated">一个<strong class="kk iu">季节性时间序列</strong>有可预测的模式，定期重复。尽管我们称这种特征为季节性，但它可以在任何时间长度后重复出现。这些季节性周期可能每年重复一次，比如防晒霜的销量，每周重复一次，比如公园的游客数量，或者每天重复一次，比如某个时间某个网站的用户数量。</p><p id="7688" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">任何时间序列都可以被认为是由三个主要部分组成的:趋势、季节成分和残差。下图显示了之前使用的糖果生产时间序列的三个组成部分。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="pr ps di pt bf pu"><div class="gh gi qh"><img src="../Images/a0ca9ae3a080d5d04c29166603e3f4cf.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_GoBdqOLjzaxo6kgZdNknQ.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">糖果生产时间序列及其三个组成部分。</figcaption></figure><p id="3c94" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">从上图可以明显看出，数据中存在季节性。这里的周期是12个月。但是，这是作为函数的参数给出的。如果我们想找到周期或季节性周期，一种方法是使用ACF并观察相关模式重复后的滞后。但是，确保数据是静态的非常重要。由于糖果生产数据包含趋势，因此它不是平稳的，我们可以通过求第一个差值将其转换为平稳的。但是，这次我们只是试图找到时间序列的周期，如果我们只减去滚动平均值，ACF图会更清晰。我们使用数据框的<strong class="kk iu">计算滚动平均值。滚动</strong>方法，我们传递窗口大小，也使用<strong class="kk iu">。意思是</strong>方法。任何大的窗口大小N都适用于此。我们从原始时间序列中减去这个值，去掉NA值。时间序列现在是稳定的，这将更容易解释ACF图。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qi"><img src="../Images/fe04ed6d808d83c2cf3377095d66a443.png" data-original-src="https://miro.medium.com/v2/resize:fit:1104/format:webp/1*t68WebRV2U-lSRrt0wSN2w.png"/></div></figure><p id="5ad8" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在绘制去趋势数据的ACF后，我们可以清楚地看到存在12步的季节周期。由于数据是季节性的，如果我们试图用ARIMA模型来拟合它，我们总是会有相关残差。这意味着我们没有利用数据中的所有信息，因此我们不可能做出最好的预测。这将通过使用季节性Arima来解决，如下一小节所示。</p><h2 id="e23b" class="ng mp it bd mq nh ni dn mu nj nk dp my kr nl nm na kv nn no nc kz np nq ne nr bi translated">2.2.季节性ARIMA模型</h2><p id="1390" class="pw-post-body-paragraph ki kj it kk b kl ns ju kn ko nt jx kq kr pj kt ku kv pk kx ky kz pl lb lc ld im bi translated">在上一小节中，我们讨论了如何在数据中寻找季节性，在本小节中，我们将了解如何使用季节性进行更准确的预测。季节性ARIMA (SARIMA)用于此。拟合萨里玛模型就像同时拟合两个不同的ARIMA模型，一个用于季节性部分，另一个用于非季节性部分。因为我们有这两种型号，我们将有两套订单。我们有自回归(p)、差异(d)和移动平均(q)部分的非季节性订单。我们还将这组非季节性部分的订单添加到一个新订单S中，这是季节性周期的长度。</p><p id="cb38" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们进一步比较萨里玛和ARIMA模型。下面是带有参数(2，0，1)的ARIMA模型的方程。在这个方程中，我们对滞后-1和滞后-2的时间序列和滞后-1的冲击进行回归。</p><p id="8e3b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ARIMA(2，0，1)模型:</p><p id="393e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">y(t)= a(1)y(t-1)+a(2)y(t-2)+m(1)ϵ(t-1)+ϵ(t)</p><p id="0062" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">下面是一个季节长度为7天的简单SARIMA模型的等式。这款SARIMA只有当季款；我们已经将非季节性订单设置为零。我们对滞后一季和两季的时间序列进行回归，对滞后一季的冲击进行回归。</p><p id="e71f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">萨里玛(0，0，0)(2，0，1)7模型:</p><p id="e2dc" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">y = a(7)y(t-7)+a(14)y(t-14)+m(7)ϵ(t-7)+ϵ(t)</p><p id="7937" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这种特殊的SARIMA模型将能够捕捉季节性的、每周的模式，但不能捕捉本地的、日常的模式。如果我们构建一个SARIMA模型，并包括非季节性订单，那么我们可以捕捉到这两种模式。</p><p id="657b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">拟合萨里玛模型几乎与拟合ARIMA模型一样。我们像以前一样导入模型对象并对其进行拟合。唯一的区别是，在实例化模型时，我们必须指定季节性订单和常规订单。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="b3b6" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">这意味着我们需要找到大量的模型订单。在上一小节中，我们学习了如何使用ACF找到季节周期S。下一个任务是找出季节差异的顺序。</p><p id="713d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">为了使时间序列平稳，我们可能需要应用<strong class="kk iu">季节差异</strong>。在季节差异中，我们不是减去最近的时间序列值，而是减去一个周期之前的时间序列值。我们可以通过使用<strong class="kk iu"> df.diff </strong>方法来计算季节差异。这次我们传入一个整数S，它是季节周期的长度。</p><p id="87e3" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果时间序列显示一个趋势，那么我们采取正常的差异。一旦我们找到了差分的两个阶，并使时间序列平稳，我们就需要找到其他的模型阶。为了找到非季节性订单(p，q ),我们绘制了差异时间序列的ACF和PACF。为了找到季节性订单(P，Q ),我们绘制了不同时间序列在多个季节性步骤的ACF和PACF。然后，我们可以使用相同的ACF表和PACF规则来计算季节性订单。我们使用<strong class="kk iu"> plot_acf </strong>和<strong class="kk iu"> plot_pacf </strong>函数制作这些季节性ACF和PACF图，但这次我们将滞后参数设置为滞后列表，而不是最大值。该图仅绘制了这些特定滞后时的ACF和PACF。</p><p id="0efa" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">让我们将此应用于上一小节中使用的糖果生产时间序列。我们知道数据的季节周期是12步。所以我们先用季节差来去除季节效应，然后用一步差来去除趋势效应。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qj"><img src="../Images/ffe0ecbb741e013897202cd6c6c0e43b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*6lWELI8vGr7piYSFut2LRA.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">剔除季节效应后的糖果生产时间序列。</figcaption></figure><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qj"><img src="../Images/6309be7f0d833af5855ef59baf05c07e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1346/format:webp/1*VrOa4MnnCEa35qqiIwuGdg.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">剔除季节和趋势影响后的糖果生产时间序列。</figcaption></figure><p id="9f09" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">应用扩展的Adfuller-Dickey检验，以确保时间序列现在是平稳的。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qk"><img src="../Images/e8293ad64a5fba71eb21f84d6fa43b6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:786/format:webp/1*b8DzvpeA0b8SMYXqMWBEhg.png"/></div></figure><p id="3835" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">p值小于0.05，因此我们可以拒绝零假设，并假设时间序列现在是平稳的。之后，我们将绘制ACF和PACF，以找到非季节性模型参数。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="pr ps di pt bf pu"><div class="gh gi ql"><img src="../Images/13401e37586add4064eddc2ed47ed894.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZbZ2QNaM53li0iere8eJig.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">应用季节和一步差后糖果生产时间序列的ACF和PACF。</figcaption></figure><p id="4a3b" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">在ACF和PACF图中没有明确的模式，所以我们将使用AIC和BIC来缩小我们的选择范围。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="901e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">最佳模型参数为(0，3)。之后，我们将绘制季节性ACF和PACF，以找到季节性参数。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="pr ps di pt bf pu"><div class="gh gi qm"><img src="../Images/c2c22850f6685eeefdb90e93347b0ec6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1372/format:webp/1*MSvOn6trp4yGEBZm3RZ0qw.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">糖果生产时间序列的季节性ACF和PACF。</figcaption></figure><p id="dfa0" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">ACF正在减弱，PACF在三秒钟后被切断。所以模型参数是(0，3)。最后一步是用所有这些参数来拟合模型。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><h2 id="fb57" class="ng mp it bd mq nh ni dn mu nj nk dp my kr nl nm na kv nn no nc kz np nq ne nr bi translated">2.3.流程自动化和模型保存</h2><p id="7b7a" class="pw-post-body-paragraph ki kj it kk b kl ns ju kn ko nt jx kq kr pj kt ku kv pk kx ky kz pl lb lc ld im bi translated">之前，我们使用for循环搜索了ARIMA模型订单。现在我们也有季节性订单，这就非常复杂了。幸运的是，有一个包可以为我们完成大部分工作。这是<strong class="kk iu"> pmdarima </strong>包，这个包中的<strong class="kk iu"> auto_arima </strong>函数循环遍历模型订单，以找到最佳的一个。该函数返回的对象是通过搜索找到的最佳模型的结果对象。该对象几乎完全类似于statsmodels SARIMAX结果对象，并具有摘要和绘图诊断方法。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="pr ps di pt bf pu"><div class="gh gi qg"><img src="../Images/d42238fabb07b2f72c2ed25e50f1b81d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2veCEmj4ljDxI-xO05CLkg.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">模型诊断。</figcaption></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="pr ps di pt bf pu"><div class="gh gi qn"><img src="../Images/9cbaf0b073aabdebf016464afad2ebfa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XPw3422tKNMfSEk7fF0aXA.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">模型摘要。</figcaption></figure><p id="684e" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">通过搜索找到的最佳模型的顺序是(2，3)。然而，它没有考虑到季节性因素。为此，我们必须将季节参数设置为true。我们还需要指定季节周期的长度；和季节差异的顺序。最后，我们将使用几个无序参数。使用<strong class="kk iu"> information_criterion </strong>您可以选择是基于aic还是bic选择最佳模型，如果<strong class="kk iu">information _ criterion</strong>= ' AIC '它将基于AIC选择，如果是<strong class="kk iu">information _ criterion =</strong>' BIC '它将基于BIC选择。此外，我们将把<strong class="kk iu">跟踪参数</strong>设置为真，然后这个函数为它适合的每个模型打印AIC和BIC。为了忽略坏的模型，我们将设置<strong class="kk iu">error _ action</strong>=‘ignore’。我们将<strong class="kk iu">逐步</strong>设置为真，然后该函数使用智能搜索方法从初始模型顺序猜测向外搜索，而不是搜索所有模型顺序。这可能会节省运行时间和计算能力。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div class="gh gi qo"><img src="../Images/f6b7c81d1bdd86ac49441dd18dc6d7e9.png" data-original-src="https://miro.medium.com/v2/resize:fit:614/format:webp/1*JpqX5xRTdN-WX-NX8yXTDA.png"/></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">最佳模型的参数。</figcaption></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="pr ps di pt bf pu"><div class="gh gi qp"><img src="../Images/9bd476a5304627c94c849db3862e25aa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*xfSCC6hGwEFMplm7oPGSJw.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">最佳SARIMA模型的汇总统计量和参数。</figcaption></figure><figure class="md me mf mg gt mh gh gi paragraph-image"><div role="button" tabindex="0" class="pr ps di pt bf pu"><div class="gh gi qg"><img src="../Images/cc0390a1d3d6a09d86a02a07cf56ae77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sGvqhVCMkQ2pjZXe7Wvweg.png"/></div></div><figcaption class="mk ml gj gh gi mm mn bd b be z dk translated">最佳模型的残差诊断。</figcaption></figure><p id="e001" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">一旦您以这种方式拟合了模型，您可能想要保存它并在以后加载它。您可以使用<strong class="kk iu"> joblib </strong>包来完成此操作。为了保存模型，我们使用了<strong class="kk iu"> joblib </strong>包中的转储函数。我们将模型结果对象和file_path传递给这个函数。稍后，当我们想要进行新的预测时，我们可以再次加载这个模型。为此，我们使用joblib中的load函数。</p><figure class="md me mf mg gt mh"><div class="bz fp l di"><div class="pm pn l"/></div></figure><p id="a617" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">如果您有新的数据并且想要更新已训练的模型，您可以使用<strong class="kk iu"> model.update(new_data)。</strong>这与再次选择模型顺序不同，因此，如果您使用大量新数据进行更新，最好回到Box-Jenkins方法的起点。</p><h2 id="9d9a" class="ng mp it bd mq nh ni dn mu nj nk dp my kr nl nm na kv nn no nc kz np nq ne nr bi translated">2.4.季节性时间序列的SARIMA和Box-Jenkins</h2><p id="0645" class="pw-post-body-paragraph ki kj it kk b kl ns ju kn ko nt jx kq kr pj kt ku kv pk kx ky kz pl lb lc ld im bi translated">我们以前讨论过ARIMA模型的Box-Jenkins方法。我们通过模型订单的识别；估计或拟合模型；诊断模型残差，最后生产。对于SARIMA模型，该方法中唯一会改变的步骤是识别步骤。在识别步骤中，我们添加了确定时间序列是否是季节性的任务，如果是，那么找到它的季节周期。我们还需要考虑使季节性时间序列平稳的变换，例如季节性和非季节性差分以及其他变换。有时我们会选择是否应用季节差异、非季节差异或两者来使时间序列平稳。一些好的经验法则是，你不应该使用一个以上的季节差异，也不应该使用两个以上的季节差异。有时，您可以通过使用一个季节性差异或一个非季节性差异来使时间序列平稳。</p><p id="503f" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">季节性有两种:弱季节性和强季节性。在季节性较弱的情况下，时间序列中的季节性振荡不会总是看起来一样，也更难识别。而在强季节性中，时间序列中的季节性模式将是强的。当你有一个很强的季节模式时，你应该总是使用一个季节差异的顺序。这将确保季节性振荡在你未来的动态预测中不会消失。而在弱季节性模式中，仅在必要时使用它。</p><p id="8e5d" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">就像在ARIMA建模中，有时我们需要在拟合之前对我们的时间序列使用其他转换。如果季节性是<strong class="kk iu">加性季节性</strong>在<strong class="kk iu">中</strong>季节性模式只是从趋势中增加或减少一点。每当季节性是<strong class="kk iu">加性的</strong>时，除了差分，我们不需要应用任何变换。如果季节性是<strong class="kk iu">乘</strong>的，季节性波动的振幅会随着数据的上升而变大，或者随着数据的下降而变小。如果季节性是<strong class="kk iu">乘性的</strong>，如果没有额外的转换，SARIMA模型就无法适应这种情况。为了解决这个问题，我们在建模之前对数据进行对数转换。</p></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><h1 id="223d" class="mo mp it bd mq mr pe mt mu mv pf mx my jz pg ka na kc ph kd nc kf pi kg ne nf bi translated">3.参考</h1><p id="056c" class="pw-post-body-paragraph ki kj it kk b kl ns ju kn ko nt jx kq kr pj kt ku kv pk kx ky kz pl lb lc ld im bi translated">[1].<a class="ae lw" href="https://app.datacamp.com/learn/courses/arima-models-in-python" rel="noopener ugc nofollow" target="_blank">https://app . data camp . com/learn/courses/ARIMA-models-in-python</a></p><p id="17d4" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated">[2].https://www . stats models . org/devel/generated/stats models . TSA . ARIMA . model . ARIMA . html</p></div><div class="ab cl of og hx oh" role="separator"><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok ol"/><span class="oi bw bk oj ok"/></div><div class="im in io ip iq"><div class="md me mf mg gt op"><a href="https://youssefraafat57.medium.com/membership" rel="noopener follow" target="_blank"><div class="oq ab fo"><div class="or ab os cl cj ot"><h2 class="bd iu gy z fp ou fr fs ov fu fw is bi translated">加入我的介绍链接媒体-优素福胡斯尼</h2><div class="ow l"><h3 class="bd b gy z fp ou fr fs ov fu fw dk translated">阅读Youssef Hosni(以及媒体上成千上万的其他作家)的每一个故事。您的会员费直接支持…</h3></div><div class="ox l"><p class="bd b dl z fp ou fr fs ov fu fw dk translated">youssefraafat57.medium.com</p></div></div><div class="oy l"><div class="oz l pa pb pc oy pd mi op"/></div></div></a></div><p id="e2ab" class="pw-post-body-paragraph ki kj it kk b kl km ju kn ko kp jx kq kr ks kt ku kv kw kx ky kz la lb lc ld im bi translated"><em class="ob">感谢阅读！如果你喜欢这篇文章，一定要鼓掌(高达50！)并在</em> <a class="ae lw" href="https://www.linkedin.com/in/youssef-hosni-b2960b135/" rel="noopener ugc nofollow" target="_blank"> <em class="ob"> LinkedIn </em> </a> <em class="ob">上与我联系，并在</em><a class="ae lw" href="https://youssefraafat57.medium.com/" rel="noopener"><em class="ob">Medium</em></a><em class="ob">上关注我的新文章。</em></p></div></div>    
</body>
</html>