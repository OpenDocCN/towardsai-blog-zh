<html>
<head>
<title>ML Engineering Lessons Uber Learned from Running ML at Scale</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">优步从大规模经营ML中学到的ML工程经验</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/ml-engineering-lessons-uber-learned-from-running-ml-at-scale-eb0f53ed9029?source=collection_archive---------1-----------------------#2022-05-31">https://pub.towardsai.net/ml-engineering-lessons-uber-learned-from-running-ml-at-scale-eb0f53ed9029?source=collection_archive---------1-----------------------#2022-05-31</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a4e4" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">从优步洗钱基础设施最初几年的运作中得到的一些教训。</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/c4d68c76aa90f7028bb75a61ccff469a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*P4BEagVk7glWUXVjoeXYNA.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://jamal-robinson.medium.com/how-uber-organizes-around-artificial-intelligence-machine-learning-665cdeb946bc" rel="noopener">https://Jamal-Robinson . medium . com/how-Uber-organizations-around-artificial-intelligence-machine-learning-665 cdeb 946 BC</a></figcaption></figure><blockquote class="kz la lb"><p id="9674" class="lc ld le lf b lg lh ju li lj lk jx ll lm ln lo lp lq lr ls lt lu lv lw lx ly im bi translated">我最近创办了一份专注于人工智能的教育时事通讯，已经有超过125，000名订户。《序列》是一份无废话(意思是没有炒作，没有新闻等)的ML导向时事通讯，需要5分钟阅读。目标是让你与机器学习项目、研究论文和概念保持同步。请通过订阅以下内容来尝试一下:</p></blockquote><div class="lz ma gp gr mb mc"><a href="https://thesequence.substack.com/" rel="noopener  ugc nofollow" target="_blank"><div class="md ab fo"><div class="me ab mf cl cj mg"><h2 class="bd iu gy z fp mh fr fs mi fu fw is bi translated">序列</h2><div class="mj l"><h3 class="bd b gy z fp mh fr fs mi fu fw dk translated">与机器学习、人工智能和数据发展保持同步的最佳资源…</h3></div><div class="mk l"><p class="bd b dl z fp mh fr fs mi fu fw dk translated">thesequence.substack.com</p></div></div><div class="ml l"><div class="mm l mn mo mp ml mq ks mc"/></div></div></a></div><p id="3a0f" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mr ln lo lp ms lr ls lt mt lv lw lx ly im bi translated">大规模运行机器学习(ML)系统非常困难，对大多数公司来说仍然是一种新奇的体验。大规模ML工程中一些最有价值的最佳实践来自大型技术公司，这些公司一直在运行极其复杂的ML基础设施。</p><p id="5347" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mr ln lo lp ms lr ls lt mt lv lw lx ly im bi translated">在过去的几年里，优步一直是开源机器学习技术最积极的贡献者之一。虽然谷歌或脸书等公司的贡献主要集中在TensorFlow或PyTorch等新的深度学习堆栈上，但优步工程团队真正关注的是在现实世界中大规模构建机器学习的工具和最佳实践。诸如<a class="ae ky" href="https://eng.uber.com/michelangelo/" rel="noopener ugc nofollow" target="_blank">米开朗基罗</a>、<a class="ae ky" href="https://github.com/uber/horovod" rel="noopener ugc nofollow" target="_blank">霍罗沃德</a>、<a class="ae ky" href="https://towardsdatascience.com/uber-introduces-pyml-their-secret-weapon-for-rapid-machine-learning-development-c0f40009a617" rel="noopener" target="_blank"> PyML </a>和<a class="ae ky" href="http://pyro.ai/" rel="noopener ugc nofollow" target="_blank"> Pyro </a>等技术是优步对机器学习生态系统所做贡献的一些例子。由于只有少数公司开发大规模的机器学习解决方案，优步的经验和指导对于机器学习从业者来说变得更加有价值。</p><p id="656d" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mr ln lo lp ms lr ls lt mt lv lw lx ly im bi translated">几年前，<a class="ae ky" href="https://eng.uber.com/scaling-michelangelo/" rel="noopener ugc nofollow" target="_blank">优步工程团队公布了米开朗基罗平台</a>前三年的运营评估。我仍然认为在最初的优步帖子中概述的经验教训是ML工程团队应该知道的最实用的技巧之一。如果我们删除所有米开朗基罗的细节，优步的帖子包含了一些不明显的，对开始机器学习之旅的组织有价值的教训。我将尝试以一种更通用的方式总结一些关键的要点，这种方式可以应用于任何主流的机器学习场景。</p><h1 id="322c" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">米开朗基罗是什么？</h1><p id="4f39" class="pw-post-body-paragraph lc ld it lf b lg nm ju li lj nn jx ll mr no lo lp ms np ls lt mt nq lw lx ly im bi translated"><a class="ae ky" href="https://eng.uber.com/michelangelo/" rel="noopener ugc nofollow" target="_blank">米开朗基罗</a>是优步机器学习栈的核心。从概念上讲，米开朗基罗可以被视为优步内部ML工作负载的ML即服务平台。从功能的角度来看，米开朗基罗自动化了ML模型生命周期的不同方面，允许不同的优步工程团队大规模地构建、部署、监控和操作ML模型。具体来说，米开朗基罗在一个非常复杂的工作流程中抽象了ML模型的生命周期:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi nr"><img src="../Images/22a56cf8f09cffa61cd30d01481cbba2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*PyGsD1TOYpj6Ylu4.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来源:https://eng.uber.com/scaling-michelangelo/<a class="ae ky" href="https://eng.uber.com/scaling-michelangelo/" rel="noopener ugc nofollow" target="_blank"/></figcaption></figure><p id="c91b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mr ln lo lp ms lr ls lt mt lv lw lx ly im bi translated">米开朗基罗背后的架构使用了现代但复杂的堆栈，基于诸如<a class="ae ky" href="http://hadoop.apache.org/" rel="noopener ugc nofollow" target="_blank"> HDFS </a>、<a class="ae ky" href="https://spark.apache.org/" rel="noopener ugc nofollow" target="_blank">火花</a>、<a class="ae ky" href="http://samza.apache.org/" rel="noopener ugc nofollow" target="_blank">萨姆扎</a>、<a class="ae ky" href="http://cassandra.apache.org/" rel="noopener ugc nofollow" target="_blank">卡珊德拉</a>、<a class="ae ky" href="https://spark.apache.org/mllib/" rel="noopener ugc nofollow" target="_blank"> MLLib </a>、<a class="ae ky" href="https://github.com/dmlc/xgboost" rel="noopener ugc nofollow" target="_blank"> XGBoost </a>和<a class="ae ky" href="https://www.tensorflow.org/" rel="noopener ugc nofollow" target="_blank"> TensorFlow </a>等技术。</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ns"><img src="../Images/3b4cb15ce7f4806fb30dc63217c74e81.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*9jL6OaOzsinz2Xo3.png"/></div></div><figcaption class="ku kv gj gh gi kw kx bd b be z dk translated">来源:<a class="ae ky" href="https://eng.uber.com/scaling-michelangelo/" rel="noopener ugc nofollow" target="_blank">https://eng.uber.com/scaling-michelangelo/</a></figcaption></figure><p id="ea39" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mr ln lo lp ms lr ls lt mt lv lw lx ly im bi translated">米开朗基罗为优步不同部门的数百个机器学习场景提供了动力。例如，Uber Eats使用在米开朗基罗上运行的机器学习模型来对餐厅推荐进行排名。同样，优步应用程序中令人难以置信的精确估计到达时间(ETA)是使用米开朗基罗上运行的令人难以置信的复杂机器学习模型计算的，这些模型可以逐段估计ETA。</p><p id="9c0b" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mr ln lo lp ms lr ls lt mt lv lw lx ly im bi translated">为了在数十个数据科学团队和数百个模型之间实现这种级别的可扩展性，米开朗基罗需要提供一个非常灵活和可扩展的架构以及相应的工程流程。米开朗基罗的第一个版本是在2015年部署的，三年后，数百个机器学习模型之后，优步学到了一些重要的经验。</p><h1 id="3a2c" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">1-培训需要自己的基础设施</h1><p id="53a2" class="pw-post-body-paragraph lc ld it lf b lg nm ju li lj nn jx ll mr no lo lp ms np ls lt mt nq lw lx ly im bi translated">如果您正在构建一个单一的模型，那么您很想利用相同的基础设施和工具来进行培训和开发。如果您正在构建一百个模型，这种方法是行不通的。优步的米开朗基罗使用一个名为<a class="ae ky" href="https://eng.uber.com/dsw/" rel="noopener ugc nofollow" target="_blank">数据科学工作台(DSW) </a>的专有工具集来训练跨大型GPU集群和不同机器学习工具包的模型。除了一致的基础设施，米开朗基罗的DSW抽象了机器学习训练过程的常见任务，如数据转换、模型合成等。</p><h1 id="66fc" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">2-需要监控模型</h1><p id="6530" class="pw-post-body-paragraph lc ld it lf b lg nm ju li lj nn jx ll mr no lo lp ms np ls lt mt nq lw lx ly im bi translated">借用我在这个领域的一位导师的话，“做出愚蠢预测的模型比根本不预测的模型更糟糕”。即使在训练和评估数据上表现完美的模型，在面对新数据集时也可能开始做出愚蠢的预测。从这个角度来看，模型监控和工具是现实世界机器学习解决方案的关键组成部分。优步·米开朗基罗配置机器学习模型来记录生产中的预测，然后将它们与实际情况进行比较。该过程产生一系列可用于评估模型性能的准确性度量。</p><h1 id="56ea" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">3-数据是最难得到正确的东西</h1><p id="b3ec" class="pw-post-body-paragraph lc ld it lf b lg nm ju li lj nn jx ll mr no lo lp ms np ls lt mt nq lw lx ly im bi translated">在机器学习解决方案中，数据工程师花费相当大比例的时间对数据集运行提取和转换例程，以选择随后由训练和生产模型使用的特征。米开朗基罗简化这一过程的方法是建立一个公共特征库，允许不同的团队在他们的模型中共享高质量的特征。类似地，米开朗基罗提供了监测工具来评估特定的特征。</p><h1 id="492f" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">4-机器学习应该作为软件工程过程来衡量</h1><p id="26c3" class="pw-post-body-paragraph lc ld it lf b lg nm ju li lj nn jx ll mr no lo lp ms np ls lt mt nq lw lx ly im bi translated">我知道这听起来微不足道，但远非如此。大多数组织将他们的机器学习工作与其他软件工程任务分离开来。诚然，很难将传统的敏捷或瀑布式流程应用于机器学习解决方案，但有大量的软件工程实践与机器学习世界相关。优步坚持机器学习是一个软件工程过程的观点，并为米开朗基罗提供了一系列工具来执行机器学习模型的正确生命周期。</p><p id="d1ef" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mr ln lo lp ms lr ls lt mt lv lw lx ly im bi translated">版本控制、测试或部署是优步的米开朗基罗严格执行的软件工程的一些方面。例如，一旦米开朗基罗认识到模型就像一个编译的软件库，它就会在一个严格的版本控制系统中跟踪模型的训练配置，就像你对库的源代码进行版本控制一样。同样，米开朗基罗运行全面的测试套件，在将模型部署到生产环境之前，根据维持数据集评估模型，以验证它们的正确功能。</p><h1 id="ccb6" class="mu mv it bd mw mx my mz na nb nc nd ne jz nf ka ng kc nh kd ni kf nj kg nk nl bi translated">5-自动化优化</h1><p id="f5be" class="pw-post-body-paragraph lc ld it lf b lg nm ju li lj nn jx ll mr no lo lp ms np ls lt mt nq lw lx ly im bi translated">在机器学习解决方案中，微调和优化超参数是一项永无止境的任务。很多时候，数据科学工程师花在寻找正确的超参数配置上的时间比构建模型本身还要多。为了应对这一挑战，优步的米开朗基罗推出了一款名为AutoTune的优化即服务工具，它使用最先进的黑盒贝叶斯优化算法来更有效地搜索一组最佳超参数。米开朗基罗的AutoTune的想法是使用机器学习来优化机器学习模型，让数据科学工程师将更多的时间集中在模型的实施上，而不是优化上。</p><p id="cf60" class="pw-post-body-paragraph lc ld it lf b lg lh ju li lj lk jx ll mr ln lo lp ms lr ls lt mt lv lw lx ly im bi translated">从机器学习的角度来看，优步可以被认为是世界上最丰富的实验室环境之一。优步数据科学家所处理任务的规模和复杂程度在业内首屈一指。米开朗基罗的前三年运营无疑表明，实现大规模的机器学习解决方案仍然是一项令人难以置信的复杂工作。从米开朗基罗那里学到的经验对于开始机器学习之旅的组织来说是一个不可思议的洞察力来源。</p></div></div>    
</body>
</html>