<html>
<head>
<title>Data Engineering Using Julia Lang</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用Julia Lang的数据工程</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/data-engineering-using-julia-lang-c2c7454b180f?source=collection_archive---------2-----------------------#2022-05-07">https://pub.towardsai.net/data-engineering-using-julia-lang-c2c7454b180f?source=collection_archive---------2-----------------------#2022-05-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><p id="dfff" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">这篇博客的目的是了解如何使用Julia Lang构建数据工程管道。网上有很多博客都在讲DE的理论，这里我就来讲代码，少理论多代码。</p><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi kl"><img src="../Images/f4fa38bfdb1ddc0d03fdc1189452dca8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eHBxarmZmlpv4MN1EpjXOg.png"/></div></div></figure><p id="80ec" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">导入必要的库和数据集</strong></p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="d54f" class="lc ld iq ky b gy le lf l lg lh">using CSV<br/>using DataFrames<br/>using Dates</span><span id="939c" class="lc ld iq ky b gy li lf l lg lh">#load the datasets into memory<br/>emp_df = CSV.read("D:\\Julia\\emp.csv", DataFrame)</span><span id="dce9" class="lc ld iq ky b gy li lf l lg lh">print(typeof(emp_df))<br/>#first()to access top 5 records<br/>first(emp_df,5)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lj"><img src="../Images/59f8d88c0e5cf17fe90c540275aababb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QuOXSo0Zyco2Zcj8TWBcmw.png"/></div></div></figure><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="1278" class="lc ld iq ky b gy le lf l lg lh">dept_df = CSV.read("D:\\Julia\\dept.csv", DataFrame)<br/>print(typeof(dept_df))<br/>first(dept_df,5)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lk"><img src="../Images/2e713532afaee4bafa47b330a138ba25.png" data-original-src="https://miro.medium.com/v2/resize:fit:978/format:webp/1*Frn0q_SDp9oImp0F_xuqXw.png"/></div></figure><p id="16c0" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">数据操作</strong></p><ol class=""><li id="6ef3" class="ll lm iq jp b jq jr ju jv jy ln kc lo kg lp kk lq lr ls lt bi translated"><strong class="jp ir">过滤记录</strong></li></ol><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="7173" class="lc ld iq ky b gy le lf l lg lh">#filter out records for deptno=30<br/>dept30=filter(row -&gt;row[“DEPTNO”] == 30,emp_df)<br/>dept30<br/>#row is a keyword in julia via we can access the column names</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lu"><img src="../Images/e256622b9f748745db91d290c9216c74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JSmeurzWzUeXOYSCVlUDeA.png"/></div></div></figure><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="de98" class="lc ld iq ky b gy le lf l lg lh">#filter multiple conditions<br/>filter(row -&gt;row.SAL&gt; 500 &amp;&amp; row.SAL &lt;=1800,emp_df)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lu"><img src="../Images/b13c3a2c1f659ec61a0ed7dab901d2ec.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*hfHORiXCABrWWsLHc8vaWA.png"/></div></div></figure><p id="0b22" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">2.<strong class="jp ir">对记录进行排序</strong></p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="f7f2" class="lc ld iq ky b gy le lf l lg lh">srt_df= sort(emp_df, order(:DEPTNO, rev=false))<br/>first(srt_df,7)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi lv"><img src="../Images/f16bc892587ed18da36e50387785bbd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bU_1vamLbVAh9owLBgtNAg.png"/></div></div></figure><p id="164f" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 3。群组&amp;聚合</strong></p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="5ffe" class="lc ld iq ky b gy le lf l lg lh">#create a seperate small subset for groupby ops<br/>group_df= select(emp_df,”DEPTNO”,”SAL”)<br/>first(group_df,7)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lw"><img src="../Images/e1cc0971f920894ad6ba87c1ad8d77d5.png" data-original-src="https://miro.medium.com/v2/resize:fit:642/format:webp/1*zNgWIcItUmckjREXYbQwhg.png"/></div></figure><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="eb71" class="lc ld iq ky b gy le lf l lg lh">#groupby creates a grouped dataframe other than normal dataframe, somewhat similar to pandas groupby<br/>typeof(gd)</span><span id="c28c" class="lc ld iq ky b gy li lf l lg lh">#access group information using array indexes<br/>println(gd[1])<br/>println(gd[2])<br/>println(gd[3])</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lx"><img src="../Images/19c3ac73d40a74c7b0a1b3766baa4bed.png" data-original-src="https://miro.medium.com/v2/resize:fit:750/format:webp/1*bTkszxrk0IX_HpPECkYOSQ.png"/></div></figure><p id="8737" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir">聚合</strong></p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="829a" class="lc ld iq ky b gy le lf l lg lh">using Statistics</span><span id="8898" class="lc ld iq ky b gy li lf l lg lh">println(“sum of sal deptwise “,combine(gd, :SAL =&gt; sum))<br/>println(“ — — — — — — — — — — — — — — — — — — — — — — — “)<br/>println(“avg of sal deptwise “,combine(gd, :SAL =&gt; mean))</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi ly"><img src="../Images/f118935216b47bc42d07ae6c0c16ead2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1350/format:webp/1*kQ0HWjQJqMSJO8qUlHGgRg.png"/></div></figure><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="70f8" class="lc ld iq ky b gy le lf l lg lh">println(“max of sal deptwise “,combine(gd, :SAL =&gt; maximum))<br/>println(“ — — — — — — — — — — — — — — — — — — — — — — — “)<br/>println(“sum of sal deptwise “,combine(gd, :SAL =&gt; minimum))</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi lz"><img src="../Images/da9f8e56e87588f2431a1ae4820f1f69.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/1*XK-o10ER2eBI3LIwID7fSQ.png"/></div></figure><p id="0a67" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated"><strong class="jp ir"> 4。朱莉娅·UDFs</strong></p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="c775" class="lc ld iq ky b gy le lf l lg lh">#WAF to calculate tax of employees and add Tax as derived column in existing dataframe.<br/>#function is the keyword to write a udf</span><span id="717b" class="lc ld iq ky b gy li lf l lg lh">function taxes(sal)<br/> tax=0<br/> if sal&gt;500 &amp;&amp; sal&lt;=1250<br/> tax=sal*.125<br/> elseif sal&gt;1250 &amp;&amp; sal&lt;=1750<br/> tax=sal*.175<br/> elseif sal&gt;1750 &amp;&amp; sal&lt;=2500<br/> tax=sal*.225<br/> elseif sal&gt;2500<br/> tax=sal*.25<br/> else<br/> tax=0<br/> end<br/>end</span><span id="599e" class="lc ld iq ky b gy li lf l lg lh">#create a derived column to add calculated taxes</span><span id="17fd" class="lc ld iq ky b gy li lf l lg lh">emp_df[!, “Taxes”] = taxes.(emp_df.SAL)<br/>first(emp_df,8)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi ma"><img src="../Images/2f11185d4e586d034bc639fcb71086c8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E9RfIjXlYVnYkjS0JRwLgQ.png"/></div></div></figure><p id="fc1a" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">5.<strong class="jp ir">加入</strong></p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="721c" class="lc ld iq ky b gy le lf l lg lh">#merge the emp_df with grouped df <br/>agg_df= innerjoin(emp_df,grp_df, on= :DEPTNO)<br/>first(agg_df,10)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mb"><img src="../Images/e901a3e320ea2d025d4db6d2bf5f72cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cbpOVxiWG4y8jAmzLvLk1A.png"/></div></div></figure><p id="dce5" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">对数据框执行SQL like select并将数据集写入CSV文件:</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="0cfe" class="lc ld iq ky b gy le lf l lg lh">CSV.write("D:\\Julia\\empagg_out.csv", <br/>    select(agg_df, "EMPNO", "ENAME", "SAL", "COMM", "DEPTNO","Taxes","SAL_sum" =&gt; "SalSum"))</span></pre><p id="78b2" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">连接员工和部门数据集</p><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="da8d" class="lc ld iq ky b gy le lf l lg lh">inner_df= innerjoin(emp_df,dept_df, on= :DEPTNO)<br/>first(inner_df,8)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div role="button" tabindex="0" class="kr ks di kt bf ku"><div class="gh gi mc"><img src="../Images/b7d40d410a1e0aaf7bf94aefbeaa4d40.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_SZlLMx3Miq5UFbzoPksLw.png"/></div></div></figure><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="fe19" class="lc ld iq ky b gy le lf l lg lh">out_df=select(inner_df,”EMPNO”,”ENAME”,”SAL”,”COMM”,”DEPTNO”,”DNAME”)<br/>first(out_df,8)</span></pre><figure class="km kn ko kp gt kq gh gi paragraph-image"><div class="gh gi md"><img src="../Images/687d2181a6a17e34632fbde39bfb4fbe.png" data-original-src="https://miro.medium.com/v2/resize:fit:1392/format:webp/1*7hXcMsyLkfNvTYwpV1K90Q.png"/></div></figure><pre class="km kn ko kp gt kx ky kz la aw lb bi"><span id="69d4" class="lc ld iq ky b gy le lf l lg lh">CSV.write(“D:\\Julia\\empd_out.csv”, out_df)</span></pre><h1 id="b4a3" class="me ld iq bd mf mg mh mi mj mk ml mm mn mo mp mq mr ms mt mu mv mw mx my mz na bi translated">总结:</h1><p id="149b" class="pw-post-body-paragraph jn jo iq jp b jq nb js jt ju nc jw jx jy nd ka kb kc ne ke kf kg nf ki kj kk ij bi translated">读取CSV数据集</p><p id="e698" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">数据操作:筛选、排序、分组、聚合、连接。</p><p id="9b58" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">UDF和派生列。</p><p id="b042" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">将Julia数据帧写入CSV文件</p><p id="f7ba" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">感谢所有阅读我的博客的人，如果你喜欢我的内容和解释，请在媒体上关注我并分享你的反馈，这将永远帮助我们所有人提高我们的知识。</p><p id="7f69" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">谢谢</p><p id="a2d3" class="pw-post-body-paragraph jn jo iq jp b jq jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki kj kk ij bi translated">Vivek Chaudhary</p></div></div>    
</body>
</html>