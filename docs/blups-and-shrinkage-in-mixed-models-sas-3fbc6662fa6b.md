# 混合模型中的凸起和收缩

> 原文：<https://pub.towardsai.net/blups-and-shrinkage-in-mixed-models-sas-3fbc6662fa6b?source=collection_archive---------1----------------------->

## [数据可视化](https://towardsai.net/p/category/data-visualization)

## 使用 SAS

混合模型是估计方差分量并使用这些估计来提供预测的一个很好的工具。来自混合模型的预测被称为[最佳线性无偏预测](https://en.wikipedia.org/wiki/Best_linear_unbiased_prediction) (BLUP)，之所以这么叫是因为它们包含了模型的固定和随机效应来提供预测。

通过包括固定和随机效应，混合模型允许一种被称为“T4 收缩”或部分池化的技术，这限制了过度拟合的可能性。简而言之，当一个混合模型被制作出来时，固定效应是在所有的观察中被估计的，但是随机部分是在每个水平上被完成的。

因此，如果你有 100 个人的不同时间的观察，你可以要求模型为这 100 个人中的每个人估计不同的截距和不同的斜率(轨迹)。现在，您有多个建模选项:

1.  你用一个线性回归模型来拟合所有的观察数据。这被称为汇集模型，因为没有人的水平轨迹进行估计。只有一个截距和一个斜率。
2.  分别对每个观察值拟合一个线性回归模型。现在，你已经分别估计了每人 100 个截距和 100 个斜率。这相当于将数据集分成 100 个部分。没有人知道其他 99 人的存在。
3.  你符合混合模型。固定截距和斜率效应是全局的，但是您也可以估计一个依赖于个人的截距和斜率。为了实现这样的脚，曲线的起点和轨迹都需要有足够的变化。估计随机部分的方式称为部分混合，因为该形式遵循正态分布[0，方差]。在这里，每个特定的随机效应是由人口效应和个人特定的偏差决定的。为了应对过度拟合，最远离总体平均值的估计值被收缩回零，因为我们认为它们更像是异常值。如果我们不这样做，随机效应的方差估计就会爆炸。

现在，在这个例子中，使用 SAS，我将向您展示我如何在包含 129 头公猪在 4 个时间点测量的精液体积的数据集上比较混合、非混合和各种部分混合模型。

让我们加载数据并可视化。

![](img/79fa33b47cbe1e97ccc523474ae8cac0.png)![](img/f1f6f416c73ec00ea2d13ac9a85ed641.png)![](img/cae3dd84b4ea7341438d8add80645386.png)![](img/d2c1a3498f2c913254c13282bc4fc8c8.png)

我在寻找足够的变化来保证估计随机效应。

让我们从一个未合并的二次模型开始。

![](img/a13a14689bcf48e36b8f7973ec611c6e.png)![](img/e9a0b9249ecdd790b2060cc00af82c98.png)

这些图清楚地显示了左边的观察值是如何被预测值紧紧跟随的。尽管像 R 平方这样的标准统计学不同意，但这样的模型非常危险地接近过度拟合。对于这些统计数据，一个未合并的模型会急切地跟随观察结果，因此非常接近。

池模型的代码。

![](img/f96d31dd501e176256589e2d45d21667.png)

混合模型进行混合估计。对这个模型来说，变异只是无法解释的变异。您可以预期截距、斜率和二次斜率的标准误差会激增。

在运行一个混合模型之前，你可以看一下非混合模型的公猪特定估计值是否偏离混合模型的估计值。这不是混合模式的替代品。这里没有发生部分合并。

![](img/9fa57e9d6007cf15d6c702862d96f62e.png)

截距和斜率无疑暗示了与总体平均值的偏差。在公猪水平，二次斜率似乎没有移动那么多。因此，该图暗示了随机截距随机斜率模型。

让我们看看不同随机模型的不同估计。你会看到一个非集合模型，一个随机截距模型，一个随机截距随机斜率模型和一个随机截距随机斜率模型。后者意味着我想看看线性和二次斜率在公猪水平上是否不同。

![](img/275b4a2ca56ee337e97da61608d25731.png)

截距模型似乎显示，在非混合模型和混合模型中，总体均值波动较大。与非混合模型相比，混合模型并没有真正认识到斜率的变化。总的来说，混合模型是一种更复杂的工具，可以提取任何随机成分的必要性。

运行五种模型的代码。

![](img/eb0b310a5b7992d69686a1de22de3bd5.png)![](img/a7f02b3e47608626a938445bcf5952d1.png)![](img/03a99ddaaa018dc1ad320f6143788921.png)![](img/160f2ecf06780c22c635af8c94f3236c.png)![](img/dce411a25fe3bc38915119b943d5ca9d.png)

五种模型中每一种的全局固定和随机效应。如你所见，最后一个模型没有收敛。不应使用随机效应的统计检验。而是使用图表，如下所示。

![](img/94645ae0cd0b5bcc9a6a0650a8a8eb0c.png)![](img/9aad304f50c24319e5dcde5528161b31.png)

左边的图表显示了每种模型给表格带来了什么。虽然他们倾向于预测得很好，但总体来说，他们的限制根据所包含的内容有很大的不同。混合模型的低置信度和预测极限是自相矛盾的，除非您意识到该模型被要求估计总体均值。集合模型就是为此而生的。在右边，你可以清楚地看到每个模型是如何“思考”的。非混合模型提供了公猪特定的固定估计值，而混合模型仅提供了一个总体估计值。随机截距和随机截距月都提供了缩小的预测。可以清楚地看到，他们不属于极端的观察。因此，通过收缩限制了过度配合。

![](img/7530a2d46b892ce5058541158b1c49d2.png)![](img/c71ed398060b9fba2b98c82d4260d840.png)

来自非混合和混合模型的公猪特定估计值。由于轴的变化，这些图表比较起来有点困难，但它们描述了相同的数据，显示截距处的变化量很大，但斜率处的变化量较小。他们还显示了应用于公猪特定截距的收缩——混合模型中的置信限比非混合模型中的置信限小得多。

下面，您可以看到一些额外的代码片段，以便更深入地了解所创建的特定混合模型。它们不容易使用，并且经常导致不收敛或者矩阵不确定。如果出现这样的警告，您需要简化模型。

![](img/81db1e0d6a4a4055ff41e05bd3da6ef3.png)![](img/603c59be0ef26c1ae4021f4fd5c2cff9.png)![](img/a825865c4cb5163e892128088ae2e4a8.png)![](img/37a1ce1edacf1973f0f333c71f3ee257.png)![](img/08132387f5d310066970b6fcfee31d06.png)![](img/9c41c4416f6372657771e38eb27971a3.png)![](img/6e3284a184581bf1e7ae47125436b1e2.png)![](img/82a8eea0c754df0ee78afde0bf93b844.png)![](img/be1c455de2108e4bbd93bec283e6eee5.png)![](img/5b5309d4da92e8bf413c06dad03a98eb.png)![](img/69752def17cbe04866fe7d7cab9fc4e6.png)![](img/ac039d3a127c5832431d1cac964e1033.png)

这些图显示了是否满足随机效应的正态性假设，其中包含随机效应是有意义的，以及随机效应内的估计值变化的频率。后半部分会给你一个很好的提示，告诉你应用的收缩级别。

![](img/540d1f2d22497b569f6955652323224b.png)![](img/94ddd746d105969d47a9510acf287f2b.png)![](img/8c6901b56a92843cbf8a0362dfe5b404.png)

我总是喜欢查看混合模型为数据集中包含的每个级别提供的预测，在这里，这将是:总计、月份、动物。正如你在动物层面的预测中看到的，边缘预测(绿线)是不好的。

我希望这篇文章能让你对虚张声势和缩水有更多的了解。如果你有问题，有想法，或者只是想切磋，请联系我！