<html>
<head>
<title>Extract Text from Long Videos with Python</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">用Python从长视频中提取文本</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/extract-the-text-from-long-videos-with-python-81d30d655cfd?source=collection_archive---------1-----------------------#2020-12-13">https://pub.towardsai.net/extract-the-text-from-long-videos-with-python-81d30d655cfd?source=collection_archive---------1-----------------------#2020-12-13</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="7acd" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/nlp" rel="noopener ugc nofollow" target="_blank">自然语言处理</a></h2><div class=""/><div class=""><h2 id="4325" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">使用Google API构建语音识别器的简单指南</h2></div><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi kr"><img src="../Images/288897e7a0af473cba101f12258bd756.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*rlxXcTLvKS-cbHz6.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图1:<a class="ae lh" href="https://pixabay.com/" rel="noopener ugc nofollow" target="_blank">图片箱</a>上的照片</figcaption></figure><p id="4544" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">语音识别是一项有趣的任务，可以让您提高生活质量。在这个永无止境的Covid时期，我需要观看许多课程的视频，很容易失去注意力。与此同时，在我的大学网站上可以看到所有注册信息的可能性让我成为了一个完美主义者，所以我想把每一个字都记下来。但是它的成本很高，因为它需要大量的工作和窃取时间。</p><p id="5df1" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">幸运的是，已经有API资源可用，如<a class="ae lh" href="https://cloud.google.com/speech-to-text/" rel="noopener ugc nofollow" target="_blank">谷歌</a>、<a class="ae lh" href="https://aws.amazon.com/it/transcribe/" rel="noopener ugc nofollow" target="_blank">亚马逊</a>、<a class="ae lh" href="https://azure.microsoft.com/en-us/services/cognitive-services/speech-to-text/" rel="noopener ugc nofollow" target="_blank"> IBM </a>和许多其他资源，它们提供将音频转换成文本的服务。在本文中，我将只关注<strong class="lk jd">谷歌语音转文本API </strong>，我认为它是转录许多视频的最有效的应用程序。我将使用Python创建一个语音识别模型，将视频文件转换为文本格式。</p><p id="1428" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">谷歌语音转文本API </strong></p><p id="1440" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">Google语音转文本提供了三种类型的API请求:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi me"><img src="../Images/03a037f11f0a7f3e6748e25ef488bc77.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gAmx1DVP4-gWzUiswEeMVg.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图2: <a class="ae lh" href="https://cloud.google.com/speech-to-text/quotas" rel="noopener ugc nofollow" target="_blank">信用:谷歌语音转文本的限制</a></figcaption></figure><ul class=""><li id="3176" class="mf mg it lk b ll lm lo lp lr mh lv mi lz mj md mk ml mm mn bi translated">在<strong class="lk jd">同步请求</strong>中，音频文件内容应该约为1分钟。在这种类型的请求中，您不需要将数据上传到Google cloud。<strong class="lk jd">我将集中讨论这种类型的请求</strong>。</li><li id="17cb" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md mk ml mm mn bi translated">在<strong class="lk jd">异步请求</strong>中，音频文件应该约为480分钟。在这种类型的请求中，您需要将他们的数据上传到Google cloud。</li><li id="227a" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md mk ml mm mn bi translated"><strong class="lk jd">流请求</strong>适用于当您直接对着麦克风说话并需要实时转录数据时的流数据。</li></ul><p id="8deb" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">对于语音转文本，您需要了解的当前API使用限制是:</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi mt"><img src="../Images/2bbeb9ce616fb6339487da8eeeaa0cc7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WbPfnPWBA4p2Krk1KxCehw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图3: <a class="ae lh" href="https://cloud.google.com/speech-to-text/quotas" rel="noopener ugc nofollow" target="_blank">信用:谷歌语音转文本的限制</a></figcaption></figure><p id="7c23" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">该表显示，每天有480小时音频的<strong class="lk jd">限制，而每60秒的“<strong class="lk jd">流识别</strong>请求的最大数量是900。每天有这么多时间把音频转换成文本<strong class="lk jd"/>是不是很神奇？尤其是<strong class="lk jd">免费</strong>的时候！如果不使用python尝试其他API或标准方法就不那么明显了。</strong></p><h1 id="f1b8" class="mu mv it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated">第一步:从网站下载视频</h1><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nm"><img src="../Images/f1e3a556a91c1530e4b1110214961a89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*QFX2Q0Ry_w7o6Ww0HVT01w.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图4:信用:<a class="ae lh" href="https://chrome.google.com/webstore/detail/video-downloadhelper/lmjnegcaeklhafolokijcfjliaokphfk?hl=it" rel="noopener ugc nofollow" target="_blank">视频下载助手</a></figcaption></figure><p id="61fe" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我从我大学的网站上下载了一个视频，有一个Chrome扩展叫<strong class="lk jd"> <em class="nn">视频下载助手</em> </strong>。并不是所有需要的操作都可以在浏览器内进行，所以我安装了一个名为<a class="ae lh" href="https://www.downloadhelper.net/install-coapp" rel="noopener ugc nofollow" target="_blank"> <strong class="lk jd"> <em class="nn">的外部app配套应用</em> </strong> </a>。如果您不是高级用户，视频的下载只能在上一个视频的120分钟后进行。</p><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi no"><img src="../Images/a8a8980326c737fe5cfc97e3671f9a74.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zPjkizAusI0ZlcemQGU1fw.png"/></div></div><figcaption class="ld le gj gh gi lf lg bd b be z dk translated">图5:视频下载助手</figcaption></figure><h1 id="1099" class="mu mv it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated">步骤2:将库导入到Jupiter笔记本中</h1><p id="a266" class="pw-post-body-paragraph li lj it lk b ll np kd ln lo nq kg lq lr nr lt lu lv ns lx ly lz nt mb mc md im bi translated">让我们安装我们将在这个程序中使用的库。</p><p id="55fd" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd"> SpeechRecognition </strong>是一个Python库，用于执行支持谷歌API的语音识别，而<strong class="lk jd"> moviepy </strong>允许剪切、读取和写入所有最常见的音频和视频格式。而且moviepy支持多种文件格式:<strong class="lk jd">。ogv </strong>，<strong class="lk jd"> .mp4 </strong>，<strong class="lk jd">。mpeg </strong>，<strong class="lk jd">。avi </strong>，<strong class="lk jd">。mov </strong>。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="b3b2" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">一旦我们安装了库，我们就可以导入它们:</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><h1 id="cf49" class="mu mv it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated"><strong class="ak">步骤3:将视频文件切割成1分钟的大块，并将每个大块转换成文本格式</strong></h1><p id="9930" class="pw-post-body-paragraph li lj it lk b ll np kd ln lo nq kg lq lr nr lt lu lv ns lx ly lz nt mb mc md im bi translated">对我来说，视频格式为. mp4，时长52分钟。变量<strong class="lk jd"> num_seconds_video </strong>包含我的视频的秒数。在我创建了一个用于将视频文件切割成特定数量的块的列表之后，它需要用于视频片段的开始和结束时间。关于这个概念的更多细节将在后面解释。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi nw"><img src="../Images/8b2a2bd21347e1e0ebbbe7bfadf4b98b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yZnBz5y0NW0KWKM1Fm4NRg.png"/></div></div></figure><p id="a4d8" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">此外，我创建了一个空字典diz，其中的键是字符串“chunk#”，值是从该块中提取的文本。在for循环中，我将把每一段视频转换成文本格式。</p><p id="d821" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated"><strong class="lk jd">注意</strong>:在运行for迭代之前，我创建了一个<strong class="lk jd">文件夹【chunks】</strong>包含视频的所有切片，以及一个<strong class="lk jd">文件夹【converted】</strong>将视频的所有切片转换成wav格式。如果不想满档的话建议你去做。</p><ol class=""><li id="5054" class="mf mg it lk b ll lm lo lp lr mh lv mi lz mj md nx ml mm mn bi translated">基于初始文件“<strong class="lk jd">videorl.mp4</strong>”创建一个新的视频文件，该文件将在初始时间和结束时间(以秒为单位)之间剪切。例如，第一个块在0秒和60秒之间，第二个块在58秒和120秒之间，第三个块在118秒和180秒之间，依此类推，直到我到达3058秒和3120秒之间的最后一个块。<strong class="lk jd">为了不丢失重要的单词，组块重叠2秒</strong>。使用的函数是<strong class="lk jd"> ffmpeg_extract_subclip( <em class="nn">文件名</em>、<em class="nn"> t1 </em>、<em class="nn"> t2 </em>、<em class="nn">目标名</em> ) </strong></li><li id="ac18" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md nx ml mm mn bi translated">使用功能<strong class="lk jd">video file clip(<em class="nn">filename</em>)</strong>导入上一步创建的新音频文件</li><li id="82ab" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md nx ml mm mn bi translated">将mp4文件转换成<strong class="lk jd"> wav格式</strong>，与谷歌的API配合更好</li><li id="c8b9" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md nx ml mm mn bi translated">创建<strong class="lk jd">识别器</strong>实例</li><li id="252f" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md nx ml mm mn bi translated">导入格式为wav的音频文件</li><li id="b522" class="mf mg it lk b ll mo lo mp lr mq lv mr lz ms md nx ml mm mn bi translated">使用<strong class="lk jd"> Google的云语音转文本API </strong>从wav格式的音频文件中提取文本。</li></ol><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><figure class="ks kt ku kv gt kw gh gi paragraph-image"><div role="button" tabindex="0" class="kx ky di kz bf la"><div class="gh gi ny"><img src="../Images/37b4c017631880b98d9cdc7234c49759.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*taEUw_A3GlT6P44LeCMeyQ.png"/></div></div></figure><h1 id="ff2c" class="mu mv it bd mw mx my mz na nb nc nd ne ki nf kj ng kl nh km ni ko nj kp nk nl bi translated">步骤5:将结果导出到文本文档中</h1><p id="3733" class="pw-post-body-paragraph li lj it lk b ll np kd ln lo nq kg lq lr nr lt lu lv ns lx ly lz nt mb mc md im bi translated">作为最后一项任务，我们将创建一个独特的文本文件，它将包含所有块的文本。</p><p id="379b" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">我创建了一个列表，只包含从每个视频片段中提取的文本。在我用字符串分隔符“\n”连接列表的每个元素之后，那就是换行符。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure><p id="016f" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">最后，我创建了这个文件，它包含了所有的视频文本。</p><figure class="ks kt ku kv gt kw"><div class="bz fp l di"><div class="nu nv l"/></div></figure></div><div class="ab cl nz oa hx ob" role="separator"><span class="oc bw bk od oe of"/><span class="oc bw bk od oe of"/><span class="oc bw bk od oe"/></div><div class="im in io ip iq"><p id="f247" class="pw-post-body-paragraph li lj it lk b ll lm kd ln lo lp kg lq lr ls lt lu lv lw lx ly lz ma mb mc md im bi translated">恭喜你！您获得了视频文本，或者代码仍在运行。如果文件很大，最后一种情况是正常的。不算太快，但至少你可以同时看网飞。最后，你将获得你的文本转录。它不会很完美，会因为两个组块之间2秒的重叠技巧而出现一些多余的单词，但我认为这是比松散信息更好的解决方案。我希望你喜欢这个指南，并发现它很有用。代码在<a class="ae lh" href="https://github.com/eugeniaring/Medium-Articles/blob/main/NLP/extractlog.py" rel="noopener ugc nofollow" target="_blank"> Github </a>上。</p></div></div>    
</body>
</html>