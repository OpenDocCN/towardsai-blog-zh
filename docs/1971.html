<html>
<head>
<title>Hands-on Introduction to MLflow With a Toy BMI Example</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">以玩具身体质量指数为例实际介绍MLflow</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/hands-on-introduction-to-mlflow-with-a-toy-bmi-example-9c6ff11a6f3f?source=collection_archive---------3-----------------------#2021-07-07">https://pub.towardsai.net/hands-on-introduction-to-mlflow-with-a-toy-bmi-example-9c6ff11a6f3f?source=collection_archive---------3-----------------------#2021-07-07</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="f981" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">以前所未有的方式跟踪您的ML模型</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1a4e8b6090a56fea9259eb8eeed1eda1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2MQo5zYObFVmwYde_eW45A.jpeg"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">在<a class="ae kv" href="https://unsplash.com/s/photos/trekking?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上由<a class="ae kv" href="https://unsplash.com/@toomastartes?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">香椿果</a>拍摄的照片</figcaption></figure><h1 id="0c35" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">直觉</h1><p id="2334" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">想象一下，你是一个陆地导航小组的组长，徒步沿着一条不熟悉的路线行进。</p><p id="6ad3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">你会做什么来追踪你正在走的路？你可以用石头和棍子来标记某些地标。这可以帮助你的团队记住你到达目的地的路线。这也可以帮助其他陆地导航队找到他们的路。</p><p id="fe38" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">所有这些与mlflow有什么关系，ml flow实际上是一个机器学习生命周期管理的框架？</p><h1 id="b95c" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">什么是MLflow？</h1><p id="6ffa" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">我就开门见山吧！就像你在不知道路线和跟踪你遵循的路径的情况下进行陆地导航一样，mlflow允许你跟踪你在机器学习或深度学习项目的生命周期中执行的所有“盲目”实验。</p><p id="99b3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">听起来有趣吗？</p><p id="6996" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">让我们进一步了解Mlflow提供的不同组件和功能。</p><p id="2c4d" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">MLflow框架有3个组件:</p><ol class=""><li id="4bec" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated">MLflow跟踪:这允许您跟踪和查询实验中的参数、度量、模型和分数。</li><li id="c663" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">MLflow项目:这个特性允许您通过将实验打包成一个配置文件来定义如何运行实验。</li><li id="8780" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">MLflow模型:这是一种打包模型的格式。</li></ol><p id="eb91" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在本文中，我将向您展示两个玩具示例，使用它们您可以立即开始跟踪您的实验，而无需经历任何进一步的学习曲线。</p><h1 id="006f" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">密码</h1><p id="9b89" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">所有相关的代码都可以从我的<a class="ae kv" href="https://github.com/vvrahul11/blog_posts_code/tree/main/mlflow_beginner" rel="noopener ugc nofollow" target="_blank"> Github库</a>中获得。</p><h1 id="79d8" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">装置</h1><p id="1cf3" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">克隆存储库并转到根目录以安装所需的软件包。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="8507" class="ni kx iq ne b gy nj nk l nl nm">pip install requirements.txt</span></pre><h2 id="7f0e" class="ni kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated">跟踪身体质量指数计算实验</h2><p id="b550" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在第一个玩具示例(非机器学习)中，让我们看看如何跟踪一个实验，以计算给定身高和体重的人的身体质量指数。我们还将提供这些人的姓名和年龄作为输入，我们有兴趣计算他们的身体质量指数。</p><p id="d887" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在下面的代码中，我们有三个人，鲍勃、利塔尔和新美乐股份公司，年龄分别为18岁、32岁和44岁。</p><p id="1823" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">他们的身高和体重如下:鲍勃(150cm，55kg)，利塔尔(165cm，80kg)，新美乐股份公司(172cm，100kg)。</p><p id="f8fe" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们希望计算每个人的身体质量指数，并跟踪与这3个人相关的所有信息。</p><p id="62a0" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我们将利用MLflow提供的3个特性来实现这一点。</p><ol class=""><li id="3458" class="mp mq iq lq b lr mk lu ml lx mr mb ms mf mt mj mu mv mw mx bi translated">set_tag:这允许你设置一个标签。</li><li id="0854" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">log_param:这允许您跟踪参数。</li><li id="9eb6" class="mp mq iq lq b lr my lu mz lx na mb nb mf nc mj mu mv mw mx bi translated">log_metric:这允许您跟踪指标。</li></ol><p id="e441" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">现在我们已经准备好了数据和工具，让我们直接进入下面的代码。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="3a04" class="ni kx iq ne b gy nj nk l nl nm">import mlflow<br/><br/>def calculate_bmi(height, weight):<br/>    """ Function to calculate the BMI<br/><br/>    Args:<br/>        height ([float]): [height of a person]<br/>        weight ([folat]): [weight of a person]<br/>    """<br/>    return weight / (height/100)**2<br/><br/><br/><br/>if __name__ == "__main__":<br/><br/>    names = ['Bob', 'Lital', 'Simona']<br/>    ages = [18, 32, 44]<br/>    heights = [150, 165, 172]<br/>    weights = [55, 80, 100]<br/><br/><br/>    for i, (height, weight) in enumerate(zip(heights, weights)):   <br/>        <br/>        with mlflow.start_run(run_name = names[i]):<br/>            print(names[i], ages[i], height, weight,   calculate_bmi(height, weight))<br/>            <br/>            mlflow.set_tag('age', ages[i])   <br/>            mlflow.log_param('height', height)<br/>            mlflow.log_param('weight', weight)<br/>            mlflow.log_metric("bmi", calculate_bmi(height, weight))</span></pre><p id="4628" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">在上面的代码中，我们遍历每个人的身高和体重，并使用“set_tag”和“log_param”跟踪相应的信息。</p><p id="66e4" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">此外，我们使用“calculate_bmi”函数调用计算人的身体质量指数，并使用log_metric跟踪身体质量指数输出。</p><p id="861b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">运行get完成后，进入包含上述代码示例的存储库，在终端窗口中键入“mlflow ui”。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/73f49b462119866eec9f563d271869ad.png" data-original-src="https://miro.medium.com/v2/resize:fit:502/format:webp/1*_BDJN5RVBT7VR7MsOn7HvA.png"/></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者形象</figcaption></figure><p id="3d89" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">上述命令将产生以下输出:</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="7bff" class="ni kx iq ne b gy nj nk l nl nm">INFO:waitress:Serving on http://localhost:5000</span></pre><p id="af10" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你点击ml flow<a class="ae kv" href="http://localhost:500" rel="noopener ugc nofollow" target="_blank">http://localhost:500</a>0的服务地址，你将能够看到你为每个人的身体质量指数所做的实验。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/d50bbe036c3b15dfc9f3d4ec3ddff11f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DsGmeL_Lo5hN0YtlahOn5A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者形象</figcaption></figure><p id="4f21" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如您所见，我们跟踪了“跑步名称”、“身高”、“体重”、“bmi”和“标签”。您可以进一步点击每一次运行，了解MLflow提供的所有功能。</p><p id="9a3f" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">听起来很酷吗？如果是的话，让我们跳到我们的第二个玩具例子，这是一个真实的机器学习例子。</p><h2 id="d30e" class="ni kx iq bd ky nn no dn lc np nq dp lg lx nr ns li mb nt nu lk mf nv nw lm nx bi translated">跟踪分类模型实验</h2><p id="f44a" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated">在这里，我在玩具数据集上使用逻辑回归和支持向量机建立了两个分类模型。我还将跟踪run_name、metric和model。</p><p id="86fc" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">我将跳过对下面代码的解释，假设你已经熟悉机器学习，并能理解下面的代码。总之，我们正在构建两个分类模型，并跟踪指标和模型。</p><pre class="kg kh ki kj gt nd ne nf ng aw nh bi"><span id="b057" class="ni kx iq ne b gy nj nk l nl nm">import numpy as np<br/>from sklearn.linear_model import LogisticRegression<br/>from sklearn import svm<br/><br/>import mlflow<br/>import mlflow.sklearn<br/><br/>def logistic_regression(X, y):<br/>    """ <br/>    Build a logistic regression model<br/>    """<br/>    lr = LogisticRegression()<br/>    lr.fit(X, y)<br/>    score = lr.score(X, y)<br/>    print("Score: %s" % score)<br/>    return lr, score<br/><br/>def support_vector_machine(X, y):<br/>    """ <br/>    Build a support vector classification model<br/>    """<br/>    svc = svm.SVC()<br/>    svc.fit(X, y)<br/>    score = svc.score(X, y)<br/>    print("Score: %s" % score)<br/>    return svc, score<br/><br/><br/>if __name__ == "__main__":<br/>    <br/>    X = np.array([10, 20, 200, 250, 300, 30]).reshape(-1, 1)<br/>    y = np.array([0, 0, 1, 1, 1, 0])<br/>    <br/>    lr_model, lr_score = logistic_regression(X, y)    <br/>    svc_model, svc_score = support_vector_machine(X, y)<br/><br/>    models = [lr_model, svc_model]<br/>    scores = [lr_score, svc_score]<br/>    model_names = ["Logistic regression", "Support vector machine"]<br/>    <br/>    for i, (model, score) in enumerate(zip(models, scores)):   <br/>        with mlflow.start_run(run_name = model_names[i]):<br/>            mlflow.log_metric("score", score)<br/>            mlflow.sklearn.log_model(model, "model")<br/>            print("Model saved in run %s" % mlflow.active_run().info.run_uuid)</span></pre><p id="f538" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">上述跟踪的结果可以通过访问<a class="ae kv" href="http://localhost:5000" rel="noopener ugc nofollow" target="_blank"> http://localhost:5000 </a>获得。</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/79dedf30d1d99ebe413152a6f353823f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*x-K1wT6Hq-uFv5wPI3lM4A.png"/></div></div><figcaption class="kr ks gj gh gi kt ku bd b be z dk translated">作者形象</figcaption></figure><p id="678b" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">你可以通过浏览他们的文档<a class="ae kv" href="https://mlflow.org/docs/latest/index.html" rel="noopener ugc nofollow" target="_blank">这里</a>来探索MLflow所有可用的特性。</p></div><div class="ab cl oa ob hu oc" role="separator"><span class="od bw bk oe of og"/><span class="od bw bk oe of og"/><span class="od bw bk oe of"/></div><div class="ij ik il im in"><p id="9681" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你喜欢我的文章，请继续关注，我计划写一些关于数据科学、问题解决和成功心理学的主题。</p><p id="84e3" class="pw-post-body-paragraph lo lp iq lq b lr mk jr lt lu ml ju lw lx mm lz ma mb mn md me mf mo mh mi mj ij bi translated">如果你想联系，请在Linkedin 上加我。</p><h1 id="4b62" class="kw kx iq bd ky kz la lb lc ld le lf lg jw lh jx li jz lj ka lk kc ll kd lm ln bi translated">参考</h1><p id="8991" class="pw-post-body-paragraph lo lp iq lq b lr ls jr lt lu lv ju lw lx ly lz ma mb mc md me mf mg mh mi mj ij bi translated"><a class="ae kv" href="https://mlflow.org/" rel="noopener ugc nofollow" target="_blank">https://mlflow.org/</a></p></div></div>    
</body>
</html>