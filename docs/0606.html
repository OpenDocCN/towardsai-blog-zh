<html>
<head>
<title>Using Torchmoji with Python and Deep Learning</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">将Torchmoji与Python和深度学习结合使用</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/using-torchmoji-with-python-and-deep-learning-3fefee62c9a1?source=collection_archive---------1-----------------------#2020-06-20">https://pub.towardsai.net/using-torchmoji-with-python-and-deep-learning-3fefee62c9a1?source=collection_archive---------1-----------------------#2020-06-20</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><h2 id="6813" class="ir is it bd b dl iu iv iw ix iy iz dk ja translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning/deep-learning" rel="noopener ugc nofollow" target="_blank">深度学习</a></h2><div class=""/><div class=""><h2 id="f76b" class="pw-subtitle-paragraph jz jc it bd b ka kb kc kd ke kf kg kh ki kj kk kl km kn ko kp kq dk translated">利用深度学习将文本转换为表情符号。在我的Github库有完整的代码<a class="ae kr" href="https://github.com/arditoibryan/Projects/blob/master/20200618_torchMoji/torchMoji.ipynb" rel="noopener ugc nofollow" target="_blank">。</a></h2></div><p id="d2dc" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">一直很难找到关于如何使用Python来使用臭名昭著的DeepMoji的教程。在我的笔记本上尝试了几次，出现了几次错误之后，我放弃了，决定使用Keras: torchMoji训练的替代版本。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi lo"><img src="../Images/84488bc487dfcbefe2b69400b00961f3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*l4CjFHOAHKAP4nEPAtKUuA.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">脸书表情符号</figcaption></figure><p id="1e42" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">事实上，我还没有找到一个关于如何将文字转换成表情符号的教程。你很幸运，这里有一个。</p><h1 id="40a8" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">装置</h1><p id="7211" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">* * *代码，不幸的是，不完全是我的，<a class="ae kr" href="https://github.com/mohammedterry/NLP_for_ML/blob/master/Sentiment_Analysis.ipynb" rel="noopener ugc nofollow" target="_blank">源代码可在此链接</a>。</p><pre class="lp lq lr ls gt nb nc nd ne aw nf bi"><span id="f88c" class="ng mf it nc b gy nh ni l nj nk">!pip3 install torch==1.0.1 -f <a class="ae kr" href="https://download.pytorch.org/whl/cpu/stable" rel="noopener ugc nofollow" target="_blank">https://download.pytorch.org/whl/cpu/stable</a> <br/>!git clone <a class="ae kr" href="https://github.com/huggingface/torchMoji" rel="noopener ugc nofollow" target="_blank">https://github.com/huggingface/torchMoji</a><br/>import os<br/>os.chdir('torchMoji')<br/>!pip3 install -e .<br/>#if you restart the package, the notebook risks to crash on a loop<br/>#I did not restart and worked fine</span></pre><p id="9622" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">代码将下载大约600 MB的数据来训练AI。我一直在用谷歌Colab。然而，我注意到<strong class="ku jd">当程序要求你重启笔记本</strong>以进行所需的更改时，它开始在一个没有补救措施的循环中崩溃。如果你能从我的错误中吸取教训，不要重启笔记本，让它去吧，它会工作的。</p><pre class="lp lq lr ls gt nb nc nd ne aw nf bi"><span id="3534" class="ng mf it nc b gy nh ni l nj nk">!python3 scripts/download_weights.py</span></pre><p id="03d1" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">这个脚本应该下载神经网络的调整。询问时，按<strong class="ku jd"> yes </strong>确认。</p><h1 id="1fb1" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">设置转换功能</h1><p id="c466" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">使用下面的函数，您将能够输入文本，作为回报，该函数将输出最有可能的n个表情符号(n待定)。</p><pre class="lp lq lr ls gt nb nc nd ne aw nf bi"><span id="954f" class="ng mf it nc b gy nh ni l nj nk">import numpy as np<br/>import emoji, json<br/>from torchmoji.global_variables import PRETRAINED_PATH, VOCAB_PATH<br/>from torchmoji.sentence_tokenizer import SentenceTokenizer<br/>from torchmoji.model_def import torchmoji_emojis<br/>  <br/>EMOJIS = ":joy: :unamused: :weary: :sob: :heart_eyes: :pensive: :ok_hand: :blush: :heart: :smirk: :grin: :notes: :flushed: :100: :sleeping: :relieved: :relaxed: :raised_hands: :two_hearts: :expressionless: :sweat_smile: :pray: :confused: :kissing_heart: :heartbeat: :neutral_face: :information_desk_person: :disappointed: :see_no_evil: :tired_face: :v: :sunglasses: :rage: :thumbsup: :cry: :sleepy: :yum: :triumph: :hand: :mask: :clap: :eyes: :gun: :persevere: :smiling_imp: :sweat: :broken_heart: :yellow_heart: :musical_note: :speak_no_evil: :wink: :skull: :confounded: :smile: :stuck_out_tongue_winking_eye: :angry: :no_good: :muscle: :facepunch: :purple_heart: :sparkling_heart: :blue_heart: :grimacing: :sparkles:".split(' ')<br/>model = torchmoji_emojis(PRETRAINED_PATH)<br/>with open(VOCAB_PATH, 'r') as f:<br/>  vocabulary = json.load(f)<br/>st = SentenceTokenizer(vocabulary, 30)</span><span id="418e" class="ng mf it nc b gy nl ni l nj nk">def deepmojify(sentence,top_n =5):<br/>  def top_elements(array, k):<br/>    ind = np.argpartition(array, -k)[-k:]<br/>    return ind[np.argsort(array[ind])][::-1]</span><span id="a039" class="ng mf it nc b gy nl ni l nj nk">tokenized, _, _ = st.tokenize_sentences([sentence])<br/>  prob = model(tokenized)[0]<br/>  emoji_ids = top_elements(prob, top_n)<br/>  emojis = map(lambda x: EMOJIS[x], emoji_ids)<br/>  return emoji.emojize(f"{sentence} {' '.join(emojis)}", use_aliases=True)</span></pre><h1 id="c5b2" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">文本实验</h1><pre class="lp lq lr ls gt nb nc nd ne aw nf bi"><span id="03b6" class="ng mf it nc b gy nh ni l nj nk">text = ['I hate coding AI']</span><span id="f92f" class="ng mf it nc b gy nl ni l nj nk">for _ in text:<br/>  print(deepmojify(_, top_n = 3))</span></pre><h2 id="d6a0" class="ng mf it bd mg nm nn dn mk no np dp mo lb nq nr mq lf ns nt ms lj nu nv mu iz bi translated">输出:</h2><h1 id="b5b1" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi">😡 😠 😤</h1><p id="9d27" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">如你所见，我已经告诉程序运行这行文本。因为它是一个列表，所以你可以添加多少个字符串。</p><h1 id="c063" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">原始神经网络</h1><p id="e095" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">如果你不知道如何编码，你只是想玩，你可以使用DeepMoji的网站。</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi nw"><img src="../Images/c443ebe51da2c8ba74f4aab21319f1c4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1386/format:webp/1*77Nsq1k5v0NOeCreMWvKuQ.png"/></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">www的截图。DeepMoji.com</figcaption></figure><p id="fdb3" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">源代码应该是完全一样的，事实上，如果我输入5个表情符号而不是3个，这是我的代码中的结果:</p><h1 id="0b25" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi">😡 😠 😤 🔫 😒</h1><h1 id="d0d5" class="me mf it bd mg mh mi mj mk ml mm mn mo ki mp kj mq kl mr km ms ko mt kp mu mv bi translated">输入列表而不是一个句子</h1><p id="8653" class="pw-post-body-paragraph ks kt it ku b kv mw kd kx ky mx kg la lb my ld le lf mz lh li lj na ll lm ln im bi translated">* * *现在，这是我的代码</p><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/aeb52e4a5c1a82d8fa829f46ee6f0a61.png" data-original-src="https://miro.medium.com/v2/resize:fit:144/format:webp/0*t6nn1w8HdzvOKHSG.png"/></div></figure><p id="3ba3" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">当执行情感分析时，我通常会在pandas上存储一个tweets或reviews数据库，我将使用以下算法将字符串列表转换为具有指定数量表情符号的Pandas数据帧。</p><pre class="lp lq lr ls gt nb nc nd ne aw nf bi"><span id="f674" class="ng mf it nc b gy nh ni l nj nk">import pandas as pd</span><span id="6413" class="ng mf it nc b gy nl ni l nj nk">def emoji_dataset(list1, n_emoji=3):<br/>  emoji_list = [[x] for x in list1]</span><span id="a5ee" class="ng mf it nc b gy nl ni l nj nk">for _ in range(len(list1)):<br/>    for n_emo in range(1, n_emoji+1):<br/>      emoji_list[_].append(deepmojify(list1[_], top_n = n_emoji)[2*-n_emo+1])</span><span id="9d0b" class="ng mf it nc b gy nl ni l nj nk">emoji_list = pd.DataFrame(emoji_list)<br/>  return emoji_list</span><span id="3012" class="ng mf it nc b gy nl ni l nj nk">list1 = ['Stay safe from the virus', 'Push until you break!', 'If it does not challenge you, it will not change you']</span></pre><p id="7928" class="pw-post-body-paragraph ks kt it ku b kv kw kd kx ky kz kg la lb lc ld le lf lg lh li lj lk ll lm ln im bi translated">我想估计一下这个字符串列表中最有可能的5个表情符号:</p><pre class="lp lq lr ls gt nb nc nd ne aw nf bi"><span id="1fa4" class="ng mf it nc b gy nh ni l nj nk">emoji_dataset(list1, 5)</span></pre><figure class="lp lq lr ls gt lt gh gi paragraph-image"><div role="button" tabindex="0" class="lu lv di lw bf lx"><div class="gh gi ny"><img src="../Images/5c9ee50f920acec1fdd14daa4aa7eac4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eBUXlGSTHJ5Ummur6_NrAg.png"/></div></div><figcaption class="ma mb gj gh gi mc md bd b be z dk translated">不错的结果！</figcaption></figure></div></div>    
</body>
</html>