<html>
<head>
<title>Variance Reduction in Causal Inference</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">因果推理中的方差缩减</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/variance-reduction-in-causal-inference-d0e51229d0aa?source=collection_archive---------2-----------------------#2022-01-10">https://pub.towardsai.net/variance-reduction-in-causal-inference-d0e51229d0aa?source=collection_archive---------2-----------------------#2022-01-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><figure class="ip iq gp gr ir is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi io"><img src="../Images/c95e1e533ee7ab01caeb371f8941d5d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*f6jQmw6WGFNcIgOJ"/></div></div><figcaption class="iz ja gj gh gi jb jc bd b be z dk translated">由<a class="ae jd" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>上的<a class="ae jd" href="https://unsplash.com/@chuttersnap?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> CHUTTERSNAP </a>拍摄</figcaption></figure><h2 id="2e05" class="je jf jg bd b dl jh ji jj jk jl jm dk jn translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/statistics" rel="noopener ugc nofollow" target="_blank">统计</a></h2><div class=""/><p id="0a72" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">许多公司，如脸书、推特、谷歌，每年都会进行成千上万次实验来做出数据驱动的商业决策，提高这些实验的灵敏度可以做出更精确的决策。敏感度或功效被定义为正确拒绝零假设的概率，或者换句话说，只在有影响时才检测到影响。</p><p id="42ca" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">有许多方法可以提高实验的灵敏度，包括<a class="ae jd" href="https://medium.com/swlh/why-sample-size-and-effect-size-increase-the-power-of-a-statistical-test-1fc12754c322" rel="noopener">增加样本量和效应量</a>，使用更高的显著性水平等。但是将样本大小增加4倍会将功效增加2倍，功效与平方根n成正比。</p><p id="cd29" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">由于增加样本大小并不总是一个选项，增加功效的其他两个选项如下:</p><ol class=""><li id="1a07" class="lk ll jg ko b kp kq kt ku kx lm lb ln lf lo lj lp lq lr ls bi translated">更好的实验有更大的效果。</li><li id="814a" class="lk ll jg ko b kp lt kt lu kx lv lb lw lf lx lj lp lq lr ls bi translated">在不增加样本量的情况下减少实验中的方差。</li></ol><p id="80f5" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在本文中，我们将讨论第二点。</p><p id="37a6" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">实验中的任何可变性将来自实验过程中由于没有正确控制环境或实际实验处理而导致的异常。</p><p id="b554" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">那么，如何对实验的可变性进行建模和控制，从而确保你的研究能够检测到真实的效果呢？</p><p id="d00e" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在这里，我们将讨论2种技术来减少实验中的方差，但在此之前，让我们看看如何减少方差，增加功率。</p><h2 id="316e" class="ly lz jg bd ma mb mc dn md me mf dp mg kx mh mi mj lb mk ml mm lf mn mo mp jm bi translated">减少方差以增加功率:</h2><p id="1ece" class="pw-post-body-paragraph km kn jg ko b kp mq kr ks kt mr kv kw kx ms kz la lb mt ld le lf mu lh li lj ij bi translated">考虑最常见的统计检验类型，即基于t统计量的双样本均值t检验:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi mv"><img src="../Images/078bdf45dfd2e2ba3fc876d3d775b1a6.png" data-original-src="https://miro.medium.com/v2/resize:fit:480/format:webp/1*GXnpJKzKABYijuz3wTUHzQ.png"/></div></figure><p id="1b78" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这里，</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi na"><img src="../Images/d9f64015037cb9ccdd0f86664b0b205e.png" data-original-src="https://miro.medium.com/v2/resize:fit:348/format:webp/1*B2dIPvJ_js6qsKxThk0OzQ.png"/></div></figure><p id="33e4" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">△是偏移的无偏估计量。因为样本<em class="nb">(处理和对照)</em>是独立的，</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi nc"><img src="../Images/2957dea749f8506b57d1cf1f55156115.png" data-original-src="https://miro.medium.com/v2/resize:fit:1228/format:webp/1*vwbrAGs0pA4O_lf-86W3aA.png"/></div></figure><p id="f4c8" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">为了减少估计delta的方差，我们需要减少两个样本均值的方差。我们需要找到一个调整后的delta △*，</p><p id="d451" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">a) △*是偏移的无偏估计量(与△相同)</p><p id="efc9" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">b) var(△*) &lt; var(△)</p><p id="05bf" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">减少方差将增加t统计量的值，因此更有可能拒绝相同效应大小的零假设，从而增加功效。</p><p id="defb" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在，我们来谈谈减少两个样本中观测Y的方差的两种技术。</p><h2 id="0dd4" class="ly lz jg bd ma mb mc dn md me mf dp mg kx mh mi mj lb mk ml mm lf mn mo mp jm bi translated">技巧1:分层</h2><p id="f8de" class="pw-post-body-paragraph km kn jg ko b kp mq kr ks kt mr kv kw kx ms kz la lb mt ld le lf mu lh li lj ij bi translated">这里的基本概念是将样本分成不同的层，然后计算每个层的平均值和方差，以获得总体估计值。分层样本的均值也是总体均值的无偏估计量，分层样本均值的方差小于随机样本均值的方差。以下证明:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi nd"><img src="../Images/b158c948ee4b35ef0456a0e9feb94781.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lcSc54dOrRi-2TI2NHiLzw.png"/></div></figure><p id="9798" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在在线实验中，我们可以使用实验前数据(协变量)来形成这些地层。重要的是采取实验前协变量来形成下层，因为这样不会在分层三角洲中引入偏差，因为地层不受处理效果的影响。一个好的分层是与数据中的潜在聚类很好地对齐，因此选择协变量。</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ne"><img src="../Images/9a6d7302cddfa321fc95e6f49c7773b3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KKjG4DJc2Qs3R1ZOqMKmcw.png"/></div></div></figure><p id="488c" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">例如，如果Yi是来自用户I的查询次数，则协变量Xi可以是用户在实验开始之前使用的浏览器。</p><h2 id="2e2e" class="ly lz jg bd ma mb mc dn md me mf dp mg kx mh mi mj lb mk ml mm lf mn mo mp jm bi translated">技术2:控制变量</h2><p id="d198" class="pw-post-body-paragraph km kn jg ko b kp mq kr ks kt mr kv kw kx ms kz la lb mt ld le lf mu lh li lj ij bi translated">这里，我们模拟一个新的变量Y_cv，使得它是Y的无偏估计量，并且具有比Y更低的方差。为了实现这一点，我们使用具有已知E(X)的随机变量X，使得我们具有(Yi，)的独立对，i = 1，.。。，n .定义:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi nf"><img src="../Images/1cb3bb51bb46a94cd035591805e34adc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1196/format:webp/1*JSXwQvInQ1HSFBBVRnExPA.png"/></div></figure><p id="da6d" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">其中，Y_cv的均值和方差为:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi ng"><img src="../Images/f81eda416bbd45fad216f8f0654b2548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1176/format:webp/1*ZA58-eOAYOphn3tRNTVvBw.png"/></div></figure><p id="4e39" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">正如我们所见，Y_cv是总体均值的无偏估计量，为了最小化方差，我们将𝛉设为:</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi nh"><img src="../Images/be9040e884348d9cc4e2e54898090963.png" data-original-src="https://miro.medium.com/v2/resize:fit:912/format:webp/1*K7wqD_765A8V71_A41GUJg.png"/></div></figure><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi na"><img src="../Images/a463e62161d808455424826101c29b17.png" data-original-src="https://miro.medium.com/v2/resize:fit:348/format:webp/1*wBy2atIcLGguff80FEGYpA.png"/></div></figure><p id="2e75" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">在方差方程中代入这个𝛉后，</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi ni"><img src="../Images/b1238a5310069812486a0c2ba2ac7254.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fRLwi0HJkHlT7lOP1rEvfQ.png"/></div></div></figure><p id="37df" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">其中，𝞺 = cov(X，y)</p><p id="9688" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">方差因𝞺因子而减少。𝞺越大，方差减少越好。所以，我们需要找到一个已知E(X)的协变量X，它与y高度相关。</p><p id="7118" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">将此应用到我们得到的delta算子，</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nj"><img src="../Images/189e061a35ab9ecb88d5ff334cf55548.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aLvnoB9tsp7z0LQeKkM74Q.png"/></div></div></figure><p id="ba37" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">鉴于，</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div class="gh gi nk"><img src="../Images/8e4806797bc4f9a4935e7fcba0f2a45d.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/format:webp/1*R201VUmzPU-ON5nZ924xwg.png"/></div></figure><p id="e143" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">重要的是，上述等式成立，以获得δ作为偏移的无偏估计量。此外，X是实验前协变量，这意味着它不受治疗效果的影响，因此对照组和治疗组的随机化确保两个期望值相等。</p><p id="4954" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">那么现在如何得到这个预实验，已知E(X)并且与Y高度相关，协变量？其中一种方法是在实验前观察阶段获得与Y相同的协变量。比方说，实验是观察在推荐引擎中做了改动后对CTR的影响。在这种情况下，协变量可以是实验开始前用户在平台上的CTR。</p><figure class="mw mx my mz gt is gh gi paragraph-image"><div role="button" tabindex="0" class="it iu di iv bf iw"><div class="gh gi nl"><img src="../Images/bd8d992a8f5ba5713b5e341ceb8df792.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zjNXQGQW_S51lEX8pe9Uvg.png"/></div></div></figure><p id="d22a" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">除了选择适当的协变量，还有其他因素会影响结果，例如:</p><ol class=""><li id="02dd" class="lk ll jg ko b kp kq kt ku kx lm lb ln lf lo lj lp lq lr ls bi translated">实验将持续多长时间？有时运行实验太久会将新的或失效的用户带入实验，对于这些用户来说，实验前数据中匹配的相应协变量X将会丢失，这降低了实验覆盖范围。</li><li id="dcda" class="lk ll jg ko b kp lt kt lu kx lv lb lw lf lx lj lp lq lr ls bi translated"><em class="nb">预实验持续时间的范围。</em>为了得到协变量X，我们需要回溯到实验前期的多远？太短的时间会导致不良匹配，而太长的时间会降低实验期间与结果度量的相关性。</li></ol><p id="11d5" class="pw-post-body-paragraph km kn jg ko b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">这两种技术都有助于减少方差，从而降低实验的灵敏度。第二种技术也被称为CUPED，使用实验前数据的控制实验。在某些情况下，这两种方法密切相关，并显示出相同的结果。有关该主题的更多详细信息，请参考下面的资源。</p><h1 id="d9c8" class="nm lz jg bd ma nn no np md nq nr ns mg nt nu nv mj nw nx ny mm nz oa ob mp oc bi translated">密码</h1><div class="ip iq gp gr ir od"><a href="https://github.com/ShwetaBaranwal/Medium-Posts/blob/master/variance_reduction.ipynb" rel="noopener  ugc nofollow" target="_blank"><div class="oe ab fo"><div class="of ab og cl cj oh"><h2 class="bd jq gy z fp oi fr fs oj fu fw jp bi translated">ShwetaBaranwal master的中型员额/variance _ reduction . ipynb/中型员额</h2><div class="ok l"><h3 class="bd b gy z fp oi fr fs oj fu fw dk translated">在GitHub上创建一个帐户，为ShwetaBaranwal/Medium-Posts的发展做出贡献。</h3></div><div class="ol l"><p class="bd b dl z fp oi fr fs oj fu fw dk translated">github.com</p></div></div><div class="om l"><div class="on l oo op oq om or ix od"/></div></div></a></div><h1 id="e37d" class="nm lz jg bd ma nn no np md nq nr ns mg nt nu nv mj nw nx ny mm nz oa ob mp oc bi translated">资源</h1><ul class=""><li id="b363" class="lk ll jg ko b kp mq kt mr kx os lb ot lf ou lj ov lq lr ls bi translated"><a class="ae jd" href="https://exp-platform.com/Documents/2013-02-CUPED-ImprovingSensitivityOfControlledExperiments.pdf" rel="noopener ugc nofollow" target="_blank">https://exp-platform . com/Documents/2013-02-CUPED-improvingsensitivity of controlled experiments . pdf</a>https://www.kdd.org/kdd2016/papers/files/adp0945-xieA.pdf T2</li><li id="8ba1" class="lk ll jg ko b kp lt kt lu kx lv lb lw lf lx lj ov lq lr ls bi translated"><a class="ae jd" href="https://medium.com/swlh/why-sample-size-and-effect-size-increase-the-power-of-a-statistical-test-1fc12754c322" rel="noopener">https://medium . com/swlh/why-sample-size-and-effect-size-increase-the-power of-a-statistical-test-1fc 12754 c322</a></li><li id="4d09" class="lk ll jg ko b kp lt kt lu kx lv lb lw lf lx lj ov lq lr ls bi translated"><a class="ae jd" href="https://towardsdatascience.com/online-experiments-tricks-variance-reduction-291b6032dcd7" rel="noopener" target="_blank">https://towards data science . com/online-experiments-tricks-variance-reduction-291 b 6032 DCD 7</a></li></ul></div></div>    
</body>
</html>