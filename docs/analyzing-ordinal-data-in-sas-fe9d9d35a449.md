# 用多项式分布分析 SAS 中的有序数据。

> 原文：<https://pub.towardsai.net/analyzing-ordinal-data-in-sas-fe9d9d35a449?source=collection_archive---------1----------------------->

## 这篇文章是我之前关于在 SAS 中使用广义线性混合模型的介绍性文章的延伸。

下面，我将使用一个包含猪的腹泻分数的数据集来展示如何分析序数数据。在这样做之前，人们必须考虑到腹泻评分的评估是以主观方式进行的，使用评分者，他们以 1-0，1，2，3 的步长从 0 到 3 对腹泻进行评分。9 表示没有粪便，无法评估腹泻。目前还不清楚这是否真的意味着没有腹泻或只是单纯的缺席。它也会对分析本身产生影响。

![](img/cd45027f81b60f2d8eb2554a05258123.png)

五位评分者对猪群的评分分布。不难发现，试验的结果不仅取决于“实际”分数，还取决于给粪便打分的人。

![](img/8a1033ba7f60a8adb357b7bfe8c7af47.png)

包括或排除特定分数会有影响，因为它会影响分母，从而影响概率估计。

有序数据可以用多种方法进行分析，在本文中我们将展示其中的有序和多项式方法。您将使用的分析类型取决于您的假设、您想要回答的特定问题以及模型能够容纳的内容。

![](img/89e81dcc60a0a80e5ea5063b42dbe98e.png)

分析的类型应该基于您想要回答的特定问题、数据的可用性以及模型的能力。

![](img/aa637110a8374ee4a0c501ee2a70f434.png)

就模型而言，如果您跨时间或按时间点对数据建模，它肯定会有影响。SAS 中的顺序和多项式模型不能适应每个时间点的分析。

腹泻是一个不连续的结果，因此应被视为一个比例，而不是一个真正意义上的连续分布。将腹泻的级别从{0，1，2，3，9}重新命名为{A，B，C，D，Z}将会解决这个混乱。腹泻可以用多种方法测量，选择哪种方法取决于:

1.  你希望得到回答的具体问题
2.  数据的可用性

首先，让我们做一些实际的分析，并使用一个类似这样的数据集。

![](img/bc17fe6d75251b5babae928fd0269592.png)

在该数据集里，我们有每头猪在 42 天内每天的腹泻评分。

从一开始， T 何[多项式方法](https://en.wikipedia.org/wiki/Multinomial_logistic_regression)也许是最简单的。记住，序数和多项式模型不能处理重复数据。因此，只能使用总周期(例如，0–42，0–14 等。).因此，要使用有序/多项式模型，需要特定的数据管理:

1.  根据*区块*、*处理* & *粪便稠度得分*，需要计算频率并放入模型中。
2.  在粪便稠度的情况下，类别“9”(FC = 9)被删除，因为这些通常被认为是缺失值*(见前面的讨论要点)*

下面您将看到 PROC SQL 命令，它用于转换数据集中的数据，这对于多项式和序数建模都是必要的。诀窍是获得每个区块每个类别每个治疗的频率。

![](img/5f016d8e0797098386afb1e3b21cabb7.png)

这将使数据集看起来像这样。

![](img/fdf90f5f84ea52560635afef673bcc42.png)

并立即显示不同治疗的得分分布。

下面，你可以看到多项式模型的全部代码。分布被设置为**多项式**，但是如果您想要使用顺序方法建模，也是这种情况。因此，关键是链接函数，在这里设置为 **glogit** ，对于顺序方法将设置为**clo git**—**GLO git**代表广义 logit，意味着我们将分别估计比例。处理 4 被设置为参考处理。对于估计值，您需要使用 **bycat** 函数来获得每个类别的实际一致性分数的估计值。

![](img/c09e8ebd5b9abbe37f9b79800563a3e2.png)

在这里，您可以看到使用多项式模型分析数据集的完整代码。

![](img/da22ca497d7274ffb71729a0a0dc62be.png)

feacal 评分的分布没有治疗差异。如果你根据观察到的数据来看这个图，这并不奇怪。

![](img/e40491a78841e6229b2d4b7aeaac9486.png)

以及不同之处。因为我们处理的是 logit 函数，所以必须再次通过比值比进行比较。然而，更重要的是要注意到，这种比较不仅仅是在治疗水平上进行的——它也是在实际评分水平上进行的。因此，比较治疗方法达到特定临床评分的概率。因为我们是用多项式的方式来做，所以没有相互依赖。

![](img/8cd056f1929fedee3bb577558e12d1db.png)

也是目前为止最重要的情节。该图显示了在特定治疗下获得特定分数的概率。

绘制结果通常是了解模型的更好方式。该图显示了各治疗中每个腹泻评分的概率。从图表中你可以看到:

1.  分数 3 几乎不存在
2.  分数 0 是最常见的
3.  治疗差异似乎在得分 2 中最明显

为了理解上表中的**优势比**，你需要熟悉比例。因此，让我们使用另一个例子，但要这样做，我们需要再次转换数据，让 **PROC GLIMMIX** 处理它。

![](img/97246e582a333ceeba960a079111d9eb.png)![](img/c0d45eaad77d9436cac33c6e241e4ff4.png)![](img/814ac76551dae6b1a8d4217a926639c7.png)![](img/0d2bfcfd0e508897043008c86f41fe98.png)

按区组和处理的分数分布。

在同样的代码下面，我们之前看到过。

![](img/d0d8d88a221d2bb0e166af0ecb47fc78.png)![](img/f440ddbe0594d1e37f7dda2c4d1f3f76.png)

代码和概率分布。这一次，人们可以清楚地看到，治疗二坚持了下来。

现在，上面的图很容易解释，但是当然，你需要实际的数字估计来理解治疗之间的差异的效果大小。在多项式模型中，解释取决于您所做的选择，甚至比任何其他类型的模型都更重要。

所以，正如你所看到的，这个表和正常的有点不同，但是我们已经知道了。按分数类别进行比较。但是，如果您更仔细地观察，您会发现 0 分缺失。这是因为它是参考分数。如果您想要对 score=0 进行具体的估计，那么您需要设置一个不同的参考分数。

![](img/eb6fc0d5bd2de86e2da8bc5dc4b5580f.png)

参考分数决定一切。

对于其他的，这是非常简单的。你得到一个估计和一个估计的平均值，平均值就是概率。一旦我们走向直接比较和治疗差异，你将不得不再次处理优势比。

![](img/8c39d374c47290a9c7ff6c371a665673.png)

表中的估计值。

![](img/37a77aaf6f02c8949eddd68ea65a6212.png)![](img/9600bdd2b20abbbd1ba901089dfa224c.png)![](img/401accad16e3a5704ba51888acd65d25.png)

左边和中间是图表中的估计值，右边是直接比较。右边的比较不是优势比。此外，左侧的两个图显示了根据 feacal 评分(1 和 2)处理是否相似。中间的图显示，对于临床评分 2，治疗 2、2、4 和 5 是不同的。这通过右边的图得到证实，其中处理 2、4 和 5 交叉。

参考分数的影响最容易通过重复分析来完成，但是通过改变参考分数来完成。下面，你可以看到参考分数 0 和 2 的概率图。现在，请仔细观察，实际的概率图没有变化。这是因为它无法改变。但是，估计值确实不同，因为分数与不同的参考分数相比较。

![](img/4c0dc33e915700a10dfef1d9f5388ad6.png)![](img/39cf6e749ebb95ce1d2dbba7c7429a0f.png)![](img/f8dbb587fd21266df7d113607fe493c5.png)![](img/48d16fd04b0ca95c1517852725b79b3c.png)

不管参考分数如何，概率图保持不变。这是因为它们是参考不可知的和治疗依赖的。

![](img/8e9ce008a52c19463cdf6447020273f0.png)![](img/975e94f206a2a14bcc208f0f36114d75.png)

这就是你能看到的不同之处。如果您更改参考分数，治疗估计值和差异会随着相同分数的变化而变化。这不是一个真正的变化，而只是通过使用一个不同的定位点在估计上的变化。

下面你可以看到改变参考分数对翻译的影响。这很了不起，所以如果你看这些图的话要小心。其实我想建议大家，只看这些图，结合整体概率图。

![](img/fee60ab8f2bfbe342f7e7c73f0c6ea4e.png)![](img/fcf523625ddd1e8c275a58dcca86ac75.png)![](img/0a6e5e7995ca24596193041bac250f01.png)![](img/ee3aa3efa41c2510572617643cf60607.png)![](img/c64112223d3038b5843b9180fc477587.png)![](img/51fe091e6e81b8afa040b60ecfa6b496.png)

都是有联系的。同一块拼图的碎片。看看数字就知道了。

![](img/ddb4926486540a47bcae30c0a427d6d3.png)

你需要这个情节来理解上面和下面的情节。

![](img/c90f2481a208fb8d23048806c8a2951b.png)![](img/b5ced8080da0276f0fd2dd5757e37365.png)![](img/0950f2dabaffcee3969b9a2049ee45ee.png)

差异与使用的参考有关

总之，当分析腹泻评分时，多项式模型是最直接的，因为它查看评分是否相互排斥，并分析每个评分类别的治疗效果。请注意，r **参考分数会影响结果，所以请继续从概率的角度思考问题——图表会有所帮助——并从不直观的优势比的角度思考问题。您可以多次运行该模型，改变参考分数和处理方式以获得完整的图像。另一个警告是，你**不能**以重复测量的方式分析数据——只适用于整个时期。**

现在，让我们转到顺序方法。

T 序数模型与多项模型建立在相同的基础上，然而，它处理数据的方式却完全不同。事实上，序数模型建立在假设之上，使分析和比较更加容易和直接。让我们看看是否真的如此。

大多数多级变量是有序的，这意味着类别有特定的顺序，尽管级别之间的“距离”并不清楚。然而，这些类别是人为的，没有实际的潜在理论分布。然而，当使用序数模型时，你假设在它的类别下有一个潜在的连续变量。你还假设**比例优势假设**，这通常是不符合的。为有序模型的使用辩护的一种方式是说在观察到的分数下面有一个潜在的变量 Y*。这个潜在变量有阈值，跨过一个阈值就会把你放到一个不同的类别。这就是为什么序数模型通常被称为“阈值模型”。因此，序数模型将得出 Y*的单个方程。这也是与多项模型**的直接区别，多项模型允许一个以上的等式，因为它将类别视为单独的**

![](img/a46ddee56f192384ada22f991784493d.png)![](img/2c55ebaafb2489d58fa15f70fd16428f.png)

观察到的类别之上的分布？或者，我们用类别来描述一个未被观察到的分布吗？这是一个序数模型试图通过把它作为一个优势来处理的“问题”。然而，大多数情况下，序数模型很难拟合，因为它们在类别之间假设的相等空间毫无意义。

在有序模型中，唯一变化的参数是截距。每个类别的固定效果保持不变。当线性预测值为零时，截距定义类别之间的边界。线性预测值的变化会将边界移动到一起，使它们之间的距离保持不变！！这是**比例优势假设**的定义

截距决定了下一个类别的阈值。因此，在五类结果变量中，我们有四个截距，如您在下面的[示例](https://v8doc.sas.com/sashtml/stat/chap29/sect45.htm)中所见。

![](img/163b2abf43486f5c94b32a0fb8905628.png)![](img/37c74f2d26aaa292279db61cb2dce545.png)

序数模型将为 Y*提出一个单一方程。截距本身没有真正的意义——它们被放置在一个潜在分布上，这是一个数学构造，正如你从上面的图片中所看到的。

![](img/7cd21747295ba3cf99200a8c99524c66.png)

PROC SQL 代码将数据转换成必要的结构。它看起来与多项式模型所需的结构完全相同。因为确实如此！

![](img/79ecf1199873ddd87e69688baf77617c.png)

我需要更改的模型部分不是运行顺序模型，而是多项式模型——**cumlogit**或 **clogit** 。这个名字并不是没有意义的，因为它意味着概率是以一种累积的方式建模的，而不是像多项式那样是通用的/独立的。

![](img/3ddcffd4b6975dfb01e49b3b2f8cb76d.png)

有序分析中最重要的表。如果你看到这样的表格，你已经知道第三类会给你带来问题。也许最好把它和第二类结合起来？

![](img/79c670cafd468bcd13701069a46c1efb.png)

治疗之间没有差异。

![](img/a6234ffe3bad03292850f2c22db13322.png)

高级代码，但老实说没什么特别的。只是通过请求更广泛的输出来完全理解模型做了什么。

![](img/cb38f6d0e86b56aa34ea1b0583787fd3.png)

关于如何解释输出的简短总结。最大的区别在于，比较是在治疗水平上进行的，而不是在治疗分数上。这是因为序数模型假设比例。因此，得分 1 的处理之间的差异与得分 2 或 3 相同。记住，这不是多项式模型的情况。说实话，这种假设通常没有什么意义，如果它成立，你将拥有一个更加全球化的模型。

![](img/50e1bd04d1e633d566638f6899d41262.png)

概率是累积的，这意味着得分 1 的概率实际上是得分 0 的概率加上得分 1 的实际概率。

处理复杂数学的最好方法是看这个图——累积概率图。它显示了频率的累积分布。在这里，可以清楚地看到，得分 0 是最常见的，得分 2 和 3 只增加了一点点。因此，也许最好将分数 1、2 和 3 与分数 0 结合起来

比例优势模型的关键假设是类别之间的关系保持不变。因此，概率不是特定类别的，治疗效果移动了作为一个组的类别之间的边界。因此，不严重对严重的治疗效果的优势比与严重对非常严重的治疗效果的优势比相同。

请记住，顺序模型试图找到一个线性预测器来预测从一个类别到下一个类别的变化，但概率不是特定于类别的。我们需要使用 **PROC GLIMMIX** 来测试这个假设

![](img/97e146f3a2968adb13d98e333422ab6c.png)

进行估计调用是为了测试比例假设。我想看到的是阈值内相似的估计值。

如果满足有序累积模型的假设，那么所有对应的系数*(截距除外)*应该是相同的。因此，模型的假设有时被称为平行线或平行回归假设

![](img/890a858af187e638f7cf0fff382a61d0.png)

估计值实际上非常相似，除了处理 4 和处理 5 定义了得分 1 和 2 之间的界限(c=1)。我也不完全确定 c=0 时的处理 4 和 5。因此，使用多项式模型可能更安全。

在总结中，假设数据是有序的，意味着离散数据是有一定顺序的。具体的排序是由潜在的连续分布决定的。顺序法的数据需要与名义法相同的设置。结果显示治疗的效果，不考虑具体的分数。因此，没有要考虑的参考。检查比例优势假设是否成立是很棘手的。

我希望你喜欢这篇文章！更多即将推出！