# 理解机器学习中模型漂移的终极指南

> 原文：<https://pub.towardsai.net/the-ultimate-guide-to-understanding-model-drift-in-machine-learning-3b1aded1af47?source=collection_archive---------1----------------------->

## [数据科学](https://towardsai.net/p/category/data-science)，[机器学习](https://towardsai.net/p/category/machine-learning)

## 每个数据科学家都应该了解的强制性概念，以免为时过晚。

![](img/d9349a8f530f1279fa3afd4f80a4767a.png)

来自[像素](https://www.pexels.com/photo/high-angle-photo-of-robot-2599244/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)的[亚历山大·奈特](https://www.pexels.com/@agk42?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)的照片

我一直认为模型开发是最难的部分。数据清理—最耗时。我们不都是被教导的吗？最近我学到了一些更重要的东西。

模型的性能非常好。万无一失；我们检查了很多次。因此，当我们部署预测系统并实现管道自动化时，我们认为自己做得很好。

哦，我们错了。

我们不知道等待我们的是什么。结果几个月都不错。然后就发生了。我们这边什么都没变，但是预测不再有任何意义了。我们隐约听说过模型漂移以及它如何改变结果，但不知道接下来会发生什么。

本文将介绍模型漂移，讨论不同的类型，并讨论如何在部署您的机器学习项目后解决这个问题。我们将真正深入概念和技术，确保您直观地理解一切。

简而言之，这是我希望在我们发布任何真实世界的机器学习项目之前就知道的事情。

# 什么是模型漂移？

让我给你一个直观的概念解释:

当我们说我们训练并建立了一个机器学习模型时，我们真正做的是什么？我们学习一组输入特征和输出之间的映射。我们在另一个我们最初放在一边的独立数据上测试映射。(我们用来学习映射的数据称为训练集，用来测试映射的数据称为测试集)。

```
y = f(x) where y->target and x-> input
```

我们迭代优化，直到得到满意的结果。

当我们最终部署模型时，我们假设特性和目标的分布在将来会保持不变。虽然这个假设是公平的，但它并不总是成立的。为什么？

> “生活中唯一不变的就是变化。”赫拉克利特

我在这里不是在说哲学，但这对我们建立的所有现实世界的机器学习模型都是真实的。这个概念叫做模型漂移。我们不能构建、部署和忘记模型。我们需要确保它们与我们最初着手解决的问题相关。

我将概述我们如何做到这一点的具体技术，但首先，理解模型中应该预期的变化是至关重要的。

# 每个数据科学家都应该了解的 3 种模型漂移

无论您已经部署了模型还是还没有开始构建它们，您都必须理解这三种类型的变化。这样，你就知道会发生什么了。

![](img/24aef30d68e52452b0eb51c94574344a.png)

我们先来了解一下这些概念！(照片由来自 [Pexels](https://www.pexels.com/photo/anonymous-man-with-book-in-hand-4218864/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) 的 [Karolina Grabowska](https://www.pexels.com/@karolina-grabowska?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) 拍摄)

## 1.概念漂移

当模型试图预测的目标变量的统计属性随时间以不可预见的方式发生变化时，就会发生概念漂移。

```
y' = f(x) where y'!= y
```

这种情况的一个很好的例子是垃圾邮件检测。邮件提供商必须不断更新他们的模型，因为垃圾邮件发送者会改变他们的策略来躲避算法，以免被检测到。用户/客户的偏好会随着时间而变化，推荐算法需要适应这种变化。

## 2.数据漂移

数据漂移—模型精度随时间下降的主要原因之一。在这种情况下，输入变量的统计属性会随着时间而变化。这再次影响了模型建立的映射。

```
y = f(x') where x'!= x 
```

趋势和季节性会随着时间而变化。像疫情这样意想不到的情况将会极大地改变人类行为的多个方面。这些数据通常作为输入要素输入到模型中，并影响模型预测。随着时间的推移，我们用来训练模型的数据会过时。

## 3.上游数据变更

这是大多数数据科学家没有考虑的概念之一。模型的数据从来都不是现成的。我们建立的模型依赖于生成输入和目标变量的数据工程管道。

由于各种业务和技术决策，变更应该发生在上游，影响特性或模型的目标变量。一些常见的例子是编码的改变和数据中新丢失的值。这些通常很常见，但不被注意，但会影响模型预测。

现在我们知道了可能发生的模型漂移，让我们考虑如何应对漂移，并随着时间的推移保持模型的相关性。

# 如何应对部署后的模型漂移

在过去的几个月里，我一直在研究如何做到这一点。调整、提炼和稳定模型及其输出，我都试过了。在参加了无数次由业内专家举办的[研讨会后，我总结出了最佳策略。](https://pages.databricks.com/ProductionizingMLWebinar_Reg.html)

![](img/96d8142680db879087d87cad958b61ca.png)

准备反击！(照片由来自 [Pexels](https://www.pexels.com/photo/serious-young-male-boxer-training-on-ring-4401653/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) 的 [Anthony Shkraba](https://www.pexels.com/@shkrabaanthony?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) 拍摄)

## 1.监控关键绩效指标

不追踪，永远不知道。

我们在开发周期中定义了一些重要的指标。我们确保他们在开发过程中表现良好，但是他们会继续保持良好吗？

我选择了 MAPE(平均绝对百分比误差),并在部署后持续跟踪了几周。当变化超过某个阈值时，这是一个危险信号。这将是监控的最重要的指标，但还不够。

在整个管道中包含关于数据类型和单元测试的断言语句有助于识别上游数据变化。即使管道运行顺利，这些检查也可以在为时已晚之前发出信号，表明有问题。

我们还需要监控目标变量的统计分布以及输入特征。理想情况下，我们应该有一个数量度量，将训练集的分布(我们在其上建立了映射)与当前输入的真实数据进行比较。

群体稳定性指数(PSI)是衡量变量在两个样本之间或一段时间内的分布变化程度的指标。这里是[关于 PSI](https://mwburke.github.io/data%20science/2018/04/29/population-stability-index.html) 的详细指南，关于如何计算值，以及关于监控期间可以使用的阈值。

此外，值得建立一个仪表板，让您一目了然地检查我们上面讨论的所有指标。并允许团队中的每个人访问，您还可以为某些阈值设置自动警报。简而言之，在有人发现结果有问题之前，你应该知道。

由于这是一个重要的部分，我想重复一下:

*   为您的问题和模型选择并监控一个最重要的性能指标。例如 MAPE
*   监控单元测试和断言语句。例如数据类型检查
*   使用定量度量监视目标和输入特征的统计分布。例如 PSI
*   设置一个包含上述所有指标的仪表板，并设置警报。

你已经完美地完成了监控部分。你得到一个警告；接下来你会做什么？

## 2.需要时进行干预

你准备好再做一次了吗？

如果有任何上游数据变更，跟踪它们。通知数据工程师这种影响，看看你是否能扭转它。如果您已经设置了测试和数据类型断言，那么更新代码以反映这些数据变化会容易得多。

有时最后通牒发生了:分布已经改变，模型不再相关。换句话说:你的机器学习模型已经*过时了。*

只有一个解决办法:模型再培训——准备从头再来。

# 如何刷新你的机器学习模型

一旦你确定了重新培训的需求，请遵循以下步骤。

![](img/4bb91e31c892fb364fb27a26ae2ac062.png)

最终，一切都会好的！(照片由来自 [Pexels](https://www.pexels.com/photo/man-in-red-polo-shirt-thought-a-good-idea-3779432/?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels) 的[安德里亚·皮亚卡迪奥](https://www.pexels.com/@olly?utm_content=attributionCopyText&utm_medium=referral&utm_source=pexels)拍摄)

## 传达模型再培训的需求。

首先，我们需要停止使用陈旧的模型来进行实时决策。就所需的时间和精力而言，重新训练/刷新/重新校准模型是一项重大的任务。创建行动计划文档，并向所有利益相关者详细传达该文档。

没有什么比有人仍然使用陈旧的模型来做决策更糟糕的了，因为你没有通知他们。尽可能透明会有所帮助；他们最终会理解某些机器学习算法的本质。

一旦他们批准，您就可以开始刷新流程了。

## 使用最相关/最新的数据。

我们已经在监控过程中发现了数据漂移和概念漂移。最好使用最新的相关数据。如果在该时间段内发生了一些不寻常的事件(例如，疫情恐慌性购买、四年一次的体育赛事等)。)，通常最好是省略数据，在正常数据上训练。这背后的想法是保持数据一般化，但最近，以避免在短时间内再次重新训练。

## 尝试超参数调整(速赢)。

模型的低性能通常可以通过超参数调整模型以适应最相关的数据来修复。实验是这里的关键。

我喜欢用 MLflow 记录所有的实验，所以如果我曾经参考过我以前做过的实验以及结果，我可以。实验可能很耗时，但绝对是尽快建立和运行模型的捷径。

## 坚持同一个模式。

如果超参数调优还不够，就必须进行更多的特性工程来提高性能。问问自己发生了什么变化:是否有一些新的可用数据可供你利用？有没有一些你最初包括的功能看起来不再相关了？

关键是坚持相同的模型(例如 XGBoost 或 Random Forest 等。)你已经建立了，但是改变你用来训练它的特性。我很幸运地用这个舞台赢回了表演，所以我建议花时间在这里。

如果以上都不起作用，你可能不得不疯狂地从头开始尝试不同的模型。我希望你不必这样做，但这种选择也是可行的。

# 最后的想法

我要诚实地告诉你:没有一个放之四海而皆准的策略来对抗模型漂移。这个想法是为了理解我们可以用来处理随时间变化的可能性和方法。

我们研究了机器学习模型可以改变的方式以及为什么这是不可避免的。我们分析了如何监控这种变化，并详细说明了当模型过时时刷新模型的过程。

你不应该暂停一切(像我一样)，揪着头发找出问题所在。你不必参加无数的研讨会(像我一样)来掌握情况。你现在需要明白这些概念，未来的自己会感谢你的。

我希望这篇文章提供了非常需要的概念概述，并让您做好准备。如果我能有所帮助，请随时[联系 LinkedIn](https://www.linkedin.com/in/arunn-thevapalan/) 。这是我希望在部署我最新的机器学习模型之前读过的文章。我很高兴你有它！

*要获得更多关于进入数据科学、令人兴奋的合作和指导的有用见解，请考虑加入我的电子邮件好友私人名单*[**。**](https://friends.arunnthevapalan.com/)