<html>
<head>
<title>Serum analysis</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">血清分析</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/serum-analysis-636d1198c7d6?source=collection_archive---------3-----------------------#2022-01-18">https://pub.towardsai.net/serum-analysis-636d1198c7d6?source=collection_archive---------3-----------------------#2022-01-18</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><h2 id="dc38" class="io ip iq bd b dl ir is it iu iv iw dk ix translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/data-analysis" rel="noopener ugc nofollow" target="_blank">数据分析</a></h2><div class=""/><div class=""><h2 id="6f69" class="pw-subtitle-paragraph jw iz iq bd b jx jy jz ka kb kc kd ke kf kg kh ki kj kk kl km kn dk translated">寻找R中的混合模型</h2></div><p id="76ab" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi lk translated"><span class="l ll lm ln bm lo lp lq lr ls di">在</span>这篇文章中，我将向你展示，利用商业数据，我是如何尝试对来自奶牛的血清数据进行建模的。不幸的是，我不能分享这些数据，但是对商业数据的分析总能让你看到真实数据的样子。即使实验的设计经过了最严格的审查，建模本身仍然是一个相当大的挑战。</p><p id="f8af" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我将尽我所能展示数据，并编写代码，使它们可以用于您自己的数据集。</p><p id="f694" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">首先，让我们加载我使用的库。您不需要所有这些工具来充分地对数据建模，但是R有一种方法允许通过多个包进行分析，其中一些包在其他包的基础上提供了额外的功能</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="e42b" class="mc md iq ly b gy me mf l mg mh">## Loading packages <br/>rm(list = ls())<br/>library(plyr)<br/>library(sjPlot)<br/>library(ggplot2)<br/>library(lattice)<br/>library(reshape2)<br/>library(kml)<br/>library(dplyr)<br/>library(effects)<br/>library(lme4)<br/>library(sjmisc)<br/>library(arm)<br/>library(pbkrtest)<br/>library(lmerTest)<br/>library(lmtest)<br/>library(AICcmodavg)<br/>library(lubridate)<br/>library(merTools)<br/>library(piecewiseSEM)<br/>require(parallel)  # parallel computing  <br/>library(scales)    # for squish()<br/>library(gridExtra)<br/>library(coefplot)  # coefficient plots (not on CRAN)<br/>library(coda)      # MCMC diagnostics<br/>library(aods3)     # overdispersion diagnostics<br/>library(plotMCMC)  # pretty plots from MCMC fits<br/>library(bbmle)     # AICtab<br/>library(nlme)<br/>library(readxl)<br/>library(readr)<br/>library(lubridate)<br/>library(sjPlot)<br/>library(sjstats)</span></pre><p id="5bee" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">然后，我会加载数据并开始调查。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="af55" class="mc md iq ly b gy me mf l mg mh">SerumDairy &lt;- read_delim("data.csv", delim = ";", <br/>                   escape_double = FALSE, trim_ws = TRUE)<br/>SerumDairy$Treatment&lt;-as.factor(SerumDairy$Treatment)<br/>SerumDairy$Treatment&lt;-factor(SerumDairy$Treatment, <br/>                             levels=c("1","2", "3","4","5","6"))<br/>print(levels(SerumDairy$Treatment))<br/>SerumDairy$Treatment&lt;-factor(SerumDairy$Treatment, levels(SerumDairy$Treatment)[c(2:6,1)])<br/>SerumDairy$Treatment&lt;-factor(SerumDairy$Treatment, ordered=TRUE)<br/>SerumDairy$Treatment_cont&lt;-as.character(SerumDairy$Treatment)<br/>SerumDairy$sample&lt;-NULL<br/>SerumDairy$collar&lt;-NULL<br/>SerumDairy$Zn.ppm &lt;- gsub(",", "", SerumDairy$Zn.ppm) <br/>SerumDairy$Cu.ppm &lt;- gsub(",", "", SerumDairy$Cu.ppm)<br/>SerumDairy$Zn.ppm&lt;-as.numeric(SerumDairy$Zn.ppm)<br/>SerumDairy$Cu.ppm&lt;-as.numeric(SerumDairy$Cu.ppm)<br/>head(SerumDairy)<br/>class(SerumDairy$date)<br/>SerumDairy$date<br/>SerumDairy$Daydiff&lt;-dmy(SerumDairy$date)<br/>SerumDairy$Daydiff&lt;-SerumDairy$Daydiff-SerumDairy$Daydiff[1]<br/>SerumDairy&lt;-SerumDairy[order(SerumDairy$Cow),]<br/>SerumDairy$Daydiff&lt;-as.numeric(SerumDairy$Daydiff)<br/>SerumDairyCompl&lt;-SerumDairy[complete.cases(SerumDairy),]<br/>SerumMelt&lt;-melt(SerumDairy, id.vars=c("Day", "Daydiff", "Cow","Block", "Treatment"), <br/>                measure.vars=c("Zn.ppm", "Cu.ppm"))<br/>SerumMelt$value &lt;- gsub(",", "", SerumMelt$value) <br/>SerumMelt$value&lt;-as.numeric(SerumMelt$value)</span><span id="1f98" class="mc md iq ly b gy mi mf l mg mh">#Summarising data tabular<br/>table(SerumDairy$Day)<br/>table(SerumDairy$Treatment) <br/>table(SerumDairy$Block) <br/>table(SerumDairy$Cow)</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mj"><img src="../Images/ce84b0b2dd88ed7c2636d97a129d37e5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Z6wSC6IDT0SN1jhh5UgDrQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">如您所见，我们每天对每个街区的每头奶牛进行多次测量。这确实是一个<a class="ae mv" href="https://medium.com/@marc.jacobs012/building-and-optimizing-randomized-complete-block-designs-using-sas-c973d127d862" rel="noopener">随机完全区组设计</a>。</figcaption></figure><p id="f9d4" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">去墓地吧。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="b38c" class="mc md iq ly b gy me mf l mg mh">ggplot(SerumMelt, aes(x=Day, y=value, color=variable,group=Cow)) + <br/>  geom_point() + <br/>  geom_line(alpha=0.5)+<br/>  theme_bw() +<br/>  facet_wrap(~Treatment) + <br/>  theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank()) +<br/>  guides(linetype=F, size=F)</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi mw"><img src="../Images/210e4860c40756574440e000de72abe2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bn10sYp3xxI49AemPKujbw.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">这是相当惊人的数据。这里的问题是我在处理之间建模，而不是块，这使得数据有点奇怪。然后，它继续上升和下降，所以我想仔细看看我看到的是什么。</figcaption></figure><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="2c22" class="mc md iq ly b gy me mf l mg mh"># Plotting data <br/>dev.off()<br/>par(mfrow=c(2,1))<br/>boxplot(SerumDairy$Zn.ppm~SerumDairy$Day)<br/>boxplot(SerumDairy$Cu.ppm~SerumDairy$Day)<br/>boxplot(SerumDairy$Zn.ppm~SerumDairy$Treatment)<br/>boxplot(SerumDairy$Cu.ppm~SerumDairy$Treatment)<br/>coplot(Zn.ppm~Day|Treatment, data=SerumDairy)<br/>coplot(Zn.ppm~Day|Block, data=SerumDairy)<br/>coplot(Cu.ppm~Day|Treatment, data=SerumDairy)<br/>coplot(Cu.ppm~Day|Block, data=SerumDairy)</span></pre><div class="lt lu lv lw gt ab cb"><figure class="mx mk my mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/e391a141a14f80b2e96d2fcff76cd26b.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*TaZn0cNad4ofrr_52Mq5Vw.png"/></div></figure><figure class="mx mk my mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/3fa4a8fbc74e82c1f6fe526bbdf2f3fe.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*9lFoQmLj1_vW4N7tJrTvRQ.png"/></div></figure><figure class="mx mk my mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/c70f6bac7fff11bff5d657c24f75232a.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Kp6CeMqIe2kd5dtM4R0Jlw.png"/></div></figure></div><div class="ab cb"><figure class="mx mk my mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/1dbd6ea76212bc48f1506b9833d9a354.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*Rs5EsOtYGBVENy0fMc1r5Q.png"/></div></figure><figure class="mx mk my mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/788ab68d746b9969c6cc16525a787cb2.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*DMz5fwkeJM7aojInkaYQdw.png"/></div></figure><figure class="mx mk my mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/38fcad08e0a40d6e260ceedcb53e8c65.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*4_R0W2FQVkpLt5aqMrGIpQ.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk nd di ne nf translated">这些图帮助我更好地了解数据的各个部分。我没有看到任何奇怪的山峰。</figcaption></figure></div><p id="a9c2" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在，我想画更多的图来得到一个更好的想法。记住，我做的第一个计划一点帮助都没有。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="643b" class="mc md iq ly b gy me mf l mg mh"># plotting Zn.ppm &amp; Cu.ppm<br/>ggplot(SerumMelt, aes(x=Day, y=value, group=Cow, color=variable)) + <br/>        geom_point(color="gray", shape=1)+ <br/>        geom_smooth(aes(group=variable, colour=variable), method="loess", size=1.5, se=F, span=0.5)+<br/>        scale_y_continuous("Value") +<br/>        scale_x_discrete("Days")+<br/>        ggtitle(paste("Smoothed curves Zn.ppm &amp; Cu.ppm"))+<br/>        theme_bw()+<br/>        facet_wrap(~Treatment)+<br/>        theme(text=element_text(size=10), <br/>              axis.title.x = element_text(), <br/>              panel.grid.minor = element_blank())</span><span id="81b0" class="mc md iq ly b gy mi mf l mg mh">ggplot(SerumMelt, aes(x=Day, y=value, fill=variable)) +<br/>        geom_boxplot() +<br/>        theme_bw()+<br/>        theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank())+<br/>        ggtitle(paste("Boxplot of Zn.ppm &amp; Cu.ppm by Days")) +<br/>        scale_y_continuous("Value") +<br/>        scale_x_discrete("Days") +<br/>        facet_grid(~Treatment)+<br/>theme(text=element_text(size=10), <br/>      axis.title.x = element_text(), <br/>      panel.grid.minor = element_blank())</span></pre><div class="lt lu lv lw gt ab cb"><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/d00bbe2f9635b5ec8b55634e2d662b16.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*2rUl5YrHqPVW5lYTVcsP8A.png"/></div></figure><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/5cd66bacf71f8a4be187dca73597d43e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*KVLOXsgfhSSNJLSZvmsHdg.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk nh di ni nf translated">虽然黄土平滑器看起来总是很酷，但箱线图提供的信息更多，因为它显示了巨大的分布量和无法达到的真实值差距。不管设计如何，这将使分析变得相当困难。</figcaption></figure></div><p id="29a7" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">现在，我想更仔细地看看治疗方法。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="ce5c" class="mc md iq ly b gy me mf l mg mh"># boxplot showing per treatment BW over time<br/>ggplot(SerumDairy, aes(x=as.factor(Day), y=Zn.ppm, colour=as.factor(Treatment))) +<br/>        geom_boxplot() +<br/>        theme_bw() +<br/>        ggtitle(paste("Boxplot of Zn.ppm by Days")) +<br/>        scale_y_continuous("Zn.ppm") +<br/>        scale_x_discrete("Days") +<br/>        theme(text=element_text(size=10), <br/>              axis.title.x = element_text(), <br/>              panel.grid.minor = element_blank())</span><span id="818e" class="mc md iq ly b gy mi mf l mg mh"># line plot<br/>ggplot(SerumDairy, aes(x=as.factor(Day), y=Zn.ppm, group=Cow)) + <br/>        geom_point(color="gray", shape=1) + <br/>        geom_smooth(aes(group=Treatment, colour=as.factor(Treatment)), method="loess", size=1.5, se=F, span=0.5) +<br/>        scale_y_continuous("Zn.ppm") +<br/>        scale_x_discrete("Days")+<br/>        ggtitle(paste("Smoothed curve Zn.ppm"))+<br/>        theme_bw()+<br/>        facet_wrap(~Block)+<br/>        theme(text=element_text(size=10), <br/>              axis.title.x = element_text(), <br/>              panel.grid.minor = element_blank())</span><span id="7a13" class="mc md iq ly b gy mi mf l mg mh">ggplot(SerumDairy, aes(x=Daydiff, y=Zn.ppm, group=Cow, colour=Treatment)) + <br/>        geom_point(color="gray", shape=1) + <br/>        geom_smooth(aes(group=1), size=1.5, se=F, alpha=0.8, span=0.5) +<br/>        facet_wrap(~Treatment)+<br/>        theme_bw()</span></pre><div class="lt lu lv lw gt ab cb"><figure class="mx mk nj mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/5e4e1490b7fdf6764b2560fc6070c491.png" data-original-src="https://miro.medium.com/v2/resize:fit:776/format:webp/1*PJ5_lZawn2exgRzoLFzeWw.png"/></div></figure><figure class="mx mk nk mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/43a455d0258c7c5ed2320d02b6f7bb47.png" data-original-src="https://miro.medium.com/v2/resize:fit:754/format:webp/1*7LB4uqJQ2a2z1I2vhVqtww.png"/></div></figure><figure class="mx mk nl mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/0330681bb98ebcf1549e52ccab2d4542.png" data-original-src="https://miro.medium.com/v2/resize:fit:474/format:webp/1*fj-53UnvdBCDWdYSiOrn4g.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk nm di nn nf translated">中间的图显示了我们在第一个图中看到的奇怪的上下模式，它累积在左侧的方框图中。这两个图合在一起，显示了右边黄土图的无用性，如果你把它作为唯一的图，那是危险的。</figcaption></figure></div><p id="860a" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">接下来的图可能是查看治疗数据最方便的了。不是因为他们试图描绘出每种治疗的平均效果，而是因为他们显示了箱线图中已经暗示的绝对差异水平。就此而言，箱线图可能是最具包容性的图。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="0902" class="mc md iq ly b gy me mf l mg mh"># nicest line plot for Treatment<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(0,7,8,10,12,14,16,18,21))<br/>ggplot(SerumDairyCompl, aes(x=Daydiff, y=Zn.ppm, group=Cow))+<br/>        myx+<br/>        geom_line(colour="grey80") +<br/>        facet_grid(~Treatment, margins=T)+<br/>        stat_summary(aes(group=1), fun.y=mean, geom="point", size=3.5)+<br/>        stat_summary(aes(group=1), fun.y=mean, geom="line", lwd=1.5)</span><span id="a588" class="mc md iq ly b gy mi mf l mg mh">theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(0,7,8,10,12,14,16,18,21))<br/>ggplot(SerumDairyCompl, aes(x=Daydiff, y=Zn.ppm, group=Cow))+<br/>        myx+<br/>        geom_line(colour="grey80") +<br/>        stat_summary(aes(group=Treatment, colour=Treatment), fun.y=mean, geom="point", size=3.5)+<br/>        stat_summary(aes(group=Treatment, colour=Treatment), fun.y=mean, geom="line", lwd=1.5)</span><span id="0f0f" class="mc md iq ly b gy mi mf l mg mh"># nicest line plot for Block<br/>theme_set(theme_bw())<br/>myx&lt;-scale_x_continuous(breaks=c(0,7,8,10,12,14,16,18,21))<br/>ggplot(SerumDairyCompl, aes(x=Daydiff, y=Zn.ppm, group=Cow))+<br/>        myx+<br/>        geom_line(colour="grey80") +<br/>        facet_grid(~Block, margins=T)+<br/>        stat_summary(aes(group=1), fun.y=mean, geom="point", size=3.5)+<br/>        stat_summary(aes(group=1), fun.y=mean, geom="line", lwd=1.5)</span><span id="ecfb" class="mc md iq ly b gy mi mf l mg mh">xyplot(SerumMelt$value~SerumMelt$Daydiff|SerumMelt$Treatment, type=c("p", "smooth"))<br/>histogram(~SerumDairy$Zn.ppm|SerumDairy$Day+SerumDairy$Treatment)</span></pre><div class="lt lu lv lw gt ab cb"><figure class="mx mk no mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/accceb5b3623c1fee9a08aaf45575d6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1076/format:webp/1*7CzuAYXtjYza0qehWHe2bQ.png"/></div></figure><figure class="mx mk np mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/5d93afbf3a78a74dce8abacbf2772f9b.png" data-original-src="https://miro.medium.com/v2/resize:fit:926/format:webp/1*8aVfTXy2mtRM0Y1AF1wF5w.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk nq di nr nf translated">再一次，治疗数据非常可怕。这让我想知道选择的时间是否有帮助。</figcaption></figure></div><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ns"><img src="../Images/c45e0bc9ee161ca0a81eadc1d22b03d6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*zcgt3jS2ZghftJeE2eMMZQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">这张图清楚地显示了模式的变化。</figcaption></figure><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nt"><img src="../Images/86eda3af92e1144d404da5e1c13c5c1b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*S0i-zMNx4_PkNYEpvn74xg.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">最后，也是最不重要的，平滑的曲线增加的如此之少，却如此努力。</figcaption></figure><p id="8d98" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">图表时代已经到来，我想现在就开始建模，使用<a class="ae mv" href="https://medium.com/mlearning-ai/introduction-to-mixed-models-in-r-9c017fd83a63" rel="noopener">线性混合模型</a>通过重复测量来考虑数据的相关性。</p><p id="e7ff" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">首先，进行一些简单的回归，以更好地了解模型将如何处理设计的不同组件。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="086c" class="mc md iq ly b gy me mf l mg mh">### Linear Mixed Models<br/>## Zinc <br/># Linear model for exploring data<br/>SerumDairy$Daydiff&lt;-as.numeric(as.character(SerumDairy$Daydiff))<br/>class(SerumDairy$Daydiff)<br/>SerumDairy$Treatment&lt;-factor(SerumDairy$Treatment, ordered=FALSE)<br/>summary(regr1&lt;-lm(Zn.ppm~Daydiff, data=SerumDairy))<br/>summary(regr2&lt;-lm(Zn.ppm~Daydiff*Treatment, data=SerumDairy))<br/>summary(regr3&lt;-lm(Zn.ppm~Daydiff*Block, data=SerumDairy))<br/>summary(regr4&lt;-lm(Zn.ppm~Daydiff*Treatment*Block, data=SerumDairy))<br/>plot(allEffects(regr1))<br/>plot(allEffects(regr2))<br/>plot(allEffects(regr3))<br/>plot(allEffects(regr4))<br/>anova(regr1, regr2, regr3, regr4)</span></pre><div class="lt lu lv lw gt ab cb"><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/5f593d5df6ddb621a9b08fd1438735cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*iWjjW9S93tiH9BmYfah1fQ.png"/></div></figure><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/f183e95df54557dcbc21c830e6299f4f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*4JaPGtDgZ2q0PtDruCRcVA.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk nh di ni nf translated">日效应和治疗</figcaption></figure></div><div class="ab cb"><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/7ceeb8e85b3fcdb35b58b0f2a9629b6b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*9zve8xHtVpKM6CMjv7RqpA.png"/></div></figure><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/c50e1f03d401a99558fdd095aa82fb19.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*1BWWWHqNK12EdAJ1nC1vJQ.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk nh di ni nf translated">跨区块的日效应和处理。如果你看看上一篇文章，你会对这些数据和其中固有的差异有更好的感觉。</figcaption></figure></div><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div class="gh gi nu"><img src="../Images/27e6d27be23ce7defdfa4e2b0769c40d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1020/format:webp/1*9RdbsnlrBJJ_WYk1Z39H4w.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">如您所见，与仅包含日的第一个模型相比，所有模型在统计上并不显著。从数据来看，这是有意义的，但是我们还没有包括相关的结构。</figcaption></figure><p id="fbef" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">让我们继续建立无条件增长模型。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="7ece" class="mc md iq ly b gy me mf l mg mh"># Unconditional means model - intercept only model<br/>model.i&lt;-lmer(Zn.ppm~1 + (1|Cow), SerumDairy, REML=FALSE) </span><span id="681d" class="mc md iq ly b gy mi mf l mg mh"># Unconditional growth model - linear effect of time<br/>model.l&lt;-lmer(Zn.ppm~1 + Daydiff + (1|Cow), SerumDairyCompl, REML=FALSE) # random intercept + fixed time<br/></span><span id="34b2" class="mc md iq ly b gy mi mf l mg mh"># Unconditional polynomial growth model - quadratic effect of time<br/>model.q&lt;-lmer(Zn.ppm~1 + Daydiff + I(Daydiff^2) + (1|Cow), SerumDairy, REML=FALSE)<br/><br/># comparing the unconditional mean model, the unconditional growth model, and the unconditional polynomial growth model<br/>mynames&lt;-c("I", "L", "Q")<br/>myaicc&lt;-as.data.frame(aictab(cand.set=list(model.i,model.l,model.q), modnames=mynames))[, -c(5,7)]<br/>myaicc$eratio&lt;-max(myaicc$AICcWt)/myaicc$AICcWt<br/>data.frame(Model=myaicc[,1],round(myaicc[, 2:7],4))</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div class="gh gi nv"><img src="../Images/de8da263c589f8201cf33e4acb6e98af.png" data-original-src="https://miro.medium.com/v2/resize:fit:886/format:webp/1*AGRKMzdL_KJPCnff31ONGg.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">第一个模型，线性的，似乎是最好的。</figcaption></figure><p id="9db2" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">然后我将继续添加<a class="ae mv" href="https://blog.devgenius.io/randomness-in-mixed-models-8b7affd8a7c4" rel="noopener ugc nofollow" target="_blank">随机斜率</a>到模型中。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="1c3f" class="mc md iq ly b gy me mf l mg mh"><br/>model.l&lt;-lmer(Zn.ppm~1 + Daydiff + (1|Cow), SerumDairyCompl, REML=FALSE) <br/>model.lr&lt;-lmer(Zn.ppm~1 + Daydiff + (1+Daydiff|Cow), SerumDairyCompl, REML=FALSE) <br/>anova(model.l, model.lr) <br/>PBmodcomp(model.lr, model.l, nsim=1000, cl=cl)<br/><br/>plot_model(model.lr, facet.grid=F, sort.est="sort.all", y.offset=1.0)</span><span id="4994" class="mc md iq ly b gy mi mf l mg mh">plot_model(model.lr, type="est"); <br/>plot_modelr(model.4, type="std") <br/>plot_model(model.lr, type="eff") <br/>plot_model(model.lr, type="pred", facet.grid=F, vars=c("Daydiff", "Treatment"))</span><span id="1ad3" class="mc md iq ly b gy mi mf l mg mh">ranef(model.lr)<br/>fixef(model.lr)</span><span id="7713" class="mc md iq ly b gy mi mf l mg mh">sam&lt;-sample(SerumDairy$Cow, 15);sam<br/>plot_model(model.lr, type="slope", facet.grid = F, sample.n=sam) # plotting random intercepts<br/>plot_model(model.lr, type="resid", facet.grid = F, sample.n=sam) # plotting random intercepts but does not work?? <br/>plot_model(model.lr, type="diag")</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi nw"><img src="../Images/bf3339becd0ffbe5fe82390089844dd2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rWSQGXUhV28Bv75pR0aDMg.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">在直接的似然比测试中，随机斜率分量并不重要，但当我们通过自举对数据进行排列时，它就重要了。就目前而言，最好还是保持随机截距和随机斜率的混合模型。</figcaption></figure><div class="lt lu lv lw gt ab cb"><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/129e50d2a9ec6f7e59d38e663598e969.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*ajJiNMYEn6ILFhAcs-9wOQ.png"/></div></figure><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/e1a2551b81da97db08d3995ce580554d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*K0Zc-yoxAwpCn3IstSGwNw.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk nh di ni nf translated">尽管随机分量遵循正态分布，但残差与您希望看到的相差甚远。</figcaption></figure></div><div class="ab cb"><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/7792dc00dda3eb1a9cbaefa665e89f89.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*-BSycHtG_hfH46Y7MMCj5Q.png"/></div></figure><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/6b0ddfc93f1e2f007df985dfd2845ba5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*L-Q5YPLTUhikvyD_Ck7Apw.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk nh di ni nf translated">残差暗示了一个不匹配的模型，就好像需要一个<a class="ae mv" href="https://blog.devgenius.io/mixture-component-zero-inflated-and-hurdle-models-44c5e6fe5d7f" rel="noopener ugc nofollow" target="_blank">混合物</a>。</figcaption></figure></div><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="33dc" class="mc md iq ly b gy me mf l mg mh">model.qr&lt;-lmer(Zn.ppm~1 + Daydiff + I(Daydiff^2) + (1+Daydiff|Cow), SerumDairyCompl, REML=FALSE)<br/>summary(model.qr) <br/>anova(model.l, model.q, model.lr, model.qr)</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div class="gh gi nx"><img src="../Images/4c744761bb014fe8f0b65bf5e723602e.png" data-original-src="https://miro.medium.com/v2/resize:fit:946/format:webp/1*LxG5a5_npRQc-l6NxpTsiA.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">嗯，模型之间的差异是微观的。最好用<a class="ae mv" href="https://en.wikipedia.org/wiki/Occam%27s_razor" rel="noopener ugc nofollow" target="_blank">奥卡姆剃刀</a>。</figcaption></figure><p id="38db" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我现在将添加治疗效果</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="ed61" class="mc md iq ly b gy me mf l mg mh">## Adding treatment effect<br/>model.ltt&lt;-lmer(Zn.ppm~1 + Daydiff*Treatment + (1|Cow), SerumDairyCompl, REML=FALSE)<br/>summary(model.ltt)<br/>anova(model.l, model.ltt)</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/6f54c6c2e1432e2ff55222c1d4baa794.png" data-original-src="https://miro.medium.com/v2/resize:fit:1072/format:webp/1*2HKW6Y5DIaciiyRqTcz8mA.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">一点帮助都没有。尽管p值可能暗示了潜在的重要性，但AIC几乎没有变化。</figcaption></figure><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="6817" class="mc md iq ly b gy me mf l mg mh"># plotting time over treatments and blocks <br/>pd &lt;- position_dodge(width = 0.2)<br/>ggplot(SerumDairy, aes(x=Daydiff, y=Zn.ppm, group=Cow, color=Treatment))+ geom_point(position=pd) + geom_line(position=pd) + facet_grid(Treatment~Block)<br/>ggplot(SerumDairy, aes(x=Daydiff, y=Zn.ppm, group=Cow, color=Treatment))+ geom_point(position=pd) + geom_line(position=pd) + facet_wrap(~Block)<br/>plot(allEffects(model.5))<br/>eff.model.5&lt;-allEffects(model.5)<br/>regr&lt;-lm(Zn.ppm~Daydiff+Treatment+Block, data=SerumDairyCompl)<br/>plot(allEffects(regr)) # smaller confidence intervals then multilevel model</span></pre><div class="lt lu lv lw gt ab cb"><figure class="mx mk nz mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/f930c423845a40eaf48b56b99b6a28eb.png" data-original-src="https://miro.medium.com/v2/resize:fit:700/format:webp/1*4T9rFjNWK74RdfNXZIJeOA.png"/></div></figure><figure class="mx mk oa mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/830d0ccc7acc5efefcb774a0d99d2974.png" data-original-src="https://miro.medium.com/v2/resize:fit:692/format:webp/1*hMbcfdcLm5T3YtmnN59WPw.png"/></div></figure><figure class="mx mk ob mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/6dc524e89e1b0df1dac3bf7475d311b6.png" data-original-src="https://miro.medium.com/v2/resize:fit:612/format:webp/1*FCdhvsWNeaYqRaMXjGF__Q.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk oc di od nf translated">再一次，看到这些情节，结果并不真的令人惊讶。</figcaption></figure></div><p id="afb1" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">接下来，我将使用块效应扩展模型。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="56d3" class="mc md iq ly b gy me mf l mg mh">## Adding block effect<br/>SerumDairy$Block&lt;-as.integer(SerumDairy$Block)<br/>model.l&lt;-lmer(Zn.ppm~1 + Daydiff + (1|Cow), SerumDairyCompl, REML=FALSE) # random intercept + fixed slope<br/>model.lttb&lt;-lmer(Zn.ppm~1 + Daydiff+Treatment++(1|Cow), SerumDairyCompl, REML=FALSE)<br/>summary(model.lttb)<br/>model.lttbr&lt;-lmer(Zn.ppm~1 + Daydiff+Treatment+Block+(1|Cow) + (1|Block), SerumDairyCompl, REML=FALSE)<br/>summary(model.lttbr)<br/>anova(model.lttb, model.lttbr)<br/>model.lttbri&lt;-lmer(Zn.ppm~1 + Daydiff*Treatment*Block + (1|Block/Cow), SerumDairyCompl, REML=FALSE) # (1|Block/Cow) is the same as (1|Cow) &amp; (1|Block)<br/>summary(model.lttbri)<br/>anova(model.l,model.ltt,model.lttbri)</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div class="gh gi oe"><img src="../Images/1696514d25904bacf4cfb074175b1eb4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1202/format:webp/1*zxovknElzFjz6OHHQaulNQ.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">同样，日差斜率和随机截距的单一模型表现最好。</figcaption></figure><p id="7733" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">然后我会寻找互动效应。在这一点上，我已经有了一种感觉，一个直接的比较将如何在结果中结束。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="0c74" class="mc md iq ly b gy me mf l mg mh"># Interaction effects or just fixed effects?<br/>model.lttbri1&lt;-lmer(Zn.ppm~1 + Daydiff*Treatment*Block + (1|Block/Cow), SerumDairy, REML=FALSE) # (1|Block/Cow) is the same as (1|Cow) &amp; (1|Block)<br/>model.lttbri2&lt;-lmer(Zn.ppm~1 + Daydiff+Treatment+Block + (1|Block/Treatment), SerumDairy, REML=FALSE) <br/>model.lttbri3&lt;-lmer(Zn.ppm~1 + Daydiff+Treatment+Block + (1|Block/Cow), SerumDairy, REML=FALSE) <br/>anova(model.lttbri1, model.lttbri2, model.lttbri3) # because each cow represent the treatment in a block (6 cows to represent 6 treatments in a block) it does not matter if we specify Block/Treatment or Block/CoW</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div class="gh gi of"><img src="../Images/2b65d1ec3f26f000a985011663e1d69a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1308/format:webp/1*8Z6Hzy01haEnSaVIfgeVuQ.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">互动效果不会增加任何东西。</figcaption></figure><p id="e8ea" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">是时候更深入地比较最有可能的模型了。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="7374" class="mc md iq ly b gy me mf l mg mh"><br/>model.1&lt;-lme4::lmer(Zn.ppm~1 + (1|Block/Treatment), SerumDairyCompl, REML=FALSE)</span><span id="4f53" class="mc md iq ly b gy mi mf l mg mh">model.2&lt;-lme4::lmer(Zn.ppm~Daydiff + (1|Block/Treatment), SerumDairyCompl, REML=FALSE)</span><span id="5427" class="mc md iq ly b gy mi mf l mg mh">model.3&lt;-lme4::lmer(Zn.ppm~Daydiff + Treatment + (1|Block/Treatment), SerumDairyCompl, REML=FALSE)</span><span id="7eff" class="mc md iq ly b gy mi mf l mg mh">model.4&lt;-lme4::lmer(Zn.ppm~Daydiff + Treatment + Block + (1|Block), SerumDairyCompl, REML=FALSE)</span><span id="901b" class="mc md iq ly b gy mi mf l mg mh">model.5&lt;-lme4::lmer(Zn.ppm~Daydiff + Treatment + Block + (1|Block/Treatment), SerumDairyCompl, REML=FALSE)</span><span id="cea8" class="mc md iq ly b gy mi mf l mg mh">model.6&lt;-lme4::lmer(Zn.ppm~Daydiff + Treatment + Block + (Daydiff|Treatment) + (1|Block/Treatment), SerumDairyCompl, REML=FALSE) # is maximal model possible, random slopes + intercept by subjects, and random intercept of treatment, blocks and treatment within blocks. But Corr is NaN which seems like overfitting the model or making it redundant</span><span id="79cd" class="mc md iq ly b gy mi mf l mg mh">model.7&lt;-lme4::lmer(Zn.ppm~Daydiff + Treatment + Block + (0+Block|Treatment), SerumDairyCompl, REML=FALSE) # experimental model, leaving the intercept alone, and thus only specifying the random slope. Do not fully understand that model yet. </span><span id="341d" class="mc md iq ly b gy mi mf l mg mh">model.8&lt;-lme4::lmer(Zn.ppm~Daydiff + Treatment + Block + (1|Treatment) + (1|Block), SerumDairyCompl, REML=FALSE) # shows varing intercepts by Block, not by Treatment. Is that even possible?<br/> <br/>model.9&lt;-lme4::lmer(Zn.ppm~Daydiff + Treatment + Block + (1|Cow), SerumDairyCompl, REML=FALSE<br/>, SerumDairyCompl, REML=FALSE)</span><span id="d6b8" class="mc md iq ly b gy mi mf l mg mh">model.10&lt;-lme4::lmer(Zn.ppm~Daydiff + I(Daydiff^2) + Treatment + Block + (1|Block/Treatment), SerumDairyCompl, REML=FALSE)</span><span id="deb9" class="mc md iq ly b gy mi mf l mg mh">model.11&lt;-lme4::lmer(Zn.ppm~Daydiff + Treatment + Block + (1|Block:Treatment), SerumDairyCompl, REML=FALSE)</span><span id="8a0b" class="mc md iq ly b gy mi mf l mg mh">model.11&lt;-lme4::lmer(Zn.ppm~Daydiff + Treatment + (1|Block:Treatment), SerumDairyCompl, REML=FALSE)</span><span id="0a55" class="mc md iq ly b gy mi mf l mg mh">model.12&lt;-lme4::lmer(Zn.ppm~1+(1|Block:Treatment:Daydiff), SerumDairyCompl, REML=FALSE) # Error: number of levels of each grouping factor must be &lt; number of observations</span><span id="b92c" class="mc md iq ly b gy mi mf l mg mh">model.13&lt;-lme4::lmer(Zn.ppm~Daydiff + Treatment + Block + (1|Block) + (1|Block:Treatment), SerumDairyCompl, REML=FALSE) # exact same as model.5 </span><span id="bb81" class="mc md iq ly b gy mi mf l mg mh">model.14&lt;-lme4::lmer(Zn.ppm~Daydiff + Block + (1|Block/Treatment), SerumDairyCompl, REML=FALSE)</span><span id="22fb" class="mc md iq ly b gy mi mf l mg mh">model.15&lt;-lme4::lmer(Zn.ppm~Daydiff + Block + (1|Block), SerumDairyCompl, REML=FALSE)</span><span id="3aac" class="mc md iq ly b gy mi mf l mg mh">model.16&lt;-lme4::lmer(Zn.ppm~poly(Daydiff,3) + Treatment + Block + (1|Block/Treatment), SerumDairyCompl, REML=FALSE)</span></pre><p id="3e62" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我们可以使用<a class="ae mv" href="https://jtools.jacob-long.com/" rel="noopener ugc nofollow" target="_blank"> jtools </a>包轻松比较许多模型。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="7c9e" class="mc md iq ly b gy me mf l mg mh">jtools::plot_summs(model.2,<br/>                   model.3,<br/>                   model.4, <br/>                   model.5,<br/>                   model.6,<br/>                   model.7,<br/>                   model.8,robust = "HC3",<br/>                   model.names = c("+Daydiff",<br/>                                   "+Treatment",<br/>                                   "only (1|Block)",<br/>                                   "(1|Block/Treatment)",<br/>                                   "(1|Daydiff/Treatment)",<br/>                                   "(0+Block|Treatment)",<br/>                                   "(1|Treatment) + (1|Block)"))</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi og"><img src="../Images/48903905d856273bd0652b3258be4b6f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*8U1QOEpSUjOY-3jMxgFN_Q.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">它们都显示了相同的效果估计。在这种情况下，选择最简单的模型。</figcaption></figure><p id="ac9b" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">让我们看看其他模特的表现。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="1368" class="mc md iq ly b gy me mf l mg mh">jtools::plot_summs(model.10,<br/>                   model.11,<br/>                   model.13,<br/>                   model.14,<br/>                   model.15,<br/>                   model.16,<br/>                   robust = "HC3",<br/>                   model.names = c("+I(Daydiff^2)",<br/>                                   "+(1|Block:Treatment)",<br/>                                   "(1|Block) + (1|Block:Treatment)",<br/>                                   "(1|Block/Treatment)",<br/>                                   "(1|Block)",<br/>                                   "poly(Daydiff,3)"))</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi og"><img src="../Images/2e14ae89e0af4ceade961fc9a3a0d244.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*sLfhwVgFv6QGu2PGv6JD4Q.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">也好不到哪里去。</figcaption></figure><p id="a98c" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我现在要选择一个模型，model.5，因为它在给定设计设置的情况下最有意义。然而，考虑到这些数据，选择只显示时间效应的最简单的模型是一个很好的主意。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="497e" class="mc md iq ly b gy me mf l mg mh"># diagnostic plots model.5<br/>plot(allEffects(model.11))<br/>plot(model.11, type=c("p", "smooth"))<br/>plot(model.11, sqrt(abs(resid(.)))~fitted(.), type=c("p", "smooth"))<br/>qqmath(model.11, id=0.05)</span></pre><div class="lt lu lv lw gt ab cb"><figure class="mx mk oh mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/176c3b6081443bfcd0054e73cb265134.png" data-original-src="https://miro.medium.com/v2/resize:fit:1374/format:webp/1*43sQZ838zecT0kWhl0n0hg.png"/></div></figure><figure class="mx mk oi mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/264afed4b51969786985e4e631ce8c82.png" data-original-src="https://miro.medium.com/v2/resize:fit:628/format:webp/1*p4OOS-DhJMIsPDjQFeM8kQ.png"/></div></figure></div><div class="ab cb"><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/01068f348f99f5e502497722bc86d141.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*90b6ZIk419ceIydbijhMLA.png"/></div></figure><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/68a90febfbe9201f978a2b0b21b2c2f2.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*prM6ab_I1L_9sYWs5PbixA.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk nh di ni nf translated">正如你所看到的，这个模型的诊断结果并不好。</figcaption></figure></div><p id="cc3e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">有一个很好的软件包，叫做<a class="ae mv" href="https://cran.r-project.org/web/packages/HLMdiag/index.html" rel="noopener ugc nofollow" target="_blank"> HLMdiag </a>，它可以让你更深入地研究模型的残差，在不同的层次上进行诊断。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="1518" class="mc md iq ly b gy me mf l mg mh">model.l&lt;-lmer(Zn.ppm~1 + Daydiff + (1|Cow), SerumDairyCompl, REML=FALSE)<br/>model.q&lt;-lmer(Zn.ppm~1 + Daydiff + I(Daydiff^2) + (1|Cow), SerumDairy, REML=FALSE)<br/>model.q3&lt;-lmer(Zn.ppm~1 + Daydiff + I(Daydiff^2) + I(Daydiff^3) + (1|Cow), SerumDairy, REML=FALSE) # cubic model<br/>model.qr&lt;-lmer(Zn.ppm~1 + Daydiff + I(Daydiff^2) + (Daydiff|Cow), SerumDairy, REML=FALSE)</span><span id="6319" class="mc md iq ly b gy mi mf l mg mh">model.l.resid &lt;- hlm_resid(model.l, standardize = TRUE, include.ls = TRUE, level=1)<br/>ggplot(data = model.l.resid, aes(x = Daydiff, y = .std.ls.resid)) + <br/>  geom_point(alpha = 0.2) +<br/>  geom_smooth(method = "loess", se = FALSE) + <br/>  labs(y = "LS level-1 residuals", title = "LS residuals against Day Difference")</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi oj"><img src="../Images/b2d2d58b2f04d5ffc758282b52d11d36.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_3lcL-V0w_WamZYfy7k1Xg.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">最简单模型的残差，我觉得不错。</figcaption></figure><p id="492d" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">然后，我想看看有影响的人，我会通过观察数据的第一层来做到这一点，这就是观察。下面你可以看到，肯定有一些有影响的观察，但这并不意味着他们需要删除。当你发现影响者或异常者时，他们会向你展示现实生活中的机制。找到了就要珍惜。如果模型不能处理它们，模型就会显示出它的局限性。</p><p id="2111" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">当标有异常值的观察值不是坏数据时，上述所有情况都适用。它们不应该是错误。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="044e" class="mc md iq ly b gy me mf l mg mh">model.l.infl  &lt;- hlm_influence(model.l, level = 1)<br/>dotplot_diag(model.l.infl$cooksd, name = "cooks.distance", cutoff = "internal")<br/>dotplot_diag(model.l.infl$cooksd, name = "mdffits", cutoff = "internal")<br/>dotplot_diag(model.l.infl$cooksd, name = "covratio", cutoff = "internal")<br/>dotplot_diag(model.l.infl$cooksd, name = "rvc", cutoff = "internal")</span></pre><div class="lt lu lv lw gt ab cb"><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/1a77327404d8d5866523d193e5c64b65.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*IdXpsxDmWnUupXiufJMdzg.png"/></div></figure><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/90c7ab028b734215c5351d71aa8099fa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Uw9vVZOWyYoC2JkRwIU6Vg.png"/></div></figure></div><div class="ab cb"><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/2a648b505c7db578b8b4ced2185a6385.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*VH9JI0KAD2yrJrLOVhySEg.png"/></div></figure><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/a2a27c2ea00dbdb551e45679708d78a8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*zexXUh72B9oG68s8MgHfgQ.png"/></div></figure></div><p id="189a" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">如果我开始完全删除奶牛呢？</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="d3ea" class="mc md iq ly b gy me mf l mg mh">model.l.del&lt;-case_delete(model.l, level="Cow", type="both")<br/>model.l.del$fitted.delete&lt;-as.data.frame( model.l.del$fitted.delete)<br/>ggplot(data = model.l.del$fitted.delete, <br/>       aes(y = as.factor(deleted), <br/>           x= as.factor(Daydiff), <br/>           fill=fitted.x.)) + <br/>  geom_tile() +<br/>  scale_fill_viridis_c(option="C")+<br/>  theme_bw()+<br/>  labs(y = "Deleted cow",<br/>       x = "Day difference", <br/>       title = "Changes in Zn (ppm) by deletion of cows")</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi oj"><img src="../Images/6e4f3cc7287aa4a3d70b20c31e81302e.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dLg1-MjE6Peek6j8xhHhIQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">没什么变化。再一次，如果你看最早的情节，我无论如何都会预料到这一点。整个数据集都存在差异。</figcaption></figure><p id="0830" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">接下来，我想看看来自模型5的后验预测模拟。首先，我们来拟合模型5。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="de21" class="mc md iq ly b gy me mf l mg mh">model.5&lt;-lme4::lmer(Zn.ppm~Daydiff + Treatment + Block + (1|Block/Treatment), SerumDairyCompl, REML=FALSE)</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ok"><img src="../Images/1c0942cfcf4cc716138aa8b64538da4b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fkfByu0KS7sl7-KX9GMmig.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">一切看起来都很好，除了块方差似乎没有做任何事情。</figcaption></figure><p id="f525" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">然后模拟工作开始。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="f34a" class="mc md iq ly b gy me mf l mg mh">mySumm &lt;- function(.) { s &lt;- sigma(.)<br/>c(beta =getME(., "beta"), sigma = s, sig01 = unname(s * getME(., "theta"))) }<br/>boo01&lt;-bootMer(model.5, mySumm, nsim = 1000)<br/>plot(boo01,index=3)</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi ol"><img src="../Images/e78dff36bb6decc185b9b1fe69e29c32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KWDH4JGaAuOr6C4BO6pkDQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">在这里，您可以看到来自引导程序的值。这11个值代表了在<strong class="bd om">模型中测量的11个变量。5. </strong>你在这样的模拟中寻找的不是显著的，而是扩散。偏倚有多大，标准差有多大？大的数字暗示着不稳定的数据集。</figcaption></figure><p id="9529" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">从自举结果中，我可以提取不同水平的特定种类的置信区间，并绘制它们。在这里，您可以通过直方图和第三个变量<em class="on"> t3的qq图看到分布情况。</em>恰逢<em class="on">处理。L </em>。因此，它显示了<em class="on">治疗的效果。L </em>通过重采样与参考处理进行比较。重采样显示您希望它显示的内容-正态分布，如扩散。进行<em class="on">治疗。然而，这种无效果现在变得非常明显。</em></p><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi oo"><img src="../Images/c3ec749f957908c46b6a91a930d23fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dXZvtu5eEQVZXlALFGg7QQ.png"/></div></div></figure><p id="1006" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">从所有这些，我们可以选择选择哪种信心。它们并不都一样。从功能中，您可以选择:</p><ol class=""><li id="7469" class="op oq iq kq b kr ks ku kv kx or lb os lf ot lj ou ov ow ox bi translated"><strong class="kq ja">正常</strong>。使用正态近似计算区间矩阵。它有3列，第一列是水平，另外两列是区间的上下端点。</li><li id="f2cd" class="op oq iq kq b kr oy ku oz kx pa lb pb lf pc lj ou ov ow ox bi translated"><strong class="kq ja">基本</strong>。使用基本的bootstrap方法计算区间。</li><li id="2aff" class="op oq iq kq b kr oy ku oz kx pa lb pb lf pc lj ou ov ow ox bi translated">学生。使用学生化bootstrap方法计算区间。</li><li id="e1ce" class="op oq iq kq b kr oy ku oz kx pa lb pb lf pc lj ou ov ow ox bi translated"><strong class="kq ja">百分之</strong>。使用bootstrap百分位法计算区间。</li><li id="fac1" class="op oq iq kq b kr oy ku oz kx pa lb pb lf pc lj ou ov ow ox bi translated"><strong class="kq ja"> BCA </strong>。使用调整的bootstrap百分位(BCa)方法计算间隔。</li></ol><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="0240" class="mc md iq ly b gy me mf l mg mh">## ------ Bootstrap-based confidence intervals ------------<br/>bCI.1 &lt;- boot.ci(boo01, index=1, type=c("norm", "basic", "perc")); bCI.1 # Intercept<br/>bCI.2  &lt;- boot.ci(boo01, index=2, type=c("norm", "basic", "perc")) # Residual standard deviation - original scale<br/>plot(boo01,index=3)<br/>confint(model.5, method="boot", nsim=1000)</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi pd"><img src="../Images/f56f5e0de7810ac2cf22043b8284fd48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nL-jYoimCUBxgu1SjCMx3A.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">我请求t1的正常、基本和百分比置信区间。如你所见，它们是不同的。</figcaption></figure><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi oo"><img src="../Images/c3ec749f957908c46b6a91a930d23fe5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dXZvtu5eEQVZXlALFGg7QQ.png"/></div></div></figure><p id="c4df" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">就像我之前说的，R有办法通过不同的包以不同的方式做同样的事情。下面我展示了来自<a class="ae mv" href="https://cran.r-project.org/web/packages/merTools/vignettes/merToolsIntro.html" rel="noopener ugc nofollow" target="_blank"> merTools </a>包和lme4 bootMer函数的预测间隔。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="f355" class="mc md iq ly b gy me mf l mg mh"><br/>PI&lt;-predictInterval(model.5, newdata=SerumDairyCompl, level=0.95, n.sims=1000, stat="median", type="linear.prediction", include.resid.var=T)<br/>head(PI)</span><span id="3bcf" class="mc md iq ly b gy mi mf l mg mh">ggplot(aes(x=1:30, y=fit, ymin=lwr, ymax=upr), data=PI[1:30,])+geom_point()+geom_linerange()+labs(x="Index", y="Prediction w/95% PI") + theme_bw()</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi pe"><img src="../Images/a59ce3091bb48665f8fa4c1e1c0b9ffa.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*rMnYpbhkTCcPPjJRkjRWFA.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">通过bootstrapping对模型进行线性预测，显示前30次提取</figcaption></figure><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="d73d" class="mc md iq ly b gy me mf l mg mh">mySumm &lt;- function(.) {<br/>        predict(., newdata=SerumDairyCompl, re.form=NULL)<br/>}</span><span id="7188" class="mc md iq ly b gy mi mf l mg mh">####Collapse bootstrap into median, 95% PI<br/>sumBoot &lt;- function(merBoot) {<br/>        return(<br/>                data.frame(fit = apply(merBoot$t, 2, function(x) as.numeric(quantile(x, probs=.5, na.rm=TRUE))),<br/>                           lwr = apply(merBoot$t, 2, function(x) as.numeric(quantile(x, probs=.025, na.rm=TRUE))),<br/>                           upr = apply(merBoot$t, 2, function(x) as.numeric(quantile(x, probs=.975, na.rm=TRUE)))))}</span><span id="f3db" class="mc md iq ly b gy mi mf l mg mh">boot1 &lt;- lme4::bootMer(model.5, mySumm, nsim=1000, use.u=FALSE, type="parametric")<br/>PI.boot1 &lt;- sumBoot(boot1)<br/>ggplot(PI.boot1)+<br/>  geom_density(aes(x=fit))+<br/>  geom_density(aes(x=lwr, fill="red"),alpha=0.5)+<br/>  geom_density(aes(x=upr, fill="red"),alpha=0.5)+<br/>  theme_bw()+<br/>  theme(legend.position = "none")</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi pf"><img src="../Images/9d03aac7d526f4550d52dd764f0f1eb1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yNnn6e0B2EdQ6QA2YJS02g.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">现在你可以看到它们了——拟合的置信区间和上下置信区间是它们自身的分布，有重叠的地方。情节可能看起来有点奇怪，但我真的很有兴趣在这里传播。我的模特表现有多好？</figcaption></figure><p id="bec5" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">我现在要做的是，稍微回顾一下，看看相互作用。我想弄清楚发生了什么，我将使用方差分析模型来仔细观察。由于数据是平衡的，方差分析会工作得很好。否则，我将不得不使用混合模型。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="25d2" class="mc md iq ly b gy me mf l mg mh">model.5.aov&lt;-aov(Zn.ppm~Daydiff+Treatment*Block, data=SerumDairyCompl)<br/>coef(model.5.aov)<br/>summary(model.5.aov)<br/>par(mfrow=c(2,1))<br/>interaction.plot(SerumDairyCompl$Daydiff, SerumDairyCompl$Block, SerumDairyCompl$Zn.ppm, col=seq(1,12,1))<br/>interaction.plot(SerumDairyCompl$Daydiff, SerumDairyCompl$Treatment, SerumDairyCompl$Zn.ppm, col=seq(1,6,1))</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi pg"><img src="../Images/c082282165c99367395ce1e93b7b4907.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*cFYbcAw7WTn2haQv6Z70GA.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">看起来有互动的空间，但这些效果确实是白天的效果。每个模特都在展示这一点。</figcaption></figure><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="10c3" class="mc md iq ly b gy me mf l mg mh">rr&lt;-ranef(model.5)<br/>dotplot(ranef(model.5, condVar=T))<br/>qqmath(ranef(model.5)); abline(0,1)</span></pre><div class="lt lu lv lw gt ab cb"><figure class="mx mk my mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/b3f9bca732e04f1ca698c4dd0a1fe8c6.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*rr8aTm7IFd6jmCt3Vt1TtA.png"/></div></figure><figure class="mx mk my mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/9ad89d46dbe3d3dca0bff8585851fe60.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*NQzRKEQiaj-lkENrwAjlkg.png"/></div></figure><figure class="mx mk my mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/bb0eab9cde084052a0a4c74b736cf5a3.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*9QG3ipeXLf8gG1B8Dz_Rtg.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk nd di ne nf translated">评估模型的随机效应。可以肯定地说，不包含任何随机效应是好的。你可能会期待不同的线，不相似的平均值，和疯狂的置信区间。</figcaption></figure></div><p id="99fe" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">您还可以使用引导来比较模型。劳动密集型的电脑，所以要确保你并行运行。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="be0a" class="mc md iq ly b gy me mf l mg mh"># parametric bootstrapping of confidence values when comparing models<br/>(nc &lt;- detectCores())<br/>cl &lt;- makeCluster(rep("localhost", nc))<br/>PBmodcomp(model.5,model.14, nsim=2000, cl=cl)</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div class="gh gi ph"><img src="../Images/19a79ecb6404fcaf17eed679adaaed05.png" data-original-src="https://miro.medium.com/v2/resize:fit:1270/format:webp/1*8xcVFRQ0Rw0ccjqqhB1VXw.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">14型并不比5型好。</figcaption></figure><p id="a54e" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">让我们再次使用MerTools包，进一步研究这些模型。通过MerTools，您可以使用te函数<em class="on"> arm::sim </em>模拟来自后部的固定效果值。FEsim 是一个方便的包装器，提供了一个信息丰富的数据框架。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="e825" class="mc md iq ly b gy me mf l mg mh">fastdisp(model.4) <br/>feEx &lt;- FEsim(model.4, 5000) # simulate values of the fixed effects from the posterior using te function arm::sim. FEsim is a convenience wrapper to do this and provides an informative dataframe<br/>cbind(feEx[,1] , round(feEx[, 2:4], 3))<br/>library(ggplot2)<br/>plotFEsim(feEx) + <br/>        theme_bw() + <br/>        labs(title = "Coefficient Plot of InstEval Model", x = "Median Effect Estimate", y = "Evaluation Rating") # The lighter bars represent grouping levels that are not distinguishable from 0 in the data.<br/>reEx &lt;- REsim(model.5, 5000); reEx<br/>table(reEx$groupFctr)<br/>table(reEx$term)<br/>lattice::dotplot(ranef(model.5, condVar=TRUE))<br/>p1 &lt;- plotREsim(reEx); p1</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div class="gh gi pi"><img src="../Images/759cc02e62f52fa8a67c4f4823b25d6d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1086/format:webp/1*HOeeOB5uYrhdIKS3EWBHHA.png"/></div></figure><div class="lt lu lv lw gt ab cb"><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/cb2bfd70555fc4eb3bda65e8c6a64027.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*GiIO1AT3UtMXflZ_4p27WA.png"/></div></figure><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/26ea333d9fb824f66d72985948fa2871.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*Q39NNdHnXwX4gzJHmM-NUQ.png"/></div></figure></div><div class="ab cb"><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/9c8f10f9ca3b36f2357e0af896170124.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*XF9SzYAHDLz8FHcT9OtmrA.png"/></div></figure><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/d1e12cf28cdf1f492e18283ce4f51805.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*RMukwHpgsvnBq8miNrDBpg.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk nh di ni nf translated">只显示单一治疗效果，绝对不需要随机效果。我们已经知道了。</figcaption></figure></div><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="e27e" class="mc md iq ly b gy me mf l mg mh">plot(model.4)<br/>plot_model(model.4, type="diag")<br/></span></pre><div class="lt lu lv lw gt ab cb"><figure class="mx mk my mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/4f708ef4cc977f801030372957edcdd6.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*9k_IYk7cHfM2xbJpXmeT5w.png"/></div></figure><figure class="mx mk my mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/8fb047c66f60e8afd30b238281bd3111.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*FhMYrHbapuYfyDeSBvOWmg.png"/></div></figure><figure class="mx mk my mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/687bd4555d4e55e6415c00088c75b499.png" data-original-src="https://miro.medium.com/v2/resize:fit:668/format:webp/1*MAIb3yPwRgukJkN3pgNUBg.png"/></div></figure></div><div class="ab cb"><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/3689cff007ceca83babae1ecbd60b8ab.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*yLGiUwAO6d9HzzstWpV8gQ.png"/></div></figure><figure class="mx mk ng mz na nb nc paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><img src="../Images/14a700f60771a686d3eea6808dd01154.png" data-original-src="https://miro.medium.com/v2/resize:fit:1000/format:webp/1*OBuPF9YUnY1bKzfXpAKykg.png"/></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk nh di ni nf translated">而model.4也好不到哪里去。</figcaption></figure></div><p id="5c9a" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">最后但并非最不重要的，预测与观察，看看模型适合。</p><pre class="lt lu lv lw gt lx ly lz ma aw mb bi"><span id="8d14" class="mc md iq ly b gy me mf l mg mh">SerumDairyFitted&lt;-broom.mixed::augment(model.4)<br/>ggplot(SerumDairyFitted, aes(x=Zn.ppm, y=.fitted, colour=.resid, size=Block))+<br/>  geom_point()+<br/>  geom_abline(slope=1, lty=2)+<br/>  scale_color_viridis_c(option="C")+<br/>  facet_wrap(~Treatment, scales="free")+<br/>  labs(title="Fitted vs Observed from Mixed Model 4",<br/>       x="Observed Zn (ppm)",<br/>       y="Predicted Zn (ppm)")+<br/>  theme_bw()</span></pre><figure class="lt lu lv lw gt mk gh gi paragraph-image"><div role="button" tabindex="0" class="ml mm di mn bf mo"><div class="gh gi pj"><img src="../Images/efdf2bfcd3169156e349f71ab61a97d3.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RzU7bP6FHYcXC9sPqL21SQ.png"/></div></div><figcaption class="mr ms gj gh gi mt mu bd b be z dk translated">太可怕了</figcaption></figure><p id="631f" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">有时，最好保留数据，不要建模。我们已经从图表中看到了这一点，但当时我不能就此罢休。反正是商业数据。</p><p id="3ab1" class="pw-post-body-paragraph ko kp iq kq b kr ks ka kt ku kv kd kw kx ky kz la lb lc ld le lf lg lh li lj ij bi translated">不要犯我的错误！</p></div></div>    
</body>
</html>