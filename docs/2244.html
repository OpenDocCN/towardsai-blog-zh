<html>
<head>
<title>Data Validation for Machine Learning Using TFDV</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">使用TFDV进行机器学习的数据验证</h1>
<blockquote>原文：<a href="https://pub.towardsai.net/data-validation-for-machine-learning-using-tfdv-be61a1d5ce65?source=collection_archive---------3-----------------------#2021-10-12">https://pub.towardsai.net/data-validation-for-machine-learning-using-tfdv-be61a1d5ce65?source=collection_archive---------3-----------------------#2021-10-12</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><figure class="is it gp gr iu iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi ir"><img src="../Images/322b515e9b5b832ebe76f8215b5e6fa6.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*jUZdce_u6E7UPA_3.jpg"/></div></div><figcaption class="jc jd gj gh gi je jf bd b be z dk translated">作者图片</figcaption></figure><h2 id="3b81" class="jg jh ji bd b dl jj jk jl jm jn jo dk jp translated" aria-label="kicker paragraph"><a class="ae ep" href="https://towardsai.net/p/category/machine-learning" rel="noopener ugc nofollow" target="_blank">机器学习</a></h2><div class=""/><div class=""><h2 id="dc45" class="pw-subtitle-paragraph ko jr ji bd b kp kq kr ks kt ku kv kw kx ky kz la lb lc ld le lf dk translated">生产中机器学习最重要的部分</h2></div><p id="18dc" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在机器学习模型部署之后，我们需要以某种方式验证传入的数据集，然后再将它们输入到ML管道中。我们不能仅仅依赖我们的消息来源，想当然地认为数据会没问题。可能会有新的列、新的值，甚至是错误类型的数据，大多数时候模型会忽略它们。这意味着我们最终可能会使用过时或有偏见的模型。</p><p id="d3db" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">在这篇文章中，我将向你展示一种简单快捷的方法，使用<a class="ae mc" href="https://www.tensorflow.org/tfx/data_validation/get_started" rel="noopener ugc nofollow" target="_blank"> Tensorflow数据验证</a>来验证你的数据。TFDV是一个强大的库，可以<a class="ae mc" href="https://predictivehacks.com/3-ways-to-perform-quick-exploratory-data-analysis-in-python/" rel="noopener ugc nofollow" target="_blank">计算描述性统计</a>，推断方案，并检测大规模的数据异常。它用于分析和验证谷歌每天生产的数千个不同应用程序中数Pb的数据。</p><p id="806f" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">但是首先，让我们创建一些虚拟数据。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="f19b" class="mm mn ji mi b gy mo mp l mq mr"><strong class="mi js">import</strong> <!-- -->pandas as pd</span><span id="47f6" class="mm mn ji mi b gy ms mp l mq mr"><strong class="mi js">import</strong> <!-- -->numpy as np</span><span id="d0b5" class="mm mn ji mi b gy ms mp l mq mr"><strong class="mi js">import</strong> <!-- -->tensorflow_data_validation as tfdv</span><span id="dfb8" class="mm mn ji mi b gy ms mp l mq mr">df<strong class="mi js">=</strong>pd.DataFrame({'Name':np.random.choice(['Billy','George'],100),'Number': np.random.randn(100),'Feature': np.random.choice(['A','B'],100)})</span><span id="d2b3" class="mm mn ji mi b gy ms mp l mq mr">df.head()</span></pre><figure class="md me mf mg gt iv gh gi paragraph-image"><div class="gh gi mt"><img src="../Images/0ad6dfef0e5ccf0387d18ec8282c5e2c.png" data-original-src="https://miro.medium.com/v2/resize:fit:428/format:webp/0*gP2cA3ceq7u-T5uk.png"/></div></figure><h1 id="ed9b" class="mu mn ji bd mv mw mx my mz na nb nc nd kx ne ky nf la ng lb nh ld ni le nj nk bi translated">该模式</h1><p id="9e0f" class="pw-post-body-paragraph lg lh ji li b lj nl ks ll lm nm kv lo lp nn lr ls lt no lv lw lx np lz ma mb im bi translated">首先，TFDV将为我们的原始数据创建一个“模式”,这样我们可以在以后使用它来验证新数据。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="ce49" class="mm mn ji mi b gy mo mp l mq mr">df_stats = tfdv.generate_statistics_from_dataframe(df)<br/> <br/>schema = tfdv.infer_schema(df_stats)<br/> <br/>schema</span><span id="dacf" class="mm mn ji mi b gy ms mp l mq mr">feature {<br/>  name: "Name"<br/>  type: BYTES<br/>  domain: "Name"<br/>  presence {<br/>    min_fraction: 1.0<br/>    min_count: 1<br/>  }<br/>  shape {<br/>    dim {<br/>      size: 1<br/>    }<br/>  }<br/>}<br/>feature {<br/>  name: "Number"<br/>  type: FLOAT<br/>  presence {<br/>    min_fraction: 1.0<br/>    min_count: 1<br/>  }<br/>  shape {<br/>    dim {<br/>      size: 1<br/>    }<br/>  }<br/>}<br/>feature {<br/>  name: "Feature"<br/>  type: BYTES<br/>  domain: "Feature"<br/>  presence {<br/>    min_fraction: 1.0<br/>    min_count: 1<br/>  }<br/>  shape {<br/>    dim {<br/>      size: 1<br/>    }<br/>  }<br/>}<br/>string_domain {<br/>  name: "Name"<br/>  value: "Billy"<br/>  value: "George"<br/>}<br/>string_domain {<br/>  name: "Feature"<br/>  value: "A"<br/>  value: "B"<br/>}</span></pre><p id="dd95" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">如您所见，该模式是一个JSON类型的输出，具有数据的特征。我们可以用如下的好格式显示它:</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2876" class="mm mn ji mi b gy mo mp l mq mr">tfdv.display_schema(schema)</span></pre><figure class="md me mf mg gt iv gh gi paragraph-image"><div class="gh gi nq"><img src="../Images/24c535548a165a7d466bcf10f5db0c80.png" data-original-src="https://miro.medium.com/v2/resize:fit:704/format:webp/0*L0AzBSqxsAzsQyBK.png"/></div></figure><figure class="md me mf mg gt iv gh gi paragraph-image"><div class="gh gi nr"><img src="../Images/186fd1c6e95a05a1e782651478a065bf.png" data-original-src="https://miro.medium.com/v2/resize:fit:554/format:webp/0*ANijaScx-L0dR4Rh.png"/></div></figure><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="2594" class="mm mn ji mi b gy mo mp l mq mr">from tensorflow_data_validation.utils.schema_util import write_schema_text, load_schema_text<br/> <br/>#save<br/>write_schema_text(schema, "my_schema")<br/> <br/>#load<br/>schema = load_schema_text("my_schema")</span></pre><p id="c94c" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">假设我们用上面的数据创建了一个机器学习模型。现在我们将创建我们想要验证的假设的新数据。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="e043" class="mm mn ji mi b gy mo mp l mq mr">test=pd.DataFrame({'Name': {0: 'Guilia', 1: 'Billy', 2: 'George', 3: 'Billy', 4: 'Billy'},<br/> 'Number': {0: 1,<br/>  1: 2,<br/>  2: 3,<br/>  3: 5,<br/>  4: 1},<br/> 'Feature': {0: 'A', 1: 'A', 2: 'A', 3: 'B', 4: 'A'}})<br/> <br/>test['Feature2']='YES'<br/> <br/>test.head()</span></pre><figure class="md me mf mg gt iv gh gi paragraph-image"><div class="gh gi ns"><img src="../Images/004c3d77e052c7bea3373e7e4347d86e.png" data-original-src="https://miro.medium.com/v2/resize:fit:520/format:webp/0*UQ9VAeIvGCgfP1WX.png"/></div></figure><h1 id="ea10" class="mu mn ji bd mv mw mx my mz na nb nc nd kx ne ky nf la ng lb nh ld ni le nj nk bi translated">数据有效性</h1><p id="a1d8" class="pw-post-body-paragraph lg lh ji li b lj nl ks ll lm nm kv lo lp nn lr ls lt no lv lw lx np lz ma mb im bi translated">这是验证新数据的时候了。</p><pre class="md me mf mg gt mh mi mj mk aw ml bi"><span id="fa6d" class="mm mn ji mi b gy mo mp l mq mr">new_stats = tfdv.generate_statistics_from_dataframe(test)<br/>     <br/>anomalies = tfdv.validate_statistics(statistics=new_stats, schema=schema)<br/> <br/>tfdv.display_anomalies(anomalies)</span></pre><figure class="md me mf mg gt iv gh gi paragraph-image"><div role="button" tabindex="0" class="iw ix di iy bf iz"><div class="gh gi nt"><img src="../Images/889c9263f0167c265a16615e1c5dd2b0.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*zibJzQEHBiKXZ6GZ.png"/></div></div></figure><p id="158e" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated">我们得到了新数据中所有的异常情况。新数据有一个新列，列“<strong class="li js">编号”</strong>有错误的数据类型，在“<strong class="li js">名称”</strong>列有一个新值。这可能表示数据漂移。现在我们可能需要重新训练我们的模型或者应用不同的数据预处理。此外，TFDV可以选择更新模式或忽略一些异常。</p><h1 id="8434" class="mu mn ji bd mv mw mx my mz na nb nc nd kx ne ky nf la ng lb nh ld ni le nj nk bi translated">总结一下</h1><p id="691e" class="pw-post-body-paragraph lg lh ji li b lj nl ks ll lm nm kv lo lp nn lr ls lt no lv lw lx np lz ma mb im bi translated">使用TFDV进行数据验证是验证新的传入集合的一种经济有效的方式。它将解析新数据并报告任何异常情况，如缺少值、新列和新值。它还可以帮助我们确定是否存在数据漂移，并防止我们使用过时的模型。</p><p id="9450" class="pw-post-body-paragraph lg lh ji li b lj lk ks ll lm ln kv lo lp lq lr ls lt lu lv lw lx ly lz ma mb im bi translated"><em class="nu">最初发表于https://predictivehacks.com</em><a class="ae mc" href="https://predictivehacks.com/data-validation-for-machine-learning-using-tfdv/" rel="noopener ugc nofollow" target="_blank">。</a></p></div></div>    
</body>
</html>